(function(Ss){typeof define=="function"&&define.amd?define(Ss):Ss()})(function(){"use strict";var o8,a8;var Ss,et,MT,bo,FT,BT,UT,HT,G0,j0,W0,$T,uu={},zT=[],y8=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,cu=Array.isArray;function lr(t,e){for(var n in e)t[n]=e[n];return t}function q0(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function k(t,e,n){var i,r,s,o={};for(s in e)s=="key"?i=e[s]:s=="ref"?r=e[s]:o[s]=e[s];if(arguments.length>2&&(o.children=arguments.length>3?Ss.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(s in t.defaultProps)o[s]===void 0&&(o[s]=t.defaultProps[s]);return du(t,o,i,r,null)}function du(t,e,n,i,r){var s={type:t,props:e,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:r??++MT,__i:-1,__u:0};return r==null&&et.vnode!=null&&et.vnode(s),s}function VT(){return{current:null}}function Be(t){return t.children}function Ci(t,e){this.props=t,this.context=e}function Ea(t,e){if(e==null)return t.__?Ea(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?Ea(t):null}function GT(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return GT(t)}}function K0(t){(!t.__d&&(t.__d=!0)&&bo.push(t)&&!Pd.__r++||FT!=et.debounceRendering)&&((FT=et.debounceRendering)||BT)(Pd)}function Pd(){for(var t,e,n,i,r,s,o,a=1;bo.length;)bo.length>a&&bo.sort(UT),t=bo.shift(),a=bo.length,t.__d&&(n=void 0,i=void 0,r=(i=(e=t).__v).__e,s=[],o=[],e.__P&&((n=lr({},i)).__v=i.__v+1,et.vnode&&et.vnode(n),Y0(e.__P,n,i,e.__n,e.__P.namespaceURI,32&i.__u?[r]:null,s,r??Ea(i),!!(32&i.__u),o),n.__v=i.__v,n.__.__k[n.__i]=n,YT(s,n,o),i.__e=i.__=null,n.__e!=r&&GT(n)));Pd.__r=0}function jT(t,e,n,i,r,s,o,a,l,u,c){var d,f,h,p,m,y,g,v=i&&i.__k||zT,b=e.length;for(l=v8(n,e,v,l,b),d=0;d<b;d++)(h=n.__k[d])!=null&&(f=h.__i==-1?uu:v[h.__i]||uu,h.__i=d,y=Y0(t,h,f,r,s,o,a,l,u,c),p=h.__e,h.ref&&f.ref!=h.ref&&(f.ref&&Q0(f.ref,null,h),c.push(h.ref,h.__c||p,h)),m==null&&p!=null&&(m=p),(g=!!(4&h.__u))||f.__k===h.__k?l=WT(h,l,t,g):typeof h.type=="function"&&y!==void 0?l=y:p&&(l=p.nextSibling),h.__u&=-7);return n.__e=m,l}function v8(t,e,n,i,r){var s,o,a,l,u,c=n.length,d=c,f=0;for(t.__k=new Array(r),s=0;s<r;s++)(o=e[s])!=null&&typeof o!="boolean"&&typeof o!="function"?(l=s+f,(o=t.__k[s]=typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?du(null,o,null,null,null):cu(o)?du(Be,{children:o},null,null,null):o.constructor==null&&o.__b>0?du(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=t,o.__b=t.__b+1,a=null,(u=o.__i=b8(o,n,l,d))!=-1&&(d--,(a=n[u])&&(a.__u|=2)),a==null||a.__v==null?(u==-1&&(r>c?f--:r<c&&f++),typeof o.type!="function"&&(o.__u|=4)):u!=l&&(u==l-1?f--:u==l+1?f++:(u>l?f--:f++,o.__u|=4))):t.__k[s]=null;if(d)for(s=0;s<c;s++)(a=n[s])!=null&&!(2&a.__u)&&(a.__e==i&&(i=Ea(a)),QT(a,a));return i}function WT(t,e,n,i){var r,s;if(typeof t.type=="function"){for(r=t.__k,s=0;r&&s<r.length;s++)r[s]&&(r[s].__=t,e=WT(r[s],e,n,i));return e}t.__e!=e&&(i&&(e&&t.type&&!e.parentNode&&(e=Ea(t)),n.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function $r(t,e){return e=e||[],t==null||typeof t=="boolean"||(cu(t)?t.some(function(n){$r(n,e)}):e.push(t)),e}function b8(t,e,n,i){var r,s,o,a=t.key,l=t.type,u=e[n],c=u!=null&&(2&u.__u)==0;if(u===null&&t.key==null||c&&a==u.key&&l==u.type)return n;if(i>(c?1:0)){for(r=n-1,s=n+1;r>=0||s<e.length;)if((u=e[o=r>=0?r--:s++])!=null&&!(2&u.__u)&&a==u.key&&l==u.type)return o}return-1}function qT(t,e,n){e[0]=="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||y8.test(e)?n:n+"px"}function kd(t,e,n,i,r){var s,o;e:if(e=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof i=="string"&&(t.style.cssText=i=""),i)for(e in i)n&&e in n||qT(t.style,e,"");if(n)for(e in n)i&&n[e]==i[e]||qT(t.style,e,n[e])}else if(e[0]=="o"&&e[1]=="n")s=e!=(e=e.replace(HT,"$1")),o=e.toLowerCase(),e=o in t||e=="onFocusOut"||e=="onFocusIn"?o.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+s]=n,n?i?n.u=i.u:(n.u=G0,t.addEventListener(e,s?W0:j0,s)):t.removeEventListener(e,s?W0:j0,s);else{if(r=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function KT(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.t==null)e.t=G0++;else if(e.t<n.u)return;return n(et.event?et.event(e):e)}}}function Y0(t,e,n,i,r,s,o,a,l,u){var c,d,f,h,p,m,y,g,v,b,T,S,_,A,P,O,x,L=e.type;if(e.constructor!=null)return null;128&n.__u&&(l=!!(32&n.__u),s=[a=e.__e=n.__e]),(c=et.__b)&&c(e);e:if(typeof L=="function")try{if(g=e.props,v="prototype"in L&&L.prototype.render,b=(c=L.contextType)&&i[c.__c],T=c?b?b.props.value:c.__:i,n.__c?y=(d=e.__c=n.__c).__=d.__E:(v?e.__c=d=new L(g,T):(e.__c=d=new Ci(g,T),d.constructor=L,d.render=T8),b&&b.sub(d),d.props=g,d.state||(d.state={}),d.context=T,d.__n=i,f=d.__d=!0,d.__h=[],d._sb=[]),v&&d.__s==null&&(d.__s=d.state),v&&L.getDerivedStateFromProps!=null&&(d.__s==d.state&&(d.__s=lr({},d.__s)),lr(d.__s,L.getDerivedStateFromProps(g,d.__s))),h=d.props,p=d.state,d.__v=e,f)v&&L.getDerivedStateFromProps==null&&d.componentWillMount!=null&&d.componentWillMount(),v&&d.componentDidMount!=null&&d.__h.push(d.componentDidMount);else{if(v&&L.getDerivedStateFromProps==null&&g!==h&&d.componentWillReceiveProps!=null&&d.componentWillReceiveProps(g,T),!d.__e&&d.shouldComponentUpdate!=null&&d.shouldComponentUpdate(g,d.__s,T)===!1||e.__v==n.__v){for(e.__v!=n.__v&&(d.props=g,d.state=d.__s,d.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(M){M&&(M.__=e)}),S=0;S<d._sb.length;S++)d.__h.push(d._sb[S]);d._sb=[],d.__h.length&&o.push(d);break e}d.componentWillUpdate!=null&&d.componentWillUpdate(g,d.__s,T),v&&d.componentDidUpdate!=null&&d.__h.push(function(){d.componentDidUpdate(h,p,m)})}if(d.context=T,d.props=g,d.__P=t,d.__e=!1,_=et.__r,A=0,v){for(d.state=d.__s,d.__d=!1,_&&_(e),c=d.render(d.props,d.state,d.context),P=0;P<d._sb.length;P++)d.__h.push(d._sb[P]);d._sb=[]}else do d.__d=!1,_&&_(e),c=d.render(d.props,d.state,d.context),d.state=d.__s;while(d.__d&&++A<25);d.state=d.__s,d.getChildContext!=null&&(i=lr(lr({},i),d.getChildContext())),v&&!f&&d.getSnapshotBeforeUpdate!=null&&(m=d.getSnapshotBeforeUpdate(h,p)),O=c,c!=null&&c.type===Be&&c.key==null&&(O=XT(c.props.children)),a=jT(t,cu(O)?O:[O],e,n,i,r,s,o,a,l,u),d.base=e.__e,e.__u&=-161,d.__h.length&&o.push(d),y&&(d.__E=d.__=null)}catch(M){if(e.__v=null,l||s!=null)if(M.then){for(e.__u|=l?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;s[s.indexOf(a)]=null,e.__e=a}else{for(x=s.length;x--;)q0(s[x]);X0(e)}else e.__e=n.__e,e.__k=n.__k,M.then||X0(e);et.__e(M,e,n)}else s==null&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):a=e.__e=E8(n.__e,e,n,i,r,s,o,l,u);return(c=et.diffed)&&c(e),128&e.__u?void 0:a}function X0(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(X0)}function YT(t,e,n){for(var i=0;i<n.length;i++)Q0(n[i],n[++i],n[++i]);et.__c&&et.__c(e,t),t.some(function(r){try{t=r.__h,r.__h=[],t.some(function(s){s.call(r)})}catch(s){et.__e(s,r.__v)}})}function XT(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:cu(t)?t.map(XT):lr({},t)}function E8(t,e,n,i,r,s,o,a,l){var u,c,d,f,h,p,m,y=n.props,g=e.props,v=e.type;if(v=="svg"?r="http://www.w3.org/2000/svg":v=="math"?r="http://www.w3.org/1998/Math/MathML":r||(r="http://www.w3.org/1999/xhtml"),s!=null){for(u=0;u<s.length;u++)if((h=s[u])&&"setAttribute"in h==!!v&&(v?h.localName==v:h.nodeType==3)){t=h,s[u]=null;break}}if(t==null){if(v==null)return document.createTextNode(g);t=document.createElementNS(r,v,g.is&&g),a&&(et.__m&&et.__m(e,s),a=!1),s=null}if(v==null)y===g||a&&t.data==g||(t.data=g);else{if(s=s&&Ss.call(t.childNodes),y=n.props||uu,!a&&s!=null)for(y={},u=0;u<t.attributes.length;u++)y[(h=t.attributes[u]).name]=h.value;for(u in y)if(h=y[u],u!="children"){if(u=="dangerouslySetInnerHTML")d=h;else if(!(u in g)){if(u=="value"&&"defaultValue"in g||u=="checked"&&"defaultChecked"in g)continue;kd(t,u,null,h,r)}}for(u in g)h=g[u],u=="children"?f=h:u=="dangerouslySetInnerHTML"?c=h:u=="value"?p=h:u=="checked"?m=h:a&&typeof h!="function"||y[u]===h||kd(t,u,h,y[u],r);if(c)a||d&&(c.__html==d.__html||c.__html==t.innerHTML)||(t.innerHTML=c.__html),e.__k=[];else if(d&&(t.innerHTML=""),jT(e.type=="template"?t.content:t,cu(f)?f:[f],e,n,i,v=="foreignObject"?"http://www.w3.org/1999/xhtml":r,s,o,s?s[0]:n.__k&&Ea(n,0),a,l),s!=null)for(u=s.length;u--;)q0(s[u]);a||(u="value",v=="progress"&&p==null?t.removeAttribute("value"):p!=null&&(p!==t[u]||v=="progress"&&!p||v=="option"&&p!=y[u])&&kd(t,u,p,y[u],r),u="checked",m!=null&&m!=t[u]&&kd(t,u,m,y[u],r))}return t}function Q0(t,e,n){try{if(typeof t=="function"){var i=typeof t.__u=="function";i&&t.__u(),i&&e==null||(t.__u=t(e))}else t.current=e}catch(r){et.__e(r,n)}}function QT(t,e,n){var i,r;if(et.unmount&&et.unmount(t),(i=t.ref)&&(i.current&&i.current!=t.__e||Q0(i,null,e)),(i=t.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(s){et.__e(s,e)}i.base=i.__P=null}if(i=t.__k)for(r=0;r<i.length;r++)i[r]&&QT(i[r],e,n||typeof t.type!="function");n||q0(t.__e),t.__c=t.__=t.__e=void 0}function T8(t,e,n){return this.constructor(t,n)}function xs(t,e,n){var i,r,s,o;e==document&&(e=document.documentElement),et.__&&et.__(t,e),r=(i=typeof n=="function")?null:n&&n.__k||e.__k,s=[],o=[],Y0(e,t=(!i&&n||e).__k=k(Be,null,[t]),r||uu,uu,e.namespaceURI,!i&&n?[n]:r?null:e.firstChild?Ss.call(e.childNodes):null,s,!i&&n?n:r?r.__e:e.firstChild,i,o),YT(s,t,o)}function Z0(t,e){xs(t,e,Z0)}function J0(t,e,n){var i,r,s,o,a=lr({},t.props);for(s in t.type&&t.type.defaultProps&&(o=t.type.defaultProps),e)s=="key"?i=e[s]:s=="ref"?r=e[s]:a[s]=e[s]===void 0&&o!=null?o[s]:e[s];return arguments.length>2&&(a.children=arguments.length>3?Ss.call(arguments,2):n),du(t.type,a,i||t.key,r||t.ref,null)}function zi(t){function e(n){var i,r;return this.getChildContext||(i=new Set,(r={})[e.__c]=this,this.getChildContext=function(){return r},this.componentWillUnmount=function(){i=null},this.shouldComponentUpdate=function(s){this.props.value!=s.value&&i.forEach(function(o){o.__e=!0,K0(o)})},this.sub=function(s){i.add(s);var o=s.componentWillUnmount;s.componentWillUnmount=function(){i&&i.delete(s),o&&o.call(s)}}),n.children}return e.__c="__cC"+$T++,e.__=t,e.Provider=e.__l=(e.Consumer=function(n,i){return n.children(i)}).contextType=e,e}Ss=zT.slice,et={__e:function(t,e,n,i){for(var r,s,o;e=e.__;)if((r=e.__c)&&!r.__)try{if((s=r.constructor)&&s.getDerivedStateFromError!=null&&(r.setState(s.getDerivedStateFromError(t)),o=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(t,i||{}),o=r.__d),o)return r.__E=r}catch(a){t=a}throw t}},MT=0,Ci.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=lr({},this.state),typeof t=="function"&&(t=t(lr({},n),this.props)),t&&lr(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),K0(this))},Ci.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),K0(this))},Ci.prototype.render=Be,bo=[],BT=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,UT=function(t,e){return t.__v.__b-e.__v.__b},Pd.__r=0,HT=/(PointerCapture)$|Capture$/i,G0=0,j0=KT(!1),W0=KT(!0),$T=0;var zr,_t,em,ZT,Ta=0,JT=[],zt=et,eS=zt.__b,tS=zt.__r,nS=zt.diffed,iS=zt.__c,rS=zt.unmount,sS=zt.__;function Eo(t,e){zt.__h&&zt.__h(_t,t,Ta||e),Ta=0;var n=_t.__H||(_t.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function Se(t){return Ta=1,Sa(aS,t)}function Sa(t,e,n){var i=Eo(zr++,2);if(i.t=t,!i.__c&&(i.__=[n?n(e):aS(void 0,e),function(a){var l=i.__N?i.__N[0]:i.__[0],u=i.t(l,a);l!==u&&(i.__N=[u,i.__[1]],i.__c.setState({}))}],i.__c=_t,!_t.__f)){var r=function(a,l,u){if(!i.__c.__H)return!0;var c=i.__c.__H.__.filter(function(f){return!!f.__c});if(c.every(function(f){return!f.__N}))return!s||s.call(this,a,l,u);var d=i.__c.props!==a;return c.forEach(function(f){if(f.__N){var h=f.__[0];f.__=f.__N,f.__N=void 0,h!==f.__[0]&&(d=!0)}}),s&&s.call(this,a,l,u)||d};_t.__f=!0;var s=_t.shouldComponentUpdate,o=_t.componentWillUpdate;_t.componentWillUpdate=function(a,l,u){if(this.__e){var c=s;s=void 0,r(a,l,u),s=c}o&&o.call(this,a,l,u)},_t.shouldComponentUpdate=r}return i.__N||i.__}function me(t,e){var n=Eo(zr++,3);!zt.__s&&sm(n.__H,e)&&(n.__=t,n.u=e,_t.__H.__h.push(n))}function Ii(t,e){var n=Eo(zr++,4);!zt.__s&&sm(n.__H,e)&&(n.__=t,n.u=e,_t.__h.push(n))}function Le(t){return Ta=5,en(function(){return{current:t}},[])}function tm(t,e,n){Ta=6,Ii(function(){if(typeof t=="function"){var i=t(e());return function(){t(null),i&&typeof i=="function"&&i()}}if(t)return t.current=e(),function(){return t.current=null}},n==null?n:n.concat(t))}function en(t,e){var n=Eo(zr++,7);return sm(n.__H,e)&&(n.__=t(),n.__H=e,n.__h=t),n.__}function Ge(t,e){return Ta=8,en(function(){return t},e)}function ur(t){var e=_t.context[t.__c],n=Eo(zr++,9);return n.c=t,e?(n.__==null&&(n.__=!0,e.sub(_t)),e.props.value):t.__}function nm(t,e){zt.useDebugValue&&zt.useDebugValue(e?e(t):t)}function S8(t){var e=Eo(zr++,10),n=Se();return e.__=t,_t.componentDidCatch||(_t.componentDidCatch=function(i,r){e.__&&e.__(i,r),n[1](i)}),[n[0],function(){n[1](void 0)}]}function im(){var t=Eo(zr++,11);if(!t.__){for(var e=_t.__v;e!==null&&!e.__m&&e.__!==null;)e=e.__;var n=e.__m||(e.__m=[0,0]);t.__="P"+n[0]+"-"+n[1]++}return t.__}function x8(){for(var t;t=JT.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(Dd),t.__H.__h.forEach(rm),t.__H.__h=[]}catch(e){t.__H.__h=[],zt.__e(e,t.__v)}}zt.__b=function(t){_t=null,eS&&eS(t)},zt.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),sS&&sS(t,e)},zt.__r=function(t){tS&&tS(t),zr=0;var e=(_t=t.__c).__H;e&&(em===_t?(e.__h=[],_t.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(e.__h.forEach(Dd),e.__h.forEach(rm),e.__h=[],zr=0)),em=_t},zt.diffed=function(t){nS&&nS(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(JT.push(e)!==1&&ZT===zt.requestAnimationFrame||((ZT=zt.requestAnimationFrame)||w8)(x8)),e.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),em=_t=null},zt.__c=function(t,e){e.some(function(n){try{n.__h.forEach(Dd),n.__h=n.__h.filter(function(i){return!i.__||rm(i)})}catch(i){e.some(function(r){r.__h&&(r.__h=[])}),e=[],zt.__e(i,n.__v)}}),iS&&iS(t,e)},zt.unmount=function(t){rS&&rS(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(i){try{Dd(i)}catch(r){e=r}}),n.__H=void 0,e&&zt.__e(e,n.__v))};var oS=typeof requestAnimationFrame=="function";function w8(t){var e,n=function(){clearTimeout(i),oS&&cancelAnimationFrame(e),setTimeout(t)},i=setTimeout(n,35);oS&&(e=requestAnimationFrame(n))}function Dd(t){var e=_t,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),_t=e}function rm(t){var e=_t;t.__c=t.__(),_t=e}function sm(t,e){return!t||t.length!==e.length||e.some(function(n,i){return n!==t[i]})}function aS(t,e){return typeof e=="function"?e(t):e}function lS(t,e){for(var n in e)t[n]=e[n];return t}function om(t,e){for(var n in t)if(n!=="__source"&&!(n in e))return!0;for(var i in e)if(i!=="__source"&&t[i]!==e[i])return!0;return!1}function am(t,e){var n=e(),i=Se({t:{__:n,u:e}}),r=i[0].t,s=i[1];return Ii(function(){r.__=n,r.u=e,lm(r)&&s({t:r})},[t,n,e]),me(function(){return lm(r)&&s({t:r}),t(function(){lm(r)&&s({t:r})})},[t]),n}function lm(t){var e,n,i=t.u,r=t.__;try{var s=i();return!((e=r)===(n=s)&&(e!==0||1/e==1/n)||e!=e&&n!=n)}catch{return!0}}function um(t){t()}function cm(t){return t}function dm(){return[!1,um]}var fm=Ii;function Od(t,e){this.props=t,this.context=e}function uS(t,e){function n(r){var s=this.props.ref,o=s==r.ref;return!o&&s&&(s.call?s(null):s.current=null),e?!e(this.props,r)||!o:om(this.props,r)}function i(r){return this.shouldComponentUpdate=n,k(t,r)}return i.displayName="Memo("+(t.displayName||t.name)+")",i.prototype.isReactComponent=!0,i.__f=!0,i.type=t,i}(Od.prototype=new Ci).isPureReactComponent=!0,Od.prototype.shouldComponentUpdate=function(t,e){return om(this.props,t)||om(this.state,e)};var cS=et.__b;et.__b=function(t){t.type&&t.type.__f&&t.ref&&(t.props.ref=t.ref,t.ref=null),cS&&cS(t)};var _8=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function Re(t){function e(n){var i=lS({},n);return delete i.ref,t(i,n.ref||null)}return e.$$typeof=_8,e.render=t,e.prototype.isReactComponent=e.__f=!0,e.displayName="ForwardRef("+(t.displayName||t.name)+")",e}var dS=function(t,e){return t==null?null:$r($r(t).map(e))},Gn={map:dS,forEach:dS,count:function(t){return t?$r(t).length:0},only:function(t){var e=$r(t);if(e.length!==1)throw"Children.only";return e[0]},toArray:$r},A8=et.__e;et.__e=function(t,e,n,i){if(t.then){for(var r,s=e;s=s.__;)if((r=s.__c)&&r.__c)return e.__e==null&&(e.__e=n.__e,e.__k=n.__k),r.__c(t,e)}A8(t,e,n,i)};var fS=et.unmount;function hS(t,e,n){return t&&(t.__c&&t.__c.__H&&(t.__c.__H.__.forEach(function(i){typeof i.__c=="function"&&i.__c()}),t.__c.__H=null),(t=lS({},t)).__c!=null&&(t.__c.__P===n&&(t.__c.__P=e),t.__c.__e=!0,t.__c=null),t.__k=t.__k&&t.__k.map(function(i){return hS(i,e,n)})),t}function pS(t,e,n){return t&&n&&(t.__v=null,t.__k=t.__k&&t.__k.map(function(i){return pS(i,e,n)}),t.__c&&t.__c.__P===e&&(t.__e&&n.appendChild(t.__e),t.__c.__e=!0,t.__c.__P=n)),t}function fu(){this.__u=0,this.o=null,this.__b=null}function mS(t){var e=t.__.__c;return e&&e.__a&&e.__a(t)}function gS(t){var e,n,i;function r(s){if(e||(e=t()).then(function(o){n=o.default||o},function(o){i=o}),i)throw i;if(!n)throw e;return k(n,s)}return r.displayName="Lazy",r.__f=!0,r}function xa(){this.i=null,this.l=null}et.unmount=function(t){var e=t.__c;e&&e.__R&&e.__R(),e&&32&t.__u&&(t.type=null),fS&&fS(t)},(fu.prototype=new Ci).__c=function(t,e){var n=e.__c,i=this;i.o==null&&(i.o=[]),i.o.push(n);var r=mS(i.__v),s=!1,o=function(){s||(s=!0,n.__R=null,r?r(a):a())};n.__R=o;var a=function(){if(!--i.__u){if(i.state.__a){var l=i.state.__a;i.__v.__k[0]=pS(l,l.__c.__P,l.__c.__O)}var u;for(i.setState({__a:i.__b=null});u=i.o.pop();)u.forceUpdate()}};i.__u++||32&e.__u||i.setState({__a:i.__b=i.__v.__k[0]}),t.then(o,o)},fu.prototype.componentWillUnmount=function(){this.o=[]},fu.prototype.render=function(t,e){if(this.__b){if(this.__v.__k){var n=document.createElement("div"),i=this.__v.__k[0].__c;this.__v.__k[0]=hS(this.__b,n,i.__O=i.__P)}this.__b=null}var r=e.__a&&k(Be,null,t.fallback);return r&&(r.__u&=-33),[k(Be,null,e.__a?null:t.children),r]};var yS=function(t,e,n){if(++n[1]===n[0]&&t.l.delete(e),t.props.revealOrder&&(t.props.revealOrder[0]!=="t"||!t.l.size))for(n=t.i;n;){for(;n.length>3;)n.pop()();if(n[1]<n[0])break;t.i=n=n[2]}};function C8(t){return this.getChildContext=function(){return t.context},t.children}function I8(t){var e=this,n=t.h;if(e.componentWillUnmount=function(){xs(null,e.v),e.v=null,e.h=null},e.h&&e.h!==n&&e.componentWillUnmount(),!e.v){for(var i=e.__v;i!==null&&!i.__m&&i.__!==null;)i=i.__;e.h=n,e.v={nodeType:1,parentNode:n,childNodes:[],__k:{__m:i.__m},contains:function(){return!0},insertBefore:function(r,s){this.childNodes.push(r),e.h.insertBefore(r,s)},removeChild:function(r){this.childNodes.splice(this.childNodes.indexOf(r)>>>1,1),e.h.removeChild(r)}}}xs(k(C8,{context:e.context},t.__v),e.v)}function vS(t,e){var n=k(I8,{__v:t,h:e});return n.containerInfo=e,n}(xa.prototype=new Ci).__a=function(t){var e=this,n=mS(e.__v),i=e.l.get(t);return i[0]++,function(r){var s=function(){e.props.revealOrder?(i.push(r),yS(e,t,i)):r()};n?n(s):s()}},xa.prototype.render=function(t){this.i=null,this.l=new Map;var e=$r(t.children);t.revealOrder&&t.revealOrder[0]==="b"&&e.reverse();for(var n=e.length;n--;)this.l.set(e[n],this.i=[1,0,this.i]);return t.children},xa.prototype.componentDidUpdate=xa.prototype.componentDidMount=function(){var t=this;this.l.forEach(function(e,n){yS(t,n,e)})};var bS=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,R8=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,L8=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,P8=/[A-Z0-9]/g,k8=typeof document<"u",D8=function(t){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(t)};function ES(t,e,n){return e.__k==null&&(e.textContent=""),xs(t,e),typeof n=="function"&&n(),t?t.__c:null}function TS(t,e,n){return Z0(t,e),typeof n=="function"&&n(),t?t.__c:null}Ci.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(t){Object.defineProperty(Ci.prototype,t,{configurable:!0,get:function(){return this["UNSAFE_"+t]},set:function(e){Object.defineProperty(this,t,{configurable:!0,writable:!0,value:e})}})});var SS=et.event;function O8(){}function N8(){return this.cancelBubble}function M8(){return this.defaultPrevented}et.event=function(t){return SS&&(t=SS(t)),t.persist=O8,t.isPropagationStopped=N8,t.isDefaultPrevented=M8,t.nativeEvent=t};var hm,F8={enumerable:!1,configurable:!0,get:function(){return this.class}},xS=et.vnode;et.vnode=function(t){typeof t.type=="string"&&function(e){var n=e.props,i=e.type,r={},s=i.indexOf("-")===-1;for(var o in n){var a=n[o];if(!(o==="value"&&"defaultValue"in n&&a==null||k8&&o==="children"&&i==="noscript"||o==="class"||o==="className")){var l=o.toLowerCase();o==="defaultValue"&&"value"in n&&n.value==null?o="value":o==="download"&&a===!0?a="":l==="translate"&&a==="no"?a=!1:l[0]==="o"&&l[1]==="n"?l==="ondoubleclick"?o="ondblclick":l!=="onchange"||i!=="input"&&i!=="textarea"||D8(n.type)?l==="onfocus"?o="onfocusin":l==="onblur"?o="onfocusout":L8.test(o)&&(o=l):l=o="oninput":s&&R8.test(o)?o=o.replace(P8,"-$&").toLowerCase():a===null&&(a=void 0),l==="oninput"&&r[o=l]&&(o="oninputCapture"),r[o]=a}}i=="select"&&r.multiple&&Array.isArray(r.value)&&(r.value=$r(n.children).forEach(function(u){u.props.selected=r.value.indexOf(u.props.value)!=-1})),i=="select"&&r.defaultValue!=null&&(r.value=$r(n.children).forEach(function(u){u.props.selected=r.multiple?r.defaultValue.indexOf(u.props.value)!=-1:r.defaultValue==u.props.value})),n.class&&!n.className?(r.class=n.class,Object.defineProperty(r,"className",F8)):(n.className&&!n.class||n.class&&n.className)&&(r.class=r.className=n.className),e.props=r}(t),t.$$typeof=bS,xS&&xS(t)};var wS=et.__r;et.__r=function(t){wS&&wS(t),hm=t.__c};var _S=et.diffed;et.diffed=function(t){_S&&_S(t);var e=t.props,n=t.__e;n!=null&&t.type==="textarea"&&"value"in e&&e.value!==n.value&&(n.value=e.value==null?"":e.value),hm=null};var AS={ReactCurrentDispatcher:{current:{readContext:function(t){return hm.__n[t.__c].props.value},useCallback:Ge,useContext:ur,useDebugValue:nm,useDeferredValue:cm,useEffect:me,useId:im,useImperativeHandle:tm,useInsertionEffect:fm,useLayoutEffect:Ii,useMemo:en,useReducer:Sa,useRef:Le,useState:Se,useSyncExternalStore:am,useTransition:dm}}},B8="18.3.1";function CS(t){return k.bind(null,t)}function li(t){return!!t&&t.$$typeof===bS}function IS(t){return li(t)&&t.type===Be}function RS(t){return!!t&&!!t.displayName&&(typeof t.displayName=="string"||t.displayName instanceof String)&&t.displayName.startsWith("Memo(")}function Vr(t){return li(t)?J0.apply(null,arguments):t}function LS(t){return!!t.__k&&(xs(null,t),!0)}function PS(t){return t&&(t.base||t.nodeType===1&&t)||null}var kS=function(t,e){return t(e)},DS=function(t,e){return t(e)},OS=Be,NS=li,lt={useState:Se,useId:im,useReducer:Sa,useEffect:me,useLayoutEffect:Ii,useInsertionEffect:fm,useTransition:dm,useDeferredValue:cm,useSyncExternalStore:am,startTransition:um,useRef:Le,useImperativeHandle:tm,useMemo:en,useCallback:Ge,useContext:ur,useDebugValue:nm,version:"18.3.1",Children:Gn,render:ES,hydrate:TS,unmountComponentAtNode:LS,createPortal:vS,createElement:k,createContext:zi,createFactory:CS,cloneElement:Vr,createRef:VT,Fragment:Be,isValidElement:li,isElement:NS,isFragment:IS,isMemo:RS,findDOMNode:PS,Component:Ci,PureComponent:Od,memo:uS,forwardRef:Re,flushSync:DS,unstable_batchedUpdates:kS,StrictMode:OS,Suspense:fu,SuspenseList:xa,lazy:gS,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:AS};const Nd=Object.freeze(Object.defineProperty({__proto__:null,Children:Gn,Component:Ci,Fragment:Be,PureComponent:Od,StrictMode:OS,Suspense:fu,SuspenseList:xa,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:AS,cloneElement:Vr,createContext:zi,createElement:k,createFactory:CS,createPortal:vS,createRef:VT,default:lt,findDOMNode:PS,flushSync:DS,forwardRef:Re,hydrate:TS,isElement:NS,isFragment:IS,isMemo:RS,isValidElement:li,lazy:gS,memo:uS,render:ES,startTransition:um,unmountComponentAtNode:LS,unstable_batchedUpdates:kS,useCallback:Ge,useContext:ur,useDebugValue:nm,useDeferredValue:cm,useEffect:me,useErrorBoundary:S8,useId:im,useImperativeHandle:tm,useInsertionEffect:fm,useLayoutEffect:Ii,useMemo:en,useReducer:Sa,useRef:Le,useState:Se,useSyncExternalStore:am,useTransition:dm,version:B8},Symbol.toStringTag,{value:"Module"}));var qe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Md(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function MS(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(i){var r=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(n,i,r.get?r:{enumerable:!0,get:function(){return t[i]}})}),n}var FS={exports:{}};(function(t){//! openseadragon 4.1.1
//! Built on 2024-04-01
//! Git commit: v4.1.1-0-f90d9814
//! http://openseadragon.github.io
//! License: http://openseadragon.github.io/license/
function e(n){return new e.Viewer(n)}(function(n){n.version={versionStr:"4.1.1",major:parseInt("4",10),minor:parseInt("1",10),revision:parseInt("1",10)};var i={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object AsyncFunction]":"function","[object Promise]":"promise","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},r=Object.prototype.toString,s=Object.prototype.hasOwnProperty;n.isFunction=function(o){return n.type(o)==="function"},n.isArray=Array.isArray||function(o){return n.type(o)==="array"},n.isWindow=function(o){return o&&typeof o=="object"&&"setInterval"in o},n.type=function(o){return o==null?String(o):i[r.call(o)]||"object"},n.isPlainObject=function(o){if(!o||e.type(o)!=="object"||o.nodeType||n.isWindow(o)||o.constructor&&!s.call(o,"constructor")&&!s.call(o.constructor.prototype,"isPrototypeOf"))return!1;var a;for(var l in o)a=l;return a===void 0||s.call(o,a)},n.isEmptyObject=function(o){for(var a in o)return!1;return!0},n.freezeObject=function(o){return Object.freeze?n.freezeObject=Object.freeze:n.freezeObject=function(a){return a},n.freezeObject(o)},n.supportsCanvas=function(){var o=document.createElement("canvas");return!!(n.isFunction(o.getContext)&&o.getContext("2d"))}(),n.isCanvasTainted=function(o){var a=!1;try{o.getContext("2d").getImageData(0,0,1,1)}catch{a=!0}return a},n.supportsAddEventListener=function(){return!!(document.documentElement.addEventListener&&document.addEventListener)}(),n.supportsRemoveEventListener=function(){return!!(document.documentElement.removeEventListener&&document.removeEventListener)}(),n.supportsEventListenerOptions=function(){var o=0;if(n.supportsAddEventListener)try{var a={get capture(){return o++,!1},get once(){return o++,!1},get passive(){return o++,!1}};window.addEventListener("test",null,a),window.removeEventListener("test",null,a)}catch{o=0}return o>=3}(),n.getCurrentPixelDensityRatio=function(){if(n.supportsCanvas){var o=document.createElement("canvas").getContext("2d"),a=window.devicePixelRatio||1,l=o.webkitBackingStorePixelRatio||o.mozBackingStorePixelRatio||o.msBackingStorePixelRatio||o.oBackingStorePixelRatio||o.backingStorePixelRatio||1;return Math.max(a,1)/l}else return 1},n.pixelDensityRatio=n.getCurrentPixelDensityRatio()})(e),function(n){n.extend=function(){var l,u,c,d,f,h,p=arguments[0]||{},m=arguments.length,y=!1,g=1;for(typeof p=="boolean"&&(y=p,p=arguments[1]||{},g=2),typeof p!="object"&&!e.isFunction(p)&&(p={}),m===g&&(p=this,--g);g<m;g++)if(l=arguments[g],l!==null||l!==void 0)for(u in l){var v=Object.getOwnPropertyDescriptor(l,u);if(v!==void 0){if(v.get||v.set){Object.defineProperty(p,u,v);continue}d=v.value}else{n.console.warn('Could not copy inherited property "'+u+'".');continue}p!==d&&(y&&d&&(e.isPlainObject(d)||(f=e.isArray(d)))?(c=p[u],f?(f=!1,h=c&&e.isArray(c)?c:[]):h=c&&e.isPlainObject(c)?c:{},p[u]=e.extend(y,h,d)):d!==void 0&&(p[u]=d))}return p};var i=function(){if(typeof navigator!="object")return!1;var l=navigator.userAgent;return typeof l!="string"?!1:l.indexOf("iPhone")!==-1||l.indexOf("iPad")!==-1||l.indexOf("iPod")!==-1};n.extend(n,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},splitHashDataForPost:!1,panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{dragToPan:!0,scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,dblClickDragToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,dblClickDragToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,dblClickDragToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,dblClickDragToZoom:!1,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerDblClickDrag:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:i(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorElement:null,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,subPixelRoundingForTransparency:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,tileRetryMax:0,tileRetryDelay:2500,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"],silenceMultiImageWarnings:!1},SIGNAL:"----seadragon----",delegate:function(l,u){return function(){var c=arguments;return c===void 0&&(c=[]),u.apply(l,c)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5,EDGE:6,CHROMEEDGE:7},SUBPIXEL_ROUNDING_OCCURRENCES:{NEVER:0,ONLY_AT_REST:1,ALWAYS:2},_viewers:new Map,getViewer:function(l){return n._viewers.get(this.getElement(l))},getElement:function(l){return typeof l=="string"&&(l=document.getElementById(l)),l},getElementPosition:function(l){var u=new n.Point,c,d;for(l=n.getElement(l),c=n.getElementStyle(l).position==="fixed",d=a(l,c);d;)u.x+=l.offsetLeft,u.y+=l.offsetTop,c&&(u=u.plus(n.getPageScroll())),l=d,c=n.getElementStyle(l).position==="fixed",d=a(l,c);return u},getElementOffset:function(l){l=n.getElement(l);var u=l&&l.ownerDocument,c,d,f={top:0,left:0};return u?(c=u.documentElement,typeof l.getBoundingClientRect<"u"&&(f=l.getBoundingClientRect()),d=u===u.window?u:u.nodeType===9?u.defaultView||u.parentWindow:!1,new n.Point(f.left+(d.pageXOffset||c.scrollLeft)-(c.clientLeft||0),f.top+(d.pageYOffset||c.scrollTop)-(c.clientTop||0))):new n.Point},getElementSize:function(l){return l=n.getElement(l),new n.Point(l.clientWidth,l.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(l){return l=n.getElement(l),l.currentStyle}:function(l){return l=n.getElement(l),window.getComputedStyle(l,"")},getCssPropertyWithVendorPrefix:function(l){var u={};return n.getCssPropertyWithVendorPrefix=function(c){if(u[c]!==void 0)return u[c];var d=document.createElement("div").style,f=null;if(d[c]!==void 0)f=c;else for(var h=["Webkit","Moz","MS","O","webkit","moz","ms","o"],p=n.capitalizeFirstLetter(c),m=0;m<h.length;m++){var y=h[m]+p;if(d[y]!==void 0){f=y;break}}return u[c]=f,f},n.getCssPropertyWithVendorPrefix(l)},capitalizeFirstLetter:function(l){return l.charAt(0).toUpperCase()+l.slice(1)},positiveModulo:function(l,u){var c=l%u;return c<0&&(c+=u),c},pointInElement:function(l,u){l=n.getElement(l);var c=n.getElementOffset(l),d=n.getElementSize(l);return u.x>=c.x&&u.x<c.x+d.x&&u.y<c.y+d.y&&u.y>=c.y},getMousePosition:function(l){if(typeof l.pageX=="number")n.getMousePosition=function(u){var c=new n.Point;return c.x=u.pageX,c.y=u.pageY,c};else if(typeof l.clientX=="number")n.getMousePosition=function(u){var c=new n.Point;return c.x=u.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c.y=u.clientY+document.body.scrollTop+document.documentElement.scrollTop,c};else throw new Error("Unknown event mouse position, no known technique.");return n.getMousePosition(l)},getPageScroll:function(){var l=document.documentElement||{},u=document.body||{};if(typeof window.pageXOffset=="number")n.getPageScroll=function(){return new n.Point(window.pageXOffset,window.pageYOffset)};else if(u.scrollLeft||u.scrollTop)n.getPageScroll=function(){return new n.Point(document.body.scrollLeft,document.body.scrollTop)};else if(l.scrollLeft||l.scrollTop)n.getPageScroll=function(){return new n.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)};else return new n.Point(0,0);return n.getPageScroll()},setPageScroll:function(l){if(typeof window.scrollTo<"u")n.setPageScroll=function(d){window.scrollTo(d.x,d.y)};else{var u=n.getPageScroll();if(u.x===l.x&&u.y===l.y)return;document.body.scrollLeft=l.x,document.body.scrollTop=l.y;var c=n.getPageScroll();if(c.x!==u.x&&c.y!==u.y){n.setPageScroll=function(d){document.body.scrollLeft=d.x,document.body.scrollTop=d.y};return}if(document.documentElement.scrollLeft=l.x,document.documentElement.scrollTop=l.y,c=n.getPageScroll(),c.x!==u.x&&c.y!==u.y){n.setPageScroll=function(d){document.documentElement.scrollLeft=d.x,document.documentElement.scrollTop=d.y};return}n.setPageScroll=function(d){}}n.setPageScroll(l)},getWindowSize:function(){var l=document.documentElement||{},u=document.body||{};if(typeof window.innerWidth=="number")n.getWindowSize=function(){return new n.Point(window.innerWidth,window.innerHeight)};else if(l.clientWidth||l.clientHeight)n.getWindowSize=function(){return new n.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else if(u.clientWidth||u.clientHeight)n.getWindowSize=function(){return new n.Point(document.body.clientWidth,document.body.clientHeight)};else throw new Error("Unknown window size, no known technique.");return n.getWindowSize()},makeCenteredNode:function(l){l=n.getElement(l);var u=[n.makeNeutralElement("div"),n.makeNeutralElement("div"),n.makeNeutralElement("div")];return n.extend(u[0].style,{display:"table",height:"100%",width:"100%"}),n.extend(u[1].style,{display:"table-row"}),n.extend(u[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),u[0].appendChild(u[1]),u[1].appendChild(u[2]),u[2].appendChild(l),u[0]},makeNeutralElement:function(l){var u=document.createElement(l),c=u.style;return c.background="transparent none",c.border="none",c.margin="0px",c.padding="0px",c.position="static",u},now:function(){return Date.now?n.now=Date.now:n.now=function(){return new Date().getTime()},n.now()},makeTransparentImage:function(l){var u=n.makeNeutralElement("img");return u.src=l,u},setElementOpacity:function(l,u,c){var d,f;l=n.getElement(l),c&&!n.Browser.alpha&&(u=Math.round(u)),n.Browser.opacity?l.style.opacity=u<1?u:"":u<1?(d=Math.round(100*u),f="alpha(opacity="+d+")",l.style.filter=f):l.style.filter=""},setElementTouchActionNone:function(l){l=n.getElement(l),typeof l.style.touchAction<"u"?l.style.touchAction="none":typeof l.style.msTouchAction<"u"&&(l.style.msTouchAction="none")},setElementPointerEvents:function(l,u){l=n.getElement(l),typeof l.style<"u"&&typeof l.style.pointerEvents<"u"&&(l.style.pointerEvents=u)},setElementPointerEventsNone:function(l){n.setElementPointerEvents(l,"none")},addClass:function(l,u){l=n.getElement(l),l.className?(" "+l.className+" ").indexOf(" "+u+" ")===-1&&(l.className+=" "+u):l.className=u},indexOf:function(l,u,c){return Array.prototype.indexOf?this.indexOf=function(d,f,h){return d.indexOf(f,h)}:this.indexOf=function(d,f,h){var p,m=h||0,y;if(!d)throw new TypeError;if(y=d.length,y===0||m>=y)return-1;for(m<0&&(m=y-Math.abs(m)),p=m;p<y;p++)if(d[p]===f)return p;return-1},this.indexOf(l,u,c)},removeClass:function(l,u){var c,d=[],f;for(l=n.getElement(l),c=l.className.split(/\s+/),f=0;f<c.length;f++)c[f]&&c[f]!==u&&d.push(c[f]);l.className=d.join(" ")},normalizeEventListenerOptions:function(l){var u;return typeof l<"u"?typeof l=="boolean"?u=n.supportsEventListenerOptions?{capture:l}:l:u=n.supportsEventListenerOptions?l:typeof l.capture<"u"?l.capture:!1:u=n.supportsEventListenerOptions?{capture:!1}:!1,u},addEvent:function(){if(n.supportsAddEventListener)return function(l,u,c,d){d=n.normalizeEventListenerOptions(d),l=n.getElement(l),l.addEventListener(u,c,d)};if(document.documentElement.attachEvent&&document.attachEvent)return function(l,u,c){l=n.getElement(l),l.attachEvent("on"+u,c)};throw new Error("No known event model.")}(),removeEvent:function(){if(n.supportsRemoveEventListener)return function(l,u,c,d){d=n.normalizeEventListenerOptions(d),l=n.getElement(l),l.removeEventListener(u,c,d)};if(document.documentElement.detachEvent&&document.detachEvent)return function(l,u,c){l=n.getElement(l),l.detachEvent("on"+u,c)};throw new Error("No known event model.")}(),cancelEvent:function(l){l.preventDefault()},eventIsCanceled:function(l){return l.defaultPrevented},stopEvent:function(l){l.stopPropagation()},createCallback:function(l,u){var c=[],d;for(d=2;d<arguments.length;d++)c.push(arguments[d]);return function(){var f=c.concat([]),h;for(h=0;h<arguments.length;h++)f.push(arguments[h]);return u.apply(l,f)}},getUrlParameter:function(l){var u=o[l];return u||null},getUrlProtocol:function(l){var u=l.match(/^([a-z]+:)\/\//i);return u===null?window.location.protocol:u[1].toLowerCase()},createAjaxRequest:function(l){var u;try{u=!!new ActiveXObject("Microsoft.XMLHTTP")}catch{u=!1}if(u)window.XMLHttpRequest?n.createAjaxRequest=function(c){return c?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:n.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else if(window.XMLHttpRequest)n.createAjaxRequest=function(){return new XMLHttpRequest};else throw new Error("Browser doesn't support XMLHttpRequest.");return n.createAjaxRequest(l)},makeAjaxRequest:function(l,u,c){var d,f,h,p;n.isPlainObject(l)&&(u=l.success,c=l.error,d=l.withCredentials,f=l.headers,h=l.responseType||null,p=l.postData||null,l=l.url);var m=n.getUrlProtocol(l),y=n.createAjaxRequest(m==="file:");if(!n.isFunction(u))throw new Error("makeAjaxRequest requires a success callback");y.onreadystatechange=function(){y.readyState===4&&(y.onreadystatechange=function(){},y.status>=200&&y.status<300||y.status===0&&m!=="http:"&&m!=="https:"?u(y):n.isFunction(c)?c(y):n.console.error("AJAX request returned %d: %s",y.status,l))};var g=p?"POST":"GET";try{if(y.open(g,l,!0),h&&(y.responseType=h),f)for(var v in f)Object.prototype.hasOwnProperty.call(f,v)&&f[v]&&y.setRequestHeader(v,f[v]);d&&(y.withCredentials=!0),y.send(p)}catch(b){n.console.error("%s while making AJAX request: %s",b.name,b.message),y.onreadystatechange=function(){},n.isFunction(c)&&c(y,b)}return y},jsonp:function(l){var u,c=l.url,d=document.head||document.getElementsByTagName("head")[0]||document.documentElement,f=l.callbackName||"openseadragon"+n.now(),h=window[f],p="$1"+f+"$2",m=l.param||"callback",y=l.callback;c=c.replace(/(=)\?(&|$)|\?\?/i,p),c+=(/\?/.test(c)?"&":"?")+m+"="+f,window[f]=function(g){if(h)window[f]=h;else try{delete window[f]}catch{}y&&n.isFunction(y)&&y(g)},u=document.createElement("script"),(l.async!==void 0||l.async!==!1)&&(u.async="async"),l.scriptCharset&&(u.charset=l.scriptCharset),u.src=c,u.onload=u.onreadystatechange=function(g,v){(v||!u.readyState||/loaded|complete/.test(u.readyState))&&(u.onload=u.onreadystatechange=null,d&&u.parentNode&&d.removeChild(u),u=void 0)},d.insertBefore(u,d.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(l){if(window.DOMParser)n.parseXml=function(u){var c=null,d;return d=new DOMParser,c=d.parseFromString(u,"text/xml"),c};else if(window.ActiveXObject)n.parseXml=function(u){var c=null;return c=new ActiveXObject("Microsoft.XMLDOM"),c.async=!1,c.loadXML(u),c};else throw new Error("Browser doesn't support XML DOM.");return n.parseXml(l)},parseJSON:function(l){return n.parseJSON=window.JSON.parse,n.parseJSON(l)},imageFormatSupported:function(l){return l=l||"",!!s[l.toLowerCase()]},setImageFormatsSupported:function(l){n.extend(s,l)}});var r=function(l){};n.console=window.console||{log:r,debug:r,info:r,warn:r,error:r,assert:r},n.Browser={vendor:n.BROWSERS.UNKNOWN,version:0,alpha:!0};var s={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},o={};(function(){var l=navigator.appVersion,u=navigator.userAgent,c;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&(n.Browser.vendor=n.BROWSERS.IE,n.Browser.version=parseFloat(u.substring(u.indexOf("MSIE")+5,u.indexOf(";",u.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(u.indexOf("Edge")>=0?(n.Browser.vendor=n.BROWSERS.EDGE,n.Browser.version=parseFloat(u.substring(u.indexOf("Edge")+5))):u.indexOf("Edg")>=0?(n.Browser.vendor=n.BROWSERS.CHROMEEDGE,n.Browser.version=parseFloat(u.substring(u.indexOf("Edg")+4))):u.indexOf("Firefox")>=0?(n.Browser.vendor=n.BROWSERS.FIREFOX,n.Browser.version=parseFloat(u.substring(u.indexOf("Firefox")+8))):u.indexOf("Safari")>=0?(n.Browser.vendor=u.indexOf("Chrome")>=0?n.BROWSERS.CHROME:n.BROWSERS.SAFARI,n.Browser.version=parseFloat(u.substring(u.substring(0,u.indexOf("Safari")).lastIndexOf("/")+1,u.indexOf("Safari")))):(c=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),c.exec(u)!==null&&(n.Browser.vendor=n.BROWSERS.IE,n.Browser.version=parseFloat(RegExp.$1))));break;case"Opera":n.Browser.vendor=n.BROWSERS.OPERA,n.Browser.version=parseFloat(l);break}var d=window.location.search.substring(1),f=d.split("&"),h,p,m;for(m=0;m<f.length;m++)if(h=f[m],p=h.indexOf("="),p>0){var y=h.substring(0,p),g=h.substring(p+1);try{o[y]=decodeURIComponent(g)}catch{n.console.error("Ignoring malformed URL parameter: %s=%s",y,g)}}n.Browser.alpha=!(n.Browser.vendor===n.BROWSERS.CHROME&&n.Browser.version<2),n.Browser.opacity=!0,n.Browser.vendor===n.BROWSERS.IE&&n.Browser.version<11&&n.console.error("Internet Explorer versions < 11 are not supported by OpenSeadragon")})(),function(l){var u=l.requestAnimationFrame||l.mozRequestAnimationFrame||l.webkitRequestAnimationFrame||l.msRequestAnimationFrame,c=l.cancelAnimationFrame||l.mozCancelAnimationFrame||l.webkitCancelAnimationFrame||l.msCancelAnimationFrame;if(u&&c)n.requestAnimationFrame=function(){return u.apply(l,arguments)},n.cancelAnimationFrame=function(){return c.apply(l,arguments)};else{var d=[],f=[],h=0,p;n.requestAnimationFrame=function(m){return d.push([++h,m]),p||(p=setInterval(function(){if(d.length){var y=n.now(),g=f;for(f=d,d=g;f.length;)f.shift()[1](y)}else clearInterval(p),p=void 0},1e3/50)),h},n.cancelAnimationFrame=function(m){var y,g;for(y=0,g=d.length;y<g;y+=1)if(d[y][0]===m){d.splice(y,1);return}for(y=0,g=f.length;y<g;y+=1)if(f[y][0]===m){f.splice(y,1);return}}}}(window);function a(l,u){return u&&l!==document.body?document.body:l.offsetParent}}(e),function(n,i){t.exports?t.exports=i():n.OpenSeadragon=i()}(qe,function(){return e}),function(n){var i={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.fullscreenElement},i.requestFullScreen=function(r){return r.requestFullscreen()},i.exitFullScreen=function(){document.exitFullscreen()},i.fullScreenEventName="fullscreenchange",i.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.msFullscreenElement},i.requestFullScreen=function(r){return r.msRequestFullscreen()},i.exitFullScreen=function(){document.msExitFullscreen()},i.fullScreenEventName="MSFullscreenChange",i.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.webkitFullscreenElement},i.requestFullScreen=function(r){return r.webkitRequestFullscreen()},i.exitFullScreen=function(){document.webkitExitFullscreen()},i.fullScreenEventName="webkitfullscreenchange",i.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},i.requestFullScreen=function(r){return r.webkitRequestFullScreen()},i.exitFullScreen=function(){document.webkitCancelFullScreen()},i.fullScreenEventName="webkitfullscreenchange",i.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.mozFullScreenElement},i.requestFullScreen=function(r){return r.mozRequestFullScreen()},i.exitFullScreen=function(){document.mozCancelFullScreen()},i.fullScreenEventName="mozfullscreenchange",i.fullScreenErrorEventName="mozfullscreenerror"),i.isFullScreen=function(){return i.getFullScreenElement()!==null},i.cancelFullScreen=function(){n.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),i.exitFullScreen()},n.extend(n,i)}(e),function(n){n.EventSource=function(){this.events={}},n.EventSource.prototype={addOnceHandler:function(i,r,s,o,a){var l=this;o=o||1;var u=0,c=function(d){return u++,u===o&&l.removeHandler(i,c),r(d)};this.addHandler(i,c,s,a)},addHandler:function(i,r,s,o){var a=this.events[i];if(a||(this.events[i]=a=[]),r&&n.isFunction(r)){var l=a.length,u={handler:r,userData:s||null,priority:o||0};for(a[l]=u;l>0&&a[l-1].priority<a[l].priority;)a[l]=a[l-1],a[l-1]=u,l--}},removeHandler:function(i,r){var s=this.events[i],o=[],a;if(s&&n.isArray(s)){for(a=0;a<s.length;a++)s[a].handler!==r&&o.push(s[a]);this.events[i]=o}},numberOfHandlers:function(i){var r=this.events[i];return r?r.length:0},removeAllHandlers:function(i){if(i)this.events[i]=[];else for(var r in this.events)this.events[r]=[]},getHandler:function(i){var r=this.events[i];return!r||!r.length?null:(r=r.length===1?[r[0]]:Array.apply(null,r),function(s,o){var a,l=r.length;for(a=0;a<l;a++)r[a]&&(o.eventSource=s,o.userData=r[a].userData,r[a].handler(o))})},raiseEvent:function(i,r){var s=this.getHandler(i);if(s)return s(this,r||{})}}}(e),function(n){var i={};n.MouseTracker=function(R){var I=arguments;n.isPlainObject(R)||(R={element:I[0],clickTimeThreshold:I[1],clickDistThreshold:I[2]}),this.hash=Math.random(),this.element=n.getElement(R.element),this.clickTimeThreshold=R.clickTimeThreshold||n.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=R.clickDistThreshold||n.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=R.dblClickTimeThreshold||n.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=R.dblClickDistThreshold||n.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=R.userData||null,this.stopDelay=R.stopDelay||50,this.preProcessEventHandler=R.preProcessEventHandler||null,this.contextMenuHandler=R.contextMenuHandler||null,this.enterHandler=R.enterHandler||null,this.leaveHandler=R.leaveHandler||null,this.exitHandler=R.exitHandler||null,this.overHandler=R.overHandler||null,this.outHandler=R.outHandler||null,this.pressHandler=R.pressHandler||null,this.nonPrimaryPressHandler=R.nonPrimaryPressHandler||null,this.releaseHandler=R.releaseHandler||null,this.nonPrimaryReleaseHandler=R.nonPrimaryReleaseHandler||null,this.moveHandler=R.moveHandler||null,this.scrollHandler=R.scrollHandler||null,this.clickHandler=R.clickHandler||null,this.dblClickHandler=R.dblClickHandler||null,this.dragHandler=R.dragHandler||null,this.dragEndHandler=R.dragEndHandler||null,this.pinchHandler=R.pinchHandler||null,this.stopHandler=R.stopHandler||null,this.keyDownHandler=R.keyDownHandler||null,this.keyUpHandler=R.keyUpHandler||null,this.keyHandler=R.keyHandler||null,this.focusHandler=R.focusHandler||null,this.blurHandler=R.blurHandler||null;var F=this;i[this.hash]={click:function(z){b(F,z)},dblclick:function(z){T(F,z)},keydown:function(z){S(F,z)},keyup:function(z){_(F,z)},keypress:function(z){A(F,z)},focus:function(z){P(F,z)},blur:function(z){O(F,z)},contextmenu:function(z){x(F,z)},wheel:function(z){L(F,z)},mousewheel:function(z){M(F,z)},DOMMouseScroll:function(z){M(F,z)},MozMousePixelScroll:function(z){M(F,z)},losecapture:function(z){K(F,z)},mouseenter:function(z){N(F,z)},mouseleave:function(z){le(F,z)},mouseover:function(z){we(F,z)},mouseout:function(z){ce(F,z)},mousedown:function(z){re(F,z)},mouseup:function(z){Ae(F,z)},mousemove:function(z){Me(F,z)},touchstart:function(z){U(F,z)},touchend:function(z){j(F,z)},touchmove:function(z){G(F,z)},touchcancel:function(z){H(F,z)},gesturestart:function(z){Y(F,z)},gesturechange:function(z){D(F,z)},gotpointercapture:function(z){ee(F,z)},lostpointercapture:function(z){ne(F,z)},pointerenter:function(z){N(F,z)},pointerleave:function(z){le(F,z)},pointerover:function(z){we(F,z)},pointerout:function(z){ce(F,z)},pointerdown:function(z){re(F,z)},pointerup:function(z){Ae(F,z)},pointermove:function(z){Me(F,z)},pointercancel:function(z){wt(F,z)},pointerupcaptured:function(z){$e(F,z)},pointermovecaptured:function(z){Ne(F,z)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null,sentDragEvent:!1},this.hasGestureHandlers=!!(this.pressHandler||this.nonPrimaryPressHandler||this.releaseHandler||this.nonPrimaryReleaseHandler||this.clickHandler||this.dblClickHandler||this.dragHandler||this.dragEndHandler||this.pinchHandler),this.hasScrollHandler=!!this.scrollHandler,n.MouseTracker.havePointerEvents&&n.setElementPointerEvents(this.element,"auto"),this.exitHandler&&n.console.error("MouseTracker.exitHandler is deprecated. Use MouseTracker.leaveHandler instead."),R.startDisabled||this.setTracking(!0)},n.MouseTracker.prototype={destroy:function(){l(this),this.element=null,i[this.hash]=null,delete i[this.hash]},isTracking:function(){return i[this.hash].tracking},setTracking:function(R){return R?a(this):l(this),this},getActivePointersListByType:function(R){var I=i[this.hash],F,z=I.activePointersLists.length,ie;for(F=0;F<z;F++)if(I.activePointersLists[F].type===R)return I.activePointersLists[F];return ie=new n.MouseTracker.GesturePointList(R),I.activePointersLists.push(ie),ie},getActivePointerCount:function(){var R=i[this.hash],I,F=R.activePointersLists.length,z=0;for(I=0;I<F;I++)z+=R.activePointersLists[I].getLength();return z},preProcessEventHandler:function(){},contextMenuHandler:function(){},enterHandler:function(){},leaveHandler:function(){},exitHandler:function(){},overHandler:function(){},outHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}};var r=function(){try{return window.self!==window.top}catch{return!0}}();function s(R){try{return R.addEventListener&&R.removeEventListener}catch{return!1}}n.MouseTracker.gesturePointVelocityTracker=function(){var R=[],I=0,F=0,z=function(Ze,je){return Ze.hash.toString()+je.type+je.id.toString()},ie=function(){var Ze,je=R.length,Yt,Tn,lu=n.now(),l8,u8,c8;for(l8=lu-F,F=lu,Ze=0;Ze<je;Ze++)Yt=R[Ze],Tn=Yt.gPoint,Tn.direction=Math.atan2(Tn.currentPos.y-Yt.lastPos.y,Tn.currentPos.x-Yt.lastPos.x),u8=Yt.lastPos.distanceTo(Tn.currentPos),Yt.lastPos=Tn.currentPos,c8=1e3*u8/(l8+1),Tn.speed=.75*c8+.25*Tn.speed},pe=function(Ze,je){var Yt=z(Ze,je);R.push({guid:Yt,gPoint:je,lastPos:je.currentPos}),R.length===1&&(F=n.now(),I=window.setInterval(ie,50))},Ve=function(Ze,je){var Yt=z(Ze,je),Tn,lu=R.length;for(Tn=0;Tn<lu;Tn++)if(R[Tn].guid===Yt){R.splice(Tn,1),lu--,lu===0&&window.clearInterval(I);break}};return{addPoint:pe,removePoint:Ve}}(),n.MouseTracker.captureElement=document,n.MouseTracker.wheelEventName=n.Browser.vendor===n.BROWSERS.IE&&n.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll",n.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur","contextmenu",n.MouseTracker.wheelEventName],n.MouseTracker.wheelEventName==="DOMMouseScroll"&&n.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent?(n.MouseTracker.havePointerEvents=!0,n.MouseTracker.subscribeEvents.push("pointerenter","pointerleave","pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),n.MouseTracker.havePointerCapture=function(){var R=document.createElement("div");return n.isFunction(R.setPointerCapture)&&n.isFunction(R.releasePointerCapture)}(),n.MouseTracker.havePointerCapture&&n.MouseTracker.subscribeEvents.push("gotpointercapture","lostpointercapture")):(n.MouseTracker.havePointerEvents=!1,n.MouseTracker.subscribeEvents.push("mouseenter","mouseleave","mouseover","mouseout","mousedown","mouseup","mousemove"),n.MouseTracker.mousePointerId="legacy-mouse",n.MouseTracker.havePointerCapture=function(){var R=document.createElement("div");return n.isFunction(R.setCapture)&&n.isFunction(R.releaseCapture)}(),n.MouseTracker.havePointerCapture&&n.MouseTracker.subscribeEvents.push("losecapture"),"ontouchstart"in window&&n.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&n.MouseTracker.subscribeEvents.push("gesturestart","gesturechange")),n.MouseTracker.GesturePointList=function(R){this._gPoints=[],this.type=R,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},n.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(R){return this._gPoints.push(R)},removeById:function(R){var I,F=this._gPoints.length;for(I=0;I<F;I++)if(this._gPoints[I].id===R){this._gPoints.splice(I,1);break}return this._gPoints.length},getByIndex:function(R){return R<this._gPoints.length?this._gPoints[R]:null},getById:function(R){var I,F=this._gPoints.length;for(I=0;I<F;I++)if(this._gPoints[I].id===R)return this._gPoints[I];return null},getPrimary:function(R){var I,F=this._gPoints.length;for(I=0;I<F;I++)if(this._gPoints[I].isPrimary)return this._gPoints[I];return null},addContact:function(){++this.contacts,this.contacts>1&&(this.type==="mouse"||this.type==="pen")&&(n.console.warn("GesturePointList.addContact() Implausible contacts value"),this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};function o(R){var I=i[R.hash],F,z,ie,pe,Ve,Ze=I.activePointersLists.length;for(F=0;F<Ze;F++)if(ie=I.activePointersLists[F],ie.getLength()>0){for(Ve=[],pe=ie.asArray(),z=0;z<pe.length;z++)Ve.push(pe[z]);for(z=0;z<Ve.length;z++)We(R,ie,Ve[z])}for(F=0;F<Ze;F++)I.activePointersLists.pop();I.sentDragEvent=!1}function a(R){var I=i[R.hash],F,z;if(!I.tracking){for(z=0;z<n.MouseTracker.subscribeEvents.length;z++)F=n.MouseTracker.subscribeEvents[z],n.addEvent(R.element,F,I[F],F===n.MouseTracker.wheelEventName?{passive:!1,capture:!1}:!1);o(R),I.tracking=!0}}function l(R){var I=i[R.hash],F,z;if(I.tracking){for(z=0;z<n.MouseTracker.subscribeEvents.length;z++)F=n.MouseTracker.subscribeEvents[z],n.removeEvent(R.element,F,I[F],!1);o(R),I.tracking=!1}}function u(R,I){var F=i[R.hash];if(I==="pointerevent")return{upName:"pointerup",upHandler:F.pointerupcaptured,moveName:"pointermove",moveHandler:F.pointermovecaptured};if(I==="mouse")return{upName:"pointerup",upHandler:F.pointerupcaptured,moveName:"pointermove",moveHandler:F.pointermovecaptured};if(I==="touch")return{upName:"touchend",upHandler:F.touchendcaptured,moveName:"touchmove",moveHandler:F.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function c(R,I){var F;if(n.MouseTracker.havePointerCapture)if(n.MouseTracker.havePointerEvents)try{R.element.setPointerCapture(I.id)}catch{n.console.warn("setPointerCapture() called on invalid pointer ID");return}else R.element.setCapture(!0);else F=u(R,n.MouseTracker.havePointerEvents?"pointerevent":I.type),r&&s(window.top)&&n.addEvent(window.top,F.upName,F.upHandler,!0),n.addEvent(n.MouseTracker.captureElement,F.upName,F.upHandler,!0),n.addEvent(n.MouseTracker.captureElement,F.moveName,F.moveHandler,!0);Z(R,I,!0)}function d(R,I){var F,z,ie;if(n.MouseTracker.havePointerCapture)if(n.MouseTracker.havePointerEvents){if(z=R.getActivePointersListByType(I.type),ie=z.getById(I.id),!ie||!ie.captured)return;try{R.element.releasePointerCapture(I.id)}catch{}}else R.element.releaseCapture();else F=u(R,n.MouseTracker.havePointerEvents?"pointerevent":I.type),r&&s(window.top)&&n.removeEvent(window.top,F.upName,F.upHandler,!0),n.removeEvent(n.MouseTracker.captureElement,F.moveName,F.moveHandler,!0),n.removeEvent(n.MouseTracker.captureElement,F.upName,F.upHandler,!0);Z(R,I,!1)}function f(R){return n.MouseTracker.havePointerEvents?R.pointerId:n.MouseTracker.mousePointerId}function h(R){return n.MouseTracker.havePointerEvents?R.pointerType||(n.Browser.vendor===n.BROWSERS.IE?"mouse":""):"mouse"}function p(R){return n.MouseTracker.havePointerEvents?R.isPrimary:!0}function m(R){return n.getMousePosition(R)}function y(R,I){return g(m(R),I)}function g(R,I){var F=n.getElementOffset(I);return R.minus(F)}function v(R,I){return new n.Point((R.x+I.x)/2,(R.y+I.y)/2)}function b(R,I){var F={originalEvent:I,eventType:"click",pointerType:"mouse",isEmulated:!1};B(R,F),F.preventDefault&&!F.defaultPrevented&&n.cancelEvent(I),F.stopPropagation&&n.stopEvent(I)}function T(R,I){var F={originalEvent:I,eventType:"dblclick",pointerType:"mouse",isEmulated:!1};B(R,F),F.preventDefault&&!F.defaultPrevented&&n.cancelEvent(I),F.stopPropagation&&n.stopEvent(I)}function S(R,I){var F=null,z={originalEvent:I,eventType:"keydown",pointerType:"",isEmulated:!1};B(R,z),R.keyDownHandler&&!z.preventGesture&&!z.defaultPrevented&&(F={eventSource:R,keyCode:I.keyCode?I.keyCode:I.charCode,ctrl:I.ctrlKey,shift:I.shiftKey,alt:I.altKey,meta:I.metaKey,originalEvent:I,preventDefault:z.preventDefault||z.defaultPrevented,userData:R.userData},R.keyDownHandler(F)),(F&&F.preventDefault||z.preventDefault&&!z.defaultPrevented)&&n.cancelEvent(I),z.stopPropagation&&n.stopEvent(I)}function _(R,I){var F=null,z={originalEvent:I,eventType:"keyup",pointerType:"",isEmulated:!1};B(R,z),R.keyUpHandler&&!z.preventGesture&&!z.defaultPrevented&&(F={eventSource:R,keyCode:I.keyCode?I.keyCode:I.charCode,ctrl:I.ctrlKey,shift:I.shiftKey,alt:I.altKey,meta:I.metaKey,originalEvent:I,preventDefault:z.preventDefault||z.defaultPrevented,userData:R.userData},R.keyUpHandler(F)),(F&&F.preventDefault||z.preventDefault&&!z.defaultPrevented)&&n.cancelEvent(I),z.stopPropagation&&n.stopEvent(I)}function A(R,I){var F=null,z={originalEvent:I,eventType:"keypress",pointerType:"",isEmulated:!1};B(R,z),R.keyHandler&&!z.preventGesture&&!z.defaultPrevented&&(F={eventSource:R,keyCode:I.keyCode?I.keyCode:I.charCode,ctrl:I.ctrlKey,shift:I.shiftKey,alt:I.altKey,meta:I.metaKey,originalEvent:I,preventDefault:z.preventDefault||z.defaultPrevented,userData:R.userData},R.keyHandler(F)),(F&&F.preventDefault||z.preventDefault&&!z.defaultPrevented)&&n.cancelEvent(I),z.stopPropagation&&n.stopEvent(I)}function P(R,I){var F={originalEvent:I,eventType:"focus",pointerType:"",isEmulated:!1};B(R,F),R.focusHandler&&!F.preventGesture&&R.focusHandler({eventSource:R,originalEvent:I,userData:R.userData})}function O(R,I){var F={originalEvent:I,eventType:"blur",pointerType:"",isEmulated:!1};B(R,F),R.blurHandler&&!F.preventGesture&&R.blurHandler({eventSource:R,originalEvent:I,userData:R.userData})}function x(R,I){var F=null,z={originalEvent:I,eventType:"contextmenu",pointerType:"mouse",isEmulated:!1};B(R,z),R.contextMenuHandler&&!z.preventGesture&&!z.defaultPrevented&&(F={eventSource:R,position:g(m(I),R.element),originalEvent:z.originalEvent,preventDefault:z.preventDefault||z.defaultPrevented,userData:R.userData},R.contextMenuHandler(F)),(F&&F.preventDefault||z.preventDefault&&!z.defaultPrevented)&&n.cancelEvent(I),z.stopPropagation&&n.stopEvent(I)}function L(R,I){V(R,I,I)}function M(R,I){var F={target:I.target||I.srcElement,type:"wheel",shiftKey:I.shiftKey||!1,clientX:I.clientX,clientY:I.clientY,pageX:I.pageX?I.pageX:I.clientX,pageY:I.pageY?I.pageY:I.clientY,deltaMode:I.type==="MozMousePixelScroll"?0:1,deltaX:0,deltaZ:0};n.MouseTracker.wheelEventName==="mousewheel"?F.deltaY=-I.wheelDelta/n.DEFAULT_SETTINGS.pixelsPerWheelLine:F.deltaY=I.detail,V(R,F,I)}function V(R,I,F){var z=0,ie,pe=null;z=I.deltaY<0?1:-1,ie={originalEvent:I,eventType:"wheel",pointerType:"mouse",isEmulated:I!==F},B(R,ie),R.scrollHandler&&!ie.preventGesture&&!ie.defaultPrevented&&(pe={eventSource:R,pointerType:"mouse",position:y(I,R.element),scroll:z,shift:I.shiftKey,isTouchEvent:!1,originalEvent:F,preventDefault:ie.preventDefault||ie.defaultPrevented,userData:R.userData},R.scrollHandler(pe)),ie.stopPropagation&&n.stopEvent(F),(pe&&pe.preventDefault||ie.preventDefault&&!ie.defaultPrevented)&&n.cancelEvent(F)}function K(R,I){var F={id:n.MouseTracker.mousePointerId,type:"mouse"},z={originalEvent:I,eventType:"lostpointercapture",pointerType:"mouse",isEmulated:!1};B(R,z),I.target===R.element&&Z(R,F,!1),z.stopPropagation&&n.stopEvent(I)}function U(R,I){var F,z,ie=I.changedTouches.length,pe,Ve=R.getActivePointersListByType("touch");F=n.now(),Ve.getLength()>I.touches.length-ie&&n.console.warn("Tracked touch contact count doesn't match event.touches.length");var Ze={originalEvent:I,eventType:"pointerdown",pointerType:"touch",isEmulated:!1};for(B(R,Ze),z=0;z<ie;z++)pe={id:I.changedTouches[z].identifier,type:"touch",isPrimary:Ve.getLength()===0,currentPos:m(I.changedTouches[z]),currentTime:F},fe(R,Ze,pe),ht(R,Ze,pe,0),Z(R,pe,!0);Ze.preventDefault&&!Ze.defaultPrevented&&n.cancelEvent(I),Ze.stopPropagation&&n.stopEvent(I)}function j(R,I){var F,z,ie=I.changedTouches.length,pe;F=n.now();var Ve={originalEvent:I,eventType:"pointerup",pointerType:"touch",isEmulated:!1};for(B(R,Ve),z=0;z<ie;z++)pe={id:I.changedTouches[z].identifier,type:"touch",currentPos:m(I.changedTouches[z]),currentTime:F},mt(R,Ve,pe,0),Z(R,pe,!1),de(R,Ve,pe);Ve.preventDefault&&!Ve.defaultPrevented&&n.cancelEvent(I),Ve.stopPropagation&&n.stopEvent(I)}function G(R,I){var F,z,ie=I.changedTouches.length,pe;F=n.now();var Ve={originalEvent:I,eventType:"pointermove",pointerType:"touch",isEmulated:!1};for(B(R,Ve),z=0;z<ie;z++)pe={id:I.changedTouches[z].identifier,type:"touch",currentPos:m(I.changedTouches[z]),currentTime:F},te(R,Ve,pe);Ve.preventDefault&&!Ve.defaultPrevented&&n.cancelEvent(I),Ve.stopPropagation&&n.stopEvent(I)}function H(R,I){var F=I.changedTouches.length,z,ie,pe={originalEvent:I,eventType:"pointercancel",pointerType:"touch",isEmulated:!1};for(B(R,pe),z=0;z<F;z++)ie={id:I.changedTouches[z].identifier,type:"touch"},oe(R,pe,ie);pe.stopPropagation&&n.stopEvent(I)}function Y(R,I){return n.eventIsCanceled(I)||I.preventDefault(),!1}function D(R,I){return n.eventIsCanceled(I)||I.preventDefault(),!1}function ee(R,I){var F={originalEvent:I,eventType:"gotpointercapture",pointerType:h(I),isEmulated:!1};B(R,F),I.target===R.element&&Z(R,{id:I.pointerId,type:h(I)},!0),F.stopPropagation&&n.stopEvent(I)}function ne(R,I){var F={originalEvent:I,eventType:"lostpointercapture",pointerType:h(I),isEmulated:!1};B(R,F),I.target===R.element&&Z(R,{id:I.pointerId,type:h(I)},!1),F.stopPropagation&&n.stopEvent(I)}function N(R,I){var F={id:f(I),type:h(I),isPrimary:p(I),currentPos:m(I),currentTime:n.now()},z={originalEvent:I,eventType:"pointerenter",pointerType:F.type,isEmulated:!1};B(R,z),fe(R,z,F)}function le(R,I){var F={id:f(I),type:h(I),isPrimary:p(I),currentPos:m(I),currentTime:n.now()},z={originalEvent:I,eventType:"pointerleave",pointerType:F.type,isEmulated:!1};B(R,z),de(R,z,F)}function we(R,I){var F={id:f(I),type:h(I),isPrimary:p(I),currentPos:m(I),currentTime:n.now()},z={originalEvent:I,eventType:"pointerover",pointerType:F.type,isEmulated:!1};B(R,z),Fe(R,z,F),z.preventDefault&&!z.defaultPrevented&&n.cancelEvent(I),z.stopPropagation&&n.stopEvent(I)}function ce(R,I){var F={id:f(I),type:h(I),isPrimary:p(I),currentPos:m(I),currentTime:n.now()},z={originalEvent:I,eventType:"pointerout",pointerType:F.type,isEmulated:!1};B(R,z),_e(R,z,F),z.preventDefault&&!z.defaultPrevented&&n.cancelEvent(I),z.stopPropagation&&n.stopEvent(I)}function re(R,I){var F={id:f(I),type:h(I),isPrimary:p(I),currentPos:m(I),currentTime:n.now()},z=n.MouseTracker.havePointerEvents&&F.type==="touch"&&n.Browser.vendor!==n.BROWSERS.IE,ie={originalEvent:I,eventType:"pointerdown",pointerType:F.type,isEmulated:!1};B(R,ie),ht(R,ie,F,I.button),ie.preventDefault&&!ie.defaultPrevented&&n.cancelEvent(I),ie.stopPropagation&&n.stopEvent(I),ie.shouldCapture&&(z?Z(R,F,!0):c(R,F))}function Ae(R,I){Ie(R,I)}function $e(R,I){var F=R.getActivePointersListByType(h(I));F.getById(I.pointerId)&&Ie(R,I),n.stopEvent(I)}function Ie(R,I){var F;F={id:f(I),type:h(I),isPrimary:p(I),currentPos:m(I),currentTime:n.now()};var z={originalEvent:I,eventType:"pointerup",pointerType:F.type,isEmulated:!1};B(R,z),mt(R,z,F,I.button),z.preventDefault&&!z.defaultPrevented&&n.cancelEvent(I),z.stopPropagation&&n.stopEvent(I),z.shouldReleaseCapture&&(I.target===R.element?d(R,F):Z(R,F,!1))}function Me(R,I){at(R,I)}function Ne(R,I){var F=R.getActivePointersListByType(h(I));F.getById(I.pointerId)&&at(R,I),n.stopEvent(I)}function at(R,I){var F={id:f(I),type:h(I),isPrimary:p(I),currentPos:m(I),currentTime:n.now()},z={originalEvent:I,eventType:"pointermove",pointerType:F.type,isEmulated:!1};B(R,z),te(R,z,F),z.preventDefault&&!z.defaultPrevented&&n.cancelEvent(I),z.stopPropagation&&n.stopEvent(I)}function wt(R,I){var F={id:I.pointerId,type:h(I)},z={originalEvent:I,eventType:"pointercancel",pointerType:F.type,isEmulated:!1};B(R,z),oe(R,z,F),z.stopPropagation&&n.stopEvent(I)}function Bt(R,I){return I.speed=0,I.direction=0,I.contactPos=I.currentPos,I.contactTime=I.currentTime,I.lastPos=I.currentPos,I.lastTime=I.currentTime,R.add(I)}function We(R,I,F){var z,ie=I.getById(F.id);return ie?(ie.captured&&(n.console.warn("stopTrackingPointer() called on captured pointer"),d(R,ie)),I.removeContact(),z=I.removeById(F.id)):z=I.getLength(),z}function w(R,I){switch(I.eventType){case"pointermove":I.isStoppable=!0,I.isCancelable=!0,I.preventDefault=!1,I.preventGesture=!R.hasGestureHandlers,I.stopPropagation=!1;break;case"pointerover":case"pointerout":case"contextmenu":case"keydown":case"keyup":case"keypress":I.isStoppable=!0,I.isCancelable=!0,I.preventDefault=!1,I.preventGesture=!1,I.stopPropagation=!1;break;case"pointerdown":I.isStoppable=!0,I.isCancelable=!0,I.preventDefault=!1,I.preventGesture=!R.hasGestureHandlers,I.stopPropagation=!1;break;case"pointerup":I.isStoppable=!0,I.isCancelable=!0,I.preventDefault=!1,I.preventGesture=!R.hasGestureHandlers,I.stopPropagation=!1;break;case"wheel":I.isStoppable=!0,I.isCancelable=!0,I.preventDefault=!1,I.preventGesture=!R.hasScrollHandler,I.stopPropagation=!1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":I.isStoppable=!0,I.isCancelable=!1,I.preventDefault=!1,I.preventGesture=!1,I.stopPropagation=!1;break;case"click":I.isStoppable=!0,I.isCancelable=!0,I.preventDefault=!!R.clickHandler,I.preventGesture=!1,I.stopPropagation=!1;break;case"dblclick":I.isStoppable=!0,I.isCancelable=!0,I.preventDefault=!!R.dblClickHandler,I.preventGesture=!1,I.stopPropagation=!1;break;case"focus":case"blur":case"pointerenter":case"pointerleave":default:I.isStoppable=!1,I.isCancelable=!1,I.preventDefault=!1,I.preventGesture=!1,I.stopPropagation=!1;break}}function B(R,I){I.eventSource=R,I.eventPhase=I.originalEvent&&typeof I.originalEvent.eventPhase<"u"?I.originalEvent.eventPhase:0,I.defaultPrevented=n.eventIsCanceled(I.originalEvent),I.shouldCapture=!1,I.shouldReleaseCapture=!1,I.userData=R.userData,w(R,I),R.preProcessEventHandler&&R.preProcessEventHandler(I)}function Z(R,I,F){var z=R.getActivePointersListByType(I.type),ie=z.getById(I.id);ie?F&&!ie.captured?(ie.captured=!0,z.captureCount++):!F&&ie.captured&&(ie.captured=!1,z.captureCount--,z.captureCount<0&&(z.captureCount=0,n.console.warn("updatePointerCaptured() - pointsList.captureCount went negative"))):n.console.warn("updatePointerCaptured() called on untracked pointer")}function fe(R,I,F){var z=R.getActivePointersListByType(F.type),ie;ie=z.getById(F.id),ie?(ie.insideElement=!0,ie.lastPos=ie.currentPos,ie.lastTime=ie.currentTime,ie.currentPos=F.currentPos,ie.currentTime=F.currentTime,F=ie):(F.captured=!1,F.insideElementPressed=!1,F.insideElement=!0,Bt(z,F)),R.enterHandler&&R.enterHandler({eventSource:R,pointerType:F.type,position:g(F.currentPos,R.element),buttons:z.buttons,pointers:R.getActivePointerCount(),insideElementPressed:F.insideElementPressed,buttonDownAny:z.buttons!==0,isTouchEvent:F.type==="touch",originalEvent:I.originalEvent,userData:R.userData})}function de(R,I,F){var z=R.getActivePointersListByType(F.type),ie,pe;ie=z.getById(F.id),ie?(ie.captured?(ie.insideElement=!1,ie.lastPos=ie.currentPos,ie.lastTime=ie.currentTime,ie.currentPos=F.currentPos,ie.currentTime=F.currentTime):We(R,z,ie),F=ie):(F.captured=!1,F.insideElementPressed=!1),(R.leaveHandler||R.exitHandler)&&(pe={eventSource:R,pointerType:F.type,position:F.currentPos&&g(F.currentPos,R.element),buttons:z.buttons,pointers:R.getActivePointerCount(),insideElementPressed:F.insideElementPressed,buttonDownAny:z.buttons!==0,isTouchEvent:F.type==="touch",originalEvent:I.originalEvent,userData:R.userData},R.leaveHandler&&R.leaveHandler(pe),R.exitHandler&&R.exitHandler(pe))}function Fe(R,I,F){var z,ie;z=R.getActivePointersListByType(F.type),ie=z.getById(F.id),ie?F=ie:(F.captured=!1,F.insideElementPressed=!1),R.overHandler&&R.overHandler({eventSource:R,pointerType:F.type,position:g(F.currentPos,R.element),buttons:z.buttons,pointers:R.getActivePointerCount(),insideElementPressed:F.insideElementPressed,buttonDownAny:z.buttons!==0,isTouchEvent:F.type==="touch",originalEvent:I.originalEvent,userData:R.userData})}function _e(R,I,F){var z,ie;z=R.getActivePointersListByType(F.type),ie=z.getById(F.id),ie?F=ie:(F.captured=!1,F.insideElementPressed=!1),R.outHandler&&R.outHandler({eventSource:R,pointerType:F.type,position:F.currentPos&&g(F.currentPos,R.element),buttons:z.buttons,pointers:R.getActivePointerCount(),insideElementPressed:F.insideElementPressed,buttonDownAny:z.buttons!==0,isTouchEvent:F.type==="touch",originalEvent:I.originalEvent,userData:R.userData})}function ht(R,I,F,z){var ie=i[R.hash],pe=R.getActivePointersListByType(F.type),Ve;if(typeof I.originalEvent.buttons<"u"?pe.buttons=I.originalEvent.buttons:z===0?pe.buttons|=1:z===1?pe.buttons|=4:z===2?pe.buttons|=2:z===3?pe.buttons|=8:z===4?pe.buttons|=16:z===5&&(pe.buttons|=32),z!==0){I.shouldCapture=!1,I.shouldReleaseCapture=!1,R.nonPrimaryPressHandler&&!I.preventGesture&&!I.defaultPrevented&&(I.preventDefault=!0,R.nonPrimaryPressHandler({eventSource:R,pointerType:F.type,position:g(F.currentPos,R.element),button:z,buttons:pe.buttons,isTouchEvent:F.type==="touch",originalEvent:I.originalEvent,userData:R.userData}));return}Ve=pe.getById(F.id),Ve?(Ve.insideElementPressed=!0,Ve.insideElement=!0,Ve.originalTarget=I.originalEvent.target,Ve.contactPos=F.currentPos,Ve.contactTime=F.currentTime,Ve.lastPos=Ve.currentPos,Ve.lastTime=Ve.currentTime,Ve.currentPos=F.currentPos,Ve.currentTime=F.currentTime,F=Ve):(F.captured=!1,F.insideElementPressed=!0,F.insideElement=!0,F.originalTarget=I.originalEvent.target,Bt(pe,F)),pe.addContact(),!I.preventGesture&&!I.defaultPrevented?(I.shouldCapture=!0,I.shouldReleaseCapture=!1,I.preventDefault=!0,(R.dragHandler||R.dragEndHandler||R.pinchHandler)&&n.MouseTracker.gesturePointVelocityTracker.addPoint(R,F),pe.contacts===1?R.pressHandler&&!I.preventGesture&&R.pressHandler({eventSource:R,pointerType:F.type,position:g(F.contactPos,R.element),buttons:pe.buttons,isTouchEvent:F.type==="touch",originalEvent:I.originalEvent,userData:R.userData}):pe.contacts===2&&R.pinchHandler&&F.type==="touch"&&(ie.pinchGPoints=pe.asArray(),ie.lastPinchDist=ie.currentPinchDist=ie.pinchGPoints[0].currentPos.distanceTo(ie.pinchGPoints[1].currentPos),ie.lastPinchCenter=ie.currentPinchCenter=v(ie.pinchGPoints[0].currentPos,ie.pinchGPoints[1].currentPos))):(I.shouldCapture=!1,I.shouldReleaseCapture=!1)}function mt(R,I,F,z){var ie=i[R.hash],pe=R.getActivePointersListByType(F.type),Ve,Ze,je,Yt=!1,Tn;if(typeof I.originalEvent.buttons<"u"?pe.buttons=I.originalEvent.buttons:z===0?pe.buttons^=-2:z===1?pe.buttons^=-5:z===2?pe.buttons^=-3:z===3?pe.buttons^=-9:z===4?pe.buttons^=-17:z===5&&(pe.buttons^=-33),I.shouldCapture=!1,z!==0){I.shouldReleaseCapture=!1,R.nonPrimaryReleaseHandler&&!I.preventGesture&&!I.defaultPrevented&&(I.preventDefault=!0,R.nonPrimaryReleaseHandler({eventSource:R,pointerType:F.type,position:g(F.currentPos,R.element),button:z,buttons:pe.buttons,isTouchEvent:F.type==="touch",originalEvent:I.originalEvent,userData:R.userData}));return}je=pe.getById(F.id),je?(pe.removeContact(),je.captured&&(Yt=!0),je.lastPos=je.currentPos,je.lastTime=je.currentTime,je.currentPos=F.currentPos,je.currentTime=F.currentTime,je.insideElement||We(R,pe,je),Ve=je.currentPos,Ze=je.currentTime):(F.captured=!1,F.insideElementPressed=!1,F.insideElement=!0,Bt(pe,F),je=F),!I.preventGesture&&!I.defaultPrevented&&(Yt?(I.shouldReleaseCapture=!0,I.preventDefault=!0,(R.dragHandler||R.dragEndHandler||R.pinchHandler)&&n.MouseTracker.gesturePointVelocityTracker.removePoint(R,je),pe.contacts===0?(R.releaseHandler&&Ve&&R.releaseHandler({eventSource:R,pointerType:je.type,position:g(Ve,R.element),buttons:pe.buttons,insideElementPressed:je.insideElementPressed,insideElementReleased:je.insideElement,isTouchEvent:je.type==="touch",originalEvent:I.originalEvent,userData:R.userData}),R.dragEndHandler&&ie.sentDragEvent&&R.dragEndHandler({eventSource:R,pointerType:je.type,position:g(je.currentPos,R.element),speed:je.speed,direction:je.direction,shift:I.originalEvent.shiftKey,isTouchEvent:je.type==="touch",originalEvent:I.originalEvent,userData:R.userData}),ie.sentDragEvent=!1,(R.clickHandler||R.dblClickHandler)&&je.insideElement&&(Tn=Ze-je.contactTime<=R.clickTimeThreshold&&je.contactPos.distanceTo(Ve)<=R.clickDistThreshold,R.clickHandler&&R.clickHandler({eventSource:R,pointerType:je.type,position:g(je.currentPos,R.element),quick:Tn,shift:I.originalEvent.shiftKey,isTouchEvent:je.type==="touch",originalEvent:I.originalEvent,originalTarget:je.originalTarget,userData:R.userData}),R.dblClickHandler&&Tn&&(pe.clicks++,pe.clicks===1?(ie.lastClickPos=Ve,ie.dblClickTimeOut=setTimeout(function(){pe.clicks=0},R.dblClickTimeThreshold)):pe.clicks===2&&(clearTimeout(ie.dblClickTimeOut),pe.clicks=0,ie.lastClickPos.distanceTo(Ve)<=R.dblClickDistThreshold&&R.dblClickHandler({eventSource:R,pointerType:je.type,position:g(je.currentPos,R.element),shift:I.originalEvent.shiftKey,isTouchEvent:je.type==="touch",originalEvent:I.originalEvent,userData:R.userData}),ie.lastClickPos=null)))):pe.contacts===2&&R.pinchHandler&&je.type==="touch"&&(ie.pinchGPoints=pe.asArray(),ie.lastPinchDist=ie.currentPinchDist=ie.pinchGPoints[0].currentPos.distanceTo(ie.pinchGPoints[1].currentPos),ie.lastPinchCenter=ie.currentPinchCenter=v(ie.pinchGPoints[0].currentPos,ie.pinchGPoints[1].currentPos))):(I.shouldReleaseCapture=!1,R.releaseHandler&&Ve&&(R.releaseHandler({eventSource:R,pointerType:je.type,position:g(Ve,R.element),buttons:pe.buttons,insideElementPressed:je.insideElementPressed,insideElementReleased:je.insideElement,isTouchEvent:je.type==="touch",originalEvent:I.originalEvent,userData:R.userData}),I.preventDefault=!0)))}function te(R,I,F){var z=i[R.hash],ie=R.getActivePointersListByType(F.type),pe,Ve,Ze;if(typeof I.originalEvent.buttons<"u"&&(ie.buttons=I.originalEvent.buttons),pe=ie.getById(F.id),pe)pe.lastPos=pe.currentPos,pe.lastTime=pe.currentTime,pe.currentPos=F.currentPos,pe.currentTime=F.currentTime;else return;I.shouldCapture=!1,I.shouldReleaseCapture=!1,R.stopHandler&&F.type==="mouse"&&(clearTimeout(R.stopTimeOut),R.stopTimeOut=setTimeout(function(){ke(R,I.originalEvent,F.type)},R.stopDelay)),ie.contacts===0?R.moveHandler&&R.moveHandler({eventSource:R,pointerType:F.type,position:g(F.currentPos,R.element),buttons:ie.buttons,isTouchEvent:F.type==="touch",originalEvent:I.originalEvent,userData:R.userData}):ie.contacts===1?(R.moveHandler&&(pe=ie.asArray()[0],R.moveHandler({eventSource:R,pointerType:pe.type,position:g(pe.currentPos,R.element),buttons:ie.buttons,isTouchEvent:pe.type==="touch",originalEvent:I.originalEvent,userData:R.userData})),R.dragHandler&&!I.preventGesture&&!I.defaultPrevented&&(pe=ie.asArray()[0],Ze=pe.currentPos.minus(pe.lastPos),R.dragHandler({eventSource:R,pointerType:pe.type,position:g(pe.currentPos,R.element),buttons:ie.buttons,delta:Ze,speed:pe.speed,direction:pe.direction,shift:I.originalEvent.shiftKey,isTouchEvent:pe.type==="touch",originalEvent:I.originalEvent,userData:R.userData}),I.preventDefault=!0,z.sentDragEvent=!0)):ie.contacts===2&&(R.moveHandler&&(Ve=ie.asArray(),R.moveHandler({eventSource:R,pointerType:Ve[0].type,position:g(v(Ve[0].currentPos,Ve[1].currentPos),R.element),buttons:ie.buttons,isTouchEvent:Ve[0].type==="touch",originalEvent:I.originalEvent,userData:R.userData})),R.pinchHandler&&F.type==="touch"&&!I.preventGesture&&!I.defaultPrevented&&(Ze=z.pinchGPoints[0].currentPos.distanceTo(z.pinchGPoints[1].currentPos),Ze!==z.currentPinchDist&&(z.lastPinchDist=z.currentPinchDist,z.currentPinchDist=Ze,z.lastPinchCenter=z.currentPinchCenter,z.currentPinchCenter=v(z.pinchGPoints[0].currentPos,z.pinchGPoints[1].currentPos),R.pinchHandler({eventSource:R,pointerType:"touch",gesturePoints:z.pinchGPoints,lastCenter:g(z.lastPinchCenter,R.element),center:g(z.currentPinchCenter,R.element),lastDistance:z.lastPinchDist,distance:z.currentPinchDist,shift:I.originalEvent.shiftKey,originalEvent:I.originalEvent,userData:R.userData}),I.preventDefault=!0)))}function oe(R,I,F){var z=R.getActivePointersListByType(F.type),ie;ie=z.getById(F.id),ie&&We(R,z,ie)}function ke(R,I,F){R.stopHandler&&R.stopHandler({eventSource:R,pointerType:F,position:y(I,R.element),buttons:R.getActivePointersListByType(F).buttons,isTouchEvent:F==="touch",originalEvent:I,userData:R.userData})}}(e),function(n){n.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},n.Control=function(i,r,s){var o=i.parentNode;typeof r=="number"&&(n.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),r={anchor:r}),r.attachToViewer=typeof r.attachToViewer>"u"?!0:r.attachToViewer,this.autoFade=typeof r.autoFade>"u"?!0:r.autoFade,this.element=i,this.anchor=r.anchor,this.container=s,this.anchor===n.ControlAnchor.ABSOLUTE?(this.wrapper=n.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top=typeof r.top=="number"?r.top+"px":r.top,this.wrapper.style.left=typeof r.left=="number"?r.left+"px":r.left,this.wrapper.style.height=typeof r.height=="number"?r.height+"px":r.height,this.wrapper.style.width=typeof r.width=="number"?r.width+"px":r.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=n.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor===n.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),r.attachToViewer?this.anchor===n.ControlAnchor.TOP_RIGHT||this.anchor===n.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):o.appendChild(this.wrapper)},n.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.anchor!==n.ControlAnchor.NONE&&this.container.removeChild(this.wrapper)},isVisible:function(){return this.wrapper.style.display!=="none"},setVisible:function(i){this.wrapper.style.display=i?this.anchor===n.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(i){this.element[n.SIGNAL]&&n.Browser.vendor===n.BROWSERS.IE?n.setElementOpacity(this.element,i,!0):n.setElementOpacity(this.wrapper,i,!0)}}}(e),function(n){n.ControlDock=function(r){var s=["topleft","topright","bottomright","bottomleft"],o,a;for(n.extend(!0,this,{id:"controldock-"+n.now()+"-"+Math.floor(Math.random()*1e6),container:n.makeNeutralElement("div"),controls:[]},r),this.container.onsubmit=function(){return!1},this.element&&(this.element=n.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),a=0;a<s.length;a++)o=s[a],this.controls[o]=n.makeNeutralElement("div"),this.controls[o].style.position="absolute",o.match("left")&&(this.controls[o].style.left="0px"),o.match("right")&&(this.controls[o].style.right="0px"),o.match("top")&&(this.controls[o].style.top="0px"),o.match("bottom")&&(this.controls[o].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},n.ControlDock.prototype={addControl:function(r,s){r=n.getElement(r);var o=null;if(!(i(this,r)>=0)){switch(s.anchor){case n.ControlAnchor.TOP_RIGHT:o=this.controls.topright,r.style.position="relative",r.style.paddingRight="0px",r.style.paddingTop="0px";break;case n.ControlAnchor.BOTTOM_RIGHT:o=this.controls.bottomright,r.style.position="relative",r.style.paddingRight="0px",r.style.paddingBottom="0px";break;case n.ControlAnchor.BOTTOM_LEFT:o=this.controls.bottomleft,r.style.position="relative",r.style.paddingLeft="0px",r.style.paddingBottom="0px";break;case n.ControlAnchor.TOP_LEFT:o=this.controls.topleft,r.style.position="relative",r.style.paddingLeft="0px",r.style.paddingTop="0px";break;case n.ControlAnchor.ABSOLUTE:o=this.container,r.style.margin="0px",r.style.padding="0px";break;default:case n.ControlAnchor.NONE:o=this.container,r.style.margin="0px",r.style.padding="0px";break}this.controls.push(new n.Control(r,s,o)),r.style.display="inline-block"}},removeControl:function(r){r=n.getElement(r);var s=i(this,r);return s>=0&&(this.controls[s].destroy(),this.controls.splice(s,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var r;for(r=this.controls.length-1;r>=0;r--)if(this.controls[r].isVisible())return!0;return!1},setControlsEnabled:function(r){var s;for(s=this.controls.length-1;s>=0;s--)this.controls[s].setVisible(r);return this}};function i(r,s){var o=r.controls,a;for(a=o.length-1;a>=0;a--)if(o[a].element===s)return a;return-1}}(e),function(n){n.Placement=n.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(e),function(n){var i={},r=1;n.Viewer=function(w){var B=arguments,Z=this,fe;if(n.isPlainObject(w)||(w={id:B[0],xmlPath:B.length>1?B[1]:void 0,prefixUrl:B.length>2?B[2]:void 0,controls:B.length>3?B[3]:void 0,overlays:B.length>4?B[4]:void 0}),w.config&&(n.extend(!0,w,w.config),delete w.config),n.extend(!0,this,{id:w.id,hash:w.hash||r++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttonGroup:null,profiler:null},n.DEFAULT_SETTINGS,w),typeof this.hash>"u")throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(typeof i[this.hash]<"u"&&n.console.warn("Hash "+this.hash+" has already been used."),i[this.hash]={fsBoundsDelta:new n.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,needsResize:!1,forceResize:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null,lastClickTime:null,draggingToZoom:!1},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._updatePixelDensityRatioBind=null,this._lastScrollTime=n.now(),n.EventSource.call(this),this.addHandler("open-failed",function(de){var Fe=n.getString("Errors.OpenFailed",de.eventSource,de.message);Z._showMessage(Fe)}),n.ControlDock.call(this,w),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=n.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(de){de.width="100%",de.height="100%",de.overflow="hidden",de.position="absolute",de.top="0px",de.left="0px"}(this.canvas.style),n.setElementTouchActionNone(this.canvas),w.tabIndex!==""&&(this.canvas.tabIndex=w.tabIndex===void 0?0:w.tabIndex),this.container.className="openseadragon-container",function(de){de.width="100%",de.height="100%",de.position="relative",de.overflow="hidden",de.left="0px",de.top="0px",de.textAlign="left"}(this.container.style),n.setElementTouchActionNone(this.container),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new n.MouseTracker({userData:"Viewer.innerTracker",element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,contextMenuHandler:n.delegate(this,y),keyDownHandler:n.delegate(this,g),keyHandler:n.delegate(this,v),clickHandler:n.delegate(this,b),dblClickHandler:n.delegate(this,T),dragHandler:n.delegate(this,S),dragEndHandler:n.delegate(this,_),enterHandler:n.delegate(this,A),leaveHandler:n.delegate(this,P),pressHandler:n.delegate(this,O),releaseHandler:n.delegate(this,x),nonPrimaryPressHandler:n.delegate(this,L),nonPrimaryReleaseHandler:n.delegate(this,M),scrollHandler:n.delegate(this,j),pinchHandler:n.delegate(this,V),focusHandler:n.delegate(this,K),blurHandler:n.delegate(this,U)}),this.outerTracker=new n.MouseTracker({userData:"Viewer.outerTracker",element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:n.delegate(this,G),leaveHandler:n.delegate(this,H)}),this.toolbar&&(this.toolbar=new n.ControlDock({element:this.toolbar})),this.bindStandardControls(),i[this.hash].prevContainerSize=s(this.container),window.ResizeObserver?(this._autoResizePolling=!1,this._resizeObserver=new ResizeObserver(function(){i[Z.hash].needsResize=!0}),this._resizeObserver.observe(this.container,{})):this._autoResizePolling=!0,this.world=new n.World({viewer:this}),this.world.addHandler("add-item",function(de){Z.source=Z.world.getItemAt(0).source,i[Z.hash].forceRedraw=!0,Z._updateRequestId||(Z._updateRequestId=u(Z,Y))}),this.world.addHandler("remove-item",function(de){Z.world.getItemCount()?Z.source=Z.world.getItemAt(0).source:Z.source=null,i[Z.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(de){Z.viewport&&Z.viewport._setContentBounds(Z.world.getHomeBounds(),Z.world.getContentFactor())}),this.world.addHandler("item-index-change",function(de){Z.source=Z.world.getItemAt(0).source}),this.viewport=new n.Viewport({containerSize:i[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins,silenceMultiImageWarnings:this.silenceMultiImageWarnings}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new n.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:w.timeout,tileRetryMax:this.tileRetryMax,tileRetryDelay:this.tileRetryDelay}),this.tileCache=new n.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new n.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=n.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(fe=this.buttonGroup.buttons.indexOf(this.rotateLeft),this.buttonGroup.buttons.splice(fe,1),this.buttonGroup.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(fe=this.buttonGroup.buttons.indexOf(this.rotateRight),this.buttonGroup.buttons.splice(fe,1),this.buttonGroup.element.removeChild(this.rotateRight.element))),this._addUpdatePixelDensityRatioEvent(),this.showNavigator&&(this.navigator=new n.Navigator({element:this.navigatorElement,id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy,animationTime:this.animationTime})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),fe=0;fe<this.customControls.length;fe++)this.addControl(this.customControls[fe].id,{anchor:this.customControls[fe].anchor});n.requestAnimationFrame(function(){d(Z)}),this.imageSmoothingEnabled!==void 0&&!this.imageSmoothingEnabled&&this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled),n._viewers.set(this.element,this)},n.extend(n.Viewer.prototype,n.EventSource.prototype,n.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(w){return n.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(w)},openTileSource:function(w){return n.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(w)},get buttons(){return n.console.warn("Viewer.buttons is deprecated; Please use Viewer.buttonGroup"),this.buttonGroup},open:function(w,B){var Z=this;if(this.close(),!w)return this;if(this.sequenceMode&&n.isArray(w))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),typeof B<"u"&&!isNaN(B)&&(this.initialPage=B),this.tileSources=w,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex),this;if(n.isArray(w)||(w=[w]),!w.length)return this;this._opening=!0;for(var fe=w.length,de=0,Fe=0,_e,ht=function(){if(de+Fe===fe)if(de){(Z._firstOpen||!Z.preserveViewport)&&(Z.viewport.goHome(!0),Z.viewport.update()),Z._firstOpen=!1;var oe=w[0];if(oe.tileSource&&(oe=oe.tileSource),Z.overlays&&!Z.preserveOverlays)for(var ke=0;ke<Z.overlays.length;ke++)Z.currentOverlays[ke]=a(Z,Z.overlays[ke]);Z._drawOverlays(),Z._opening=!1,Z.raiseEvent("open",{source:oe})}else Z._opening=!1,Z.raiseEvent("open-failed",_e)},mt=function(oe){(!n.isPlainObject(oe)||!oe.tileSource)&&(oe={tileSource:oe}),oe.index!==void 0&&(n.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete oe.index),oe.collectionImmediately===void 0&&(oe.collectionImmediately=!0);var ke=oe.success;oe.success=function(I){if(de++,oe.tileSource.overlays)for(var F=0;F<oe.tileSource.overlays.length;F++)Z.addOverlay(oe.tileSource.overlays[F]);ke&&ke(I),ht()};var R=oe.error;oe.error=function(I){Fe++,_e||(_e=I),R&&R(I),ht()},Z.addTiledImage(oe)},te=0;te<w.length;te++)mt(w[te]);return this},close:function(){return i[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),i[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(i[this.hash]){if(this.raiseEvent("before-destroy"),this._removeUpdatePixelDensityRatioEvent(),this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this._resizeObserver&&this._resizeObserver.disconnect(),this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),this._updateRequestId!==null&&(n.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.navigator&&(this.navigator.destroy(),i[this.navigator.hash]=null,delete i[this.navigator.hash],this.navigator=null),this.buttonGroup)this.buttonGroup.destroy();else if(this.customButtons)for(;this.customButtons.length;)this.customButtons.pop().destroy();if(this.paging&&this.paging.destroy(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.container.onsubmit=null,this.clearControls(),this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),i[this.hash]=null,delete i[this.hash],this.canvas=null,this.container=null,n._viewers.delete(this.element),this.element=null,this.raiseEvent("destroy"),this.removeAllHandlers()}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(w){return this.innerTracker.setTracking(w),this.outerTracker.setTracking(w),this.raiseEvent("mouse-enabled",{enabled:w}),this},areControlsEnabled:function(){var w=this.controls.length,B;for(B=0;B<this.controls.length;B++)w=w&&this.controls[B].isVisible();return w},setControlsEnabled:function(w){return w?h(this):d(this),this.raiseEvent("controls-enabled",{enabled:w}),this},setDebugMode:function(w){for(var B=0;B<this.world.getItemCount();B++)this.world.getItemAt(B).debugMode=w;this.debugMode=w,this.forceRedraw()},setAjaxHeaders:function(w,B){if(w===null&&(w={}),!n.isPlainObject(w)){console.error("[Viewer.setAjaxHeaders] Ignoring invalid headers, must be a plain object");return}if(B===void 0&&(B=!0),this.ajaxHeaders=w,B){for(var Z=0;Z<this.world.getItemCount();Z++)this.world.getItemAt(Z)._updateAjaxHeaders(!0);if(this.navigator&&this.navigator.setAjaxHeaders(this.ajaxHeaders,!0),this.referenceStrip&&this.referenceStrip.miniViewers)for(var fe in this.referenceStrip.miniViewers)this.referenceStrip.miniViewers[fe].setAjaxHeaders(this.ajaxHeaders,!0)}},addButton:function(w){this.buttonGroup.addButton(w)},isFullPage:function(){return i[this.hash].fullPage},setFullPage:function(w){var B=document.body,Z=B.style,fe=document.documentElement.style,de=this,Fe,_e;if(w===this.isFullPage())return this;var ht={fullPage:w,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",ht),ht.preventDefaultAction)return this;if(w){for(this.elementSize=n.getElementSize(this.element),this.pageScroll=n.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=Z.margin,this.docMargin=fe.margin,Z.margin="0",fe.margin="0",this.bodyPadding=Z.padding,this.docPadding=fe.padding,Z.padding="0",fe.padding="0",this.bodyWidth=Z.width,this.docWidth=fe.width,Z.width="100%",fe.width="100%",this.bodyHeight=Z.height,this.docHeight=fe.height,Z.height="100%",fe.height="100%",this.bodyDisplay=Z.display,Z.display="block",this.previousBody=[],i[this.hash].prevElementParent=this.element.parentNode,i[this.hash].prevNextSibling=this.element.nextSibling,i[this.hash].prevElementWidth=this.element.style.width,i[this.hash].prevElementHeight=this.element.style.height,Fe=B.childNodes.length,_e=0;_e<Fe;_e++)this.previousBody.push(B.childNodes[0]),B.removeChild(B.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,B.appendChild(this.toolbar.element),n.addClass(this.toolbar.element,"fullpage")),n.addClass(this.element,"fullpage"),B.appendChild(this.element),this.element.style.height="100vh",this.element.style.width="100vw",this.toolbar&&this.toolbar.element&&(this.element.style.height=n.getElementSize(this.element).y-n.getElementSize(this.toolbar.element).y+"px"),i[this.hash].fullPage=!0,n.delegate(this,G)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,Z.margin=this.bodyMargin,fe.margin=this.docMargin,Z.padding=this.bodyPadding,fe.padding=this.docPadding,Z.width=this.bodyWidth,fe.width=this.docWidth,Z.height=this.bodyHeight,fe.height=this.docHeight,Z.display=this.bodyDisplay,B.removeChild(this.element),Fe=this.previousBody.length,_e=0;_e<Fe;_e++)B.appendChild(this.previousBody.shift());n.removeClass(this.element,"fullpage"),i[this.hash].prevElementParent.insertBefore(this.element,i[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(B.removeChild(this.toolbar.element),n.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=i[this.hash].prevElementWidth,this.element.style.height=i[this.hash].prevElementHeight;var mt=0,te=function(){n.setPageScroll(de.pageScroll);var oe=n.getPageScroll();mt++,mt<10&&(oe.x!==de.pageScroll.x||oe.y!==de.pageScroll.y)&&n.requestAnimationFrame(te)};n.requestAnimationFrame(te),i[this.hash].fullPage=!1,n.delegate(this,H)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:w}),this},setFullScreen:function(w){var B=this;if(!n.supportsFullScreen)return this.setFullPage(w);if(n.isFullScreen()===w)return this;var Z={fullScreen:w,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",Z),Z.preventDefaultAction)return this;if(w){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var fe=function(){var de=n.isFullScreen();de||(n.removeEvent(document,n.fullScreenEventName,fe),n.removeEvent(document,n.fullScreenErrorEventName,fe),B.setFullPage(!1),B.isFullPage()&&(B.element.style.width=B.fullPageStyleWidth,B.element.style.height=B.fullPageStyleHeight)),B.navigator&&B.viewport&&setTimeout(function(){B.navigator.update(B.viewport)}),B.raiseEvent("full-screen",{fullScreen:de})};n.addEvent(document,n.fullScreenEventName,fe),n.addEvent(document,n.fullScreenErrorEventName,fe),n.requestFullScreen(document.body)}else n.exitFullScreen();return this},isVisible:function(){return this.container.style.visibility!=="hidden"},isFullScreen:function(){return n.isFullScreen()&&this.isFullPage()},setVisible:function(w){return this.container.style.visibility=w?"":"hidden",this.raiseEvent("visible",{visible:w}),this},addTiledImage:function(w){n.console.assert(w,"[Viewer.addTiledImage] options is required"),n.console.assert(w.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),n.console.assert(!w.replace||w.index>-1&&w.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var B=this;w.replace&&(w.replaceItem=B.world.getItemAt(w.index)),this._hideMessage(),w.placeholderFillStyle===void 0&&(w.placeholderFillStyle=this.placeholderFillStyle),w.opacity===void 0&&(w.opacity=this.opacity),w.preload===void 0&&(w.preload=this.preload),w.compositeOperation===void 0&&(w.compositeOperation=this.compositeOperation),w.crossOriginPolicy===void 0&&(w.crossOriginPolicy=w.tileSource.crossOriginPolicy!==void 0?w.tileSource.crossOriginPolicy:this.crossOriginPolicy),w.ajaxWithCredentials===void 0&&(w.ajaxWithCredentials=this.ajaxWithCredentials),w.loadTilesWithAjax===void 0&&(w.loadTilesWithAjax=this.loadTilesWithAjax),n.isPlainObject(w.ajaxHeaders)||(w.ajaxHeaders={});var Z={options:w};function fe(_e){for(var ht=0;ht<B._loadQueue.length;ht++)if(B._loadQueue[ht]===Z){B._loadQueue.splice(ht,1);break}B._loadQueue.length===0&&de(Z),B.raiseEvent("add-item-failed",_e),w.error&&w.error(_e)}function de(_e){B.collectionMode&&(B.world.arrange({immediately:_e.options.collectionImmediately,rows:B.collectionRows,columns:B.collectionColumns,layout:B.collectionLayout,tileSize:B.collectionTileSize,tileMargin:B.collectionTileMargin}),B.world.setAutoRefigureSizes(!0))}if(n.isArray(w.tileSource)){setTimeout(function(){fe({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:w.tileSource,options:w})});return}this._loadQueue.push(Z);function Fe(){for(var _e,ht,mt;B._loadQueue.length&&(_e=B._loadQueue[0],!!_e.tileSource);){if(B._loadQueue.splice(0,1),_e.options.replace){var te=B.world.getIndexOfItem(_e.options.replaceItem);te!==-1&&(_e.options.index=te),B.world.removeItem(_e.options.replaceItem)}ht=new n.TiledImage({viewer:B,source:_e.tileSource,viewport:B.viewport,drawer:B.drawer,tileCache:B.tileCache,imageLoader:B.imageLoader,x:_e.options.x,y:_e.options.y,width:_e.options.width,height:_e.options.height,fitBounds:_e.options.fitBounds,fitBoundsPlacement:_e.options.fitBoundsPlacement,clip:_e.options.clip,placeholderFillStyle:_e.options.placeholderFillStyle,opacity:_e.options.opacity,preload:_e.options.preload,degrees:_e.options.degrees,flipped:_e.options.flipped,compositeOperation:_e.options.compositeOperation,springStiffness:B.springStiffness,animationTime:B.animationTime,minZoomImageRatio:B.minZoomImageRatio,wrapHorizontal:B.wrapHorizontal,wrapVertical:B.wrapVertical,immediateRender:B.immediateRender,blendTime:B.blendTime,alwaysBlend:B.alwaysBlend,minPixelRatio:B.minPixelRatio,smoothTileEdgesMinZoom:B.smoothTileEdgesMinZoom,iOSDevice:B.iOSDevice,crossOriginPolicy:_e.options.crossOriginPolicy,ajaxWithCredentials:_e.options.ajaxWithCredentials,loadTilesWithAjax:_e.options.loadTilesWithAjax,ajaxHeaders:_e.options.ajaxHeaders,debugMode:B.debugMode,subPixelRoundingForTransparency:B.subPixelRoundingForTransparency}),B.collectionMode&&B.world.setAutoRefigureSizes(!1),B.navigator&&(mt=n.extend({},_e.options,{replace:!1,originalTiledImage:ht,tileSource:_e.tileSource}),B.navigator.addTiledImage(mt)),B.world.addItem(ht,{index:_e.options.index}),B._loadQueue.length===0&&de(_e),B.world.getItemCount()===1&&!B.preserveViewport&&B.viewport.goHome(!0),_e.options.success&&_e.options.success({item:ht})}}o(this,w.tileSource,w,function(_e){Z.tileSource=_e,Fe()},function(_e){_e.options=w,fe(_e),Fe()})},addSimpleImage:function(w){n.console.assert(w,"[Viewer.addSimpleImage] options is required"),n.console.assert(w.url,"[Viewer.addSimpleImage] options.url is required");var B=n.extend({},w,{tileSource:{type:"image",url:w.url}});delete B.url,this.addTiledImage(B)},addLayer:function(w){var B=this;n.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var Z=n.extend({},w,{success:function(fe){B.raiseEvent("add-layer",{options:w,drawer:fe.item})},error:function(fe){B.raiseEvent("add-layer-failed",fe)}});return this.addTiledImage(Z),this},getLayerAtLevel:function(w){return n.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(w)},getLevelOfLayer:function(w){return n.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(w)},getLayersCount:function(){return n.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(w,B){return n.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(w,B)},removeLayer:function(w){return n.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(w)},forceRedraw:function(){return i[this.hash].forceRedraw=!0,this},forceResize:function(){i[this.hash].needsResize=!0,i[this.hash].forceResize=!0},bindSequenceControls:function(){var w=n.delegate(this,p),B=n.delegate(this,m),Z=n.delegate(this,this.goToNextPage),fe=n.delegate(this,this.goToPreviousPage),de=this.navImages,Fe=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(Fe=!1),this.previousButton=new n.Button({element:this.previousButton?n.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:n.getString("Tooltips.PreviousPage"),srcRest:N(this.prefixUrl,de.previous.REST),srcGroup:N(this.prefixUrl,de.previous.GROUP),srcHover:N(this.prefixUrl,de.previous.HOVER),srcDown:N(this.prefixUrl,de.previous.DOWN),onRelease:fe,onFocus:w,onBlur:B}),this.nextButton=new n.Button({element:this.nextButton?n.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:n.getString("Tooltips.NextPage"),srcRest:N(this.prefixUrl,de.next.REST),srcGroup:N(this.prefixUrl,de.next.GROUP),srcHover:N(this.prefixUrl,de.next.HOVER),srcDown:N(this.prefixUrl,de.next.DOWN),onRelease:Z,onFocus:w,onBlur:B}),this.navPrevNextWrap||this.previousButton.disable(),(!this.tileSources||!this.tileSources.length)&&this.nextButton.disable(),Fe&&(this.paging=new n.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:n.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||n.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var w=n.delegate(this,le),B=n.delegate(this,ce),Z=n.delegate(this,$e),fe=n.delegate(this,we),de=n.delegate(this,Ie),Fe=n.delegate(this,Ne),_e=n.delegate(this,at),ht=n.delegate(this,wt),mt=n.delegate(this,Bt),te=n.delegate(this,We),oe=n.delegate(this,p),ke=n.delegate(this,m),R=this.navImages,I=[],F=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(F=!1),this.showZoomControl&&(I.push(this.zoomInButton=new n.Button({element:this.zoomInButton?n.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:n.getString("Tooltips.ZoomIn"),srcRest:N(this.prefixUrl,R.zoomIn.REST),srcGroup:N(this.prefixUrl,R.zoomIn.GROUP),srcHover:N(this.prefixUrl,R.zoomIn.HOVER),srcDown:N(this.prefixUrl,R.zoomIn.DOWN),onPress:w,onRelease:B,onClick:Z,onEnter:w,onExit:B,onFocus:oe,onBlur:ke})),I.push(this.zoomOutButton=new n.Button({element:this.zoomOutButton?n.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:n.getString("Tooltips.ZoomOut"),srcRest:N(this.prefixUrl,R.zoomOut.REST),srcGroup:N(this.prefixUrl,R.zoomOut.GROUP),srcHover:N(this.prefixUrl,R.zoomOut.HOVER),srcDown:N(this.prefixUrl,R.zoomOut.DOWN),onPress:fe,onRelease:B,onClick:de,onEnter:fe,onExit:B,onFocus:oe,onBlur:ke}))),this.showHomeControl&&I.push(this.homeButton=new n.Button({element:this.homeButton?n.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:n.getString("Tooltips.Home"),srcRest:N(this.prefixUrl,R.home.REST),srcGroup:N(this.prefixUrl,R.home.GROUP),srcHover:N(this.prefixUrl,R.home.HOVER),srcDown:N(this.prefixUrl,R.home.DOWN),onRelease:Fe,onFocus:oe,onBlur:ke})),this.showFullPageControl&&I.push(this.fullPageButton=new n.Button({element:this.fullPageButton?n.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:n.getString("Tooltips.FullPage"),srcRest:N(this.prefixUrl,R.fullpage.REST),srcGroup:N(this.prefixUrl,R.fullpage.GROUP),srcHover:N(this.prefixUrl,R.fullpage.HOVER),srcDown:N(this.prefixUrl,R.fullpage.DOWN),onRelease:_e,onFocus:oe,onBlur:ke})),this.showRotationControl&&(I.push(this.rotateLeftButton=new n.Button({element:this.rotateLeftButton?n.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:n.getString("Tooltips.RotateLeft"),srcRest:N(this.prefixUrl,R.rotateleft.REST),srcGroup:N(this.prefixUrl,R.rotateleft.GROUP),srcHover:N(this.prefixUrl,R.rotateleft.HOVER),srcDown:N(this.prefixUrl,R.rotateleft.DOWN),onRelease:ht,onFocus:oe,onBlur:ke})),I.push(this.rotateRightButton=new n.Button({element:this.rotateRightButton?n.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:n.getString("Tooltips.RotateRight"),srcRest:N(this.prefixUrl,R.rotateright.REST),srcGroup:N(this.prefixUrl,R.rotateright.GROUP),srcHover:N(this.prefixUrl,R.rotateright.HOVER),srcDown:N(this.prefixUrl,R.rotateright.DOWN),onRelease:mt,onFocus:oe,onBlur:ke}))),this.showFlipControl&&I.push(this.flipButton=new n.Button({element:this.flipButton?n.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:n.getString("Tooltips.Flip"),srcRest:N(this.prefixUrl,R.flip.REST),srcGroup:N(this.prefixUrl,R.flip.GROUP),srcHover:N(this.prefixUrl,R.flip.HOVER),srcDown:N(this.prefixUrl,R.flip.DOWN),onRelease:te,onFocus:oe,onBlur:ke})),F?(this.buttonGroup=new n.ButtonGroup({buttons:I,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttonGroup.element,this.addHandler("open",n.delegate(this,Me)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||n.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||n.ControlAnchor.TOP_LEFT})):this.customButtons=I),this},currentPage:function(){return this._sequenceIndex},goToPage:function(w){return this.tileSources&&w>=0&&w<this.tileSources.length&&(this._sequenceIndex=w,this._updateSequenceButtons(w),this.open(this.tileSources[w]),this.referenceStrip&&this.referenceStrip.setFocus(w),this.raiseEvent("page",{page:w})),this},addOverlay:function(w,B,Z,fe){var de;if(n.isPlainObject(w)?de=w:de={element:w,location:B,placement:Z,onDraw:fe},w=n.getElement(de.element),l(this.currentOverlays,w)>=0)return this;var Fe=a(this,de);return this.currentOverlays.push(Fe),Fe.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:w,location:de.location,placement:de.placement}),this},updateOverlay:function(w,B,Z){var fe;return w=n.getElement(w),fe=l(this.currentOverlays,w),fe>=0&&(this.currentOverlays[fe].update(B,Z),i[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:w,location:B,placement:Z})),this},removeOverlay:function(w){var B;return w=n.getElement(w),B=l(this.currentOverlays,w),B>=0&&(this.currentOverlays[B].destroy(),this.currentOverlays.splice(B,1),i[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:w})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return i[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(w){var B;return w=n.getElement(w),B=l(this.currentOverlays,w),B>=0?this.currentOverlays[B]:null},_updateSequenceButtons:function(w){this.nextButton&&(!this.tileSources||this.tileSources.length-1===w?this.navPrevNextWrap||this.nextButton.disable():this.nextButton.enable()),this.previousButton&&(w>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(w){this._hideMessage();var B=n.makeNeutralElement("div");B.appendChild(document.createTextNode(w)),this.messageDiv=n.makeCenteredNode(B),n.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var w=this.messageDiv;w&&(w.parentNode.removeChild(w),delete this.messageDiv)},gestureSettingsByDeviceType:function(w){switch(w){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var w,B=this.currentOverlays.length;for(w=0;w<B;w++)this.currentOverlays[w].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new n.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else n.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')},_addUpdatePixelDensityRatioEvent:function(){this._updatePixelDensityRatioBind=this._updatePixelDensityRatio.bind(this),n.addEvent(window,"resize",this._updatePixelDensityRatioBind)},_removeUpdatePixelDensityRatioEvent:function(){n.removeEvent(window,"resize",this._updatePixelDensityRatioBind)},_updatePixelDensityRatio:function(){var w=n.pixelDensityRatio,B=n.getCurrentPixelDensityRatio();w!==B&&(n.pixelDensityRatio=B,this.world.resetItems(),this.forceRedraw())},goToPreviousPage:function(){var w=this._sequenceIndex-1;this.navPrevNextWrap&&w<0&&(w+=this.tileSources.length),this.goToPage(w)},goToNextPage:function(){var w=this._sequenceIndex+1;this.navPrevNextWrap&&w>=this.tileSources.length&&(w=0),this.goToPage(w)},isAnimating:function(){return i[this.hash].animating}});function s(w){return w=n.getElement(w),new n.Point(w.clientWidth===0?1:w.clientWidth,w.clientHeight===0?1:w.clientHeight)}function o(w,B,Z,fe,de){var Fe=w;if(n.type(B)==="string"){if(B.match(/^\s*<.*>\s*$/))B=n.parseXml(B);else if(B.match(/^\s*[{[].*[}\]]\s*$/))try{var _e=n.parseJSON(B);B=_e}catch{}}function ht(mt,te){mt.ready?fe(mt):(mt.addHandler("ready",function(){fe(mt)}),mt.addHandler("open-failed",function(oe){de({message:oe.message,source:te})}))}setTimeout(function(){if(n.type(B)==="string")B=new n.TileSource({url:B,crossOriginPolicy:Z.crossOriginPolicy!==void 0?Z.crossOriginPolicy:w.crossOriginPolicy,ajaxWithCredentials:w.ajaxWithCredentials,ajaxHeaders:Z.ajaxHeaders?Z.ajaxHeaders:w.ajaxHeaders,splitHashDataForPost:w.splitHashDataForPost,useCanvas:w.useCanvas,success:function(ke){fe(ke.tileSource)}}),B.addHandler("open-failed",function(ke){de(ke)});else if(n.isPlainObject(B)||B.nodeType)if(B.crossOriginPolicy===void 0&&(Z.crossOriginPolicy!==void 0||w.crossOriginPolicy!==void 0)&&(B.crossOriginPolicy=Z.crossOriginPolicy!==void 0?Z.crossOriginPolicy:w.crossOriginPolicy),B.ajaxWithCredentials===void 0&&(B.ajaxWithCredentials=w.ajaxWithCredentials),B.useCanvas===void 0&&(B.useCanvas=w.useCanvas),n.isFunction(B.getTileUrl)){var mt=new n.TileSource(B);mt.getTileUrl=B.getTileUrl,fe(mt)}else{var te=n.TileSource.determineType(Fe,B);if(!te){de({message:"Unable to load TileSource",source:B});return}var oe=te.prototype.configure.apply(Fe,[B]);ht(new te(oe),B)}else ht(B,B)})}function a(w,B){if(B instanceof n.Overlay)return B;var Z=null;if(B.element)Z=n.getElement(B.element);else{var fe=B.id?B.id:"openseadragon-overlay-"+Math.floor(Math.random()*1e7);Z=n.getElement(B.id),Z||(Z=document.createElement("a"),Z.href="#/overlay/"+fe),Z.id=fe,n.addClass(Z,B.className?B.className:"openseadragon-overlay")}var de=B.location,Fe=B.width,_e=B.height;if(!de){var ht=B.x,mt=B.y;if(B.px!==void 0){var te=w.viewport.imageToViewportRectangle(new n.Rect(B.px,B.py,Fe||0,_e||0));ht=te.x,mt=te.y,Fe=Fe!==void 0?te.width:void 0,_e=_e!==void 0?te.height:void 0}de=new n.Point(ht,mt)}var oe=B.placement;return oe&&n.type(oe)==="string"&&(oe=n.Placement[B.placement.toUpperCase()]),new n.Overlay({element:Z,location:de,placement:oe,onDraw:B.onDraw,checkResize:B.checkResize,width:Fe,height:_e,rotationMode:B.rotationMode})}function l(w,B){var Z;for(Z=w.length-1;Z>=0;Z--)if(w[Z].element===B)return Z;return-1}function u(w,B){return n.requestAnimationFrame(function(){B(w)})}function c(w){n.requestAnimationFrame(function(){f(w)})}function d(w){w.autoHideControls&&(w.controlsShouldFade=!0,w.controlsFadeBeginTime=n.now()+w.controlsFadeDelay,window.setTimeout(function(){c(w)},w.controlsFadeDelay))}function f(w){var B,Z,fe,de;if(w.controlsShouldFade){for(B=n.now(),Z=B-w.controlsFadeBeginTime,fe=1-Z/w.controlsFadeLength,fe=Math.min(1,fe),fe=Math.max(0,fe),de=w.controls.length-1;de>=0;de--)w.controls[de].autoFade&&w.controls[de].setOpacity(fe);fe>0&&c(w)}}function h(w){var B;for(w.controlsShouldFade=!1,B=w.controls.length-1;B>=0;B--)w.controls[B].setOpacity(1)}function p(){h(this)}function m(){d(this)}function y(w){var B={tracker:w.eventSource,position:w.position,originalEvent:w.originalEvent,preventDefault:w.preventDefault};this.raiseEvent("canvas-contextmenu",B),w.preventDefault=B.preventDefault}function g(w){var B={originalEvent:w.originalEvent,preventDefaultAction:!1,preventVerticalPan:w.preventVerticalPan||!this.panVertical,preventHorizontalPan:w.preventHorizontalPan||!this.panHorizontal};if(this.raiseEvent("canvas-key",B),!B.preventDefaultAction&&!w.ctrl&&!w.alt&&!w.meta)switch(w.keyCode){case 38:B.preventVerticalPan||(w.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new n.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),w.preventDefault=!0;break;case 40:B.preventVerticalPan||(w.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new n.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),w.preventDefault=!0;break;case 37:B.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new n.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),w.preventDefault=!0;break;case 39:B.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new n.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),w.preventDefault=!0;break;case 187:this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),w.preventDefault=!0;break;case 189:this.viewport.zoomBy(.9),this.viewport.applyConstraints(),w.preventDefault=!0;break;case 48:this.viewport.goHome(),this.viewport.applyConstraints(),w.preventDefault=!0;break;case 87:B.preventVerticalPan||(w.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new n.Point(0,-40))),this.viewport.applyConstraints()),w.preventDefault=!0;break;case 83:B.preventVerticalPan||(w.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new n.Point(0,40))),this.viewport.applyConstraints()),w.preventDefault=!0;break;case 65:B.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new n.Point(-40,0))),this.viewport.applyConstraints()),w.preventDefault=!0;break;case 68:B.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new n.Point(40,0))),this.viewport.applyConstraints()),w.preventDefault=!0;break;case 82:w.shift?this.viewport.flipped?this.viewport.setRotation(this.viewport.getRotation()+this.rotationIncrement):this.viewport.setRotation(this.viewport.getRotation()-this.rotationIncrement):this.viewport.flipped?this.viewport.setRotation(this.viewport.getRotation()-this.rotationIncrement):this.viewport.setRotation(this.viewport.getRotation()+this.rotationIncrement),this.viewport.applyConstraints(),w.preventDefault=!0;break;case 70:this.viewport.toggleFlip(),w.preventDefault=!0;break;case 74:this.goToPreviousPage();break;case 75:this.goToNextPage();break;default:w.preventDefault=!1;break}else w.preventDefault=!1}function v(w){var B={originalEvent:w.originalEvent};this.raiseEvent("canvas-key-press",B)}function b(w){var B,Z=document.activeElement===this.canvas;Z||this.canvas.focus(),this.viewport.flipped&&(w.position.x=this.viewport.getContainerSize().x-w.position.x);var fe={tracker:w.eventSource,position:w.position,quick:w.quick,shift:w.shift,originalEvent:w.originalEvent,originalTarget:w.originalTarget,preventDefaultAction:!1};this.raiseEvent("canvas-click",fe),!fe.preventDefaultAction&&this.viewport&&w.quick&&(B=this.gestureSettingsByDeviceType(w.pointerType),B.clickToZoom===!0&&(this.viewport.zoomBy(w.shift?1/this.zoomPerClick:this.zoomPerClick,B.zoomToRefPoint?this.viewport.pointFromPixel(w.position,!0):null),this.viewport.applyConstraints()),B.dblClickDragToZoom&&(i[this.hash].draggingToZoom===!0?(i[this.hash].lastClickTime=null,i[this.hash].draggingToZoom=!1):i[this.hash].lastClickTime=n.now()))}function T(w){var B,Z={tracker:w.eventSource,position:w.position,shift:w.shift,originalEvent:w.originalEvent,preventDefaultAction:!1};this.raiseEvent("canvas-double-click",Z),!Z.preventDefaultAction&&this.viewport&&(B=this.gestureSettingsByDeviceType(w.pointerType),B.dblClickToZoom&&(this.viewport.zoomBy(w.shift?1/this.zoomPerClick:this.zoomPerClick,B.zoomToRefPoint?this.viewport.pointFromPixel(w.position,!0):null),this.viewport.applyConstraints()))}function S(w){var B,Z={tracker:w.eventSource,pointerType:w.pointerType,position:w.position,delta:w.delta,speed:w.speed,direction:w.direction,shift:w.shift,originalEvent:w.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag",Z),B=this.gestureSettingsByDeviceType(w.pointerType),!Z.preventDefaultAction&&this.viewport){if(B.dblClickDragToZoom&&i[this.hash].draggingToZoom){var fe=Math.pow(this.zoomPerDblClickDrag,w.delta.y/50);this.viewport.zoomBy(fe)}else if(B.dragToPan&&!i[this.hash].draggingToZoom){if(this.panHorizontal||(w.delta.x=0),this.panVertical||(w.delta.y=0),this.viewport.flipped&&(w.delta.x=-w.delta.x),this.constrainDuringPan){var de=this.viewport.deltaPointsFromPixels(w.delta.negate());this.viewport.centerSpringX.target.value+=de.x,this.viewport.centerSpringY.target.value+=de.y;var Fe=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=de.x,this.viewport.centerSpringY.target.value-=de.y,Fe.xConstrained&&(w.delta.x=0),Fe.yConstrained&&(w.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(w.delta.negate()),B.flickEnabled&&!this.constrainDuringPan)}}}function _(w){var B,Z={tracker:w.eventSource,pointerType:w.pointerType,position:w.position,speed:w.speed,direction:w.direction,shift:w.shift,originalEvent:w.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag-end",Z),B=this.gestureSettingsByDeviceType(w.pointerType),!Z.preventDefaultAction&&this.viewport){if(!i[this.hash].draggingToZoom&&B.flickEnabled&&w.speed>=B.flickMinSpeed){var fe=0;this.panHorizontal&&(fe=B.flickMomentum*w.speed*Math.cos(w.direction));var de=0;this.panVertical&&(de=B.flickMomentum*w.speed*Math.sin(w.direction));var Fe=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),_e=this.viewport.pointFromPixel(new n.Point(Fe.x-fe,Fe.y-de));this.viewport.panTo(_e,!1)}this.viewport.applyConstraints()}B.dblClickDragToZoom&&i[this.hash].draggingToZoom===!0&&(i[this.hash].draggingToZoom=!1)}function A(w){this.raiseEvent("canvas-enter",{tracker:w.eventSource,pointerType:w.pointerType,position:w.position,buttons:w.buttons,pointers:w.pointers,insideElementPressed:w.insideElementPressed,buttonDownAny:w.buttonDownAny,originalEvent:w.originalEvent})}function P(w){this.raiseEvent("canvas-exit",{tracker:w.eventSource,pointerType:w.pointerType,position:w.position,buttons:w.buttons,pointers:w.pointers,insideElementPressed:w.insideElementPressed,buttonDownAny:w.buttonDownAny,originalEvent:w.originalEvent})}function O(w){var B;if(this.raiseEvent("canvas-press",{tracker:w.eventSource,pointerType:w.pointerType,position:w.position,insideElementPressed:w.insideElementPressed,insideElementReleased:w.insideElementReleased,originalEvent:w.originalEvent}),B=this.gestureSettingsByDeviceType(w.pointerType),B.dblClickDragToZoom){var Z=i[this.hash].lastClickTime,fe=n.now();if(Z===null)return;fe-Z<this.dblClickTimeThreshold&&(i[this.hash].draggingToZoom=!0),i[this.hash].lastClickTime=null}}function x(w){this.raiseEvent("canvas-release",{tracker:w.eventSource,pointerType:w.pointerType,position:w.position,insideElementPressed:w.insideElementPressed,insideElementReleased:w.insideElementReleased,originalEvent:w.originalEvent})}function L(w){this.raiseEvent("canvas-nonprimary-press",{tracker:w.eventSource,position:w.position,pointerType:w.pointerType,button:w.button,buttons:w.buttons,originalEvent:w.originalEvent})}function M(w){this.raiseEvent("canvas-nonprimary-release",{tracker:w.eventSource,position:w.position,pointerType:w.pointerType,button:w.button,buttons:w.buttons,originalEvent:w.originalEvent})}function V(w){var B,Z,fe,de,Fe={tracker:w.eventSource,pointerType:w.pointerType,gesturePoints:w.gesturePoints,lastCenter:w.lastCenter,center:w.center,lastDistance:w.lastDistance,distance:w.distance,shift:w.shift,originalEvent:w.originalEvent,preventDefaultPanAction:!1,preventDefaultZoomAction:!1,preventDefaultRotateAction:!1};if(this.raiseEvent("canvas-pinch",Fe),this.viewport&&(B=this.gestureSettingsByDeviceType(w.pointerType),B.pinchToZoom&&(!Fe.preventDefaultPanAction||!Fe.preventDefaultZoomAction)&&(Z=this.viewport.pointFromPixel(w.center,!0),B.zoomToRefPoint&&!Fe.preventDefaultPanAction&&(fe=this.viewport.pointFromPixel(w.lastCenter,!0),de=fe.minus(Z),this.panHorizontal||(de.x=0),this.panVertical||(de.y=0),this.viewport.panBy(de,!0)),Fe.preventDefaultZoomAction||this.viewport.zoomBy(w.distance/w.lastDistance,Z,!0),this.viewport.applyConstraints()),B.pinchRotate&&!Fe.preventDefaultRotateAction)){var _e=Math.atan2(w.gesturePoints[0].currentPos.y-w.gesturePoints[1].currentPos.y,w.gesturePoints[0].currentPos.x-w.gesturePoints[1].currentPos.x),ht=Math.atan2(w.gesturePoints[0].lastPos.y-w.gesturePoints[1].lastPos.y,w.gesturePoints[0].lastPos.x-w.gesturePoints[1].lastPos.x);Z=this.viewport.pointFromPixel(w.center,!0),this.viewport.rotateTo(this.viewport.getRotation(!0)+(_e-ht)*(180/Math.PI),Z,!0)}}function K(w){this.raiseEvent("canvas-focus",{tracker:w.eventSource,originalEvent:w.originalEvent})}function U(w){this.raiseEvent("canvas-blur",{tracker:w.eventSource,originalEvent:w.originalEvent})}function j(w){var B,Z,fe,de,Fe;de=n.now(),Fe=de-this._lastScrollTime,Fe>this.minScrollDeltaTime?(this._lastScrollTime=de,B={tracker:w.eventSource,position:w.position,scroll:w.scroll,shift:w.shift,originalEvent:w.originalEvent,preventDefaultAction:!1,preventDefault:!0},this.raiseEvent("canvas-scroll",B),!B.preventDefaultAction&&this.viewport&&(this.viewport.flipped&&(w.position.x=this.viewport.getContainerSize().x-w.position.x),Z=this.gestureSettingsByDeviceType(w.pointerType),Z.scrollToZoom&&(fe=Math.pow(this.zoomPerScroll,w.scroll),this.viewport.zoomBy(fe,Z.zoomToRefPoint?this.viewport.pointFromPixel(w.position,!0):null),this.viewport.applyConstraints())),w.preventDefault=B.preventDefault):w.preventDefault=!0}function G(w){i[this.hash].mouseInside=!0,h(this),this.raiseEvent("container-enter",{tracker:w.eventSource,pointerType:w.pointerType,position:w.position,buttons:w.buttons,pointers:w.pointers,insideElementPressed:w.insideElementPressed,buttonDownAny:w.buttonDownAny,originalEvent:w.originalEvent})}function H(w){w.pointers<1&&(i[this.hash].mouseInside=!1,i[this.hash].animating||d(this)),this.raiseEvent("container-exit",{tracker:w.eventSource,pointerType:w.pointerType,position:w.position,buttons:w.buttons,pointers:w.pointers,insideElementPressed:w.insideElementPressed,buttonDownAny:w.buttonDownAny,originalEvent:w.originalEvent})}function Y(w){ee(w),w.isOpen()?w._updateRequestId=u(w,Y):w._updateRequestId=!1}function D(w,B){var Z=w.viewport,fe=Z.getZoom(),de=Z.getCenter();Z.resize(B,w.preserveImageSizeOnResize),Z.panTo(de,!0);var Fe;if(w.preserveImageSizeOnResize)Fe=i[w.hash].prevContainerSize.x/B.x;else{var _e=new n.Point(0,0),ht=new n.Point(i[w.hash].prevContainerSize.x,i[w.hash].prevContainerSize.y).distanceTo(_e),mt=new n.Point(B.x,B.y).distanceTo(_e);Fe=mt/ht*i[w.hash].prevContainerSize.x/B.x}Z.zoomTo(fe*Fe,null,!0),i[w.hash].prevContainerSize=B,i[w.hash].forceRedraw=!0,i[w.hash].needsResize=!1,i[w.hash].forceResize=!1}function ee(w){if(!(w._opening||!i[w.hash])){if(w.autoResize||i[w.hash].forceResize){var B;if(w._autoResizePolling){B=s(w.container);var Z=i[w.hash].prevContainerSize;B.equals(Z)||(i[w.hash].needsResize=!0)}i[w.hash].needsResize&&D(w,B||s(w.container))}var fe=w.viewport.update(),de=w.world.update()||fe;fe&&w.raiseEvent("viewport-change"),w.referenceStrip&&(de=w.referenceStrip.update(w.viewport)||de);var Fe=i[w.hash].animating;!Fe&&de&&(w.raiseEvent("animation-start"),h(w));var _e=Fe&&!de;_e&&(i[w.hash].animating=!1),(de||_e||i[w.hash].forceRedraw||w.world.needsDraw())&&(ne(w),w._drawOverlays(),w.navigator&&w.navigator.update(w.viewport),i[w.hash].forceRedraw=!1,de&&w.raiseEvent("animation")),_e&&(w.raiseEvent("animation-finish"),i[w.hash].mouseInside||d(w)),i[w.hash].animating=de}}function ne(w){w.imageLoader.clear(),w.drawer.clear(),w.world.draw(),w.raiseEvent("update-viewport",{})}function N(w,B){return w?w+B:B}function le(){i[this.hash].lastZoomTime=n.now(),i[this.hash].zoomFactor=this.zoomPerSecond,i[this.hash].zooming=!0,re(this)}function we(){i[this.hash].lastZoomTime=n.now(),i[this.hash].zoomFactor=1/this.zoomPerSecond,i[this.hash].zooming=!0,re(this)}function ce(){i[this.hash].zooming=!1}function re(w){n.requestAnimationFrame(n.delegate(w,Ae))}function Ae(){var w,B,Z;i[this.hash].zooming&&this.viewport&&(w=n.now(),B=w-i[this.hash].lastZoomTime,Z=Math.pow(i[this.hash].zoomFactor,B/1e3),this.viewport.zoomBy(Z),this.viewport.applyConstraints(),i[this.hash].lastZoomTime=w,re(this))}function $e(){this.viewport&&(i[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function Ie(){this.viewport&&(i[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function Me(){this.buttonGroup&&(this.buttonGroup.emulateEnter(),this.buttonGroup.emulateLeave())}function Ne(){this.viewport&&this.viewport.goHome()}function at(){this.isFullPage()&&!n.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttonGroup&&this.buttonGroup.emulateLeave(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function wt(){if(this.viewport){var w=this.viewport.getRotation();this.viewport.flipped?w+=this.rotationIncrement:w-=this.rotationIncrement,this.viewport.setRotation(w)}}function Bt(){if(this.viewport){var w=this.viewport.getRotation();this.viewport.flipped?w-=this.rotationIncrement:w+=this.rotationIncrement,this.viewport.setRotation(w)}}function We(){this.viewport.toggleFlip()}}(e),function(n){n.Navigator=function(u){var c=u.viewer,d=this,f,h;u.element||u.id?(u.element?(u.id&&n.console.warn("Given option.id for Navigator was ignored since option.element was provided and is being used instead."),u.element.id?u.id=u.element.id:u.id="navigator-"+n.now(),this.element=u.element):this.element=document.getElementById(u.id),u.controlOptions={anchor:n.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(u.id="navigator-"+n.now(),this.element=n.makeNeutralElement("div"),u.controlOptions={anchor:n.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:u.autoFade},u.position&&(u.position==="BOTTOM_RIGHT"?u.controlOptions.anchor=n.ControlAnchor.BOTTOM_RIGHT:u.position==="BOTTOM_LEFT"?u.controlOptions.anchor=n.ControlAnchor.BOTTOM_LEFT:u.position==="TOP_RIGHT"?u.controlOptions.anchor=n.ControlAnchor.TOP_RIGHT:u.position==="TOP_LEFT"?u.controlOptions.anchor=n.ControlAnchor.TOP_LEFT:u.position==="ABSOLUTE"&&(u.controlOptions.anchor=n.ControlAnchor.ABSOLUTE,u.controlOptions.top=u.top,u.controlOptions.left=u.left,u.controlOptions.height=u.height,u.controlOptions.width=u.width))),this.element.id=u.id,this.element.className+=" navigator",u=n.extend(!0,{sizeRatio:n.DEFAULT_SETTINGS.navigatorSizeRatio},u,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:u.animationTime,autoResize:!1,minZoomImageRatio:1,background:u.background,opacity:u.opacity,borderColor:u.borderColor,displayRegionColor:u.displayRegionColor}),u.minPixelRatio=this.minPixelRatio=c.minPixelRatio,n.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new n.Point(1,1),this.totalBorderWidths=new n.Point(this.borderWidth*2,this.borderWidth*2).minus(this.fudge),u.controlOptions.anchor!==n.ControlAnchor.NONE&&function(y,g){y.margin="0px",y.border=g+"px solid "+u.borderColor,y.padding="0px",y.background=u.background,y.opacity=u.opacity,y.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=n.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(y,g){y.position="relative",y.top="0px",y.left="0px",y.fontSize="0px",y.overflow="hidden",y.border=g+"px solid "+u.displayRegionColor,y.margin="0px",y.padding="0px",y.background="transparent",y.float="left",y.cssFloat="left",y.styleFloat="left",y.zIndex=999999999,y.cursor="default",y.boxSizing="content-box"}(this.displayRegion.style,this.borderWidth),n.setElementPointerEventsNone(this.displayRegion),n.setElementTouchActionNone(this.displayRegion),this.displayRegionContainer=n.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",n.setElementPointerEventsNone(this.displayRegionContainer),n.setElementTouchActionNone(this.displayRegionContainer),c.addControl(this.element,u.controlOptions),this._resizeWithViewer=u.controlOptions.anchor!==n.ControlAnchor.ABSOLUTE&&u.controlOptions.anchor!==n.ControlAnchor.NONE,u.width&&u.height?(this.setWidth(u.width),this.setHeight(u.height)):this._resizeWithViewer&&(f=n.getElementSize(c.element),this.element.style.height=Math.round(f.y*u.sizeRatio)+"px",this.element.style.width=Math.round(f.x*u.sizeRatio)+"px",this.oldViewerSize=f,h=n.getElementSize(this.element),this.elementArea=h.x*h.y),this.oldContainerSize=new n.Point(0,0),n.Viewer.apply(this,[u]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer);function p(y,g){a(d.displayRegionContainer,y),a(d.displayRegion,-y),d.viewport.setRotation(y,g)}if(u.navigatorRotate){var m=u.viewer.viewport?u.viewer.viewport.getRotation():u.viewer.degrees||0;p(m,!0),u.viewer.addHandler("rotate",function(y){p(y.degrees,y.immediately)})}this.innerTracker.destroy(),this.innerTracker=new n.MouseTracker({userData:"Navigator.innerTracker",element:this.element,dragHandler:n.delegate(this,r),clickHandler:n.delegate(this,i),releaseHandler:n.delegate(this,s),scrollHandler:n.delegate(this,o),preProcessEventHandler:function(y){y.eventType==="wheel"&&(y.preventDefault=!0)}}),this.outerTracker.userData="Navigator.outerTracker",n.setElementPointerEventsNone(this.canvas),n.setElementPointerEventsNone(this.container),this.addHandler("reset-size",function(){d.viewport&&d.viewport.goHome(!0)}),c.world.addHandler("item-index-change",function(y){window.setTimeout(function(){var g=d.world.getItemAt(y.previousIndex);d.world.setItemIndex(g,y.newIndex)},1)}),c.world.addHandler("remove-item",function(y){var g=y.item,v=d._getMatchingItem(g);v&&d.world.removeItem(v)}),this.update(c.viewport)},n.extend(n.Navigator.prototype,n.EventSource.prototype,n.Viewer.prototype,{updateSize:function(){if(this.viewport){var u=new n.Point(this.container.clientWidth===0?1:this.container.clientWidth,this.container.clientHeight===0?1:this.container.clientHeight);u.equals(this.oldContainerSize)||(this.viewport.resize(u,!0),this.viewport.goHome(!0),this.oldContainerSize=u,this.drawer.clear(),this.world.draw())}},setWidth:function(u){this.width=u,this.element.style.width=typeof u=="number"?u+"px":u,this._resizeWithViewer=!1,this.updateSize()},setHeight:function(u){this.height=u,this.element.style.height=typeof u=="number"?u+"px":u,this._resizeWithViewer=!1,this.updateSize()},setFlip:function(u){return this.viewport.setFlip(u),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(u){l(this.displayRegion,u),l(this.canvas,u),l(this.element,u)},update:function(u){var c,d,f,h,p,m;if(c=n.getElementSize(this.viewer.element),this._resizeWithViewer&&c.x&&c.y&&!c.equals(this.oldViewerSize)&&(this.oldViewerSize=c,this.maintainSizeRatio||!this.elementArea?(d=c.x*this.sizeRatio,f=c.y*this.sizeRatio):(d=Math.sqrt(this.elementArea*(c.x/c.y)),f=this.elementArea/d),this.element.style.width=Math.round(d)+"px",this.element.style.height=Math.round(f)+"px",this.elementArea||(this.elementArea=d*f),this.updateSize()),u&&this.viewport){if(h=u.getBoundsNoRotate(!0),p=this.viewport.pixelFromPointNoRotate(h.getTopLeft(),!1),m=this.viewport.pixelFromPointNoRotate(h.getBottomRight(),!1).minus(this.totalBorderWidths),!this.navigatorRotate){var y=u.getRotation(!0);a(this.displayRegion,-y)}var g=this.displayRegion.style;g.display=this.world.getItemCount()?"block":"none",g.top=p.y.toFixed(2)+"px",g.left=p.x.toFixed(2)+"px";var v=m.x-p.x,b=m.y-p.y;g.width=Math.round(Math.max(v,0))+"px",g.height=Math.round(Math.max(b,0))+"px"}},addTiledImage:function(u){var c=this,d=u.originalTiledImage;delete u.original;var f=n.extend({},u,{success:function(h){var p=h.item;p._originalForNavigator=d,c._matchBounds(p,d,!0),c._matchOpacity(p,d),c._matchCompositeOperation(p,d);function m(){c._matchBounds(p,d)}function y(){c._matchOpacity(p,d)}function g(){c._matchCompositeOperation(p,d)}d.addHandler("bounds-change",m),d.addHandler("clip-change",m),d.addHandler("opacity-change",y),d.addHandler("composite-operation-change",g)}});return n.Viewer.prototype.addTiledImage.apply(this,[f])},destroy:function(){return n.Viewer.prototype.destroy.apply(this)},_getMatchingItem:function(u){for(var c=this.world.getItemCount(),d,f=0;f<c;f++)if(d=this.world.getItemAt(f),d._originalForNavigator===u)return d;return null},_matchBounds:function(u,c,d){var f=c.getBoundsNoRotate();u.setPosition(f.getTopLeft(),d),u.setWidth(f.width,d),u.setRotation(c.getRotation(),d),u.setClip(c.getClip()),u.setFlip(c.getFlip())},_matchOpacity:function(u,c){u.setOpacity(c.opacity)},_matchCompositeOperation:function(u,c){u.setCompositeOperation(c.compositeOperation)}});function i(u){var c={tracker:u.eventSource,position:u.position,quick:u.quick,shift:u.shift,originalEvent:u.originalEvent,preventDefaultAction:!1};if(this.viewer.raiseEvent("navigator-click",c),!c.preventDefaultAction&&u.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(u.position.x=this.viewport.getContainerSize().x-u.position.x);var d=this.viewport.pointFromPixel(u.position);this.panVertical?this.panHorizontal||(d.x=this.viewer.viewport.getCenter(!0).x):d.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(d),this.viewer.viewport.applyConstraints()}}function r(u){var c={tracker:u.eventSource,position:u.position,delta:u.delta,speed:u.speed,direction:u.direction,shift:u.shift,originalEvent:u.originalEvent,preventDefaultAction:!1};this.viewer.raiseEvent("navigator-drag",c),!c.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(u.delta.x=0),this.panVertical||(u.delta.y=0),this.viewer.viewport.flipped&&(u.delta.x=-u.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(u.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function s(u){u.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function o(u){var c={tracker:u.eventSource,position:u.position,scroll:u.scroll,shift:u.shift,originalEvent:u.originalEvent,preventDefault:u.preventDefault};this.viewer.raiseEvent("navigator-scroll",c),u.preventDefault=c.preventDefault}function a(u,c){l(u,"rotate("+c+"deg)")}function l(u,c){u.style.webkitTransform=c,u.style.mozTransform=c,u.style.msTransform=c,u.style.oTransform=c,u.style.transform=c}}(e),function(n){var i={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};n.extend(n,{getString:function(r){var s=r.split("."),o=null,a=arguments,l=i,u;for(u=0;u<s.length-1;u++)l=l[s[u]]||{};return o=l[s[u]],typeof o!="string"&&(n.console.error("Untranslated source string:",r),o=""),o.replace(/\{\d+\}/g,function(c){var d=parseInt(c.match(/\d+/),10)+1;return d<a.length?a[d]:""})},setString:function(r,s){var o=r.split("."),a=i,l;for(l=0;l<o.length-1;l++)a[o[l]]||(a[o[l]]={}),a=a[o[l]];a[o[l]]=s}})}(e),function(n){n.Point=function(i,r){this.x=typeof i=="number"?i:0,this.y=typeof r=="number"?r:0},n.Point.prototype={clone:function(){return new n.Point(this.x,this.y)},plus:function(i){return new n.Point(this.x+i.x,this.y+i.y)},minus:function(i){return new n.Point(this.x-i.x,this.y-i.y)},times:function(i){return new n.Point(this.x*i,this.y*i)},divide:function(i){return new n.Point(this.x/i,this.y/i)},negate:function(){return new n.Point(-this.x,-this.y)},distanceTo:function(i){return Math.sqrt(Math.pow(this.x-i.x,2)+Math.pow(this.y-i.y,2))},squaredDistanceTo:function(i){return Math.pow(this.x-i.x,2)+Math.pow(this.y-i.y,2)},apply:function(i){return new n.Point(i(this.x),i(this.y))},equals:function(i){return i instanceof n.Point&&this.x===i.x&&this.y===i.y},rotate:function(i,r){r=r||new n.Point(0,0);var s,o;if(i%90===0){var a=n.positiveModulo(i,360);switch(a){case 0:s=1,o=0;break;case 90:s=0,o=1;break;case 180:s=-1,o=0;break;case 270:s=0,o=-1;break}}else{var l=i*Math.PI/180;s=Math.cos(l),o=Math.sin(l)}var u=s*(this.x-r.x)-o*(this.y-r.y)+r.x,c=o*(this.x-r.x)+s*(this.y-r.y)+r.y;return new n.Point(u,c)},toString:function(){return"("+Math.round(this.x*100)/100+","+Math.round(this.y*100)/100+")"}}}(e),function(n){n.TileSource=function(r,s,o,a,l,u){var c=this,d=arguments,f,h;if(n.isPlainObject(r)?f=r:f={width:d[0],height:d[1],tileSize:d[2],tileOverlap:d[3],minLevel:d[4],maxLevel:d[5]},n.EventSource.call(this),n.extend(!0,this,f),!this.success){for(h=0;h<arguments.length;h++)if(n.isFunction(arguments[h])){this.success=arguments[h];break}}this.success&&this.addHandler("ready",function(p){c.success(p)}),n.type(arguments[0])==="string"&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new n.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=f.width&&f.height?f.width/f.height:1,this.dimensions=new n.Point(f.width,f.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=f.tileOverlap?f.tileOverlap:0,this.minLevel=f.minLevel?f.minLevel:0,this.maxLevel=f.maxLevel!==void 0&&f.maxLevel!==null?f.maxLevel:f.width&&f.height?Math.ceil(Math.log(Math.max(f.width,f.height))/Math.log(2)):0,this.success&&n.isFunction(this.success)&&this.success(this))},n.TileSource.prototype={getTileSize:function(r){return n.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(r){return this._tileWidth?this._tileWidth:this.getTileSize(r)},getTileHeight:function(r){return this._tileHeight?this._tileHeight:this.getTileSize(r)},setMaxLevel:function(r){this.maxLevel=r,this._memoizeLevelScale()},getLevelScale:function(r){return this._memoizeLevelScale(),this.getLevelScale(r)},_memoizeLevelScale:function(){var r={},s;for(s=0;s<=this.maxLevel;s++)r[s]=1/Math.pow(2,this.maxLevel-s);this.getLevelScale=function(o){return r[o]}},getNumTiles:function(r){var s=this.getLevelScale(r),o=Math.ceil(s*this.dimensions.x/this.getTileWidth(r)),a=Math.ceil(s*this.dimensions.y/this.getTileHeight(r));return new n.Point(o,a)},getPixelRatio:function(r){var s=this.dimensions.times(this.getLevelScale(r)),o=1/s.x*n.pixelDensityRatio,a=1/s.y*n.pixelDensityRatio;return new n.Point(o,a)},getClosestLevel:function(){var r,s;for(r=this.minLevel+1;r<=this.maxLevel&&(s=this.getNumTiles(r),!(s.x>1||s.y>1));r++);return r-1},getTileAtPoint:function(r,s){var o=s.x>=0&&s.x<=1&&s.y>=0&&s.y<=1/this.aspectRatio;n.console.assert(o,"[TileSource.getTileAtPoint] must be called with a valid point.");var a=this.dimensions.x*this.getLevelScale(r),l=s.x*a,u=s.y*a,c=Math.floor(l/this.getTileWidth(r)),d=Math.floor(u/this.getTileHeight(r));s.x>=1&&(c=this.getNumTiles(r).x-1);var f=1e-15;return s.y>=1/this.aspectRatio-f&&(d=this.getNumTiles(r).y-1),new n.Point(c,d)},getTileBounds:function(r,s,o,a){var l=this.dimensions.times(this.getLevelScale(r)),u=this.getTileWidth(r),c=this.getTileHeight(r),d=s===0?0:u*s-this.tileOverlap,f=o===0?0:c*o-this.tileOverlap,h=u+(s===0?1:2)*this.tileOverlap,p=c+(o===0?1:2)*this.tileOverlap,m=1/l.x;return h=Math.min(h,l.x-d),p=Math.min(p,l.y-f),a?new n.Rect(0,0,h,p):new n.Rect(d*m,f*m,h*m,p*m)},getImageInfo:function(r){var s=this,o,a,l,u,c,d,f;r&&(c=r.split("/"),d=c[c.length-1],f=d.lastIndexOf("."),f>-1&&(c[c.length-1]=d.slice(0,f)));var h=null;if(this.splitHashDataForPost){var p=r.indexOf("#");p!==-1&&(h=r.substring(p+1),r=r.substr(0,p))}a=function(m){typeof m=="string"&&(m=n.parseXml(m));var y=n.TileSource.determineType(s,m,r);if(!y){s.raiseEvent("open-failed",{message:"Unable to load TileSource",source:r});return}u=y.prototype.configure.apply(s,[m,r,h]),u.ajaxWithCredentials===void 0&&(u.ajaxWithCredentials=s.ajaxWithCredentials),l=new y(u),s.ready=!0,s.raiseEvent("ready",{tileSource:l})},r.match(/\.js$/)?(o=r.split("/").pop().replace(".js",""),n.jsonp({url:r,async:!1,callbackName:o,callback:a})):n.makeAjaxRequest({url:r,postData:h,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(m){var y=i(m);a(y)},error:function(m,y){var g;try{g="HTTP "+m.status+" attempting to load TileSource: "+r}catch{var v;typeof y>"u"||!y.toString?v="Unknown error":v=y.toString(),g=v+" attempting to load TileSource: "+r}n.console.error(g),s.raiseEvent("open-failed",{message:g,source:r,postData:h})}})},supports:function(r,s){return!1},configure:function(r,s,o){throw new Error("Method not implemented.")},getTileUrl:function(r,s,o){throw new Error("Method not implemented.")},getTilePostData:function(r,s,o){return null},getTileAjaxHeaders:function(r,s,o){return{}},getTileHashKey:function(r,s,o,a,l,u){function c(d){return l?d+"+"+JSON.stringify(l):d}return c(typeof a!="string"?r+"/"+s+"_"+o:a)},tileExists:function(r,s,o){var a=this.getNumTiles(r);return r>=this.minLevel&&r<=this.maxLevel&&s>=0&&o>=0&&s<a.x&&o<a.y},hasTransparency:function(r,s,o,a){return!!r||s.match(".png")},downloadTileStart:function(r){var s=r.userData,o=new Image;s.image=o,s.request=null;var a=function(l){if(!o){r.finish(null,s.request,"Image load failed: undefined Image instance.");return}o.onload=o.onerror=o.onabort=null,r.finish(l?null:o,s.request,l)};o.onload=function(){a()},o.onabort=o.onerror=function(){a("Image load aborted.")},r.loadWithAjax?s.request=n.makeAjaxRequest({url:r.src,withCredentials:r.ajaxWithCredentials,headers:r.ajaxHeaders,responseType:"arraybuffer",postData:r.postData,success:function(l){var u;try{u=new window.Blob([l.response])}catch(f){var c=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(f.name==="TypeError"&&c){var d=new c;d.append(l.response),u=d.getBlob()}}u.size===0?a("Empty image response."):o.src=(window.URL||window.webkitURL).createObjectURL(u)},error:function(l){a("Image load aborted - XHR error")}}):(r.crossOriginPolicy!==!1&&(o.crossOrigin=r.crossOriginPolicy),o.src=r.src)},downloadTileAbort:function(r){r.userData.request&&r.userData.request.abort();var s=r.userData.image;r.userData.image&&(s.onload=s.onerror=s.onabort=null)},createTileCache:function(r,s,o){r._data=s},destroyTileCache:function(r){r._data=null,r._renderedContext=null},getTileCacheData:function(r){return r._data},getTileCacheDataAsImage:function(r){return r._data},getTileCacheDataAsContext2D:function(r){if(!r._renderedContext){var s=document.createElement("canvas");s.width=r._data.width,s.height=r._data.height,r._renderedContext=s.getContext("2d"),r._renderedContext.drawImage(r._data,0,0),r._data=null}return r._renderedContext}},n.extend(!0,n.TileSource.prototype,n.EventSource.prototype);function i(r){var s=r.responseText,o=r.status,a,l;if(r){if(r.status!==200&&r.status!==0)throw o=r.status,a=o===404?"Not Found":r.statusText,new Error(n.getString("Errors.Status",o,a))}else throw new Error(n.getString("Errors.Security"));if(s.match(/^\s*<.*/))try{l=r.responseXML&&r.responseXML.documentElement?r.responseXML:n.parseXml(s)}catch{l=r.responseText}else if(s.match(/\s*[{[].*/))try{l=n.parseJSON(s)}catch{l=s}else l=s;return l}n.TileSource.determineType=function(r,s,o){var a;for(a in e)if(a.match(/.+TileSource$/)&&n.isFunction(e[a])&&n.isFunction(e[a].prototype.supports)&&e[a].prototype.supports.call(r,s,o))return e[a];return n.console.error("No TileSource was able to open %s %s",o,s),null}}(e),function(n){n.DziTileSource=function(s,o,a,l,u,c,d,f,h){var p,m,y,g;if(n.isPlainObject(s)?g=s:g={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=g.tilesUrl,this.fileFormat=g.fileFormat,this.displayRects=g.displayRects,this.displayRects)for(p=this.displayRects.length-1;p>=0;p--)for(m=this.displayRects[p],y=m.minLevel;y<=m.maxLevel;y++)this._levelRects[y]||(this._levelRects[y]=[]),this._levelRects[y].push(m);n.TileSource.apply(this,[g])},n.extend(n.DziTileSource.prototype,n.TileSource.prototype,{supports:function(s,o){var a;return s.Image?a=s.Image.xmlns:s.documentElement&&(s.documentElement.localName==="Image"||s.documentElement.tagName==="Image")&&(a=s.documentElement.namespaceURI),a=(a||"").toLowerCase(),a.indexOf("schemas.microsoft.com/deepzoom/2008")!==-1||a.indexOf("schemas.microsoft.com/deepzoom/2009")!==-1},configure:function(s,o,a){var l;return n.isPlainObject(s)?l=r(this,s):l=i(this,s),o&&!l.tilesUrl&&(l.tilesUrl=o.replace(/([^/]+?)(\.(dzi|xml|js)?(\?[^/]*)?)?\/?$/,"$1_files/"),o.search(/\.(dzi|xml|js)\?/)!==-1?l.queryParams=o.match(/\?.*/):l.queryParams=""),l},getTileUrl:function(s,o,a){return[this.tilesUrl,s,"/",o,"_",a,".",this.fileFormat,this.queryParams].join("")},tileExists:function(s,o,a){var l=this._levelRects[s],u,c,d,f,h,p,m;if(this.minLevel&&s<this.minLevel||this.maxLevel&&s>this.maxLevel)return!1;if(!l||!l.length)return!0;for(m=l.length-1;m>=0;m--)if(u=l[m],!(s<u.minLevel||s>u.maxLevel)&&(c=this.getLevelScale(s),d=u.x*c,f=u.y*c,h=d+u.width*c,p=f+u.height*c,d=Math.floor(d/this._tileWidth),f=Math.floor(f/this._tileWidth),h=Math.ceil(h/this._tileWidth),p=Math.ceil(p/this._tileWidth),d<=o&&o<h&&f<=a&&a<p))return!0;return!1}});function i(s,o){if(!o||!o.documentElement)throw new Error(n.getString("Errors.Xml"));var a=o.documentElement,l=a.localName||a.tagName,u=o.documentElement.namespaceURI,c=null,d=[],f,h,p,m,y;if(l==="Image")try{if(m=a.getElementsByTagName("Size")[0],m===void 0&&(m=a.getElementsByTagNameNS(u,"Size")[0]),c={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:a.getAttribute("Url"),Format:a.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(a.getAttribute("Overlap"),10),TileSize:parseInt(a.getAttribute("TileSize"),10),Size:{Height:parseInt(m.getAttribute("Height"),10),Width:parseInt(m.getAttribute("Width"),10)}}},!n.imageFormatSupported(c.Image.Format))throw new Error(n.getString("Errors.ImageFormat",c.Image.Format.toUpperCase()));for(f=a.getElementsByTagName("DisplayRect"),f===void 0&&(f=a.getElementsByTagNameNS(u,"DisplayRect")[0]),y=0;y<f.length;y++)h=f[y],p=h.getElementsByTagName("Rect")[0],p===void 0&&(p=h.getElementsByTagNameNS(u,"Rect")[0]),d.push({Rect:{X:parseInt(p.getAttribute("X"),10),Y:parseInt(p.getAttribute("Y"),10),Width:parseInt(p.getAttribute("Width"),10),Height:parseInt(p.getAttribute("Height"),10),MinLevel:parseInt(h.getAttribute("MinLevel"),10),MaxLevel:parseInt(h.getAttribute("MaxLevel"),10)}});return d.length&&(c.Image.DisplayRect=d),r(s,c)}catch(b){throw b instanceof Error?b:new Error(n.getString("Errors.Dzi"))}else{if(l==="Collection")throw new Error(n.getString("Errors.Dzc"));if(l==="Error"){var g=a.getElementsByTagName("Message")[0],v=g.firstChild.nodeValue;throw new Error(v)}}throw new Error(n.getString("Errors.Dzi"))}function r(s,o){var a=o.Image,l=a.Url,u=a.Format,c=a.Size,d=a.DisplayRect||[],f=parseInt(c.Width,10),h=parseInt(c.Height,10),p=parseInt(a.TileSize,10),m=parseInt(a.Overlap,10),y=[],g,v;for(v=0;v<d.length;v++)g=d[v].Rect,y.push(new n.DisplayRect(parseInt(g.X,10),parseInt(g.Y,10),parseInt(g.Width,10),parseInt(g.Height,10),parseInt(g.MinLevel,10),parseInt(g.MaxLevel,10)));return n.extend(!0,{width:f,height:h,tileSize:p,tileOverlap:m,minLevel:null,maxLevel:null,tilesUrl:l,fileFormat:u,displayRects:y},o)}}(e),function(n){n.IIIFTileSource=function(a){if(n.extend(!0,this,a),this._id=this["@id"]||this.id||this.identifier||null,!(this.height&&this.width&&this._id))throw new Error("IIIF required parameters (width, height, or id) not provided.");if(a.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=a.version,this.tile_width&&this.tile_height)a.tileWidth=this.tile_width,a.tileHeight=this.tile_height;else if(this.tile_width)a.tileSize=this.tile_width;else if(this.tile_height)a.tileSize=this.tile_height;else if(this.tiles)if(this.tiles.length===1)a.tileWidth=this.tiles[0].width,a.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var l=0;l<this.tiles.length;l++)for(var u=0;u<this.tiles[l].scaleFactors.length;u++){var c=this.tiles[l].scaleFactors[u];this.scale_factors.push(c),a.tileSizePerScaleFactor[c]={width:this.tiles[l].width,height:this.tiles[l].height||this.tiles[l].width}}}else if(i(a)){for(var d=Math.min(this.height,this.width),f=[256,512,1024],h=[],p=0;p<f.length;p++)f[p]<=d&&h.push(f[p]);h.length>0?a.tileSize=Math.max.apply(null,h):a.tileSize=d}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,a.levels=r(this),n.extend(!0,a,{width:a.levels[a.levels.length-1].width,height:a.levels[a.levels.length-1].height,tileSize:Math.max(a.height,a.width),tileOverlap:0,minLevel:0,maxLevel:a.levels.length-1}),this.levels=a.levels):n.console.error("Nothing in the info.json to construct image pyramids from");if(!a.maxLevel&&!this.emulateLegacyImagePyramid)if(!this.scale_factors)a.maxLevel=Number(Math.round(Math.log(Math.max(this.width,this.height),2)));else{var m=Math.max.apply(null,this.scale_factors);a.maxLevel=Math.round(Math.log(m)*Math.LOG2E)}if(this.sizes){var y=this.sizes.length;(y===a.maxLevel||y===a.maxLevel+1)&&(this.levelSizes=this.sizes.slice().sort(function(g,v){return g.width-v.width}),y===a.maxLevel&&this.levelSizes.push({width:this.width,height:this.height}))}n.TileSource.apply(this,[a])},n.extend(n.IIIFTileSource.prototype,n.TileSource.prototype,{supports:function(a,l){return a.protocol&&a.protocol==="http://iiif.io/api/image"||a["@context"]&&(a["@context"]==="http://library.stanford.edu/iiif/image-api/1.1/context.json"||a["@context"]==="http://iiif.io/api/image/1/context.json")||a.profile&&a.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")===0||a.identifier&&a.width&&a.height?!0:!!(a.documentElement&&a.documentElement.tagName==="info"&&a.documentElement.namespaceURI==="http://library.stanford.edu/iiif/image-api/ns/")},configure:function(a,l,u){if(n.isPlainObject(a)){if(!a["@context"])a["@context"]="http://iiif.io/api/image/1.0/context.json",a["@id"]=l.replace("/info.json",""),a.version=1;else{var d=a["@context"];if(Array.isArray(d)){for(var f=0;f<d.length;f++)if(typeof d[f]=="string"&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(d[f])||d[f]==="http://library.stanford.edu/iiif/image-api/1.1/context.json")){d=d[f];break}}switch(d){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":a.version=1;break;case"http://iiif.io/api/image/2/context.json":a.version=2;break;case"http://iiif.io/api/image/3/context.json":a.version=3;break;default:n.console.error("Data has a @context property which contains no known IIIF context URI.")}}if(a.preferredFormats){for(var h=0;h<a.preferredFormats.length;h++)if(e.imageFormatSupported(a.preferredFormats[h])){a.tileFormat=a.preferredFormats[h];break}}return a}else{var c=s(a);return c["@context"]="http://iiif.io/api/image/1.0/context.json",c["@id"]=l.replace("/info.xml",""),c.version=1,c}},getTileWidth:function(a){if(this.emulateLegacyImagePyramid)return n.TileSource.prototype.getTileWidth.call(this,a);var l=Math.pow(2,this.maxLevel-a);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[l]?this.tileSizePerScaleFactor[l].width:this._tileWidth},getTileHeight:function(a){if(this.emulateLegacyImagePyramid)return n.TileSource.prototype.getTileHeight.call(this,a);var l=Math.pow(2,this.maxLevel-a);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[l]?this.tileSizePerScaleFactor[l].height:this._tileHeight},getLevelScale:function(a){if(this.emulateLegacyImagePyramid){var l=NaN;return this.levels.length>0&&a>=this.minLevel&&a<=this.maxLevel&&(l=this.levels[a].width/this.levels[this.maxLevel].width),l}return n.TileSource.prototype.getLevelScale.call(this,a)},getNumTiles:function(a){if(this.emulateLegacyImagePyramid){var l=this.getLevelScale(a);return l?new n.Point(1,1):new n.Point(0,0)}if(this.levelSizes){var u=this.levelSizes[a],c=Math.ceil(u.width/this.getTileWidth(a)),d=Math.ceil(u.height/this.getTileHeight(a));return new n.Point(c,d)}else return n.TileSource.prototype.getNumTiles.call(this,a)},getTileAtPoint:function(a,l){if(this.emulateLegacyImagePyramid)return new n.Point(0,0);if(this.levelSizes){var u=l.x>=0&&l.x<=1&&l.y>=0&&l.y<=1/this.aspectRatio;n.console.assert(u,"[TileSource.getTileAtPoint] must be called with a valid point.");var c=this.levelSizes[a].width,d=l.x*c,f=l.y*c,h=Math.floor(d/this.getTileWidth(a)),p=Math.floor(f/this.getTileHeight(a));l.x>=1&&(h=this.getNumTiles(a).x-1);var m=1e-15;return l.y>=1/this.aspectRatio-m&&(p=this.getNumTiles(a).y-1),new n.Point(h,p)}return n.TileSource.prototype.getTileAtPoint.call(this,a,l)},getTileUrl:function(a,l,u){if(this.emulateLegacyImagePyramid){var c=null;return this.levels.length>0&&a>=this.minLevel&&a<=this.maxLevel&&(c=this.levels[a].url),c}var d="0",f=Math.pow(.5,this.maxLevel-a),h,p,m,y,g,v,b,T,S,_,A,P,O,x,L,M;return this.levelSizes?(h=this.levelSizes[a].width,p=this.levelSizes[a].height):(h=Math.ceil(this.width*f),p=Math.ceil(this.height*f)),m=this.getTileWidth(a),y=this.getTileHeight(a),g=Math.round(m/f),v=Math.round(y/f),this.version===1?L="native."+this.tileFormat:L="default."+this.tileFormat,h<m&&p<y?(this.version===2&&h===this.width?P="full":this.version===3&&h===this.width&&p===this.height?P="max":this.version===3?P=h+","+p:P=h+",",b="full"):(T=l*g,S=u*v,_=Math.min(g,this.width-T),A=Math.min(v,this.height-S),l===0&&u===0&&_===this.width&&A===this.height?b="full":b=[T,S,_,A].join(","),O=Math.min(m,h-l*m),x=Math.min(y,p-u*y),this.version===2&&O===this.width?P="full":this.version===3&&O===this.width&&x===this.height?P="max":this.version===3?P=O+","+x:P=O+","),M=[this._id,b,P,d,L].join("/"),M},__testonly__:{canBeTiled:i,constructLevels:r}});function i(a){var l=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"],u=Array.isArray(a.profile)?a.profile[0]:a.profile,c=l.indexOf(u)!==-1,d=!1;return a.version===2&&a.profile.length>1&&a.profile[1].supports&&(d=a.profile[1].supports.indexOf("sizeByW")!==-1),a.version===3&&a.extraFeatures&&(d=a.extraFeatures.indexOf("sizeByWh")!==-1),!c||d}function r(a){for(var l=[],u=0;u<a.sizes.length;u++)l.push({url:a._id+"/full/"+a.sizes[u].width+","+(a.version===3?a.sizes[u].height:"")+"/0/default."+a.tileFormat,width:a.sizes[u].width,height:a.sizes[u].height});return l.sort(function(c,d){return c.width-d.width})}function s(a){if(!a||!a.documentElement)throw new Error(n.getString("Errors.Xml"));var l=a.documentElement,u=l.tagName,c=null;if(u==="info")try{return c={},o(l,c),c}catch(d){throw d instanceof Error?d:new Error(n.getString("Errors.IIIF"))}throw new Error(n.getString("Errors.IIIF"))}function o(a,l,u){var c,d;if(a.nodeType===3&&u)d=a.nodeValue.trim(),d.match(/^\d*$/)&&(d=Number(d)),l[u]?(n.isArray(l[u])||(l[u]=[l[u]]),l[u].push(d)):l[u]=d;else if(a.nodeType===1)for(c=0;c<a.childNodes.length;c++)o(a.childNodes[c],l,a.nodeName)}}(e),function(n){n.OsmTileSource=function(i,r,s,o,a){var l;n.isPlainObject(i)?l=i:l={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},(!l.width||!l.height)&&(l.width=65572864,l.height=65572864),l.tileSize||(l.tileSize=256,l.tileOverlap=0),l.tilesUrl||(l.tilesUrl="http://tile.openstreetmap.org/"),l.minLevel=8,n.TileSource.apply(this,[l])},n.extend(n.OsmTileSource.prototype,n.TileSource.prototype,{supports:function(i,r){return i.type&&i.type==="openstreetmaps"},configure:function(i,r,s){return i},getTileUrl:function(i,r,s){return this.tilesUrl+(i-8)+"/"+r+"/"+s+".png"}})}(e),function(n){n.TmsTileSource=function(i,r,s,o,a){var l;n.isPlainObject(i)?l=i:l={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var u=Math.ceil(l.width/256)*256,c=Math.ceil(l.height/256)*256,d;u>c?d=u/256:d=c/256,l.maxLevel=Math.ceil(Math.log(d)/Math.log(2))-1,l.tileSize=256,l.width=u,l.height=c,n.TileSource.apply(this,[l])},n.extend(n.TmsTileSource.prototype,n.TileSource.prototype,{supports:function(i,r){return i.type&&i.type==="tiledmapservice"},configure:function(i,r,s){return i},getTileUrl:function(i,r,s){var o=this.getNumTiles(i).y-1;return this.tilesUrl+i+"/"+r+"/"+(o-s)+".png"}})}(e),function(n){n.ZoomifyTileSource=function(i){typeof i.tileSize>"u"&&(i.tileSize=256),typeof i.fileFormat>"u"&&(i.fileFormat="jpg",this.fileFormat=i.fileFormat);var r={x:i.width,y:i.height};for(i.imageSizes=[{x:i.width,y:i.height}],i.gridSize=[this._getGridSize(i.width,i.height,i.tileSize)];parseInt(r.x,10)>i.tileSize||parseInt(r.y,10)>i.tileSize;)r.x=Math.floor(r.x/2),r.y=Math.floor(r.y/2),i.imageSizes.push({x:r.x,y:r.y}),i.gridSize.push(this._getGridSize(r.x,r.y,i.tileSize));i.imageSizes.reverse(),i.gridSize.reverse(),i.minLevel=0,i.maxLevel=i.gridSize.length-1,e.TileSource.apply(this,[i])},n.extend(n.ZoomifyTileSource.prototype,n.TileSource.prototype,{_getGridSize:function(i,r,s){return{x:Math.ceil(i/s),y:Math.ceil(r/s)}},_calculateAbsoluteTileNumber:function(i,r,s){for(var o=0,a={},l=0;l<i;l++)a=this.gridSize[l],o+=a.x*a.y;return a=this.gridSize[i],o+=a.x*s+r,o},supports:function(i,r){return i.type&&i.type==="zoomifytileservice"},configure:function(i,r,s){return i},getTileUrl:function(i,r,s){var o=0,a=this._calculateAbsoluteTileNumber(i,r,s);return o=Math.floor(a/256),this.tilesUrl+"TileGroup"+o+"/"+i+"-"+r+"-"+s+"."+this.fileFormat}})}(e),function(n){n.LegacyTileSource=function(o){var a,l,u;n.isArray(o)&&(a={type:"legacy-image-pyramid",levels:o}),a.levels=i(a.levels),a.levels.length>0?(l=a.levels[a.levels.length-1].width,u=a.levels[a.levels.length-1].height):(l=0,u=0,n.console.error("No supported image formats found")),n.extend(!0,a,{width:l,height:u,tileSize:Math.max(u,l),tileOverlap:0,minLevel:0,maxLevel:a.levels.length>0?a.levels.length-1:0}),n.TileSource.apply(this,[a]),this.levels=a.levels},n.extend(n.LegacyTileSource.prototype,n.TileSource.prototype,{supports:function(o,a){return o.type&&o.type==="legacy-image-pyramid"||o.documentElement&&o.documentElement.getAttribute("type")==="legacy-image-pyramid"},configure:function(o,a,l){var u;return n.isPlainObject(o)?u=s(this,o):u=r(this,o),u},getLevelScale:function(o){var a=NaN;return this.levels.length>0&&o>=this.minLevel&&o<=this.maxLevel&&(a=this.levels[o].width/this.levels[this.maxLevel].width),a},getNumTiles:function(o){var a=this.getLevelScale(o);return a?new n.Point(1,1):new n.Point(0,0)},getTileUrl:function(o,a,l){var u=null;return this.levels.length>0&&o>=this.minLevel&&o<=this.maxLevel&&(u=this.levels[o].url),u}});function i(o){var a=[],l,u;for(u=0;u<o.length;u++)l=o[u],l.height&&l.width&&l.url?a.push({url:l.url,width:Number(l.width),height:Number(l.height)}):n.console.error("Unsupported image format: %s",l.url?l.url:"<no URL>");return a.sort(function(c,d){return c.height-d.height})}function r(o,a){if(!a||!a.documentElement)throw new Error(n.getString("Errors.Xml"));var l=a.documentElement,u=l.tagName,c=null,d=[],f,h;if(u==="image")try{for(c={type:l.getAttribute("type"),levels:[]},d=l.getElementsByTagName("level"),h=0;h<d.length;h++)f=d[h],c.levels.push({url:f.getAttribute("url"),width:parseInt(f.getAttribute("width"),10),height:parseInt(f.getAttribute("height"),10)});return s(o,c)}catch(p){throw p instanceof Error?p:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if(u==="collection")throw new Error("Legacy Image Pyramid Collections not yet supported.");if(u==="error")throw new Error("Error: "+a)}throw new Error("Unknown element "+u)}function s(o,a){return a.levels}}(e),function(n){n.ImageTileSource=function(i){i=n.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},i),n.TileSource.apply(this,[i])},n.extend(n.ImageTileSource.prototype,n.TileSource.prototype,{supports:function(i,r){return i.type&&i.type==="image"},configure:function(i,r,s){return i},getImageInfo:function(i){var r=this._image=new Image,s=this;this.crossOriginPolicy&&(r.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(r.useCredentials=this.ajaxWithCredentials),n.addEvent(r,"load",function(){s.width=r.naturalWidth,s.height=r.naturalHeight,s.aspectRatio=s.width/s.height,s.dimensions=new n.Point(s.width,s.height),s._tileWidth=s.width,s._tileHeight=s.height,s.tileOverlap=0,s.minLevel=0,s.levels=s._buildLevels(),s.maxLevel=s.levels.length-1,s.ready=!0,s.raiseEvent("ready",{tileSource:s})}),n.addEvent(r,"error",function(){s.raiseEvent("open-failed",{message:"Error loading image at "+i,source:i})}),r.src=i},getLevelScale:function(i){var r=NaN;return i>=this.minLevel&&i<=this.maxLevel&&(r=this.levels[i].width/this.levels[this.maxLevel].width),r},getNumTiles:function(i){var r=this.getLevelScale(i);return r?new n.Point(1,1):new n.Point(0,0)},getTileUrl:function(i,r,s){var o=null;return i>=this.minLevel&&i<=this.maxLevel&&(o=this.levels[i].url),o},getContext2D:function(i,r,s){var o=null;return i>=this.minLevel&&i<=this.maxLevel&&(o=this.levels[i].context2D),o},destroy:function(){this._freeupCanvasMemory()},_buildLevels:function(){var i=[{url:this._image.src,width:this._image.naturalWidth,height:this._image.naturalHeight}];if(!this.buildPyramid||!n.supportsCanvas||!this.useCanvas)return delete this._image,i;var r=this._image.naturalWidth,s=this._image.naturalHeight,o=document.createElement("canvas"),a=o.getContext("2d");if(o.width=r,o.height=s,a.drawImage(this._image,0,0,r,s),i[0].context2D=a,delete this._image,n.isCanvasTainted(o))return i;for(;r>=2&&s>=2;){r=Math.floor(r/2),s=Math.floor(s/2);var l=document.createElement("canvas"),u=l.getContext("2d");l.width=r,l.height=s,u.drawImage(o,0,0,r,s),i.splice(0,0,{context2D:u,width:r,height:s}),o=l,a=u}return i},_freeupCanvasMemory:function(){for(var i=0;i<this.levels.length;i++)this.levels[i].context2D&&(this.levels[i].context2D.canvas.height=0,this.levels[i].context2D.canvas.width=0)}})}(e),function(n){n.TileSourceCollection=function(i,r,s,o){n.console.error("TileSourceCollection is deprecated; use World instead")}}(e),function(n){n.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},n.Button=function(u){var c=this;n.EventSource.call(this),n.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:n.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:n.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null,userData:null},u),this.element=u.element||n.makeNeutralElement("div"),u.element||(this.imgRest=n.makeTransparentImage(this.srcRest),this.imgGroup=n.makeTransparentImage(this.srcGroup),this.imgHover=n.makeTransparentImage(this.srcHover),this.imgDown=n.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,n.setElementPointerEventsNone(this.imgRest),n.setElementPointerEventsNone(this.imgGroup),n.setElementPointerEventsNone(this.imgHover),n.setElementPointerEventsNone(this.imgDown),this.element.style.position="relative",n.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",n.Browser.vendor===n.BROWSERS.FIREFOX&&n.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=n.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new n.MouseTracker({userData:"Button.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(d){d.insideElementPressed?(a(c,n.ButtonState.DOWN),c.raiseEvent("enter",{originalEvent:d.originalEvent})):d.buttonDownAny||a(c,n.ButtonState.HOVER)},focusHandler:function(d){c.tracker.enterHandler(d),c.raiseEvent("focus",{originalEvent:d.originalEvent})},leaveHandler:function(d){l(c,n.ButtonState.GROUP),d.insideElementPressed&&c.raiseEvent("exit",{originalEvent:d.originalEvent})},blurHandler:function(d){c.tracker.leaveHandler(d),c.raiseEvent("blur",{originalEvent:d.originalEvent})},pressHandler:function(d){a(c,n.ButtonState.DOWN),c.raiseEvent("press",{originalEvent:d.originalEvent})},releaseHandler:function(d){d.insideElementPressed&&d.insideElementReleased?(l(c,n.ButtonState.HOVER),c.raiseEvent("release",{originalEvent:d.originalEvent})):d.insideElementPressed?l(c,n.ButtonState.GROUP):a(c,n.ButtonState.HOVER)},clickHandler:function(d){d.quick&&c.raiseEvent("click",{originalEvent:d.originalEvent})},keyHandler:function(d){d.keyCode===13?(c.raiseEvent("click",{originalEvent:d.originalEvent}),c.raiseEvent("release",{originalEvent:d.originalEvent}),d.preventDefault=!0):d.preventDefault=!1}}),l(this,n.ButtonState.REST)},n.extend(n.Button.prototype,n.EventSource.prototype,{notifyGroupEnter:function(){a(this,n.ButtonState.GROUP)},notifyGroupExit:function(){l(this,n.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,this.tracker.setTracking(!1),n.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,this.tracker.setTracking(!0),n.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()},destroy:function(){this.imgRest&&(this.element.removeChild(this.imgRest),this.imgRest=null),this.imgGroup&&(this.element.removeChild(this.imgGroup),this.imgGroup=null),this.imgHover&&(this.element.removeChild(this.imgHover),this.imgHover=null),this.imgDown&&(this.element.removeChild(this.imgDown),this.imgDown=null),this.removeAllHandlers(),this.tracker.destroy(),this.element=null}});function i(u){n.requestAnimationFrame(function(){r(u)})}function r(u){var c,d,f;u.shouldFade&&(c=n.now(),d=c-u.fadeBeginTime,f=1-d/u.fadeLength,f=Math.min(1,f),f=Math.max(0,f),u.imgGroup&&n.setElementOpacity(u.imgGroup,f,!0),f>0&&i(u))}function s(u){u.shouldFade=!0,u.fadeBeginTime=n.now()+u.fadeDelay,window.setTimeout(function(){i(u)},u.fadeDelay)}function o(u){u.shouldFade=!1,u.imgGroup&&n.setElementOpacity(u.imgGroup,1,!0)}function a(u,c){u.element.disabled||(c>=n.ButtonState.GROUP&&u.currentState===n.ButtonState.REST&&(o(u),u.currentState=n.ButtonState.GROUP),c>=n.ButtonState.HOVER&&u.currentState===n.ButtonState.GROUP&&(u.imgHover&&(u.imgHover.style.visibility=""),u.currentState=n.ButtonState.HOVER),c>=n.ButtonState.DOWN&&u.currentState===n.ButtonState.HOVER&&(u.imgDown&&(u.imgDown.style.visibility=""),u.currentState=n.ButtonState.DOWN))}function l(u,c){u.element.disabled||(c<=n.ButtonState.HOVER&&u.currentState===n.ButtonState.DOWN&&(u.imgDown&&(u.imgDown.style.visibility="hidden"),u.currentState=n.ButtonState.HOVER),c<=n.ButtonState.GROUP&&u.currentState===n.ButtonState.HOVER&&(u.imgHover&&(u.imgHover.style.visibility="hidden"),u.currentState=n.ButtonState.GROUP),c<=n.ButtonState.REST&&u.currentState===n.ButtonState.GROUP&&(s(u),u.currentState=n.ButtonState.REST))}}(e),function(n){n.ButtonGroup=function(i){n.extend(!0,this,{buttons:[],clickTimeThreshold:n.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:n.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},i);var r=this.buttons.concat([]),s=this,o;if(this.element=i.element||n.makeNeutralElement("div"),!i.group)for(this.element.style.display="inline-block",o=0;o<r.length;o++)this.element.appendChild(r[o].element);n.setElementTouchActionNone(this.element),this.tracker=new n.MouseTracker({userData:"ButtonGroup.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(a){var l;for(l=0;l<s.buttons.length;l++)s.buttons[l].notifyGroupEnter()},leaveHandler:function(a){var l;if(!a.insideElementPressed)for(l=0;l<s.buttons.length;l++)s.buttons[l].notifyGroupExit()}})},n.ButtonGroup.prototype={addButton:function(i){this.buttons.push(i),this.element.appendChild(i.element)},emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateLeave:function(){this.tracker.leaveHandler({eventSource:this.tracker})},destroy:function(){for(;this.buttons.length;){var i=this.buttons.pop();this.element.removeChild(i.element),i.destroy()}this.tracker.destroy(),this.element=null}}}(e),function(n){n.Rect=function(i,r,s,o,a){this.x=typeof i=="number"?i:0,this.y=typeof r=="number"?r:0,this.width=typeof s=="number"?s:0,this.height=typeof o=="number"?o:0,this.degrees=typeof a=="number"?a:0,this.degrees=n.positiveModulo(this.degrees,360);var l,u;this.degrees>=270?(l=this.getTopRight(),this.x=l.x,this.y=l.y,u=this.height,this.height=this.width,this.width=u,this.degrees-=270):this.degrees>=180?(l=this.getBottomRight(),this.x=l.x,this.y=l.y,this.degrees-=180):this.degrees>=90&&(l=this.getBottomLeft(),this.x=l.x,this.y=l.y,u=this.height,this.height=this.width,this.width=u,this.degrees-=90)},n.Rect.fromSummits=function(i,r,s){var o=i.distanceTo(r),a=i.distanceTo(s),l=r.minus(i),u=Math.atan(l.y/l.x);return l.x<0?u+=Math.PI:l.y<0&&(u+=2*Math.PI),new n.Rect(i.x,i.y,o,a,u/Math.PI*180)},n.Rect.prototype={clone:function(){return new n.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new n.Point(this.x,this.y)},getBottomRight:function(){return new n.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new n.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new n.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new n.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new n.Point(this.width,this.height)},equals:function(i){return i instanceof n.Rect&&this.x===i.x&&this.y===i.y&&this.width===i.width&&this.height===i.height&&this.degrees===i.degrees},times:function(i){return new n.Rect(this.x*i,this.y*i,this.width*i,this.height*i,this.degrees)},translate:function(i){return new n.Rect(this.x+i.x,this.y+i.y,this.width,this.height,this.degrees)},union:function(i){var r=this.getBoundingBox(),s=i.getBoundingBox(),o=Math.min(r.x,s.x),a=Math.min(r.y,s.y),l=Math.max(r.x+r.width,s.x+s.width),u=Math.max(r.y+r.height,s.y+s.height);return new n.Rect(o,a,l-o,u-a)},intersection:function(i){var r=1e-10,s=[],o=this.getTopLeft();i.containsPoint(o,r)&&s.push(o);var a=this.getTopRight();i.containsPoint(a,r)&&s.push(a);var l=this.getBottomLeft();i.containsPoint(l,r)&&s.push(l);var u=this.getBottomRight();i.containsPoint(u,r)&&s.push(u);var c=i.getTopLeft();this.containsPoint(c,r)&&s.push(c);var d=i.getTopRight();this.containsPoint(d,r)&&s.push(d);var f=i.getBottomLeft();this.containsPoint(f,r)&&s.push(f);var h=i.getBottomRight();this.containsPoint(h,r)&&s.push(h);for(var p=this._getSegments(),m=i._getSegments(),y=0;y<p.length;y++)for(var g=p[y],v=0;v<m.length;v++){var b=m[v],T=S(g[0],g[1],b[0],b[1]);T&&s.push(T)}function S(M,V,K,U){var j=V.minus(M),G=U.minus(K),H=-G.x*j.y+j.x*G.y;if(H===0)return null;var Y=(j.x*(M.y-K.y)-j.y*(M.x-K.x))/H,D=(G.x*(M.y-K.y)-G.y*(M.x-K.x))/H;return-r<=Y&&Y<=1-r&&-r<=D&&D<=1-r?new n.Point(M.x+D*j.x,M.y+D*j.y):null}if(s.length===0)return null;for(var _=s[0].x,A=s[0].x,P=s[0].y,O=s[0].y,x=1;x<s.length;x++){var L=s[x];L.x<_&&(_=L.x),L.x>A&&(A=L.x),L.y<P&&(P=L.y),L.y>O&&(O=L.y)}return new n.Rect(_,P,A-_,O-P)},_getSegments:function(){var i=this.getTopLeft(),r=this.getTopRight(),s=this.getBottomLeft(),o=this.getBottomRight();return[[i,r],[r,o],[o,s],[s,i]]},rotate:function(i,r){if(i=n.positiveModulo(i,360),i===0)return this.clone();r=r||this.getCenter();var s=this.getTopLeft().rotate(i,r),o=this.getTopRight().rotate(i,r),a=o.minus(s);a=a.apply(function(u){var c=1e-15;return Math.abs(u)<c?0:u});var l=Math.atan(a.y/a.x);return a.x<0?l+=Math.PI:a.y<0&&(l+=2*Math.PI),new n.Rect(s.x,s.y,this.width,this.height,l/Math.PI*180)},getBoundingBox:function(){if(this.degrees===0)return this.clone();var i=this.getTopLeft(),r=this.getTopRight(),s=this.getBottomLeft(),o=this.getBottomRight(),a=Math.min(i.x,r.x,s.x,o.x),l=Math.max(i.x,r.x,s.x,o.x),u=Math.min(i.y,r.y,s.y,o.y),c=Math.max(i.y,r.y,s.y,o.y);return new n.Rect(a,u,l-a,c-u)},getIntegerBoundingBox:function(){var i=this.getBoundingBox(),r=Math.floor(i.x),s=Math.floor(i.y),o=Math.ceil(i.width+i.x-r),a=Math.ceil(i.height+i.y-s);return new n.Rect(r,s,o,a)},containsPoint:function(i,r){r=r||0;var s=this.getTopLeft(),o=this.getTopRight(),a=this.getBottomLeft(),l=o.minus(s),u=a.minus(s);return(i.x-s.x)*l.x+(i.y-s.y)*l.y>=-r&&(i.x-o.x)*l.x+(i.y-o.y)*l.y<=r&&(i.x-s.x)*u.x+(i.y-s.y)*u.y>=-r&&(i.x-a.x)*u.x+(i.y-a.y)*u.y<=r},toString:function(){return"["+Math.round(this.x*100)/100+", "+Math.round(this.y*100)/100+", "+Math.round(this.width*100)/100+"x"+Math.round(this.height*100)/100+", "+Math.round(this.degrees*100)/100+"deg]"}}}(e),function(n){var i={};n.ReferenceStrip=function(f){var h=this,p=f.viewer,m=n.getElementSize(p.element),y,g,v;for(f.id||(f.id="referencestrip-"+n.now(),this.element=n.makeNeutralElement("div"),this.element.id=f.id,this.element.className="referencestrip"),f=n.extend(!0,{sizeRatio:n.DEFAULT_SETTINGS.referenceStripSizeRatio,position:n.DEFAULT_SETTINGS.referenceStripPosition,scroll:n.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:n.DEFAULT_SETTINGS.clickTimeThreshold},f,{element:this.element}),n.extend(this,f),i[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,this.element.tabIndex=0,g=this.element.style,g.marginTop="0px",g.marginRight="0px",g.marginBottom="0px",g.marginLeft="0px",g.left="0px",g.bottom="0px",g.border="0px",g.background="#000",g.position="relative",n.setElementTouchActionNone(this.element),n.setElementOpacity(this.element,.8),this.viewer=p,this.tracker=new n.MouseTracker({userData:"ReferenceStrip.tracker",element:this.element,clickHandler:n.delegate(this,r),dragHandler:n.delegate(this,s),scrollHandler:n.delegate(this,o),enterHandler:n.delegate(this,l),leaveHandler:n.delegate(this,u),keyDownHandler:n.delegate(this,c),keyHandler:n.delegate(this,d),preProcessEventHandler:function(b){b.eventType==="wheel"&&(b.preventDefault=!0)}}),f.width&&f.height?(this.element.style.width=f.width+"px",this.element.style.height=f.height+"px",p.addControl(this.element,{anchor:n.ControlAnchor.BOTTOM_LEFT})):f.scroll==="horizontal"?(this.element.style.width=m.x*f.sizeRatio*p.tileSources.length+12*p.tileSources.length+"px",this.element.style.height=m.y*f.sizeRatio+"px",p.addControl(this.element,{anchor:n.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=m.y*f.sizeRatio*p.tileSources.length+12*p.tileSources.length+"px",this.element.style.width=m.x*f.sizeRatio+"px",p.addControl(this.element,{anchor:n.ControlAnchor.TOP_LEFT})),this.panelWidth=m.x*this.sizeRatio+8,this.panelHeight=m.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},v=0;v<p.tileSources.length;v++)y=n.makeNeutralElement("div"),y.id=this.element.id+"-"+v,y.style.width=h.panelWidth+"px",y.style.height=h.panelHeight+"px",y.style.display="inline",y.style.float="left",y.style.cssFloat="left",y.style.styleFloat="left",y.style.padding="2px",n.setElementTouchActionNone(y),n.setElementPointerEventsNone(y),this.element.appendChild(y),y.activePanel=!1,this.panels.push(y);a(this,this.scroll==="vertical"?m.y:m.x,0),this.setFocus(0)},n.ReferenceStrip.prototype={setFocus:function(f){var h=this.element.querySelector("#"+this.element.id+"-"+f),p=n.getElementSize(this.viewer.canvas),m=Number(this.element.style.width.replace("px","")),y=Number(this.element.style.height.replace("px","")),g=-Number(this.element.style.marginLeft.replace("px","")),v=-Number(this.element.style.marginTop.replace("px","")),b;this.currentSelected!==h&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=h,this.currentSelected.style.background="#999",this.scroll==="horizontal"?(b=Number(f)*(this.panelWidth+3),b>g+p.x-this.panelWidth?(b=Math.min(b,m-p.x),this.element.style.marginLeft=-b+"px",a(this,p.x,-b)):b<g&&(b=Math.max(0,b-p.x/2),this.element.style.marginLeft=-b+"px",a(this,p.x,-b))):(b=Number(f)*(this.panelHeight+3),b>v+p.y-this.panelHeight?(b=Math.min(b,y-p.y),this.element.style.marginTop=-b+"px",a(this,p.y,-b)):b<v&&(b=Math.max(0,b-p.y/2),this.element.style.marginTop=-b+"px",a(this,p.y,-b))),this.currentPage=f,l.call(this,{eventSource:this.tracker}))},update:function(){return!!i[this.id].animating},destroy:function(){if(this.miniViewers)for(var f in this.miniViewers)this.miniViewers[f].destroy();this.tracker.destroy(),this.element&&this.viewer.removeControl(this.element)}};function r(f){if(f.quick){var h;this.scroll==="horizontal"?h=Math.floor(f.position.x/(this.panelWidth+4)):h=Math.floor(f.position.y/this.panelHeight),this.viewer.goToPage(h)}this.element.focus()}function s(f){if(this.dragging=!0,this.element){var h=Number(this.element.style.marginLeft.replace("px","")),p=Number(this.element.style.marginTop.replace("px","")),m=Number(this.element.style.width.replace("px","")),y=Number(this.element.style.height.replace("px","")),g=n.getElementSize(this.viewer.canvas);this.scroll==="horizontal"?-f.delta.x>0?h>-(m-g.x)&&(this.element.style.marginLeft=h+f.delta.x*2+"px",a(this,g.x,h+f.delta.x*2)):-f.delta.x<0&&h<0&&(this.element.style.marginLeft=h+f.delta.x*2+"px",a(this,g.x,h+f.delta.x*2)):-f.delta.y>0?p>-(y-g.y)&&(this.element.style.marginTop=p+f.delta.y*2+"px",a(this,g.y,p+f.delta.y*2)):-f.delta.y<0&&p<0&&(this.element.style.marginTop=p+f.delta.y*2+"px",a(this,g.y,p+f.delta.y*2))}}function o(f){if(this.element){var h=Number(this.element.style.marginLeft.replace("px","")),p=Number(this.element.style.marginTop.replace("px","")),m=Number(this.element.style.width.replace("px","")),y=Number(this.element.style.height.replace("px","")),g=n.getElementSize(this.viewer.canvas);this.scroll==="horizontal"?f.scroll>0?h>-(m-g.x)&&(this.element.style.marginLeft=h-f.scroll*60+"px",a(this,g.x,h-f.scroll*60)):f.scroll<0&&h<0&&(this.element.style.marginLeft=h-f.scroll*60+"px",a(this,g.x,h-f.scroll*60)):f.scroll<0?p>g.y-y&&(this.element.style.marginTop=p+f.scroll*60+"px",a(this,g.y,p+f.scroll*60)):f.scroll>0&&p<0&&(this.element.style.marginTop=p+f.scroll*60+"px",a(this,g.y,p+f.scroll*60)),f.preventDefault=!0}}function a(f,h,p){var m,y,g,v,b,T;for(f.scroll==="horizontal"?m=f.panelWidth:m=f.panelHeight,y=Math.ceil(h/m)+5,g=Math.ceil((Math.abs(p)+h)/m)+1,y=g-y,y=y<0?0:y,b=y;b<g&&b<f.panels.length;b++)if(T=f.panels[b],!T.activePanel){var S,_=f.viewer.tileSources[b];_.referenceStripThumbnailUrl?S={type:"image",url:_.referenceStripThumbnailUrl}:S=_,v=new n.Viewer({id:T.id,tileSources:[S],element:T,navigatorSizeRatio:f.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:f.viewer.loadTilesWithAjax,ajaxHeaders:f.viewer.ajaxHeaders,useCanvas:f.useCanvas}),n.setElementPointerEventsNone(v.canvas),n.setElementPointerEventsNone(v.container),v.innerTracker.setTracking(!1),v.outerTracker.setTracking(!1),f.miniViewers[T.id]=v,T.activePanel=!0}}function l(f){var h=f.eventSource.element;this.scroll==="horizontal"?h.style.marginBottom="0px":h.style.marginLeft="0px"}function u(f){var h=f.eventSource.element;this.scroll==="horizontal"?h.style.marginBottom="-"+n.getElementSize(h).y/2+"px":h.style.marginLeft="-"+n.getElementSize(h).x/2+"px"}function c(f){if(!f.ctrl&&!f.alt&&!f.meta)switch(f.keyCode){case 38:o.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),f.preventDefault=!0;break;case 40:o.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),f.preventDefault=!0;break;case 37:o.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),f.preventDefault=!0;break;case 39:o.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),f.preventDefault=!0;break;default:f.preventDefault=!1;break}else f.preventDefault=!1}function d(f){if(!f.ctrl&&!f.alt&&!f.meta)switch(f.keyCode){case 61:o.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),f.preventDefault=!0;break;case 45:o.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),f.preventDefault=!0;break;case 48:case 119:case 87:o.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),f.preventDefault=!0;break;case 115:case 83:o.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),f.preventDefault=!0;break;case 97:o.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),f.preventDefault=!0;break;case 100:o.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),f.preventDefault=!0;break;default:f.preventDefault=!1;break}else f.preventDefault=!1}}(e),function(n){n.DisplayRect=function(i,r,s,o,a,l){n.Rect.apply(this,[i,r,s,o]),this.minLevel=a,this.maxLevel=l},n.extend(n.DisplayRect.prototype,n.Rect.prototype)}(e),function(n){n.Spring=function(r){var s=arguments;typeof r!="object"&&(r={initial:s.length&&typeof s[0]=="number"?s[0]:void 0,springStiffness:s.length>1?s[1].springStiffness:5,animationTime:s.length>1?s[1].animationTime:1.5}),n.console.assert(typeof r.springStiffness=="number"&&r.springStiffness!==0,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),n.console.assert(typeof r.animationTime=="number"&&r.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),r.exponential&&(this._exponential=!0,delete r.exponential),n.extend(!0,this,r),this.current={value:typeof this.initial=="number"?this.initial:this._exponential?0:1,time:n.now()},n.console.assert(!this._exponential||this.current.value!==0,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},n.Spring.prototype={resetTo:function(r){n.console.assert(!this._exponential||r!==0,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=r,this.start.time=this.target.time=this.current.time=n.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(r){n.console.assert(!this._exponential||r!==0,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=r,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(r){this.start.value+=r,this.target.value+=r,this._exponential&&(n.console.assert(this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(r){this._exponential=r,this._exponential&&(n.console.assert(this.current.value!==0&&this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=n.now();var r,s;this._exponential?(r=this.start._logValue,s=this.target._logValue):(r=this.start.value,s=this.target.value);var o=this.current.time>=this.target.time?s:r+(s-r)*i(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time)),a=this.current.value;return this._exponential?this.current.value=Math.exp(o):this.current.value=o,a!==this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}};function i(r,s){return(1-Math.exp(r*-s))/(1-Math.exp(-r))}}(e),function(n){n.ImageJob=function(r){n.extend(!0,this,{timeout:n.DEFAULT_SETTINGS.timeout,jobId:null,tries:0},r),this.data=null,this.userData={},this.errorMsg=null},n.ImageJob.prototype={start:function(){this.tries++;var r=this,s=this.abort;this.jobId=window.setTimeout(function(){r.finish(null,null,"Image load exceeded timeout ("+r.timeout+" ms)")},this.timeout),this.abort=function(){r.source.downloadTileAbort(r),typeof s=="function"&&s()},this.source.downloadTileStart(this)},finish:function(r,s,o){this.data=r,this.request=s,this.errorMsg=o,this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},n.ImageLoader=function(r){n.extend(!0,this,{jobLimit:n.DEFAULT_SETTINGS.imageLoaderLimit,timeout:n.DEFAULT_SETTINGS.timeout,jobQueue:[],failedTiles:[],jobsInProgress:0},r)},n.ImageLoader.prototype={addJob:function(r){if(!r.source){n.console.error("ImageLoader.prototype.addJob() requires [options.source]. TileSource since new API defines how images are fetched. Creating a dummy TileSource.");var s=n.TileSource.prototype;r.source={downloadTileStart:s.downloadTileStart,downloadTileAbort:s.downloadTileAbort}}var o=this,a=function(c){i(o,c,r.callback)},l={src:r.src,tile:r.tile||{},source:r.source,loadWithAjax:r.loadWithAjax,ajaxHeaders:r.loadWithAjax?r.ajaxHeaders:null,crossOriginPolicy:r.crossOriginPolicy,ajaxWithCredentials:r.ajaxWithCredentials,postData:r.postData,callback:a,abort:r.abort,timeout:this.timeout},u=new n.ImageJob(l);!this.jobLimit||this.jobsInProgress<this.jobLimit?(u.start(),this.jobsInProgress++):this.jobQueue.push(u)},clear:function(){for(var r=0;r<this.jobQueue.length;r++){var s=this.jobQueue[r];typeof s.abort=="function"&&s.abort()}this.jobQueue=[]}};function i(r,s,o){s.errorMsg!==""&&(s.data===null||s.data===void 0)&&s.tries<1+r.tileRetryMax&&r.failedTiles.push(s);var a;r.jobsInProgress--,(!r.jobLimit||r.jobsInProgress<r.jobLimit)&&r.jobQueue.length>0&&(a=r.jobQueue.shift(),a.start(),r.jobsInProgress++),r.tileRetryMax>0&&r.jobQueue.length===0&&(!r.jobLimit||r.jobsInProgress<r.jobLimit)&&r.failedTiles.length>0&&(a=r.failedTiles.shift(),setTimeout(function(){a.start()},r.tileRetryDelay),r.jobsInProgress++),o(s.data,s.errorMsg,s.request)}}(e),function(n){n.Tile=function(i,r,s,o,a,l,u,c,d,f,h,p){this.level=i,this.x=r,this.y=s,this.bounds=o,this.sourceBounds=f,this.exists=a,this._url=l,this.postData=h,this.context2D=u,this.loadWithAjax=c,this.ajaxHeaders=d,p===void 0&&(n.console.warn("Tile constructor needs 'cacheKey' variable: creation tile cache in Tile class is deprecated. TileSource.prototype.getTileHashKey will be used."),p=n.TileSource.prototype.getTileHashKey(i,r,s,l,d,h)),this.cacheKey=p,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.style=null,this.position=null,this.size=null,this.flipped=!1,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.hasTransparency=!1,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},n.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return console.warn("Tile.prototype._hasTransparencyChannel() has been deprecated and will be removed in the future. Use TileSource.prototype.hasTransparency() instead."),!!this.context2D||this.getUrl().match(".png")},drawHTML:function(i){if(!this.cacheImageRecord){n.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString());return}if(!this.loaded){n.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}if(!this.element){var r=this.getImage();if(!r)return;this.element=n.makeNeutralElement("div"),this.imgElement=r.cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"}this.element.parentNode!==i&&i.appendChild(this.element),this.imgElement.parentNode!==this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",this.flipped&&(this.style.transform="scaleX(-1)"),n.setElementOpacity(this.element,this.opacity)},get image(){return n.console.error("[Tile.image] property has been deprecated. Use [Tile.prototype.getImage] instead."),this.getImage()},get url(){return n.console.error("[Tile.url] property has been deprecated. Use [Tile.prototype.getUrl] instead."),this.getUrl()},getImage:function(){return this.cacheImageRecord.getImage()},getUrl:function(){return typeof this._url=="function"?this._url():this._url},getCanvasContext:function(){return this.context2D||this.cacheImageRecord.getRenderedContext()},drawCanvas:function(i,r,s,o,a,l){var u=this.position.times(n.pixelDensityRatio),c=this.size.times(n.pixelDensityRatio),d;if(!this.context2D&&!this.cacheImageRecord){n.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString());return}if(d=this.getCanvasContext(),!this.loaded||!d){n.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}i.save(),i.globalAlpha=this.opacity,typeof s=="number"&&s!==1&&(u=u.times(s),c=c.times(s)),o instanceof n.Point&&(u=u.plus(o)),i.globalAlpha===1&&this.hasTransparency&&(a&&(u.x=Math.round(u.x),u.y=Math.round(u.y),c.x=Math.round(c.x),c.y=Math.round(c.y)),i.clearRect(u.x,u.y,c.x,c.y)),r({context:i,tile:this,rendered:d});var f,h;this.sourceBounds?(f=Math.min(this.sourceBounds.width,d.canvas.width),h=Math.min(this.sourceBounds.height,d.canvas.height)):(f=d.canvas.width,h=d.canvas.height),i.translate(u.x+c.x/2,0),this.flipped&&i.scale(-1,1),i.drawImage(d.canvas,0,0,f,h,-c.x/2,u.y,c.x,c.y),i.restore()},getScaleForEdgeSmoothing:function(){var i;if(this.cacheImageRecord)i=this.cacheImageRecord.getRenderedContext();else if(this.context2D)i=this.context2D;else return n.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;return i.canvas.width/(this.size.x*n.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(i,r,s){var o=Math.max(1,Math.ceil((s.x-r.x)/2)),a=Math.max(1,Math.ceil((s.y-r.y)/2));return new n.Point(o,a).minus(this.position.times(n.pixelDensityRatio).times(i||1).apply(function(l){return l%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(e),function(n){n.OverlayPlacement=n.Placement,n.OverlayRotationMode=n.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),n.Overlay=function(i,r,s){var o;n.isPlainObject(i)?o=i:o={element:i,location:r,placement:s},this.element=o.element,this.style=o.element.style,this._init(o)},n.Overlay.prototype={_init:function(i){this.location=i.location,this.placement=i.placement===void 0?n.Placement.TOP_LEFT:i.placement,this.onDraw=i.onDraw,this.checkResize=i.checkResize===void 0?!0:i.checkResize,this.width=i.width===void 0?null:i.width,this.height=i.height===void 0?null:i.height,this.rotationMode=i.rotationMode||n.OverlayRotationMode.EXACT,this.location instanceof n.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=n.Placement.TOP_LEFT),this.scales=this.width!==null&&this.height!==null,this.bounds=new n.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(i,r){var s=n.Placement.properties[this.placement];s&&(s.isHorizontallyCentered?i.x-=r.x/2:s.isRight&&(i.x-=r.x),s.isVerticallyCentered?i.y-=r.y/2:s.isBottom&&(i.y-=r.y))},destroy:function(){var i=this.element,r=this.style;i.parentNode&&(i.parentNode.removeChild(i),i.prevElementParent&&(r.display="none",document.body.appendChild(i))),this.onDraw=null,r.top="",r.left="",r.position="",this.width!==null&&(r.width=""),this.height!==null&&(r.height="");var s=n.getCssPropertyWithVendorPrefix("transformOrigin"),o=n.getCssPropertyWithVendorPrefix("transform");s&&o&&(r[s]="",r[o]="")},drawHTML:function(i,r){var s=this.element;s.parentNode!==i&&(s.prevElementParent=s.parentNode,s.prevNextSibling=s.nextSibling,i.appendChild(s),this.style.position="absolute",this.size=n.getElementSize(s));var o=this._getOverlayPositionAndSize(r),a=o.position,l=this.size=o.size,u=o.rotate;if(this.onDraw)this.onDraw(a,l,this.element);else{var c=this.style;c.left=a.x+"px",c.top=a.y+"px",this.width!==null&&(c.width=l.x+"px"),this.height!==null&&(c.height=l.y+"px");var d=n.getCssPropertyWithVendorPrefix("transformOrigin"),f=n.getCssPropertyWithVendorPrefix("transform");d&&f&&(u?(c[d]=this._getTransformOrigin(),c[f]="rotate("+u+"deg)"):(c[d]="",c[f]="")),c.display="block"}},_getOverlayPositionAndSize:function(i){var r=i.pixelFromPoint(this.location,!0),s=this._getSizeInPixels(i);this.adjust(r,s);var o=0;if(i.getRotation(!0)&&this.rotationMode!==n.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===n.OverlayRotationMode.BOUNDING_BOX&&this.width!==null&&this.height!==null){var a=new n.Rect(r.x,r.y,s.x,s.y),l=this._getBoundingBox(a,i.getRotation(!0));r=l.getTopLeft(),s=l.getSize()}else o=i.getRotation(!0);return{position:r,size:s,rotate:o}},_getSizeInPixels:function(i){var r=this.size.x,s=this.size.y;if(this.width!==null||this.height!==null){var o=i.deltaPixelsFromPointsNoRotate(new n.Point(this.width||0,this.height||0),!0);this.width!==null&&(r=o.x),this.height!==null&&(s=o.y)}if(this.checkResize&&(this.width===null||this.height===null)){var a=this.size=n.getElementSize(this.element);this.width===null&&(r=a.x),this.height===null&&(s=a.y)}return new n.Point(r,s)},_getBoundingBox:function(i,r){var s=this._getPlacementPoint(i);return i.rotate(r,s).getBoundingBox()},_getPlacementPoint:function(i){var r=new n.Point(i.x,i.y),s=n.Placement.properties[this.placement];return s&&(s.isHorizontallyCentered?r.x+=i.width/2:s.isRight&&(r.x+=i.width),s.isVerticallyCentered?r.y+=i.height/2:s.isBottom&&(r.y+=i.height)),r},_getTransformOrigin:function(){var i="",r=n.Placement.properties[this.placement];return r&&(r.isLeft?i="left":r.isRight&&(i="right"),r.isTop?i+=" top":r.isBottom&&(i+=" bottom")),i},update:function(i,r){var s=n.isPlainObject(i)?i:{location:i,placement:r};this._init({location:s.location||this.location,placement:s.placement!==void 0?s.placement:this.placement,onDraw:s.onDraw||this.onDraw,checkResize:s.checkResize||this.checkResize,width:s.width!==void 0?s.width:this.width,height:s.height!==void 0?s.height:this.height,rotationMode:s.rotationMode||this.rotationMode})},getBounds:function(i){n.console.assert(i,"A viewport must now be passed to Overlay.getBounds.");var r=this.width,s=this.height;if(r===null||s===null){var o=i.deltaPointsFromPixelsNoRotate(this.size,!0);r===null&&(r=o.x),s===null&&(s=o.y)}var a=this.location.clone();return this.adjust(a,new n.Point(r,s)),this._adjustBoundsForRotation(i,new n.Rect(a.x,a.y,r,s))},_adjustBoundsForRotation:function(i,r){if(!i||i.getRotation(!0)===0||this.rotationMode===n.OverlayRotationMode.EXACT)return r;if(this.rotationMode===n.OverlayRotationMode.BOUNDING_BOX){if(this.width===null||this.height===null)return r;var s=this._getOverlayPositionAndSize(i);return i.viewerElementToViewportRectangle(new n.Rect(s.position.x,s.position.y,s.size.x,s.size.y))}return r.rotate(-i.getRotation(!0),this._getPlacementPoint(r))}}}(e),function(n){n.Drawer=function(i){n.console.assert(i.viewer,"[Drawer] options.viewer is required");var r=arguments;if(n.isPlainObject(i)||(i={source:r[0],viewport:r[1],element:r[2]}),n.console.assert(i.viewport,"[Drawer] options.viewport is required"),n.console.assert(i.element,"[Drawer] options.element is required"),i.source&&n.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=i.viewer,this.viewport=i.viewport,this.debugGridColor=typeof i.debugGridColor=="string"?[i.debugGridColor]:i.debugGridColor||n.DEFAULT_SETTINGS.debugGridColor,i.opacity&&n.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=n.supportsCanvas&&(this.viewer?this.viewer.useCanvas:!0),this.container=n.getElement(i.element),this.canvas=n.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var s=this._calculateCanvasSize();this.canvas.width=s.x,this.canvas.height=s.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",n.setElementOpacity(this.canvas,this.opacity,!0),n.setElementPointerEventsNone(this.canvas),n.setElementTouchActionNone(this.canvas),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},n.Drawer.prototype={addOverlay:function(i,r,s,o){return n.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(i,r,s,o),this},updateOverlay:function(i,r,s){return n.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(i,r,s),this},removeOverlay:function(i){return n.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(i),this},clearOverlays:function(){return n.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(i){var r=this.viewport.pixelFromPointNoRotate(i,!0);return new n.Point(r.x*n.pixelDensityRatio,r.y*n.pixelDensityRatio)},clipWithPolygons:function(i,r){if(this.useCanvas){var s=this._getContext(r);s.beginPath(),i.forEach(function(o){o.forEach(function(a,l){s[l===0?"moveTo":"lineTo"](a.x,a.y)})}),s.clip()}},setOpacity:function(i){n.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var r=this.viewer.world,s=0;s<r.getItemCount();s++)r.getItemAt(s).setOpacity(i);return this},getOpacity:function(){n.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var i=this.viewer.world,r=0,s=0;s<i.getItemCount();s++){var o=i.getItemAt(s).getOpacity();o>r&&(r=o)}return r},needsUpdate:function(){return n.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return n.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return n.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return n.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var i=this._calculateCanvasSize();if((this.canvas.width!==i.x||this.canvas.height!==i.y)&&(this.canvas.width=i.x,this.canvas.height=i.y,this._updateImageSmoothingEnabled(this.context),this.sketchCanvas!==null)){var r=this._calculateSketchCanvasSize();this.sketchCanvas.width=r.x,this.sketchCanvas.height=r.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}},_clear:function(i,r){if(this.useCanvas){var s=this._getContext(i);if(r)s.clearRect(r.x,r.y,r.width,r.height);else{var o=s.canvas;s.clearRect(0,0,o.width,o.height)}}},viewportToDrawerRectangle:function(i){var r=this.viewport.pixelFromPointNoRotate(i.getTopLeft(),!0),s=this.viewport.deltaPixelsFromPointsNoRotate(i.getSize(),!0);return new n.Rect(r.x*n.pixelDensityRatio,r.y*n.pixelDensityRatio,s.x*n.pixelDensityRatio,s.y*n.pixelDensityRatio)},drawTile:function(i,r,s,o,a,l,u){if(n.console.assert(i,"[Drawer.drawTile] tile is required"),n.console.assert(r,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var c=this._getContext(s);o=o||1,i.drawCanvas(c,r,o,a,l,u)}else i.drawHTML(this.canvas)},_getContext:function(i){var r=this.context;if(i){if(this.sketchCanvas===null){this.sketchCanvas=document.createElement("canvas");var s=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=s.x,this.sketchCanvas.height=s.y,this.sketchContext=this.sketchCanvas.getContext("2d"),this.viewport.getRotation()===0){var o=this;this.viewer.addHandler("rotate",function a(){if(o.viewport.getRotation()!==0){o.viewer.removeHandler("rotate",a);var l=o._calculateSketchCanvasSize();o.sketchCanvas.width=l.x,o.sketchCanvas.height=l.y}})}this._updateImageSmoothingEnabled(this.sketchContext)}r=this.sketchContext}return r},saveContext:function(i){this.useCanvas&&this._getContext(i).save()},restoreContext:function(i){this.useCanvas&&this._getContext(i).restore()},setClip:function(i,r){if(this.useCanvas){var s=this._getContext(r);s.beginPath(),s.rect(i.x,i.y,i.width,i.height),s.clip()}},drawRectangle:function(i,r,s){if(this.useCanvas){var o=this._getContext(s);o.save(),o.fillStyle=r,o.fillRect(i.x,i.y,i.width,i.height),o.restore()}},blendSketch:function(i,r,s,o){var a=i;if(n.isPlainObject(a)||(a={opacity:i,scale:r,translate:s,compositeOperation:o}),!(!this.useCanvas||!this.sketchCanvas)){i=a.opacity,o=a.compositeOperation;var l=a.bounds;if(this.context.save(),this.context.globalAlpha=i,o&&(this.context.globalCompositeOperation=o),l)l.x<0&&(l.width+=l.x,l.x=0),l.x+l.width>this.canvas.width&&(l.width=this.canvas.width-l.x),l.y<0&&(l.height+=l.y,l.y=0),l.y+l.height>this.canvas.height&&(l.height=this.canvas.height-l.y),this.context.drawImage(this.sketchCanvas,l.x,l.y,l.width,l.height,l.x,l.y,l.width,l.height);else{r=a.scale||1,s=a.translate;var u=s instanceof n.Point?s:new n.Point(0,0),c=0,d=0;if(s){var f=this.sketchCanvas.width-this.canvas.width,h=this.sketchCanvas.height-this.canvas.height;c=Math.round(f/2),d=Math.round(h/2)}this.context.drawImage(this.sketchCanvas,u.x-c*r,u.y-d*r,(this.canvas.width+2*c)*r,(this.canvas.height+2*d)*r,-c,-d,this.canvas.width+2*c,this.canvas.height+2*d)}this.context.restore()}},drawDebugInfo:function(i,r,s,o){if(this.useCanvas){var a=this.viewer.world.getIndexOfItem(o)%this.debugGridColor.length,l=this.context;l.save(),l.lineWidth=2*n.pixelDensityRatio,l.font="small-caps bold "+13*n.pixelDensityRatio+"px arial",l.strokeStyle=this.debugGridColor[a],l.fillStyle=this.debugGridColor[a],this.viewport.getRotation(!0)%360!==0&&this._offsetForRotation({degrees:this.viewport.getRotation(!0)}),o.getRotation(!0)%360!==0&&this._offsetForRotation({degrees:o.getRotation(!0),point:o.viewport.pixelFromPointNoRotate(o._getRotationPoint(!0),!0)}),o.viewport.getRotation(!0)%360===0&&o.getRotation(!0)%360===0&&o._drawer.viewer.viewport.getFlip()&&o._drawer._flip(),l.strokeRect(i.position.x*n.pixelDensityRatio,i.position.y*n.pixelDensityRatio,i.size.x*n.pixelDensityRatio,i.size.y*n.pixelDensityRatio);var u=(i.position.x+i.size.x/2)*n.pixelDensityRatio,c=(i.position.y+i.size.y/2)*n.pixelDensityRatio;l.translate(u,c),l.rotate(Math.PI/180*-this.viewport.getRotation(!0)),l.translate(-u,-c),i.x===0&&i.y===0&&(l.fillText("Zoom: "+this.viewport.getZoom(),i.position.x*n.pixelDensityRatio,(i.position.y-30)*n.pixelDensityRatio),l.fillText("Pan: "+this.viewport.getBounds().toString(),i.position.x*n.pixelDensityRatio,(i.position.y-20)*n.pixelDensityRatio)),l.fillText("Level: "+i.level,(i.position.x+10)*n.pixelDensityRatio,(i.position.y+20)*n.pixelDensityRatio),l.fillText("Column: "+i.x,(i.position.x+10)*n.pixelDensityRatio,(i.position.y+30)*n.pixelDensityRatio),l.fillText("Row: "+i.y,(i.position.x+10)*n.pixelDensityRatio,(i.position.y+40)*n.pixelDensityRatio),l.fillText("Order: "+s+" of "+r,(i.position.x+10)*n.pixelDensityRatio,(i.position.y+50)*n.pixelDensityRatio),l.fillText("Size: "+i.size.toString(),(i.position.x+10)*n.pixelDensityRatio,(i.position.y+60)*n.pixelDensityRatio),l.fillText("Position: "+i.position.toString(),(i.position.x+10)*n.pixelDensityRatio,(i.position.y+70)*n.pixelDensityRatio),this.viewport.getRotation(!0)%360!==0&&this._restoreRotationChanges(),o.getRotation(!0)%360!==0&&this._restoreRotationChanges(),o.viewport.getRotation(!0)%360===0&&o.getRotation(!0)%360===0&&o._drawer.viewer.viewport.getFlip()&&o._drawer._flip(),l.restore()}},debugRect:function(i){if(this.useCanvas){var r=this.context;r.save(),r.lineWidth=2*n.pixelDensityRatio,r.strokeStyle=this.debugGridColor[0],r.fillStyle=this.debugGridColor[0],r.strokeRect(i.x*n.pixelDensityRatio,i.y*n.pixelDensityRatio,i.width*n.pixelDensityRatio,i.height*n.pixelDensityRatio),r.restore()}},setImageSmoothingEnabled:function(i){this.useCanvas&&(this._imageSmoothingEnabled=i,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(i){i.msImageSmoothingEnabled=this._imageSmoothingEnabled,i.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(i){var r=this._getContext(i).canvas;return new n.Point(r.width,r.height)},getCanvasCenter:function(){return new n.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(i){var r=i.point?i.point.times(n.pixelDensityRatio):this.getCanvasCenter(),s=this._getContext(i.useSketch);s.save(),s.translate(r.x,r.y),this.viewer.viewport.flipped?(s.rotate(Math.PI/180*-i.degrees),s.scale(-1,1)):s.rotate(Math.PI/180*i.degrees),s.translate(-r.x,-r.y)},_flip:function(i){i=i||{};var r=i.point?i.point.times(n.pixelDensityRatio):this.getCanvasCenter(),s=this._getContext(i.useSketch);s.translate(r.x,0),s.scale(-1,1),s.translate(-r.x,0)},_restoreRotationChanges:function(i){var r=this._getContext(i);r.restore()},_calculateCanvasSize:function(){var i=n.pixelDensityRatio,r=this.viewport.getContainerSize();return{x:Math.round(r.x*i),y:Math.round(r.y*i)}},_calculateSketchCanvasSize:function(){var i=this._calculateCanvasSize();if(this.viewport.getRotation()===0)return i;var r=Math.ceil(Math.sqrt(i.x*i.x+i.y*i.y));return{x:r,y:r}}}}(e),function(n){n.Viewport=function(i){var r=arguments;r.length&&r[0]instanceof n.Point&&(i={containerSize:r[0],contentSize:r[1],config:r[2]}),i.config&&(n.extend(!0,i,i.config),delete i.config),this._margins=n.extend({left:0,top:0,right:0,bottom:0},i.margins||{}),delete i.margins,i.initialDegrees=i.degrees,delete i.degrees,n.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,rotationPivot:null,viewer:null,springStiffness:n.DEFAULT_SETTINGS.springStiffness,animationTime:n.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:n.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:n.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:n.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:n.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:n.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:n.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:n.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:n.DEFAULT_SETTINGS.maxZoomLevel,initialDegrees:n.DEFAULT_SETTINGS.degrees,flipped:n.DEFAULT_SETTINGS.flipped,homeFillsViewer:n.DEFAULT_SETTINGS.homeFillsViewer,silenceMultiImageWarnings:n.DEFAULT_SETTINGS.silenceMultiImageWarnings},i),this._updateContainerInnerSize(),this.centerSpringX=new n.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new n.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new n.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.degreesSpring=new n.Spring({initial:i.initialDegrees,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._oldDegrees=this.degreesSpring.current.value,this._setContentBounds(new n.Rect(0,0,1,1),1),this.goHome(!0),this.update()},n.Viewport.prototype={get degrees(){return n.console.warn("Accessing [Viewport.degrees] is deprecated. Use viewport.getRotation instead."),this.getRotation()},set degrees(i){n.console.warn("Setting [Viewport.degrees] is deprecated. Use viewport.rotateTo, viewport.rotateBy, or viewport.setRotation instead."),this.rotateTo(i)},resetContentSize:function(i){return n.console.assert(i,"[Viewport.resetContentSize] contentSize is required"),n.console.assert(i instanceof n.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),n.console.assert(i.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),n.console.assert(i.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new n.Rect(0,0,1,i.y/i.x),i.x),this},setHomeBounds:function(i,r){n.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(i,r)},_setContentBounds:function(i,r){n.console.assert(i,"[Viewport._setContentBounds] bounds is required"),n.console.assert(i instanceof n.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),n.console.assert(i.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),n.console.assert(i.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=i.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(r),this._contentBounds=i.rotate(this.getRotation()).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(r),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:r,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var i=this._contentAspectRatio/this.getAspectRatio(),r;return this.homeFillsViewer?r=i>=1?i:1:r=i>=1?1:i,r/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var i=this._contentBounds.getCenter(),r=1/this.getHomeZoom(),s=r/this.getAspectRatio();return new n.Rect(i.x-r/2,i.y-s/2,r,s)},goHome:function(i){return this.viewer&&this.viewer.raiseEvent("home",{immediately:i}),this.fitBounds(this.getHomeBounds(),i)},getMinZoom:function(){var i=this.getHomeZoom(),r=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*i;return r},getMaxZoom:function(){var i=this.maxZoomLevel;return i||(i=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,i/=this._contentBounds.width),Math.max(i,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new n.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return n.extend({},this._margins)},setMargins:function(i){n.console.assert(n.type(i)==="object","[Viewport.setMargins] margins must be an object"),this._margins=n.extend({left:0,top:0,right:0,bottom:0},i),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(i){return this.getBoundsNoRotate(i).rotate(-this.getRotation(i))},getBoundsNoRotate:function(i){var r=this.getCenter(i),s=1/this.getZoom(i),o=s/this.getAspectRatio();return new n.Rect(r.x-s/2,r.y-o/2,s,o)},getBoundsWithMargins:function(i){return this.getBoundsNoRotateWithMargins(i).rotate(-this.getRotation(i),this.getCenter(i))},getBoundsNoRotateWithMargins:function(i){var r=this.getBoundsNoRotate(i),s=this._containerInnerSize.x*this.getZoom(i);return r.x-=this._margins.left/s,r.y-=this._margins.top/s,r.width+=(this._margins.left+this._margins.right)/s,r.height+=(this._margins.top+this._margins.bottom)/s,r},getCenter:function(i){var r=new n.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),s=new n.Point(this.centerSpringX.target.value,this.centerSpringY.target.value),o,a,l,u,c,d,f,h;return i?r:this.zoomPoint?(o=this.pixelFromPoint(this.zoomPoint,!0),a=this.getZoom(),l=1/a,u=l/this.getAspectRatio(),c=new n.Rect(r.x-l/2,r.y-u/2,l,u),d=this._pixelFromPoint(this.zoomPoint,c),f=d.minus(o).rotate(-this.getRotation(!0)),h=f.divide(this._containerInnerSize.x*a),s.plus(h)):s},getZoom:function(i){return i?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(i){return Math.max(Math.min(i,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(i){var r=this.viewportToViewerElementRectangle(i).getBoundingBox(),s=this.viewportToViewerElementRectangle(this._contentBoundsNoRotate).getBoundingBox(),o=!1,a=!1;if(!this.wrapHorizontal){var l=r.x+r.width,u=s.x+s.width,c,d,f;r.width>s.width?c=this.visibilityRatio*s.width:c=this.visibilityRatio*r.width,d=s.x-l+c,f=u-r.x-c,c>s.width?(r.x+=(d+f)/2,o=!0):f<0?(r.x+=f,o=!0):d>0&&(r.x+=d,o=!0)}if(!this.wrapVertical){var h=r.y+r.height,p=s.y+s.height,m,y,g;r.height>s.height?m=this.visibilityRatio*s.height:m=this.visibilityRatio*r.height,y=s.y-h+m,g=p-r.y-m,m>s.height?(r.y+=(y+g)/2,a=!0):g<0?(r.y+=g,a=!0):y>0&&(r.y+=y,a=!0)}var v=o||a,b=v?this.viewerElementToViewportRectangle(r):i.clone();return b.xConstrained=o,b.yConstrained=a,b.constraintApplied=v,b},_raiseConstraintsEvent:function(i){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:i})},applyConstraints:function(i){var r=this.getZoom(),s=this._applyZoomConstraints(r);r!==s&&this.zoomTo(s,this.zoomPoint,i);var o=this.getConstrainedBounds(!1);return o.constraintApplied&&(this.fitBounds(o,i),this._raiseConstraintsEvent(i)),this},ensureVisible:function(i){return this.applyConstraints(i)},_fitBounds:function(i,r){r=r||{};var s=r.immediately||!1,o=r.constraints||!1,a=this.getAspectRatio(),l=i.getCenter(),u=new n.Rect(i.x,i.y,i.width,i.height,i.degrees+this.getRotation()).getBoundingBox();u.getAspectRatio()>=a?u.height=u.width/a:u.width=u.height*a,u.x=l.x-u.width/2,u.y=l.y-u.height/2;var c=1/u.width;if(s)return this.panTo(l,!0),this.zoomTo(c,null,!0),o&&this.applyConstraints(!0),this;var d=this.getCenter(!0),f=this.getZoom(!0);this.panTo(d,!0),this.zoomTo(f,null,!0);var h=this.getBounds(),p=this.getZoom();if(p===0||Math.abs(c/p-1)<1e-8)return this.zoomTo(c,null,!0),this.panTo(l,s),o&&this.applyConstraints(!1),this;if(o){this.panTo(l,!1),c=this._applyZoomConstraints(c),this.zoomTo(c,null,!1);var m=this.getConstrainedBounds();this.panTo(d,!0),this.zoomTo(f,null,!0),this.fitBounds(m)}else{var y=u.rotate(-this.getRotation()),g=y.getTopLeft().times(c).minus(h.getTopLeft().times(p)).divide(c-p);this.zoomTo(c,g,s)}return this},fitBounds:function(i,r){return this._fitBounds(i,{immediately:r,constraints:!1})},fitBoundsWithConstraints:function(i,r){return this._fitBounds(i,{immediately:r,constraints:!0})},fitVertically:function(i){var r=new n.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(r,i)},fitHorizontally:function(i){var r=new n.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(r,i)},getConstrainedBounds:function(i){var r,s;return r=this.getBounds(i),s=this._applyBoundaryConstraints(r),s},panBy:function(i,r){var s=new n.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(s.plus(i),r)},panTo:function(i,r){return r?(this.centerSpringX.resetTo(i.x),this.centerSpringY.resetTo(i.y)):(this.centerSpringX.springTo(i.x),this.centerSpringY.springTo(i.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:i,immediately:r}),this},zoomBy:function(i,r,s){return this.zoomTo(this.zoomSpring.target.value*i,r,s)},zoomTo:function(i,r,s){var o=this;return this.zoomPoint=r instanceof n.Point&&!isNaN(r.x)&&!isNaN(r.y)?r:null,s?this._adjustCenterSpringsForZoomPoint(function(){o.zoomSpring.resetTo(i)}):this.zoomSpring.springTo(i),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:i,refPoint:r,immediately:s}),this},setRotation:function(i,r){return this.rotateTo(i,null,r)},getRotation:function(i){return i?this.degreesSpring.current.value:this.degreesSpring.target.value},setRotationWithPivot:function(i,r,s){return this.rotateTo(i,r,s)},rotateTo:function(i,r,s){if(!this.viewer||!this.viewer.drawer.canRotate())return this;if(this.degreesSpring.target.value===i&&this.degreesSpring.isAtTargetValue())return this;if(this.rotationPivot=r instanceof n.Point&&!isNaN(r.x)&&!isNaN(r.y)?r:null,s)if(this.rotationPivot){var o=i-this._oldDegrees;if(!o)return this.rotationPivot=null,this;this._rotateAboutPivot(i)}else this.degreesSpring.resetTo(i);else{var a=n.positiveModulo(this.degreesSpring.current.value,360),l=n.positiveModulo(i,360),u=l-a;u>180?l-=360:u<-180&&(l+=360);var c=a-l;this.degreesSpring.resetTo(i+c),this.degreesSpring.springTo(i)}return this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:i,immediately:!!s,pivot:this.rotationPivot||this.getCenter()}),this},rotateBy:function(i,r,s){return this.rotateTo(this.degreesSpring.target.value+i,r,s)},resize:function(i,r){var s=this.getBoundsNoRotate(),o=s,a;this.containerSize.x=i.x,this.containerSize.y=i.y,this._updateContainerInnerSize(),r&&(a=i.x/this.containerSize.x,o.width=s.width*a,o.height=o.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:i,maintain:r});var l=this.fitBounds(o,!0);return this.viewer&&this.viewer.raiseEvent("after-resize",{newContainerSize:i,maintain:r}),l},_updateContainerInnerSize:function(){this._containerInnerSize=new n.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var i=this;this._adjustCenterSpringsForZoomPoint(function(){i.zoomSpring.update()}),this.degreesSpring.isAtTargetValue()&&(this.rotationPivot=null),this.centerSpringX.update(),this.centerSpringY.update(),this.rotationPivot?this._rotateAboutPivot(!0):this.degreesSpring.update();var r=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom||this.degreesSpring.current.value!==this._oldDegrees;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._oldDegrees=this.degreesSpring.current.value,r},_rotateAboutPivot:function(i){var r=i===!0,s=this.rotationPivot.minus(this.getCenter());this.centerSpringX.shiftBy(s.x),this.centerSpringY.shiftBy(s.y),r?this.degreesSpring.update():this.degreesSpring.resetTo(i);var o=this.degreesSpring.current.value-this._oldDegrees,a=s.rotate(o*-1).times(-1);this.centerSpringX.shiftBy(a.x),this.centerSpringY.shiftBy(a.y)},_adjustCenterSpringsForZoomPoint:function(i){if(this.zoomPoint){var r=this.pixelFromPoint(this.zoomPoint,!0);i();var s=this.pixelFromPoint(this.zoomPoint,!0),o=s.minus(r),a=this.deltaPointsFromPixels(o,!0);this.centerSpringX.shiftBy(a.x),this.centerSpringY.shiftBy(a.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else i()},deltaPixelsFromPointsNoRotate:function(i,r){return i.times(this._containerInnerSize.x*this.getZoom(r))},deltaPixelsFromPoints:function(i,r){return this.deltaPixelsFromPointsNoRotate(i.rotate(this.getRotation(r)),r)},deltaPointsFromPixelsNoRotate:function(i,r){return i.divide(this._containerInnerSize.x*this.getZoom(r))},deltaPointsFromPixels:function(i,r){return this.deltaPointsFromPixelsNoRotate(i,r).rotate(-this.getRotation(r))},pixelFromPointNoRotate:function(i,r){return this._pixelFromPointNoRotate(i,this.getBoundsNoRotate(r))},pixelFromPoint:function(i,r){return this._pixelFromPoint(i,this.getBoundsNoRotate(r))},_pixelFromPointNoRotate:function(i,r){return i.minus(r.getTopLeft()).times(this._containerInnerSize.x/r.width).plus(new n.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(i,r){return this._pixelFromPointNoRotate(i.rotate(this.getRotation(!0),this.getCenter(!0)),r)},pointFromPixelNoRotate:function(i,r){var s=this.getBoundsNoRotate(r);return i.minus(new n.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/s.width).plus(s.getTopLeft())},pointFromPixel:function(i,r){return this.pointFromPixelNoRotate(i,r).rotate(-this.getRotation(r),this.getCenter(r))},_viewportToImageDelta:function(i,r){var s=this._contentBoundsNoRotate.width;return new n.Point(i*this._contentSizeNoRotate.x/s,r*this._contentSizeNoRotate.x/s)},viewportToImageCoordinates:function(i,r){if(i instanceof n.Point)return this.viewportToImageCoordinates(i.x,i.y);if(this.viewer){var s=this.viewer.world.getItemCount();if(s>1)this.silenceMultiImageWarnings||n.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(s===1){var o=this.viewer.world.getItemAt(0);return o.viewportToImageCoordinates(i,r,!0)}}return this._viewportToImageDelta(i-this._contentBoundsNoRotate.x,r-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(i,r){var s=this._contentBoundsNoRotate.width;return new n.Point(i/this._contentSizeNoRotate.x*s,r/this._contentSizeNoRotate.x*s)},imageToViewportCoordinates:function(i,r){if(i instanceof n.Point)return this.imageToViewportCoordinates(i.x,i.y);if(this.viewer){var s=this.viewer.world.getItemCount();if(s>1)this.silenceMultiImageWarnings||n.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(s===1){var o=this.viewer.world.getItemAt(0);return o.imageToViewportCoordinates(i,r,!0)}}var a=this._imageToViewportDelta(i,r);return a.x+=this._contentBoundsNoRotate.x,a.y+=this._contentBoundsNoRotate.y,a},imageToViewportRectangle:function(i,r,s,o){var a=i;if(a instanceof n.Rect||(a=new n.Rect(i,r,s,o)),this.viewer){var l=this.viewer.world.getItemCount();if(l>1)this.silenceMultiImageWarnings||n.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(l===1){var u=this.viewer.world.getItemAt(0);return u.imageToViewportRectangle(i,r,s,o,!0)}}var c=this.imageToViewportCoordinates(a.x,a.y),d=this._imageToViewportDelta(a.width,a.height);return new n.Rect(c.x,c.y,d.x,d.y,a.degrees)},viewportToImageRectangle:function(i,r,s,o){var a=i;if(a instanceof n.Rect||(a=new n.Rect(i,r,s,o)),this.viewer){var l=this.viewer.world.getItemCount();if(l>1)this.silenceMultiImageWarnings||n.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(l===1){var u=this.viewer.world.getItemAt(0);return u.viewportToImageRectangle(i,r,s,o,!0)}}var c=this.viewportToImageCoordinates(a.x,a.y),d=this._viewportToImageDelta(a.width,a.height);return new n.Rect(c.x,c.y,d.x,d.y,a.degrees)},viewerElementToImageCoordinates:function(i){var r=this.pointFromPixel(i,!0);return this.viewportToImageCoordinates(r)},imageToViewerElementCoordinates:function(i){var r=this.imageToViewportCoordinates(i);return this.pixelFromPoint(r,!0)},windowToImageCoordinates:function(i){n.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var r=i.minus(n.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(r)},imageToWindowCoordinates:function(i){n.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer.");var r=this.imageToViewerElementCoordinates(i);return r.plus(n.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(i){return this.pointFromPixel(i,!0)},viewportToViewerElementCoordinates:function(i){return this.pixelFromPoint(i,!0)},viewerElementToViewportRectangle:function(i){return n.Rect.fromSummits(this.pointFromPixel(i.getTopLeft(),!0),this.pointFromPixel(i.getTopRight(),!0),this.pointFromPixel(i.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(i){return n.Rect.fromSummits(this.pixelFromPoint(i.getTopLeft(),!0),this.pixelFromPoint(i.getTopRight(),!0),this.pixelFromPoint(i.getBottomLeft(),!0))},windowToViewportCoordinates:function(i){n.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var r=i.minus(n.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(r)},viewportToWindowCoordinates:function(i){n.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer.");var r=this.viewportToViewerElementCoordinates(i);return r.plus(n.getElementPosition(this.viewer.element))},viewportToImageZoom:function(i){if(this.viewer){var r=this.viewer.world.getItemCount();if(r>1)this.silenceMultiImageWarnings||n.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(r===1){var s=this.viewer.world.getItemAt(0);return s.viewportToImageZoom(i)}}var o=this._contentSizeNoRotate.x,a=this._containerInnerSize.x,l=this._contentBoundsNoRotate.width,u=a/o*l;return i*u},imageToViewportZoom:function(i){if(this.viewer){var r=this.viewer.world.getItemCount();if(r>1)this.silenceMultiImageWarnings||n.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(r===1){var s=this.viewer.world.getItemAt(0);return s.imageToViewportZoom(i)}}var o=this._contentSizeNoRotate.x,a=this._containerInnerSize.x,l=this._contentBoundsNoRotate.width,u=o/a/l;return i*u},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(i){return this.flipped===i?this:(this.flipped=i,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:i}),this)}}}(e),function(n){n.TiledImage=function(a){var l=this;n.console.assert(a.tileCache,"[TiledImage] options.tileCache is required"),n.console.assert(a.drawer,"[TiledImage] options.drawer is required"),n.console.assert(a.viewer,"[TiledImage] options.viewer is required"),n.console.assert(a.imageLoader,"[TiledImage] options.imageLoader is required"),n.console.assert(a.source,"[TiledImage] options.source is required"),n.console.assert(!a.clip||a.clip instanceof n.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),n.EventSource.call(this),this._tileCache=a.tileCache,delete a.tileCache,this._drawer=a.drawer,delete a.drawer,this._imageLoader=a.imageLoader,delete a.imageLoader,a.clip instanceof n.Rect&&(this._clip=a.clip.clone()),delete a.clip;var u=a.x||0;delete a.x;var c=a.y||0;delete a.y,this.normHeight=a.source.dimensions.y/a.source.dimensions.x,this.contentAspectX=a.source.dimensions.x/a.source.dimensions.y;var d=1;a.width?(d=a.width,delete a.width,a.height&&(n.console.error("specifying both width and height to a tiledImage is not supported"),delete a.height)):a.height&&(d=a.height/this.normHeight,delete a.height);var f=a.fitBounds;delete a.fitBounds;var h=a.fitBoundsPlacement||e.Placement.CENTER;delete a.fitBoundsPlacement;var p=a.degrees||0;delete a.degrees;var m=a.ajaxHeaders;delete a.ajaxHeaders,n.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:n.DEFAULT_SETTINGS.springStiffness,animationTime:n.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:n.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:n.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:n.DEFAULT_SETTINGS.wrapVertical,immediateRender:n.DEFAULT_SETTINGS.immediateRender,blendTime:n.DEFAULT_SETTINGS.blendTime,alwaysBlend:n.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:n.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:n.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:n.DEFAULT_SETTINGS.iOSDevice,debugMode:n.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:n.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:n.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:n.DEFAULT_SETTINGS.placeholderFillStyle,opacity:n.DEFAULT_SETTINGS.opacity,preload:n.DEFAULT_SETTINGS.preload,compositeOperation:n.DEFAULT_SETTINGS.compositeOperation,subPixelRoundingForTransparency:n.DEFAULT_SETTINGS.subPixelRoundingForTransparency},a),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new n.Spring({initial:u,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new n.Spring({initial:c,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new n.Spring({initial:d,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new n.Spring({initial:p,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),f&&this.fitBounds(f,h,!0),this._drawingHandler=function(y){l.viewer.raiseEvent("tile-drawing",n.extend({tiledImage:l},y))},this._ownAjaxHeaders={},this.setAjaxHeaders(m,!1)},n.extend(n.TiledImage.prototype,n.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(a){a!==this._fullyLoaded&&(this._fullyLoaded=a,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=n.now(),this._needsDraw=!0},update:function(){var a=this._xSpring.update(),l=this._ySpring.update(),u=this._scaleSpring.update(),c=this._degreesSpring.update();return a||l||u||c?(this._updateForScale(),this._needsDraw=!0,!0):!1},draw:function(){this.opacity!==0||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset(),this.source.destroy&&this.source.destroy()},getBounds:function(a){return this.getBoundsNoRotate(a).rotate(this.getRotation(a),this._getRotationPoint(a))},getBoundsNoRotate:function(a){return a?new n.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new n.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return n.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(a){var l=this.getBoundsNoRotate(a);if(this._clip){var u=a?this._worldWidthCurrent:this._worldWidthTarget,c=u/this.source.dimensions.x,d=this._clip.times(c);l=new n.Rect(l.x+d.x,l.y+d.y,d.width,d.height)}return l.rotate(this.getRotation(a),this._getRotationPoint(a))},getTileBounds:function(a,l,u){var c=this.source.getNumTiles(a),d=(c.x+l%c.x)%c.x,f=(c.y+u%c.y)%c.y,h=this.source.getTileBounds(a,d,f);return this.getFlip()&&(h.x=1-h.x-h.width),h.x+=(l-d)/c.x,h.y+=this._worldHeightCurrent/this._worldWidthCurrent*((u-f)/c.y),h},getContentSize:function(){return new n.Point(this.source.dimensions.x,this.source.dimensions.y)},getSizeInWindowCoordinates:function(){var a=this.imageToWindowCoordinates(new n.Point(0,0)),l=this.imageToWindowCoordinates(this.getContentSize());return new n.Point(l.x-a.x,l.y-a.y)},_viewportToImageDelta:function(a,l,u){var c=u?this._scaleSpring.current.value:this._scaleSpring.target.value;return new n.Point(a*(this.source.dimensions.x/c),l*(this.source.dimensions.y*this.contentAspectX/c))},viewportToImageCoordinates:function(a,l,u){var c;return a instanceof n.Point?(u=l,c=a):c=new n.Point(a,l),c=c.rotate(-this.getRotation(u),this._getRotationPoint(u)),u?this._viewportToImageDelta(c.x-this._xSpring.current.value,c.y-this._ySpring.current.value):this._viewportToImageDelta(c.x-this._xSpring.target.value,c.y-this._ySpring.target.value)},_imageToViewportDelta:function(a,l,u){var c=u?this._scaleSpring.current.value:this._scaleSpring.target.value;return new n.Point(a/this.source.dimensions.x*c,l/this.source.dimensions.y/this.contentAspectX*c)},imageToViewportCoordinates:function(a,l,u){a instanceof n.Point&&(u=l,l=a.y,a=a.x);var c=this._imageToViewportDelta(a,l);return u?(c.x+=this._xSpring.current.value,c.y+=this._ySpring.current.value):(c.x+=this._xSpring.target.value,c.y+=this._ySpring.target.value),c.rotate(this.getRotation(u),this._getRotationPoint(u))},imageToViewportRectangle:function(a,l,u,c,d){var f=a;f instanceof n.Rect?d=l:f=new n.Rect(a,l,u,c);var h=this.imageToViewportCoordinates(f.getTopLeft(),d),p=this._imageToViewportDelta(f.width,f.height,d);return new n.Rect(h.x,h.y,p.x,p.y,f.degrees+this.getRotation(d))},viewportToImageRectangle:function(a,l,u,c,d){var f=a;a instanceof n.Rect?d=l:f=new n.Rect(a,l,u,c);var h=this.viewportToImageCoordinates(f.getTopLeft(),d),p=this._viewportToImageDelta(f.width,f.height,d);return new n.Rect(h.x,h.y,p.x,p.y,f.degrees-this.getRotation(d))},viewerElementToImageCoordinates:function(a){var l=this.viewport.pointFromPixel(a,!0);return this.viewportToImageCoordinates(l)},imageToViewerElementCoordinates:function(a){var l=this.imageToViewportCoordinates(a);return this.viewport.pixelFromPoint(l,!0)},windowToImageCoordinates:function(a){var l=a.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(l)},imageToWindowCoordinates:function(a){var l=this.imageToViewerElementCoordinates(a);return l.plus(e.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(a){var l=this._scaleSpring.current.value;return a=a.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new n.Rect((a.x-this._xSpring.current.value)/l,(a.y-this._ySpring.current.value)/l,a.width/l,a.height/l,a.degrees)},viewportToImageZoom:function(a){var l=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return l*a},imageToViewportZoom:function(a){var l=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return a/l},setPosition:function(a,l){var u=this._xSpring.target.value===a.x&&this._ySpring.target.value===a.y;if(l){if(u&&this._xSpring.current.value===a.x&&this._ySpring.current.value===a.y)return;this._xSpring.resetTo(a.x),this._ySpring.resetTo(a.y),this._needsDraw=!0}else{if(u)return;this._xSpring.springTo(a.x),this._ySpring.springTo(a.y),this._needsDraw=!0}u||this._raiseBoundsChange()},setWidth:function(a,l){this._setScale(a,l)},setHeight:function(a,l){this._setScale(a/this.normHeight,l)},setCroppingPolygons:function(a){var l=function(c){return c instanceof n.Point||typeof c.x=="number"&&typeof c.y=="number"},u=function(c){return c.map(function(d){try{if(l(d))return{x:d.x,y:d.y};throw new Error}catch{throw new Error("A Provided cropping polygon point is not supported")}})};try{if(!n.isArray(a))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=a.map(function(c){return u(c)})}catch(c){n.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),n.console.error(c),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(a,l,u){l=l||n.Placement.CENTER;var c=n.Placement.properties[l],d=this.contentAspectX,f=0,h=0,p=1,m=1;if(this._clip&&(d=this._clip.getAspectRatio(),p=this._clip.width/this.source.dimensions.x,m=this._clip.height/this.source.dimensions.y,a.getAspectRatio()>d?(f=this._clip.x/this._clip.height*a.height,h=this._clip.y/this._clip.height*a.height):(f=this._clip.x/this._clip.width*a.width,h=this._clip.y/this._clip.width*a.width)),a.getAspectRatio()>d){var y=a.height/m,g=0;c.isHorizontallyCentered?g=(a.width-a.height*d)/2:c.isRight&&(g=a.width-a.height*d),this.setPosition(new n.Point(a.x-f+g,a.y-h),u),this.setHeight(y,u)}else{var v=a.width/p,b=0;c.isVerticallyCentered?b=(a.height-a.width/d)/2:c.isBottom&&(b=a.height-a.width/d),this.setPosition(new n.Point(a.x-f,a.y-h+b),u),this.setWidth(v,u)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(a){n.console.assert(!a||a instanceof n.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),a instanceof n.Rect?this._clip=a.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getFlip:function(){return!!this.flipped},setFlip:function(a){this.flipped=!!a,this._needsDraw=!0,this._raiseBoundsChange()},getOpacity:function(){return this.opacity},setOpacity:function(a){a!==this.opacity&&(this.opacity=a,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(a){this._preload=!!a,this._needsDraw=!0},getRotation:function(a){return a?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(a,l){this._degreesSpring.target.value===a&&this._degreesSpring.isAtTargetValue()||(l?this._degreesSpring.resetTo(a):this._degreesSpring.springTo(a),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(a){return this.getBoundsNoRotate(a).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(a){a!==this.compositeOperation&&(this.compositeOperation=a,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},setAjaxHeaders:function(a,l){if(a===null&&(a={}),!n.isPlainObject(a)){console.error("[TiledImage.setAjaxHeaders] Ignoring invalid headers, must be a plain object");return}this._ownAjaxHeaders=a,this._updateAjaxHeaders(l)},_updateAjaxHeaders:function(a){if(a===void 0&&(a=!0),n.isPlainObject(this.viewer.ajaxHeaders)?this.ajaxHeaders=n.extend({},this.viewer.ajaxHeaders,this._ownAjaxHeaders):this.ajaxHeaders=this._ownAjaxHeaders,a){var l,u,c,d;for(var f in this.tilesMatrix){l=this.source.getNumTiles(f);for(var h in this.tilesMatrix[f]){u=(l.x+h%l.x)%l.x;for(var p in this.tilesMatrix[f][h])if(c=(l.y+p%l.y)%l.y,d=this.tilesMatrix[f][h][p],d.loadWithAjax=this.loadTilesWithAjax,d.loadWithAjax){var m=this.source.getTileAjaxHeaders(f,u,c);d.ajaxHeaders=n.extend({},this.ajaxHeaders,m)}else d.ajaxHeaders=null}}for(var y=0;y<this._imageLoader.jobQueue.length;y++){var g=this._imageLoader.jobQueue[y];g.loadWithAjax=g.tile.loadWithAjax,g.ajaxHeaders=g.tile.loadWithAjax?g.tile.ajaxHeaders:null}}},_setScale:function(a,l){var u=this._scaleSpring.target.value===a;if(l){if(u&&this._scaleSpring.current.value===a)return;this._scaleSpring.resetTo(a),this._updateForScale(),this._needsDraw=!0}else{if(u)return;this._scaleSpring.springTo(a),this._updateForScale(),this._needsDraw=!0}u||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var a=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),l=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,u=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(l/this.minPixelRatio)/Math.log(2))));return u=Math.max(u,this.source.minLevel||0),a=Math.min(a,u),{lowestLevel:a,highestLevel:u}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;){var a=this.lastDrawn.pop();a.beingDrawn=!1}var l=this.viewport,u=this._viewportToTiledImageRectangle(l.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var c=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(u=u.intersection(c),u===null)return}for(var d=this._getLevelsInterval(),f=d.lowestLevel,h=d.highestLevel,p=null,m=!1,y=n.now(),g=h;g>=f;g--){var v=!1,b=l.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(g),!0).x*this._scaleSpring.current.value;if(g===f||!m&&b>=this.minPixelRatio)v=!0,m=!0;else if(!m)continue;var T=l.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(g),!1).x*this._scaleSpring.current.value,S=l.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,_=this.immediateRender?1:S,A=Math.min(1,(b-.5)/.5),P=_/Math.abs(_-T);if(p=this._updateLevel(m,v,g,A,P,u,y,p),this._providesCoverage(this.coverage,g))break}this._drawTiles(this.lastDrawn),p&&!p.context2D?(this._loadTile(p,y),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(this._tilesLoading===0)},_getCornerTiles:function(a,l,u){var c,d;this.wrapHorizontal?(c=n.positiveModulo(l.x,1),d=n.positiveModulo(u.x,1)):(c=Math.max(0,l.x),d=Math.min(1,u.x));var f,h,p=1/this.source.aspectRatio;this.wrapVertical?(f=n.positiveModulo(l.y,p),h=n.positiveModulo(u.y,p)):(f=Math.max(0,l.y),h=Math.min(p,u.y));var m=this.source.getTileAtPoint(a,new n.Point(c,f)),y=this.source.getTileAtPoint(a,new n.Point(d,h)),g=this.source.getNumTiles(a);return this.wrapHorizontal&&(m.x+=g.x*Math.floor(l.x),y.x+=g.x*Math.floor(u.x)),this.wrapVertical&&(m.y+=g.y*Math.floor(l.y/p),y.y+=g.y*Math.floor(u.y/p)),{topLeft:m,bottomRight:y}},_updateLevel:function(a,l,u,c,d,f,h,p){var m=f.getBoundingBox().getTopLeft(),y=f.getBoundingBox().getBottomRight();this.viewer&&this.viewer.raiseEvent("update-level",{tiledImage:this,havedrawn:a,level:u,opacity:c,visibility:d,drawArea:f,topleft:m,bottomright:y,currenttime:h,best:p}),this._resetCoverage(this.coverage,u),this._resetCoverage(this.loadingCoverage,u);var g=this._getCornerTiles(u,m,y),v=g.topLeft,b=g.bottomRight,T=this.source.getNumTiles(u),S=this.viewport.pixelFromPoint(this.viewport.getCenter());this.getFlip()&&(b.x+=1,this.wrapHorizontal||(b.x=Math.min(b.x,T.x-1)));for(var _=v.x;_<=b.x;_++)for(var A=v.y;A<=b.y;A++){var P;if(this.getFlip()){var O=(T.x+_%T.x)%T.x;P=_+T.x-O-O-1}else P=_;f.intersection(this.getTileBounds(u,P,A))!==null&&(p=this._updateTile(l,a,P,A,u,c,d,S,T,h,p))}return p},_updateTile:function(a,l,u,c,d,f,h,p,m,y,g){var v=this._getTile(u,c,d,y,m,this._worldWidthCurrent,this._worldHeightCurrent),b=l;this.viewer&&this.viewer.raiseEvent("update-tile",{tiledImage:this,tile:v}),this._setCoverage(this.coverage,d,u,c,!1);var T=v.loaded||v.loading||this._isCovered(this.loadingCoverage,d,u,c);if(this._setCoverage(this.loadingCoverage,d,u,c,T),!v.exists||(a&&!b&&(this._isCovered(this.coverage,d,u,c)?this._setCoverage(this.coverage,d,u,c,!0):b=!0),!b))return g;if(this._positionTile(v,this.source.tileOverlap,this.viewport,p,h),!v.loaded)if(v.context2D)this._setTileLoaded(v);else{var S=this._tileCache.getImageRecord(v.cacheKey);S&&this._setTileLoaded(v,S.getData())}if(v.loaded){var _=this._blendTile(v,u,c,d,f,y);_&&(this._needsDraw=!0)}else v.loading?this._tilesLoading++:T||(g=this._compareTiles(g,v));return g},_getTile:function(a,l,u,c,d,f,h){var p,m,y,g,v,b,T,S,_,A,P=this.tilesMatrix,O=this.source;return P[u]||(P[u]={}),P[u][a]||(P[u][a]={}),(!P[u][a][l]||!P[u][a][l].flipped!=!this.flipped)&&(p=(d.x+a%d.x)%d.x,m=(d.y+l%d.y)%d.y,y=this.getTileBounds(u,a,l),g=O.getTileBounds(u,p,m,!0),v=O.tileExists(u,p,m),b=O.getTileUrl(u,p,m),T=O.getTilePostData(u,p,m),this.loadTilesWithAjax?(S=O.getTileAjaxHeaders(u,p,m),n.isPlainObject(this.ajaxHeaders)&&(S=n.extend({},this.ajaxHeaders,S))):S=null,_=O.getContext2D?O.getContext2D(u,p,m):void 0,A=new n.Tile(u,a,l,y,v,b,_,this.loadTilesWithAjax,S,g,T,O.getTileHashKey(u,p,m,b,S,T)),this.getFlip()?p===0&&(A.isRightMost=!0):p===d.x-1&&(A.isRightMost=!0),m===d.y-1&&(A.isBottomMost=!0),A.flipped=this.flipped,P[u][a][l]=A),A=P[u][a][l],A.lastTouchTime=c,A},_loadTile:function(a,l){var u=this;a.loading=!0,this._imageLoader.addJob({src:a.getUrl(),tile:a,source:this.source,postData:a.postData,loadWithAjax:a.loadWithAjax,ajaxHeaders:a.ajaxHeaders,crossOriginPolicy:this.crossOriginPolicy,ajaxWithCredentials:this.ajaxWithCredentials,callback:function(c,d,f){u._onTileLoad(a,l,c,d,f)},abort:function(){a.loading=!1}})},_onTileLoad:function(a,l,u,c,d){if(u)a.exists=!0;else{n.console.error("Tile %s failed to load: %s - error: %s",a,a.getUrl(),c),this.viewer.raiseEvent("tile-load-failed",{tile:a,tiledImage:this,time:l,message:c,tileRequest:d}),a.loading=!1,a.exists=!1;return}if(l<this.lastResetTime){n.console.warn("Ignoring tile %s loaded before reset: %s",a,a.getUrl()),a.loading=!1;return}var f=this,h=function(){var p=f.source,m=p.getClosestLevel();f._setTileLoaded(a,u,m,d)};this._midDraw?window.setTimeout(h,1):h()},_setTileLoaded:function(a,l,u,c){var d=0,f=!1,h=this;function p(){return f&&n.console.error("Event 'tile-loaded' argument getCompletionCallback must be called synchronously. Its return value should be called asynchronously."),d++,m}function m(){d--,d===0&&(a.loading=!1,a.loaded=!0,a.hasTransparency=h.source.hasTransparency(a.context2D,a.getUrl(),a.ajaxHeaders,a.postData),a.context2D||h._tileCache.cacheTile({data:l,tile:a,cutoff:u,tiledImage:h}),h._needsDraw=!0)}var y=p();this.viewer.raiseEvent("tile-loaded",{tile:a,tiledImage:this,tileRequest:c,get image(){return n.console.error("[tile-loaded] event 'image' has been deprecated. Use 'data' property instead."),l},data:l,getCompletionCallback:p}),f=!0,y()},_positionTile:function(a,l,u,c,d){var f=a.bounds.getTopLeft();f.x*=this._scaleSpring.current.value,f.y*=this._scaleSpring.current.value,f.x+=this._xSpring.current.value,f.y+=this._ySpring.current.value;var h=a.bounds.getSize();h.x*=this._scaleSpring.current.value,h.y*=this._scaleSpring.current.value;var p=u.pixelFromPointNoRotate(f,!0),m=u.pixelFromPointNoRotate(f,!1),y=u.deltaPixelsFromPointsNoRotate(h,!0),g=u.deltaPixelsFromPointsNoRotate(h,!1),v=m.plus(g.divide(2)),b=c.squaredDistanceTo(v);l||(y=y.plus(new n.Point(1,1))),a.isRightMost&&this.wrapHorizontal&&(y.x+=.75),a.isBottomMost&&this.wrapVertical&&(y.y+=.75),a.position=p,a.size=y,a.squaredDistance=b,a.visibility=d},_blendTile:function(a,l,u,c,d,f){var h=1e3*this.blendTime,p,m;if(a.blendStart||(a.blendStart=f),p=f-a.blendStart,m=h?Math.min(1,p/h):1,this.alwaysBlend&&(m*=d),a.opacity=m,this.lastDrawn.push(a),m===1)this._setCoverage(this.coverage,c,l,u,!0),this._hasOpaqueTile=!0;else if(p<h)return!0;return!1},_compareTiles:function(a,l){return!a||l.visibility>a.visibility||l.visibility===a.visibility&&l.squaredDistance<a.squaredDistance?l:a},_drawTiles:function(a){if(!(this.opacity===0||a.length===0&&!this.placeholderFillStyle)){var l=a[0],u;l&&(u=this.opacity<1||this.compositeOperation&&this.compositeOperation!=="source-over"||!this._isBottomItem()&&this.source.hasTransparency(l.context2D,l.getUrl(),l.ajaxHeaders,l.postData));var c,d,f=this.viewport.getZoom(!0),h=this.viewportToImageZoom(f);a.length>1&&h>this.smoothTileEdgesMinZoom&&!this.iOSDevice&&this.getRotation(!0)%360===0&&n.supportsCanvas&&this.viewer.useCanvas&&(u=!0,c=l.getScaleForEdgeSmoothing(),d=l.getTranslationForEdgeSmoothing(c,this._drawer.getCanvasSize(!1),this._drawer.getCanvasSize(!0)));var p;u&&(c||(p=this.viewport.viewportToViewerElementRectangle(this.getClippedBounds(!0)).getIntegerBoundingBox(),this._drawer.viewer.viewport.getFlip()&&(this.viewport.getRotation(!0)%360!==0||this.getRotation(!0)%360!==0)&&(p.x=this._drawer.viewer.container.clientWidth-(p.x+p.width)),p=p.times(n.pixelDensityRatio)),this._drawer._clear(!0,p)),c||(this.viewport.getRotation(!0)%360!==0&&this._drawer._offsetForRotation({degrees:this.viewport.getRotation(!0),useSketch:u}),this.getRotation(!0)%360!==0&&this._drawer._offsetForRotation({degrees:this.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(this._getRotationPoint(!0),!0),useSketch:u}),this.viewport.getRotation(!0)%360===0&&this.getRotation(!0)%360===0&&this._drawer.viewer.viewport.getFlip()&&this._drawer._flip());var m=!1;if(this._clip){this._drawer.saveContext(u);var y=this.imageToViewportRectangle(this._clip,!0);y=y.rotate(-this.getRotation(!0),this._getRotationPoint(!0));var g=this._drawer.viewportToDrawerRectangle(y);c&&(g=g.times(c)),d&&(g=g.translate(d)),this._drawer.setClip(g,u),m=!0}if(this._croppingPolygons){var v=this;this._drawer.saveContext(u);try{var b=this._croppingPolygons.map(function(x){return x.map(function(L){var M=v.imageToViewportCoordinates(L.x,L.y,!0).rotate(-v.getRotation(!0),v._getRotationPoint(!0)),V=v._drawer.viewportCoordToDrawerCoord(M);return c&&(V=V.times(c)),d&&(V=V.plus(d)),V})});this._drawer.clipWithPolygons(b,u)}catch(x){n.console.error(x)}m=!0}if(this.placeholderFillStyle&&this._hasOpaqueTile===!1){var T=this._drawer.viewportToDrawerRectangle(this.getBounds(!0));c&&(T=T.times(c)),d&&(T=T.translate(d));var S=null;typeof this.placeholderFillStyle=="function"?S=this.placeholderFillStyle(this,this._drawer.context):S=this.placeholderFillStyle,this._drawer.drawRectangle(T,S,u)}var _=o(this.subPixelRoundingForTransparency),A=!1;if(_===n.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS)A=!0;else if(_===n.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST){var P=this.viewer&&this.viewer.isAnimating();A=!P}for(var O=a.length-1;O>=0;O--)l=a[O],this._drawer.drawTile(l,this._drawingHandler,u,c,d,A,this.source),l.beingDrawn=!0,this.viewer&&this.viewer.raiseEvent("tile-drawn",{tiledImage:this,tile:l});m&&this._drawer.restoreContext(u),c||(this.getRotation(!0)%360!==0&&this._drawer._restoreRotationChanges(u),this.viewport.getRotation(!0)%360!==0&&this._drawer._restoreRotationChanges(u)),u&&(c&&(this.viewport.getRotation(!0)%360!==0&&this._drawer._offsetForRotation({degrees:this.viewport.getRotation(!0),useSketch:!1}),this.getRotation(!0)%360!==0&&this._drawer._offsetForRotation({degrees:this.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(this._getRotationPoint(!0),!0),useSketch:!1})),this._drawer.blendSketch({opacity:this.opacity,scale:c,translate:d,compositeOperation:this.compositeOperation,bounds:p}),c&&(this.getRotation(!0)%360!==0&&this._drawer._restoreRotationChanges(!1),this.viewport.getRotation(!0)%360!==0&&this._drawer._restoreRotationChanges(!1))),c||this.viewport.getRotation(!0)%360===0&&this.getRotation(!0)%360===0&&this._drawer.viewer.viewport.getFlip()&&this._drawer._flip(),this._drawDebugInfo(a)}},_drawDebugInfo:function(a){if(this.debugMode)for(var l=a.length-1;l>=0;l--){var u=a[l];try{this._drawer.drawDebugInfo(u,a.length,l,this)}catch(c){n.console.error(c)}}},_providesCoverage:function(a,l,u,c){var d,f,h,p;if(!a[l])return!1;if(u===void 0||c===void 0){d=a[l];for(h in d)if(Object.prototype.hasOwnProperty.call(d,h)){f=d[h];for(p in f)if(Object.prototype.hasOwnProperty.call(f,p)&&!f[p])return!1}return!0}return a[l][u]===void 0||a[l][u][c]===void 0||a[l][u][c]===!0},_isCovered:function(a,l,u,c){return u===void 0||c===void 0?this._providesCoverage(a,l+1):this._providesCoverage(a,l+1,2*u,2*c)&&this._providesCoverage(a,l+1,2*u,2*c+1)&&this._providesCoverage(a,l+1,2*u+1,2*c)&&this._providesCoverage(a,l+1,2*u+1,2*c+1)},_setCoverage:function(a,l,u,c,d){if(!a[l]){n.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",l);return}a[l][u]||(a[l][u]={}),a[l][u][c]=d},_resetCoverage:function(a,l){a[l]={}}});var i=n.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER;function r(a){return a!==n.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS&&a!==n.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST&&a!==n.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER}function s(a){return r(a)?i:a}function o(a){if(typeof a=="number")return s(a);if(!a||!n.Browser)return i;var l=a[n.Browser.vendor];return r(l)&&(l=a["*"]),s(l)}}(e),function(n){var i=function(s){n.console.assert(s,"[TileCache.cacheTile] options is required"),n.console.assert(s.tile,"[TileCache.cacheTile] options.tile is required"),n.console.assert(s.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=s.tile,this.tiledImage=s.tiledImage},r=function(s){n.console.assert(s,"[ImageRecord] options is required"),n.console.assert(s.data,"[ImageRecord] options.data is required"),this._tiles=[],s.create.apply(null,[this,s.data,s.ownerTile]),this._destroyImplementation=s.destroy.bind(null,this),this.getImage=s.getImage.bind(null,this),this.getData=s.getData.bind(null,this),this.getRenderedContext=s.getRenderedContext.bind(null,this)};r.prototype={destroy:function(){this._destroyImplementation(),this._tiles=null},addTile:function(s){n.console.assert(s,"[ImageRecord.addTile] tile is required"),this._tiles.push(s)},removeTile:function(s){for(var o=0;o<this._tiles.length;o++)if(this._tiles[o]===s){this._tiles.splice(o,1);return}n.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",s)},getTileCount:function(){return this._tiles.length}},n.TileCache=function(s){s=s||{},this._maxImageCacheCount=s.maxImageCacheCount||n.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},n.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(s){n.console.assert(s,"[TileCache.cacheTile] options is required"),n.console.assert(s.tile,"[TileCache.cacheTile] options.tile is required"),n.console.assert(s.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),n.console.assert(s.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var o=s.cutoff||0,a=this._tilesLoaded.length,l=this._imagesLoaded[s.tile.cacheKey];if(l||(s.data||(n.console.error("[TileCache.cacheTile] options.image was renamed to options.data. '.image' attribute has been deprecated and will be removed in the future."),s.data=s.image),n.console.assert(s.data,"[TileCache.cacheTile] options.data is required to create an ImageRecord"),l=this._imagesLoaded[s.tile.cacheKey]=new r({data:s.data,ownerTile:s.tile,create:s.tiledImage.source.createTileCache,destroy:s.tiledImage.source.destroyTileCache,getImage:s.tiledImage.source.getTileCacheDataAsImage,getData:s.tiledImage.source.getTileCacheData,getRenderedContext:s.tiledImage.source.getTileCacheDataAsContext2D}),this._imagesLoadedCount++),l.addTile(s.tile),s.tile.cacheImageRecord=l,this._imagesLoadedCount>this._maxImageCacheCount){for(var u=null,c=-1,d=null,f,h,p,m,y,g,v=this._tilesLoaded.length-1;v>=0;v--)if(g=this._tilesLoaded[v],f=g.tile,!(f.level<=o||f.beingDrawn)){if(!u){u=f,c=v,d=g;continue}m=f.lastTouchTime,h=u.lastTouchTime,y=f.level,p=u.level,(m<h||m===h&&y>p)&&(u=f,c=v,d=g)}u&&c>=0&&(this._unloadTile(d),a=c)}this._tilesLoaded[a]=new i({tile:s.tile,tiledImage:s.tiledImage})},clearTilesFor:function(s){n.console.assert(s,"[TileCache.clearTilesFor] tiledImage is required");for(var o,a=0;a<this._tilesLoaded.length;++a)o=this._tilesLoaded[a],o.tiledImage===s&&(this._unloadTile(o),this._tilesLoaded.splice(a,1),a--)},getImageRecord:function(s){return n.console.assert(s,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[s]},_unloadTile:function(s){n.console.assert(s,"[TileCache._unloadTile] tileRecord is required");var o=s.tile,a=s.tiledImage;o.unload(),o.cacheImageRecord=null;var l=this._imagesLoaded[o.cacheKey];l.removeTile(o),l.getTileCount()||(l.destroy(),delete this._imagesLoaded[o.cacheKey],this._imagesLoadedCount--),a.viewer.raiseEvent("tile-unloaded",{tile:o,tiledImage:a})}}}(e),function(n){n.World=function(i){var r=this;n.console.assert(i.viewer,"[World] options.viewer is required"),n.EventSource.call(this),this.viewer=i.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(s){r._autoRefigureSizes?r._figureSizes():r._needsSizesFigured=!0},this._figureSizes()},n.extend(n.World.prototype,n.EventSource.prototype,{addItem:function(i,r){if(n.console.assert(i,"[World.addItem] item is required"),n.console.assert(i instanceof n.TiledImage,"[World.addItem] only TiledImages supported at this time"),r=r||{},r.index!==void 0){var s=Math.max(0,Math.min(this._items.length,r.index));this._items.splice(s,0,i)}else this._items.push(i);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,i.addHandler("bounds-change",this._delegatedFigureSizes),i.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:i})},getItemAt:function(i){return n.console.assert(i!==void 0,"[World.getItemAt] index is required"),this._items[i]},getIndexOfItem:function(i){return n.console.assert(i,"[World.getIndexOfItem] item is required"),n.indexOf(this._items,i)},getItemCount:function(){return this._items.length},setItemIndex:function(i,r){n.console.assert(i,"[World.setItemIndex] item is required"),n.console.assert(r!==void 0,"[World.setItemIndex] index is required");var s=this.getIndexOfItem(i);if(r>=this._items.length)throw new Error("Index bigger than number of layers.");r===s||s===-1||(this._items.splice(s,1),this._items.splice(r,0,i),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:i,previousIndex:s,newIndex:r}))},removeItem:function(i){n.console.assert(i,"[World.removeItem] item is required");var r=n.indexOf(this._items,i);r!==-1&&(i.removeHandler("bounds-change",this._delegatedFigureSizes),i.removeHandler("clip-change",this._delegatedFigureSizes),i.destroy(),this._items.splice(r,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(i))},removeAll:function(){this.viewer._cancelPendingImages();var i,r;for(r=0;r<this._items.length;r++)i=this._items[r],i.removeHandler("bounds-change",this._delegatedFigureSizes),i.removeHandler("clip-change",this._delegatedFigureSizes),i.destroy();var s=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,r=0;r<s.length;r++)i=s[r],this._raiseRemoveItem(i)},resetItems:function(){for(var i=0;i<this._items.length;i++)this._items[i].reset()},update:function(){for(var i=!1,r=0;r<this._items.length;r++)i=this._items[r].update()||i;return i},draw:function(){for(var i=0;i<this._items.length;i++)this._items[i].draw();this._needsDraw=!1},needsDraw:function(){for(var i=0;i<this._items.length;i++)if(this._items[i].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(i){this._autoRefigureSizes=i,i&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(i){i=i||{};var r=i.immediately||!1,s=i.layout||n.DEFAULT_SETTINGS.collectionLayout,o=i.rows||n.DEFAULT_SETTINGS.collectionRows,a=i.columns||n.DEFAULT_SETTINGS.collectionColumns,l=i.tileSize||n.DEFAULT_SETTINGS.collectionTileSize,u=i.tileMargin||n.DEFAULT_SETTINGS.collectionTileMargin,c=l+u,d;!i.rows&&a?d=a:d=Math.ceil(this._items.length/o);var f=0,h=0,p,m,y,g,v;this.setAutoRefigureSizes(!1);for(var b=0;b<this._items.length;b++)b&&b%d===0&&(s==="horizontal"?(h+=c,f=0):(f+=c,h=0)),p=this._items[b],m=p.getBounds(),m.width>m.height?y=l:y=l*(m.width/m.height),g=y*(m.height/m.width),v=new n.Point(f+(l-y)/2,h+(l-g)/2),p.setPosition(v,r),p.setWidth(y,r),s==="horizontal"?f+=c:h+=c;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var i=this._homeBounds?this._homeBounds.clone():null,r=this._contentSize?this._contentSize.clone():null,s=this._contentFactor||0;if(!this._items.length)this._homeBounds=new n.Rect(0,0,1,1),this._contentSize=new n.Point(1,1),this._contentFactor=1;else{var o=this._items[0],a=o.getBounds();this._contentFactor=o.getContentSize().x/a.width;for(var l=o.getClippedBounds().getBoundingBox(),u=l.x,c=l.y,d=l.x+l.width,f=l.y+l.height,h=1;h<this._items.length;h++)o=this._items[h],a=o.getBounds(),this._contentFactor=Math.max(this._contentFactor,o.getContentSize().x/a.width),l=o.getClippedBounds().getBoundingBox(),u=Math.min(u,l.x),c=Math.min(c,l.y),d=Math.max(d,l.x+l.width),f=Math.max(f,l.y+l.height);this._homeBounds=new n.Rect(u,c,d-u,f-c),this._contentSize=new n.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}(this._contentFactor!==s||!this._homeBounds.equals(i)||!this._contentSize.equals(r))&&this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(i){this.raiseEvent("remove-item",{item:i})}})}(e)})(FS);var U8=FS.exports;const hu=Md(U8);let To=window.OpenSeadragon;if(!To&&(To=hu,!To))throw new Error("OpenSeadragon is missing.");const BS="http://www.w3.org/2000/svg";To.Viewer&&(To.Viewer.prototype.svgOverlay=function(){return this._svgOverlayInfo?this._svgOverlayInfo:(this._svgOverlayInfo=new US(this),this._svgOverlayInfo)});const US=function(t){const e=this;this._viewer=t,this._containerWidth=0,this._containerHeight=0,this._svg=document.createElementNS(BS,"svg"),this._svg.style.position="absolute",this._svg.style.left=0,this._svg.style.top=0,this._svg.style.width="100%",this._svg.style.height="100%",this._viewer.canvas.appendChild(this._svg),this._node=document.createElementNS(BS,"g"),this._svg.appendChild(this._node),this._viewer.addHandler("animation",function(){e.resize()}),this._viewer.addHandler("open",function(){e.resize()}),this._viewer.addHandler("rotate",function(){e.resize()}),this._viewer.addHandler("flip",function(){e.resize()}),this._viewer.addHandler("resize",function(){e.resize()}),this.resize()};US.prototype={node:function(){return this._node},resize:function(){this._containerWidth!==this._viewer.container.clientWidth&&(this._containerWidth=this._viewer.container.clientWidth,this._svg.setAttribute("width",this._containerWidth)),this._containerHeight!==this._viewer.container.clientHeight&&(this._containerHeight=this._viewer.container.clientHeight,this._svg.setAttribute("height",this._containerHeight));const t=this._viewer.viewport.pixelFromPoint(new To.Point(0,0),!0),e=this._viewer.viewport.getZoom(!0),n=this._viewer.viewport.getRotation(),i=this._viewer.viewport.getFlip(),r=this._viewer.viewport._containerInnerSize.x;let s=r*e;const o=s;i&&(s=-s,t.x=-t.x+r),this._node.setAttribute("transform","translate("+t.x+","+t.y+") scale("+s+","+o+") rotate("+n+")")},onClick:function(t,e){new To.MouseTracker({element:t,clickHandler:e}).setTracking(!0)}};const H8=t=>{var i;if(!t)return"LTR";const e=["ar","fa","ur","ps","dv","sd","ug","ku","he","yi","jrb","jpr","nqo"],n=Array.isArray(t)?(i=t[0])==null?void 0:i.split("-")[0]:t==null?void 0:t.split("-")[0];return e.includes(n)?"RTL":"LTR"},$8=t=>{var n,i,r,s,o;let e={id:typeof t=="string"?t:t.source};if(typeof t=="string"){if(t.includes("#xywh=")){const a=t.split("#xywh=");if(a&&a[1]){const[l,u,c,d]=a[1].split(",").map(f=>Number(f));e={id:a[0],rect:{x:l,y:u,w:c,h:d}}}}else if(t.includes("#t=")){const a=t.split("#t=");a&&a[1]&&(e={id:a[0],t:a[1]})}}else if(typeof t=="object"){if(((n=t.selector)==null?void 0:n.type)==="PointSelector")e={id:t.source,point:{x:t.selector.x,y:t.selector.y}};else if(((i=t.selector)==null?void 0:i.type)==="SvgSelector")e={id:t.source,svg:t.selector.value};else if(((r=t.selector)==null?void 0:r.type)==="FragmentSelector"&&(s=t.selector)!=null&&s.value.includes("xywh=")&&t.source.type=="Canvas"&&t.source.id){const a=(o=t.selector)==null?void 0:o.value.split("xywh=");if(a&&a[1]){const[l,u,c,d]=a[1].split(",").map(f=>Number(f));e={id:t.source.id,rect:{x:l,y:u,w:c,h:d}}}}}return e};function z8(t){return t?Array.isArray(t)?t:[t]:[]}function V8(t,e){if(!t)return!1;if(!e)return!0;if(e.length===0)return!1;const n=z8(t.motivation);return n.length===0?!1:n.some(i=>e.includes(i))}function pu(t){"@babel/helpers - typeof";return pu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pu(t)}function G8(t,e){if(pu(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e);if(pu(i)!="object")return i;throw TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function j8(t){var e=G8(t,"string");return pu(e)=="symbol"?e:e+""}function ws(t,e,n){return(e=j8(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Gr(t){return Array.isArray(t)?t:t?[t]:[]}function cr(t){for(let e in t)(t[e]===void 0||t[e]===null)&&delete t[e];return t}const HS="http://library.stanford.edu/iiif/image-api/compliance.html#level0",$S="http://library.stanford.edu/iiif/image-api/compliance.html#level1",zS="http://library.stanford.edu/iiif/image-api/compliance.html#level2",VS="http://library.stanford.edu/iiif/image-api/conformance.html#level0",GS="http://library.stanford.edu/iiif/image-api/conformance.html#level1",jS="http://library.stanford.edu/iiif/image-api/conformance.html#level2",WS="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",qS="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",KS="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",YS="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",XS="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",QS="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",ZS="http://iiif.io/api/image/1/level0.json",JS="http://iiif.io/api/image/1/profiles/level0.json",ex="http://iiif.io/api/image/1/level1.json",tx="http://iiif.io/api/image/1/profiles/level1.json",nx="http://iiif.io/api/image/1/level2.json",ix="http://iiif.io/api/image/1/profiles/level2.json",rx="http://iiif.io/api/image/2/level0.json",sx="http://iiif.io/api/image/2/profiles/level0.json",ox="http://iiif.io/api/image/2/level1.json",ax="http://iiif.io/api/image/2/profiles/level1.json",lx="http://iiif.io/api/image/2/level2.json",ux="http://iiif.io/api/image/2/profiles/level2.json",cx="level0",dx="level1",fx="level2",hx="http://iiif.io/api/image/2/level0",px="http://iiif.io/api/image/2/level1",mx="http://iiif.io/api/image/2/level2",Fd=[mx,zS,jS,KS,QS,nx,ix,lx,ux,fx],pm=[...Fd,px,$S,GS,qS,XS,ex,tx,ox,ax,dx],gx=[hx,px,mx,HS,$S,zS,VS,GS,jS,WS,qS,KS,YS,XS,QS,ZS,JS,ex,tx,nx,ix,rx,sx,ox,ax,lx,ux,cx,dx,fx],W8=gx,yx=[hx,HS,VS,WS,YS,ZS,JS,rx,sx,cx],q8={extraFormats:["jpg"],extraQualities:["default"],extraFeatures:["sizeByWhListed"]},K8={extraFormats:["jpg"],extraQualities:["default"],extraFeatures:["baseUriRedirect","cors","jsonldMediaType","regionByPx","regionSquare","sizeByWhListed","sizeByH","sizeByW","sizeByWh"]},Y8={extraFormats:["jpg","png"],extraQualities:["default"],extraFeatures:["baseUriRedirect","cors","jsonldMediaType","regionByPct","regionByPx","regionSquare","rotationBy90s","sizeByWhListed","sizeByConfinedWh","sizeByH","sizeByPct","sizeByW","sizeByWh"]},vx=["sc:Collection","sc:Manifest","sc:Canvas","sc:AnnotationList","oa:Annotation","sc:Range","sc:Layer","sc:Sequence","oa:Choice","Service","ContentResource"];function X8(t){if(t==null)throw Error("Null or undefined is not a valid entity.");if(Array.isArray(t))throw Error("Array is not a valid entity");if(typeof t!="object")throw Error(`${typeof t} is not a valid entity`);if(typeof t["@type"]=="string"){let e=vx.indexOf(t["@type"]);if(e!==-1)return vx[e]}if(t.profile)return"Service";if(t.format||t["@type"])return"ContentResource";throw Error("Resource type is not known")}var Q8=class d8{constructor(e,n={}){ws(this,"traversals",void 0),ws(this,"options",void 0),this.traversals={collection:[],manifest:[],canvas:[],annotationList:[],sequence:[],annotation:[],contentResource:[],choice:[],range:[],service:[],layer:[],...e},this.options={convertPropsToArray:!0,mergeMemberProperties:!0,allowUndefinedReturn:!1,...n}}static all(e){return new d8({collection:[e],manifest:[e],canvas:[e],annotationList:[e],sequence:[e],annotation:[e],contentResource:[e],choice:[e],range:[e],service:[e],layer:[e]})}traverseCollection(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCollectionItems(e))),this.traversals.collection)}traverseCollectionItems(e){if(this.options.mergeMemberProperties){let n=[...(e.manifests||[]).map(s=>typeof s=="string"?{"@id":s,"@type":"sc:Manifest"}:s),...(e.collections||[]).map(s=>typeof s=="string"?{"@id":s,"@type":"sc:Collection"}:s),...e.members||[]],i=[],r=n.filter(s=>i.includes(s["@id"])?!1:(i.push(s["@id"]),!0));delete e.collections,delete e.manifests,e.members=r}return e.manifests&&(e.manifests=e.manifests.map(n=>this.traverseManifest(typeof n=="string"?{"@id":n,"@type":"sc:Manifest"}:n))),e.collections&&(e.collections=e.collections.map(n=>this.traverseCollection(typeof n=="string"?{"@id":n,"@type":"sc:Collection"}:n))),e.members&&(e.members=e.members.map(n=>typeof n=="string"?n:n["@type"]==="sc:Collection"?this.traverseCollection(n):n["@type"]==="sc:Manifest"?this.traverseManifest(n):this.traverseUnknown(n))),e}traverseManifest(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(e))),this.traversals.manifest)}traverseManifestItems(e){return e.sequences&&(e.sequences=e.sequences.map(n=>this.traverseSequence(n))),e.structures&&(e.structures=e.structures.map(n=>this.traverseRange(n))),e}traverseSequence(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseSequenceItems(e))),this.traversals.sequence)}traverseSequenceItems(e){return e.canvases&&(e.canvases=e.canvases.map(n=>this.traverseCanvas(n))),e}traverseCanvas(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(e))),this.traversals.canvas)}traverseCanvasItems(e){return e.images&&(e.images=e.images.map(n=>this.traverseAnnotation(n))),e.otherContent&&(e.otherContent=e.otherContent.map(n=>this.traverseAnnotationList(n))),e}traverseRange(e){return e["@type"]!=="sc:Range"&&(e["@type"]="sc:Range"),this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseRangeItems(e))),this.traversals.range)}traverseRangeItems(e){if(this.options.mergeMemberProperties){let n=[...(e.ranges||[]).map(i=>typeof i=="string"?{"@id":i,"@type":"sc:Range"}:i),...(e.canvases||[]).map(i=>typeof i=="string"?{"@id":i,"@type":"sc:Canvas"}:i),...e.members||[]];delete e.ranges,delete e.canvases,e.members=n.length?n.map(i=>this.traverseUnknown(i)):void 0}return e}traverseAnnotationList(e){let n=typeof e=="string"?{"@id":e,"@type":"sc:AnnotationList"}:e;return this.traverseType(this.traverseDescriptive(this.traverseAnnotationListItems(n)),this.traversals.annotationList)}traverseAnnotationListItems(e){return e.resources&&(e.resources=e.resources.map(n=>this.traverseAnnotation(n))),e}traverseAnnotation(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationItems(e))),this.traversals.annotation)}traverseAnnotationItems(e){return e.resource&&(Array.isArray(e.resource)?e.resource=e.resource.map(n=>this.traverseContentResource(n)):e.resource=this.traverseContentResource(e.resource)),e.on,e}traverseLayer(e){return this.traverseType(this.traverseLinking(this.traverseLayerItems(e)),this.traversals.layer)}traverseLayerItems(e){return e.otherContent&&(e.otherContent=e.otherContent.map(n=>this.traverseAnnotationList(n))),e}traverseChoice(e){return this.traverseType(this.traverseChoiceItems(e),this.traversals.choice)}traverseChoiceItems(e){return e.default&&e.default!=="rdf:nil"&&(e.default=this.traverseContentResource(e.default)),e.item&&e.item!=="rdf:nil"&&(e.item=e.item.map(n=>this.traverseContentResource(n))),e}traverseService(e){return this.traverseType(this.traverseLinking(e),this.traversals.service)}traverseContentResource(e){return e["@type"]==="oa:Choice"?this.traverseChoice(e):this.traverseType(this.traverseDescriptive(this.traverseLinking(e)),this.traversals.contentResource)}traverseUnknown(e){if(!e["@type"]||typeof e=="string")return e;switch(X8(e)){case"sc:Collection":return this.traverseCollection(e);case"sc:Manifest":return this.traverseManifest(e);case"sc:Canvas":return this.traverseCanvas(e);case"sc:Sequence":return this.traverseSequence(e);case"sc:Range":return this.traverseRange(e);case"oa:Annotation":return this.traverseAnnotation(e);case"sc:AnnotationList":return this.traverseAnnotationList(e);case"sc:Layer":return this.traverseLayer(e);case"Service":return this.traverseService(e);case"oa:Choice":return this.traverseChoice(e);case"ContentResource":return this.traverseContentResource(e)}return e.profile?this.traverseService(e):e}traverseImageResource(e){let n=Array.isArray(e),i=Array.isArray(e)?e:[e],r=[];for(let s of i)typeof s=="string"?r.push(this.traverseContentResource({"@id":s,"@type":"dctypes:Image"})):r.push(this.traverseContentResource(s));return!n&&!this.options.convertPropsToArray?r[0]:r}traverseDescriptive(e){return e.thumbnail&&(e.thumbnail=this.traverseImageResource(e.thumbnail)),e.logo&&(e.logo=this.traverseImageResource(e.logo)),e}traverseOneOrMoreServices(e){let n=Array.isArray(e),i=Array.isArray(e)?e:[e],r=[];for(let s of i)r.push(this.traverseService(s));return!n&&!this.options.convertPropsToArray?r[0]:r}traverseLinking(e){return e.related&&(e.related=this.traverseOneOrManyType(e.related,this.traversals.contentResource)),e.rendering&&(e.rendering=this.traverseOneOrManyType(e.rendering,this.traversals.contentResource)),e.service&&(e.service=this.traverseOneOrMoreServices(e.service)),e.seeAlso&&(e.seeAlso=this.traverseOneOrManyType(e.seeAlso,this.traversals.contentResource)),e.within&&(typeof e.within=="string"||(e.within=this.traverseOneOrManyType(e.within,this.traversals.contentResource))),e.startCanvas&&(typeof e.startCanvas=="string"?e.startCanvas=this.traverseType({"@id":e.startCanvas,"@type":"sc:Canvas"},this.traversals.canvas):e.startCanvas&&this.traverseType(e.startCanvas,this.traversals.canvas)),e.contentLayer&&(typeof e.contentLayer=="string"?e.contentLayer=this.traverseLayer({"@id":e.contentLayer,"@type":"sc:Layer"}):e.contentLayer=this.traverseLayer(e.contentLayer)),e}traverseOneOrManyType(e,n){if(!Array.isArray(e))if(this.options.convertPropsToArray)e=[e];else return this.traverseType(e,n);return e.map(i=>this.traverseType(i,n))}traverseType(e,n){return n.reduce((i,r)=>{let s=r(i);return s===void 0&&!this.options.allowUndefinedReturn?i:s},e)}};const Z8=["http://iiif.io/api/image/2/level1","http://iiif.io/api/image/2/level2","http://library.stanford.edu/iiif/image-api/compliance.html#level1","http://library.stanford.edu/iiif/image-api/compliance.html#level2","http://library.stanford.edu/iiif/image-api/conformance.html#level1","http://library.stanford.edu/iiif/image-api/conformance.html#level2","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2","http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1","http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2","http://iiif.io/api/image/1/level1.json","http://iiif.io/api/image/1/profiles/level1.json","http://iiif.io/api/image/1/level2.json","http://iiif.io/api/image/1/profiles/level2.json","http://iiif.io/api/image/2/level1.json","http://iiif.io/api/image/2/profiles/level1.json","http://iiif.io/api/image/2/level2.json","http://iiif.io/api/image/2/profiles/level2.json","level1","level2"],mm={attributionLabel:"Attribution",providerId:"http://example.org/provider",providerName:""};function J8(t){if(typeof t=="string")return[t];if(!t)return[];let e=Array.isArray(t)?t:[t],n=[];for(let i of e){if(typeof i=="string"){n.push(i);continue}n.push({"@language":i["@language"]||i.language,"@value":i["@value"]||i.value})}return n}function So(t,e="none"){if(!t)return{none:[""]};let n=J8(t),i={};for(let r of n){if(typeof r=="string"){i[e]=i[e]?i[e]:[],i[e].push(r||"");continue}if(!r["@language"]){i[e]=i[e]?i[e]:[],i[e].push(r["@value"]||"");continue}let s=r["@language"];i[s]=i[s]?i[s]:[],i[s].push(r["@value"]||"")}return Object.keys(i).length===0?{none:[""]}:i}function bx(t){if(Array.isArray(t))return bx(t.find(e=>typeof e=="string"));if(Fd.indexOf(t)!==-1)return"level2";if(Z8.indexOf(t)!==-1)return"level1";if(W8.indexOf(t)!==-1)return"level0";if(typeof t=="string")return t}function eF(t){let e=Array.isArray(t)?t:[t];for(let n of e)switch(n){case"http://iiif.io/api/image/2/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2":return"ImageService2";case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":return"ImageService1";case"http://iiif.io/api/annex/openannotation/context.json":return"ImageApiSelector"}}function tF(t){switch(t){case"http://iiif.io/api/image/2/level0.json":case"http://iiif.io/api/image/2/level1.json":case"http://iiif.io/api/image/2/level2.json":return"ImageService2";case"http://iiif.io/api/auth/1/kiosk":case"http://iiif.io/api/auth/1/login":case"http://iiif.io/api/auth/1/clickthrough":case"http://iiif.io/api/auth/1/external":case"http://iiif.io/api/auth/0/kiosk":case"http://iiif.io/api/auth/0/login":case"http://iiif.io/api/auth/0/clickthrough":case"http://iiif.io/api/auth/0/external":return"AuthCookieService1";case"http://iiif.io/api/auth/1/token":case"http://iiif.io/api/auth/0/token":return"AuthTokenService1";case"http://iiif.io/api/auth/1/logout":case"http://iiif.io/api/auth/0/logout":return"AuthLogoutService1";case"http://iiif.io/api/search/1/search":case"http://iiif.io/api/search/0/search":return"SearchService1";case"http://iiif.io/api/search/1/autocomplete":case"http://iiif.io/api/search/0/autocomplete":return"AutoCompleteService1"}}function Ex(t){for(let e of["sc","oa","dcterms","dctypes","iiif"])if(t.startsWith(`${e}:`))return t.slice(e.length+1);return t}const nF=["Collection","Manifest","Annotation","AnnotationPage","Range","Service"];function gm(t){let e=t["@id"]||t.id,n=t["@type"]||t.type,i=t.profile||void 0,r=t["@context"]||void 0;if(i){let s=tF(i);if(s)return s}if(r){let s=eF(r);if(s)return s}if(n){if(Array.isArray(n)){if(n.indexOf("oa:CssStylesheet")!==-1)return"CssStylesheet";if(n.indexOf("cnt:ContentAsText")!==-1)return"TextualBody";n=n[0]}for(let s of["sc","oa","dcterms","dctypes","iiif"])if(n.startsWith(`${s}:`)){n=n.slice(s.length+1);break}switch(n){case"Layer":return"AnnotationCollection";case"AnnotationList":return"AnnotationPage";case"cnt:ContentAsText":return"TextualBody"}}if(n&&nF.indexOf(n)!==-1)return n;if(t.format){if(t.format.startsWith("image/"))return"Image";if(t.format.startsWith("text/")||t.format==="application/pdf")return"Text";if(t.format.startsWith("application/"))return"Dataset"}return e&&(e.endsWith(".jpg")||e.endsWith(".png")||e.endsWith(".jpeg"))?"Image":n||"unknown"}const iF=/http(s)?:\/\/(creativecommons.org|rightsstatements.org)[^"'\\<\n]+/gm;function rF(t){let e=t.match(iF);return e?e[0]:t}function sF(t,e="Rights/License",n="none"){let i=null,r=[],s=Array.isArray(t)?t:[t];for(let o of s){let a=o?rF(o):void 0;if(a&&(a.indexOf("creativecommons.org")!==-1||a.indexOf("rightsstatements.org")!==-1)){i=a.startsWith("https://")?`http://${a.slice(8)}`:a;continue}a&&r.push({label:{[n]:[e]},value:{[n]:[a]}})}return[i,r]}const oF=["http://iiif.io/api/presentation/2/context.json","http://iiif.io/api/image/2/context.json","http://iiif.io/api/image/1/context.json","http://library.stanford.edu/iiif/image-api/1.1/context.json","http://iiif.io/api/search/1/context.json","http://iiif.io/api/search/0/context.json","http://iiif.io/api/auth/1/context.json","http://iiif.io/api/auth/0/context.json","http://iiif.io/api/annex/openannotation/context.json"];function aF(t){if(t){let e=Array.isArray(t)?t:[t],n=[];for(let i of e)i==="http://iiif.io/api/presentation/2/context.json"&&n.push("http://iiif.io/api/presentation/3/context.json"),oF.indexOf(i)===-1&&n.push(i);if(e.length)return n.length===1?n[0]:n}}function lF(t){return t?t.map(e=>({label:So(e.label),value:So(e.value)})):[]}let Tx=0;function Sx(t,e){let n=encodeURI(t.id||t["@id"]||"").trim();return n&&e?`${n}/${e}`:n||(Tx++,`http://example.org/${t["@type"]}${e?`/${e}`:""}/${Tx}`)}function jr(t){let e=[...t.behavior||[]];t.viewingHint&&e.push(t.viewingHint);let n;return Array.isArray(t.motivation)?n=t.motivation.map(Ex):t.motivation&&(n=Ex(t.motivation)),{"@context":t["@context"]?aF(t["@context"]):void 0,id:(t["@id"]||Sx(t)).trim(),type:gm(t),behavior:e.length?e:void 0,height:t.height?t.height:void 0,width:t.width?t.width:void 0,motivation:n,viewingDirection:t.viewingDirection,profile:t.profile,format:t.format?t.format:void 0,duration:void 0,timeMode:void 0}}function Wr(t){let[e,n]=sF(t.license),i=[...t.metadata?lF(t.metadata):[],...n];return{rights:e,metadata:i.length?i:void 0,label:t.label?So(t.label):void 0,requiredStatement:t.attribution?{label:So(mm.attributionLabel),value:So(t.attribution)}:void 0,navDate:t.navDate,summary:t.description?So(t.description):void 0,thumbnail:uF(t.thumbnail)}}function uF(t){return t&&(Array.isArray(t)?t:[t]).map(n=>typeof n=="string"?{id:n,type:"Image"}:(n.type==="unknown"&&(n.type="Image"),n))}function cF(t){if(!t.within)return;let e=Array.isArray(t.within)?t.within:[t.within],n=[];for(let i of e)if(typeof i=="string"){if(i)switch(t["@type"]){case"sc:Manifest":n.push({id:i,type:"Collection"});break}}else i["@id"]&&n.push({id:i["@id"],type:gm(i)});return n.length?n:void 0}function _s(t){let e=t.related?Array.isArray(t.related)?t.related:[t.related]:[],n=t.contentLayer;return{provider:t.logo||e.length?[{id:mm.providerId,type:"Agent",homepage:e.length?[e[0]]:void 0,logo:t.logo?Array.isArray(t.logo)?t.logo:[t.logo]:void 0,label:So(mm.providerName)}]:void 0,partOf:cF(t),rendering:t.rendering,seeAlso:t.seeAlso,start:t.startCanvas,service:t.service?Gr(t.service):void 0,supplementary:n?[n]:void 0}}function dF(t){return{chars:t.chars,format:t.format?t.format:void 0,language:t.language}}function ym(t,e){return t?typeof t=="string"?{id:t,type:e}:typeof(t==null?void 0:t["@id"])=="string"?{id:t["@id"],type:e}:typeof t.id=="string"?{id:t.id,type:e}:null:null}function fF(t){let e={};if(t.first){let n=ym(t.first,"Collection");n&&(e.first=n)}if((t.total||t.total===0)&&(e.total=t.total),t.prev){let n=ym(t.prev,"Collection");n&&(e.prev=n)}if(t.next){let n=ym(t.next,"Collection");n&&(e.next=n)}return e}function hF(t){let e=[];for(let n of t){let i={...n};i.items&&i.items.length===0&&delete i.items,e.push(i)}return e}function pF(t){return cr({...jr(t),...Wr(t),..._s(t),...fF(t),items:hF(t.members)})}function mF(t){let e=[],n=[],i,r;for(let o of t.sequences||[])o.canvases.length&&e.push(...o.canvases),o.behavior&&n.push(...o.behavior),o.viewingDirection&&(r=o.viewingDirection),o.startCanvas&&(i=o.startCanvas);let s=jr(t);return n.length&&(s.behavior?s.behavior.push(...n):s.behavior=n),cr({...s,...Wr(t),..._s(t),viewingDirection:r,start:i,items:e,structures:gF(t.structures)})}function gF(t){if(!t)return t;let e=new Map;for(let i of t)e.set(i.id,i);let n=[];for(let i of t)if(i.items){let r=i.items.map(s=>typeof s=="string"?(n.push(s),e.get(s)||s):s&&s.id?(n.push(s.id),e.get(s.id)||s):s);i.items=r}return t.filter(i=>n.indexOf(i.id)===-1)}function yF(t){return cr({...jr(t),...Wr(t),..._s(t),annotations:t.otherContent&&t.otherContent.length?t.otherContent:void 0,items:t.images&&t.images.length?[{id:Sx(t,"annotation-page"),type:"AnnotationPage",items:t.images}]:void 0})}function vF(t){return cr({...jr(t),...Wr(t),..._s(t),items:t.resources&&t.resources.length?t.resources:void 0})}function bF(t){return!t.canvases||t.canvases.length===0?{canvases:[],behavior:[]}:{canvases:t.canvases,behavior:t.viewingHint?[t.viewingHint]:[],viewingDirection:t.viewingDirection,startCanvas:t.startCanvas}}function EF(t){function e(n){if(Array.isArray(n)){if(n.length>1)return{type:"List",items:n.map(e)};n=n[0]}if(typeof n=="string")return encodeURI(n).trim();if("@type"in n){let i;if(typeof n.full=="string")i=n.full;else if(n.full["@type"]==="dctypes:Image")i={id:n.full["@id"],type:"Image"};else if(n.full["@type"]==="sc:Canvas")i={id:n.full["@id"],type:"Canvas"};else throw Error(`Unsupported source type on annotation: ${n.full["@type"]}`);return{type:"SpecificResource",source:i,selector:vm(n.selector)}}else return encodeURI(n["@id"]).trim()}return cr({...jr(t),...Wr(t),..._s(t),target:e(t.on),body:Array.isArray(t.resource)?t.resource.map(xx):xx(t.resource)})}function xx(t){return t.type==="Choice"?t:wx(t)}function wx(t){let e=t;return cr({...jr(e),...Wr(e),..._s(e),...dF(e)})}function TF(t){let e=[];return t.default&&t.default!=="rdf:nil"&&e.push(t.default),t.item&&t.item!=="rdf:nil"&&e.push(...t.item),cr({...jr(t),...Wr(t),items:e})}function SF(t){return cr({...jr(t),...Wr(t),..._s(t),items:t.members})}function xF(t){let{"@id":e,"@type":n,"@context":i,profile:r,...s}=t,o={};return e&&(o["@id"]=e),o["@type"]=gm(t),o["@type"]==="unknown"&&(i&&i.length&&(o["@context"]=i),o["@type"]="Service"),r&&(o.profile=bx(r)),cr({...o,...s})}function wF(t){return cr({...jr(t),...Wr(t),..._s(t)})}const _F=new Q8({collection:[pF],manifest:[mF],canvas:[yF],annotationList:[vF],sequence:[bF],annotation:[EF],contentResource:[wx],choice:[TF],range:[SF],service:[xF],layer:[wF]});function _x(t){return t&&t["@context"]&&(t["@context"]==="http://iiif.io/api/presentation/2/context.json"||t["@context"].indexOf("http://iiif.io/api/presentation/2/context.json")!==-1||t["@context"]==="http://www.shared-canvas.org/ns/context.json")||t["@context"]==="http://iiif.io/api/image/2/context.json"||t["@id"]&&t["@type"]==="sc:Collection"||t["@id"]&&t["@type"]==="sc:Manifest"?(t["@context"]||(t["@context"]="http://iiif.io/api/presentation/2/context.json"),_F.traverseUnknown(t)):t}function vm(t){if((Array.isArray(t["@type"])&&t["@type"].includes("oa:SvgSelector")||t["@type"]=="oa:SvgSelector")&&("chars"in t||"value"in t))return{type:"SvgSelector",value:"chars"in t?t.chars:t.value};if(t["@type"]==="oa:FragmentSelector")return{type:"FragmentSelector",value:t.value};if(t["@type"]==="oa:Choice")return[vm(t.default),...(Array.isArray(t.item)?t.item:[t.item]).map(vm)];if(t["@type"]=="iiif:ImageApiSelector")return{type:"ImageApiSelector",region:"region"in t?t.region:void 0,rotation:"rotation"in t?t.rotation:void 0};throw Error(`Unsupported selector type: ${t["@type"]}`)}const Bd={},mu={get(t){return t},setMetaValue([t,e,n],i){let r=mu.getResourceMeta(t,e),s=r?r[n]:void 0,o=typeof i=="function"?i(s):i;Bd[t]={...Bd[t]||{},[e]:{...(Bd[t]||{})[e]||{},[n]:o}}},getResourceMeta:(t,e)=>{let n=Bd[t];if(n)return e?n[e]:n},async load(t){let e=typeof t=="string"?t:t.id;return fetch(e).then(n=>n.json())},requestStatus(t){}};function gu(t){"@babel/helpers - typeof";return gu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gu(t)}function AF(t,e){if(gu(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e);if(gu(i)!="object")return i;throw TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function CF(t){var e=AF(t,"string");return gu(e)=="symbol"?e:e+""}function Ri(t,e,n){return(e=CF(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const IF={},Ax=t=>{let e,n=new Set,i=(c,d)=>{let f=typeof c=="function"?c(e):c;if(!Object.is(f,e)){let h=e;e=d??(typeof f!="object"||!f)?f:Object.assign({},e,f),n.forEach(p=>p(e,h))}},r=()=>e,s=()=>u,o=c=>(n.add(c),()=>n.delete(c)),a=()=>{(IF?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()},l={setState:i,getState:r,getInitialState:s,subscribe:o,destroy:a},u=e=t(i,r,l);return l},Cx=t=>t?Ax(t):Ax;function Ix(t){return{all:t||(t=new Map),on:function(e,n){var i=t.get(e);i?i.push(n):t.set(e,[n])},off:function(e,n){var i=t.get(e);i&&(n?i.splice(i.indexOf(n)>>>0,1):t.set(e,[]))},emit:function(e,n){var i=t.get(e);i&&i.slice().map(function(r){r(n)}),(i=t.get("*"))&&i.slice().map(function(r){r(e,n)})}}}function RF(t){try{if(t==="full")return{full:!0};if(t==="square")return{square:!0};let e=t.startsWith("pct:"),n=t.substr(e?4:0).split(","),i=n.map(r=>parseFloat(r));return{x:i[0],y:i[1],w:i[2],h:i[3],percent:e}}catch{throw Error("Expected 'full', 'square' or 'x,y,w,h'. Found "+t)}}function LF(t){let e={upscaled:!1,max:!1,confined:!1};if(t[0]==="^"&&(e.upscaled=!0,t=t.slice(1)),t==="max"||t==="full")return e.max=!0,e.serialiseAsFull=t==="full",e;if(t[0]==="!"&&(e.confined=!0,t=t.slice(1)),t[0]==="p")return e.percentScale=parseFloat(t.slice(4)),e;let n=t.split(",").map(i=>i.trim());return n.length&&(n[0]!==""&&(e.width=parseInt(n[0],10)),n[1]!==""&&(e.height=parseInt(n[1],10))),e}function PF(t){let e={angle:0};if(t[0]==="!"&&(e.mirror=!0,t=t.substr(1)),e.angle=parseFloat(t)%360,Number.isNaN(e.angle))throw Error(`Invalid rotation ${t}`);return e}function kF(t,e=""){let n=t.match(/^(([a-zA-Z]+):\/\/([^/]+))?((.*)+)/);if(!n)throw Error(`Invalid or unknown input ${t}`);let i=n[2],r=n[3],s=n[4];if(s[0]==="/"&&(s=s.substring(1)),e.length>0){if(e[0]==="/"&&(e=e.substring(1)),e!==s.substring(0,e.length))throw Error(`Path does not start with prefix (path: ${s}, prefix: ${e})`);s=s.substring(e.length)}return{scheme:i,server:r,path:s,prefix:e}}function DF(t,e=""){let{path:n,scheme:i,server:r,prefix:s}=kF(t,e),o=n.split("/").reverse(),[a,l,u,c,...d]=o,f=d.reverse().filter(Boolean).join("/");if(o.length===1||a==="")return{type:"base",scheme:i,server:r,prefix:s,identifier:f};if(a==="info.json"){let[,...m]=o;return{type:"info",scheme:i,server:r,prefix:s,identifier:m.reverse().filter(Boolean).join("/")}}if(i===void 0||r===void 0||n===void 0||c===void 0||u===void 0||l===void 0||a===void 0)throw Error("Invalid image service URL");let[h="",p=""]=a.split(".");return{type:"image",scheme:i,server:r,prefix:s,identifier:f,originalPath:n,region:RF(c),size:LF(u),rotation:PF(l),quality:h,format:p}}function OF(t){return Fd.indexOf(t)!==-1?Y8:pm.indexOf(t)!==-1?K8:q8}function NF(t){let e=t?Array.isArray(t.profile)?t.profile:[t.profile]:[],n={extraQualities:[],extraFormats:[],extraFeatures:[]};for(let i of e)if(typeof i=="string"&&(i=OF(i)),!!i){if(i.formats)for(let r of i.formats)n.extraFormats.indexOf(r)===-1&&n.extraFormats.push(r);if(i.qualities)for(let r of i.qualities)n.extraQualities.indexOf(r)===-1&&n.extraQualities.push(r);if(i.supports)for(let r of i.supports)n.extraFeatures.indexOf(r)===-1&&n.extraFeatures.push(r);if(i.maxHeight&&(n.maxHeight=i.maxHeight),i.maxWidth&&(n.maxWidth=i.maxWidth),i.maxArea&&(n.maxArea=i.maxArea),i.extraFormats)for(let r of i.extraFormats)n.extraFormats.indexOf(r)===-1&&n.extraFormats.push(r);if(i.extraQualities)for(let r of i.extraQualities)n.extraQualities.indexOf(r)===-1&&n.extraQualities.push(r);if(i.extraFeatures)for(let r of i.extraFeatures)n.extraFeatures.indexOf(r)===-1&&n.extraFeatures.push(r);i.maxHeight&&(n.maxHeight=i.maxHeight),i.maxWidth&&(n.maxWidth=i.maxWidth),i.maxArea&&(n.maxArea=i.maxArea)}if(t.extraFormats)for(let i of t.extraFormats)n.extraFormats.indexOf(i)===-1&&n.extraFormats.push(i);if(t.extraFeatures)for(let i of t.extraFeatures)n.extraFeatures.indexOf(i)===-1&&n.extraFeatures.push(i);if(t.extraQualities)for(let i of t.extraQualities)n.extraQualities.indexOf(i)===-1&&n.extraQualities.push(i);return n}function Rx(t){let e=Array.isArray(t.profile)?t.profile:[t.profile];for(let n of e)if(typeof n=="string"&&yx.indexOf(n)!==-1)return!0;return!1}function Ut(t){if(t["@id"])return t["@id"];if(t.id)return t.id}function Ud(t){if(!t||!t.profile||!Ut(t))return!1;let e=Array.isArray(t.profile)?t.profile:[t.profile];for(let n of e)if(typeof n=="string"&&gx.indexOf(n)!==-1)return!0;return!1}function MF(t){if(!Ud(t))return!1;let e=Array.isArray(t.profile)?t.profile:[t.profile];for(let n of e)if(typeof n=="string"){if(pm.indexOf(n)!==-1)return!0}else{let i=[...n.supports||[],...n.extraFeatures||[]];if(i.indexOf("regionByPx")!==-1&&(i.indexOf("sizeByW")!==-1||i.indexOf("sizeByWh")!==-1))return!0}return!1}function FF({x:t=0,y:e=0,w:n,h:i,full:r,square:s,percent:o}){return"full"}function BF({max:t,percentScale:e,upscaled:n,confined:i,width:r,height:s,serialiseAsFull:o,version:a}){let l=[];return n&&l.push("^"),t?(l.push(o?"full":"max"),l.join("")):(i&&l.push("!"),e&&l.push(`pct:${e}`),r&&l.push(`${r}`),l.push(","),s&&a===3&&l.push(`${s}`),l.join(""))}function UF(t){return`${t.mirror?"!":""}${(t.angle||0)%360}`}function HF(t,e){let n=t.prefix.startsWith("/")?t.prefix.substring(1):t.prefix,i=`${t.scheme}://${t.server}/${n?`${n}/`:""}${t.identifier}`,{size:r}=t,{region:s,rotation:o,format:a,quality:l}=t;return[i,FF(s),BF(r),UF(o),`${l}.${a}`].filter(Boolean).join("/")}function xo(t){return t.endsWith("info.json")?t:t.endsWith("/")?`${t}info.json`:`${t}/info.json`}function $F(t){let e=DF(xo(t.id));if(e.type!=="info")throw Error("Invalid service URL");let n=NF(t);return{identifier:e.identifier,originalPath:"",server:e.server,prefix:e.prefix,scheme:e.scheme,type:"image",quality:n.extraQualities.indexOf("default")===-1?n.extraQualities[0]:"default",region:{full:!0},size:{max:!0,upscaled:!1,confined:!1},format:"jpg",rotation:{angle:0}}}function zF(t,e,n){let i=n.length,r=[];for(let s=0;s<i;s++){let o=n[s];if(!o)continue;let a=o.width;r.push(t/a)}return r}function VF(t,e,n){let i=n.length,r=[];for(let s=0;s<i;s++){let o=n[s];o&&r.push({width:Math.floor(t/o),height:Math.floor(e/o)})}return r}function bm(t,e){if(e&&e.profile){let n=e.profile;if(n){let i=Array.isArray(n)?n:[n];if(i.includes(`level${t}`)||i.includes(`http://iiif.io/api/image/2/level${t}.json`)||i.includes(`http://iiif.io/api/image/1/level${t}.json`)||i.includes(`http://iiif.io/api/image/1/profiles/level${t}.json`))return!0;if(t===2){for(let r of i)if(Fd.includes(r))return!0}if(t===1){for(let r of i)if(pm.includes(r))return!0}if(t===0){for(let r of i)if(yx.includes(r))return!0}}}return!1}function Em(t){return Ud(t)?bm(2,t)?2:bm(1,t)?1:bm(0,t)?0:null:null}function Lx(t){let e=t.service?Array.isArray(t.service)?t.service:[t.service]:[],n=e.length,i=[];for(let r=0;r<n;r++)Ud(e[r])&&i.push(e[r]);return i}function GF(t){if(t["@type"])return t["@type"];if(t.type)return t.type}function wa(t){let e=t.replace(/(https?:\/\/)?(www.)?/i,"");return e.indexOf("/")===-1?e:e.split("/")[0]}function jF(t,e,n){let i=t>e?t:e,r=n.length,s=[];for(let o=0;o<r;o++){let a=n[o];if(!a||a.scaleFactors.length===0)continue;let l=a.scaleFactors[0];if(!l)continue;let u=i/l,c=[l];for(;u>=a.width;)l*=2,c.push(l),u/=2;s.push({...a,scaleFactors:c})}return s}function Tm(t,e,n){let i=$F({"@context":t.version===3?"http://iiif.io/api/image/3/context.json":"http://iiif.io/api/image/2/context.json",id:xo(Ut(t)),profile:t.level===null||t.level===void 0?"level0":`level${t.level}`,type:t.version===3?"ImageService3":"ImageService2"});return i.size.max=!1,i.size.width=e,i.size.height=n,{id:HF(i),type:"fixed",width:e,height:n||t.height/(t.width||1)*e,unsafe:t.width>e}}function WF(t,e,n){let i=t.width?t.width:t.maxWidth;return n.height<=t.maxHeight&&n.width<=t.maxWidth&&n.height>=t.minHeight&&n.width>=t.minWidth&&(!e||Math.abs(n.width-i)<Math.abs(e.width-i))}function qF(t,e){let n=[],i=Object.assign({unsafeImageService:!1,atAnyCost:!0,fallback:!0,minHeight:64,minWidth:64,maxHeight:1/0,maxWidth:1/0,returnAllOptions:!1,preferFixedSize:!1,allowUnsafe:!1,explain:!1,height:0,width:0},t),r=(c,d=0)=>i.explain?n.push(Array(d).fill(0).map(f=>"    ").join("")+c().trim()):void 0,s=[],o=[],a=null;r(()=>`Using configuration: ${JSON.stringify(i,null,2)}`);let l=(c,d)=>{if(r(()=>"Swapping choice",3),WF(i,d,c)){if(i.preferFixedSize&&c.unsafe){r(()=>`We found an image that was marked as unsafe, but it was the best size. (${c.id})`,4),o.push(c);return}i.returnAllOptions&&d&&o.push(d),r(()=>`We found a new image that was the best size. (${c.id})`,4),a=c}else i.returnAllOptions&&o.push(c)};r(()=>`The input shows we have ${e.length} list(s) of candidates to choose from.`);let u=e.length;for(let c=0;c<u;c++){let d=e[c]();r(()=>`Candidate group ${c}: ${JSON.stringify(d,null,2)}`,1);let f=d.length;r(()=>`Checking candidate list number ${c} and found ${f} potential ways of creating image(s)`,1);for(let h=0;h<f;h++){let p=d[h];if(r(()=>`-> Checking candidate ${h}`,1),p.type==="unknown"&&i.atAnyCost&&(r(()=>`We've found an unknown image type, adding this to the "last resort" list`,2),s.push(p)),p.type==="fixed"&&(p.unsafe?(r(()=>`We've found an unsafe fixed image type, adding this to the "last resort" list`,2),s.push(p)):(r(()=>"We've found a fixed size image, checking if it matches the request",2),l(p,a))),p.type==="fixed-service")if(i.unsafeImageService){r(()=>"Checking for an image from the tile source, without calculating the right height and width (unsafeImageService)",2);let m=Tm(p,i.width,i.height);l(m,a)}else{r(()=>"Checking for an image from the tile source 3",2);let m=Tm(p,p.width,p.height);l(m,a)}if(p.type==="variable"&&p.maxWidth){let m=Tm({id:p.id,type:"fixed-service",width:p.maxWidth,height:p.maxWidth,level:p.level,version:p.version},p.maxWidth);l(m,a)}}if(a&&!i.returnAllOptions){if(a.unsafe||i.allowUnsafe)continue;r(()=>`We found a match in choice list number ${c}, no searching any more`);break}}return i.atAnyCost&&o.length===0?(r(()=>a?`We found an image! ${a.id} of type ${a.type}`:'We found no images, but "atAnyCost" is set, so returning that'),{best:a||s[0]||null,fallback:s.slice(1),log:n}):i.returnAllOptions?(r(()=>"Returning all options that we have found"),{best:(i.atAnyCost?a||o[0]||s[0]:a||o[0])||null,fallback:[...o,...s],log:n}):(r(()=>"Returning the best image that we found, and a fallback"),{best:a||o[0]||null,fallback:a?o:o.slice(1),log:n})}function Px(t){return(t["@context"]?Array.isArray(t["@context"])?t["@context"]:[t["@context"]]:[]).indexOf("http://iiif.io/api/image/3/context.json")!==-1}function KF(t){return Ud(t)?(t&&t.sizes?t.sizes:[]).map(e=>({id:Ut(t),type:"fixed-service",height:e.height,width:e.width,level:Em(t),version:Px(t)?3:2})):[]}function YF(t){if(!MF(t))return[];let e=[],n=Array.isArray(t.profile)?t.profile:[t.profile],i=n.length;for(let r=0;r<i;r++){let s=n[r];if(s&&typeof s!="string"&&(s.maxHeight||s.maxWidth))return[{id:Ut(t),type:"variable",minWidth:0,minHeight:0,maxHeight:s.maxHeight||s.maxWidth,maxWidth:s.maxWidth||s.maxHeight,level:Em(t),version:t["@context"]==="http://iiif.io/api/image/3/context.json"?3:2}]}if(t.tiles){let r=t.tiles.length;for(let s=0;s<r;s++){let o=t.tiles[s];o&&(o.height||o.width)&&e.push({id:Ut(t),type:"variable",minHeight:0,minWidth:0,maxHeight:o.height||o.width,maxWidth:o.width,level:Em(t),version:Px(t)?3:2})}}return e}function kx(t){let e=[],n=t.length;for(let i=0;i<n;i++){let r=t[i];if(!r)continue;let s=KF(r);s.length&&e.push(...s);let o=YF(r);o.length&&e.push(...o)}return e}function Dx(t){let e=/^.*\/(full)\/(((\d+),(\d+)?)|max)\/(\d+)\/default\.(jpg|png|jpeg)$/,n=t.match(e);if(n&&n[4]&&n[5]){let i=n[1],r=parseInt(n[4],10),s=parseInt(n[5],10),o=n[7];if((i==="max"||i==="full")&&r&&s&&o)return{type:"fixed",id:t,height:s,width:r}}return{type:"unknown",id:t}}function Sm(t){if(typeof t=="string")return Dx(t);let e=GF(t);if(e!=="Image"&&e!=="sc:Image")return null;let n=t,i=Ut(n);return i?i&&n.width&&n.height?{id:i,type:"fixed",width:n.width,height:n.height,unsafe:!0}:Dx(i):null}function XF(t,e=!0,n){let i=[],r=Sm(t);if(r===null)return i;let s=t;if(i.push(r),e&&s&&s.width&&s.height){let o=[],a=Lx(s);for(let l of a){let u={id:Ut(l),width:s.width,height:s.height};if(n.canLoadSync(u)){let c=n.loadServiceSync(u);c&&(c.height||(c.height=s.height),c.width||(c.width=s.width),o.push(...kx([c])))}}if(o.length)return i.push(...o),i}return s.service&&i.push(...kx(s.service)),i}function QF(t,e){if(t.length!==e.length)return!1;if(t.length===0&&e.length===0)return!0;let n=t.length,i=!0;for(let s=0;s<n;s++){let o=t[s],a=e[s];if(o.width!==a.width||o.height!==a.height){i=!1;break}}if(i)return!0;let r=0;for(let s=0;s<n;s++)for(let o=0;o<n;o++)if(t[s].width===e[o].width&&t[s].height===e[o].height){r++;break}return r===n}var Ox=class{constructor(e={}){Ri(this,"config",{verificationsRequired:1,approximateServices:!1,enableFetching:!0,disableThrottling:!1}),Ri(this,"fetchingCount",0),Ri(this,"imageServices",{}),Ri(this,"knownImageServers",{}),this.config=Object.assign(this.config,e)}setConfig(e){Object.assign(this.config,e)}sample(e,n,i=!0){let r=wa(Ut(e)),s=xo(Ut(e)),o=this.knownImageServers[r];return this.imageServices[s]=Object.assign(e,{real:!0}),!o&&e.tiles&&!Rx(e)?(this.knownImageServers[r]={verifications:0,malformed:!1,root:r,preLoaded:i,sampledId:Ut(e),verified:!1,server:null,result:{context:e["@context"]||[],sampledProfile:e.profile,resourceServiceRatio:n&&e.height?n.height/e.height:1,sampledSizes:e.sizes||[],sizeRatios:zF(e.width,e.height,e.sizes||[]),sampledTiles:e.tiles||[]}},!0):this.verify(e)}preLoad(e,n=!0){this.knownImageServers[e.root]=e,n&&(this.knownImageServers[e.root].malformed=!1,this.knownImageServers[e.root].verifications=this.config.verificationsRequired)}predict(e,n=!1,i=!1){let r=e==null?void 0:e.source,s=wa(Ut(e)),o=this.knownImageServers[s],a=xo(Ut(e));return this.imageServices[a]?this.imageServices[a]||null:!this.config.approximateServices||!o||!o.result||!(r!=null&&r.height||e.height)||!(r!=null&&r.width||e.width)||!i&&(o.malformed||o.verifications<this.config.verificationsRequired)||e.source&&Rx(e.source)?null:(this.imageServices[a]||(this.imageServices[a]={"@context":o.result.context,"@id":Ut(e),id:Ut(e),protocol:"http://iiif.io/api/image",tiles:(r==null?void 0:r.tiles)||jF(e.width,e.height,o.result.sampledTiles),sizes:(r==null?void 0:r.sizes)||VF(Math.round(e.width/o.result.resourceServiceRatio),Math.round(e.height/o.result.resourceServiceRatio),o.result.sizeRatios),profile:(r==null?void 0:r.profile)||o.result.sampledProfile,height:(r==null?void 0:r.height)||e.height,width:(r==null?void 0:r.width)||e.width,real:!1}),this.imageServices[a]||null)}async getThumbnailFromResource(e,n,i=!0,r=[]){let s=e?await this.getImageCandidates(e,i):[];return qF(n,[()=>r,()=>s])}async getImageCandidates(e,n=!0){let i=e;if(n&&i&&i.height&&i.width){let r=Lx(i);for(let s of r){let o={id:Ut(s),width:s.width?s.width:i.width,height:s.height?s.height:i.height,source:s};await this.loadService(o)}}return XF(e,n,this)}async verify(e){let n=this.predict(e,!1,!0),i=await this.fetchService(Ut(e));if(!n)return!1;let r=n.height===i.height&&n.width===i.width&&n["@context"]===i["@context"]&&QF(n.sizes||[],i.sizes||[]);if(r){let s=wa(Ut(e)),o=this.knownImageServers[s];o&&(o.verifications+=1,o.verifications>=this.config.verificationsRequired&&(o.verified=!0))}return r}canLoadSync(e){let n=typeof e=="string"?e:Ut(e),i=xo(n);if(this.imageServices[i])return!0;let r=this.knownImageServers[wa(n)];return!!(r&&!r.malformed&&r.verifications>=this.config.verificationsRequired)}async markAsMalformed(e){return this.knownImageServers[wa(Ut(e))].malformed=!0,this.loadService(e,!0)}async fetchService(e,n=!1){let i=xo(e),r=this.imageServices[i];if(r&&(!n||r.real))return r;if(!this.config.enableFetching)throw Error("Fetching is not enabled");let s=await this.fetch(i).then(o=>o.json());return!s.id&&s["@id"]&&(s.id=s["@id"]),s.id!==e&&(s.id=e,s["@id"]&&(s["@id"]=e)),this.imageServices[i]=Object.assign(s,{real:!0}),this.imageServices[i]}async fetch(e,n){return fetch(e,n)}async loadService(e,n=!1){if(!this.config.disableThrottling){let s=!0;for(;s;)if(this.fetchingCount>=this.config.verificationsRequired)await new Promise(o=>setTimeout(o,500));else{s=!1;break}}let i=this.knownImageServers[wa(Ut(e))];if(i&&!i.malformed&&!n){await i.result;let s=this.loadServiceSync(e);if(s)return s}this.fetchingCount++;let r=await this.fetchService(Ut(e),n);return this.fetchingCount--,r.real&&this.sample(r,e),r}loadServiceSync(e){let n=xo(Ut(e));return this.imageServices[n]?this.imageServices[n]:this.config.approximateServices?this.predict(e):null}};function ZF(t={}){let e=t.events||Ix(),n=t.loader||new Ox;return{store:Cx((r,s)=>({loaded:{},loadServiceSync:(o,a,l)=>{let u=o.id||o["@id"],c=s().loaded[u];if(c&&c.status==="done")return c.service;if(c&&c.status==="loading")return null;if(c&&c.status==="error")throw Error("Failed to load image service");let d={id:Ut(o),width:o.width||(a==null?void 0:a.width)||0,height:o.height||(a==null?void 0:a.height)||0,source:o},f=n.loadServiceSync(d);return f?(r(h=>({loaded:{...h.loaded,[u]:{status:"done",service:f,real:!0}}})),e.emit("image-service.loaded",{id:u,service:f})):l&&s().loadService(o,a).then(()=>{}),f},loadService:async(o,a)=>{let l=o.id||o["@id"],u=s().loaded[l];if(u&&u.status==="done")return u.service;if(u&&u.status==="loading")return new Promise((c,d)=>{let f=h=>{h.id===l&&(e.off("image-service.loaded",f),c(h.service||o))};e.on("image-service.loaded",f)});if(u&&u.status==="error"&&!(a!=null&&a.force))throw Error("Failed to load image service");e.emit("image-service.loading",{id:l});try{let c={id:Ut(o),width:o.width||0,height:o.height||0,source:o},d=await n.loadService(c,a==null?void 0:a.force);return r(f=>({loaded:{...f.loaded,[l]:{status:"done",service:d,real:d.real}}})),e.emit("image-service.loaded",{id:l,service:d}),d}catch(c){throw e.emit("image-service.error",{id:l,error:c}),c}}})),events:e}}ZF();const JF=new Ox,Nx=new Map;function e5(t,{vault:e=mu,dereference:n=!1,...i}={}){let r=Nx.get(e);return r||(r=t5(e),Nx.set(e,r)),r.getBestThumbnailAtSize(t,i,n)}function t5(t=mu,e={}){let n=e.imageServiceLoader||JF;async function i(r,s,o=!1,a=[],l){let u=()=>n.getThumbnailFromResource(void 0,s,o,a);if(!r)return await n.getThumbnailFromResource(void 0,s,o,a);if(typeof r=="string"){let f=Sm(r);return f&&a.push(f),await n.getThumbnailFromResource(void 0,s,o,a)}let c=t.get(r,{skipSelfReturn:!1});if(typeof c=="string")return{best:Sm(c),fallback:[],log:[]};if(!c)return await u();switch(await(async f=>{if(f&&f.thumbnail&&f.thumbnail.length){let h=t.get(f.thumbnail[0]),p=await n.getImageCandidates(h,o);p&&p.length&&a.push(...p)}})(c),c.type){case"Annotation":{let f=Array.isArray(c.body)?c.body:[c.body],h=t.get(f[0]);return l&&!h.width&&(h.width=l.width,h.height=l.height),await n.getThumbnailFromResource(h,s,o,a)}case"Canvas":{let f=c;return i(f.items[0],s,o,a,{width:f.width,height:f.height})}case"AnnotationPage":return i(c.items[0],s,o,a,l);case"Choice":{let f=c;return!f.items||f.items[0]?await u():i(f.items[0],s,o,a,l)}case"Collection":{let f=c,h=f.items[0];return h?i(h,s,o,a,l):await u()}case"Manifest":{let f=c,h=f.items[0];return h?i(h,s,o,a,l):await u()}case"SpecificResource":case"Image":case"Dataset":case"Sound":case"Text":case"TextualBody":case"Video":return l&&!c.width&&(c.width=l.width,c.height=l.height),n.getThumbnailFromResource(c,s,o,a)}return await u()}return{getBestThumbnailAtSize:i}}function qr(t){return typeof t=="string"?!1:t&&!t.type&&"source"in t?(t.type="SpecificResource",!0):!!t&&t.type==="SpecificResource"}function Hd(...t){return e=>t.reduce((n,i)=>i(n),e)}const Mx=["Collection","Manifest","Canvas","AnnotationPage","AnnotationCollection","Annotation","ContentResource","Range","Service","Selector","Agent"];function n5(t,e){if(t==null)throw Error("Null or undefined is not a valid entity.");if(Array.isArray(t))throw Error("Array is not a valid entity");if(typeof t!="object"){if(e)return e;throw Error(`${typeof t} is not a valid entity`)}if(typeof t.type=="string"){let n=Mx.indexOf(t.type);if(n!==-1)return Mx[n]}if(t.profile)return"Service";throw Error("Resource type is not known")}var i5=class f8{constructor(e,n={}){ws(this,"traversals",void 0),ws(this,"options",void 0),ws(this,"_traverseManifest",Hd(this.traverseManifestItems.bind(this),this.traverseNavPlace.bind(this),this.traverseLinking.bind(this),this.traverseDescriptive.bind(this),this.traverseLinkedCanvases.bind(this),this.traverseManifestStructures.bind(this),this.traverseInlineAnnotationPages.bind(this))),ws(this,"_traverseCanvas",Hd(this.traverseCanvasItems.bind(this),this.traverseLinking.bind(this),this.traverseDescriptive.bind(this),this.traverseLinkedCanvases.bind(this),this.traverseInlineAnnotationPages.bind(this))),ws(this,"_traverseAnnotationPage",Hd(this.traverseAnnotationPageItems.bind(this),this.traverseLinking.bind(this),this.traverseDescriptive.bind(this))),ws(this,"_traverseRange",Hd(this.traverseRangeRanges.bind(this),this.traverseLinking.bind(this),this.traverseDescriptive.bind(this),this.traverseLinkedCanvases.bind(this))),this.traversals={collection:[],manifest:[],canvas:[],annotationCollection:[],annotationPage:[],annotation:[],contentResource:[],choice:[],range:[],service:[],agent:[],specificResource:[],geoJson:[],...e},this.options={allowUndefinedReturn:!1,...n}}static all(e){return new f8({collection:[e],manifest:[e],canvas:[e],annotationCollection:[e],annotationPage:[e],annotation:[e],contentResource:[e],choice:[e],range:[e],service:[e],geoJson:[e],specificResource:[e],agent:[e]})}traverseDescriptive(e){return e.thumbnail&&(e.thumbnail=Gr(e.thumbnail).map(n=>this.traverseType(n,{parent:e},this.traversals.contentResource))),e.provider&&(e.provider=e.provider.map(n=>this.traverseAgent(n,e))),e}traverseLinking(e){return e.seeAlso&&(e.seeAlso=Gr(e.seeAlso).map(n=>this.traverseType(n,{parent:e},this.traversals.contentResource))),e.service&&(e.service=Gr(e.service).map(n=>this.traverseService(n))),e.services&&(e.services=Gr(e.services).map(n=>this.traverseService(n,e))),e.logo&&(e.logo=Gr(e.logo).map(n=>this.traverseType(n,{parent:e},this.traversals.contentResource))),e.homepage&&(e.homepage=Gr(e.homepage).map(n=>this.traverseType(n,{parent:e},this.traversals.contentResource))),e.partOf&&(e.partOf=e.partOf.map(n=>typeof n=="string"||!n.type?this.traverseType(n,{parent:e},this.traversals.contentResource):n.type==="Canvas"?this.traverseType(n,{parent:e},this.traversals.canvas):n.type==="AnnotationCollection"?this.traverseType(n,{parent:e},this.traversals.annotationCollection):n.type==="Collection"?this.traverseType(n,{parent:e},this.traversals.collection):this.traverseType(n,{parent:e},this.traversals.contentResource))),e.start&&(qr(e.start)?e.start=this.traverseSpecificResource(e.start,"Canvas",e):e.start=this.traverseType(e.start,{parent:e},this.traversals.canvas)),e.rendering&&(e.rendering=e.rendering.map(n=>this.traverseType(n,{parent:e},this.traversals.contentResource))),e.supplementary&&(e.supplementary=e.supplementary.map(n=>this.traverseType(n,{parent:e},this.traversals.contentResource))),e}traverseCollectionItems(e){return e.items&&e.items.map(n=>n.type==="Collection"?this.traverseCollection(n):this.traverseManifest(n)),e}traverseCollection(e,n){return this.traverseType(this.traverseDescriptive(this.traverseNavPlace(this.traverseInlineAnnotationPages(this.traverseLinking(this.traverseLinkedCanvases(this.traverseCollectionItems(e)))))),{parent:n},this.traversals.collection)}traverseGeoJson(e,n){return this.traverseType(e,{parent:n},this.traversals.geoJson)}traverseNavPlace(e){return e.navPlace&&(e.navPlace=this.traverseGeoJson(e.navPlace,e)),e}traverseManifestItems(e){return e.items&&(e.items=e.items.map(n=>this.traverseCanvas(n))),e}traverseManifestStructures(e){return e.structures&&(e.structures=e.structures.map(n=>this.traverseRange(n))),e}traverseManifest(e,n){return this.traverseType(this._traverseManifest(e),{parent:n},this.traversals.manifest)}traverseCanvasItems(e){return e.items=(e.items||[]).map(n=>this.traverseAnnotationPage(n,e)),e}traverseInlineAnnotationPages(e){return typeof e=="string"||!e||e.annotations&&(e.annotations=e.annotations.map(n=>this.traverseAnnotationPage(n,e))),e}traverseCanvas(e,n){return this.traverseType(this._traverseCanvas(e),{parent:n},this.traversals.canvas)}traverseAnnotationPageItems(e){return e.items&&(e.items=e.items.map(n=>this.traverseAnnotation(n,e))),e}traverseAnnotationPage(e,n){return this.traverseType(this._traverseAnnotationPage(e),{parent:n},this.traversals.annotationPage)}traverseAnnotationBody(e){return Array.isArray(e.body)?e.body=e.body.map(n=>this.traverseContentResource(n,e)):e.body&&(e.body=this.traverseContentResource(e.body,e)),e}traverseLinkedCanvases(e){return e.placeholderCanvas&&(e.placeholderCanvas=this.traverseCanvas(e.placeholderCanvas)),e.accompanyingCanvas&&(e.accompanyingCanvas=this.traverseCanvas(e.accompanyingCanvas)),e}traverseAnnotation(e,n){return this.traverseType(this.traverseLinking(this.traverseAnnotationBody(this.traverseDescriptive(e))),{parent:n},this.traversals.annotation)}traverseContentResourceLinking(e){return typeof e=="string"||!e||e&&e.service&&(e.service=Gr(e.service||[]).map(n=>this.traverseService(n,e))),e}traverseContentResource(e,n){return e.type==="Choice"&&(e.items=e.items.map(i=>this.traverseContentResource(i,e))),qr(e)?this.traverseSpecificResource(e,"ContentResource"):this.traverseType(this.traverseInlineAnnotationPages(this.traverseContentResourceLinking(e)),{parent:n},this.traversals.contentResource)}traverseSpecificResource(e,n,i){let r=e.source;return typeof e.source=="string"&&(r={id:e.source,type:n||"unknown"}),this.traverseType({...e,source:n==="Canvas"||r.type==="Canvas"?this.traverseType(r,{parent:i},this.traversals.canvas):n==="ContentResource"?this.traverseContentResource(r,{parent:i}):this.traverseUnknown(r,{parent:i,typeHint:n})},{parent:i},this.traversals.specificResource)}traverseRangeRanges(e){return e.items&&(e.items=e.items.map(n=>typeof n=="string"?this.traverseCanvas({id:n,type:"Canvas"},e):qr(n)?this.traverseSpecificResource(n,"Canvas",e):n.type==="Manifest"?this.traverseManifest(n,e):this.traverseRange(n,e))),e}traverseRange(e,n){return this.traverseType(this._traverseRange(e),{parent:n},this.traversals.range)}traverseAgent(e,n){return this.traverseType(this.traverseDescriptive(this.traverseLinking(e)),{parent:n},this.traversals.agent)}traverseType(e,n,i){return i.reduce((r,s)=>{let o=s(r,n);return o===void 0&&!this.options.allowUndefinedReturn?r:o},e)}traverseService(e,n){let i=Object.assign({},e);return i&&i.service&&(i.service=Gr(i.service).map(r=>this.traverseService(r))),this.traverseType(i,{parent:n},this.traversals.service)}traverseUnknown(e,{parent:n,typeHint:i}={}){let r=n5(e,i);switch(r){case"Collection":return this.traverseCollection(e,n);case"Manifest":return this.traverseManifest(e,n);case"Canvas":return this.traverseCanvas(e,n);case"AnnotationPage":return this.traverseAnnotationPage(e,n);case"Annotation":return this.traverseAnnotation(e,n);case"ContentResource":return this.traverseContentResource(e,n);case"Range":return this.traverseRange(e,n);case"Service":return this.traverseService(e,n);case"Agent":return this.traverseAgent(e,n);default:throw Error(`Unknown or unsupported resource type of ${r}`)}}};function $d(t,e){let n="unknown";if(!t)return;if(typeof t=="string")return{id:t,type:n};if(qr(t))return $d(t.source);let i=t.type||t["@type"],r=t.id||t["@id"];if(i&&i.indexOf(":")!==-1&&(i=i.split(":").pop()),r&&i)return{id:r,type:i}}const yu={},cn="iiif-parser:hasPart",Kr="iiif-parser:partOf",vu="iiif-parser:isExternal",Vi="__$UNSET$__",Fx="__$UNWRAP$__",Ue=[];Object.freeze(Ue),Object.freeze(yu);function r5(t){if(t===yu||Object.keys(t).length===0)return!0;for(let e in t)return!1;return!0}function xm(t,e){if(e&&e["@explicit"]){let n={},i=Object.keys(e);for(let r of i)r===Kr||r==="@explicit"||(r5(e[r])?n[r]=t[r]:n[r]=e[r]);return n}return t}function Bx(t,e,n){let i=$d(e);if(!i)return[void 0,void 0];let r=t.requests[i.id],s=i.type||t.mapping[i.id];if(!s||r&&r.resourceUri&&(!t.entities[s]||!t.entities[s][r.resourceUri]))return[void 0,void 0];let o=t.entities[s][r?r.resourceUri:i.id];if(i.type&&!o)return Bx(t,{id:i.id},n);if(o&&o[cn]){let a=o[cn].find(u=>n?u[Kr]===n.id:u[Kr]===o.id);return[xm(o,a),o]}return[o,o]}const s5={id:"https://iiif-parser/annotation-page",type:"AnnotationPage",behavior:Ue,label:null,thumbnail:Ue,summary:null,requiredStatement:null,metadata:Ue,rights:null,provider:Ue,items:Ue,seeAlso:Ue,homepage:Ue,rendering:Ue,service:Ue},o5={id:"https://iiif-parser/empty-canvas",type:"Canvas",label:null,behavior:Ue,thumbnail:Ue,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:Ue,rights:null,navDate:null,provider:Ue,items:Ue,annotations:Ue,seeAlso:Ue,homepage:Ue,partOf:Ue,rendering:Ue,service:Ue,duration:0,height:0,width:0},a5={id:"https://iiif-parser/empty-collection",type:"Collection",label:null,viewingDirection:"left-to-right",behavior:Ue,thumbnail:Ue,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:Ue,rights:null,navDate:null,provider:Ue,items:Ue,annotations:Ue,seeAlso:Ue,homepage:Ue,partOf:Ue,rendering:Ue,service:Ue,services:Ue},l5={id:"https://iiif-parser/empty-manifest",type:"Manifest",annotations:Ue,behavior:Ue,homepage:Ue,items:Ue,label:null,metadata:Ue,navDate:null,provider:Ue,partOf:Ue,accompanyingCanvas:null,placeholderCanvas:null,rendering:Ue,requiredStatement:null,rights:null,seeAlso:Ue,service:Ue,services:Ue,start:null,structures:Ue,summary:null,thumbnail:Ue,viewingDirection:"left-to-right"},u5={id:"https://iiif-parser/empty-canvas",type:"Range",label:null,behavior:Ue,thumbnail:Ue,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:Ue,rights:null,navDate:null,provider:Ue,items:Ue,annotations:Ue,seeAlso:Ue,homepage:Ue,partOf:Ue,rendering:Ue,service:Ue,start:null,supplementary:null,viewingDirection:"left-to-right"},c5={id:"https://iiif-parser/empty-agent",type:"Agent",label:{},logo:Ue,seeAlso:Ue,homepage:Ue},d5={id:"https://iiif-parser/empty-service",type:"UnknownService"};function zd(t,e={}){if(Array.isArray(t))return zd(t[0]);if(typeof t=="string"){let[n,i]=t.split("#");return i?{type:"SpecificResource",source:{id:n,type:e.typeHint||"Unknown"},selector:{type:"FragmentSelector",value:i}}:{type:"SpecificResource",source:{id:n,type:e.typeMap&&e.typeMap[n]||e.typeHint||"Unknown"}}}if(t.type==="Choice"||t.type==="List"||t.type==="Composite"||t.type==="Independents")return zd(t.items[0]);if(!t.type&&"source"in t&&(t.type="SpecificResource"),t.type==="SpecificResource"){t.source.type==="Canvas"&&t.source.partOf&&typeof t.source.partOf=="string"&&(t.source.partOf=[{id:t.source.partOf,type:"Manifest"}]);let n=typeof t.source=="string"?t.source:t.source.id;if(n!=null&&n.includes("#")){let i=zd(n,e);i&&(t.selector=i.selector,t.source=i.source)}return t.selector?{...t,type:"SpecificResource",source:t.source,selector:t.selector}:{...t,type:"SpecificResource",source:t.source}}if(t.id){t.type==="Canvas"&&t.partOf&&typeof t.partOf=="string"&&(t.partOf=[{id:t.partOf,type:"Manifest"}]);let[n,i]=t.id.split("#");return i?{type:"SpecificResource",source:{...t,id:n},selector:{type:"FragmentSelector",value:i}}:{type:"SpecificResource",source:{...t,id:n}}}return{type:"SpecificResource",source:t}}function f5(){return{Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}}}function Ux(t,e){if(typeof t=="string")return{id:t,type:e};if(!t.id)throw Error(`Invalid resource does not have an ID (${JSON.stringify(t)}, ${e})`);return t}function h5(t,e){return(n,i)=>{let r=t[n]?t[n]:{};return(s,o)=>{let a=Ux(s,i||n);return a&&a.id&&n?(r[a.id]=r[a.id]?_m(r[a.id],a,{parent:o.parent,isTopLevel:e.id===a.id}):_m({id:a.id,type:a.type},a,{parent:o.parent,isTopLevel:e.id===a.id}),{id:a.id,type:n==="ContentResource"?n:a.type}):a}}}function wm(t,e,n){if(!e)return t;if(Array.isArray(t)){if(!Array.isArray(e))throw Error("Cannot merge array with non-array");let i=[...t];for(let r of e)if(r["@id"]&&!r.id&&(r.id=r["@id"]),r["@type"]&&!r.type&&(r.type=r["@type"]),r!=null)if(Array.isArray(r))i.push(r);else if(typeof r=="object"&&r.id&&r.type){let s=i.findIndex(o=>o.id===r.id&&o.type===r.type);s>=0&&(i[s]=wm(i[s],r))}else t.indexOf(r)===-1&&i.push(r);return i}else if(typeof t=="object"){if(Array.isArray(e)||typeof e!="object")throw Error("Cannot merge object with non-object");let i={...t},r=[],s=[],o=Object.keys(t).filter(u=>u!==cn&&u!=="id"&&u!=="type"),a={},l={};for(let[u,c]of Object.entries(e)){if(u===cn||u==="id"||u==="type")continue;let d=i[u];d===c?s.push(u):d===Ue||!d?(r.push(u),i[u]=c):(d&&c&&(a[u]=d,l[u]=c),i[u]=wm(d,c),i[u]===a[u]&&(s.push(u),delete a[u]))}if(n&&(n.parent&&n.parent.id||n.isTopLevel)){let u=[],c={};if(n.parent?c[Kr]=n.parent.id:n.isTopLevel&&(c[Kr]=t.id),i[cn]&&i[cn].length){let d=!(i[cn]||[]).find(h=>h["@explicit"]),f=r.length>0||s.length!==o.length;if(d&&f)for(let h of i[cn]){let p={...h},m=Object.keys(a);if(p){p["@explicit"]=!0;for(let y of o)y!==cn&&(p[y]=yu);for(let y of m)p[y]=a[y]}u.push(p)}else u.push(...i[cn]);if(f){let h=Object.keys(l);c["@explicit"]=!0;for(let p of r)c[p]=yu;for(let p of s)c[p]=yu;for(let p of h)c[p]=l[p]}}c.id=i.id,c.type=i.type,u.push(c),i[cn]=u}return i}else if(t)return t;return e}function _m(t,e,n){if(typeof t=="string")return t;if(e.id!==t.id||e.type!==t.type){if(e.type==="ImageService3")return e;if(t.type==="ImageService3")return t;throw Error(`Can only merge entities with identical identifiers and type! ${e.type}(${e.id}) => ${t.type}(${t.id})`)}return wm({...t},e,n)}function p5(t){return(e,n)=>i=>{let{id:r,type:s}=Ux(i,n||e);if(r===void 0)throw Error("Found invalid entity without an ID.");return e==="ContentResource"||e==="Service"?t[r]=e:t[r]=s,i}}function m5(t){let e=Object.assign({},t);if(e["@id"]&&(e.id=e["@id"]),e["@type"]&&(e.type=e["@type"]),e.service){let n=[];e.service=Array.isArray(e.service)?e.service:[e.service];for(let i of e.service)n.push({id:i["@id"]||i.id,type:i["@type"]||i.type});e.service=n}return Object.assign({},d5,e)}function g5(t){return e=>{t.Service=t.Service?t.Service:{};let n=e.id||e["@id"],i=m5(e);return i&&i.id&&(t.Service[i.id]?t.Service[n]=_m(t.Service[n],i):t.Service[n]=i),e}}function y5(t){let e=JSON.stringify(t),n=5381,i=e.length;for(;i;)n=n*33^e.charCodeAt(--i);let r=n>>>0,s=r.toString(16);return s.length%2?"0"+s:s}function Am(t){return e=>typeof e=="string"?{id:e,type:t}:e.id?e.type?e:{type:t,...e}:{id:`vault://${y5(e)}`,type:t,...e}}function _a(t){return e=>({...t,...e})}function bu(t){return Array.isArray(t)?t:[t]}function v5(t){return t.body&&(t.body=bu(t.body)),t.seeAlso&&(t.seeAlso=bu(t.seeAlso)),t.audience&&(t.audience=bu(t.audience)),t.accessibility&&(t.accessibility=bu(t.accessibility)),t.motivation&&(t.motivation=bu(t.motivation)),t}function Hx(t,{typeHint:e,partOfTypeHint:n}={}){if(typeof t=="string"&&(t={id:t,type:e||"unknown"}),qr(t))return typeof t.source=="string"&&(t.source={id:t.source,type:e||"unknown"}),t.source.type==="Canvas"&&t.source.partOf&&typeof t.source.partOf=="string"&&(t.source.partOf=[{id:t.source.partOf,type:n||"Manifest"}]),t;let i;if((t.id||"").indexOf("#")!==-1){let[r,s]=(t.id||"").split("#");t.id=r,s&&(i={type:"FragmentSelector",value:s})}return{type:"SpecificResource",source:t,selector:i}}function b5(t){let e=Object.assign({},t);return t&&t.items&&(e.items=t.items.map(n=>typeof n=="string"||n.type==="Canvas"?Hx(n):n)),e}function E5(t){let e=Object.assign({},t);return e.start?(e.start=Hx(e.start,{typeHint:"Canvas"}),e):t}function T5(t){let e=Object.assign({},t);return e.target?(e.target=zd(e.target,{typeHint:"Canvas"}),e):t}function S5(t){return t}function Cm(t){return t.items===void 0&&(t[vu]=!0),t}function x5(t){let e=_x(t),n=f5(),i={},r=h5(n,e),s=p5(i),o=new i5({collection:[Cm,_a(a5),s("Collection"),r("Collection")],manifest:[Cm,_a(l5),E5,s("Manifest"),r("Manifest")],canvas:[_a(o5),s("Canvas"),r("Canvas")],annotationPage:[Cm,Am("AnnotationPage"),_a(s5),s("AnnotationPage"),r("AnnotationPage")],annotation:[Am("Annotation"),v5,T5,s("Annotation"),r("Annotation")],contentResource:[Am("ContentResource"),s("ContentResource"),r("ContentResource")],range:[_a(u5),b5,s("Range","Canvas"),r("Range","Canvas")],agent:[_a(c5),s("Agent"),r("Agent")],specificResource:[S5],service:[g5(n)]}),a=o.traverseUnknown(e);return{entities:n,resource:a,mapping:i}}function w5(t){let e={};for(let[n,i]of t){if(n===Fx&&i!==Vi)return i;i!==Vi&&i!=null&&(e[n]=i)}return e}function _5(t,e,n){if(!e.type||!e.id)throw Error("Unknown entity");if(!n[e.type])throw Error(`Serializer not found for ${e.type}`);function i(r,s,o=0){let a=n[r.type];if(!a)return Vi;if(o>20)throw Error("Circular reference: "+r.id+" "+r.type);let[l,u]=Bx(t,r.type?r:r.id,s)||(r.id&&r.type?r:null);if(!l)return Vi;let c=a(l,t,{parent:s,isTopLevel:e.id===r.id,fullResource:u}),d=c.next();for(;!d.done;){let f=d.value,h=Vi;if(f)if(Array.isArray(f)){let p=[];for(let m of f)p.push(i(m,r,o+1));h=p}else h=i(f,r,o+1);d=c.next(h)}return d.value===Vi?Vi:w5(d.value)}return i(e)}function Eu(t,{allowSourceString:e=!0,allowString:n=!1,allowedStringType:i}={}){let r=s=>{if(e&&s&&s.source&&typeof s.source!="string"){let o=Object.keys(s.source);if(s.source.id&&s.source.type&&o.length===2)return{...s,source:s.source.id}}return s};if(t){if(t.source&&t.source.partOf)return r(t);let s=Object.keys(t);if(s.length===2&&t.type&&t.source||s.length===3&&t.type&&t.source&&s.indexOf("selector")!==-1&&!t.selector)return n&&(!i||i===t.source.type)?t.source.id:t.source.type==="ContentResource"?{type:"SpecificResource",source:t.source.id}:t.source;if(t.selector&&!Array.isArray(t.selector)&&typeof t.selector!="string"&&t.selector.type==="FragmentSelector"){let o=`${t.source.id}#${t.selector.value}`;return n?o:{id:o,type:t.source.type}}}return r(t)}function Aa(t){if(!t)return;let e=Object.keys(t);if(e.length!==0){if(e.length===1){let n=e[0];if(!n)return"";let i=(t[n]||[]).join("");return n==="@none"||n==="none"||n==="en"?i:{"@language":n,"@value":i}}return e.map(n=>({"@language":n,"@value":(t[n]||[]).join("")}))}}function $x(t){return Array.isArray(t)?t.map(e=>$x(e)):typeof t=="string"?t:t.type&&t.type==="Canvas"?t.id:t}function As(t,e=!1){if(t)return t.length>1&&!e?t:t[0]||void 0}function A5(t){if(t){if(typeof t=="string")return{"@id":t};if("@id"in t){let e={...t};return delete e["@type"],e}return{"@context":"http://iiif.io/api/image/2/context.json","@id":t.id,profile:`http://iiif.io/api/image/2/profiles/${t.profile}.json`}}}function wo(t,e){return[["@id",t.id],["@type",e],["format",t.format],["height",t.height],["width",t.width],["viewingDirection",t.viewingDirection==="left-to-right"?void 0:t.viewingDirection],["license",t.license?t.license:void 0]]}function*_o(t){let e=t.provider?yield t.provider[0]:void 0;return[["label",Aa(t.label)],["metadata",t.metadata&&t.metadata.length?t.metadata.map(n=>({label:Aa(n.label)||"",value:Aa(n.value)||""})):void 0],["description",Aa(t.summary)],["thumbnail",As(yield t.thumbnail)],["navDate",t.navDate],["logo",e?As(e.logo):void 0],["homepage",e?e.homepage:void 0],["attribution",t.requiredStatement?Aa(t.requiredStatement.value):void 0]]}function*Tu(t){let e=t.start&&t.start.type&&t.start.type==="SpecificResource"?Eu(t.start):t.start;return[["seeAlso",As(yield t.seeAlso)],["service",As((t.service||[]).map(A5))],["rendering",As(yield t.rendering)],["startCanvas",e?e.id:void 0]]}function C5(t){return t.type==="SpecificResource"}function I5(t){return t&&t.type==="FragmentSelector"}function R5(t){if(t&&C5(t)){let e=t.id,n=t.selector?Array.isArray(t.selector)?t.selector[0]:t.selector:void 0;return I5(n)&&(e+="#"+n.value),e}return t==null?void 0:t.id}const L5={Manifest:function*(t,e,{isTopLevel:n}){return[...n?[["@context","http://iiif.io/api/presentation/2/context.json"]]:[],...wo(t,"sc:Manifest"),...yield*_o(t),...yield*Tu(t),["sequences",[{"@id":`${t.id}/sequence0`,"@type":"sc:Sequence",canvases:yield t.items}]],["structures",yield t.structures]]},Canvas:function*(t){let e=yield t.items,n=e[0];return[...wo(t,"sc:Canvas"),...yield*_o(t),...yield*Tu(t),["images",n?[n.resources]:void 0],["annotations",t.annotations&&t.annotations.length?As(yield t.annotations):void 0]]},AnnotationPage:function*(t){return[...wo(t,"sc:AnnotationList"),...yield*_o(t),["resources",t.items&&t.items.length?As(yield t.items):void 0]]},Annotation:function*(t){return[["@id",t.id],["@type","oa:Annotation"],["motivation","sc:painting"],["on",$x(t.target)],["resource",As(yield t.body,!0)]]},ContentResource:function*(t){switch(t.type){case"Image":return[...wo(t,"dctypes:Image"),...yield*_o(t),...yield*Tu(t)];case"Text":case"Dataset":default:return[...wo(t,void 0),...yield*_o(t)]}},AnnotationCollection:function*(t){return[["@id",t.id],["@type","sc:Layer"],["label",Aa(t.label)]]},Collection:function*(t){return[...wo(t,"sc:Collection"),...yield*_o(t),...yield*Tu(t),["members",yield*t.items]]},Range:function*(t){let e=[],n=[];if(t.items)for(let i of t.items){let r=i.type==="SpecificResource"?i.source:i;if(r){let s=yield r;e.push({"@id":R5(i),"@type":r.type,label:s?s.label:void 0,within:t.id}),r.type==="Canvas"&&n.push(r.id)}}return[...wo(t,"sc:Range"),...yield*_o(t),...yield*Tu(t),["canvases",n.length===e.length?n:void 0],["members",n.length===e.length?void 0:e]]}};function Ao(t){var e;return[["id",(e=t.id)!=null&&e.startsWith("vault://")?void 0:t.id],["type",t.type],["format",t.format],["profile",t.profile],["height",t.height||void 0],["width",t.width||void 0],["duration",t.duration||void 0],["viewingDirection",t.viewingDirection==="left-to-right"?void 0:t.viewingDirection],["behavior",t.behavior&&t.behavior.length?t.behavior:void 0],["timeMode",t.timeMode],["motivation",Array.isArray(t.motivation)?t.motivation[0]:t.motivation],[cn,Vi]]}function tn(t){if(t===Vi||!t||t.length===0)return;let e=t.filter(n=>n!==Vi);if(e.length!==0)return e}function zx(t){if(t&&t.type&&t.type==="ImageService2"){let{id:e,type:n,profile:i,...r}=t,s=typeof i=="string"?i:Array.isArray(i)?i.find(o=>typeof o=="string"):"";return{"@id":e,"@type":n,profile:s?s.startsWith("http")?s:`http://iiif.io/api/image/2/${s}.json`:"http://iiif.io/api/image/2/level0.json",...r}}return t}function Vx(t){if(Array.isArray(t)||(t=t?[t]:[]),!(!t||t.length===0))return t.map(zx)}function*Cs(t){return[["label",t.label],["metadata",tn(t.metadata)],["summary",t.summary],["requiredStatement",t.requiredStatement],["rights",Array.isArray(t.rights)?t.rights[0]||void 0:t.rights||void 0],["navDate",t.navDate],["language",t.language],["thumbnail",tn(yield t.thumbnail)],["placeholderCanvas",yield t.placeholderCanvas],["accompanyingCanvas",yield t.accompanyingCanvas],["provider",tn(yield t.provider)]]}function*Is(t,e){let n=[];for(let i of t.partOf||[])i.type==="Manifest"&&e.type==="Manifest"||n.push(yield i);return[["seeAlso",tn(yield t.seeAlso)],["service",tn(Vx(t.service))],["services",tn(Vx(t.services))],["rendering",tn(yield t.rendering)],["supplementary",tn(yield t.supplementary)],["homepage",tn(yield t.homepage)],["logo",tn(yield t.logo)],["partOf",tn(n)],["start",t.start?Eu(t.start):t.start]]}const P5={Manifest:function*(t,e,{isTopLevel:n}){if(!n)return[...Ao(t),...yield*Cs(t),["navPlace",t.navPlace]];let i="http://iiif.io/api/presentation/3/context.json";return(t.navPlace||Gx(t))&&(i=["http://iiif.io/api/presentation/3/context.json","http://iiif.io/api/extension/navplace/context.json"]),[["@context",t["@context"]?t["@context"]:i],...Ao(t),...yield*Cs(t),...yield*Is(t),["items",yield t.items],["structures",tn(yield t.structures)],["annotations",tn(yield t.annotations)],["navPlace",t.navPlace]]},Canvas:function*(t,e,{parent:n}){return n&&n.type!=="Manifest"&&n.type!=="Canvas"?[["id",t.id]]:[...Ao(t),...yield*Cs(t),...yield*Is(t,n),["items",yield t.items],["annotations",tn(yield t.annotations)],["navPlace",t.navPlace]]},Agent:function*(t){return[["id",t.id],["type","Agent"],["label",t.label],...yield*Is(t)]},AnnotationPage:function*(t){var i;let e=Object.entries(t).map(([r,s])=>[r,Array.isArray(s)?tn(s):s]).filter(([r,s])=>r!=="items"&&r!=="id"&&r!==cn&&r!==Kr&&r!==vu),n=yield t.items;return[["id",(i=t.id)!=null&&i.startsWith("vault://")?void 0:t.id],...e,...yield*Is(t),["items",n.length||t[vu]===!1?n:Vi]]},Service:function*(t){return[[Fx,zx(t)]]},Annotation:function*(t){let e=Object.entries(t).map(([i,r])=>i==="motivation"?[i,Array.isArray(r)?r[0]:r]:i==="target"?[i,Eu(r,{allowString:!0,allowSourceString:!0,allowedStringType:"Canvas"})]:[i,Array.isArray(r)?tn(r):r]).filter(([i])=>i!=="body"&&i!==cn&&i!==vu),n;if(Array.isArray(t.body)){let i=[];for(let r of t.body)if(r&&qr(r)){let s={...r};r.source.type==="Canvas"?s.source=r.source:s.source=yield r.source,i.push(Eu(s,{allowSourceString:!0}))}else i.push(yield r);n=i}else t.body&&qr(t.body)?(n={...t.body},n.source=yield t.body.source):n=yield t.body;return[...e,...yield*Cs(t),...yield*Is(t),["body",n.length===1?n[0]:n]]},ContentResource:function*(t){return k5([...Ao(t),...yield*Cs(t),...yield*Is(t),["annotations",tn(yield t.annotations)],["items",tn(yield t.items)]],t)},AnnotationCollection:function*(t){return[["id",t.id],["type","AnnotationCollection"],["label",t.label]]},Collection:function*(t,e,{isTopLevel:n}){if(n){let i="http://iiif.io/api/presentation/3/context.json";return(t.navPlace||Gx(t))&&(i=["http://iiif.io/api/extension/navplace/context.json","http://iiif.io/api/presentation/3/context.json"]),[["@context",i],...Ao(t),...yield*Cs(t),...yield*Is(t),["items",tn(yield t.items)],["navPlace",t.navPlace]]}return[...Ao(t),...yield*Cs(t),["navPlace",t.navPlace]]},Range:function*(t){let e=[];for(let n of t.items)n.type==="Range"?e.push(yield n):n&&n.type==="SpecificResource"?e.push(Eu(n)):e.push(n);return[...Ao(t),...yield*Cs(t),...yield*Is(t),["items",e],["annotations",tn(yield t.annotations)],["navPlace",t.navPlace]]}};function k5(t,e){let n=Object.keys(e),i=t.map(([r])=>r);for(let r of n)r===cn||r===vu||i.indexOf(r)===-1&&e[r]!==void 0&&t.push([r,e[r]]);return t}function Gx(t){if(!t.items||!Array.isArray(t.items))return!1;for(let e of t.items)if(e.navPlace)return!0;return!1}function D5(t){let e=encodeURIComponent(t);return(typeof btoa>"u"?Buffer.from(e,"utf-8").toString("base64"):btoa(e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function O5(t){let e=N5(t),n=e.replace(/-/g,"+").replace(/_/g,"/"),i=typeof atob>"u"?Buffer.from(n,"base64").toString("utf-8"):atob(n);return decodeURIComponent(i).trim()}function N5(t){let e=t.length%4;if(e===1)throw Error("InvalidLengthError: Input base64url string is the wrong length to determine padding");return t+(e?"====".slice(0,4-e):"")}function M5(t,e){return qr(t)?typeof t.source=="string"?{...t,source:e}:{...t,source:{...t.source||{},id:e}}:{...t,id:e}}function jx(t,e){var i;let n=[];for(let r of e.items)if(r.type==="SpecificResource"&&((i=r.source)==null?void 0:i.type)==="Canvas"&&(r.source.id.indexOf("#")===-1?n.push(r.source):n.push({id:r.source.id.split("#")[0],type:"Canvas"})),r.type==="Range"&&n.push(...jx(t,t.get(r))),r.type==="SpecificResource"){let s=typeof r.source=="string"?r.source:r.source.id;n.push({id:s,type:"Canvas"})}return n}function F5(t=mu,e,n,i=!1){let r=e.behavior||[],s=n?t.get(n):null;if(!s)return[];let o=s.behavior||[],a=i?!1:r.includes("paged"),l=a?!1:r.includes("continuous"),u=a||l?!1:r.includes("individuals"),c=o.includes("facing-pages"),d=o.includes("non-paged");if(c||d||u||i)return[{id:s.id,type:"Canvas"}];let[f,h]=Wx(t,e);if(l)return f;let p=f.findIndex(m=>m.id===n);if(p===-1)return[];for(let m of h)if(m.includes(p))return m.map(y=>f[y]);return[{id:s.id,type:"Canvas"}]}function Wx(t=mu,e,{disablePaging:n,skipNonPaged:i}={}){let r=e.behavior||[],s=r.includes("paged"),o=s?!1:r.includes("continuous"),a=s||o?!1:r.includes("individuals"),l=e.type==="Manifest"?e.items:jx(t,e);if(o)return[l,[l.map((p,m)=>m)]];if(a||!s||n)return[l,l.map((p,m)=>[m])];let u=[],c=[],d=()=>{c.length&&(u.push([...c]),c=[])},f=0,h=!1;for(let p=0;p<l.length;p++){let m=t.get(l[p]),y=m.behavior||[];if(y.includes("non-paged")){p===f&&f++,i||(d(),u.push([p]),d());continue}if(p===f||y.includes("facing-pages")){c.length&&(h=!0),d(),u.push([p]),d();continue}if(c.push(p),h){d(),h=!1;continue}c.length>1&&d()}return c.length&&d(),[l,u]}const Vt=function(t){return function(){let e={type:t,getType:()=>t,toString:()=>t};return(n,i)=>({...e,...n!==void 0&&{payload:n},...i!==void 0&&{meta:i}})}},qx="@iiif/IMPORT_ENTITIES",Kx="@iiif/MODIFY_ENTITY_FIELD",Yx="@iiif/REORDER_ENTITY_FIELD",Xx="@iiif/MOVE_ENTITY",Im="@iiif/MOVE_ENTITIES",Qx="@iiif/ADD_REFERENCE",Rm="@iiif/UPDATE_REFERENCE",Zx="@iiif/CHANGE_REFERENCE_IDENTIFIER",Jx="@iiif/REMOVE_REFERENCE",ew="@iiif/ADD_METADATA",tw="@iiif/REMOVE_METADATA",Lm="@iiif/UPDATE_METADATA",nw="@iiif/REORDER_METADATA",iw=Vt(qx)(),B5=Vt(Kx)(),U5=Vt(Yx)(),H5=Vt(Xx)(),$5=Vt(Im)(),z5=Vt(Qx)(),V5=Vt(Jx)(),G5=Vt(Rm)(),j5=Vt(Zx)(),W5=Vt(ew)(),q5=Vt(Lm)(),K5=Vt(tw)(),Y5=Vt(nw)(),X5={importEntities:iw,modifyEntityField:B5,reorderEntityField:U5,addReference:z5,removeReference:V5,updateReference:G5,changeReferenceIdentifier:j5,addMetadata:W5,removeMetadata:K5,updateMetadata:q5,reorderMetadata:Y5,moveEntity:H5,moveEntities:$5},rw="@iiif/ADD_MAPPING",sw="@iiif/ADD_MAPPINGS",Q5=Vt(rw)(),Z5=Vt(sw)(),Pm="RESOURCE_ERROR",ow="RESOURCE_LOADING",km="RESOURCE_READY",aw="@iiif/REQUEST_RESOURCE",lw="@iiif/REQUEST_ERROR",uw="@iiif/REQUEST_MISMATCH",cw="@iiif/REQUEST_COMPLETE",J5="@iiif/REQUEST_OFFLINE_RESOURCE",eB=Vt(aw)(),Dm=Vt(lw)(),tB=Vt(uw)(),nB=Vt(cw)(),Om="@iiif/BATCH",iB="@iiif/BATCH_IMPORT",Nm=Vt(Om)(),dw="@iiif/SET_META_VALUE",fw="@iiif/SET_META_VALUE_DYNAMIC",hw="@iiif/UNSET_META_VALUE",rB=Vt(dw)(),sB=Vt(fw)(),oB=Vt(hw)(),pw={setMetaValue:rB,setMetaValueDynamic:sB,unsetMetaValue:oB},aB=(t,e)=>{let{entities:n,resource:i,mapping:r}=x5(e);if(i.id===void 0)return[Dm({id:t,message:"ID is not defined in resource."})];let s=[iw({entities:n}),Z5({mapping:r})];return i.id!==t&&(s.push(Q5({id:t,type:i.type})),s.push(tB({requestId:t,actualId:i.id}))),s.push(nB({id:t})),s},mw=Number.isNaN||function(t){return typeof t=="number"&&t!==t};function lB(t,e){return!!(t===e||mw(t)&&mw(e))}function gw(t,e){if(!Array.isArray(t)||!Array.isArray(e))return t===e;if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!lB(t[n],e[n]))return!1;return!0}function Mm(t,e,n){let i=t.iiif.requests[e],r=t.iiif.mapping[e];if(!r||!t.iiif.entities[r][i.resourceUri])return;let s=t.iiif.entities[r][i.resourceUri];if(s&&s[cn]){let o=s[cn].find(a=>a[Kr]===s.id);return xm(s,o)}return s}function uB(t){return t&&typeof t.then=="function"}function yw(t,e,{waitTimeout:n=30}={}){return(i,r,s)=>{let o=t.getStore(),a=o.getState(),l=a.iiif.requests[i];if(l){if(l.loadingState===km){let c=Mm(a,i);if(c)return c}switch(l.loadingState){case Pm:break;case ow:return(async()=>{let c,d=!1;try{let f=await Promise.race([new Promise((h,p)=>{d||(c=o.subscribe(()=>{let m=o.getState();if(m.iiif.requests[i].loadingState===Pm){p();return}if(m.iiif.requests[i].loadingState===km){let y=Mm(m,i);y?h(y):p()}}))}),new Promise((h,p)=>setTimeout(()=>{d=!0,p()},n*60*1e3))]);if(c&&c(),f)return f}catch{c&&c()}})()}}t.dispatch(eB({id:i}));let u=c=>{if(!c)return;!c.id&&!c["@id"]&&(c["@type"]&&(c["@id"]=i),c.id=i);let d=aB(i,c);return t.dispatch(Nm({actions:d})),Mm(o.getState(),i)};try{let c=e(i,r);return uB(c)?(async()=>{try{let d=await c;return s&&(d=s(d)),u(d)}catch(d){throw t.dispatch(Dm({id:i,message:d.toString()})),d}})():u(s?s(c):c)}catch(c){throw t.dispatch(Dm({id:i,message:c.toString()})),c}}}function vw(){return{Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}}}const Fm={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},cB=(t,e)=>(n,i,r)=>(r.dispatch=s=>(n(o=>t(o,s),!1,s),s),r.dispatchFromDevtools=!0,{dispatch:(...s)=>r.dispatch(...s),...e}),dB=cB,Bm=new Map,Vd=t=>{let e=Bm.get(t);return e?Object.fromEntries(Object.entries(e.stores).map(([n,i])=>[n,i.getState()])):{}},fB=(t,e,n)=>{if(t===void 0)return{type:"untracked",connection:e.connect(n)};let i=Bm.get(n.name);if(i)return{type:"tracked",store:t,...i};let r={connection:e.connect(n),stores:{}};return Bm.set(n.name,r),{type:"tracked",store:t,...r}},hB=(t,e={})=>(n,i,r)=>{let{enabled:s,anonymousActionType:o,store:a,...l}=e,u;try{u=(s??(Fm?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!u)return(Fm?"production":void 0)!=="production"&&s&&console.warn("[zustand devtools middleware] Please install/enable Redux devtools extension"),t(n,i,r);let{connection:c,...d}=fB(a,u,l),f=!0;r.setState=(m,y,g)=>{let v=n(m,y);if(!f)return v;let b=g===void 0?{type:o||"anonymous"}:typeof g=="string"?{type:g}:g;return a===void 0?(c==null||c.send(b,i()),v):(c==null||c.send({...b,type:`${a}/${b.type}`},{...Vd(l.name),[a]:r.getState()}),v)};let h=(...m)=>{let y=f;f=!1,n(...m),f=y},p=t(r.setState,i,r);if(d.type==="untracked"?c==null||c.init(p):(d.stores[d.store]=r,c==null||c.init(Object.fromEntries(Object.entries(d.stores).map(([m,y])=>[m,m===d.store?p:y.getState()])))),r.dispatchFromDevtools&&typeof r.dispatch=="function"){let m=!1,y=r.dispatch;r.dispatch=(...g)=>{(Fm?"production":void 0)!=="production"&&g[0].type==="__setState"&&!m&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),m=!0),y(...g)}}return c.subscribe(m=>{var y;switch(m.type){case"ACTION":if(typeof m.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return Um(m.payload,g=>{if(g.type==="__setState"){if(a===void 0){h(g.state);return}Object.keys(g.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format. 
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);let v=g.state[a];if(v==null)return;JSON.stringify(r.getState())!==JSON.stringify(v)&&h(v);return}r.dispatchFromDevtools&&typeof r.dispatch=="function"&&r.dispatch(g)});case"DISPATCH":switch(m.payload.type){case"RESET":return h(p),a===void 0?c==null?void 0:c.init(r.getState()):c==null?void 0:c.init(Vd(l.name));case"COMMIT":if(a===void 0){c==null||c.init(r.getState());return}return c==null?void 0:c.init(Vd(l.name));case"ROLLBACK":return Um(m.state,g=>{if(a===void 0){h(g),c==null||c.init(r.getState());return}h(g[a]),c==null||c.init(Vd(l.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return Um(m.state,g=>{if(a===void 0){h(g);return}JSON.stringify(r.getState())!==JSON.stringify(g[a])&&h(g[a])});case"IMPORT_STATE":{let{nextLiftedState:g}=m.payload,v=(y=g.computedStates.slice(-1)[0])==null?void 0:y.state;if(!v)return;h(a===void 0?v:v[a]),c==null||c.send(null,g);return}case"PAUSE_RECORDING":return f=!f}return}}),p},pB=hB,Um=(t,e)=>{let n;try{n=JSON.parse(t)}catch(i){console.error("[zustand devtools middleware] Could not parse the received json",i)}n!==void 0&&e(n)},mB=t=>(e,n,i)=>{let r=i.subscribe;return i.subscribe=(o,a,l)=>{let u=o;if(a){let c=(l==null?void 0:l.equalityFn)||Object.is,d=o(i.getState());u=f=>{let h=o(f);if(!c(d,h)){let p=d;a(d=h,p)}},l!=null&&l.fireImmediately&&a(d,d)}return r(u)},t(e,n,i)},gB=mB,yB=(t={},e)=>{switch(e.type){case rw:return{...t,[e.payload.id]:e.payload.type};case sw:return{...t,...e.payload.mapping};default:return t}};function Su(t,e,n,i){return!(!t[n]||!t[n][e]||!t[n][e][i]||!Array.isArray(t[n][e][i]))}function vB(t,e){let n={},i=[];for(let[r,s]of Object.entries(t||{})){i.push(r);let o=(e||{})[r];if(!o||o.length===0){n[r]=s;continue}n[r]=o}for(let[r,s]of Object.entries(e||{}))i.indexOf(r)===-1&&(n[r]=s);return n}function ze(t){return t.payload||{}}function bB(t,e,n){if(!t[e]||!Array.isArray(t[e]))return null;let i=n.index===void 0?t[e].findIndex(r=>{var s;return r?((s=$d(r))==null?void 0:s.id)===n.id:!1}):n.index;return i===-1?null:{entity:t[e][i],index:i}}function bw(t,e){var n;if(!(!(e!=null&&e.id)||!(e!=null&&e.type)))return(n=t[e.type])==null?void 0:n[e.id]}function Gd(t,e){return t===void 0?e:t}const Ew=(t=vw(),e)=>{var i,r;let n=(s,o)=>({...t,[ze(e).type]:{...t[ze(e).type],[ze(e).id]:{...s,...o}}});switch(e.type){case Kx:{if(!t[ze(e).type]||!t[ze(e).type][ze(e).id])return t;let s=t[ze(e).type][ze(e).id];return typeof s=="string"?t:n(s,{[ze(e).key]:ze(e).value})}case Yx:{if(!Su(t,ze(e).id,ze(e).type,ze(e).key))return t;let s=t[ze(e).type][ze(e).id];if(typeof s=="string")return t;let o=Array.from(s[ze(e).key]),[a]=o.splice(ze(e).startIndex,1);return o.splice(ze(e).endIndex,0,a),n(s,{[ze(e).key]:o})}case Im:{let s=ze(e).subjects,o=ze(e).from,a=ze(e).to||o,l=bw(t,o),u=(a==null?void 0:a.key)||o.key;if(!Su(t,o.id,o.type,o.key)||!Su(t,a.id,a.type,a.key))return t;let c=[],d=[];if(s.type==="slice"){let b=s.startIndex,T=s.length;c=Array.from(l[o.key]),d=c.splice(b,T)}else{let b=Array.from(l[o.key]);for(let T of s.items){let S=bB(l,o.key,T);S&&(d.push(S.entity),b[S.index]=null),c=b.filter(_=>_!==null)}}let f={...l,[o.key]:c},h={...t,[o.type]:{...t[o.type],[o.id]:f}},p=bw(h,a);if(!p)return t;let m=(a==null?void 0:a.index)===void 0?p[u].length:a.index,y=Array.from(p[a.key]);y.splice(m,0,...d);let g={...p,[u]:y};return{...h,[a.type]:{...h[a.type],[a.id]:g}}}case Xx:return Ew(t,{type:Im,payload:{subjects:{type:"list",items:[ze(e).subject]},from:ze(e).from,to:ze(e).to}});case Zx:{let{id:s,index:o,key:a,newIdentifier:l,reference:u,type:c}=ze(e),d=t[c][s],f=$d(u);if(!d||!d[a]||!f||o<0)return t;let h=d[a],p=h[o],m=(i=t[f.type])==null?void 0:i[f.id];if(!m||!p)return t;let y=M5(p,l),g=Array.from(h);g.splice(Gd(o,g.length+1),1,y);let v=n(d,{[a]:g}),b={...m,id:l};b["iiif-parser:hasPart"]&&(b["iiif-parser:hasPart"]=b["iiif-parser:hasPart"].filter(S=>S["iiif-parser:partOf"]===s).map(S=>({...S,id:l})));let T={...v[f.type],[l]:b};return v[f.type]=T,v}case qx:{let s=Object.keys(ze(e).entities),o={...t};for(let a of s){let l=ze(e).entities[a],u={...t[a]||{}},c=!1,d=Object.keys(l||{})||[];if(l&&d){for(let f of d)c=!0,u[f]=t[a][f]?vB(t[a][f],l[f]):l[f];c&&(o[a]=u)}}return o}case Qx:{if(!Su(t,ze(e).id,ze(e).type,ze(e).key))return t;let s=t[ze(e).type][ze(e).id],o=Array.from(s[ze(e).key]);return o.splice(Gd(ze(e).index,o.length+1),0,ze(e).reference),n(s,{[ze(e).key]:o})}case Rm:case Jx:{if(!Su(t,ze(e).id,ze(e).type,ze(e).key))return t;let s=t[ze(e).type][ze(e).id],o=Array.from(s[ze(e).key]),a=Gd(ze(e).index,o.findIndex(l=>l&&l.id===ze(e).reference.id));return a===-1||((r=o[a])==null?void 0:r.id)!==ze(e).reference.id?t:(e.type===Rm?o.splice(a,1,ze(e).reference):o.splice(a,1),n(s,{[ze(e).key]:o}))}case ew:{let s=t[ze(e).type][ze(e).id];if(!s)return t;let o=Array.from(s.metadata||[]),a=ze(e);return o.splice(Gd(e.payload.beforeIndex,o.length+1),0,{label:a.label,value:a.label}),n(s,{metadata:o})}case nw:{let s=t[ze(e).type][ze(e).id];if(typeof s=="string"||!s)return t;let o=Array.from(s.metadata||[]),[a]=o.splice(ze(e).startIndex,1);return o.splice(ze(e).endIndex,0,a),n(s,{metadata:o})}case Lm:case tw:{let s=t[ze(e).type][ze(e).id],o=Array.from(s.metadata||[]),a=ze(e).atIndex;return a===void 0||a===-1||!o[a]?t:(e.type===Lm?o.splice(a,1,{label:ze(e).label,value:ze(e).value}):o.splice(a,1),n(s,{metadata:o}))}default:return t}},EB=(t={},e)=>{switch(e.type){case aw:case J5:return{...t,[e.payload.id]:{requestUri:e.payload.id,loadingState:ow,uriMismatch:!1,resourceUri:e.payload.id}};case uw:return{...t,[e.payload.requestId]:{...t[e.payload.requestId]||{},uriMismatch:!0,resourceUri:e.payload.actualId},[e.payload.actualId]:{requestUri:e.payload.requestId,loadingState:t[e.payload.requestId].loadingState,uriMismatch:!0,resourceUri:e.payload.actualId}};case lw:return{...t,[e.payload.id]:{...t[e.payload.id]||{},loadingState:Pm,error:e.payload.message}};case cw:return{...t,[e.payload.id]:{...t[e.payload.id]||{},loadingState:km,error:void 0}}}return t},TB=(t={},e)=>{let{id:n,updateValue:i,value:r,meta:s,key:o}=e&&e.payload||{};switch(e.type){case dw:return{...t,[n]:{...t[n]||{},[s]:{...t[n]&&t[n][s]||{},[o]:r}}};case fw:return{...t,[n]:{...t[n]||{},[s]:{...t[n]&&t[n][s]||{},[o]:t[n]&&t[n][s]?i(t[n][s][o]):i(void 0)}}};case hw:return t[n]&&t[n][s]&&t[n][s][o]?{...t,[n]:{...t[n]||{},[s]:{...t[n]&&t[n][s]||{},[o]:void 0}}}:t;default:return t}};function Tw(t={}){let e=Object.keys(t);return function(n={},i){let r=!1,s={};for(let o=0;o<e.length;o++){let a=e[o];s[a]=t[a](n[a],i),r||(r=s[a]!==n[a])}return r?s:n}}function SB(t){return(e,n)=>n&&n.type===Om?n.payload.actions.reduce(t,e):n&&n.type===iB?{...e,iiif:{...e.iiif,...n.payload.state}}:t(e,n)}const xB=Tw({mapping:yB,entities:Ew,requests:EB,meta:TB});function wB(){return{iiif:{entities:vw(),meta:{},mapping:{},requests:{}}}}function _B(t={}){let{enableDevtools:e=!1,iiifStoreName:n="iiif",defaultState:i=wB(),customReducers:r={}}=t,s=SB(Tw({[n]:xB,...r})),o=!!(typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION__);return Cx(gB((o?pB:(l,u)=>l)(dB(s,i),{enabled:e})))}function Mn(t,e,n,i=!0){e[Ca]=e[Ca]||[],e[Ca].push(t);let r=new Map;Object.defineProperty(e,t,{enumerable:i,get(){if(e[Co][t]===void 0)return;let s=e[Co][t];if(!s)return s;let o=n.get(e[Co][t],{parent:this.id?{id:this.id,type:this.type}:void 0});return r.has(o)||(r.clear(),r.set(o,Ro(o,n))),r.get(o)},set(s){e[Co][t]!==s&&(this[Io]?n.modifyEntityField({id:this.id,type:this.type},t,xw(s)):this[Co][t]=s)}})}const Co=Symbol.for("_refs_"),Io=Symbol.for("_reactive_"),Ca=Symbol.for("_defined_"),Sw=Symbol.for("_parent_");function AB(t,e=!1,n){let i={id:"",type:"unknown",[Ca]:[],[Co]:{},[Sw]:null,[Io]:null,is(r){return typeof r=="string"?this.id===r:r.id?r.id===this.id:!1},reactive(){if(!this[Io])return this[Io]=this.subscribe(()=>this.refresh(),!0),()=>{this.unreactive()}},refresh(){if(this.id){let r=this.unwrap();for(let s of Object.keys(r||{}))this[Ca].includes(s)?this[Co][s]=r[s]:this[s]=r[s]}},unreactive(){this[Io]&&(this[Io](),this[Io]=null)},unwrap(){if(!this.id)throw Error("Invalid object");let r=this[Sw];return t.get(this.id,{parent:r?{id:r,type:"unknown"}:void 0})},toPresentation3(){return t.toPresentation3(this.unwrap())},toPresentation2(){return t.toPresentation2(this.unwrap())},valueOf(){return this.unwrap()},toJSON(){let r=this;return{...r,items:r.items,annotations:r.annotations,structures:r.structures,seeAlso:r.seeAlso,service:r.service,services:r.services,rendering:r.rendering,partOf:r.partOf,start:r.start,supplementary:r.supplementary,homepage:r.homepage,thumbnail:r.thumbnail,placeholderCanvas:r.placeholderCanvas,accompanyingCanvas:r.accompanyingCanvas,provider:r.provider}},subscribe(r,s=!0){return t.subscribe(()=>this.id?t.get(this.id):null,r,s)}};return Mn("items",i,t),Mn("annotations",i,t),Mn("structures",i,t),Mn("seeAlso",i,t),Mn("rendering",i,t),Mn("partOf",i,t),Mn("start",i,t,!1),Mn("supplementary",i,t),Mn("homepage",i,t),Mn("thumbnail",i,t),Mn("placeholderCanvas",i,t,!1),Mn("accompanyingCanvas",i,t,!1),Mn("provider",i,t),Mn("body",i,t),Mn("logo",i,t),i}function CB(t){return!!t[Ca]}function xw(t){return Array.isArray(t)?t.map(e=>xw(e)):!t||!t.type?t:{id:t.id,type:t.type}}function Ro(t,e,n=!1,i){if(Array.isArray(t))return t.map(a=>Ro(a,e,n));if(!t||!t.type||!t.id)return t;let r=AB(e,n),s=Object.create(r),o=Object.assign(s,t);return n&&o.reactive(),o}function ww(t){switch(t){case"Image":case"Video":case"Sound":case"Dataset":case"Text":case"Composite":case"List":case"Independents":case"Audience":return"ContentResource";case"ImageService1":case"ImageService2":case"ImageService3":return"Service"}return t}var _w=class{constructor(e,n){Ri(this,"options",void 0),Ri(this,"store",void 0),Ri(this,"emitter",void 0),Ri(this,"isBatching",!1),Ri(this,"batchQueue",[]),Ri(this,"remoteFetcher",void 0),Ri(this,"staticFetcher",void 0),Ri(this,"defaultFetcher",i=>fetch(i).then(r=>{if(r.status===200)return r.json();{let s=Error(`${r.status} ${r.statusText}`);throw s.name="HTTPError",s}})),this.options=Object.assign({reducers:{},customFetcher:this.defaultFetcher,enableDevtools:!0},e||{}),this.store=n||_B({customReducers:this.options.reducers,defaultState:this.options.defaultState,enableDevtools:this.options.enableDevtools}),this.emitter=Ix(),this.remoteFetcher=yw(this,this.options.customFetcher),this.staticFetcher=yw(this,(i,r)=>r)}batch(e){this.isBatching=!0;try{e(this),this.isBatching=!1,this.dispatch(Nm({actions:this.batchQueue}))}catch(n){throw this.batchQueue=[],this.isBatching=!1,n}this.batchQueue=[]}async asyncBatch(e){this.isBatching=!0;try{await e(this),this.isBatching=!1,this.dispatch(Nm({actions:this.batchQueue}))}catch(n){throw this.batchQueue=[],this.isBatching=!1,n}this.batchQueue=[]}modifyEntityField(e,n,i){this.dispatch(X5.modifyEntityField({id:e.id,type:e.type,key:n,value:i}))}dispatch(e){if(this.isBatching)this.batchQueue.push(e);else{if(e.type===Om){for(let r of e.payload.actions)this.emitter.emit(r.type,{action:r,state:this.store.getState()});this.store.dispatch(e);let i=this.getState();for(let r of e.payload.actions)this.emitter.emit(`after:${r.type}`,{action:r,state:i});return}this.emitter.emit(e.type,{action:e,state:this.store.getState()}),this.store.dispatch(e);let n=this.store.getState();this.emitter.emit(`after:${e.type}`,{action:e,state:n});return}}on(e,n){return this.emitter.on(e,n),()=>{this.emitter.off(e,n)}}serialize(e,n){return _5(this.getState().iiif,e,n)}toPresentation2(e){return this.serialize(e,L5)}toPresentation3(e){return this.serialize(e,P5)}hydrate(e,n,i={}){return this.get(e,n,{...i,skipSelfReturn:!1})}get(e,n,i={}){typeof n!="string"&&(i=n||{},n=void 0);let{skipSelfReturn:r=!0}=i||{},s=i.parent?typeof i.parent=="string"?i.parent:i.parent.id:void 0;if(Array.isArray(e))return e.map(d=>this.get(d,i));let o=this.getState();if(qr(e)&&!i.preserveSpecificResources&&(e=e.source),typeof e=="string"){let d=ww(n||o.iiif.mapping[e]);if(!d)return r?null:{id:e,type:"unknown"};e={id:e,type:d}}if(e&&e.partOf&&!s&&!i.skipPartOfCheck){let d=Array.isArray(e.partOf)?e.partOf[0]:e.partOf;d&&(typeof d=="string"&&(s=d),typeof d.id=="string"&&(s=d.id))}let a=ww(n||(e==null?void 0:e.type)),l=e==null?void 0:e.id,u=o.iiif.entities[a];if(!u){let d=o.iiif.requests[l];return d&&d.resourceUri!==l?this.get(d.resourceUri,i):r?null:e}let c=u[e.id];if(c&&c[cn]){let d=c[cn].find(f=>s?f[Kr]===s:f[Kr]===c.id);return xm(c,d)}return u[e.id]||(r?null:e)}select(e){return e(this.getState())}getStore(){return this.store}getState(){return this.store.getState()}deep(e,n){if(e===void 0)return this.get(n,{skipSelfReturn:!1});if(typeof e=="function")try{let r=e(this.get(n,{skipSelfReturn:!1})),s=o=>this.deep(o,r);return s.size=Array.isArray(r)?r.length:1,s}catch{let r=s=>this.deep(s,void 0);return r.size=0,r}let i=r=>this.deep(r,e);return i.size=Array.isArray(e)?e.length:1,i}loadManifest(e,n,i){let r=typeof e=="string"?e:e.id;return this.load(r,n,i)}loadCollection(e,n,i){let r=typeof e=="string"?e:e.id;return this.load(r,n,i)}load(e,n,i){let r=typeof e=="string"?e:e.id;return n?Promise.resolve(this.staticFetcher(r,n,i)):Promise.resolve(this.remoteFetcher(r,{},i))}loadSync(e,n,i){let r=typeof e=="string"?e:e.id;return this.staticFetcher(r,n,i)}loadManifestSync(e,n,i){let r=typeof e=="string"?e:e.id;return this.loadSync(r,n,i)}loadCollectionSync(e,n,i){let r=typeof e=="string"?e:e.id;return this.loadSync(r,n,i)}areInputsEqual(e,n){return gw(e,n)}subscribe(e,n,i){return i===void 0&&(n===void 0||n===!1||n===!0)&&(i=n,n=e,e=r=>r),this.store.subscribe(e,r=>n(r,this),{equalityFn:gw,fireImmediately:!i})}async ensureLoaded(e){let n=typeof e=="string"?e:e.id;this.requestStatus(n)||await this.load(n)}requestStatus(e){return this.select(n=>n.iiif.requests[e])}getPaginationState(e){let n=typeof e=="string"?e:e.id;if(!n)return null;let i=this.getResourceMeta(n,"@vault/pagination");if(i!=null&&i.state)return i.state;let r=this.get(e);if(r.first){let s={currentPage:null,currentPageIndex:null,isFetching:!1,isFullyLoaded:!1,next:r.first,page:1,pages:[],previous:null,totalItems:r.total,currentLength:0};return this.setMetaValue([n,"@vault/pagination","state"],s),s}return null}async loadNextPage(e,n){var h;let i=typeof e=="string"?e:e.id;if(!i)return[null,null];let r=this.getPaginationState(e);if(!r||r.isFullyLoaded||!r.next)return[null,null];if(r.isFetching)return[r,null];let s=typeof r.next=="string"?r.next:r.next.id,o=r.currentPage,a={...r,isFetching:!0};this.setMetaValue([i,"@vault/pagination","state"],a);let l;try{l=await this.loadCollection(s,n,p=>{let{id:m,"@id":y,...g}=p||{};return y?{"@id":s,...g}:{id:s,...g}})}catch(p){let m={...r,isFetching:!1,error:p};return this.setMetaValue([i,"@vault/pagination","state"],m),[m,null]}if(!l){let p={...r,isFetching:!1,error:Error("Collection not found")};return this.setMetaValue([i,"@vault/pagination","state"],p),[p,null]}let u=this.get(i),c=[...u.items||[],...l.items||[]].map(p=>({id:p.id,type:p.type}));this.modifyEntityField({id:i,type:"Collection"},"items",c);let d=this.getPaginationState(e);if(!d)throw Error("Pagination state not found");let f={...d,isFetching:!1,error:null,currentPage:l.id,next:((h=l.next)==null?void 0:h.id)||null,currentPageIndex:d.pages.length,currentLength:c.length,pages:[...d.pages,{id:l.id,type:"Collection",startIndex:u.items.length,pageLength:l.items.length,order:typeof d.currentPageIndex=="number"?d.currentPageIndex+1:0}],isFullyLoaded:!l.next,previous:o,page:d.pages.length+1};return this.setMetaValue([i,"@vault/pagination","state"],f),[f,l]}getResourceMeta(e,n){let i=this.getState().iiif.meta[e];if(i)return n?i[n]:i}getObject(e,n,i={}){let{reactive:r,...s}=i;return Ro(this.get(e,n,s),this,r)}async loadObject(e,n){return Ro(await this.load(e,n),this)}async loadManifestObject(e,n){return Ro(await this.loadManifest(e,n),this)}async loadCollectionObject(e,n){return Ro(await this.loadCollection(e,n),this)}wrapObject(e){return Ro(this.get(e,{skipSelfReturn:!1}),this)}isWrapped(e){return CB(e)}setMetaValue([e,n,i],r){this.dispatch(typeof r=="function"?pw.setMetaValueDynamic({id:e,meta:n,key:i,updateValue:r}):pw.setMetaValue({id:e,meta:n,key:i,value:r}))}};const IB=t=>(Array.isArray(t["@context"])?t["@context"]:[t["@context"]]).map(n=>n==null?void 0:n.replace("http://","https://")),RB=t=>fetch(`${t.replace(/\/$/,"")}/info.json`).then(e=>e.json()).then(e=>e).catch(e=>{console.error(`The IIIF tilesource ${t.replace(/\/$/,"")}/info.json failed to load: ${e}`)}),LB=t=>{let e,n;if(Array.isArray(t)&&(e=t[0],e)){let i;"@id"in e?i=e["@id"]:i=e.id,n=i}return n},Aw=t=>{var i,r,s,o,a,l,u,c,d,f,h,p,m,y,g;let e,n={};switch(t==null?void 0:t.type){case"SpecificResource":e=(s=(r=(i=t==null?void 0:t.target)==null?void 0:i.partOf)==null?void 0:r[0])==null?void 0:s.id,n={manifest:e,canvas:(o=t==null?void 0:t.target)==null?void 0:o.id},t!=null&&t.selector&&(n.selector=t.selector);break;case"Range":case"Annotation":const v=((a=t==null?void 0:t.target)==null?void 0:a.source)||(t==null?void 0:t.target),b=(l=t==null?void 0:t.target)==null?void 0:l.selector;n={manifest:(c=(u=v==null?void 0:v.partOf)==null?void 0:u[0])==null?void 0:c.id,canvas:v==null?void 0:v.id},(((d=t==null?void 0:t.target)==null?void 0:d.type)==="SpecificResource"||(f=t==null?void 0:t.target)!=null&&f.selector)&&(n.selector=b);break;case"Canvas":if(e=(p=(h=t==null?void 0:t.partOf)==null?void 0:h[0])==null?void 0:p.id,n={manifest:e,canvas:t==null?void 0:t.id},(m=t==null?void 0:t.id)!=null&&m.includes("#xywh=")){const[T,S]=t.id.split("#xywh=");n.canvas=T,n.selector={type:"FragmentSelector",value:`xywh=${S}`}}break;case"Manifest":e=t==null?void 0:t.id,n={collection:(g=(y=t==null?void 0:t.partOf)==null?void 0:y[0])==null?void 0:g.id,manifest:t==null?void 0:t.id};break;case"Collection":e=t==null?void 0:t.id,n={collection:e};break}return{resourceId:e,active:n}},PB=t=>{const e=["https://iiif.io/api/presentation/2/context.json","https://iiif.io/api/presentation/3/context.json"],n=new TypeError(`The IIIF content may not be a valid IIIF resource: ${e.join(", ")}`);t["@context"]||console.warn(n);const i=IB(t);try{if(i.includes(e[0])){const r=_x(t);if(!r||!r.id||!r.type)throw n;return r}else{if(i.includes(e[1]))return t;throw n}}catch(r){console.warn(r)}},kB=t=>{if(typeof t=="string"&&MB(t))return{resourceId:t};if(typeof t=="object"){const e=PB(t);return{resourceId:e==null?void 0:e.id,resourceObject:e}}else{const e=JSON.parse(O5(t)),{active:n}=Aw(e);return{active:n,resourceId:e==null?void 0:e.resourceId,resourceObject:e}}},DB=t=>{const{resourceId:e,resourceObject:n}=kB(t);return n||e},OB=t=>t.items.map(n=>n.id)[0],NB=t=>{const e=t.items.filter(n=>n.type==="Manifest").map(n=>n.id);return e.length==0?null:e[0]},MB=t=>{try{new URL(t)}catch{return!1}return!0};var Li=(t=>(t.TiledImage="tiledImage",t.SimpleImage="simpleImage",t))(Li||{});const FB=t=>{const e=Array.isArray(t==null?void 0:t.service)&&(t==null?void 0:t.service.length)>0,n=e?LB(t==null?void 0:t.service):t==null?void 0:t.id,i=e?Li.TiledImage:Li.SimpleImage;return{uri:n,imageType:i}},BB=(t,e)=>{const n=e?Li.TiledImage:Li.SimpleImage;return{uri:t,imageType:n}},UB=zi(null),Hm={didCatch:!1,error:null};class $m extends Ci{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=Hm}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(){const{error:e}=this.state;if(e!==null){for(var n,i,r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];(n=(i=this.props).onReset)===null||n===void 0||n.call(i,{args:s,reason:"imperative-api"}),this.setState(Hm)}}componentDidCatch(e,n){var i,r;(i=(r=this.props).onError)===null||i===void 0||i.call(r,e,n)}componentDidUpdate(e,n){const{didCatch:i}=this.state,{resetKeys:r}=this.props;if(i&&n.error!==null&&HB(e.resetKeys,r)){var s,o;(s=(o=this.props).onReset)===null||s===void 0||s.call(o,{next:r,prev:e.resetKeys,reason:"keys"}),this.setState(Hm)}}render(){const{children:e,fallbackRender:n,FallbackComponent:i,fallback:r}=this.props,{didCatch:s,error:o}=this.state;let a=e;if(s){const l={error:o,resetErrorBoundary:this.resetErrorBoundary};if(typeof n=="function")a=n(l);else if(i)a=k(i,l);else if(r!==void 0)a=r;else throw o}return k(UB.Provider,{value:{didCatch:s,error:o,resetErrorBoundary:this.resetErrorBoundary}},a)}}function HB(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return t.length!==e.length||t.some((n,i)=>!Object.is(n,e[i]))}var Tt="colors",Fn="sizes",Oe="space",$B={gap:Oe,gridGap:Oe,columnGap:Oe,gridColumnGap:Oe,rowGap:Oe,gridRowGap:Oe,inset:Oe,insetBlock:Oe,insetBlockEnd:Oe,insetBlockStart:Oe,insetInline:Oe,insetInlineEnd:Oe,insetInlineStart:Oe,margin:Oe,marginTop:Oe,marginRight:Oe,marginBottom:Oe,marginLeft:Oe,marginBlock:Oe,marginBlockEnd:Oe,marginBlockStart:Oe,marginInline:Oe,marginInlineEnd:Oe,marginInlineStart:Oe,padding:Oe,paddingTop:Oe,paddingRight:Oe,paddingBottom:Oe,paddingLeft:Oe,paddingBlock:Oe,paddingBlockEnd:Oe,paddingBlockStart:Oe,paddingInline:Oe,paddingInlineEnd:Oe,paddingInlineStart:Oe,top:Oe,right:Oe,bottom:Oe,left:Oe,scrollMargin:Oe,scrollMarginTop:Oe,scrollMarginRight:Oe,scrollMarginBottom:Oe,scrollMarginLeft:Oe,scrollMarginX:Oe,scrollMarginY:Oe,scrollMarginBlock:Oe,scrollMarginBlockEnd:Oe,scrollMarginBlockStart:Oe,scrollMarginInline:Oe,scrollMarginInlineEnd:Oe,scrollMarginInlineStart:Oe,scrollPadding:Oe,scrollPaddingTop:Oe,scrollPaddingRight:Oe,scrollPaddingBottom:Oe,scrollPaddingLeft:Oe,scrollPaddingX:Oe,scrollPaddingY:Oe,scrollPaddingBlock:Oe,scrollPaddingBlockEnd:Oe,scrollPaddingBlockStart:Oe,scrollPaddingInline:Oe,scrollPaddingInlineEnd:Oe,scrollPaddingInlineStart:Oe,fontSize:"fontSizes",background:Tt,backgroundColor:Tt,backgroundImage:Tt,borderImage:Tt,border:Tt,borderBlock:Tt,borderBlockEnd:Tt,borderBlockStart:Tt,borderBottom:Tt,borderBottomColor:Tt,borderColor:Tt,borderInline:Tt,borderInlineEnd:Tt,borderInlineStart:Tt,borderLeft:Tt,borderLeftColor:Tt,borderRight:Tt,borderRightColor:Tt,borderTop:Tt,borderTopColor:Tt,caretColor:Tt,color:Tt,columnRuleColor:Tt,fill:Tt,outline:Tt,outlineColor:Tt,stroke:Tt,textDecorationColor:Tt,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:Fn,minBlockSize:Fn,maxBlockSize:Fn,inlineSize:Fn,minInlineSize:Fn,maxInlineSize:Fn,width:Fn,minWidth:Fn,maxWidth:Fn,height:Fn,minHeight:Fn,maxHeight:Fn,flexBasis:Fn,gridTemplateColumns:Fn,gridTemplateRows:Fn,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},zB=(t,e)=>typeof e=="function"?{"()":Function.prototype.toString.call(e)}:e,Ia=()=>{const t=Object.create(null);return(e,n,...i)=>{const r=(s=>JSON.stringify(s,zB))(e);return r in t?t[r]:t[r]=n(e,...i)}},Lo=Symbol.for("sxs.internal"),zm=(t,e)=>Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)),Cw=t=>{for(const e in t)return!0;return!1},{hasOwnProperty:VB}=Object.prototype,Vm=t=>t.includes("-")?t:t.replace(/[A-Z]/g,e=>"-"+e.toLowerCase()),GB=/\s+(?![^()]*\))/,Ra=t=>e=>t(...typeof e=="string"?String(e).split(GB):[e]),Iw={appearance:t=>({WebkitAppearance:t,appearance:t}),backfaceVisibility:t=>({WebkitBackfaceVisibility:t,backfaceVisibility:t}),backdropFilter:t=>({WebkitBackdropFilter:t,backdropFilter:t}),backgroundClip:t=>({WebkitBackgroundClip:t,backgroundClip:t}),boxDecorationBreak:t=>({WebkitBoxDecorationBreak:t,boxDecorationBreak:t}),clipPath:t=>({WebkitClipPath:t,clipPath:t}),content:t=>({content:t.includes('"')||t.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(t)?t:`"${t}"`}),hyphens:t=>({WebkitHyphens:t,hyphens:t}),maskImage:t=>({WebkitMaskImage:t,maskImage:t}),maskSize:t=>({WebkitMaskSize:t,maskSize:t}),tabSize:t=>({MozTabSize:t,tabSize:t}),textSizeAdjust:t=>({WebkitTextSizeAdjust:t,textSizeAdjust:t}),userSelect:t=>({WebkitUserSelect:t,userSelect:t}),marginBlock:Ra((t,e)=>({marginBlockStart:t,marginBlockEnd:e||t})),marginInline:Ra((t,e)=>({marginInlineStart:t,marginInlineEnd:e||t})),maxSize:Ra((t,e)=>({maxBlockSize:t,maxInlineSize:e||t})),minSize:Ra((t,e)=>({minBlockSize:t,minInlineSize:e||t})),paddingBlock:Ra((t,e)=>({paddingBlockStart:t,paddingBlockEnd:e||t})),paddingInline:Ra((t,e)=>({paddingInlineStart:t,paddingInlineEnd:e||t}))},Gm=/([\d.]+)([^]*)/,jB=(t,e)=>t.length?t.reduce((n,i)=>(n.push(...e.map(r=>r.includes("&")?r.replace(/&/g,/[ +>|~]/.test(i)&&/&.*&/.test(r)?`:is(${i})`:i):i+" "+r)),n),[]):e,WB=(t,e)=>t in qB&&typeof e=="string"?e.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,(n,i,r,s)=>i+(r==="stretch"?`-moz-available${s};${Vm(t)}:${i}-webkit-fill-available`:`-moz-fit-content${s};${Vm(t)}:${i}fit-content`)+s):String(e),qB={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},Yr=t=>t?t+"-":"",Rw=(t,e,n)=>t.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,(i,r,s,o,a)=>o=="$"==!!s?i:(r||o=="--"?"calc(":"")+"var(--"+(o==="$"?Yr(e)+(a.includes("$")?"":Yr(n))+a.replace(/\$/g,"-"):a)+")"+(r||o=="--"?"*"+(r||"")+(s||"1")+")":"")),KB=/\s*,\s*(?![^()]*\))/,YB=Object.prototype.toString,La=(t,e,n,i,r)=>{let s,o,a;const l=(u,c,d)=>{let f,h;const p=m=>{for(f in m){const v=f.charCodeAt(0)===64,b=v&&Array.isArray(m[f])?m[f]:[m[f]];for(h of b){const T=/[A-Z]/.test(g=f)?g:g.replace(/-[^]/g,_=>_[1].toUpperCase()),S=typeof h=="object"&&h&&h.toString===YB&&(!i.utils[T]||!c.length);if(T in i.utils&&!S){const _=i.utils[T];if(_!==o){o=_,p(_(h)),o=null;continue}}else if(T in Iw){const _=Iw[T];if(_!==a){a=_,p(_(h)),a=null;continue}}if(v&&(y=f.slice(1)in i.media?"@media "+i.media[f.slice(1)]:f,f=y.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,(_,A,P,O,x,L)=>{const M=Gm.test(A),V=.0625*(M?-1:1),[K,U]=M?[O,A]:[A,O];return"("+(P[0]==="="?"":P[0]===">"===M?"max-":"min-")+K+":"+(P[0]!=="="&&P.length===1?U.replace(Gm,(j,G,H)=>Number(G)+V*(P===">"?1:-1)+H):U)+(x?") and ("+(x[0]===">"?"min-":"max-")+K+":"+(x.length===1?L.replace(Gm,(j,G,H)=>Number(G)+V*(x===">"?-1:1)+H):L):"")+")"})),S){const _=v?d.concat(f):[...d],A=v?[...c]:jB(c,f.split(KB));s!==void 0&&r(Lw(...s)),s=void 0,l(h,A,_)}else s===void 0&&(s=[[],c,d]),f=v||f.charCodeAt(0)!==36?f:`--${Yr(i.prefix)}${f.slice(1).replace(/\$/g,"-")}`,h=S?h:typeof h=="number"?h&&T in XB?String(h)+"px":String(h):Rw(WB(T,h??""),i.prefix,i.themeMap[T]),s[0].push(`${v?`${f} `:`${Vm(f)}:`}${h}`)}}var y,g};p(u),s!==void 0&&r(Lw(...s)),s=void 0};l(t,e,n)},Lw=(t,e,n)=>`${n.map(i=>`${i}{`).join("")}${e.length?`${e.join(",")}{`:""}${t.join(";")}${e.length?"}":""}${Array(n.length?n.length+1:0).join("}")}`,XB={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},Pw=t=>String.fromCharCode(t+(t>25?39:97)),Po=t=>(e=>{let n,i="";for(n=Math.abs(e);n>52;n=n/52|0)i=Pw(n%52)+i;return Pw(n%52)+i})(((e,n)=>{let i=n.length;for(;i;)e=33*e^n.charCodeAt(--i);return e})(5381,JSON.stringify(t))>>>0),xu=["themed","global","styled","onevar","resonevar","allvar","inline"],QB=t=>{if(t.href&&!t.href.startsWith(location.origin))return!1;try{return!!t.cssRules}catch{return!1}},ZB=t=>{let e;const n=()=>{const{cssRules:r}=e.sheet;return[].map.call(r,(s,o)=>{const{cssText:a}=s;let l="";if(a.startsWith("--sxs"))return"";if(r[o-1]&&(l=r[o-1].cssText).startsWith("--sxs")){if(!s.cssRules.length)return"";for(const u in e.rules)if(e.rules[u].group===s)return`--sxs{--sxs:${[...e.rules[u].cache].join(" ")}}${a}`;return s.cssRules.length?`${l}${a}`:""}return a}).join("")},i=()=>{if(e){const{rules:a,sheet:l}=e;if(!l.deleteRule){for(;Object(Object(l.cssRules)[0]).type===3;)l.cssRules.splice(0,1);l.cssRules=[]}for(const u in a)delete a[u]}const r=Object(t).styleSheets||[];for(const a of r)if(QB(a)){for(let l=0,u=a.cssRules;u[l];++l){const c=Object(u[l]);if(c.type!==1)continue;const d=Object(u[l+1]);if(d.type!==4)continue;++l;const{cssText:f}=c;if(!f.startsWith("--sxs"))continue;const h=f.slice(14,-3).trim().split(/\s+/),p=xu[h[0]];p&&(e||(e={sheet:a,reset:i,rules:{},toString:n}),e.rules[p]={group:d,index:l,cache:new Set(h)})}if(e)break}if(!e){const a=(l,u)=>({type:u,cssRules:[],insertRule(c,d){this.cssRules.splice(d,0,a(c,{import:3,undefined:1}[(c.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return l==="@media{}"?`@media{${[].map.call(this.cssRules,c=>c.cssText).join("")}}`:l}});e={sheet:t?(t.head||t).appendChild(document.createElement("style")).sheet:a("","text/css"),rules:{},reset:i,toString:n}}const{sheet:s,rules:o}=e;for(let a=xu.length-1;a>=0;--a){const l=xu[a];if(!o[l]){const u=xu[a+1],c=o[u]?o[u].index:s.cssRules.length;s.insertRule("@media{}",c),s.insertRule(`--sxs{--sxs:${a}}`,c),o[l]={group:s.cssRules[c+1],index:c,cache:new Set([a])}}JB(o[l])}};return i(),e},JB=t=>{const e=t.group;let n=e.cssRules.length;t.apply=i=>{try{e.insertRule(i,n),++n}catch{}}},wu=Symbol(),eU=Ia(),kw=(t,e)=>eU(t,()=>(...n)=>{let i={type:null,composers:new Set};for(const r of n)if(r!=null)if(r[Lo]){i.type==null&&(i.type=r[Lo].type);for(const s of r[Lo].composers)i.composers.add(s)}else r.constructor!==Object||r.$$typeof?i.type==null&&(i.type=r):i.composers.add(tU(r,t));return i.type==null&&(i.type="span"),i.composers.size||i.composers.add(["PJLV",{},[],[],{},[]]),nU(t,i,e)}),tU=({variants:t,compoundVariants:e,defaultVariants:n,...i},r)=>{const s=`${Yr(r.prefix)}c-${Po(i)}`,o=[],a=[],l=Object.create(null),u=[];for(const f in n)l[f]=String(n[f]);if(typeof t=="object"&&t)for(const f in t){c=l,d=f,VB.call(c,d)||(l[f]="undefined");const h=t[f];for(const p in h){const m={[f]:String(p)};String(p)==="undefined"&&u.push(f);const y=h[p],g=[m,y,!Cw(y)];o.push(g)}}var c,d;if(typeof e=="object"&&e)for(const f of e){let{css:h,...p}=f;h=typeof h=="object"&&h||{};for(const y in p)p[y]=String(p[y]);const m=[p,h,!Cw(h)];a.push(m)}return[s,i,o,a,l,u]},nU=(t,e,n)=>{const[i,r,s,o]=iU(e.composers),a=typeof e.type=="function"||e.type.$$typeof?(d=>{function f(){for(let h=0;h<f[wu].length;h++){const[p,m]=f[wu][h];d.rules[p].apply(m)}return f[wu]=[],null}return f[wu]=[],f.rules={},xu.forEach(h=>f.rules[h]={apply:p=>f[wu].push([h,p])}),f})(n):null,l=(a||n).rules,u=`.${i}${r.length>1?`:where(.${r.slice(1).join(".")})`:""}`,c=d=>{d=typeof d=="object"&&d||rU;const{css:f,...h}=d,p={};for(const g in s)if(delete h[g],g in d){let v=d[g];typeof v=="object"&&v?p[g]={"@initial":s[g],...v}:(v=String(v),p[g]=v!=="undefined"||o.has(g)?v:s[g])}else p[g]=s[g];const m=new Set([...r]);for(const[g,v,b,T]of e.composers){n.rules.styled.cache.has(g)||(n.rules.styled.cache.add(g),La(v,[`.${g}`],[],t,A=>{l.styled.apply(A)}));const S=Dw(b,p,t.media),_=Dw(T,p,t.media,!0);for(const A of S)if(A!==void 0)for(const[P,O,x]of A){const L=`${g}-${Po(O)}-${P}`;m.add(L);const M=(x?n.rules.resonevar:n.rules.onevar).cache,V=x?l.resonevar:l.onevar;M.has(L)||(M.add(L),La(O,[`.${L}`],[],t,K=>{V.apply(K)}))}for(const A of _)if(A!==void 0)for(const[P,O]of A){const x=`${g}-${Po(O)}-${P}`;m.add(x),n.rules.allvar.cache.has(x)||(n.rules.allvar.cache.add(x),La(O,[`.${x}`],[],t,L=>{l.allvar.apply(L)}))}}if(typeof f=="object"&&f){const g=`${i}-i${Po(f)}-css`;m.add(g),n.rules.inline.cache.has(g)||(n.rules.inline.cache.add(g),La(f,[`.${g}`],[],t,v=>{l.inline.apply(v)}))}for(const g of String(d.className||"").trim().split(/\s+/))g&&m.add(g);const y=h.className=[...m].join(" ");return{type:e.type,className:y,selector:u,props:h,toString:()=>y,deferredInjector:a}};return zm(c,{className:i,selector:u,[Lo]:e,toString:()=>(n.rules.styled.cache.has(i)||c(),i)})},iU=t=>{let e="";const n=[],i={},r=[];for(const[s,,,,o,a]of t){e===""&&(e=s),n.push(s),r.push(...a);for(const l in o){const u=o[l];(i[l]===void 0||u!=="undefined"||a.includes(u))&&(i[l]=u)}}return[e,n,i,new Set(r)]},Dw=(t,e,n,i)=>{const r=[];e:for(let[s,o,a]of t){if(a)continue;let l,u=0,c=!1;for(l in s){const d=s[l];let f=e[l];if(f!==d){if(typeof f!="object"||!f)continue e;{let h,p,m=0;for(const y in f){if(d===String(f[y])){if(y!=="@initial"){const g=y.slice(1);(p=p||[]).push(g in n?n[g]:y.replace(/^@media ?/,"")),c=!0}u+=m,h=!0}++m}if(p&&p.length&&(o={["@media "+p.join(", ")]:o}),!h)continue e}}}(r[u]=r[u]||[]).push([i?"cv":`${l}-${s[l]}`,o,c])}return r},rU={},sU=Ia(),oU=(t,e)=>sU(t,()=>(...n)=>{const i=()=>{for(let r of n){r=typeof r=="object"&&r||{};let s=Po(r);if(!e.rules.global.cache.has(s)){if(e.rules.global.cache.add(s),"@import"in r){let o=[].indexOf.call(e.sheet.cssRules,e.rules.themed.group)-1;for(let a of[].concat(r["@import"]))a=a.includes('"')||a.includes("'")?a:`"${a}"`,e.sheet.insertRule(`@import ${a};`,o++);delete r["@import"]}La(r,[],[],t,o=>{e.rules.global.apply(o)})}}return""};return zm(i,{toString:i})}),aU=Ia(),lU=(t,e)=>aU(t,()=>n=>{const i=`${Yr(t.prefix)}k-${Po(n)}`,r=()=>{if(!e.rules.global.cache.has(i)){e.rules.global.cache.add(i);const s=[];La(n,[],[],t,a=>s.push(a));const o=`@keyframes ${i}{${s.join("")}}`;e.rules.global.apply(o)}return i};return zm(r,{get name(){return r()},toString:r})}),uU=class{constructor(e,n,i,r){this.token=e==null?"":String(e),this.value=n==null?"":String(n),this.scale=i==null?"":String(i),this.prefix=r==null?"":String(r)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+Yr(this.prefix)+Yr(this.scale)+this.token}toString(){return this.computedValue}},cU=Ia(),dU=(t,e)=>cU(t,()=>(n,i)=>{i=typeof n=="object"&&n||Object(i);const r=`.${n=(n=typeof n=="string"?n:"")||`${Yr(t.prefix)}t-${Po(i)}`}`,s={},o=[];for(const l in i){s[l]={};for(const u in i[l]){const c=`--${Yr(t.prefix)}${l}-${u}`,d=Rw(String(i[l][u]),t.prefix,l);s[l][u]=new uU(u,d,l,t.prefix),o.push(`${c}:${d}`)}}const a=()=>{if(o.length&&!e.rules.themed.cache.has(n)){e.rules.themed.cache.add(n);const l=`${i===t.theme?":root,":""}.${n}{${o.join(";")}}`;e.rules.themed.apply(l)}return n};return{...s,get className(){return a()},selector:r,toString:a}}),fU=Ia(),Ow,hU=Ia(),Nw=t=>{const e=(n=>{let i=!1;const r=fU(n,s=>{i=!0;const o="prefix"in(s=typeof s=="object"&&s||{})?String(s.prefix):"",a=typeof s.media=="object"&&s.media||{},l=typeof s.root=="object"?s.root||null:globalThis.document||null,u=typeof s.theme=="object"&&s.theme||{},c={prefix:o,media:a,theme:u,themeMap:typeof s.themeMap=="object"&&s.themeMap||{...$B},utils:typeof s.utils=="object"&&s.utils||{}},d=ZB(l),f={css:kw(c,d),globalCss:oU(c,d),keyframes:lU(c,d),createTheme:dU(c,d),reset(){d.reset(),f.theme.toString()},theme:{},sheet:d,config:c,prefix:o,getCssText:d.toString,toString:d.toString};return String(f.theme=f.createTheme(u)),f});return i||r.reset(),r})(t);return e.styled=(({config:n,sheet:i})=>hU(n,()=>{const r=kw(n,i);return(...s)=>{const o=r(...s),a=o[Lo].type,l=lt.forwardRef((u,c)=>{const d=u&&u.as||a,{props:f,deferredInjector:h}=o(u);return delete f.as,f.ref=c,h?lt.createElement(lt.Fragment,null,lt.createElement(d,f),lt.createElement(h,null)):lt.createElement(d,f)});return l.className=o.className,l.displayName=`Styled.${a.displayName||a.name||a}`,l.selector=o.selector,l.toString=()=>o.selector,l[Lo]=o[Lo],l}}))(e),e},pU=()=>Ow||(Ow=Nw()),mU=(...t)=>pU().createTheme(...t);const jm=209,gU={colors:{primary:"#1a1d1e",primaryMuted:"#26292b",primaryAlt:"#151718",accent:`hsl(${jm} 100% 38.2%)`,accentMuted:`hsl(${jm} 80% 61.8%)`,accentAlt:`hsl(${jm} 80% 30%)`,secondary:"#FFFFFF",secondaryMuted:"#e6e8eb",secondaryAlt:"#c1c8cd"},fontSizes:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},lineHeights:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},sizes:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},space:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},radii:{1:"4px",2:"6px",3:"8px",4:"12px",round:"50%",pill:"9999px"},transitions:{all:"all 200ms cubic-bezier(0.16, 1, 0.3, 1)"},zIndices:{1:"100",2:"200",3:"300",4:"400",max:"999"}},Mw={xxs:"(max-width: 349px)",xs:"(max-width: 575px)",sm:"(max-width: 767px)",md:"(max-width: 991px)",lg:"(max-width: 90rem)",xl:"(min-width: calc(90rem + 1px))"},{styled:xe,css:r0e,keyframes:Fw,createTheme:s0e}=Nw({theme:gU,media:Mw}),yU=xe("div",{display:"flex",flexDirection:"column",alignItems:"center"}),vU=xe("p",{fontWeight:"bold",fontSize:"x-large"}),bU=xe("span",{fontSize:"medium"}),Wm=({error:t})=>{const{message:e}=t;return k(yU,{role:"alert"},k(vU,{"data-testid":"headline"},"Something went wrong"),e&&k(bU,null,`Error message: ${e}`," "))},qm=xe("div",{position:"absolute !important",zIndex:"1",top:"1rem",left:"1rem",width:"161.8px",height:"100px",backgroundColor:"#000D",boxShadow:"5px 5px 5px #0002",borderRadius:"3px",".displayregion":{border:" 3px solid $accent !important",boxShadow:"0 0 3px #0006"},"@sm":{width:"123px",height:"76px"},"@xs":{width:"100px",height:"61.8px"}}),EU=xe("div",{position:"relative",width:"100%",height:"100%",zIndex:"0",".clover-iiif-image-openseadragon-annotation":{position:"relative",backgroundColor:"transparent",border:"2px solid #0003",boxSizing:"content-box",borderRadius:"3px",boxShadow:"0 0 38vw 38vw transparent",transition:"box-shadow 100ms ease-in-out",zIndex:"0",label:{opacity:0,position:"absolute",lineHeight:"1.47rem",pointerEvents:"none",textAlign:"center",minWidth:"300px",maxWidth:"20vw",padding:"0.5rem",borderRadius:"3px",top:"calc(100% + 0.5rem)",left:"50%",transform:"translate(-50%, 0)",backgroundColor:"$primary",color:"$secondary",transition:"opacity 100ms ease-in-out"},"&[data-active=true]":{border:"2px solid $accent !important",boxShadow:"0 0 38vw 38vw #0003",zIndex:"99999999",label:{opacity:1}}}}),TU=xe("div",{width:"100%",height:"100%",maxHeight:"100vh",background:"transparent",backgroundSize:"contain",color:"white",position:"relative",zIndex:"0",overflow:"hidden",variants:{hasNavigator:{true:{[`${qm}`]:{display:"block"}},false:{[`${qm}`]:{display:"none"}}}}}),SU=t=>{const e=t.toString().split(":"),n=Math.ceil(parseInt(e[0])),i=Math.ceil(parseInt(e[1])),r=xU(Math.ceil(parseInt(e[2])),2);let o=`${n!==0&&i<10?(i+"").padStart(2,"0"):i}:${r}`;return n!==0&&(o=`${n}:${o}`),o},Bw=t=>{const e=new Date(t*1e3).toISOString().substr(11,8);return SU(e)},Uw=(t,e)=>{if(typeof t!="object"||t===null)return e;for(const n in e)typeof e[n]=="object"&&e[n]!==null&&!Array.isArray(e[n])?(t[n]||(t[n]={}),t[n]=Uw(t[n],e[n])):t[n]=e[n];return t},Hw=t=>t.split("").reduce(function(e,n){return e=(e<<5)-e+n.charCodeAt(0),e&e},0),$w=(t,e)=>Object.hasOwn(t,e)?t[e].toString():void 0,xU=(t,e)=>String(t).padStart(e,"0");let jd;const wU=new Uint8Array(16);function _U(){if(!jd&&(jd=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!jd))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return jd(wU)}const Sn=[];for(let t=0;t<256;++t)Sn.push((t+256).toString(16).slice(1));function AU(t,e=0){return Sn[t[e+0]]+Sn[t[e+1]]+Sn[t[e+2]]+Sn[t[e+3]]+"-"+Sn[t[e+4]]+Sn[t[e+5]]+"-"+Sn[t[e+6]]+Sn[t[e+7]]+"-"+Sn[t[e+8]]+Sn[t[e+9]]+"-"+Sn[t[e+10]]+Sn[t[e+11]]+Sn[t[e+12]]+Sn[t[e+13]]+Sn[t[e+14]]+Sn[t[e+15]]}const zw={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Pa(t,e,n){if(zw.randomUUID&&!t)return zw.randomUUID();t=t||{};const i=t.random||(t.rng||_U)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,AU(i)}const Vw={behavior:"smooth",block:"center"},Gi={annotationOverlays:{backgroundColor:"#6666ff",borderColor:"#000099",borderType:"solid",borderWidth:"1px",opacity:"0.5",renderOverlays:!0,zoomLevel:2},annotations:{motivations:void 0},background:"transparent",canvasBackgroundColor:"#6662",canvasHeight:"500px",contentSearch:{searchResultsLimit:20,overlays:{backgroundColor:"#ff6666",borderColor:"#990000",borderType:"solid",borderWidth:"1px",opacity:"0.5",renderOverlays:!0,zoomLevel:4}},crossOrigin:"anonymous",ignoreCaptionLabels:[],informationPanel:{vtt:{autoScroll:{enabled:!0,settings:Vw}},open:!0,renderAbout:!0,renderSupplementing:!0,renderToggle:!0,renderAnnotation:!0,renderContentSearch:!0},openSeadragon:{},requestHeaders:{"Content-Type":"application/json"},showDownload:!0,showIIIFBadge:!0,showTitle:!0,withCredentials:!1},Km=(t=Gi)=>Ym(t);function Ym(t){return Array.isArray(t)?t.map(e=>Ym(e)):t&&typeof t=="object"?Object.entries(t).reduce((e,[n,i])=>(e[n]=Ym(i),e),{}):t}function Gw(t){const n=(()=>{var o,a;return((a=(o=Gi==null?void 0:Gi.informationPanel)==null?void 0:o.vtt)==null?void 0:a.autoScroll)||{enabled:!0,settings:Vw}})();if(t==null)return{enabled:n.enabled,settings:{...n.settings}};if(typeof t=="boolean")return{enabled:t,settings:{...n.settings}};if("enabled"in t){const s=t;return{enabled:s.enabled,settings:{...s.settings}}}const r={enabled:!0,settings:{...t}};return CU(r.settings),r}function CU({behavior:t,block:e}){const n=["auto","instant","smooth"],i=["center","end","nearest","start"];if(!n.includes(t))throw TypeError(`'${t}' not in ${n.join(" | ")}`);if(!i.includes(e))throw TypeError(`'${e}' not in ${i.join(" | ")}`)}const IU=Gw((a8=(o8=Gi==null?void 0:Gi.informationPanel)==null?void 0:o8.vtt)==null?void 0:a8.autoScroll),jw=()=>{var t;return{activeCanvas:"",activeManifest:"",activePlayer:null,activeSelector:void 0,OSDImageLoaded:!1,collection:{},configOptions:Km(),customDisplays:[],plugins:[],isAutoScrollEnabled:IU.enabled,isAutoScrolling:!1,isInformationOpen:((t=Gi==null?void 0:Gi.informationPanel)==null?void 0:t.open)??!0,isLoaded:!1,isPaged:!1,isUserScrolling:void 0,sequence:[[],[]],vault:new _w,viewingDirection:"left-to-right",openSeadragonViewer:null,viewerId:Pa(),visibleCanvases:[],visibleAnnotations:[]}},Xm=jw(),Ww=lt.createContext(Xm),qw=lt.createContext(Xm);function RU(t,e){switch(e.type){case"updateActiveCanvas":return e.canvasId||(e.canvasId=""),{...t,activeCanvas:e.canvasId};case"updateActiveManifest":return{...t,activeManifest:e.manifestId};case"updateActivePlayer":return{...t,activePlayer:e.player};case"updateOSDImageLoaded":return{...t,OSDImageLoaded:e.OSDImageLoaded};case"updateAutoScrollAnnotationEnabled":return{...t,isAutoScrollEnabled:e.isAutoScrollEnabled};case"updateAutoScrolling":return{...t,isAutoScrolling:e.isAutoScrolling};case"updateCollection":return{...t,collection:e.collection};case"updateConfigOptions":{const n=Uw(Km(t.configOptions),e.configOptions);return{...t,configOptions:n}}case"updateContentStateAnnotation":return{...t,contentStateAnnotation:e.contentStateAnnotation};case"updateInformationOpen":return{...t,isInformationOpen:e.isInformationOpen};case"updateInformationPanelResource":return{...t,informationPanelResource:e.informationPanelResource};case"updateIsLoaded":return{...t,isLoaded:e.isLoaded};case"updateManifestSequence":return{...t,sequence:e.sequence};case"updateUserScrolling":return{...t,isUserScrolling:e.isUserScrolling};case"updateOpenSeadragonViewer":return{...t,openSeadragonViewer:e.openSeadragonViewer};case"updateViewerId":return{...t,viewerId:e.viewerId};case"updateActiveSelector":return{...t,activeSelector:e.selector};case"updateVisibleCanvases":return{...t,visibleCanvases:e.visibleCanvases};case"updateViewingDirection":return{...t,viewingDirection:e.viewingDirection};case"updateIsPaged":return{...t,isPaged:e.isPaged};default:throw new Error(`Unhandled action type: ${e.type}`)}}const LU=({initialState:t,children:e})=>{const[n,i]=Sa(RU,t,s=>s?{...s,configOptions:Km(s.configOptions??Gi),viewerId:s.viewerId??Pa()}:jw()),{openSeadragonViewer:r}=n;return me(()=>{if(r)return r.addHandler("update-viewport",()=>{const s=r.viewport,o=s.getBounds(),a=s.viewportToImageRectangle(o),u=`xywh=${[Math.round(a.x),Math.round(a.y),Math.round(a.width),Math.round(a.height)].join(",")}`;i({type:"updateActiveSelector",selector:{type:"FragmentSelector",value:u}})}),()=>{r.removeAllHandlers("update-viewport")}},[r]),k(Ww.Provider,{value:n},k(qw.Provider,{value:i},e))};function Nt(){const t=lt.useContext(Ww);if(t===void 0)throw new Error("useViewerState must be used within a ViewerProvider");return t}function jn(){const t=lt.useContext(qw);if(t===void 0)throw new Error("useViewerDispatch must be used within a ViewerProvider");return t}const Kw=xe("button",{display:"flex",height:"2rem",width:"2rem",borderRadius:"2rem",padding:"0",margin:"0",fontFamily:"inherit",background:"none",backgroundColor:"$primary",border:"none",color:"white",cursor:"pointer",marginLeft:"0.618rem",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"content-box !important","&:first-child":{marginLeft:"0"},"@xs":{marginBottom:"0.618rem",marginLeft:"0","&:last-child":{marginBottom:"0"}},svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"inherit"},"&:hover, &:focus":{backgroundColor:"$accent"},"&[data-button=rotate-right]":{"&:hover, &:focus":{svg:{rotate:"45deg"}}},"&[data-button=rotate-left]":{transform:"scaleX(-1)","&:hover, &:focus":{svg:{rotate:"45deg"}}},"&[data-button=reset]":{"&:hover, &:focus":{svg:{rotate:"-15deg"}}}}),ka=({className:t,id:e,label:n,children:i})=>{const s=e.split("-")[0].replace(/([A-Z])/g,"-$1").toLowerCase().replace(/^-/,"");return k(Kw,{id:e,className:t,"data-testid":"openseadragon-button","data-button":s},k("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":`${e}-svg-title`,"data-testid":"openseadragon-button-svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},k("title",{id:`${e}-svg-title`},n),i))},PU=xe("div",{position:"absolute",zIndex:"1",top:"1rem",right:"1rem",display:"flex","@xs":{flexDirection:"column",zIndex:"2"},variants:{hasPlaceholder:{true:{right:"3.618rem","@xs":{top:"3.618rem",right:"1rem"}},false:{right:"1rem","@xs":{top:"1rem",right:"1rem"}}}}}),kU=(t,e,n,i)=>{var s,o,a,l;const r=[n,{code:e,...i||{}}];if((o=(s=t==null?void 0:t.services)==null?void 0:s.logger)!=null&&o.forward)return t.services.logger.forward(r,"warn","react-i18next::",!0);ko(r[0])&&(r[0]=`react-i18next:: ${r[0]}`),(l=(a=t==null?void 0:t.services)==null?void 0:a.logger)!=null&&l.warn?t.services.logger.warn(...r):console!=null&&console.warn&&console.warn(...r)},Yw={},Qm=(t,e,n,i)=>{ko(n)&&Yw[n]||(ko(n)&&(Yw[n]=new Date),kU(t,e,n,i))},Xw=(t,e)=>()=>{if(t.isInitialized)e();else{const n=()=>{setTimeout(()=>{t.off("initialized",n)},0),e()};t.on("initialized",n)}},Zm=(t,e,n)=>{t.loadNamespaces(e,Xw(t,n))},Qw=(t,e,n,i)=>{if(ko(n)&&(n=[n]),t.options.preload&&t.options.preload.indexOf(e)>-1)return Zm(t,n,i);n.forEach(r=>{t.options.ns.indexOf(r)<0&&t.options.ns.push(r)}),t.loadLanguages(e,Xw(t,i))},DU=(t,e,n={})=>!e.languages||!e.languages.length?(Qm(e,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:e.languages}),!0):e.hasLoadedNamespace(t,{lng:n.lng,precheck:(i,r)=>{if(n.bindI18n&&n.bindI18n.indexOf("languageChanging")>-1&&i.services.backendConnector.backend&&i.isLanguageChangingTo&&!r(i.isLanguageChangingTo,t))return!1}}),ko=t=>typeof t=="string",OU=t=>typeof t=="object"&&t!==null,NU=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,MU={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"","&#169;":"","&reg;":"","&#174;":"","&hellip;":"","&#8230;":"","&#x2F;":"/","&#47;":"/"},FU=t=>MU[t];let Jm={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:t=>t.replace(NU,FU)};const BU=(t={})=>{Jm={...Jm,...t}},UU=()=>Jm;let Zw;const HU=t=>{Zw=t},$U=()=>Zw,zU={type:"3rdParty",init(t){BU(t.options.react),HU(t)}},VU=zi();class GU{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(n=>{this.usedNamespaces[n]||(this.usedNamespaces[n]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const jU=(t,e)=>{const n=Le();return me(()=>{n.current=t},[t,e]),n.current},Jw=(t,e,n,i)=>t.getFixedT(e,n,i),WU=(t,e,n,i)=>Ge(Jw(t,e,n,i),[t,e,n,i]),qU=(t,e={})=>{var T,S,_,A;const{i18n:n}=e,{i18n:i,defaultNS:r}=ur(VU)||{},s=n||i||$U();if(s&&!s.reportNamespaces&&(s.reportNamespaces=new GU),!s){Qm(s,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const P=(x,L)=>ko(L)?L:OU(L)&&ko(L.defaultValue)?L.defaultValue:Array.isArray(x)?x[x.length-1]:x,O=[P,{},!1];return O.t=P,O.i18n={},O.ready=!1,O}(T=s.options.react)!=null&&T.wait&&Qm(s,"DEPRECATED_OPTION","useTranslation: It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const o={...UU(),...s.options.react,...e},{useSuspense:a,keyPrefix:l}=o;let u=t||r||((S=s.options)==null?void 0:S.defaultNS);u=ko(u)?[u]:u||["translation"],(A=(_=s.reportNamespaces).addUsedNamespaces)==null||A.call(_,u);const c=(s.isInitialized||s.initializedStoreOnce)&&u.every(P=>DU(P,s,o)),d=WU(s,e.lng||null,o.nsMode==="fallback"?u:u[0],l),f=()=>d,h=()=>Jw(s,e.lng||null,o.nsMode==="fallback"?u:u[0],l),[p,m]=Se(f);let y=u.join();e.lng&&(y=`${e.lng}${y}`);const g=jU(y),v=Le(!0);me(()=>{const{bindI18n:P,bindI18nStore:O}=o;v.current=!0,!c&&!a&&(e.lng?Qw(s,e.lng,u,()=>{v.current&&m(h)}):Zm(s,u,()=>{v.current&&m(h)})),c&&g&&g!==y&&v.current&&m(h);const x=()=>{v.current&&m(h)};return P&&(s==null||s.on(P,x)),O&&(s==null||s.store.on(O,x)),()=>{v.current=!1,s&&P&&(P==null||P.split(" ").forEach(L=>s.off(L,x))),O&&s&&O.split(" ").forEach(L=>s.store.off(L,x))}},[s,y]),me(()=>{v.current&&c&&m(f)},[s,l,c]);const b=[p,s,c];if(b.t=p,b.i18n=s,b.ready=c,c||!c&&!a)return b;throw new Promise(P=>{e.lng?Qw(s,e.lng,u,()=>P()):Zm(s,u,()=>P())})},e_={commonClose:"Close",commonNext:"Next",commonOpen:"Open",commonPrevious:"Previous",commonSearch:"Search",commonSearchPlaceholder:"Search...",commonShare:"Share",commonViewAll:"View All",copyFailure:"Failed",copySuccess:"Copied",contentSearchLoading:"Loading...",contentSearchPlaceholder:"Search",contentSearchResultsNone:"No Results",contentSearchResultsMore:"More Results",imageFullScreen:"Full screen",imageResetZoom:"Reset zoom",imageRotateLeft:"Rotate left",imageRotateRight:"Rotate right",imageZoomIn:"Zoom in",imageZoomOut:"Zoom out",informationPanelTabs:"Select",informationPanelTabsClose:"Viewer",informationPanelTabsAbout:"About",informationPanelTabsAnnotations:"Annotations",informationPanelTabsSearch:"Search",informationPanelToggle:"More Information",shareCollectionJson:"View Collection",shareCollectionCopy:"Copy Collection URL",shareManifestJson:"View Manifest",shareManifestCopy:"Copy Manifest URL"},{slice:KU,forEach:YU}=[];function XU(t){return YU.call(KU.call(arguments,1),e=>{if(e)for(const n in e)t[n]===void 0&&(t[n]=e[n])}),t}function QU(t){return typeof t!="string"?!1:[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(n=>n.test(t))}const t_=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,ZU=function(t,e){const i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{path:"/"},r=encodeURIComponent(e);let s=`${t}=${r}`;if(i.maxAge>0){const o=i.maxAge-0;if(Number.isNaN(o))throw new Error("maxAge should be a Number");s+=`; Max-Age=${Math.floor(o)}`}if(i.domain){if(!t_.test(i.domain))throw new TypeError("option domain is invalid");s+=`; Domain=${i.domain}`}if(i.path){if(!t_.test(i.path))throw new TypeError("option path is invalid");s+=`; Path=${i.path}`}if(i.expires){if(typeof i.expires.toUTCString!="function")throw new TypeError("option expires is invalid");s+=`; Expires=${i.expires.toUTCString()}`}if(i.httpOnly&&(s+="; HttpOnly"),i.secure&&(s+="; Secure"),i.sameSite)switch(typeof i.sameSite=="string"?i.sameSite.toLowerCase():i.sameSite){case!0:s+="; SameSite=Strict";break;case"lax":s+="; SameSite=Lax";break;case"strict":s+="; SameSite=Strict";break;case"none":s+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return i.partitioned&&(s+="; Partitioned"),s},n_={create(t,e,n,i){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};n&&(r.expires=new Date,r.expires.setTime(r.expires.getTime()+n*60*1e3)),i&&(r.domain=i),document.cookie=ZU(t,e,r)},read(t){const e=`${t}=`,n=document.cookie.split(";");for(let i=0;i<n.length;i++){let r=n[i];for(;r.charAt(0)===" ";)r=r.substring(1,r.length);if(r.indexOf(e)===0)return r.substring(e.length,r.length)}return null},remove(t,e){this.create(t,"",-1,e)}};var JU={name:"cookie",lookup(t){let{lookupCookie:e}=t;if(e&&typeof document<"u")return n_.read(e)||void 0},cacheUserLanguage(t,e){let{lookupCookie:n,cookieMinutes:i,cookieDomain:r,cookieOptions:s}=e;n&&typeof document<"u"&&n_.create(n,t,i,r,s)}},e9={name:"querystring",lookup(t){var i;let{lookupQuerystring:e}=t,n;if(typeof window<"u"){let{search:r}=window.location;!window.location.search&&((i=window.location.hash)==null?void 0:i.indexOf("?"))>-1&&(r=window.location.hash.substring(window.location.hash.indexOf("?")));const o=r.substring(1).split("&");for(let a=0;a<o.length;a++){const l=o[a].indexOf("=");l>0&&o[a].substring(0,l)===e&&(n=o[a].substring(l+1))}}return n}},t9={name:"hash",lookup(t){var r;let{lookupHash:e,lookupFromHashIndex:n}=t,i;if(typeof window<"u"){const{hash:s}=window.location;if(s&&s.length>2){const o=s.substring(1);if(e){const a=o.split("&");for(let l=0;l<a.length;l++){const u=a[l].indexOf("=");u>0&&a[l].substring(0,u)===e&&(i=a[l].substring(u+1))}}if(i)return i;if(!i&&n>-1){const a=s.match(/\/([a-zA-Z-]*)/g);return Array.isArray(a)?(r=a[typeof n=="number"?n:0])==null?void 0:r.replace("/",""):void 0}}}return i}};let Da=null;const i_=()=>{if(Da!==null)return Da;try{if(Da=typeof window<"u"&&window.localStorage!==null,!Da)return!1;const t="i18next.translate.boo";window.localStorage.setItem(t,"foo"),window.localStorage.removeItem(t)}catch{Da=!1}return Da};var n9={name:"localStorage",lookup(t){let{lookupLocalStorage:e}=t;if(e&&i_())return window.localStorage.getItem(e)||void 0},cacheUserLanguage(t,e){let{lookupLocalStorage:n}=e;n&&i_()&&window.localStorage.setItem(n,t)}};let Oa=null;const r_=()=>{if(Oa!==null)return Oa;try{if(Oa=typeof window<"u"&&window.sessionStorage!==null,!Oa)return!1;const t="i18next.translate.boo";window.sessionStorage.setItem(t,"foo"),window.sessionStorage.removeItem(t)}catch{Oa=!1}return Oa};var i9={name:"sessionStorage",lookup(t){let{lookupSessionStorage:e}=t;if(e&&r_())return window.sessionStorage.getItem(e)||void 0},cacheUserLanguage(t,e){let{lookupSessionStorage:n}=e;n&&r_()&&window.sessionStorage.setItem(n,t)}},r9={name:"navigator",lookup(t){const e=[];if(typeof navigator<"u"){const{languages:n,userLanguage:i,language:r}=navigator;if(n)for(let s=0;s<n.length;s++)e.push(n[s]);i&&e.push(i),r&&e.push(r)}return e.length>0?e:void 0}},s9={name:"htmlTag",lookup(t){let{htmlTag:e}=t,n;const i=e||(typeof document<"u"?document.documentElement:null);return i&&typeof i.getAttribute=="function"&&(n=i.getAttribute("lang")),n}},o9={name:"path",lookup(t){var r;let{lookupFromPathIndex:e}=t;if(typeof window>"u")return;const n=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(n)?(r=n[typeof e=="number"?e:0])==null?void 0:r.replace("/",""):void 0}},a9={name:"subdomain",lookup(t){var r,s;let{lookupFromSubdomainIndex:e}=t;const n=typeof e=="number"?e+1:1,i=typeof window<"u"&&((s=(r=window.location)==null?void 0:r.hostname)==null?void 0:s.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i));if(i)return i[n]}};let s_=!1;try{document.cookie,s_=!0}catch{}const o_=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];s_||o_.splice(1,1);const l9=()=>({order:o_,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:t=>t});class a_{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(e,n)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{languageUtils:{}},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=e,this.options=XU(n,this.options||{},l9()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=r=>r.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=i,this.addDetector(JU),this.addDetector(e9),this.addDetector(n9),this.addDetector(i9),this.addDetector(r9),this.addDetector(s9),this.addDetector(o9),this.addDetector(a9),this.addDetector(t9)}addDetector(e){return this.detectors[e.name]=e,this}detect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.options.order,n=[];return e.forEach(i=>{if(this.detectors[i]){let r=this.detectors[i].lookup(this.options);r&&typeof r=="string"&&(r=[r]),r&&(n=n.concat(r))}}),n=n.filter(i=>i!=null&&!QU(i)).map(i=>this.options.convertDetectedLanguage(i)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?n:n.length>0?n[0]:null}cacheUserLanguage(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.options.caches;n&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||n.forEach(i=>{this.detectors[i]&&this.detectors[i].cacheUserLanguage(e,this.options)}))}}a_.type="languageDetector";const Xe=t=>typeof t=="string",_u=()=>{let t,e;const n=new Promise((i,r)=>{t=i,e=r});return n.resolve=t,n.reject=e,n},l_=t=>t==null?"":""+t,u9=(t,e,n)=>{t.forEach(i=>{e[i]&&(n[i]=e[i])})},c9=/###/g,u_=t=>t&&t.indexOf("###")>-1?t.replace(c9,"."):t,c_=t=>!t||Xe(t),Au=(t,e,n)=>{const i=Xe(e)?e.split("."):e;let r=0;for(;r<i.length-1;){if(c_(t))return{};const s=u_(i[r]);!t[s]&&n&&(t[s]=new n),Object.prototype.hasOwnProperty.call(t,s)?t=t[s]:t={},++r}return c_(t)?{}:{obj:t,k:u_(i[r])}},d_=(t,e,n)=>{const{obj:i,k:r}=Au(t,e,Object);if(i!==void 0||e.length===1){i[r]=n;return}let s=e[e.length-1],o=e.slice(0,e.length-1),a=Au(t,o,Object);for(;a.obj===void 0&&o.length;)s=`${o[o.length-1]}.${s}`,o=o.slice(0,o.length-1),a=Au(t,o,Object),a&&a.obj&&typeof a.obj[`${a.k}.${s}`]<"u"&&(a.obj=void 0);a.obj[`${a.k}.${s}`]=n},d9=(t,e,n,i)=>{const{obj:r,k:s}=Au(t,e,Object);r[s]=r[s]||[],r[s].push(n)},Wd=(t,e)=>{const{obj:n,k:i}=Au(t,e);if(n)return n[i]},f9=(t,e,n)=>{const i=Wd(t,n);return i!==void 0?i:Wd(e,n)},f_=(t,e,n)=>{for(const i in e)i!=="__proto__"&&i!=="constructor"&&(i in t?Xe(t[i])||t[i]instanceof String||Xe(e[i])||e[i]instanceof String?n&&(t[i]=e[i]):f_(t[i],e[i],n):t[i]=e[i]);return t},Na=t=>t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var h9={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const p9=t=>Xe(t)?t.replace(/[&<>"'\/]/g,e=>h9[e]):t;class m9{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const n=this.regExpMap.get(e);if(n!==void 0)return n;const i=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,i),this.regExpQueue.push(e),i}}const g9=[" ",",","?","!",";"],y9=new m9(20),v9=(t,e,n)=>{e=e||"",n=n||"";const i=g9.filter(o=>e.indexOf(o)<0&&n.indexOf(o)<0);if(i.length===0)return!0;const r=y9.getRegExp(`(${i.map(o=>o==="?"?"\\?":o).join("|")})`);let s=!r.test(t);if(!s){const o=t.indexOf(n);o>0&&!r.test(t.substring(0,o))&&(s=!0)}return s},eg=function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:".";if(!t)return;if(t[e])return t[e];const i=e.split(n);let r=t;for(let s=0;s<i.length;){if(!r||typeof r!="object")return;let o,a="";for(let l=s;l<i.length;++l)if(l!==s&&(a+=n),a+=i[l],o=r[a],o!==void 0){if(["string","number","boolean"].indexOf(typeof o)>-1&&l<i.length-1)continue;s+=l-s+1;break}r=o}return r},qd=t=>t&&t.replace("_","-"),b9={type:"logger",log(t){this.output("log",t)},warn(t){this.output("warn",t)},error(t){this.output("error",t)},output(t,e){console&&console[t]&&console[t].apply(console,e)}};let E9=class NT{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.init(e,n)}init(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.prefix=n.prefix||"i18next:",this.logger=e||b9,this.options=n,this.debug=n.debug}log(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.forward(n,"log","",!0)}warn(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.forward(n,"warn","",!0)}error(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.forward(n,"error","")}deprecate(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.forward(n,"warn","WARNING DEPRECATED: ",!0)}forward(e,n,i,r){return r&&!this.debug?null:(Xe(e[0])&&(e[0]=`${i}${this.prefix} ${e[0]}`),this.logger[n](e))}create(e){return new NT(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new NT(this.logger,e)}};var dr=new E9;let Kd=class{constructor(){this.observers={}}on(e,n){return e.split(" ").forEach(i=>{this.observers[i]||(this.observers[i]=new Map);const r=this.observers[i].get(n)||0;this.observers[i].set(n,r+1)}),this}off(e,n){if(this.observers[e]){if(!n){delete this.observers[e];return}this.observers[e].delete(n)}}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(o=>{let[a,l]=o;for(let u=0;u<l;u++)a(...i)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(o=>{let[a,l]=o;for(let u=0;u<l;u++)a.apply(a,[e,...i])})}};class h_ extends Kd{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=n,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const n=this.options.ns.indexOf(e);n>-1&&this.options.ns.splice(n,1)}getResource(e,n,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const s=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator,o=r.ignoreJSONStructure!==void 0?r.ignoreJSONStructure:this.options.ignoreJSONStructure;let a;e.indexOf(".")>-1?a=e.split("."):(a=[e,n],i&&(Array.isArray(i)?a.push(...i):Xe(i)&&s?a.push(...i.split(s)):a.push(i)));const l=Wd(this.data,a);return!l&&!n&&!i&&e.indexOf(".")>-1&&(e=a[0],n=a[1],i=a.slice(2).join(".")),l||!o||!Xe(i)?l:eg(this.data&&this.data[e]&&this.data[e][n],i,s)}addResource(e,n,i,r){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{silent:!1};const o=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator;let a=[e,n];i&&(a=a.concat(o?i.split(o):i)),e.indexOf(".")>-1&&(a=e.split("."),r=n,n=a[1]),this.addNamespaces(n),d_(this.data,a,r),s.silent||this.emit("added",e,n,i,r)}addResources(e,n,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{silent:!1};for(const s in i)(Xe(i[s])||Array.isArray(i[s]))&&this.addResource(e,n,s,i[s],{silent:!0});r.silent||this.emit("added",e,n,i)}addResourceBundle(e,n,i,r,s){let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{silent:!1,skipCopy:!1},a=[e,n];e.indexOf(".")>-1&&(a=e.split("."),r=i,i=n,n=a[1]),this.addNamespaces(n);let l=Wd(this.data,a)||{};o.skipCopy||(i=JSON.parse(JSON.stringify(i))),r?f_(l,i,s):l={...l,...i},d_(this.data,a,l),o.silent||this.emit("added",e,n,i)}removeResourceBundle(e,n){this.hasResourceBundle(e,n)&&delete this.data[e][n],this.removeNamespaces(n),this.emit("removed",e,n)}hasResourceBundle(e,n){return this.getResource(e,n)!==void 0}getResourceBundle(e,n){return n||(n=this.options.defaultNS),this.options.compatibilityAPI==="v1"?{...this.getResource(e,n)}:this.getResource(e,n)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const n=this.getDataByLanguage(e);return!!(n&&Object.keys(n)||[]).find(r=>n[r]&&Object.keys(n[r]).length>0)}toJSON(){return this.data}}var p_={processors:{},addPostProcessor(t){this.processors[t.name]=t},handle(t,e,n,i,r){return t.forEach(s=>{this.processors[s]&&(e=this.processors[s].process(e,n,i,r))}),e}};const m_={};class Yd extends Kd{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),u9(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=n,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=dr.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};if(e==null)return!1;const i=this.resolve(e,n);return i&&i.res!==void 0}extractFromKey(e,n){let i=n.nsSeparator!==void 0?n.nsSeparator:this.options.nsSeparator;i===void 0&&(i=":");const r=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator;let s=n.ns||this.options.defaultNS||[];const o=i&&e.indexOf(i)>-1,a=!this.options.userDefinedKeySeparator&&!n.keySeparator&&!this.options.userDefinedNsSeparator&&!n.nsSeparator&&!v9(e,i,r);if(o&&!a){const l=e.match(this.interpolator.nestingRegexp);if(l&&l.length>0)return{key:e,namespaces:Xe(s)?[s]:s};const u=e.split(i);(i!==r||i===r&&this.options.ns.indexOf(u[0])>-1)&&(s=u.shift()),e=u.join(r)}return{key:e,namespaces:Xe(s)?[s]:s}}translate(e,n,i){if(typeof n!="object"&&this.options.overloadTranslationOptionHandler&&(n=this.options.overloadTranslationOptionHandler(arguments)),typeof n=="object"&&(n={...n}),n||(n={}),e==null)return"";Array.isArray(e)||(e=[String(e)]);const r=n.returnDetails!==void 0?n.returnDetails:this.options.returnDetails,s=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator,{key:o,namespaces:a}=this.extractFromKey(e[e.length-1],n),l=a[a.length-1],u=n.lng||this.language,c=n.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(u&&u.toLowerCase()==="cimode"){if(c){const T=n.nsSeparator||this.options.nsSeparator;return r?{res:`${l}${T}${o}`,usedKey:o,exactUsedKey:o,usedLng:u,usedNS:l,usedParams:this.getUsedParamsDetails(n)}:`${l}${T}${o}`}return r?{res:o,usedKey:o,exactUsedKey:o,usedLng:u,usedNS:l,usedParams:this.getUsedParamsDetails(n)}:o}const d=this.resolve(e,n);let f=d&&d.res;const h=d&&d.usedKey||o,p=d&&d.exactUsedKey||o,m=Object.prototype.toString.apply(f),y=["[object Number]","[object Function]","[object RegExp]"],g=n.joinArrays!==void 0?n.joinArrays:this.options.joinArrays,v=!this.i18nFormat||this.i18nFormat.handleAsObject,b=!Xe(f)&&typeof f!="boolean"&&typeof f!="number";if(v&&f&&b&&y.indexOf(m)<0&&!(Xe(g)&&Array.isArray(f))){if(!n.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const T=this.options.returnedObjectHandler?this.options.returnedObjectHandler(h,f,{...n,ns:a}):`key '${o} (${this.language})' returned an object instead of string.`;return r?(d.res=T,d.usedParams=this.getUsedParamsDetails(n),d):T}if(s){const T=Array.isArray(f),S=T?[]:{},_=T?p:h;for(const A in f)if(Object.prototype.hasOwnProperty.call(f,A)){const P=`${_}${s}${A}`;S[A]=this.translate(P,{...n,joinArrays:!1,ns:a}),S[A]===P&&(S[A]=f[A])}f=S}}else if(v&&Xe(g)&&Array.isArray(f))f=f.join(g),f&&(f=this.extendTranslation(f,e,n,i));else{let T=!1,S=!1;const _=n.count!==void 0&&!Xe(n.count),A=Yd.hasDefaultValue(n),P=_?this.pluralResolver.getSuffix(u,n.count,n):"",O=n.ordinal&&_?this.pluralResolver.getSuffix(u,n.count,{ordinal:!1}):"",x=_&&!n.ordinal&&n.count===0&&this.pluralResolver.shouldUseIntlApi(),L=x&&n[`defaultValue${this.options.pluralSeparator}zero`]||n[`defaultValue${P}`]||n[`defaultValue${O}`]||n.defaultValue;!this.isValidLookup(f)&&A&&(T=!0,f=L),this.isValidLookup(f)||(S=!0,f=o);const V=(n.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&S?void 0:f,K=A&&L!==f&&this.options.updateMissing;if(S||T||K){if(this.logger.log(K?"updateKey":"missingKey",u,l,o,K?L:f),s){const H=this.resolve(o,{...n,keySeparator:!1});H&&H.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let U=[];const j=this.languageUtils.getFallbackCodes(this.options.fallbackLng,n.lng||this.language);if(this.options.saveMissingTo==="fallback"&&j&&j[0])for(let H=0;H<j.length;H++)U.push(j[H]);else this.options.saveMissingTo==="all"?U=this.languageUtils.toResolveHierarchy(n.lng||this.language):U.push(n.lng||this.language);const G=(H,Y,D)=>{const ee=A&&D!==f?D:V;this.options.missingKeyHandler?this.options.missingKeyHandler(H,l,Y,ee,K,n):this.backendConnector&&this.backendConnector.saveMissing&&this.backendConnector.saveMissing(H,l,Y,ee,K,n),this.emit("missingKey",H,l,Y,f)};this.options.saveMissing&&(this.options.saveMissingPlurals&&_?U.forEach(H=>{const Y=this.pluralResolver.getSuffixes(H,n);x&&n[`defaultValue${this.options.pluralSeparator}zero`]&&Y.indexOf(`${this.options.pluralSeparator}zero`)<0&&Y.push(`${this.options.pluralSeparator}zero`),Y.forEach(D=>{G([H],o+D,n[`defaultValue${D}`]||L)})}):G(U,o,L))}f=this.extendTranslation(f,e,n,d,i),S&&f===o&&this.options.appendNamespaceToMissingKey&&(f=`${l}:${o}`),(S||T)&&this.options.parseMissingKeyHandler&&(this.options.compatibilityAPI!=="v1"?f=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${l}:${o}`:o,T?f:void 0):f=this.options.parseMissingKeyHandler(f))}return r?(d.res=f,d.usedParams=this.getUsedParamsDetails(n),d):f}extendTranslation(e,n,i,r,s){var o=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...i},i.lng||this.language||r.usedLng,r.usedNS,r.usedKey,{resolved:r});else if(!i.skipInterpolation){i.interpolation&&this.interpolator.init({...i,interpolation:{...this.options.interpolation,...i.interpolation}});const u=Xe(e)&&(i&&i.interpolation&&i.interpolation.skipOnVariables!==void 0?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let c;if(u){const f=e.match(this.interpolator.nestingRegexp);c=f&&f.length}let d=i.replace&&!Xe(i.replace)?i.replace:i;if(this.options.interpolation.defaultVariables&&(d={...this.options.interpolation.defaultVariables,...d}),e=this.interpolator.interpolate(e,d,i.lng||this.language||r.usedLng,i),u){const f=e.match(this.interpolator.nestingRegexp),h=f&&f.length;c<h&&(i.nest=!1)}!i.lng&&this.options.compatibilityAPI!=="v1"&&r&&r.res&&(i.lng=this.language||r.usedLng),i.nest!==!1&&(e=this.interpolator.nest(e,function(){for(var f=arguments.length,h=new Array(f),p=0;p<f;p++)h[p]=arguments[p];return s&&s[0]===h[0]&&!i.context?(o.logger.warn(`It seems you are nesting recursively key: ${h[0]} in key: ${n[0]}`),null):o.translate(...h,n)},i)),i.interpolation&&this.interpolator.reset()}const a=i.postProcess||this.options.postProcess,l=Xe(a)?[a]:a;return e!=null&&l&&l.length&&i.applyPostProcessor!==!1&&(e=p_.handle(l,e,n,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...r,usedParams:this.getUsedParamsDetails(i)},...i}:i,this)),e}resolve(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i,r,s,o,a;return Xe(e)&&(e=[e]),e.forEach(l=>{if(this.isValidLookup(i))return;const u=this.extractFromKey(l,n),c=u.key;r=c;let d=u.namespaces;this.options.fallbackNS&&(d=d.concat(this.options.fallbackNS));const f=n.count!==void 0&&!Xe(n.count),h=f&&!n.ordinal&&n.count===0&&this.pluralResolver.shouldUseIntlApi(),p=n.context!==void 0&&(Xe(n.context)||typeof n.context=="number")&&n.context!=="",m=n.lngs?n.lngs:this.languageUtils.toResolveHierarchy(n.lng||this.language,n.fallbackLng);d.forEach(y=>{this.isValidLookup(i)||(a=y,!m_[`${m[0]}-${y}`]&&this.utils&&this.utils.hasLoadedNamespace&&!this.utils.hasLoadedNamespace(a)&&(m_[`${m[0]}-${y}`]=!0,this.logger.warn(`key "${r}" for languages "${m.join(", ")}" won't get resolved as namespace "${a}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),m.forEach(g=>{if(this.isValidLookup(i))return;o=g;const v=[c];if(this.i18nFormat&&this.i18nFormat.addLookupKeys)this.i18nFormat.addLookupKeys(v,c,g,y,n);else{let T;f&&(T=this.pluralResolver.getSuffix(g,n.count,n));const S=`${this.options.pluralSeparator}zero`,_=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(f&&(v.push(c+T),n.ordinal&&T.indexOf(_)===0&&v.push(c+T.replace(_,this.options.pluralSeparator)),h&&v.push(c+S)),p){const A=`${c}${this.options.contextSeparator}${n.context}`;v.push(A),f&&(v.push(A+T),n.ordinal&&T.indexOf(_)===0&&v.push(A+T.replace(_,this.options.pluralSeparator)),h&&v.push(A+S))}}let b;for(;b=v.pop();)this.isValidLookup(i)||(s=b,i=this.getResource(g,y,b,n))}))})}),{res:i,usedKey:r,exactUsedKey:s,usedLng:o,usedNS:a}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,n,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,n,i,r):this.resourceStore.getResource(e,n,i,r)}getUsedParamsDetails(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],i=e.replace&&!Xe(e.replace);let r=i?e.replace:e;if(i&&typeof e.count<"u"&&(r.count=e.count),this.options.interpolation.defaultVariables&&(r={...this.options.interpolation.defaultVariables,...r}),!i){r={...r};for(const s of n)delete r[s]}return r}static hasDefaultValue(e){const n="defaultValue";for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&n===i.substring(0,n.length)&&e[i]!==void 0)return!0;return!1}}const tg=t=>t.charAt(0).toUpperCase()+t.slice(1);class g_{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=dr.create("languageUtils")}getScriptPartFromCode(e){if(e=qd(e),!e||e.indexOf("-")<0)return null;const n=e.split("-");return n.length===2||(n.pop(),n[n.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(n.join("-"))}getLanguagePartFromCode(e){if(e=qd(e),!e||e.indexOf("-")<0)return e;const n=e.split("-");return this.formatLanguageCode(n[0])}formatLanguageCode(e){if(Xe(e)&&e.indexOf("-")>-1){if(typeof Intl<"u"&&typeof Intl.getCanonicalLocales<"u")try{let r=Intl.getCanonicalLocales(e)[0];if(r&&this.options.lowerCaseLng&&(r=r.toLowerCase()),r)return r}catch{}const n=["hans","hant","latn","cyrl","cans","mong","arab"];let i=e.split("-");return this.options.lowerCaseLng?i=i.map(r=>r.toLowerCase()):i.length===2?(i[0]=i[0].toLowerCase(),i[1]=i[1].toUpperCase(),n.indexOf(i[1].toLowerCase())>-1&&(i[1]=tg(i[1].toLowerCase()))):i.length===3&&(i[0]=i[0].toLowerCase(),i[1].length===2&&(i[1]=i[1].toUpperCase()),i[0]!=="sgn"&&i[2].length===2&&(i[2]=i[2].toUpperCase()),n.indexOf(i[1].toLowerCase())>-1&&(i[1]=tg(i[1].toLowerCase())),n.indexOf(i[2].toLowerCase())>-1&&(i[2]=tg(i[2].toLowerCase()))),i.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let n;return e.forEach(i=>{if(n)return;const r=this.formatLanguageCode(i);(!this.options.supportedLngs||this.isSupportedCode(r))&&(n=r)}),!n&&this.options.supportedLngs&&e.forEach(i=>{if(n)return;const r=this.getLanguagePartFromCode(i);if(this.isSupportedCode(r))return n=r;n=this.options.supportedLngs.find(s=>{if(s===r)return s;if(!(s.indexOf("-")<0&&r.indexOf("-")<0)&&(s.indexOf("-")>0&&r.indexOf("-")<0&&s.substring(0,s.indexOf("-"))===r||s.indexOf(r)===0&&r.length>1))return s})}),n||(n=this.getFallbackCodes(this.options.fallbackLng)[0]),n}getFallbackCodes(e,n){if(!e)return[];if(typeof e=="function"&&(e=e(n)),Xe(e)&&(e=[e]),Array.isArray(e))return e;if(!n)return e.default||[];let i=e[n];return i||(i=e[this.getScriptPartFromCode(n)]),i||(i=e[this.formatLanguageCode(n)]),i||(i=e[this.getLanguagePartFromCode(n)]),i||(i=e.default),i||[]}toResolveHierarchy(e,n){const i=this.getFallbackCodes(n||this.options.fallbackLng||[],e),r=[],s=o=>{o&&(this.isSupportedCode(o)?r.push(o):this.logger.warn(`rejecting language code not found in supportedLngs: ${o}`))};return Xe(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&s(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&s(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&s(this.getLanguagePartFromCode(e))):Xe(e)&&s(this.formatLanguageCode(e)),i.forEach(o=>{r.indexOf(o)<0&&s(this.formatLanguageCode(o))}),r}}let T9=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],S9={1:t=>+(t>1),2:t=>+(t!=1),3:t=>0,4:t=>t%10==1&&t%100!=11?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2,5:t=>t==0?0:t==1?1:t==2?2:t%100>=3&&t%100<=10?3:t%100>=11?4:5,6:t=>t==1?0:t>=2&&t<=4?1:2,7:t=>t==1?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2,8:t=>t==1?0:t==2?1:t!=8&&t!=11?2:3,9:t=>+(t>=2),10:t=>t==1?0:t==2?1:t<7?2:t<11?3:4,11:t=>t==1||t==11?0:t==2||t==12?1:t>2&&t<20?2:3,12:t=>+(t%10!=1||t%100==11),13:t=>+(t!==0),14:t=>t==1?0:t==2?1:t==3?2:3,15:t=>t%10==1&&t%100!=11?0:t%10>=2&&(t%100<10||t%100>=20)?1:2,16:t=>t%10==1&&t%100!=11?0:t!==0?1:2,17:t=>t==1||t%10==1&&t%100!=11?0:1,18:t=>t==0?0:t==1?1:2,19:t=>t==1?0:t==0||t%100>1&&t%100<11?1:t%100>10&&t%100<20?2:3,20:t=>t==1?0:t==0||t%100>0&&t%100<20?1:2,21:t=>t%100==1?1:t%100==2?2:t%100==3||t%100==4?3:0,22:t=>t==1?0:t==2?1:(t<0||t>10)&&t%10==0?2:3};const x9=["v1","v2","v3"],w9=["v4"],y_={zero:0,one:1,two:2,few:3,many:4,other:5},_9=()=>{const t={};return T9.forEach(e=>{e.lngs.forEach(n=>{t[n]={numbers:e.nr,plurals:S9[e.fc]}})}),t};class A9{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.languageUtils=e,this.options=n,this.logger=dr.create("pluralResolver"),(!this.options.compatibilityJSON||w9.includes(this.options.compatibilityJSON))&&(typeof Intl>"u"||!Intl.PluralRules)&&(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=_9(),this.pluralRulesCache={}}addRule(e,n){this.rules[e]=n}clearCache(){this.pluralRulesCache={}}getRule(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.shouldUseIntlApi()){const i=qd(e==="dev"?"en":e),r=n.ordinal?"ordinal":"cardinal",s=JSON.stringify({cleanedCode:i,type:r});if(s in this.pluralRulesCache)return this.pluralRulesCache[s];let o;try{o=new Intl.PluralRules(i,{type:r})}catch{if(!e.match(/-|_/))return;const l=this.languageUtils.getLanguagePartFromCode(e);o=this.getRule(l,n)}return this.pluralRulesCache[s]=o,o}return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}needsPlural(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=this.getRule(e,n);return this.shouldUseIntlApi()?i&&i.resolvedOptions().pluralCategories.length>1:i&&i.numbers.length>1}getPluralFormsOfKey(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.getSuffixes(e,i).map(r=>`${n}${r}`)}getSuffixes(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=this.getRule(e,n);return i?this.shouldUseIntlApi()?i.resolvedOptions().pluralCategories.sort((r,s)=>y_[r]-y_[s]).map(r=>`${this.options.prepend}${n.ordinal?`ordinal${this.options.prepend}`:""}${r}`):i.numbers.map(r=>this.getSuffix(e,r,n)):[]}getSuffix(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=this.getRule(e,i);return r?this.shouldUseIntlApi()?`${this.options.prepend}${i.ordinal?`ordinal${this.options.prepend}`:""}${r.select(n)}`:this.getSuffixRetroCompatible(r,n):(this.logger.warn(`no plural rule found for: ${e}`),"")}getSuffixRetroCompatible(e,n){const i=e.noAbs?e.plurals(n):e.plurals(Math.abs(n));let r=e.numbers[i];this.options.simplifyPluralSuffix&&e.numbers.length===2&&e.numbers[0]===1&&(r===2?r="plural":r===1&&(r=""));const s=()=>this.options.prepend&&r.toString()?this.options.prepend+r.toString():r.toString();return this.options.compatibilityJSON==="v1"?r===1?"":typeof r=="number"?`_plural_${r.toString()}`:s():this.options.compatibilityJSON==="v2"||this.options.simplifyPluralSuffix&&e.numbers.length===2&&e.numbers[0]===1?s():this.options.prepend&&i.toString()?this.options.prepend+i.toString():i.toString()}shouldUseIntlApi(){return!x9.includes(this.options.compatibilityJSON)}}const v_=function(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:".",r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,s=f9(t,e,n);return!s&&r&&Xe(n)&&(s=eg(t,n,i),s===void 0&&(s=eg(e,n,i))),s},ng=t=>t.replace(/\$/g,"$$$$");class C9{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=dr.create("interpolator"),this.options=e,this.format=e.interpolation&&e.interpolation.format||(n=>n),this.init(e)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:n,escapeValue:i,useRawValueToEscape:r,prefix:s,prefixEscaped:o,suffix:a,suffixEscaped:l,formatSeparator:u,unescapeSuffix:c,unescapePrefix:d,nestingPrefix:f,nestingPrefixEscaped:h,nestingSuffix:p,nestingSuffixEscaped:m,nestingOptionsSeparator:y,maxReplaces:g,alwaysFormat:v}=e.interpolation;this.escape=n!==void 0?n:p9,this.escapeValue=i!==void 0?i:!0,this.useRawValueToEscape=r!==void 0?r:!1,this.prefix=s?Na(s):o||"{{",this.suffix=a?Na(a):l||"}}",this.formatSeparator=u||",",this.unescapePrefix=c?"":d||"-",this.unescapeSuffix=this.unescapePrefix?"":c||"",this.nestingPrefix=f?Na(f):h||Na("$t("),this.nestingSuffix=p?Na(p):m||Na(")"),this.nestingOptionsSeparator=y||",",this.maxReplaces=g||1e3,this.alwaysFormat=v!==void 0?v:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(n,i)=>n&&n.source===i?(n.lastIndex=0,n):new RegExp(i,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,n,i,r){let s,o,a;const l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},u=h=>{if(h.indexOf(this.formatSeparator)<0){const g=v_(n,l,h,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(g,void 0,i,{...r,...n,interpolationkey:h}):g}const p=h.split(this.formatSeparator),m=p.shift().trim(),y=p.join(this.formatSeparator).trim();return this.format(v_(n,l,m,this.options.keySeparator,this.options.ignoreJSONStructure),y,i,{...r,...n,interpolationkey:m})};this.resetRegExp();const c=r&&r.missingInterpolationHandler||this.options.missingInterpolationHandler,d=r&&r.interpolation&&r.interpolation.skipOnVariables!==void 0?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:h=>ng(h)},{regex:this.regexp,safeValue:h=>this.escapeValue?ng(this.escape(h)):ng(h)}].forEach(h=>{for(a=0;s=h.regex.exec(e);){const p=s[1].trim();if(o=u(p),o===void 0)if(typeof c=="function"){const y=c(e,s,r);o=Xe(y)?y:""}else if(r&&Object.prototype.hasOwnProperty.call(r,p))o="";else if(d){o=s[0];continue}else this.logger.warn(`missed to pass in variable ${p} for interpolating ${e}`),o="";else!Xe(o)&&!this.useRawValueToEscape&&(o=l_(o));const m=h.safeValue(o);if(e=e.replace(s[0],m),d?(h.regex.lastIndex+=o.length,h.regex.lastIndex-=s[0].length):h.regex.lastIndex=0,a++,a>=this.maxReplaces)break}}),e}nest(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r,s,o;const a=(l,u)=>{const c=this.nestingOptionsSeparator;if(l.indexOf(c)<0)return l;const d=l.split(new RegExp(`${c}[ ]*{`));let f=`{${d[1]}`;l=d[0],f=this.interpolate(f,o);const h=f.match(/'/g),p=f.match(/"/g);(h&&h.length%2===0&&!p||p.length%2!==0)&&(f=f.replace(/'/g,'"'));try{o=JSON.parse(f),u&&(o={...u,...o})}catch(m){return this.logger.warn(`failed parsing options string in nesting for key ${l}`,m),`${l}${c}${f}`}return o.defaultValue&&o.defaultValue.indexOf(this.prefix)>-1&&delete o.defaultValue,l};for(;r=this.nestingRegexp.exec(e);){let l=[];o={...i},o=o.replace&&!Xe(o.replace)?o.replace:o,o.applyPostProcessor=!1,delete o.defaultValue;let u=!1;if(r[0].indexOf(this.formatSeparator)!==-1&&!/{.*}/.test(r[1])){const c=r[1].split(this.formatSeparator).map(d=>d.trim());r[1]=c.shift(),l=c,u=!0}if(s=n(a.call(this,r[1].trim(),o),o),s&&r[0]===e&&!Xe(s))return s;Xe(s)||(s=l_(s)),s||(this.logger.warn(`missed to resolve ${r[1]} for nesting ${e}`),s=""),u&&(s=l.reduce((c,d)=>this.format(c,d,i.lng,{...i,interpolationkey:r[1].trim()}),s.trim())),e=e.replace(r[0],s),this.regexp.lastIndex=0}return e}}const I9=t=>{let e=t.toLowerCase().trim();const n={};if(t.indexOf("(")>-1){const i=t.split("(");e=i[0].toLowerCase().trim();const r=i[1].substring(0,i[1].length-1);e==="currency"&&r.indexOf(":")<0?n.currency||(n.currency=r.trim()):e==="relativetime"&&r.indexOf(":")<0?n.range||(n.range=r.trim()):r.split(";").forEach(o=>{if(o){const[a,...l]=o.split(":"),u=l.join(":").trim().replace(/^'+|'+$/g,""),c=a.trim();n[c]||(n[c]=u),u==="false"&&(n[c]=!1),u==="true"&&(n[c]=!0),isNaN(u)||(n[c]=parseInt(u,10))}})}return{formatName:e,formatOptions:n}},Ma=t=>{const e={};return(n,i,r)=>{let s=r;r&&r.interpolationkey&&r.formatParams&&r.formatParams[r.interpolationkey]&&r[r.interpolationkey]&&(s={...s,[r.interpolationkey]:void 0});const o=i+JSON.stringify(s);let a=e[o];return a||(a=t(qd(i),r),e[o]=a),a(n)}};class R9{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=dr.create("formatter"),this.options=e,this.formats={number:Ma((n,i)=>{const r=new Intl.NumberFormat(n,{...i});return s=>r.format(s)}),currency:Ma((n,i)=>{const r=new Intl.NumberFormat(n,{...i,style:"currency"});return s=>r.format(s)}),datetime:Ma((n,i)=>{const r=new Intl.DateTimeFormat(n,{...i});return s=>r.format(s)}),relativetime:Ma((n,i)=>{const r=new Intl.RelativeTimeFormat(n,{...i});return s=>r.format(s,i.range||"day")}),list:Ma((n,i)=>{const r=new Intl.ListFormat(n,{...i});return s=>r.format(s)})},this.init(e)}init(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};this.formatSeparator=n.interpolation.formatSeparator||","}add(e,n){this.formats[e.toLowerCase().trim()]=n}addCached(e,n){this.formats[e.toLowerCase().trim()]=Ma(n)}format(e,n,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const s=n.split(this.formatSeparator);if(s.length>1&&s[0].indexOf("(")>1&&s[0].indexOf(")")<0&&s.find(a=>a.indexOf(")")>-1)){const a=s.findIndex(l=>l.indexOf(")")>-1);s[0]=[s[0],...s.splice(1,a)].join(this.formatSeparator)}return s.reduce((a,l)=>{const{formatName:u,formatOptions:c}=I9(l);if(this.formats[u]){let d=a;try{const f=r&&r.formatParams&&r.formatParams[r.interpolationkey]||{},h=f.locale||f.lng||r.locale||r.lng||i;d=this.formats[u](a,h,{...c,...r,...f})}catch(f){this.logger.warn(f)}return d}else this.logger.warn(`there was no format function for ${u}`);return a},e)}}const L9=(t,e)=>{t.pending[e]!==void 0&&(delete t.pending[e],t.pendingCount--)};class P9 extends Kd{constructor(e,n,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};super(),this.backend=e,this.store=n,this.services=i,this.languageUtils=i.languageUtils,this.options=r,this.logger=dr.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=r.maxParallelReads||10,this.readingCalls=0,this.maxRetries=r.maxRetries>=0?r.maxRetries:5,this.retryTimeout=r.retryTimeout>=1?r.retryTimeout:350,this.state={},this.queue=[],this.backend&&this.backend.init&&this.backend.init(i,r.backend,r)}queueLoad(e,n,i,r){const s={},o={},a={},l={};return e.forEach(u=>{let c=!0;n.forEach(d=>{const f=`${u}|${d}`;!i.reload&&this.store.hasResourceBundle(u,d)?this.state[f]=2:this.state[f]<0||(this.state[f]===1?o[f]===void 0&&(o[f]=!0):(this.state[f]=1,c=!1,o[f]===void 0&&(o[f]=!0),s[f]===void 0&&(s[f]=!0),l[d]===void 0&&(l[d]=!0)))}),c||(a[u]=!0)}),(Object.keys(s).length||Object.keys(o).length)&&this.queue.push({pending:o,pendingCount:Object.keys(o).length,loaded:{},errors:[],callback:r}),{toLoad:Object.keys(s),pending:Object.keys(o),toLoadLanguages:Object.keys(a),toLoadNamespaces:Object.keys(l)}}loaded(e,n,i){const r=e.split("|"),s=r[0],o=r[1];n&&this.emit("failedLoading",s,o,n),!n&&i&&this.store.addResourceBundle(s,o,i,void 0,void 0,{skipCopy:!0}),this.state[e]=n?-1:2,n&&i&&(this.state[e]=0);const a={};this.queue.forEach(l=>{d9(l.loaded,[s],o),L9(l,e),n&&l.errors.push(n),l.pendingCount===0&&!l.done&&(Object.keys(l.loaded).forEach(u=>{a[u]||(a[u]={});const c=l.loaded[u];c.length&&c.forEach(d=>{a[u][d]===void 0&&(a[u][d]=!0)})}),l.done=!0,l.errors.length?l.callback(l.errors):l.callback())}),this.emit("loaded",a),this.queue=this.queue.filter(l=>!l.done)}read(e,n,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.retryTimeout,o=arguments.length>5?arguments[5]:void 0;if(!e.length)return o(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:n,fcName:i,tried:r,wait:s,callback:o});return}this.readingCalls++;const a=(u,c)=>{if(this.readingCalls--,this.waitingReads.length>0){const d=this.waitingReads.shift();this.read(d.lng,d.ns,d.fcName,d.tried,d.wait,d.callback)}if(u&&c&&r<this.maxRetries){setTimeout(()=>{this.read.call(this,e,n,i,r+1,s*2,o)},s);return}o(u,c)},l=this.backend[i].bind(this.backend);if(l.length===2){try{const u=l(e,n);u&&typeof u.then=="function"?u.then(c=>a(null,c)).catch(a):a(null,u)}catch(u){a(u)}return}return l(e,n,a)}prepareLoading(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),r&&r();Xe(e)&&(e=this.languageUtils.toResolveHierarchy(e)),Xe(n)&&(n=[n]);const s=this.queueLoad(e,n,i,r);if(!s.toLoad.length)return s.pending.length||r(),null;s.toLoad.forEach(o=>{this.loadOne(o)})}load(e,n,i){this.prepareLoading(e,n,{},i)}reload(e,n,i){this.prepareLoading(e,n,{reload:!0},i)}loadOne(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const i=e.split("|"),r=i[0],s=i[1];this.read(r,s,"read",void 0,void 0,(o,a)=>{o&&this.logger.warn(`${n}loading namespace ${s} for language ${r} failed`,o),!o&&a&&this.logger.log(`${n}loaded namespace ${s} for language ${r}`,a),this.loaded(e,o,a)})}saveMissing(e,n,i,r,s){let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:()=>{};if(this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(n)){this.logger.warn(`did not save key "${i}" as the namespace "${n}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(i==null||i==="")){if(this.backend&&this.backend.create){const l={...o,isUpdate:s},u=this.backend.create.bind(this.backend);if(u.length<6)try{let c;u.length===5?c=u(e,n,i,r,l):c=u(e,n,i,r),c&&typeof c.then=="function"?c.then(d=>a(null,d)).catch(a):a(null,c)}catch(c){a(c)}else u(e,n,i,r,a,l)}!e||!e[0]||this.store.addResource(e[0],n,i,r)}}}const b_=()=>({debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:t=>{let e={};if(typeof t[1]=="object"&&(e=t[1]),Xe(t[1])&&(e.defaultValue=t[1]),Xe(t[2])&&(e.tDescription=t[2]),typeof t[2]=="object"||typeof t[3]=="object"){const n=t[3]||t[2];Object.keys(n).forEach(i=>{e[i]=n[i]})}return e},interpolation:{escapeValue:!0,format:t=>t,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),E_=t=>(Xe(t.ns)&&(t.ns=[t.ns]),Xe(t.fallbackLng)&&(t.fallbackLng=[t.fallbackLng]),Xe(t.fallbackNS)&&(t.fallbackNS=[t.fallbackNS]),t.supportedLngs&&t.supportedLngs.indexOf("cimode")<0&&(t.supportedLngs=t.supportedLngs.concat(["cimode"])),t),Xd=()=>{},k9=t=>{Object.getOwnPropertyNames(Object.getPrototypeOf(t)).forEach(n=>{typeof t[n]=="function"&&(t[n]=t[n].bind(t))})};class Cu extends Kd{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(super(),this.options=E_(e),this.services={},this.logger=dr,this.modules={external:[]},k9(this),n&&!this.isInitialized&&!e.isClone){if(!this.options.initImmediate)return this.init(e,n),this;setTimeout(()=>{this.init(e,n)},0)}}init(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,typeof n=="function"&&(i=n,n={}),!n.defaultNS&&n.defaultNS!==!1&&n.ns&&(Xe(n.ns)?n.defaultNS=n.ns:n.ns.indexOf("translation")<0&&(n.defaultNS=n.ns[0]));const r=b_();this.options={...r,...this.options,...E_(n)},this.options.compatibilityAPI!=="v1"&&(this.options.interpolation={...r.interpolation,...this.options.interpolation}),n.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=n.keySeparator),n.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=n.nsSeparator);const s=c=>c?typeof c=="function"?new c:c:null;if(!this.options.isClone){this.modules.logger?dr.init(s(this.modules.logger),this.options):dr.init(null,this.options);let c;this.modules.formatter?c=this.modules.formatter:typeof Intl<"u"&&(c=R9);const d=new g_(this.options);this.store=new h_(this.options.resources,this.options);const f=this.services;f.logger=dr,f.resourceStore=this.store,f.languageUtils=d,f.pluralResolver=new A9(d,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),c&&(!this.options.interpolation.format||this.options.interpolation.format===r.interpolation.format)&&(f.formatter=s(c),f.formatter.init(f,this.options),this.options.interpolation.format=f.formatter.format.bind(f.formatter)),f.interpolator=new C9(this.options),f.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},f.backendConnector=new P9(s(this.modules.backend),f.resourceStore,f,this.options),f.backendConnector.on("*",function(h){for(var p=arguments.length,m=new Array(p>1?p-1:0),y=1;y<p;y++)m[y-1]=arguments[y];e.emit(h,...m)}),this.modules.languageDetector&&(f.languageDetector=s(this.modules.languageDetector),f.languageDetector.init&&f.languageDetector.init(f,this.options.detection,this.options)),this.modules.i18nFormat&&(f.i18nFormat=s(this.modules.i18nFormat),f.i18nFormat.init&&f.i18nFormat.init(this)),this.translator=new Yd(this.services,this.options),this.translator.on("*",function(h){for(var p=arguments.length,m=new Array(p>1?p-1:0),y=1;y<p;y++)m[y-1]=arguments[y];e.emit(h,...m)}),this.modules.external.forEach(h=>{h.init&&h.init(this)})}if(this.format=this.options.interpolation.format,i||(i=Xd),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const c=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);c.length>0&&c[0]!=="dev"&&(this.options.lng=c[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(c=>{this[c]=function(){return e.store[c](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(c=>{this[c]=function(){return e.store[c](...arguments),e}});const l=_u(),u=()=>{const c=(d,f)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),l.resolve(f),i(d,f)};if(this.languages&&this.options.compatibilityAPI!=="v1"&&!this.isInitialized)return c(null,this.t.bind(this));this.changeLanguage(this.options.lng,c)};return this.options.resources||!this.options.initImmediate?u():setTimeout(u,0),l}loadResources(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Xd;const r=Xe(e)?e:this.language;if(typeof e=="function"&&(i=e),!this.options.resources||this.options.partialBundledLanguages){if(r&&r.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return i();const s=[],o=a=>{if(!a||a==="cimode")return;this.services.languageUtils.toResolveHierarchy(a).forEach(u=>{u!=="cimode"&&s.indexOf(u)<0&&s.push(u)})};r?o(r):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(l=>o(l)),this.options.preload&&this.options.preload.forEach(a=>o(a)),this.services.backendConnector.load(s,this.options.ns,a=>{!a&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),i(a)})}else i(null)}reloadResources(e,n,i){const r=_u();return typeof e=="function"&&(i=e,e=void 0),typeof n=="function"&&(i=n,n=void 0),e||(e=this.languages),n||(n=this.options.ns),i||(i=Xd),this.services.backendConnector.reload(e,n,s=>{r.resolve(),i(s)}),r}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&p_.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1))for(let n=0;n<this.languages.length;n++){const i=this.languages[n];if(!(["cimode","dev"].indexOf(i)>-1)&&this.store.hasLanguageSomeTranslations(i)){this.resolvedLanguage=i;break}}}changeLanguage(e,n){var i=this;this.isLanguageChangingTo=e;const r=_u();this.emit("languageChanging",e);const s=l=>{this.language=l,this.languages=this.services.languageUtils.toResolveHierarchy(l),this.resolvedLanguage=void 0,this.setResolvedLanguage(l)},o=(l,u)=>{u?(s(u),this.translator.changeLanguage(u),this.isLanguageChangingTo=void 0,this.emit("languageChanged",u),this.logger.log("languageChanged",u)):this.isLanguageChangingTo=void 0,r.resolve(function(){return i.t(...arguments)}),n&&n(l,function(){return i.t(...arguments)})},a=l=>{!e&&!l&&this.services.languageDetector&&(l=[]);const u=Xe(l)?l:this.services.languageUtils.getBestMatchFromCodes(l);u&&(this.language||s(u),this.translator.language||this.translator.changeLanguage(u),this.services.languageDetector&&this.services.languageDetector.cacheUserLanguage&&this.services.languageDetector.cacheUserLanguage(u)),this.loadResources(u,c=>{o(c,u)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?a(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(a):this.services.languageDetector.detect(a):a(e),r}getFixedT(e,n,i){var r=this;const s=function(o,a){let l;if(typeof a!="object"){for(var u=arguments.length,c=new Array(u>2?u-2:0),d=2;d<u;d++)c[d-2]=arguments[d];l=r.options.overloadTranslationOptionHandler([o,a].concat(c))}else l={...a};l.lng=l.lng||s.lng,l.lngs=l.lngs||s.lngs,l.ns=l.ns||s.ns,l.keyPrefix!==""&&(l.keyPrefix=l.keyPrefix||i||s.keyPrefix);const f=r.options.keySeparator||".";let h;return l.keyPrefix&&Array.isArray(o)?h=o.map(p=>`${l.keyPrefix}${f}${p}`):h=l.keyPrefix?`${l.keyPrefix}${f}${o}`:o,r.t(h,l)};return Xe(e)?s.lng=e:s.lngs=e,s.ns=n,s.keyPrefix=i,s}t(){return this.translator&&this.translator.translate(...arguments)}exists(){return this.translator&&this.translator.exists(...arguments)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const i=n.lng||this.resolvedLanguage||this.languages[0],r=this.options?this.options.fallbackLng:!1,s=this.languages[this.languages.length-1];if(i.toLowerCase()==="cimode")return!0;const o=(a,l)=>{const u=this.services.backendConnector.state[`${a}|${l}`];return u===-1||u===0||u===2};if(n.precheck){const a=n.precheck(this,o);if(a!==void 0)return a}return!!(this.hasResourceBundle(i,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||o(i,e)&&(!r||o(s,e)))}loadNamespaces(e,n){const i=_u();return this.options.ns?(Xe(e)&&(e=[e]),e.forEach(r=>{this.options.ns.indexOf(r)<0&&this.options.ns.push(r)}),this.loadResources(r=>{i.resolve(),n&&n(r)}),i):(n&&n(),Promise.resolve())}loadLanguages(e,n){const i=_u();Xe(e)&&(e=[e]);const r=this.options.preload||[],s=e.filter(o=>r.indexOf(o)<0&&this.services.languageUtils.isSupportedCode(o));return s.length?(this.options.preload=r.concat(s),this.loadResources(o=>{i.resolve(),n&&n(o)}),i):(n&&n(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!e)return"rtl";const n=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],i=this.services&&this.services.languageUtils||new g_(b_());return n.indexOf(i.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;return new Cu(e,n)}cloneInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Xd;const i=e.forkResourceStore;i&&delete e.forkResourceStore;const r={...this.options,...e,isClone:!0},s=new Cu(r);return(e.debug!==void 0||e.prefix!==void 0)&&(s.logger=s.logger.clone(e)),["store","services","language"].forEach(a=>{s[a]=this[a]}),s.services={...this.services},s.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},i&&(s.store=new h_(this.store.data,r),s.services.resourceStore=s.store),s.translator=new Yd(s.services,r),s.translator.on("*",function(a){for(var l=arguments.length,u=new Array(l>1?l-1:0),c=1;c<l;c++)u[c-1]=arguments[c];s.emit(a,...u)}),s.init(r,n),s.translator.options=r,s.translator.backendConnector.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},s}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const nn=Cu.createInstance();nn.createInstance=Cu.createInstance,nn.createInstance,nn.dir,nn.init,nn.loadResources,nn.reloadResources,nn.use,nn.changeLanguage,nn.getFixedT,nn.t,nn.exists,nn.setDefaultNamespace,nn.hasLoadedNamespace,nn.loadNamespaces,nn.loadLanguages;const D9={en:e_,fi:{commonClose:"Sulje",commonNext:"Seuraava",commonPrevious:"Edellinen",commonSearch:"Hae",commonSearchPlaceholder:"Hae...",commonShare:"Jaa",commonViewAll:"Nyt kaikki",copyFailure:"Kopiointi eponnistui",copySuccess:"Kopioitu",contentSearchLoading:"Ladataan...",contentSearchPlaceholder:"Haku",contentSearchResultsNone:"Ei osumia",contentSearchResultsMore:"Lis osumia",informationPanelTabs:"Valitse",informationPanelTabsClose:"Katselu",informationPanelTabsAbout:"Tiedot",informationPanelTabsAnnotations:"Annotaatiot",informationPanelTabsSearch:"Haku",informationPanelToggle:"Listiedot",shareCollectionJson:"Nyt kokoelma",shareCollectionCopy:"Kopioi kokoelman osoite",shareManifestJson:"Nyt manifesti",shareManifestCopy:"Kopioi manifestin osoite"},fr:{commonClose:"Fermer",commonNext:"Suivant",commonOpen:"Ouvrir",commonPrevious:"Prcdent",commonSearch:"Rechercher",commonSearchPlaceholder:"Rechercher",commonShare:"Partager",commonViewAll:"Tout afficher",copyFailure:"chec",copySuccess:"Copi",contentSearchLoading:"Chargement",contentSearchPlaceholder:"Rechercher",contentSearchResultsNone:"Aucun rsultat",contentSearchResultsMore:"Plus de rsultats",imageFullScreen:"Plein cran",imageResetZoom:"Rinitialiser le zoom",imageRotateLeft:"Rotation  gauche",imageRotateRight:"Rotation  droite",imageZoomIn:"Zoom avant",imageZoomOut:"Zoom arrire",informationPanelTabs:"Slectionner",informationPanelTabsClose:"Visionneuse",informationPanelTabsAbout:" propos",informationPanelTabsAnnotations:"Annotations",informationPanelTabsSearch:"Recherche",informationPanelToggle:"Plus dinformations",shareCollectionJson:"Afficher la collection",shareCollectionCopy:"Copier lURL de la collection",shareManifestJson:"Afficher le manifeste",shareManifestCopy:"Copier lURL du manifeste"},nb:{commonClose:"Lukk",commonNext:"Neste",commonPrevious:"Forrige",commonSearch:"Sk",commonSearchPlaceholder:"Sk...",commonShare:"Del",commonViewAll:"Se alle",copyFailure:"Feilet",copySuccess:"Kopiert",contentSearchLoading:"Laster inn...",contentSearchPlaceholder:"Sk",contentSearchResultsNone:"Ingen resultat",contentSearchResultsMore:"Flere resultat",informationPanelTabs:"Velg",informationPanelTabsClose:"Viewer",informationPanelTabsAbout:"Om",informationPanelTabsAnnotations:"Annoteringer",informationPanelTabsSearch:"Sk",informationPanelToggle:"Mer informasjon",shareCollectionJson:"Se samlingen",shareCollectionCopy:"Kopir samlingens URL",shareManifestJson:"Se manifestet",shareManifestCopy:"Kopir manifestets URL"},nn:{commonClose:"Lukk",commonNext:"Neste",commonPrevious:"Frre",commonSearch:"Sk",commonSearchPlaceholder:"Sk...",commonShare:"Del",commonViewAll:"Sj alle",copyFailure:"Feila",copySuccess:"Kopiert",contentSearchLoading:"Laster inn...",contentSearchPlaceholder:"Sk",contentSearchResultsNone:"Ingen resultat",contentSearchResultsMore:"Fleire resultat",informationPanelTabs:"Vel",informationPanelTabsClose:"Viewer",informationPanelTabsAbout:"Om",informationPanelTabsAnnotations:"Annoteringa",informationPanelTabsSearch:"Sk",informationPanelToggle:"Meir informasjon",shareCollectionJson:"Sj samlinga",shareCollectionCopy:"Kopir samlingas URL",shareManifestJson:"Sj manifestet",shareManifestCopy:"Kopir manifestets URL"},no:{commonClose:"Lukk",commonNext:"Neste",commonPrevious:"Forrige",commonSearch:"Sk",commonSearchPlaceholder:"Sk...",commonShare:"Del",commonViewAll:"Se alle",copyFailure:"Feilet",copySuccess:"Kopiert",contentSearchLoading:"Laster inn...",contentSearchPlaceholder:"Sk",contentSearchResultsNone:"Ingen resultat",contentSearchResultsMore:"Flere resultat",informationPanelTabs:"Velg",informationPanelTabsClose:"Viewer",informationPanelTabsAbout:"Om",informationPanelTabsAnnotations:"Annoteringer",informationPanelTabsSearch:"Sk",informationPanelToggle:"Mer informasjon",shareCollectionJson:"Se samlingen",shareCollectionCopy:"Kopir samlingens URL",shareManifestJson:"Se manifestet",shareManifestCopy:"Kopir manifestets URL"},pt:{}},Qd="clover",O9=Object.fromEntries(Object.entries(D9).map(([t,e])=>[t,{[Qd]:e}])),Iu={defaultNS:Qd,fallbackLng:"en",ns:[Qd],resources:{...O9}},N9=(t,e)=>({...t||{},...e||{}});let T_=!1;function M9(t){if(t){for(const[e,n]of Object.entries(t))if(n)for(const[i,r]of Object.entries(n))r&&nn.addResourceBundle(e,i,r,!0,!0)}}function F9(t={}){if(T_)M9(t.resources),t.lng&&nn.changeLanguage(t.lng),t.fallbackLng&&(nn.options.fallbackLng=t.fallbackLng);else{const e=N9(Iu.resources,t.resources);nn.use(a_).use(zU).init({...Iu,...t,resources:e,ns:t.ns??Iu.ns,defaultNS:t.defaultNS??Iu.defaultNS,fallbackLng:t.fallbackLng??Iu.fallbackLng}),T_=!0}return nn}F9();const B9=e_;function U9(t){return B9[t]??t}function fr(t=Qd){const e=qU(t),{t:n}=e,i=Ge((r,s)=>{const o=n(r,s);return typeof o!="string"||o===r?U9(r):o},[n]);return{...e,t:i}}const H9=()=>k("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M256 112v288M400 256H112"}),$9=()=>k("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 256H112"}),z9=()=>k("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M432 320v112H320M421.8 421.77L304 304M80 192V80h112M90.2 90.23L208 208M320 80h112v112M421.77 90.2L304 208M192 432H80V320M90.23 421.8L208 304"}),V9=()=>k("path",{d:"M448 440a16 16 0 01-12.61-6.15c-22.86-29.27-44.07-51.86-73.32-67C335 352.88 301 345.59 256 344.23V424a16 16 0 01-27 11.57l-176-168a16 16 0 010-23.14l176-168A16 16 0 01256 88v80.36c74.14 3.41 129.38 30.91 164.35 81.87C449.32 292.44 464 350.9 464 424a16 16 0 01-16 16z"}),S_=()=>k(Be,null,k("path",{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 148l-21.12-24.57A191.43 191.43 0 00240 64C134 64 48 150 48 256s86 192 192 192a192.09 192.09 0 00181.07-128"}),k("path",{d:"M464 97.42V208a16 16 0 01-16 16H337.42c-14.26 0-21.4-17.23-11.32-27.31L436.69 86.1C446.77 76 464 83.16 464 97.42z"})),G9=({_cloverViewerHasPlaceholder:t,config:e})=>{const{t:n}=fr(),i=Nt(),{activeCanvas:r,plugins:s,vault:o,openSeadragonViewer:a}=i,l=o.get({id:r,type:"Canvas"});function u(){return s.filter(c=>{var d;return(d=c.imageViewer)==null?void 0:d.controls}).map((c,d)=>{var h,p,m,y;const f=(p=(h=c.imageViewer)==null?void 0:h.controls)==null?void 0:p.component;return k(f,{key:d,...(y=(m=c==null?void 0:c.imageViewer)==null?void 0:m.controls)==null?void 0:y.componentProps,canvas:l,useViewerDispatch:jn,useViewerState:Nt})})}return me(()=>{if(!a)return;const c=a.viewport.getRotation();a.addHandler("home",()=>{a.viewport.setRotation(c)})},[a]),k(PU,{"data-testid":"clover-iiif-image-openseadragon-controls",hasPlaceholder:t},e.showZoomControl&&k(Be,null,k(ka,{id:e.zoomInButton,label:n("imageZoomIn")},k(H9,null)),k(ka,{id:e.zoomOutButton,label:n("imageZoomOut")},k($9,null))),e.showFullPageControl&&k(ka,{id:e.fullPageButton,label:n("imageFullScreen")},k(z9,null)),e.showRotationControl&&k(Be,null,k(ka,{id:e.rotateRightButton,label:n("imageRotateRight")},k(S_,null)),k(ka,{id:e.rotateLeftButton,label:n("imageRotateLeft")},k(S_,null))),e.showHomeControl&&k(ka,{id:e.homeButton,label:n("imageResetZoom")},k(V9,null)),u())};async function x_(t,e=3,n=500){try{return await t()}catch(i){if(e<=0)throw i;return await new Promise(r=>setTimeout(r,n)),x_(t,e-1,n)}}const j9=t=>new Promise(e=>setTimeout(e,t)),w_=async(t,e,n=3,i=300)=>{for(let r=0;r<n;r++){const s=e?e-1:0,o=t.getItemAt(s);if(o)return o;await j9(i)}throw new Error("No base item found at index 0 after retries")},W9=({annotations:t,ariaLabel:e,config:n,uri:i,_cloverViewerHasPlaceholder:r,imageType:s,openSeadragonCallback:o})=>{const[a,l]=Se([]),[u,c]=Se([]),[d,f]=Se(),[h,p]=Se([]),m=jn(),y=Le(!1),g="clover-iiif-image-openseadragon-annotation",v=n.gestureSettingsMouse.scrollToZoom===!1;me(()=>(y.current||(y.current=!0,d||f(hu(n))),()=>d==null?void 0:d.destroy()),[]),me(()=>{b()},[d,o]),me(()=>{d&&JSON.stringify(i)!==JSON.stringify(u)&&(d.forceRedraw(),v&&d.addHandler("canvas-scroll",function(T){T.preventDefault=!1}),c(i))},[v,d,u,i]),me(()=>{if(!u.length||!d)return;d.close(),(async()=>{switch(s){case"simpleImage":let S=1,_=0;for(let A=0;A<u.length;A++){const P=u[A];if(t){const O=new Image;O.src=P,await O.decode(),p(x=>[...x,{width:O==null?void 0:O.width,height:O==null?void 0:O.height}])}try{if(A!==0){const x=(await w_(d.world,A)).getBounds();_=x.x+x.width,S=x.height}d.addSimpleImage({url:P,x:_,y:0,height:S,success:()=>{l(O=>[...O,P]),typeof m=="function"&&m({type:"updateOSDImageLoaded",OSDImageLoaded:!0})}})}catch(O){console.error(`Failed to load image at ${P}:`,O)}}break;case"tiledImage":{let A=1,P=0;for(let O=0;O<u.length;O++){const x=u[O];try{const L=await x_(()=>RB(x),3,1e3);if(!L)throw new Error(`No tile source for ${x}`);if(O!==0){const V=(await w_(d.world,O)).getBounds();P=V.x+V.width,A=V.height}d.addTiledImage({tileSource:L,x:P,y:0,height:A,success:()=>{l(M=>[...M,x]),typeof m=="function"&&m({type:"updateOSDImageLoaded",OSDImageLoaded:!0})}})}catch(L){console.error(`Failed to load tile at ${x}:`,L)}}break}default:console.warn(`Unsupported imageType: "${s}"`);break}})().catch(S=>console.error("Error drawing tiles",S))},[u,s,d]),me(()=>{if(a){let S=0;const _=()=>{if(S<3){const A=d==null?void 0:d.world.getHomeBounds();A&&(d==null||d.viewport.fitBounds(A,!0)),S++,setTimeout(_,50)}};_(),d==null||d.addHandler("canvas-click",A=>{const P=d==null?void 0:d.getOverlayById(A.originalTarget.id);if(P){const O=P==null?void 0:P.getBounds(d.viewport);return O.x-=.1,O.y-=.1,O.width+=.2,O.height+=.2,d==null||d.viewport.fitBounds(O,!1),A.preventDefaultAction=!0}})}},[a]),me(()=>{function T(S,_,A){let P=S*A;if(_===0)return P;for(;_>0;){const O=d==null?void 0:d.world.getItemAt(_-1);if(O){const x=O.getBounds().width;P+=x,_--}else break}return P}t&&(d==null||d.clearOverlays(),t.forEach(S=>{var V,K,U,j;const{annotation:_,targetIndex:A}=S,P=((K=(V=d==null?void 0:d.viewport)==null?void 0:V.getBounds())==null?void 0:K.width)||1,O=d==null?void 0:d.world.getItemAt(A),x=O?(O==null?void 0:O.getBounds().width)/(O==null?void 0:O.getContentSize().x):((U=h[A])==null?void 0:U.width)/P,L=$8(_==null?void 0:_.target),M=_!=null&&_.body?(j=_==null?void 0:_.body[0])==null?void 0:j.value:void 0;if(L!=null&&L.rect){const{x:G,y:H,w:Y,h:D}=L==null?void 0:L.rect,ee=T(G,A,x),ne=new hu.Rect(ee,H*x,Y*x,D*x),N=document.createElement("button");if(N.classList.add(g),N.id=_.id,N.setAttribute("tabindex","0"),N.setAttribute("role","button"),N.setAttribute("data-active","true"),N.setAttribute("tabindex","0"),N.setAttribute("role","button"),N.setAttribute("data-active","false"),M){N.setAttribute("aria-label",M);const le=document.createElement("label");le.innerHTML=M,N.appendChild(le)}N.addEventListener("mousedown",le=>{le.stopPropagation(),le.preventDefault()}),N.addEventListener("touchstart",le=>{le.stopPropagation(),le.preventDefault()}),N.addEventListener("click",le=>{le.stopPropagation(),le.preventDefault()}),N.addEventListener("keydown",le=>{if(le.key==="Enter"){le.stopPropagation(),le.preventDefault();const we=new hu.Rect(ne.x-.1,ne.y-.1,ne.width+.2,ne.height+.2);d==null||d.viewport.fitBounds(we,!1)}}),N.addEventListener("focus",()=>{N.setAttribute("data-active","true")}),N.addEventListener("mouseover",()=>{N.setAttribute("data-active","true")}),N.addEventListener("mouseout",()=>{N.removeAttribute("data-active")}),N.addEventListener("blur",()=>{N.removeAttribute("data-active")}),d==null||d.addOverlay(N,ne,hu.Placement.CENTER)}}),b())},[a,t]);function b(){d&&(o==null||o(d))}return k(TU,{className:"clover-iiif-image-openseadragon","data-testid":"clover-iiif-image-openseadragon","data-openseadragon-instance":n.id,hasNavigator:n.showNavigator},k(G9,{_cloverViewerHasPlaceholder:r,config:n}),n.showNavigator&&k(qm,{id:n.navigatorId,"data-testid":"clover-iiif-image-openseadragon-navigator"}),k(EU,{id:n.id,"data-testid":"clover-iiif-image-openseadragon-viewport",role:"img",...e&&{"aria-label":e}}))};function q9(t){return{id:`openseadragon-${t}`,navigatorId:`openseadragon-navigator-${t}`,loadTilesWithAjax:!0,fullPageButton:`fullPage-${t}`,homeButton:`reset-${t}`,rotateLeftButton:`rotateLeft-${t}`,rotateRightButton:`rotateRight-${t}`,zoomInButton:`zoomIn-${t}`,zoomOutButton:`zoomOut-${t}`,showNavigator:!0,showFullPageControl:!0,showHomeControl:!0,showRotationControl:!0,showZoomControl:!0,navigatorBorderColor:"transparent",gestureSettingsMouse:{clickToZoom:!0,dblClickToZoom:!0,pinchToZoom:!0,scrollToZoom:!1}}}const __=(t,e="none")=>{if(!t)return null;if(typeof t=="string")return[t];if(!t[e]){const n=Object.getOwnPropertyNames(t);if(n.length>0)return t[n[0]]}return!t[e]||!Array.isArray(t[e])?null:t[e]},ui=(t,e="none",n=", ")=>{const i=__(t,e);return Array.isArray(i)?i.join(`${n}`):i},A_=({_cloverViewerHasPlaceholder:t=!1,annotations:e,body:n,instanceId:i,isTiledImage:r=!1,label:s,src:o="",openSeadragonCallback:a,openSeadragonConfig:l={}})=>{const u=i??Pa(),c=typeof s=="string"?s:ui(s),d={...q9(u),...l},f=Array.isArray(n)?n:n?[n]:[],h=Array.isArray(o)?o:o?[o]:[];let p=[],m=Li.SimpleImage;if(f.length){const g=f.map(FB);p=g.map(v=>v.uri).filter(Boolean),m=g.some(v=>v.imageType===Li.TiledImage)?Li.TiledImage:Li.SimpleImage}else if(h.length){const g=h.map(v=>BB(v,r));p=g.map(v=>v.uri).filter(Boolean),m=g.some(v=>v.imageType===Li.TiledImage)?Li.TiledImage:Li.SimpleImage}return p.length?k($m,{FallbackComponent:Wm},k(W9,{_cloverViewerHasPlaceholder:t,annotations:e,ariaLabel:c,config:d,imageType:m,key:u,uri:p,openSeadragonCallback:g=>{a==null||a(g)}})):null};function C_(t,e,n,i){function r(){const o=Reflect.construct(HTMLElement,[],r);return o._vdomComponent=t,o._shadowEnabled=i&&i.shadow,o._root=o._shadowEnabled?o.attachShadow({mode:"open"}):o,i.onConstruct&&i.onConstruct(o),o.ready=!1,o.whenReady=a=>{o.ready?a():o.addEventListener("ready",a)},o}r.prototype=Object.create(HTMLElement.prototype),r.prototype.constructor=r,r.prototype.connectedCallback=Y9,r.prototype.attributeChangedCallback=X9,r.prototype.disconnectedCallback=Q9,n=n||t.observedAttributes||Object.keys(t.propTypes||{}),r.observedAttributes=n,n.forEach(o=>{Object.defineProperty(r.prototype,o,{get(){return this._vdom?this._vdom.props[o]:(this._props||(this._props={}),this._props[o])},set(a){this._vdom?(this._props[o]=a,this.attributeChangedCallback(o,null,a)):(this._props||(this._props={}),this._props[o]=a,this._props[ig(o)]=a);const l=typeof a;(a==null||l==="string"||l==="boolean"||l==="number")&&this.setAttribute(o,a)}})}),i.beforeCreate&&i.beforeCreate(r);const s=e||t.tagName||t.displayName||t.name;if(!customElements.get(s))return customElements.define(e||t.tagName||t.displayName||t.name,r)}function K9(t){this.getChildContext=()=>t.context;const{context:e,children:n,...i}=t;return J0(n,i)}function Y9(){const t=new CustomEvent("_preact",{detail:{},bubbles:!0,cancelable:!0});this.dispatchEvent(t);const e=t.detail.context;this._vdom=k(K9,{...this._props,context:e},R_(this,this._vdomComponent,this._shadowEnabled)),(this.hasAttribute("hydrate")?Z0:xs)(this._vdom,this._root),this.ready||(this.ready=!0,this.dispatchEvent(new CustomEvent("ready",{detail:{},bubbles:!1,cancelable:!1})))}function ig(t){return t.replace(/-(\w)/g,(e,n)=>n?n.toUpperCase():"")}function X9(t,e,n){if(!this._vdom)return;n=n??void 0;const i={};i[t]=n,i[ig(t)]=n,this._vdom=J0(this._vdom,i),xs(this._vdom,this._root)}function Q9(){xs(this._vdom=null,this._root)}function I_(t,e){const{shadow:n,addContextListener:i,removeContextListener:r,...s}=t,o=a=>{a?(this.ref=a,this._listener||(this._listener=l=>{l.stopPropagation(),l.detail.context=e},i(this._listener,this.ref))):r(this._listener,this.ref)};return!n&&!this._listener&&(this._listener=a=>{a.stopPropagation(),a.detail.context=e},i(this._listener)),k(n?"slot":Be,{...s,ref:o})}function R_(t,e,n){if(t.nodeType===3)return t.data;if(t.nodeType!==1)return null;let i=[],r={},s=0,o=t.attributes,a=t.childNodes;for(s=o.length;s--;)o[s].name!=="slot"&&(r[o[s].name]=o[s].value,r[ig(o[s].name)]=o[s].value);for(s=a.length;s--;){const c=a[s],d=R_(c,null,n),f=c.slot;f?r[f]=k(I_,{name:f,shadow:n,addContextListener(h,p=c){p.addEventListener("_preact",h)},removeContextListener(h,p=c){p.removeEventListener("_preact",h)}},d):i[s]=d}const u=e?k(I_,{shadow:n,addContextListener(c,d=t){d.addEventListener("_preact",c)},removeContextListener(c,d=t){d.removeEventListener("_preact",c)}},i):i;return!n&&e&&(t.innerHTML=""),k(e||t.nodeName.toLowerCase(),r,u)}typeof window<"u"&&C_(t=>{const e=Le(),{"aria-label":n,"is-tiled-image":i,src:r}=t;return Ii(()=>{t.__registerPublicApi&&t.__registerPublicApi(s=>{e.current=s})},[t,t.__registerPublicApi]),k(A_,{label:n,isTiledImage:i,src:r})},"clover-image",["aria-label","src","is-tiled-image"],{shadow:!1,onConstruct:t=>{t._props={__registerPublicApi:e=>{Object.assign(t,e(t))}}}});function st(t,e,{checkForDefaultPrevented:n=!0}={}){return function(r){if(t==null||t(r),n===!1||!r.defaultPrevented)return e==null?void 0:e(r)}}var Z9=0;function ue(t,e,n,i,r,s){e||(e={});var o,a,l=e;if("ref"in l)for(a in l={},e)a=="ref"?o=e[a]:l[a]=e[a];var u={type:t,props:l,key:n,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Z9,__i:-1,__u:0,__source:r,__self:s};if(typeof t=="function"&&(o=t.defaultProps))for(a in o)l[a]===void 0&&(l[a]=o[a]);return et.vnode&&et.vnode(u),u}function hr(t,e=[]){let n=[];function i(s,o){const a=zi(o),l=n.length;n=[...n,o];const u=d=>{var g;const{scope:f,children:h,...p}=d,m=((g=f==null?void 0:f[t])==null?void 0:g[l])||a,y=en(()=>p,Object.values(p));return ue(m.Provider,{value:y,children:h})};u.displayName=s+"Provider";function c(d,f){var m;const h=((m=f==null?void 0:f[t])==null?void 0:m[l])||a,p=ur(h);if(p)return p;if(o!==void 0)return o;throw new Error(`\`${d}\` must be used within \`${s}\``)}return[u,c]}const r=()=>{const s=n.map(o=>zi(o));return function(a){const l=(a==null?void 0:a[t])||s;return en(()=>({[`__scope${t}`]:{...a,[t]:l}}),[a,l])}};return r.scopeName=t,[i,J9(r,...e)]}function J9(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const i=t.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(s){const o=i.reduce((a,{useScope:l,scopeName:u})=>{const d=l(s)[`__scope${u}`];return{...a,...d}},{});return en(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return n.scopeName=e.scopeName,n}var xn=globalThis!=null&&globalThis.document?Ii:()=>{},e7=Nd[" useInsertionEffect ".trim().toString()]||xn;function Rs({prop:t,defaultProp:e,onChange:n=()=>{},caller:i}){const[r,s,o]=t7({defaultProp:e,onChange:n}),a=t!==void 0,l=a?t:r;{const c=Le(t!==void 0);me(()=>{const d=c.current;d!==a&&console.warn(`${i} is changing from ${d?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),c.current=a},[a,i])}const u=Ge(c=>{var d;if(a){const f=n7(c)?c(t):c;f!==t&&((d=o.current)==null||d.call(o,f))}else s(c)},[a,t,s,o]);return[l,u]}function t7({defaultProp:t,onChange:e}){const[n,i]=Se(t),r=Le(n),s=Le(e);return e7(()=>{s.current=e},[e]),me(()=>{var o;r.current!==n&&((o=s.current)==null||o.call(s,n),r.current=n)},[n,r]),[n,i,s]}function n7(t){return typeof t=="function"}function L_(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function P_(...t){return e=>{let n=!1;const i=t.map(r=>{const s=L_(r,e);return!n&&typeof s=="function"&&(n=!0),s});if(n)return()=>{for(let r=0;r<i.length;r++){const s=i[r];typeof s=="function"?s():L_(t[r],null)}}}}function At(...t){return Ge(P_(...t),t)}var k_={exports:{}},ci={};const i7=MS(Nd);var D_={exports:{}},O_={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(H,Y){var D=H.length;H.push(Y);e:for(;0<D;){var ee=D-1>>>1,ne=H[ee];if(0<r(ne,Y))H[ee]=Y,H[D]=ne,D=ee;else break e}}function n(H){return H.length===0?null:H[0]}function i(H){if(H.length===0)return null;var Y=H[0],D=H.pop();if(D!==Y){H[0]=D;e:for(var ee=0,ne=H.length,N=ne>>>1;ee<N;){var le=2*(ee+1)-1,we=H[le],ce=le+1,re=H[ce];if(0>r(we,D))ce<ne&&0>r(re,we)?(H[ee]=re,H[ce]=D,ee=ce):(H[ee]=we,H[le]=D,ee=le);else if(ce<ne&&0>r(re,D))H[ee]=re,H[ce]=D,ee=ce;else break e}}return Y}function r(H,Y){var D=H.sortIndex-Y.sortIndex;return D!==0?D:H.id-Y.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],u=[],c=1,d=null,f=3,h=!1,p=!1,m=!1,y=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(H){for(var Y=n(u);Y!==null;){if(Y.callback===null)i(u);else if(Y.startTime<=H)i(u),Y.sortIndex=Y.expirationTime,e(l,Y);else break;Y=n(u)}}function T(H){if(m=!1,b(H),!p)if(n(l)!==null)p=!0,j(S);else{var Y=n(u);Y!==null&&G(T,Y.startTime-H)}}function S(H,Y){p=!1,m&&(m=!1,g(P),P=-1),h=!0;var D=f;try{for(b(Y),d=n(l);d!==null&&(!(d.expirationTime>Y)||H&&!L());){var ee=d.callback;if(typeof ee=="function"){d.callback=null,f=d.priorityLevel;var ne=ee(d.expirationTime<=Y);Y=t.unstable_now(),typeof ne=="function"?d.callback=ne:d===n(l)&&i(l),b(Y)}else i(l);d=n(l)}if(d!==null)var N=!0;else{var le=n(u);le!==null&&G(T,le.startTime-Y),N=!1}return N}finally{d=null,f=D,h=!1}}var _=!1,A=null,P=-1,O=5,x=-1;function L(){return!(t.unstable_now()-x<O)}function M(){if(A!==null){var H=t.unstable_now();x=H;var Y=!0;try{Y=A(!0,H)}finally{Y?V():(_=!1,A=null)}}else _=!1}var V;if(typeof v=="function")V=function(){v(M)};else if(typeof MessageChannel<"u"){var K=new MessageChannel,U=K.port2;K.port1.onmessage=M,V=function(){U.postMessage(null)}}else V=function(){y(M,0)};function j(H){A=H,_||(_=!0,V())}function G(H,Y){P=y(function(){H(t.unstable_now())},Y)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(H){H.callback=null},t.unstable_continueExecution=function(){p||h||(p=!0,j(S))},t.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<H?Math.floor(1e3/H):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(H){switch(f){case 1:case 2:case 3:var Y=3;break;default:Y=f}var D=f;f=Y;try{return H()}finally{f=D}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(H,Y){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var D=f;f=H;try{return Y()}finally{f=D}},t.unstable_scheduleCallback=function(H,Y,D){var ee=t.unstable_now();switch(typeof D=="object"&&D!==null?(D=D.delay,D=typeof D=="number"&&0<D?ee+D:ee):D=ee,H){case 1:var ne=-1;break;case 2:ne=250;break;case 5:ne=1073741823;break;case 4:ne=1e4;break;default:ne=5e3}return ne=D+ne,H={id:c++,callback:Y,priorityLevel:H,startTime:D,expirationTime:ne,sortIndex:-1},D>ee?(H.sortIndex=D,e(u,H),n(l)===null&&H===n(u)&&(m?(g(P),P=-1):m=!0,G(T,D-ee))):(H.sortIndex=ne,e(l,H),p||h||(p=!0,j(S))),H},t.unstable_shouldYield=L,t.unstable_wrapCallback=function(H){var Y=f;return function(){var D=f;f=Y;try{return H.apply(this,arguments)}finally{f=D}}}})(O_),D_.exports=O_;var r7=D_.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var s7=i7,di=r7;function ye(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var N_=new Set,Ru={};function Do(t,e){Fa(t,e),Fa(t+"Capture",e)}function Fa(t,e){for(Ru[t]=e,t=0;t<e.length;t++)N_.add(e[t])}var Xr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),rg=Object.prototype.hasOwnProperty,o7=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,M_={},F_={};function a7(t){return rg.call(F_,t)?!0:rg.call(M_,t)?!1:o7.test(t)?F_[t]=!0:(M_[t]=!0,!1)}function l7(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function u7(t,e,n,i){if(e===null||typeof e>"u"||l7(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Bn(t,e,n,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var wn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){wn[t]=new Bn(t,0,!1,t,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];wn[e]=new Bn(e,1,!1,t[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(t){wn[t]=new Bn(t,2,!1,t.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){wn[t]=new Bn(t,2,!1,t,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){wn[t]=new Bn(t,3,!1,t.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(t){wn[t]=new Bn(t,3,!0,t,null,!1,!1)}),["capture","download"].forEach(function(t){wn[t]=new Bn(t,4,!1,t,null,!1,!1)}),["cols","rows","size","span"].forEach(function(t){wn[t]=new Bn(t,6,!1,t,null,!1,!1)}),["rowSpan","start"].forEach(function(t){wn[t]=new Bn(t,5,!1,t.toLowerCase(),null,!1,!1)});var sg=/[\-:]([a-z])/g;function og(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(sg,og);wn[e]=new Bn(e,1,!1,t,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(sg,og);wn[e]=new Bn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(sg,og);wn[e]=new Bn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(t){wn[t]=new Bn(t,1,!1,t.toLowerCase(),null,!1,!1)}),wn.xlinkHref=new Bn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(t){wn[t]=new Bn(t,1,!1,t.toLowerCase(),null,!0,!0)});function ag(t,e,n,i){var r=wn.hasOwnProperty(e)?wn[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(u7(e,n,r,i)&&(n=null),i||r===null?a7(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var Qr=s7.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Zd=Symbol.for("react.element"),Ba=Symbol.for("react.portal"),Ua=Symbol.for("react.fragment"),lg=Symbol.for("react.strict_mode"),ug=Symbol.for("react.profiler"),B_=Symbol.for("react.provider"),U_=Symbol.for("react.context"),cg=Symbol.for("react.forward_ref"),dg=Symbol.for("react.suspense"),fg=Symbol.for("react.suspense_list"),hg=Symbol.for("react.memo"),Ls=Symbol.for("react.lazy"),H_=Symbol.for("react.offscreen"),$_=Symbol.iterator;function Lu(t){return t===null||typeof t!="object"?null:(t=$_&&t[$_]||t["@@iterator"],typeof t=="function"?t:null)}var Gt=Object.assign,pg;function Pu(t){if(pg===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);pg=e&&e[1]||""}return`
`+pg+t}var mg=!1;function gg(t,e){if(!t||mg)return"";mg=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var i=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){i=u}t.call(e.prototype)}else{try{throw Error()}catch(u){i=u}t()}}catch(u){if(u&&i&&typeof u.stack=="string"){for(var r=u.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var l=`
`+r[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{mg=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Pu(t):""}function c7(t){switch(t.tag){case 5:return Pu(t.type);case 16:return Pu("Lazy");case 13:return Pu("Suspense");case 19:return Pu("SuspenseList");case 0:case 2:case 15:return t=gg(t.type,!1),t;case 11:return t=gg(t.type.render,!1),t;case 1:return t=gg(t.type,!0),t;default:return""}}function yg(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Ua:return"Fragment";case Ba:return"Portal";case ug:return"Profiler";case lg:return"StrictMode";case dg:return"Suspense";case fg:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case U_:return(t.displayName||"Context")+".Consumer";case B_:return(t._context.displayName||"Context")+".Provider";case cg:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case hg:return e=t.displayName||null,e!==null?e:yg(t.type)||"Memo";case Ls:e=t._payload,t=t._init;try{return yg(t(e))}catch{}}return null}function d7(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return yg(e);case 8:return e===lg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ps(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function z_(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function f7(t){var e=z_(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Jd(t){t._valueTracker||(t._valueTracker=f7(t))}function V_(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=z_(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function ef(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function vg(t,e){var n=e.checked;return Gt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function G_(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=Ps(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function j_(t,e){e=e.checked,e!=null&&ag(t,"checked",e,!1)}function bg(t,e){j_(t,e);var n=Ps(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Eg(t,e.type,n):e.hasOwnProperty("defaultValue")&&Eg(t,e.type,Ps(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function W_(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Eg(t,e,n){(e!=="number"||ef(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var ku=Array.isArray;function Ha(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+Ps(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function Tg(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ye(91));return Gt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function q_(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(ye(92));if(ku(n)){if(1<n.length)throw Error(ye(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Ps(n)}}function K_(t,e){var n=Ps(e.value),i=Ps(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function Y_(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function X_(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Sg(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?X_(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var tf,Q_=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(tf=tf||document.createElement("div"),tf.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=tf.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Du(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Ou={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},h7=["Webkit","ms","Moz","O"];Object.keys(Ou).forEach(function(t){h7.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Ou[e]=Ou[t]})});function Z_(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Ou.hasOwnProperty(t)&&Ou[t]?(""+e).trim():e+"px"}function J_(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=Z_(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var p7=Gt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function xg(t,e){if(e){if(p7[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ye(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ye(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ye(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ye(62))}}function wg(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _g=null;function Ag(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Cg=null,$a=null,za=null;function eA(t){if(t=nc(t)){if(typeof Cg!="function")throw Error(ye(280));var e=t.stateNode;e&&(e=_f(e),Cg(t.stateNode,t.type,e))}}function tA(t){$a?za?za.push(t):za=[t]:$a=t}function nA(){if($a){var t=$a,e=za;if(za=$a=null,eA(t),e)for(t=0;t<e.length;t++)eA(e[t])}}function iA(t,e){return t(e)}function rA(){}var Ig=!1;function sA(t,e,n){if(Ig)return t(e,n);Ig=!0;try{return iA(t,e,n)}finally{Ig=!1,($a!==null||za!==null)&&(rA(),nA())}}function Nu(t,e){var n=t.stateNode;if(n===null)return null;var i=_f(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(ye(231,e,typeof n));return n}var Rg=!1;if(Xr)try{var Mu={};Object.defineProperty(Mu,"passive",{get:function(){Rg=!0}}),window.addEventListener("test",Mu,Mu),window.removeEventListener("test",Mu,Mu)}catch{Rg=!1}function m7(t,e,n,i,r,s,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(c){this.onError(c)}}var Fu=!1,nf=null,rf=!1,Lg=null,g7={onError:function(t){Fu=!0,nf=t}};function y7(t,e,n,i,r,s,o,a,l){Fu=!1,nf=null,m7.apply(g7,arguments)}function v7(t,e,n,i,r,s,o,a,l){if(y7.apply(this,arguments),Fu){if(Fu){var u=nf;Fu=!1,nf=null}else throw Error(ye(198));rf||(rf=!0,Lg=u)}}function Oo(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function oA(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function aA(t){if(Oo(t)!==t)throw Error(ye(188))}function b7(t){var e=t.alternate;if(!e){if(e=Oo(t),e===null)throw Error(ye(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return aA(r),t;if(s===i)return aA(r),e;s=s.sibling}throw Error(ye(188))}if(n.return!==i.return)n=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,i=s;break}if(a===i){o=!0,i=r,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,i=r;break}if(a===i){o=!0,i=s,n=r;break}a=a.sibling}if(!o)throw Error(ye(189))}}if(n.alternate!==i)throw Error(ye(190))}if(n.tag!==3)throw Error(ye(188));return n.stateNode.current===n?t:e}function lA(t){return t=b7(t),t!==null?uA(t):null}function uA(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=uA(t);if(e!==null)return e;t=t.sibling}return null}var cA=di.unstable_scheduleCallback,dA=di.unstable_cancelCallback,E7=di.unstable_shouldYield,T7=di.unstable_requestPaint,Zt=di.unstable_now,S7=di.unstable_getCurrentPriorityLevel,Pg=di.unstable_ImmediatePriority,fA=di.unstable_UserBlockingPriority,sf=di.unstable_NormalPriority,x7=di.unstable_LowPriority,hA=di.unstable_IdlePriority,of=null,pr=null;function w7(t){if(pr&&typeof pr.onCommitFiberRoot=="function")try{pr.onCommitFiberRoot(of,t,void 0,(t.current.flags&128)===128)}catch{}}var ji=Math.clz32?Math.clz32:C7,_7=Math.log,A7=Math.LN2;function C7(t){return t>>>=0,t===0?32:31-(_7(t)/A7|0)|0}var af=64,lf=4194304;function Bu(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function uf(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?i=Bu(a):(s&=o,s!==0&&(i=Bu(s)))}else o=n&~r,o!==0?i=Bu(o):s!==0&&(i=Bu(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-ji(e),r=1<<n,i|=t[n],e&=~r;return i}function I7(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function R7(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-ji(s),a=1<<o,l=r[o];l===-1?(!(a&n)||a&i)&&(r[o]=I7(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function kg(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function pA(){var t=af;return af<<=1,!(af&4194240)&&(af=64),t}function Dg(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Uu(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-ji(e),t[e]=n}function L7(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-ji(n),s=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~s}}function Og(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-ji(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var yt=0;function mA(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var gA,Ng,yA,vA,bA,Mg=!1,cf=[],ks=null,Ds=null,Os=null,Hu=new Map,$u=new Map,Ns=[],P7="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function EA(t,e){switch(t){case"focusin":case"focusout":ks=null;break;case"dragenter":case"dragleave":Ds=null;break;case"mouseover":case"mouseout":Os=null;break;case"pointerover":case"pointerout":Hu.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":$u.delete(e.pointerId)}}function zu(t,e,n,i,r,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=nc(e),e!==null&&Ng(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function k7(t,e,n,i,r){switch(e){case"focusin":return ks=zu(ks,t,e,n,i,r),!0;case"dragenter":return Ds=zu(Ds,t,e,n,i,r),!0;case"mouseover":return Os=zu(Os,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return Hu.set(s,zu(Hu.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,$u.set(s,zu($u.get(s)||null,t,e,n,i,r)),!0}return!1}function TA(t){var e=No(t.target);if(e!==null){var n=Oo(e);if(n!==null){if(e=n.tag,e===13){if(e=oA(n),e!==null){t.blockedOn=e,bA(t.priority,function(){yA(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function df(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Bg(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);_g=i,n.target.dispatchEvent(i),_g=null}else return e=nc(n),e!==null&&Ng(e),t.blockedOn=n,!1;e.shift()}return!0}function SA(t,e,n){df(t)&&n.delete(e)}function D7(){Mg=!1,ks!==null&&df(ks)&&(ks=null),Ds!==null&&df(Ds)&&(Ds=null),Os!==null&&df(Os)&&(Os=null),Hu.forEach(SA),$u.forEach(SA)}function Vu(t,e){t.blockedOn===e&&(t.blockedOn=null,Mg||(Mg=!0,di.unstable_scheduleCallback(di.unstable_NormalPriority,D7)))}function Gu(t){function e(r){return Vu(r,t)}if(0<cf.length){Vu(cf[0],t);for(var n=1;n<cf.length;n++){var i=cf[n];i.blockedOn===t&&(i.blockedOn=null)}}for(ks!==null&&Vu(ks,t),Ds!==null&&Vu(Ds,t),Os!==null&&Vu(Os,t),Hu.forEach(e),$u.forEach(e),n=0;n<Ns.length;n++)i=Ns[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<Ns.length&&(n=Ns[0],n.blockedOn===null);)TA(n),n.blockedOn===null&&Ns.shift()}var Va=Qr.ReactCurrentBatchConfig,ff=!0;function O7(t,e,n,i){var r=yt,s=Va.transition;Va.transition=null;try{yt=1,Fg(t,e,n,i)}finally{yt=r,Va.transition=s}}function N7(t,e,n,i){var r=yt,s=Va.transition;Va.transition=null;try{yt=4,Fg(t,e,n,i)}finally{yt=r,Va.transition=s}}function Fg(t,e,n,i){if(ff){var r=Bg(t,e,n,i);if(r===null)ty(t,e,i,hf,n),EA(t,i);else if(k7(r,t,e,n,i))i.stopPropagation();else if(EA(t,i),e&4&&-1<P7.indexOf(t)){for(;r!==null;){var s=nc(r);if(s!==null&&gA(s),s=Bg(t,e,n,i),s===null&&ty(t,e,i,hf,n),s===r)break;r=s}r!==null&&i.stopPropagation()}else ty(t,e,i,null,n)}}var hf=null;function Bg(t,e,n,i){if(hf=null,t=Ag(i),t=No(t),t!==null)if(e=Oo(t),e===null)t=null;else if(n=e.tag,n===13){if(t=oA(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return hf=t,null}function xA(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(S7()){case Pg:return 1;case fA:return 4;case sf:case x7:return 16;case hA:return 536870912;default:return 16}default:return 16}}var Ms=null,Ug=null,pf=null;function wA(){if(pf)return pf;var t,e=Ug,n=e.length,i,r="value"in Ms?Ms.value:Ms.textContent,s=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(i=1;i<=o&&e[n-i]===r[s-i];i++);return pf=r.slice(t,1<i?1-i:void 0)}function mf(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function gf(){return!0}function _A(){return!1}function fi(t){function e(n,i,r,s,o){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?gf:_A,this.isPropagationStopped=_A,this}return Gt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=gf)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=gf)},persist:function(){},isPersistent:gf}),e}var Ga={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Hg=fi(Ga),ju=Gt({},Ga,{view:0,detail:0}),M7=fi(ju),$g,zg,Wu,yf=Gt({},ju,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Gg,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Wu&&(Wu&&t.type==="mousemove"?($g=t.screenX-Wu.screenX,zg=t.screenY-Wu.screenY):zg=$g=0,Wu=t),$g)},movementY:function(t){return"movementY"in t?t.movementY:zg}}),AA=fi(yf),F7=Gt({},yf,{dataTransfer:0}),B7=fi(F7),U7=Gt({},ju,{relatedTarget:0}),Vg=fi(U7),H7=Gt({},Ga,{animationName:0,elapsedTime:0,pseudoElement:0}),$7=fi(H7),z7=Gt({},Ga,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),V7=fi(z7),G7=Gt({},Ga,{data:0}),CA=fi(G7),j7={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},W7={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},q7={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function K7(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=q7[t])?!!e[t]:!1}function Gg(){return K7}var Y7=Gt({},ju,{key:function(t){if(t.key){var e=j7[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=mf(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?W7[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Gg,charCode:function(t){return t.type==="keypress"?mf(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?mf(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),X7=fi(Y7),Q7=Gt({},yf,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),IA=fi(Q7),Z7=Gt({},ju,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Gg}),J7=fi(Z7),eH=Gt({},Ga,{propertyName:0,elapsedTime:0,pseudoElement:0}),tH=fi(eH),nH=Gt({},yf,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),iH=fi(nH),rH=[9,13,27,32],jg=Xr&&"CompositionEvent"in window,qu=null;Xr&&"documentMode"in document&&(qu=document.documentMode);var sH=Xr&&"TextEvent"in window&&!qu,RA=Xr&&(!jg||qu&&8<qu&&11>=qu),LA=" ",PA=!1;function kA(t,e){switch(t){case"keyup":return rH.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function DA(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var ja=!1;function oH(t,e){switch(t){case"compositionend":return DA(e);case"keypress":return e.which!==32?null:(PA=!0,LA);case"textInput":return t=e.data,t===LA&&PA?null:t;default:return null}}function aH(t,e){if(ja)return t==="compositionend"||!jg&&kA(t,e)?(t=wA(),pf=Ug=Ms=null,ja=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return RA&&e.locale!=="ko"?null:e.data;default:return null}}var lH={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function OA(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!lH[t.type]:e==="textarea"}function NA(t,e,n,i){tA(i),e=Sf(e,"onChange"),0<e.length&&(n=new Hg("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var Ku=null,Yu=null;function uH(t){JA(t,0)}function vf(t){var e=Xa(t);if(V_(e))return t}function cH(t,e){if(t==="change")return e}var MA=!1;if(Xr){var Wg;if(Xr){var qg="oninput"in document;if(!qg){var FA=document.createElement("div");FA.setAttribute("oninput","return;"),qg=typeof FA.oninput=="function"}Wg=qg}else Wg=!1;MA=Wg&&(!document.documentMode||9<document.documentMode)}function BA(){Ku&&(Ku.detachEvent("onpropertychange",UA),Yu=Ku=null)}function UA(t){if(t.propertyName==="value"&&vf(Yu)){var e=[];NA(e,Yu,t,Ag(t)),sA(uH,e)}}function dH(t,e,n){t==="focusin"?(BA(),Ku=e,Yu=n,Ku.attachEvent("onpropertychange",UA)):t==="focusout"&&BA()}function fH(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return vf(Yu)}function hH(t,e){if(t==="click")return vf(e)}function pH(t,e){if(t==="input"||t==="change")return vf(e)}function mH(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Wi=typeof Object.is=="function"?Object.is:mH;function Xu(t,e){if(Wi(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!rg.call(e,r)||!Wi(t[r],e[r]))return!1}return!0}function HA(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function $A(t,e){var n=HA(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=HA(n)}}function zA(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?zA(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function VA(){for(var t=window,e=ef();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=ef(t.document)}return e}function Kg(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function gH(t){var e=VA(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&zA(n.ownerDocument.documentElement,n)){if(i!==null&&Kg(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!t.extend&&s>i&&(r=i,i=s,s=r),r=$A(n,s);var o=$A(n,i);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var yH=Xr&&"documentMode"in document&&11>=document.documentMode,Wa=null,Yg=null,Qu=null,Xg=!1;function GA(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Xg||Wa==null||Wa!==ef(i)||(i=Wa,"selectionStart"in i&&Kg(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Qu&&Xu(Qu,i)||(Qu=i,i=Sf(Yg,"onSelect"),0<i.length&&(e=new Hg("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=Wa)))}function bf(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var qa={animationend:bf("Animation","AnimationEnd"),animationiteration:bf("Animation","AnimationIteration"),animationstart:bf("Animation","AnimationStart"),transitionend:bf("Transition","TransitionEnd")},Qg={},jA={};Xr&&(jA=document.createElement("div").style,"AnimationEvent"in window||(delete qa.animationend.animation,delete qa.animationiteration.animation,delete qa.animationstart.animation),"TransitionEvent"in window||delete qa.transitionend.transition);function Ef(t){if(Qg[t])return Qg[t];if(!qa[t])return t;var e=qa[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in jA)return Qg[t]=e[n];return t}var WA=Ef("animationend"),qA=Ef("animationiteration"),KA=Ef("animationstart"),YA=Ef("transitionend"),XA=new Map,QA="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Fs(t,e){XA.set(t,e),Do(e,[t])}for(var Zg=0;Zg<QA.length;Zg++){var Jg=QA[Zg],vH=Jg.toLowerCase(),bH=Jg[0].toUpperCase()+Jg.slice(1);Fs(vH,"on"+bH)}Fs(WA,"onAnimationEnd"),Fs(qA,"onAnimationIteration"),Fs(KA,"onAnimationStart"),Fs("dblclick","onDoubleClick"),Fs("focusin","onFocus"),Fs("focusout","onBlur"),Fs(YA,"onTransitionEnd"),Fa("onMouseEnter",["mouseout","mouseover"]),Fa("onMouseLeave",["mouseout","mouseover"]),Fa("onPointerEnter",["pointerout","pointerover"]),Fa("onPointerLeave",["pointerout","pointerover"]),Do("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Do("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Do("onBeforeInput",["compositionend","keypress","textInput","paste"]),Do("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Do("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Do("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Zu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),EH=new Set("cancel close invalid load scroll toggle".split(" ").concat(Zu));function ZA(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,v7(i,e,void 0,t),t.currentTarget=null}function JA(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==s&&r.isPropagationStopped())break e;ZA(r,a,u),s=l}else for(o=0;o<i.length;o++){if(a=i[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==s&&r.isPropagationStopped())break e;ZA(r,a,u),s=l}}}if(rf)throw t=Lg,rf=!1,Lg=null,t}function Mt(t,e){var n=e[ay];n===void 0&&(n=e[ay]=new Set);var i=t+"__bubble";n.has(i)||(e2(e,t,2,!1),n.add(i))}function ey(t,e,n){var i=0;e&&(i|=4),e2(n,t,i,e)}var Tf="_reactListening"+Math.random().toString(36).slice(2);function Ju(t){if(!t[Tf]){t[Tf]=!0,N_.forEach(function(n){n!=="selectionchange"&&(EH.has(n)||ey(n,!1,t),ey(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Tf]||(e[Tf]=!0,ey("selectionchange",!1,e))}}function e2(t,e,n,i){switch(xA(e)){case 1:var r=O7;break;case 4:r=N7;break;default:r=Fg}n=r.bind(null,e,n,t),r=void 0,!Rg||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function ty(t,e,n,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;o=o.return}for(;a!==null;){if(o=No(a),o===null)return;if(l=o.tag,l===5||l===6){i=s=o;continue e}a=a.parentNode}}i=i.return}sA(function(){var u=s,c=Ag(n),d=[];e:{var f=XA.get(t);if(f!==void 0){var h=Hg,p=t;switch(t){case"keypress":if(mf(n)===0)break e;case"keydown":case"keyup":h=X7;break;case"focusin":p="focus",h=Vg;break;case"focusout":p="blur",h=Vg;break;case"beforeblur":case"afterblur":h=Vg;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=AA;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=B7;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=J7;break;case WA:case qA:case KA:h=$7;break;case YA:h=tH;break;case"scroll":h=M7;break;case"wheel":h=iH;break;case"copy":case"cut":case"paste":h=V7;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=IA}var m=(e&4)!==0,y=!m&&t==="scroll",g=m?f!==null?f+"Capture":null:f;m=[];for(var v=u,b;v!==null;){b=v;var T=b.stateNode;if(b.tag===5&&T!==null&&(b=T,g!==null&&(T=Nu(v,g),T!=null&&m.push(ec(v,T,b)))),y)break;v=v.return}0<m.length&&(f=new h(f,p,null,n,c),d.push({event:f,listeners:m}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",h=t==="mouseout"||t==="pointerout",f&&n!==_g&&(p=n.relatedTarget||n.fromElement)&&(No(p)||p[Zr]))break e;if((h||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,h?(p=n.relatedTarget||n.toElement,h=u,p=p?No(p):null,p!==null&&(y=Oo(p),p!==y||p.tag!==5&&p.tag!==6)&&(p=null)):(h=null,p=u),h!==p)){if(m=AA,T="onMouseLeave",g="onMouseEnter",v="mouse",(t==="pointerout"||t==="pointerover")&&(m=IA,T="onPointerLeave",g="onPointerEnter",v="pointer"),y=h==null?f:Xa(h),b=p==null?f:Xa(p),f=new m(T,v+"leave",h,n,c),f.target=y,f.relatedTarget=b,T=null,No(c)===u&&(m=new m(g,v+"enter",p,n,c),m.target=b,m.relatedTarget=y,T=m),y=T,h&&p)t:{for(m=h,g=p,v=0,b=m;b;b=Ka(b))v++;for(b=0,T=g;T;T=Ka(T))b++;for(;0<v-b;)m=Ka(m),v--;for(;0<b-v;)g=Ka(g),b--;for(;v--;){if(m===g||g!==null&&m===g.alternate)break t;m=Ka(m),g=Ka(g)}m=null}else m=null;h!==null&&t2(d,f,h,m,!1),p!==null&&y!==null&&t2(d,y,p,m,!0)}}e:{if(f=u?Xa(u):window,h=f.nodeName&&f.nodeName.toLowerCase(),h==="select"||h==="input"&&f.type==="file")var S=cH;else if(OA(f))if(MA)S=pH;else{S=fH;var _=dH}else(h=f.nodeName)&&h.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(S=hH);if(S&&(S=S(t,u))){NA(d,S,n,c);break e}_&&_(t,f,u),t==="focusout"&&(_=f._wrapperState)&&_.controlled&&f.type==="number"&&Eg(f,"number",f.value)}switch(_=u?Xa(u):window,t){case"focusin":(OA(_)||_.contentEditable==="true")&&(Wa=_,Yg=u,Qu=null);break;case"focusout":Qu=Yg=Wa=null;break;case"mousedown":Xg=!0;break;case"contextmenu":case"mouseup":case"dragend":Xg=!1,GA(d,n,c);break;case"selectionchange":if(yH)break;case"keydown":case"keyup":GA(d,n,c)}var A;if(jg)e:{switch(t){case"compositionstart":var P="onCompositionStart";break e;case"compositionend":P="onCompositionEnd";break e;case"compositionupdate":P="onCompositionUpdate";break e}P=void 0}else ja?kA(t,n)&&(P="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(P="onCompositionStart");P&&(RA&&n.locale!=="ko"&&(ja||P!=="onCompositionStart"?P==="onCompositionEnd"&&ja&&(A=wA()):(Ms=c,Ug="value"in Ms?Ms.value:Ms.textContent,ja=!0)),_=Sf(u,P),0<_.length&&(P=new CA(P,t,null,n,c),d.push({event:P,listeners:_}),A?P.data=A:(A=DA(n),A!==null&&(P.data=A)))),(A=sH?oH(t,n):aH(t,n))&&(u=Sf(u,"onBeforeInput"),0<u.length&&(c=new CA("onBeforeInput","beforeinput",null,n,c),d.push({event:c,listeners:u}),c.data=A))}JA(d,e)})}function ec(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Sf(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=Nu(t,n),s!=null&&i.unshift(ec(t,s,r)),s=Nu(t,e),s!=null&&i.push(ec(t,s,r))),t=t.return}return i}function Ka(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function t2(t,e,n,i,r){for(var s=e._reactName,o=[];n!==null&&n!==i;){var a=n,l=a.alternate,u=a.stateNode;if(l!==null&&l===i)break;a.tag===5&&u!==null&&(a=u,r?(l=Nu(n,s),l!=null&&o.unshift(ec(n,l,a))):r||(l=Nu(n,s),l!=null&&o.push(ec(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var TH=/\r\n?/g,SH=/\u0000|\uFFFD/g;function n2(t){return(typeof t=="string"?t:""+t).replace(TH,`
`).replace(SH,"")}function xf(t,e,n){if(e=n2(e),n2(t)!==e&&n)throw Error(ye(425))}function wf(){}var ny=null,iy=null;function ry(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var sy=typeof setTimeout=="function"?setTimeout:void 0,xH=typeof clearTimeout=="function"?clearTimeout:void 0,i2=typeof Promise=="function"?Promise:void 0,wH=typeof queueMicrotask=="function"?queueMicrotask:typeof i2<"u"?function(t){return i2.resolve(null).then(t).catch(_H)}:sy;function _H(t){setTimeout(function(){throw t})}function oy(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),Gu(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);Gu(e)}function Bs(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function r2(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Ya=Math.random().toString(36).slice(2),mr="__reactFiber$"+Ya,tc="__reactProps$"+Ya,Zr="__reactContainer$"+Ya,ay="__reactEvents$"+Ya,AH="__reactListeners$"+Ya,CH="__reactHandles$"+Ya;function No(t){var e=t[mr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Zr]||n[mr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=r2(t);t!==null;){if(n=t[mr])return n;t=r2(t)}return e}t=n,n=t.parentNode}return null}function nc(t){return t=t[mr]||t[Zr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Xa(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(ye(33))}function _f(t){return t[tc]||null}var ly=[],Qa=-1;function Us(t){return{current:t}}function Ft(t){0>Qa||(t.current=ly[Qa],ly[Qa]=null,Qa--)}function Rt(t,e){Qa++,ly[Qa]=t.current,t.current=e}var Hs={},Ln=Us(Hs),Wn=Us(!1),Mo=Hs;function Za(t,e){var n=t.type.contextTypes;if(!n)return Hs;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in n)r[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function qn(t){return t=t.childContextTypes,t!=null}function Af(){Ft(Wn),Ft(Ln)}function s2(t,e,n){if(Ln.current!==Hs)throw Error(ye(168));Rt(Ln,e),Rt(Wn,n)}function o2(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(ye(108,d7(t)||"Unknown",r));return Gt({},n,i)}function Cf(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Hs,Mo=Ln.current,Rt(Ln,t),Rt(Wn,Wn.current),!0}function a2(t,e,n){var i=t.stateNode;if(!i)throw Error(ye(169));n?(t=o2(t,e,Mo),i.__reactInternalMemoizedMergedChildContext=t,Ft(Wn),Ft(Ln),Rt(Ln,t)):Ft(Wn),Rt(Wn,n)}var Jr=null,If=!1,uy=!1;function l2(t){Jr===null?Jr=[t]:Jr.push(t)}function IH(t){If=!0,l2(t)}function $s(){if(!uy&&Jr!==null){uy=!0;var t=0,e=yt;try{var n=Jr;for(yt=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}Jr=null,If=!1}catch(r){throw Jr!==null&&(Jr=Jr.slice(t+1)),cA(Pg,$s),r}finally{yt=e,uy=!1}}return null}var Ja=[],el=0,Rf=null,Lf=0,Pi=[],ki=0,Fo=null,es=1,ts="";function Bo(t,e){Ja[el++]=Lf,Ja[el++]=Rf,Rf=t,Lf=e}function u2(t,e,n){Pi[ki++]=es,Pi[ki++]=ts,Pi[ki++]=Fo,Fo=t;var i=es;t=ts;var r=32-ji(i)-1;i&=~(1<<r),n+=1;var s=32-ji(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,es=1<<32-ji(e)+r|n<<r|i,ts=s+t}else es=1<<s|n<<r|i,ts=t}function cy(t){t.return!==null&&(Bo(t,1),u2(t,1,0))}function dy(t){for(;t===Rf;)Rf=Ja[--el],Ja[el]=null,Lf=Ja[--el],Ja[el]=null;for(;t===Fo;)Fo=Pi[--ki],Pi[ki]=null,ts=Pi[--ki],Pi[ki]=null,es=Pi[--ki],Pi[ki]=null}var hi=null,pi=null,Ht=!1,qi=null;function c2(t,e){var n=Mi(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function d2(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,hi=t,pi=Bs(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,hi=t,pi=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Fo!==null?{id:es,overflow:ts}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Mi(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,hi=t,pi=null,!0):!1;default:return!1}}function fy(t){return(t.mode&1)!==0&&(t.flags&128)===0}function hy(t){if(Ht){var e=pi;if(e){var n=e;if(!d2(t,e)){if(fy(t))throw Error(ye(418));e=Bs(n.nextSibling);var i=hi;e&&d2(t,e)?c2(i,n):(t.flags=t.flags&-4097|2,Ht=!1,hi=t)}}else{if(fy(t))throw Error(ye(418));t.flags=t.flags&-4097|2,Ht=!1,hi=t}}}function f2(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;hi=t}function Pf(t){if(t!==hi)return!1;if(!Ht)return f2(t),Ht=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!ry(t.type,t.memoizedProps)),e&&(e=pi)){if(fy(t))throw h2(),Error(ye(418));for(;e;)c2(t,e),e=Bs(e.nextSibling)}if(f2(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(ye(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){pi=Bs(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}pi=null}}else pi=hi?Bs(t.stateNode.nextSibling):null;return!0}function h2(){for(var t=pi;t;)t=Bs(t.nextSibling)}function tl(){pi=hi=null,Ht=!1}function py(t){qi===null?qi=[t]:qi.push(t)}var RH=Qr.ReactCurrentBatchConfig;function ic(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(ye(309));var i=n.stateNode}if(!i)throw Error(ye(147,t));var r=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(ye(284));if(!n._owner)throw Error(ye(290,t))}return t}function kf(t,e){throw t=Object.prototype.toString.call(e),Error(ye(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function p2(t){var e=t._init;return e(t._payload)}function m2(t){function e(g,v){if(t){var b=g.deletions;b===null?(g.deletions=[v],g.flags|=16):b.push(v)}}function n(g,v){if(!t)return null;for(;v!==null;)e(g,v),v=v.sibling;return null}function i(g,v){for(g=new Map;v!==null;)v.key!==null?g.set(v.key,v):g.set(v.index,v),v=v.sibling;return g}function r(g,v){return g=Ys(g,v),g.index=0,g.sibling=null,g}function s(g,v,b){return g.index=b,t?(b=g.alternate,b!==null?(b=b.index,b<v?(g.flags|=2,v):b):(g.flags|=2,v)):(g.flags|=1048576,v)}function o(g){return t&&g.alternate===null&&(g.flags|=2),g}function a(g,v,b,T){return v===null||v.tag!==6?(v=s1(b,g.mode,T),v.return=g,v):(v=r(v,b),v.return=g,v)}function l(g,v,b,T){var S=b.type;return S===Ua?c(g,v,b.props.children,T,b.key):v!==null&&(v.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Ls&&p2(S)===v.type)?(T=r(v,b.props),T.ref=ic(g,v,b),T.return=g,T):(T=nh(b.type,b.key,b.props,null,g.mode,T),T.ref=ic(g,v,b),T.return=g,T)}function u(g,v,b,T){return v===null||v.tag!==4||v.stateNode.containerInfo!==b.containerInfo||v.stateNode.implementation!==b.implementation?(v=o1(b,g.mode,T),v.return=g,v):(v=r(v,b.children||[]),v.return=g,v)}function c(g,v,b,T,S){return v===null||v.tag!==7?(v=Wo(b,g.mode,T,S),v.return=g,v):(v=r(v,b),v.return=g,v)}function d(g,v,b){if(typeof v=="string"&&v!==""||typeof v=="number")return v=s1(""+v,g.mode,b),v.return=g,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Zd:return b=nh(v.type,v.key,v.props,null,g.mode,b),b.ref=ic(g,null,v),b.return=g,b;case Ba:return v=o1(v,g.mode,b),v.return=g,v;case Ls:var T=v._init;return d(g,T(v._payload),b)}if(ku(v)||Lu(v))return v=Wo(v,g.mode,b,null),v.return=g,v;kf(g,v)}return null}function f(g,v,b,T){var S=v!==null?v.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return S!==null?null:a(g,v,""+b,T);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Zd:return b.key===S?l(g,v,b,T):null;case Ba:return b.key===S?u(g,v,b,T):null;case Ls:return S=b._init,f(g,v,S(b._payload),T)}if(ku(b)||Lu(b))return S!==null?null:c(g,v,b,T,null);kf(g,b)}return null}function h(g,v,b,T,S){if(typeof T=="string"&&T!==""||typeof T=="number")return g=g.get(b)||null,a(v,g,""+T,S);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case Zd:return g=g.get(T.key===null?b:T.key)||null,l(v,g,T,S);case Ba:return g=g.get(T.key===null?b:T.key)||null,u(v,g,T,S);case Ls:var _=T._init;return h(g,v,b,_(T._payload),S)}if(ku(T)||Lu(T))return g=g.get(b)||null,c(v,g,T,S,null);kf(v,T)}return null}function p(g,v,b,T){for(var S=null,_=null,A=v,P=v=0,O=null;A!==null&&P<b.length;P++){A.index>P?(O=A,A=null):O=A.sibling;var x=f(g,A,b[P],T);if(x===null){A===null&&(A=O);break}t&&A&&x.alternate===null&&e(g,A),v=s(x,v,P),_===null?S=x:_.sibling=x,_=x,A=O}if(P===b.length)return n(g,A),Ht&&Bo(g,P),S;if(A===null){for(;P<b.length;P++)A=d(g,b[P],T),A!==null&&(v=s(A,v,P),_===null?S=A:_.sibling=A,_=A);return Ht&&Bo(g,P),S}for(A=i(g,A);P<b.length;P++)O=h(A,g,P,b[P],T),O!==null&&(t&&O.alternate!==null&&A.delete(O.key===null?P:O.key),v=s(O,v,P),_===null?S=O:_.sibling=O,_=O);return t&&A.forEach(function(L){return e(g,L)}),Ht&&Bo(g,P),S}function m(g,v,b,T){var S=Lu(b);if(typeof S!="function")throw Error(ye(150));if(b=S.call(b),b==null)throw Error(ye(151));for(var _=S=null,A=v,P=v=0,O=null,x=b.next();A!==null&&!x.done;P++,x=b.next()){A.index>P?(O=A,A=null):O=A.sibling;var L=f(g,A,x.value,T);if(L===null){A===null&&(A=O);break}t&&A&&L.alternate===null&&e(g,A),v=s(L,v,P),_===null?S=L:_.sibling=L,_=L,A=O}if(x.done)return n(g,A),Ht&&Bo(g,P),S;if(A===null){for(;!x.done;P++,x=b.next())x=d(g,x.value,T),x!==null&&(v=s(x,v,P),_===null?S=x:_.sibling=x,_=x);return Ht&&Bo(g,P),S}for(A=i(g,A);!x.done;P++,x=b.next())x=h(A,g,P,x.value,T),x!==null&&(t&&x.alternate!==null&&A.delete(x.key===null?P:x.key),v=s(x,v,P),_===null?S=x:_.sibling=x,_=x);return t&&A.forEach(function(M){return e(g,M)}),Ht&&Bo(g,P),S}function y(g,v,b,T){if(typeof b=="object"&&b!==null&&b.type===Ua&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case Zd:e:{for(var S=b.key,_=v;_!==null;){if(_.key===S){if(S=b.type,S===Ua){if(_.tag===7){n(g,_.sibling),v=r(_,b.props.children),v.return=g,g=v;break e}}else if(_.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Ls&&p2(S)===_.type){n(g,_.sibling),v=r(_,b.props),v.ref=ic(g,_,b),v.return=g,g=v;break e}n(g,_);break}else e(g,_);_=_.sibling}b.type===Ua?(v=Wo(b.props.children,g.mode,T,b.key),v.return=g,g=v):(T=nh(b.type,b.key,b.props,null,g.mode,T),T.ref=ic(g,v,b),T.return=g,g=T)}return o(g);case Ba:e:{for(_=b.key;v!==null;){if(v.key===_)if(v.tag===4&&v.stateNode.containerInfo===b.containerInfo&&v.stateNode.implementation===b.implementation){n(g,v.sibling),v=r(v,b.children||[]),v.return=g,g=v;break e}else{n(g,v);break}else e(g,v);v=v.sibling}v=o1(b,g.mode,T),v.return=g,g=v}return o(g);case Ls:return _=b._init,y(g,v,_(b._payload),T)}if(ku(b))return p(g,v,b,T);if(Lu(b))return m(g,v,b,T);kf(g,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,v!==null&&v.tag===6?(n(g,v.sibling),v=r(v,b),v.return=g,g=v):(n(g,v),v=s1(b,g.mode,T),v.return=g,g=v),o(g)):n(g,v)}return y}var nl=m2(!0),g2=m2(!1),Df=Us(null),Of=null,il=null,my=null;function gy(){my=il=Of=null}function yy(t){var e=Df.current;Ft(Df),t._currentValue=e}function vy(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function rl(t,e){Of=t,my=il=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Kn=!0),t.firstContext=null)}function Di(t){var e=t._currentValue;if(my!==t)if(t={context:t,memoizedValue:e,next:null},il===null){if(Of===null)throw Error(ye(308));il=t,Of.dependencies={lanes:0,firstContext:t}}else il=il.next=t;return e}var Uo=null;function by(t){Uo===null?Uo=[t]:Uo.push(t)}function y2(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,by(e)):(n.next=r.next,r.next=n),e.interleaved=n,ns(t,i)}function ns(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var zs=!1;function Ey(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function v2(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function is(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Vs(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,pt&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,ns(t,n)}return r=i.interleaved,r===null?(e.next=e,by(i)):(e.next=r.next,r.next=e),i.interleaved=e,ns(t,n)}function Nf(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Og(t,n)}}function b2(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?r=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?r=s=e:s=s.next=e}else r=s=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Mf(t,e,n,i){var r=t.updateQueue;zs=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?s=u:o.next=u,o=l;var c=t.alternate;c!==null&&(c=c.updateQueue,a=c.lastBaseUpdate,a!==o&&(a===null?c.firstBaseUpdate=u:a.next=u,c.lastBaseUpdate=l))}if(s!==null){var d=r.baseState;o=0,c=u=l=null,a=s;do{var f=a.lane,h=a.eventTime;if((i&f)===f){c!==null&&(c=c.next={eventTime:h,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=t,m=a;switch(f=e,h=n,m.tag){case 1:if(p=m.payload,typeof p=="function"){d=p.call(h,d,f);break e}d=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=m.payload,f=typeof p=="function"?p.call(h,d,f):p,f==null)break e;d=Gt({},d,f);break e;case 2:zs=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,f=r.effects,f===null?r.effects=[a]:f.push(a))}else h={eventTime:h,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},c===null?(u=c=h,l=d):c=c.next=h,o|=f;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;f=a,a=f.next,f.next=null,r.lastBaseUpdate=f,r.shared.pending=null}}while(!0);if(c===null&&(l=d),r.baseState=l,r.firstBaseUpdate=u,r.lastBaseUpdate=c,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);zo|=o,t.lanes=o,t.memoizedState=d}}function E2(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(ye(191,r));r.call(i)}}}var rc={},gr=Us(rc),sc=Us(rc),oc=Us(rc);function Ho(t){if(t===rc)throw Error(ye(174));return t}function Ty(t,e){switch(Rt(oc,e),Rt(sc,t),Rt(gr,rc),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Sg(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Sg(e,t)}Ft(gr),Rt(gr,e)}function sl(){Ft(gr),Ft(sc),Ft(oc)}function T2(t){Ho(oc.current);var e=Ho(gr.current),n=Sg(e,t.type);e!==n&&(Rt(sc,t),Rt(gr,n))}function Sy(t){sc.current===t&&(Ft(gr),Ft(sc))}var jt=Us(0);function Ff(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var xy=[];function wy(){for(var t=0;t<xy.length;t++)xy[t]._workInProgressVersionPrimary=null;xy.length=0}var Bf=Qr.ReactCurrentDispatcher,_y=Qr.ReactCurrentBatchConfig,$o=0,Wt=null,dn=null,gn=null,Uf=!1,ac=!1,lc=0,LH=0;function Pn(){throw Error(ye(321))}function Ay(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Wi(t[n],e[n]))return!1;return!0}function Cy(t,e,n,i,r,s){if($o=s,Wt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Bf.current=t===null||t.memoizedState===null?OH:NH,t=n(i,r),ac){s=0;do{if(ac=!1,lc=0,25<=s)throw Error(ye(301));s+=1,gn=dn=null,e.updateQueue=null,Bf.current=MH,t=n(i,r)}while(ac)}if(Bf.current=zf,e=dn!==null&&dn.next!==null,$o=0,gn=dn=Wt=null,Uf=!1,e)throw Error(ye(300));return t}function Iy(){var t=lc!==0;return lc=0,t}function yr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return gn===null?Wt.memoizedState=gn=t:gn=gn.next=t,gn}function Oi(){if(dn===null){var t=Wt.alternate;t=t!==null?t.memoizedState:null}else t=dn.next;var e=gn===null?Wt.memoizedState:gn.next;if(e!==null)gn=e,dn=t;else{if(t===null)throw Error(ye(310));dn=t,t={memoizedState:dn.memoizedState,baseState:dn.baseState,baseQueue:dn.baseQueue,queue:dn.queue,next:null},gn===null?Wt.memoizedState=gn=t:gn=gn.next=t}return gn}function uc(t,e){return typeof e=="function"?e(t):e}function Ry(t){var e=Oi(),n=e.queue;if(n===null)throw Error(ye(311));n.lastRenderedReducer=t;var i=dn,r=i.baseQueue,s=n.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,n.pending=null}if(r!==null){s=r.next,i=i.baseState;var a=o=null,l=null,u=s;do{var c=u.lane;if(($o&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:t(i,u.action);else{var d={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=d,o=i):l=l.next=d,Wt.lanes|=c,zo|=c}u=u.next}while(u!==null&&u!==s);l===null?o=i:l.next=a,Wi(i,e.memoizedState)||(Kn=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=l,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do s=r.lane,Wt.lanes|=s,zo|=s,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Ly(t){var e=Oi(),n=e.queue;if(n===null)throw Error(ye(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,s=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do s=t(s,o.action),o=o.next;while(o!==r);Wi(s,e.memoizedState)||(Kn=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,i]}function S2(){}function x2(t,e){var n=Wt,i=Oi(),r=e(),s=!Wi(i.memoizedState,r);if(s&&(i.memoizedState=r,Kn=!0),i=i.queue,Py(A2.bind(null,n,i,t),[t]),i.getSnapshot!==e||s||gn!==null&&gn.memoizedState.tag&1){if(n.flags|=2048,cc(9,_2.bind(null,n,i,r,e),void 0,null),yn===null)throw Error(ye(349));$o&30||w2(n,e,r)}return r}function w2(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Wt.updateQueue,e===null?(e={lastEffect:null,stores:null},Wt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function _2(t,e,n,i){e.value=n,e.getSnapshot=i,C2(e)&&I2(t)}function A2(t,e,n){return n(function(){C2(e)&&I2(t)})}function C2(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Wi(t,n)}catch{return!0}}function I2(t){var e=ns(t,1);e!==null&&Qi(e,t,1,-1)}function R2(t){var e=yr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:uc,lastRenderedState:t},e.queue=t,t=t.dispatch=DH.bind(null,Wt,t),[e.memoizedState,t]}function cc(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=Wt.updateQueue,e===null?(e={lastEffect:null,stores:null},Wt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function L2(){return Oi().memoizedState}function Hf(t,e,n,i){var r=yr();Wt.flags|=t,r.memoizedState=cc(1|e,n,void 0,i===void 0?null:i)}function $f(t,e,n,i){var r=Oi();i=i===void 0?null:i;var s=void 0;if(dn!==null){var o=dn.memoizedState;if(s=o.destroy,i!==null&&Ay(i,o.deps)){r.memoizedState=cc(e,n,s,i);return}}Wt.flags|=t,r.memoizedState=cc(1|e,n,s,i)}function P2(t,e){return Hf(8390656,8,t,e)}function Py(t,e){return $f(2048,8,t,e)}function k2(t,e){return $f(4,2,t,e)}function D2(t,e){return $f(4,4,t,e)}function O2(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function N2(t,e,n){return n=n!=null?n.concat([t]):null,$f(4,4,O2.bind(null,e,t),n)}function ky(){}function M2(t,e){var n=Oi();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Ay(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function F2(t,e){var n=Oi();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Ay(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function B2(t,e,n){return $o&21?(Wi(n,e)||(n=pA(),Wt.lanes|=n,zo|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Kn=!0),t.memoizedState=n)}function PH(t,e){var n=yt;yt=n!==0&&4>n?n:4,t(!0);var i=_y.transition;_y.transition={};try{t(!1),e()}finally{yt=n,_y.transition=i}}function U2(){return Oi().memoizedState}function kH(t,e,n){var i=qs(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},H2(t))$2(e,n);else if(n=y2(t,e,n,i),n!==null){var r=Hn();Qi(n,t,i,r),z2(n,e,i)}}function DH(t,e,n){var i=qs(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(H2(t))$2(e,r);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,Wi(a,o)){var l=e.interleaved;l===null?(r.next=r,by(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}n=y2(t,e,r,i),n!==null&&(r=Hn(),Qi(n,t,i,r),z2(n,e,i))}}function H2(t){var e=t.alternate;return t===Wt||e!==null&&e===Wt}function $2(t,e){ac=Uf=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function z2(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Og(t,n)}}var zf={readContext:Di,useCallback:Pn,useContext:Pn,useEffect:Pn,useImperativeHandle:Pn,useInsertionEffect:Pn,useLayoutEffect:Pn,useMemo:Pn,useReducer:Pn,useRef:Pn,useState:Pn,useDebugValue:Pn,useDeferredValue:Pn,useTransition:Pn,useMutableSource:Pn,useSyncExternalStore:Pn,useId:Pn,unstable_isNewReconciler:!1},OH={readContext:Di,useCallback:function(t,e){return yr().memoizedState=[t,e===void 0?null:e],t},useContext:Di,useEffect:P2,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Hf(4194308,4,O2.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Hf(4194308,4,t,e)},useInsertionEffect:function(t,e){return Hf(4,2,t,e)},useMemo:function(t,e){var n=yr();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=yr();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=kH.bind(null,Wt,t),[i.memoizedState,t]},useRef:function(t){var e=yr();return t={current:t},e.memoizedState=t},useState:R2,useDebugValue:ky,useDeferredValue:function(t){return yr().memoizedState=t},useTransition:function(){var t=R2(!1),e=t[0];return t=PH.bind(null,t[1]),yr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=Wt,r=yr();if(Ht){if(n===void 0)throw Error(ye(407));n=n()}else{if(n=e(),yn===null)throw Error(ye(349));$o&30||w2(i,e,n)}r.memoizedState=n;var s={value:n,getSnapshot:e};return r.queue=s,P2(A2.bind(null,i,s,t),[t]),i.flags|=2048,cc(9,_2.bind(null,i,s,n,e),void 0,null),n},useId:function(){var t=yr(),e=yn.identifierPrefix;if(Ht){var n=ts,i=es;n=(i&~(1<<32-ji(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=lc++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=LH++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},NH={readContext:Di,useCallback:M2,useContext:Di,useEffect:Py,useImperativeHandle:N2,useInsertionEffect:k2,useLayoutEffect:D2,useMemo:F2,useReducer:Ry,useRef:L2,useState:function(){return Ry(uc)},useDebugValue:ky,useDeferredValue:function(t){var e=Oi();return B2(e,dn.memoizedState,t)},useTransition:function(){var t=Ry(uc)[0],e=Oi().memoizedState;return[t,e]},useMutableSource:S2,useSyncExternalStore:x2,useId:U2,unstable_isNewReconciler:!1},MH={readContext:Di,useCallback:M2,useContext:Di,useEffect:Py,useImperativeHandle:N2,useInsertionEffect:k2,useLayoutEffect:D2,useMemo:F2,useReducer:Ly,useRef:L2,useState:function(){return Ly(uc)},useDebugValue:ky,useDeferredValue:function(t){var e=Oi();return dn===null?e.memoizedState=t:B2(e,dn.memoizedState,t)},useTransition:function(){var t=Ly(uc)[0],e=Oi().memoizedState;return[t,e]},useMutableSource:S2,useSyncExternalStore:x2,useId:U2,unstable_isNewReconciler:!1};function Ki(t,e){if(t&&t.defaultProps){e=Gt({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Dy(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:Gt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Vf={isMounted:function(t){return(t=t._reactInternals)?Oo(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=Hn(),r=qs(t),s=is(i,r);s.payload=e,n!=null&&(s.callback=n),e=Vs(t,s,r),e!==null&&(Qi(e,t,r,i),Nf(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=Hn(),r=qs(t),s=is(i,r);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=Vs(t,s,r),e!==null&&(Qi(e,t,r,i),Nf(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Hn(),i=qs(t),r=is(n,i);r.tag=2,e!=null&&(r.callback=e),e=Vs(t,r,i),e!==null&&(Qi(e,t,i,n),Nf(e,t,i))}};function V2(t,e,n,i,r,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!Xu(n,i)||!Xu(r,s):!0}function G2(t,e,n){var i=!1,r=Hs,s=e.contextType;return typeof s=="object"&&s!==null?s=Di(s):(r=qn(e)?Mo:Ln.current,i=e.contextTypes,s=(i=i!=null)?Za(t,r):Hs),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Vf,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=s),e}function j2(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&Vf.enqueueReplaceState(e,e.state,null)}function Oy(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},Ey(t);var s=e.contextType;typeof s=="object"&&s!==null?r.context=Di(s):(s=qn(e)?Mo:Ln.current,r.context=Za(t,s)),r.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Dy(t,e,s,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&Vf.enqueueReplaceState(r,r.state,null),Mf(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function ol(t,e){try{var n="",i=e;do n+=c7(i),i=i.return;while(i);var r=n}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:r,digest:null}}function Ny(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function My(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var FH=typeof WeakMap=="function"?WeakMap:Map;function W2(t,e,n){n=is(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){Xf||(Xf=!0,Qy=i),My(t,e)},n}function q2(t,e,n){n=is(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){My(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){My(t,e),typeof i!="function"&&(js===null?js=new Set([this]):js.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function K2(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new FH;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=QH.bind(null,t,e,n),e.then(t,t))}function Y2(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function X2(t,e,n,i,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=is(-1,1),e.tag=2,Vs(n,e,1))),n.lanes|=1),t)}var BH=Qr.ReactCurrentOwner,Kn=!1;function Un(t,e,n,i){e.child=t===null?g2(e,null,n,i):nl(e,t.child,n,i)}function Q2(t,e,n,i,r){n=n.render;var s=e.ref;return rl(e,r),i=Cy(t,e,n,i,s,r),n=Iy(),t!==null&&!Kn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,rs(t,e,r)):(Ht&&n&&cy(e),e.flags|=1,Un(t,e,i,r),e.child)}function Z2(t,e,n,i,r){if(t===null){var s=n.type;return typeof s=="function"&&!r1(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,J2(t,e,s,i,r)):(t=nh(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&r)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:Xu,n(o,i)&&t.ref===e.ref)return rs(t,e,r)}return e.flags|=1,t=Ys(s,i),t.ref=e.ref,t.return=e,e.child=t}function J2(t,e,n,i,r){if(t!==null){var s=t.memoizedProps;if(Xu(s,i)&&t.ref===e.ref)if(Kn=!1,e.pendingProps=i=s,(t.lanes&r)!==0)t.flags&131072&&(Kn=!0);else return e.lanes=t.lanes,rs(t,e,r)}return Fy(t,e,n,i,r)}function eC(t,e,n){var i=e.pendingProps,r=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Rt(ll,mi),mi|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Rt(ll,mi),mi|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:n,Rt(ll,mi),mi|=i}else s!==null?(i=s.baseLanes|n,e.memoizedState=null):i=n,Rt(ll,mi),mi|=i;return Un(t,e,r,n),e.child}function tC(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Fy(t,e,n,i,r){var s=qn(n)?Mo:Ln.current;return s=Za(e,s),rl(e,r),n=Cy(t,e,n,i,s,r),i=Iy(),t!==null&&!Kn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,rs(t,e,r)):(Ht&&i&&cy(e),e.flags|=1,Un(t,e,n,r),e.child)}function nC(t,e,n,i,r){if(qn(n)){var s=!0;Cf(e)}else s=!1;if(rl(e,r),e.stateNode===null)jf(t,e),G2(e,n,i),Oy(e,n,i,r),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=n.contextType;typeof u=="object"&&u!==null?u=Di(u):(u=qn(n)?Mo:Ln.current,u=Za(e,u));var c=n.getDerivedStateFromProps,d=typeof c=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||l!==u)&&j2(e,o,i,u),zs=!1;var f=e.memoizedState;o.state=f,Mf(e,i,o,r),l=e.memoizedState,a!==i||f!==l||Wn.current||zs?(typeof c=="function"&&(Dy(e,n,c,i),l=e.memoizedState),(a=zs||V2(e,n,a,i,f,l,u))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=u,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,v2(t,e),a=e.memoizedProps,u=e.type===e.elementType?a:Ki(e.type,a),o.props=u,d=e.pendingProps,f=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=Di(l):(l=qn(n)?Mo:Ln.current,l=Za(e,l));var h=n.getDerivedStateFromProps;(c=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||f!==l)&&j2(e,o,i,l),zs=!1,f=e.memoizedState,o.state=f,Mf(e,i,o,r);var p=e.memoizedState;a!==d||f!==p||Wn.current||zs?(typeof h=="function"&&(Dy(e,n,h,i),p=e.memoizedState),(u=zs||V2(e,n,u,i,f,p,l)||!1)?(c||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,p,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,p,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=p),o.props=i,o.state=p,o.context=l,i=u):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),i=!1)}return By(t,e,n,i,s,r)}function By(t,e,n,i,r,s){tC(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return r&&a2(e,n,!1),rs(t,e,s);i=e.stateNode,BH.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=nl(e,t.child,null,s),e.child=nl(e,null,a,s)):Un(t,e,a,s),e.memoizedState=i.state,r&&a2(e,n,!0),e.child}function iC(t){var e=t.stateNode;e.pendingContext?s2(t,e.pendingContext,e.pendingContext!==e.context):e.context&&s2(t,e.context,!1),Ty(t,e.containerInfo)}function rC(t,e,n,i,r){return tl(),py(r),e.flags|=256,Un(t,e,n,i),e.child}var Uy={dehydrated:null,treeContext:null,retryLane:0};function Hy(t){return{baseLanes:t,cachePool:null,transitions:null}}function sC(t,e,n){var i=e.pendingProps,r=jt.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),Rt(jt,r&1),t===null)return hy(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=ih(o,i,0,null),t=Wo(t,i,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=Hy(n),e.memoizedState=Uy,t):$y(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return UH(t,e,o,i,a,r,n);if(s){s=i.fallback,o=e.mode,r=t.child,a=r.sibling;var l={mode:"hidden",children:i.children};return!(o&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=Ys(r,l),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=Ys(a,s):(s=Wo(s,o,n,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?Hy(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=Uy,i}return s=t.child,t=s.sibling,i=Ys(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function $y(t,e){return e=ih({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Gf(t,e,n,i){return i!==null&&py(i),nl(e,t.child,null,n),t=$y(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function UH(t,e,n,i,r,s,o){if(n)return e.flags&256?(e.flags&=-257,i=Ny(Error(ye(422))),Gf(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=ih({mode:"visible",children:i.children},r,0,null),s=Wo(s,r,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&nl(e,t.child,null,o),e.child.memoizedState=Hy(o),e.memoizedState=Uy,s);if(!(e.mode&1))return Gf(t,e,o,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(ye(419)),i=Ny(s,i,void 0),Gf(t,e,o,i)}if(a=(o&t.childLanes)!==0,Kn||a){if(i=yn,i!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|o)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,ns(t,r),Qi(i,t,r,-1))}return i1(),i=Ny(Error(ye(421))),Gf(t,e,o,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=ZH.bind(null,t),r._reactRetry=e,null):(t=s.treeContext,pi=Bs(r.nextSibling),hi=e,Ht=!0,qi=null,t!==null&&(Pi[ki++]=es,Pi[ki++]=ts,Pi[ki++]=Fo,es=t.id,ts=t.overflow,Fo=e),e=$y(e,i.children),e.flags|=4096,e)}function oC(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),vy(t.return,e,n)}function zy(t,e,n,i,r){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function aC(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(Un(t,e,i.children,n),i=jt.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&oC(t,n,e);else if(t.tag===19)oC(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(Rt(jt,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&Ff(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),zy(e,!1,r,n,s);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&Ff(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}zy(e,!0,n,null,s);break;case"together":zy(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function jf(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function rs(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),zo|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(ye(153));if(e.child!==null){for(t=e.child,n=Ys(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Ys(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function HH(t,e,n){switch(e.tag){case 3:iC(e),tl();break;case 5:T2(e);break;case 1:qn(e.type)&&Cf(e);break;case 4:Ty(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;Rt(Df,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(Rt(jt,jt.current&1),e.flags|=128,null):n&e.child.childLanes?sC(t,e,n):(Rt(jt,jt.current&1),t=rs(t,e,n),t!==null?t.sibling:null);Rt(jt,jt.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return aC(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),Rt(jt,jt.current),i)break;return null;case 22:case 23:return e.lanes=0,eC(t,e,n)}return rs(t,e,n)}var lC,Vy,uC,cC;lC=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Vy=function(){},uC=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,Ho(gr.current);var s=null;switch(n){case"input":r=vg(t,r),i=vg(t,i),s=[];break;case"select":r=Gt({},r,{value:void 0}),i=Gt({},i,{value:void 0}),s=[];break;case"textarea":r=Tg(t,r),i=Tg(t,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=wf)}xg(n,i);var o;n=null;for(u in r)if(!i.hasOwnProperty(u)&&r.hasOwnProperty(u)&&r[u]!=null)if(u==="style"){var a=r[u];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Ru.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in i){var l=i[u];if(a=r!=null?r[u]:void 0,i.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(s||(s=[]),s.push(u,n)),n=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Ru.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Mt("scroll",t),s||a===l||(s=[])):(s=s||[]).push(u,l))}n&&(s=s||[]).push("style",n);var u=s;(e.updateQueue=u)&&(e.flags|=4)}},cC=function(t,e,n,i){n!==i&&(e.flags|=4)};function dc(t,e){if(!Ht)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function kn(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function $H(t,e,n){var i=e.pendingProps;switch(dy(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return kn(e),null;case 1:return qn(e.type)&&Af(),kn(e),null;case 3:return i=e.stateNode,sl(),Ft(Wn),Ft(Ln),wy(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(Pf(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,qi!==null&&(e1(qi),qi=null))),Vy(t,e),kn(e),null;case 5:Sy(e);var r=Ho(oc.current);if(n=e.type,t!==null&&e.stateNode!=null)uC(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(ye(166));return kn(e),null}if(t=Ho(gr.current),Pf(e)){i=e.stateNode,n=e.type;var s=e.memoizedProps;switch(i[mr]=e,i[tc]=s,t=(e.mode&1)!==0,n){case"dialog":Mt("cancel",i),Mt("close",i);break;case"iframe":case"object":case"embed":Mt("load",i);break;case"video":case"audio":for(r=0;r<Zu.length;r++)Mt(Zu[r],i);break;case"source":Mt("error",i);break;case"img":case"image":case"link":Mt("error",i),Mt("load",i);break;case"details":Mt("toggle",i);break;case"input":G_(i,s),Mt("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},Mt("invalid",i);break;case"textarea":q_(i,s),Mt("invalid",i)}xg(n,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&xf(i.textContent,a,t),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&xf(i.textContent,a,t),r=["children",""+a]):Ru.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Mt("scroll",i)}switch(n){case"input":Jd(i),W_(i,s,!0);break;case"textarea":Jd(i),Y_(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=wf)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=X_(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(n,{is:i.is}):(t=o.createElement(n),n==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,n),t[mr]=e,t[tc]=i,lC(t,e,!1,!1),e.stateNode=t;e:{switch(o=wg(n,i),n){case"dialog":Mt("cancel",t),Mt("close",t),r=i;break;case"iframe":case"object":case"embed":Mt("load",t),r=i;break;case"video":case"audio":for(r=0;r<Zu.length;r++)Mt(Zu[r],t);r=i;break;case"source":Mt("error",t),r=i;break;case"img":case"image":case"link":Mt("error",t),Mt("load",t),r=i;break;case"details":Mt("toggle",t),r=i;break;case"input":G_(t,i),r=vg(t,i),Mt("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=Gt({},i,{value:void 0}),Mt("invalid",t);break;case"textarea":q_(t,i),r=Tg(t,i),Mt("invalid",t);break;default:r=i}xg(n,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?J_(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Q_(t,l)):s==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&Du(t,l):typeof l=="number"&&Du(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Ru.hasOwnProperty(s)?l!=null&&s==="onScroll"&&Mt("scroll",t):l!=null&&ag(t,s,l,o))}switch(n){case"input":Jd(t),W_(t,i,!1);break;case"textarea":Jd(t),Y_(t);break;case"option":i.value!=null&&t.setAttribute("value",""+Ps(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?Ha(t,!!i.multiple,s,!1):i.defaultValue!=null&&Ha(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=wf)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return kn(e),null;case 6:if(t&&e.stateNode!=null)cC(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(ye(166));if(n=Ho(oc.current),Ho(gr.current),Pf(e)){if(i=e.stateNode,n=e.memoizedProps,i[mr]=e,(s=i.nodeValue!==n)&&(t=hi,t!==null))switch(t.tag){case 3:xf(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&xf(i.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[mr]=e,e.stateNode=i}return kn(e),null;case 13:if(Ft(jt),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Ht&&pi!==null&&e.mode&1&&!(e.flags&128))h2(),tl(),e.flags|=98560,s=!1;else if(s=Pf(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(ye(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(ye(317));s[mr]=e}else tl(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;kn(e),s=!1}else qi!==null&&(e1(qi),qi=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||jt.current&1?fn===0&&(fn=3):i1())),e.updateQueue!==null&&(e.flags|=4),kn(e),null);case 4:return sl(),Vy(t,e),t===null&&Ju(e.stateNode.containerInfo),kn(e),null;case 10:return yy(e.type._context),kn(e),null;case 17:return qn(e.type)&&Af(),kn(e),null;case 19:if(Ft(jt),s=e.memoizedState,s===null)return kn(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)dc(s,!1);else{if(fn!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Ff(t),o!==null){for(e.flags|=128,dc(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)s=n,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Rt(jt,jt.current&1|2),e.child}t=t.sibling}s.tail!==null&&Zt()>ul&&(e.flags|=128,i=!0,dc(s,!1),e.lanes=4194304)}else{if(!i)if(t=Ff(o),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),dc(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!Ht)return kn(e),null}else 2*Zt()-s.renderingStartTime>ul&&n!==1073741824&&(e.flags|=128,i=!0,dc(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Zt(),e.sibling=null,n=jt.current,Rt(jt,i?n&1|2:n&1),e):(kn(e),null);case 22:case 23:return n1(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?mi&1073741824&&(kn(e),e.subtreeFlags&6&&(e.flags|=8192)):kn(e),null;case 24:return null;case 25:return null}throw Error(ye(156,e.tag))}function zH(t,e){switch(dy(e),e.tag){case 1:return qn(e.type)&&Af(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return sl(),Ft(Wn),Ft(Ln),wy(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Sy(e),null;case 13:if(Ft(jt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(ye(340));tl()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Ft(jt),null;case 4:return sl(),null;case 10:return yy(e.type._context),null;case 22:case 23:return n1(),null;case 24:return null;default:return null}}var Wf=!1,Dn=!1,VH=typeof WeakSet=="function"?WeakSet:Set,De=null;function al(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){Xt(t,e,i)}else n.current=null}function Gy(t,e,n){try{n()}catch(i){Xt(t,e,i)}}var dC=!1;function GH(t,e){if(ny=ff,t=VA(),Kg(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,u=0,c=0,d=t,f=null;t:for(;;){for(var h;d!==n||r!==0&&d.nodeType!==3||(a=o+r),d!==s||i!==0&&d.nodeType!==3||(l=o+i),d.nodeType===3&&(o+=d.nodeValue.length),(h=d.firstChild)!==null;)f=d,d=h;for(;;){if(d===t)break t;if(f===n&&++u===r&&(a=o),f===s&&++c===i&&(l=o),(h=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=h}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(iy={focusedElem:t,selectionRange:n},ff=!1,De=e;De!==null;)if(e=De,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,De=t;else for(;De!==null;){e=De;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var m=p.memoizedProps,y=p.memoizedState,g=e.stateNode,v=g.getSnapshotBeforeUpdate(e.elementType===e.type?m:Ki(e.type,m),y);g.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var b=e.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ye(163))}}catch(T){Xt(e,e.return,T)}if(t=e.sibling,t!==null){t.return=e.return,De=t;break}De=e.return}return p=dC,dC=!1,p}function fc(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var s=r.destroy;r.destroy=void 0,s!==void 0&&Gy(e,n,s)}r=r.next}while(r!==i)}}function qf(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function jy(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function fC(t){var e=t.alternate;e!==null&&(t.alternate=null,fC(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[mr],delete e[tc],delete e[ay],delete e[AH],delete e[CH])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function hC(t){return t.tag===5||t.tag===3||t.tag===4}function pC(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||hC(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Wy(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=wf));else if(i!==4&&(t=t.child,t!==null))for(Wy(t,e,n),t=t.sibling;t!==null;)Wy(t,e,n),t=t.sibling}function qy(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(qy(t,e,n),t=t.sibling;t!==null;)qy(t,e,n),t=t.sibling}var _n=null,Yi=!1;function Gs(t,e,n){for(n=n.child;n!==null;)mC(t,e,n),n=n.sibling}function mC(t,e,n){if(pr&&typeof pr.onCommitFiberUnmount=="function")try{pr.onCommitFiberUnmount(of,n)}catch{}switch(n.tag){case 5:Dn||al(n,e);case 6:var i=_n,r=Yi;_n=null,Gs(t,e,n),_n=i,Yi=r,_n!==null&&(Yi?(t=_n,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):_n.removeChild(n.stateNode));break;case 18:_n!==null&&(Yi?(t=_n,n=n.stateNode,t.nodeType===8?oy(t.parentNode,n):t.nodeType===1&&oy(t,n),Gu(t)):oy(_n,n.stateNode));break;case 4:i=_n,r=Yi,_n=n.stateNode.containerInfo,Yi=!0,Gs(t,e,n),_n=i,Yi=r;break;case 0:case 11:case 14:case 15:if(!Dn&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&Gy(n,e,o),r=r.next}while(r!==i)}Gs(t,e,n);break;case 1:if(!Dn&&(al(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){Xt(n,e,a)}Gs(t,e,n);break;case 21:Gs(t,e,n);break;case 22:n.mode&1?(Dn=(i=Dn)||n.memoizedState!==null,Gs(t,e,n),Dn=i):Gs(t,e,n);break;default:Gs(t,e,n)}}function gC(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new VH),e.forEach(function(i){var r=JH.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function Xi(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:_n=a.stateNode,Yi=!1;break e;case 3:_n=a.stateNode.containerInfo,Yi=!0;break e;case 4:_n=a.stateNode.containerInfo,Yi=!0;break e}a=a.return}if(_n===null)throw Error(ye(160));mC(s,o,r),_n=null,Yi=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(u){Xt(r,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)yC(e,t),e=e.sibling}function yC(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Xi(e,t),vr(t),i&4){try{fc(3,t,t.return),qf(3,t)}catch(m){Xt(t,t.return,m)}try{fc(5,t,t.return)}catch(m){Xt(t,t.return,m)}}break;case 1:Xi(e,t),vr(t),i&512&&n!==null&&al(n,n.return);break;case 5:if(Xi(e,t),vr(t),i&512&&n!==null&&al(n,n.return),t.flags&32){var r=t.stateNode;try{Du(r,"")}catch(m){Xt(t,t.return,m)}}if(i&4&&(r=t.stateNode,r!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&j_(r,s),wg(a,o);var u=wg(a,s);for(o=0;o<l.length;o+=2){var c=l[o],d=l[o+1];c==="style"?J_(r,d):c==="dangerouslySetInnerHTML"?Q_(r,d):c==="children"?Du(r,d):ag(r,c,d,u)}switch(a){case"input":bg(r,s);break;case"textarea":K_(r,s);break;case"select":var f=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var h=s.value;h!=null?Ha(r,!!s.multiple,h,!1):f!==!!s.multiple&&(s.defaultValue!=null?Ha(r,!!s.multiple,s.defaultValue,!0):Ha(r,!!s.multiple,s.multiple?[]:"",!1))}r[tc]=s}catch(m){Xt(t,t.return,m)}}break;case 6:if(Xi(e,t),vr(t),i&4){if(t.stateNode===null)throw Error(ye(162));r=t.stateNode,s=t.memoizedProps;try{r.nodeValue=s}catch(m){Xt(t,t.return,m)}}break;case 3:if(Xi(e,t),vr(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{Gu(e.containerInfo)}catch(m){Xt(t,t.return,m)}break;case 4:Xi(e,t),vr(t);break;case 13:Xi(e,t),vr(t),r=t.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(Xy=Zt())),i&4&&gC(t);break;case 22:if(c=n!==null&&n.memoizedState!==null,t.mode&1?(Dn=(u=Dn)||c,Xi(e,t),Dn=u):Xi(e,t),vr(t),i&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!c&&t.mode&1)for(De=t,c=t.child;c!==null;){for(d=De=c;De!==null;){switch(f=De,h=f.child,f.tag){case 0:case 11:case 14:case 15:fc(4,f,f.return);break;case 1:al(f,f.return);var p=f.stateNode;if(typeof p.componentWillUnmount=="function"){i=f,n=f.return;try{e=i,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(m){Xt(i,n,m)}}break;case 5:al(f,f.return);break;case 22:if(f.memoizedState!==null){EC(d);continue}}h!==null?(h.return=f,De=h):EC(d)}c=c.sibling}e:for(c=null,d=t;;){if(d.tag===5){if(c===null){c=d;try{r=d.stateNode,u?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=d.stateNode,l=d.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=Z_("display",o))}catch(m){Xt(t,t.return,m)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(m){Xt(t,t.return,m)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Xi(e,t),vr(t),i&4&&gC(t);break;case 21:break;default:Xi(e,t),vr(t)}}function vr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(hC(n)){var i=n;break e}n=n.return}throw Error(ye(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(Du(r,""),i.flags&=-33);var s=pC(t);qy(t,s,r);break;case 3:case 4:var o=i.stateNode.containerInfo,a=pC(t);Wy(t,a,o);break;default:throw Error(ye(161))}}catch(l){Xt(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function jH(t,e,n){De=t,vC(t)}function vC(t,e,n){for(var i=(t.mode&1)!==0;De!==null;){var r=De,s=r.child;if(r.tag===22&&i){var o=r.memoizedState!==null||Wf;if(!o){var a=r.alternate,l=a!==null&&a.memoizedState!==null||Dn;a=Wf;var u=Dn;if(Wf=o,(Dn=l)&&!u)for(De=r;De!==null;)o=De,l=o.child,o.tag===22&&o.memoizedState!==null?TC(r):l!==null?(l.return=o,De=l):TC(r);for(;s!==null;)De=s,vC(s),s=s.sibling;De=r,Wf=a,Dn=u}bC(t)}else r.subtreeFlags&8772&&s!==null?(s.return=r,De=s):bC(t)}}function bC(t){for(;De!==null;){var e=De;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Dn||qf(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!Dn)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:Ki(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&E2(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}E2(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&Gu(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ye(163))}Dn||e.flags&512&&jy(e)}catch(f){Xt(e,e.return,f)}}if(e===t){De=null;break}if(n=e.sibling,n!==null){n.return=e.return,De=n;break}De=e.return}}function EC(t){for(;De!==null;){var e=De;if(e===t){De=null;break}var n=e.sibling;if(n!==null){n.return=e.return,De=n;break}De=e.return}}function TC(t){for(;De!==null;){var e=De;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{qf(4,e)}catch(l){Xt(e,n,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(l){Xt(e,r,l)}}var s=e.return;try{jy(e)}catch(l){Xt(e,s,l)}break;case 5:var o=e.return;try{jy(e)}catch(l){Xt(e,o,l)}}}catch(l){Xt(e,e.return,l)}if(e===t){De=null;break}var a=e.sibling;if(a!==null){a.return=e.return,De=a;break}De=e.return}}var WH=Math.ceil,Kf=Qr.ReactCurrentDispatcher,Ky=Qr.ReactCurrentOwner,Ni=Qr.ReactCurrentBatchConfig,pt=0,yn=null,rn=null,An=0,mi=0,ll=Us(0),fn=0,hc=null,zo=0,Yf=0,Yy=0,pc=null,Yn=null,Xy=0,ul=1/0,ss=null,Xf=!1,Qy=null,js=null,Qf=!1,Ws=null,Zf=0,mc=0,Zy=null,Jf=-1,eh=0;function Hn(){return pt&6?Zt():Jf!==-1?Jf:Jf=Zt()}function qs(t){return t.mode&1?pt&2&&An!==0?An&-An:RH.transition!==null?(eh===0&&(eh=pA()),eh):(t=yt,t!==0||(t=window.event,t=t===void 0?16:xA(t.type)),t):1}function Qi(t,e,n,i){if(50<mc)throw mc=0,Zy=null,Error(ye(185));Uu(t,n,i),(!(pt&2)||t!==yn)&&(t===yn&&(!(pt&2)&&(Yf|=n),fn===4&&Ks(t,An)),Xn(t,i),n===1&&pt===0&&!(e.mode&1)&&(ul=Zt()+500,If&&$s()))}function Xn(t,e){var n=t.callbackNode;R7(t,e);var i=uf(t,t===yn?An:0);if(i===0)n!==null&&dA(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&dA(n),e===1)t.tag===0?IH(xC.bind(null,t)):l2(xC.bind(null,t)),wH(function(){!(pt&6)&&$s()}),n=null;else{switch(mA(i)){case 1:n=Pg;break;case 4:n=fA;break;case 16:n=sf;break;case 536870912:n=hA;break;default:n=sf}n=PC(n,SC.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function SC(t,e){if(Jf=-1,eh=0,pt&6)throw Error(ye(327));var n=t.callbackNode;if(cl()&&t.callbackNode!==n)return null;var i=uf(t,t===yn?An:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=th(t,i);else{e=i;var r=pt;pt|=2;var s=_C();(yn!==t||An!==e)&&(ss=null,ul=Zt()+500,Go(t,e));do try{YH();break}catch(a){wC(t,a)}while(!0);gy(),Kf.current=s,pt=r,rn!==null?e=0:(yn=null,An=0,e=fn)}if(e!==0){if(e===2&&(r=kg(t),r!==0&&(i=r,e=Jy(t,r))),e===1)throw n=hc,Go(t,0),Ks(t,i),Xn(t,Zt()),n;if(e===6)Ks(t,i);else{if(r=t.current.alternate,!(i&30)&&!qH(r)&&(e=th(t,i),e===2&&(s=kg(t),s!==0&&(i=s,e=Jy(t,s))),e===1))throw n=hc,Go(t,0),Ks(t,i),Xn(t,Zt()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(ye(345));case 2:jo(t,Yn,ss);break;case 3:if(Ks(t,i),(i&130023424)===i&&(e=Xy+500-Zt(),10<e)){if(uf(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){Hn(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=sy(jo.bind(null,t,Yn,ss),e);break}jo(t,Yn,ss);break;case 4:if(Ks(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var o=31-ji(i);s=1<<o,o=e[o],o>r&&(r=o),i&=~s}if(i=r,i=Zt()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*WH(i/1960))-i,10<i){t.timeoutHandle=sy(jo.bind(null,t,Yn,ss),i);break}jo(t,Yn,ss);break;case 5:jo(t,Yn,ss);break;default:throw Error(ye(329))}}}return Xn(t,Zt()),t.callbackNode===n?SC.bind(null,t):null}function Jy(t,e){var n=pc;return t.current.memoizedState.isDehydrated&&(Go(t,e).flags|=256),t=th(t,e),t!==2&&(e=Yn,Yn=n,e!==null&&e1(e)),t}function e1(t){Yn===null?Yn=t:Yn.push.apply(Yn,t)}function qH(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!Wi(s(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ks(t,e){for(e&=~Yy,e&=~Yf,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-ji(e),i=1<<n;t[n]=-1,e&=~i}}function xC(t){if(pt&6)throw Error(ye(327));cl();var e=uf(t,0);if(!(e&1))return Xn(t,Zt()),null;var n=th(t,e);if(t.tag!==0&&n===2){var i=kg(t);i!==0&&(e=i,n=Jy(t,i))}if(n===1)throw n=hc,Go(t,0),Ks(t,e),Xn(t,Zt()),n;if(n===6)throw Error(ye(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,jo(t,Yn,ss),Xn(t,Zt()),null}function t1(t,e){var n=pt;pt|=1;try{return t(e)}finally{pt=n,pt===0&&(ul=Zt()+500,If&&$s())}}function Vo(t){Ws!==null&&Ws.tag===0&&!(pt&6)&&cl();var e=pt;pt|=1;var n=Ni.transition,i=yt;try{if(Ni.transition=null,yt=1,t)return t()}finally{yt=i,Ni.transition=n,pt=e,!(pt&6)&&$s()}}function n1(){mi=ll.current,Ft(ll)}function Go(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,xH(n)),rn!==null)for(n=rn.return;n!==null;){var i=n;switch(dy(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&Af();break;case 3:sl(),Ft(Wn),Ft(Ln),wy();break;case 5:Sy(i);break;case 4:sl();break;case 13:Ft(jt);break;case 19:Ft(jt);break;case 10:yy(i.type._context);break;case 22:case 23:n1()}n=n.return}if(yn=t,rn=t=Ys(t.current,null),An=mi=e,fn=0,hc=null,Yy=Yf=zo=0,Yn=pc=null,Uo!==null){for(e=0;e<Uo.length;e++)if(n=Uo[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,s=n.pending;if(s!==null){var o=s.next;s.next=r,i.next=o}n.pending=i}Uo=null}return t}function wC(t,e){do{var n=rn;try{if(gy(),Bf.current=zf,Uf){for(var i=Wt.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}Uf=!1}if($o=0,gn=dn=Wt=null,ac=!1,lc=0,Ky.current=null,n===null||n.return===null){fn=1,hc=e,rn=null;break}e:{var s=t,o=n.return,a=n,l=e;if(e=An,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=a,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var f=c.alternate;f?(c.updateQueue=f.updateQueue,c.memoizedState=f.memoizedState,c.lanes=f.lanes):(c.updateQueue=null,c.memoizedState=null)}var h=Y2(o);if(h!==null){h.flags&=-257,X2(h,o,a,s,e),h.mode&1&&K2(s,u,e),e=h,l=u;var p=e.updateQueue;if(p===null){var m=new Set;m.add(l),e.updateQueue=m}else p.add(l);break e}else{if(!(e&1)){K2(s,u,e),i1();break e}l=Error(ye(426))}}else if(Ht&&a.mode&1){var y=Y2(o);if(y!==null){!(y.flags&65536)&&(y.flags|=256),X2(y,o,a,s,e),py(ol(l,a));break e}}s=l=ol(l,a),fn!==4&&(fn=2),pc===null?pc=[s]:pc.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var g=W2(s,l,e);b2(s,g);break e;case 1:a=l;var v=s.type,b=s.stateNode;if(!(s.flags&128)&&(typeof v.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(js===null||!js.has(b)))){s.flags|=65536,e&=-e,s.lanes|=e;var T=q2(s,a,e);b2(s,T);break e}}s=s.return}while(s!==null)}CC(n)}catch(S){e=S,rn===n&&n!==null&&(rn=n=n.return);continue}break}while(!0)}function _C(){var t=Kf.current;return Kf.current=zf,t===null?zf:t}function i1(){(fn===0||fn===3||fn===2)&&(fn=4),yn===null||!(zo&268435455)&&!(Yf&268435455)||Ks(yn,An)}function th(t,e){var n=pt;pt|=2;var i=_C();(yn!==t||An!==e)&&(ss=null,Go(t,e));do try{KH();break}catch(r){wC(t,r)}while(!0);if(gy(),pt=n,Kf.current=i,rn!==null)throw Error(ye(261));return yn=null,An=0,fn}function KH(){for(;rn!==null;)AC(rn)}function YH(){for(;rn!==null&&!E7();)AC(rn)}function AC(t){var e=LC(t.alternate,t,mi);t.memoizedProps=t.pendingProps,e===null?CC(t):rn=e,Ky.current=null}function CC(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=zH(n,e),n!==null){n.flags&=32767,rn=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{fn=6,rn=null;return}}else if(n=$H(n,e,mi),n!==null){rn=n;return}if(e=e.sibling,e!==null){rn=e;return}rn=e=t}while(e!==null);fn===0&&(fn=5)}function jo(t,e,n){var i=yt,r=Ni.transition;try{Ni.transition=null,yt=1,XH(t,e,n,i)}finally{Ni.transition=r,yt=i}return null}function XH(t,e,n,i){do cl();while(Ws!==null);if(pt&6)throw Error(ye(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(ye(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(L7(t,s),t===yn&&(rn=yn=null,An=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Qf||(Qf=!0,PC(sf,function(){return cl(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=Ni.transition,Ni.transition=null;var o=yt;yt=1;var a=pt;pt|=4,Ky.current=null,GH(t,n),yC(n,t),gH(iy),ff=!!ny,iy=ny=null,t.current=n,jH(n),T7(),pt=a,yt=o,Ni.transition=s}else t.current=n;if(Qf&&(Qf=!1,Ws=t,Zf=r),s=t.pendingLanes,s===0&&(js=null),w7(n.stateNode),Xn(t,Zt()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(Xf)throw Xf=!1,t=Qy,Qy=null,t;return Zf&1&&t.tag!==0&&cl(),s=t.pendingLanes,s&1?t===Zy?mc++:(mc=0,Zy=t):mc=0,$s(),null}function cl(){if(Ws!==null){var t=mA(Zf),e=Ni.transition,n=yt;try{if(Ni.transition=null,yt=16>t?16:t,Ws===null)var i=!1;else{if(t=Ws,Ws=null,Zf=0,pt&6)throw Error(ye(331));var r=pt;for(pt|=4,De=t.current;De!==null;){var s=De,o=s.child;if(De.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(De=u;De!==null;){var c=De;switch(c.tag){case 0:case 11:case 15:fc(8,c,s)}var d=c.child;if(d!==null)d.return=c,De=d;else for(;De!==null;){c=De;var f=c.sibling,h=c.return;if(fC(c),c===u){De=null;break}if(f!==null){f.return=h,De=f;break}De=h}}}var p=s.alternate;if(p!==null){var m=p.child;if(m!==null){p.child=null;do{var y=m.sibling;m.sibling=null,m=y}while(m!==null)}}De=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,De=o;else e:for(;De!==null;){if(s=De,s.flags&2048)switch(s.tag){case 0:case 11:case 15:fc(9,s,s.return)}var g=s.sibling;if(g!==null){g.return=s.return,De=g;break e}De=s.return}}var v=t.current;for(De=v;De!==null;){o=De;var b=o.child;if(o.subtreeFlags&2064&&b!==null)b.return=o,De=b;else e:for(o=v;De!==null;){if(a=De,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:qf(9,a)}}catch(S){Xt(a,a.return,S)}if(a===o){De=null;break e}var T=a.sibling;if(T!==null){T.return=a.return,De=T;break e}De=a.return}}if(pt=r,$s(),pr&&typeof pr.onPostCommitFiberRoot=="function")try{pr.onPostCommitFiberRoot(of,t)}catch{}i=!0}return i}finally{yt=n,Ni.transition=e}}return!1}function IC(t,e,n){e=ol(n,e),e=W2(t,e,1),t=Vs(t,e,1),e=Hn(),t!==null&&(Uu(t,1,e),Xn(t,e))}function Xt(t,e,n){if(t.tag===3)IC(t,t,n);else for(;e!==null;){if(e.tag===3){IC(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(js===null||!js.has(i))){t=ol(n,t),t=q2(e,t,1),e=Vs(e,t,1),t=Hn(),e!==null&&(Uu(e,1,t),Xn(e,t));break}}e=e.return}}function QH(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=Hn(),t.pingedLanes|=t.suspendedLanes&n,yn===t&&(An&n)===n&&(fn===4||fn===3&&(An&130023424)===An&&500>Zt()-Xy?Go(t,0):Yy|=n),Xn(t,e)}function RC(t,e){e===0&&(t.mode&1?(e=lf,lf<<=1,!(lf&130023424)&&(lf=4194304)):e=1);var n=Hn();t=ns(t,e),t!==null&&(Uu(t,e,n),Xn(t,n))}function ZH(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),RC(t,n)}function JH(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(ye(314))}i!==null&&i.delete(e),RC(t,n)}var LC;LC=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Wn.current)Kn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Kn=!1,HH(t,e,n);Kn=!!(t.flags&131072)}else Kn=!1,Ht&&e.flags&1048576&&u2(e,Lf,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;jf(t,e),t=e.pendingProps;var r=Za(e,Ln.current);rl(e,n),r=Cy(null,e,i,t,r,n);var s=Iy();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,qn(i)?(s=!0,Cf(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Ey(e),r.updater=Vf,e.stateNode=r,r._reactInternals=e,Oy(e,i,t,n),e=By(null,e,i,!0,s,n)):(e.tag=0,Ht&&s&&cy(e),Un(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(jf(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=t$(i),t=Ki(i,t),r){case 0:e=Fy(null,e,i,t,n);break e;case 1:e=nC(null,e,i,t,n);break e;case 11:e=Q2(null,e,i,t,n);break e;case 14:e=Z2(null,e,i,Ki(i.type,t),n);break e}throw Error(ye(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Ki(i,r),Fy(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Ki(i,r),nC(t,e,i,r,n);case 3:e:{if(iC(e),t===null)throw Error(ye(387));i=e.pendingProps,s=e.memoizedState,r=s.element,v2(t,e),Mf(e,i,null,n);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=ol(Error(ye(423)),e),e=rC(t,e,i,n,r);break e}else if(i!==r){r=ol(Error(ye(424)),e),e=rC(t,e,i,n,r);break e}else for(pi=Bs(e.stateNode.containerInfo.firstChild),hi=e,Ht=!0,qi=null,n=g2(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(tl(),i===r){e=rs(t,e,n);break e}Un(t,e,i,n)}e=e.child}return e;case 5:return T2(e),t===null&&hy(e),i=e.type,r=e.pendingProps,s=t!==null?t.memoizedProps:null,o=r.children,ry(i,r)?o=null:s!==null&&ry(i,s)&&(e.flags|=32),tC(t,e),Un(t,e,o,n),e.child;case 6:return t===null&&hy(e),null;case 13:return sC(t,e,n);case 4:return Ty(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=nl(e,null,i,n):Un(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Ki(i,r),Q2(t,e,i,r,n);case 7:return Un(t,e,e.pendingProps,n),e.child;case 8:return Un(t,e,e.pendingProps.children,n),e.child;case 12:return Un(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,Rt(Df,i._currentValue),i._currentValue=o,s!==null)if(Wi(s.value,o)){if(s.children===r.children&&!Wn.current){e=rs(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===i){if(s.tag===1){l=is(-1,n&-n),l.tag=2;var u=s.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),vy(s.return,n,e),a.lanes|=n;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(ye(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),vy(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Un(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,rl(e,n),r=Di(r),i=i(r),e.flags|=1,Un(t,e,i,n),e.child;case 14:return i=e.type,r=Ki(i,e.pendingProps),r=Ki(i.type,r),Z2(t,e,i,r,n);case 15:return J2(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Ki(i,r),jf(t,e),e.tag=1,qn(i)?(t=!0,Cf(e)):t=!1,rl(e,n),G2(e,i,r),Oy(e,i,r,n),By(null,e,i,!0,t,n);case 19:return aC(t,e,n);case 22:return eC(t,e,n)}throw Error(ye(156,e.tag))};function PC(t,e){return cA(t,e)}function e$(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Mi(t,e,n,i){return new e$(t,e,n,i)}function r1(t){return t=t.prototype,!(!t||!t.isReactComponent)}function t$(t){if(typeof t=="function")return r1(t)?1:0;if(t!=null){if(t=t.$$typeof,t===cg)return 11;if(t===hg)return 14}return 2}function Ys(t,e){var n=t.alternate;return n===null?(n=Mi(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function nh(t,e,n,i,r,s){var o=2;if(i=t,typeof t=="function")r1(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Ua:return Wo(n.children,r,s,e);case lg:o=8,r|=8;break;case ug:return t=Mi(12,n,e,r|2),t.elementType=ug,t.lanes=s,t;case dg:return t=Mi(13,n,e,r),t.elementType=dg,t.lanes=s,t;case fg:return t=Mi(19,n,e,r),t.elementType=fg,t.lanes=s,t;case H_:return ih(n,r,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case B_:o=10;break e;case U_:o=9;break e;case cg:o=11;break e;case hg:o=14;break e;case Ls:o=16,i=null;break e}throw Error(ye(130,t==null?t:typeof t,""))}return e=Mi(o,n,e,r),e.elementType=t,e.type=i,e.lanes=s,e}function Wo(t,e,n,i){return t=Mi(7,t,i,e),t.lanes=n,t}function ih(t,e,n,i){return t=Mi(22,t,i,e),t.elementType=H_,t.lanes=n,t.stateNode={isHidden:!1},t}function s1(t,e,n){return t=Mi(6,t,null,e),t.lanes=n,t}function o1(t,e,n){return e=Mi(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function n$(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Dg(0),this.expirationTimes=Dg(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Dg(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function a1(t,e,n,i,r,s,o,a,l){return t=new n$(t,e,n,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Mi(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ey(s),t}function i$(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ba,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function kC(t){if(!t)return Hs;t=t._reactInternals;e:{if(Oo(t)!==t||t.tag!==1)throw Error(ye(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(qn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ye(171))}if(t.tag===1){var n=t.type;if(qn(n))return o2(t,n,e)}return e}function DC(t,e,n,i,r,s,o,a,l){return t=a1(n,i,!0,t,r,s,o,a,l),t.context=kC(null),n=t.current,i=Hn(),r=qs(n),s=is(i,r),s.callback=e??null,Vs(n,s,r),t.current.lanes=r,Uu(t,r,i),Xn(t,i),t}function rh(t,e,n,i){var r=e.current,s=Hn(),o=qs(r);return n=kC(n),e.context===null?e.context=n:e.pendingContext=n,e=is(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=Vs(r,e,o),t!==null&&(Qi(t,r,o,s),Nf(t,r,o)),o}function sh(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function OC(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function l1(t,e){OC(t,e),(t=t.alternate)&&OC(t,e)}function r$(){return null}var NC=typeof reportError=="function"?reportError:function(t){console.error(t)};function u1(t){this._internalRoot=t}oh.prototype.render=u1.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(ye(409));rh(t,e,null,null)},oh.prototype.unmount=u1.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Vo(function(){rh(null,t,null,null)}),e[Zr]=null}};function oh(t){this._internalRoot=t}oh.prototype.unstable_scheduleHydration=function(t){if(t){var e=vA();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Ns.length&&e!==0&&e<Ns[n].priority;n++);Ns.splice(n,0,t),n===0&&TA(t)}};function c1(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function ah(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function MC(){}function s$(t,e,n,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var u=sh(o);s.call(u)}}var o=DC(e,i,t,0,null,!1,!1,"",MC);return t._reactRootContainer=o,t[Zr]=o.current,Ju(t.nodeType===8?t.parentNode:t),Vo(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var u=sh(l);a.call(u)}}var l=a1(t,0,!1,null,null,!1,!1,"",MC);return t._reactRootContainer=l,t[Zr]=l.current,Ju(t.nodeType===8?t.parentNode:t),Vo(function(){rh(e,l,n,i)}),l}function lh(t,e,n,i,r){var s=n._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var l=sh(o);a.call(l)}}rh(e,o,t,r)}else o=s$(n,e,t,r,i);return sh(o)}gA=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Bu(e.pendingLanes);n!==0&&(Og(e,n|1),Xn(e,Zt()),!(pt&6)&&(ul=Zt()+500,$s()))}break;case 13:Vo(function(){var i=ns(t,1);if(i!==null){var r=Hn();Qi(i,t,1,r)}}),l1(t,1)}},Ng=function(t){if(t.tag===13){var e=ns(t,134217728);if(e!==null){var n=Hn();Qi(e,t,134217728,n)}l1(t,134217728)}},yA=function(t){if(t.tag===13){var e=qs(t),n=ns(t,e);if(n!==null){var i=Hn();Qi(n,t,e,i)}l1(t,e)}},vA=function(){return yt},bA=function(t,e){var n=yt;try{return yt=t,e()}finally{yt=n}},Cg=function(t,e,n){switch(e){case"input":if(bg(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=_f(i);if(!r)throw Error(ye(90));V_(i),bg(i,r)}}}break;case"textarea":K_(t,n);break;case"select":e=n.value,e!=null&&Ha(t,!!n.multiple,e,!1)}},iA=t1,rA=Vo;var o$={usingClientEntryPoint:!1,Events:[nc,Xa,_f,tA,nA,t1]},gc={findFiberByHostInstance:No,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},a$={bundleType:gc.bundleType,version:gc.version,rendererPackageName:gc.rendererPackageName,rendererConfig:gc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Qr.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=lA(t),t===null?null:t.stateNode},findFiberByHostInstance:gc.findFiberByHostInstance||r$,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var uh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!uh.isDisabled&&uh.supportsFiber)try{of=uh.inject(a$),pr=uh}catch{}}ci.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=o$,ci.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!c1(e))throw Error(ye(200));return i$(t,e,null,n)},ci.createRoot=function(t,e){if(!c1(t))throw Error(ye(299));var n=!1,i="",r=NC;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=a1(t,1,!1,null,null,n,!1,i,r),t[Zr]=e.current,Ju(t.nodeType===8?t.parentNode:t),new u1(e)},ci.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(ye(188)):(t=Object.keys(t).join(","),Error(ye(268,t)));return t=lA(e),t=t===null?null:t.stateNode,t},ci.flushSync=function(t){return Vo(t)},ci.hydrate=function(t,e,n){if(!ah(e))throw Error(ye(200));return lh(null,t,e,!0,n)},ci.hydrateRoot=function(t,e,n){if(!c1(t))throw Error(ye(405));var i=n!=null&&n.hydratedSources||null,r=!1,s="",o=NC;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=DC(e,null,t,1,n??null,r,!1,s,o),t[Zr]=e.current,Ju(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new oh(e)},ci.render=function(t,e,n){if(!ah(e))throw Error(ye(200));return lh(null,t,e,!1,n)},ci.unmountComponentAtNode=function(t){if(!ah(t))throw Error(ye(40));return t._reactRootContainer?(Vo(function(){lh(null,null,t,!1,function(){t._reactRootContainer=null,t[Zr]=null})}),!0):!1},ci.unstable_batchedUpdates=t1,ci.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!ah(n))throw Error(ye(200));if(t==null||t._reactInternals===void 0)throw Error(ye(38));return lh(t,e,n,!1,i)},ci.version="18.3.1-next-f1338f8080-20240426";function FC(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(FC)}catch(t){console.error(t)}}FC(),k_.exports=ci;var yc=k_.exports;const l$=Md(yc);function vc(t){const e=u$(t),n=Re((i,r)=>{const{children:s,...o}=i,a=Gn.toArray(s),l=a.find(d$);if(l){const u=l.props.children,c=a.map(d=>d===l?Gn.count(u)>1?Gn.only(null):li(u)?u.props.children:null:d);return ue(e,{...o,ref:r,children:li(u)?Vr(u,void 0,c):null})}return ue(e,{...o,ref:r,children:s})});return n.displayName=`${t}.Slot`,n}function u$(t){const e=Re((n,i)=>{const{children:r,...s}=n;if(li(r)){const o=h$(r),a=f$(s,r.props);return r.type!==Be&&(a.ref=i?P_(i,o):o),Vr(r,a)}return Gn.count(r)>1?Gn.only(null):null});return e.displayName=`${t}.SlotClone`,e}var c$=Symbol("radix.slottable");function d$(t){return li(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===c$}function f$(t,e){const n={...e};for(const i in e){const r=t[i],s=e[i];/^on[A-Z]/.test(i)?r&&s?n[i]=(...a)=>{const l=s(...a);return r(...a),l}:r&&(n[i]=r):i==="style"?n[i]={...r,...s}:i==="className"&&(n[i]=[r,s].filter(Boolean).join(" "))}return{...t,...n}}function h$(t){var i,r;let e=(i=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:i.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(r=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var p$=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],ut=p$.reduce((t,e)=>{const n=vc(`Primitive.${e}`),i=Re((r,s)=>{const{asChild:o,...a}=r,l=o?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),ue(l,{...a,ref:s})});return i.displayName=`Primitive.${e}`,{...t,[e]:i}},{});function m$(t,e){t&&yc.flushSync(()=>t.dispatchEvent(e))}function g$(t,e){return Sa((n,i)=>e[n][i]??n,t)}var bc=t=>{const{present:e,children:n}=t,i=y$(e),r=typeof n=="function"?n({present:i.isPresent}):Gn.only(n),s=At(i.ref,v$(r));return typeof n=="function"||i.isPresent?Vr(r,{ref:s}):null};bc.displayName="Presence";function y$(t){const[e,n]=Se(),i=Le(null),r=Le(t),s=Le("none"),o=t?"mounted":"unmounted",[a,l]=g$(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return me(()=>{const u=ch(i.current);s.current=a==="mounted"?u:"none"},[a]),xn(()=>{const u=i.current,c=r.current;if(c!==t){const f=s.current,h=ch(u);t?l("MOUNT"):h==="none"||(u==null?void 0:u.display)==="none"?l("UNMOUNT"):l(c&&f!==h?"ANIMATION_OUT":"UNMOUNT"),r.current=t}},[t,l]),xn(()=>{if(e){let u;const c=e.ownerDocument.defaultView??window,d=h=>{const m=ch(i.current).includes(CSS.escape(h.animationName));if(h.target===e&&m&&(l("ANIMATION_END"),!r.current)){const y=e.style.animationFillMode;e.style.animationFillMode="forwards",u=c.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=y)})}},f=h=>{h.target===e&&(s.current=ch(i.current))};return e.addEventListener("animationstart",f),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{c.clearTimeout(u),e.removeEventListener("animationstart",f),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:Ge(u=>{i.current=u?getComputedStyle(u):null,n(u)},[])}}function ch(t){return(t==null?void 0:t.animationName)||"none"}function v$(t){var i,r;let e=(i=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:i.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(r=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var b$=Nd[" useId ".trim().toString()]||(()=>{}),E$=0;function qo(t){const[e,n]=Se(b$());return xn(()=>{n(i=>i??String(E$++))},[t]),t||(e?`radix-${e}`:"")}var dh="Collapsible",[T$]=hr(dh),[S$,d1]=T$(dh),BC=Re((t,e)=>{const{__scopeCollapsible:n,open:i,defaultOpen:r,disabled:s,onOpenChange:o,...a}=t,[l,u]=Rs({prop:i,defaultProp:r??!1,onChange:o,caller:dh});return ue(S$,{scope:n,disabled:s,contentId:qo(),open:l,onOpenToggle:Ge(()=>u(c=>!c),[u]),children:ue(ut.div,{"data-state":h1(l),"data-disabled":s?"":void 0,...a,ref:e})})});BC.displayName=dh;var UC="CollapsibleTrigger",x$=Re((t,e)=>{const{__scopeCollapsible:n,...i}=t,r=d1(UC,n);return ue(ut.button,{type:"button","aria-controls":r.contentId,"aria-expanded":r.open||!1,"data-state":h1(r.open),"data-disabled":r.disabled?"":void 0,disabled:r.disabled,...i,ref:e,onClick:st(t.onClick,r.onOpenToggle)})});x$.displayName=UC;var f1="CollapsibleContent",w$=Re((t,e)=>{const{forceMount:n,...i}=t,r=d1(f1,t.__scopeCollapsible);return ue(bc,{present:n||r.open,children:({present:s})=>ue(_$,{...i,ref:e,present:s})})});w$.displayName=f1;var _$=Re((t,e)=>{const{__scopeCollapsible:n,present:i,children:r,...s}=t,o=d1(f1,n),[a,l]=Se(i),u=Le(null),c=At(e,u),d=Le(0),f=d.current,h=Le(0),p=h.current,m=o.open||a,y=Le(m),g=Le(void 0);return me(()=>{const v=requestAnimationFrame(()=>y.current=!1);return()=>cancelAnimationFrame(v)},[]),xn(()=>{const v=u.current;if(v){g.current=g.current||{transitionDuration:v.style.transitionDuration,animationName:v.style.animationName},v.style.transitionDuration="0s",v.style.animationName="none";const b=v.getBoundingClientRect();d.current=b.height,h.current=b.width,y.current||(v.style.transitionDuration=g.current.transitionDuration,v.style.animationName=g.current.animationName),l(i)}},[o.open,i]),ue(ut.div,{"data-state":h1(o.open),"data-disabled":o.disabled?"":void 0,id:o.contentId,hidden:!m,...s,ref:c,style:{"--radix-collapsible-content-height":f?`${f}px`:void 0,"--radix-collapsible-content-width":p?`${p}px`:void 0,...t.style},children:m&&r})});function h1(t){return t?"open":"closed"}var A$=BC;const C$=async(t,e)=>{const n=t.get({id:e,type:"Canvas"});if(!(n!=null&&n.annotations)||!n.annotations[0])return[];const r=t.get(n.annotations).filter(o=>o.items?o:!1),s=[];for(const o of r)if(o.items.length>0){const a=o.label||{none:["Annotations"]};s.push({...o,label:a})}else{let a={};try{a=await t.load(o.id)}catch(l){console.log(l)}if(a.items&&a.items.length>0){const l=a.label||{none:["Annotations"]};s.push({...a,label:l})}}return s},HC=async(t,e,n)=>{try{if(n==null||n.q==null)return{};const i=n.q.trim(),r=new URL(e);return r.searchParams.set("q",i),await t.load(r.toString())}catch(i){return console.warn("Error in getContentSearchResources:",i),{}}},$C=(t,e,n,i)=>{var o,a;const r={canvas:void 0,accompanyingCanvas:void 0,annotationPage:void 0,annotations:[]},s=l=>{if(l){if(!l.body||!l.motivation){console.error("Invalid annotation after Hyperion parsing: missing either 'body' or 'motivation'",l);return}let u=l.body;Array.isArray(u)&&(u=u[0]);const c=t.get(u.id);if(!c)return;switch(n){case"painting":return l.target===e.id&&l.motivation&&l.motivation[0]==="painting"&&i.includes(c.type)&&(l.body=c),!!l;case"supplementing":return;default:throw new Error("Invalid annotation motivation.")}}};if(r.canvas=t.get(e),r.canvas&&(r.annotationPage=t.get(r.canvas.items[0]),r.accompanyingCanvas=(o=r.canvas)!=null&&o.accompanyingCanvas?t.get((a=r.canvas)==null?void 0:a.accompanyingCanvas):void 0),r.annotationPage){const l=t.get(r.annotationPage.items).map(c=>({body:t.get(c.body[0].id),motivation:c.motivation,type:"Annotation"})),u=[];l.forEach(c=>{c.body.type==="Choice"?c.body.items.forEach(d=>u.push({...c,id:d.id,body:t.get(d.id)})):u.push(c)}),r.annotations=u.filter(s)}return r},p1=(t,e="en")=>{if(!t)return"";if(!t[e]){const n=Object.getOwnPropertyNames(t);if(n.length>0)return t[n[0]]}return t[e]},Xs=(t,e)=>{const n=$C(t,{id:e,type:"Canvas"},"painting",["Image","Sound","Video"]);if(n.annotations.length!==0&&n.annotations&&n.annotations)return n.annotations.map(i=>i==null?void 0:i.body)},I$=xe("div",{position:"relative",zIndex:"0"}),zC=xe("div",{display:"flex",flexDirection:"row",flexGrow:"1",overflow:"hidden"}),VC=xe("div",{display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"1",width:"100%",height:"100%","&[data-aside-active='true']":{width:"61.8%","@sm":{width:"0",opacity:"0"}},"&[data-aside-toggle='false']":{"@sm":{width:"100% !important",opacity:"1 !important"}}}),R$=xe("aside",{display:"flex",flexGrow:"1",flexShrink:"0",width:"0",maxHeight:"100%","&[data-aside-active='true']":{width:"38.2%","@sm":{width:"100%"}},"&[data-aside-toggle='false']":{"@sm":{width:"0 !important"}}}),L$=xe("div",{display:"flex",flexDirection:"column",fontSmooth:"auto",webkitFontSmoothing:"antialiased",'&[data-absolute-position="true"]':{position:"absolute",width:"100%",height:"100%",zIndex:"0"},"> div":{display:"flex",flexDirection:"column",flexGrow:"1",justifyContent:"flex-start",height:"100%",maxHeight:"100%","@sm":{[`& ${zC}`]:{flexGrow:"1"},[`& ${VC}`]:{flexGrow:"0"}}},"@sm":{padding:"0"},"&[data-information-panel-open='true']":{"@sm":{}}});function GC(t){const e=t+"CollectionProvider",[n,i]=hr(e),[r,s]=n(e,{collectionRef:{current:null},itemMap:new Map}),o=m=>{const{scope:y,children:g}=m,v=lt.useRef(null),b=lt.useRef(new Map).current;return ue(r,{scope:y,itemMap:b,collectionRef:v,children:g})};o.displayName=e;const a=t+"CollectionSlot",l=vc(a),u=lt.forwardRef((m,y)=>{const{scope:g,children:v}=m,b=s(a,g),T=At(y,b.collectionRef);return ue(l,{ref:T,children:v})});u.displayName=a;const c=t+"CollectionItemSlot",d="data-radix-collection-item",f=vc(c),h=lt.forwardRef((m,y)=>{const{scope:g,children:v,...b}=m,T=lt.useRef(null),S=At(y,T),_=s(c,g);return lt.useEffect(()=>(_.itemMap.set(T,{ref:T,...b}),()=>void _.itemMap.delete(T))),ue(f,{[d]:"",ref:S,children:v})});h.displayName=c;function p(m){const y=s(t+"CollectionConsumer",m);return lt.useCallback(()=>{const v=y.collectionRef.current;if(!v)return[];const b=Array.from(v.querySelectorAll(`[${d}]`));return Array.from(y.itemMap.values()).sort((_,A)=>b.indexOf(_.ref.current)-b.indexOf(A.ref.current))},[y.collectionRef,y.itemMap])}return[{Provider:o,Slot:u,ItemSlot:h},p,i]}function Qs(t){const e=Le(t);return me(()=>{e.current=t}),en(()=>(...n)=>{var i;return(i=e.current)==null?void 0:i.call(e,...n)},[])}var P$=zi(void 0);function fh(t){const e=ur(P$);return t||e||"ltr"}var m1="rovingFocusGroup.onEntryFocus",k$={bubbles:!1,cancelable:!0},Ec="RovingFocusGroup",[g1,jC,D$]=GC(Ec),[O$,hh]=hr(Ec,[D$]),[N$,M$]=O$(Ec),WC=Re((t,e)=>ue(g1.Provider,{scope:t.__scopeRovingFocusGroup,children:ue(g1.Slot,{scope:t.__scopeRovingFocusGroup,children:ue(F$,{...t,ref:e})})}));WC.displayName=Ec;var F$=Re((t,e)=>{const{__scopeRovingFocusGroup:n,orientation:i,loop:r=!1,dir:s,currentTabStopId:o,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:l,onEntryFocus:u,preventScrollOnEntryFocus:c=!1,...d}=t,f=Le(null),h=At(e,f),p=fh(s),[m,y]=Rs({prop:o,defaultProp:a??null,onChange:l,caller:Ec}),[g,v]=Se(!1),b=Qs(u),T=jC(n),S=Le(!1),[_,A]=Se(0);return me(()=>{const P=f.current;if(P)return P.addEventListener(m1,b),()=>P.removeEventListener(m1,b)},[b]),ue(N$,{scope:n,orientation:i,dir:p,loop:r,currentTabStopId:m,onItemFocus:Ge(P=>y(P),[y]),onItemShiftTab:Ge(()=>v(!0),[]),onFocusableItemAdd:Ge(()=>A(P=>P+1),[]),onFocusableItemRemove:Ge(()=>A(P=>P-1),[]),children:ue(ut.div,{tabIndex:g||_===0?-1:0,"data-orientation":i,...d,ref:h,style:{outline:"none",...t.style},onMouseDown:st(t.onMouseDown,()=>{S.current=!0}),onFocus:st(t.onFocus,P=>{const O=!S.current;if(P.target===P.currentTarget&&O&&!g){const x=new CustomEvent(m1,k$);if(P.currentTarget.dispatchEvent(x),!x.defaultPrevented){const L=T().filter(j=>j.focusable),M=L.find(j=>j.active),V=L.find(j=>j.id===m),U=[M,V,...L].filter(Boolean).map(j=>j.ref.current);YC(U,c)}}S.current=!1}),onBlur:st(t.onBlur,()=>v(!1))})})}),qC="RovingFocusGroupItem",KC=Re((t,e)=>{const{__scopeRovingFocusGroup:n,focusable:i=!0,active:r=!1,tabStopId:s,children:o,...a}=t,l=qo(),u=s||l,c=M$(qC,n),d=c.currentTabStopId===u,f=jC(n),{onFocusableItemAdd:h,onFocusableItemRemove:p,currentTabStopId:m}=c;return me(()=>{if(i)return h(),()=>p()},[i,h,p]),ue(g1.ItemSlot,{scope:n,id:u,focusable:i,active:r,children:ue(ut.span,{tabIndex:d?0:-1,"data-orientation":c.orientation,...a,ref:e,onMouseDown:st(t.onMouseDown,y=>{i?c.onItemFocus(u):y.preventDefault()}),onFocus:st(t.onFocus,()=>c.onItemFocus(u)),onKeyDown:st(t.onKeyDown,y=>{if(y.key==="Tab"&&y.shiftKey){c.onItemShiftTab();return}if(y.target!==y.currentTarget)return;const g=H$(y,c.orientation,c.dir);if(g!==void 0){if(y.metaKey||y.ctrlKey||y.altKey||y.shiftKey)return;y.preventDefault();let b=f().filter(T=>T.focusable).map(T=>T.ref.current);if(g==="last")b.reverse();else if(g==="prev"||g==="next"){g==="prev"&&b.reverse();const T=b.indexOf(y.currentTarget);b=c.loop?$$(b,T+1):b.slice(T+1)}setTimeout(()=>YC(b))}}),children:typeof o=="function"?o({isCurrentTabStop:d,hasTabStop:m!=null}):o})})});KC.displayName=qC;var B$={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function U$(t,e){return e!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function H$(t,e,n){const i=U$(t.key,n);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(i))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(i)))return B$[i]}function YC(t,e=!1){const n=document.activeElement;for(const i of t)if(i===n||(i.focus({preventScroll:e}),document.activeElement!==n))return}function $$(t,e){return t.map((n,i)=>t[(e+i)%t.length])}var XC=WC,QC=KC,ph="Tabs",[z$]=hr(ph,[hh]),ZC=hh(),[V$,y1]=z$(ph),JC=Re((t,e)=>{const{__scopeTabs:n,value:i,onValueChange:r,defaultValue:s,orientation:o="horizontal",dir:a,activationMode:l="automatic",...u}=t,c=fh(a),[d,f]=Rs({prop:i,onChange:r,defaultProp:s??"",caller:ph});return ue(V$,{scope:n,baseId:qo(),value:d,onValueChange:f,orientation:o,dir:c,activationMode:l,children:ue(ut.div,{dir:c,"data-orientation":o,...u,ref:e})})});JC.displayName=ph;var eI="TabsList",tI=Re((t,e)=>{const{__scopeTabs:n,loop:i=!0,...r}=t,s=y1(eI,n),o=ZC(n);return ue(XC,{asChild:!0,...o,orientation:s.orientation,dir:s.dir,loop:i,children:ue(ut.div,{role:"tablist","aria-orientation":s.orientation,...r,ref:e})})});tI.displayName=eI;var nI="TabsTrigger",iI=Re((t,e)=>{const{__scopeTabs:n,value:i,disabled:r=!1,...s}=t,o=y1(nI,n),a=ZC(n),l=oI(o.baseId,i),u=aI(o.baseId,i),c=i===o.value;return ue(QC,{asChild:!0,...a,focusable:!r,active:c,children:ue(ut.button,{type:"button",role:"tab","aria-selected":c,"aria-controls":u,"data-state":c?"active":"inactive","data-disabled":r?"":void 0,disabled:r,id:l,...s,ref:e,onMouseDown:st(t.onMouseDown,d=>{!r&&d.button===0&&d.ctrlKey===!1?o.onValueChange(i):d.preventDefault()}),onKeyDown:st(t.onKeyDown,d=>{[" ","Enter"].includes(d.key)&&o.onValueChange(i)}),onFocus:st(t.onFocus,()=>{const d=o.activationMode!=="manual";!c&&!r&&d&&o.onValueChange(i)})})})});iI.displayName=nI;var rI="TabsContent",sI=Re((t,e)=>{const{__scopeTabs:n,value:i,forceMount:r,children:s,...o}=t,a=y1(rI,n),l=oI(a.baseId,i),u=aI(a.baseId,i),c=i===a.value,d=Le(c);return me(()=>{const f=requestAnimationFrame(()=>d.current=!1);return()=>cancelAnimationFrame(f)},[]),ue(bc,{present:r||c,children:({present:f})=>ue(ut.div,{"data-state":c?"active":"inactive","data-orientation":a.orientation,role:"tabpanel","aria-labelledby":l,hidden:!f,id:u,tabIndex:0,...o,ref:e,style:{...t.style,animationDuration:d.current?"0s":void 0},children:f&&s})})});sI.displayName=rI;function oI(t,e){return`${t}-trigger-${e}`}function aI(t,e){return`${t}-content-${e}`}var G$=JC,j$=tI,W$=iI,q$=sI;const K$=xe(G$,{display:"flex",flexDirection:"column",width:"100%",height:"100%",flexGrow:"1",flexShrink:"0",position:"relative",zIndex:"1",maskImage:"linear-gradient(180deg, rgba(0, 0, 0, 1) calc(100% -  2rem), transparent 100%)","@sm":{marginTop:"0.5rem",boxShadow:"none"}}),Y$=xe(j$,{display:"flex",flexGrow:"0",margin:"0 1.618rem",borderBottom:"5px solid #6663","@sm":{margin:"0 1rem"}}),Tc=xe(W$,{display:"flex",position:"relative",padding:"0.5rem 1.618rem",background:"none",backgroundColor:"transparent",fontFamily:"inherit",border:"none",opacity:"0.7",fontSize:"1rem",lineHeight:"1rem",whiteSpace:"nowrap",cursor:"pointer",fontWeight:400,transition:"$all","&[data-value='manifest-back']":{display:"none;","@sm":{display:"block"}},"&::after":{width:"0",height:"4px",content:"",position:"absolute",bottom:"-4px",left:"0",transition:"$all"},"&[data-state='active']":{opacity:"1",fontWeight:700,"&::after":{width:"100%",backgroundColor:"$accent"}}}),mh=xe(q$,{display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"0",position:"absolute",top:"0",left:"0","&[data-state='active']":{width:"100%",height:"calc(100% - 2rem)",padding:"1.618rem 0"}}),X$=xe(({handleScroll:t,children:e,className:n})=>k("div",{className:n,onScroll:t},e),{position:"relative",height:"100%",width:"100%",overflowY:"scroll"}),lI={position:"relative",display:"flex",margin:"0 1.618rem",padding:"0.5rem 0",fontFamily:"inherit",fontSize:"0.8333rem",lineHeight:"1.47rem",color:"inherit",background:"none",borderRadius:"3px",border:"none"},gh=xe("button",{textAlign:"left","&:hover":{color:"$accent"}}),v1=xe("div",{display:"flex",flexDirection:"column",width:"100%",header:{margin:"0 1.618rem 0.5rem ",fontWeight:700,fontSize:"0.8333rem",em:{fontStyle:"normal",fontWeight:400,opacity:.7}},paddingBottom:"1rem",marginBottom:"1rem",borderBottom:"1px solid #0001"}),yh=xe("div",{gap:"1rem",fontSize:"1rem",lineHeight:"1.47em",margin:"0","&[data-content-search=true]":{em:{fontWeight:700,display:"inline"}}}),Q$=xe("div",{...lI,display:"flex",flexDirection:"row",gap:"1rem","&[data-format='text/vtt']":{marginTop:"-1rem","> span":{display:"none"}},"> span":{display:"flex",width:"2rem",height:"2rem",backgroundColor:"#0001",flexShrink:"0",borderRadius:"3px",marginTop:"0.25rem"},[`&[dir=rtl] ${yh}`]:{textAlign:"right !important"}}),Z$=({value:t,handleClick:e})=>k(gh,{onClick:e},k(yh,{dangerouslySetInnerHTML:{__html:t}})),J$=({caption:t,handleClick:e,imageUri:n})=>k(gh,{onClick:e},k("img",{src:n,alt:`A visual annotation for ${t}`}),k("span",null,t)),uI=-1,vh=0,Sc=1,bh=2,b1=3,E1=4,T1=5,S1=6,cI=7,dI=8,fI=typeof self=="object"?self:globalThis,ez=(t,e)=>{const n=(r,s)=>(t.set(s,r),r),i=r=>{if(t.has(r))return t.get(r);const[s,o]=e[r];switch(s){case vh:case uI:return n(o,r);case Sc:{const a=n([],r);for(const l of o)a.push(i(l));return a}case bh:{const a=n({},r);for(const[l,u]of o)a[i(l)]=i(u);return a}case b1:return n(new Date(o),r);case E1:{const{source:a,flags:l}=o;return n(new RegExp(a,l),r)}case T1:{const a=n(new Map,r);for(const[l,u]of o)a.set(i(l),i(u));return a}case S1:{const a=n(new Set,r);for(const l of o)a.add(i(l));return a}case cI:{const{name:a,message:l}=o;return n(new fI[a](l),r)}case dI:return n(BigInt(o),r);case"BigInt":return n(Object(BigInt(o)),r);case"ArrayBuffer":return n(new Uint8Array(o).buffer,o);case"DataView":{const{buffer:a}=new Uint8Array(o);return n(new DataView(a),o)}}return n(new fI[s](o),r)};return i},hI=t=>ez(new Map,t)(0),dl="",{toString:tz}={},{keys:nz}=Object,xc=t=>{const e=typeof t;if(e!=="object"||!t)return[vh,e];const n=tz.call(t).slice(8,-1);switch(n){case"Array":return[Sc,dl];case"Object":return[bh,dl];case"Date":return[b1,dl];case"RegExp":return[E1,dl];case"Map":return[T1,dl];case"Set":return[S1,dl];case"DataView":return[Sc,n]}return n.includes("Array")?[Sc,n]:n.includes("Error")?[cI,n]:[bh,n]},Eh=([t,e])=>t===vh&&(e==="function"||e==="symbol"),iz=(t,e,n,i)=>{const r=(o,a)=>{const l=i.push(o)-1;return n.set(a,l),l},s=o=>{if(n.has(o))return n.get(o);let[a,l]=xc(o);switch(a){case vh:{let c=o;switch(l){case"bigint":a=dI,c=o.toString();break;case"function":case"symbol":if(t)throw new TypeError("unable to serialize "+l);c=null;break;case"undefined":return r([uI],o)}return r([a,c],o)}case Sc:{if(l){let f=o;return l==="DataView"?f=new Uint8Array(o.buffer):l==="ArrayBuffer"&&(f=new Uint8Array(o)),r([l,[...f]],o)}const c=[],d=r([a,c],o);for(const f of o)c.push(s(f));return d}case bh:{if(l)switch(l){case"BigInt":return r([l,o.toString()],o);case"Boolean":case"Number":case"String":return r([l,o.valueOf()],o)}if(e&&"toJSON"in o)return s(o.toJSON());const c=[],d=r([a,c],o);for(const f of nz(o))(t||!Eh(xc(o[f])))&&c.push([s(f),s(o[f])]);return d}case b1:return r([a,o.toISOString()],o);case E1:{const{source:c,flags:d}=o;return r([a,{source:c,flags:d}],o)}case T1:{const c=[],d=r([a,c],o);for(const[f,h]of o)(t||!(Eh(xc(f))||Eh(xc(h))))&&c.push([s(f),s(h)]);return d}case S1:{const c=[],d=r([a,c],o);for(const f of o)(t||!Eh(xc(f)))&&c.push(s(f));return d}}const{message:u}=o;return r([a,{name:l,message:u}],o)};return s},pI=(t,{json:e,lossy:n}={})=>{const i=[];return iz(!(e||n),!!e,new Map,i)(t),i},fl=typeof structuredClone=="function"?(t,e)=>e&&("json"in e||"lossy"in e)?hI(pI(t,e)):structuredClone(t):(t,e)=>hI(pI(t,e));function aye(){}let wc=class{constructor(e,n,i){this.normal=n,this.property=e,i&&(this.space=i)}};wc.prototype.normal={},wc.prototype.property={},wc.prototype.space=void 0;function mI(t,e){const n={},i={};for(const r of t)Object.assign(n,r.property),Object.assign(i,r.normal);return new wc(n,i,e)}function _c(t){return t.toLowerCase()}let Qn=class{constructor(e,n){this.attribute=n,this.property=e}};Qn.prototype.attribute="",Qn.prototype.booleanish=!1,Qn.prototype.boolean=!1,Qn.prototype.commaOrSpaceSeparated=!1,Qn.prototype.commaSeparated=!1,Qn.prototype.defined=!1,Qn.prototype.mustUseProperty=!1,Qn.prototype.number=!1,Qn.prototype.overloadedBoolean=!1,Qn.prototype.property="",Qn.prototype.spaceSeparated=!1,Qn.prototype.space=void 0;let rz=0;const tt=Ko(),sn=Ko(),x1=Ko(),ve=Ko(),Lt=Ko(),hl=Ko(),gi=Ko();function Ko(){return 2**++rz}const w1=Object.freeze(Object.defineProperty({__proto__:null,boolean:tt,booleanish:sn,commaOrSpaceSeparated:gi,commaSeparated:hl,number:ve,overloadedBoolean:x1,spaceSeparated:Lt},Symbol.toStringTag,{value:"Module"})),_1=Object.keys(w1);let A1=class extends Qn{constructor(e,n,i,r){let s=-1;if(super(e,n),gI(this,"space",r),typeof i=="number")for(;++s<_1.length;){const o=_1[s];gI(this,_1[s],(i&w1[o])===w1[o])}}};A1.prototype.defined=!0;function gI(t,e,n){n&&(t[e]=n)}function pl(t){const e={},n={};for(const[i,r]of Object.entries(t.properties)){const s=new A1(i,t.transform(t.attributes||{},i),r,t.space);t.mustUseProperty&&t.mustUseProperty.includes(i)&&(s.mustUseProperty=!0),e[i]=s,n[_c(i)]=i,n[_c(s.attribute)]=i}return new wc(e,n,t.space)}const yI=pl({properties:{ariaActiveDescendant:null,ariaAtomic:sn,ariaAutoComplete:null,ariaBusy:sn,ariaChecked:sn,ariaColCount:ve,ariaColIndex:ve,ariaColSpan:ve,ariaControls:Lt,ariaCurrent:null,ariaDescribedBy:Lt,ariaDetails:null,ariaDisabled:sn,ariaDropEffect:Lt,ariaErrorMessage:null,ariaExpanded:sn,ariaFlowTo:Lt,ariaGrabbed:sn,ariaHasPopup:null,ariaHidden:sn,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:Lt,ariaLevel:ve,ariaLive:null,ariaModal:sn,ariaMultiLine:sn,ariaMultiSelectable:sn,ariaOrientation:null,ariaOwns:Lt,ariaPlaceholder:null,ariaPosInSet:ve,ariaPressed:sn,ariaReadOnly:sn,ariaRelevant:null,ariaRequired:sn,ariaRoleDescription:Lt,ariaRowCount:ve,ariaRowIndex:ve,ariaRowSpan:ve,ariaSelected:sn,ariaSetSize:ve,ariaSort:null,ariaValueMax:ve,ariaValueMin:ve,ariaValueNow:ve,ariaValueText:null,role:null},transform(t,e){return e==="role"?e:"aria-"+e.slice(4).toLowerCase()}});function vI(t,e){return e in t?t[e]:e}function bI(t,e){return vI(t,e.toLowerCase())}const sz=pl({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:hl,acceptCharset:Lt,accessKey:Lt,action:null,allow:null,allowFullScreen:tt,allowPaymentRequest:tt,allowUserMedia:tt,alt:null,as:null,async:tt,autoCapitalize:null,autoComplete:Lt,autoFocus:tt,autoPlay:tt,blocking:Lt,capture:null,charSet:null,checked:tt,cite:null,className:Lt,cols:ve,colSpan:null,content:null,contentEditable:sn,controls:tt,controlsList:Lt,coords:ve|hl,crossOrigin:null,data:null,dateTime:null,decoding:null,default:tt,defer:tt,dir:null,dirName:null,disabled:tt,download:x1,draggable:sn,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:tt,formTarget:null,headers:Lt,height:ve,hidden:x1,high:ve,href:null,hrefLang:null,htmlFor:Lt,httpEquiv:Lt,id:null,imageSizes:null,imageSrcSet:null,inert:tt,inputMode:null,integrity:null,is:null,isMap:tt,itemId:null,itemProp:Lt,itemRef:Lt,itemScope:tt,itemType:Lt,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:tt,low:ve,manifest:null,max:null,maxLength:ve,media:null,method:null,min:null,minLength:ve,multiple:tt,muted:tt,name:null,nonce:null,noModule:tt,noValidate:tt,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:tt,optimum:ve,pattern:null,ping:Lt,placeholder:null,playsInline:tt,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:tt,referrerPolicy:null,rel:Lt,required:tt,reversed:tt,rows:ve,rowSpan:ve,sandbox:Lt,scope:null,scoped:tt,seamless:tt,selected:tt,shadowRootClonable:tt,shadowRootDelegatesFocus:tt,shadowRootMode:null,shape:null,size:ve,sizes:null,slot:null,span:ve,spellCheck:sn,src:null,srcDoc:null,srcLang:null,srcSet:null,start:ve,step:null,style:null,tabIndex:ve,target:null,title:null,translate:null,type:null,typeMustMatch:tt,useMap:null,value:sn,width:ve,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:Lt,axis:null,background:null,bgColor:null,border:ve,borderColor:null,bottomMargin:ve,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:tt,declare:tt,event:null,face:null,frame:null,frameBorder:null,hSpace:ve,leftMargin:ve,link:null,longDesc:null,lowSrc:null,marginHeight:ve,marginWidth:ve,noResize:tt,noHref:tt,noShade:tt,noWrap:tt,object:null,profile:null,prompt:null,rev:null,rightMargin:ve,rules:null,scheme:null,scrolling:sn,standby:null,summary:null,text:null,topMargin:ve,valueType:null,version:null,vAlign:null,vLink:null,vSpace:ve,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:tt,disableRemotePlayback:tt,prefix:null,property:null,results:ve,security:null,unselectable:null},space:"html",transform:bI}),oz=pl({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:gi,accentHeight:ve,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:ve,amplitude:ve,arabicForm:null,ascent:ve,attributeName:null,attributeType:null,azimuth:ve,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:ve,by:null,calcMode:null,capHeight:ve,className:Lt,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:ve,diffuseConstant:ve,direction:null,display:null,dur:null,divisor:ve,dominantBaseline:null,download:tt,dx:null,dy:null,edgeMode:null,editable:null,elevation:ve,enableBackground:null,end:null,event:null,exponent:ve,externalResourcesRequired:null,fill:null,fillOpacity:ve,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:hl,g2:hl,glyphName:hl,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:ve,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:ve,horizOriginX:ve,horizOriginY:ve,id:null,ideographic:ve,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:ve,k:ve,k1:ve,k2:ve,k3:ve,k4:ve,kernelMatrix:gi,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:ve,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:ve,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:ve,overlineThickness:ve,paintOrder:null,panose1:null,path:null,pathLength:ve,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:Lt,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:ve,pointsAtY:ve,pointsAtZ:ve,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:gi,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:gi,rev:gi,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:gi,requiredFeatures:gi,requiredFonts:gi,requiredFormats:gi,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:ve,specularExponent:ve,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:ve,strikethroughThickness:ve,string:null,stroke:null,strokeDashArray:gi,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:ve,strokeOpacity:ve,strokeWidth:null,style:null,surfaceScale:ve,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:gi,tabIndex:ve,tableValues:null,target:null,targetX:ve,targetY:ve,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:gi,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:ve,underlineThickness:ve,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:ve,values:null,vAlphabetic:ve,vMathematical:ve,vectorEffect:null,vHanging:ve,vIdeographic:ve,version:null,vertAdvY:ve,vertOriginX:ve,vertOriginY:ve,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:ve,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:vI}),EI=pl({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(t,e){return"xlink:"+e.slice(5).toLowerCase()}}),TI=pl({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:bI}),SI=pl({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(t,e){return"xml:"+e.slice(3).toLowerCase()}}),az=/[A-Z]/g,xI=/-[a-z]/g,lz=/^data[-\w.:]+$/i;function uz(t,e){const n=_c(e);let i=e,r=Qn;if(n in t.normal)return t.property[t.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&lz.test(e)){if(e.charAt(4)==="-"){const s=e.slice(5).replace(xI,dz);i="data"+s.charAt(0).toUpperCase()+s.slice(1)}else{const s=e.slice(4);if(!xI.test(s)){let o=s.replace(az,cz);o.charAt(0)!=="-"&&(o="-"+o),e="data"+o}}r=A1}return new r(i,e)}function cz(t){return"-"+t.toLowerCase()}function dz(t){return t.charAt(1).toUpperCase()}const fz=mI([yI,sz,EI,TI,SI],"html"),hz=mI([yI,oz,EI,TI,SI],"svg");function wI(t){const e=[],n=String(t||"");let i=n.indexOf(","),r=0,s=!1;for(;!s;){i===-1&&(i=n.length,s=!0);const o=n.slice(r,i).trim();(o||!s)&&e.push(o),r=i+1,i=n.indexOf(",",r)}return e}function _I(t,e){const n=e||{};return(t[t.length-1]===""?[...t,""]:t).join((n.padRight?" ":"")+","+(n.padLeft===!1?"":" ")).trim()}const AI=/[#.]/g;function pz(t,e){const n=t||"",i={};let r=0,s,o;for(;r<n.length;){AI.lastIndex=r;const a=AI.exec(n),l=n.slice(r,a?a.index:n.length);l&&(s?s==="#"?i.id=l:Array.isArray(i.className)?i.className.push(l):i.className=[l]:o=l,r+=l.length),a&&(s=a[0],r++)}return{type:"element",tagName:o||e||"div",properties:i,children:[]}}function CI(t){const e=String(t||"").trim();return e?e.split(/[ \t\n\r\f]+/g):[]}function II(t){return t.join(" ").trim()}function RI(t,e,n){const i=n?vz(n):void 0;function r(s,o,...a){let l;if(s==null){l={type:"root",children:[]};const u=o;a.unshift(u)}else{l=pz(s,e);const u=l.tagName.toLowerCase(),c=i?i.get(u):void 0;if(l.tagName=c||u,mz(o))a.unshift(o);else for(const[d,f]of Object.entries(o))gz(t,l.properties,d,f)}for(const u of a)C1(l.children,u);return l.type==="element"&&l.tagName==="template"&&(l.content={type:"root",children:l.children},l.children=[]),l}return r}function mz(t){if(t===null||typeof t!="object"||Array.isArray(t))return!0;if(typeof t.type!="string")return!1;const e=t,n=Object.keys(t);for(const i of n){const r=e[i];if(r&&typeof r=="object"){if(!Array.isArray(r))return!0;const s=r;for(const o of s)if(typeof o!="number"&&typeof o!="string")return!0}}return!!("children"in t&&Array.isArray(t.children))}function gz(t,e,n,i){const r=uz(t,n);let s;if(i!=null){if(typeof i=="number"){if(Number.isNaN(i))return;s=i}else typeof i=="boolean"?s=i:typeof i=="string"?r.spaceSeparated?s=CI(i):r.commaSeparated?s=wI(i):r.commaOrSpaceSeparated?s=CI(wI(i).join(" ")):s=LI(r,r.property,i):Array.isArray(i)?s=[...i]:s=r.property==="style"?yz(i):String(i);if(Array.isArray(s)){const o=[];for(const a of s)o.push(LI(r,r.property,a));s=o}r.property==="className"&&Array.isArray(e.className)&&(s=e.className.concat(s)),e[r.property]=s}}function C1(t,e){if(e!=null)if(typeof e=="number"||typeof e=="string")t.push({type:"text",value:String(e)});else if(Array.isArray(e))for(const n of e)C1(t,n);else if(typeof e=="object"&&"type"in e)e.type==="root"?C1(t,e.children):t.push(e);else throw new Error("Expected node, nodes, or string, got `"+e+"`")}function LI(t,e,n){if(typeof n=="string"){if(t.number&&n&&!Number.isNaN(Number(n)))return Number(n);if((t.boolean||t.overloadedBoolean)&&(n===""||_c(n)===_c(e)))return!0}return n}function yz(t){const e=[];for(const[n,i]of Object.entries(t))e.push([n,i].join(": "));return e.join("; ")}function vz(t){const e=new Map;for(const n of t)e.set(n.toLowerCase(),n);return e}const bz=["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","solidColor","textArea","textPath"],Ez=RI(fz,"div"),Tz=RI(hz,"g",bz);let Ac=class{constructor(e,n,i){this.normal=n,this.property=e,i&&(this.space=i)}};Ac.prototype.normal={},Ac.prototype.property={},Ac.prototype.space=void 0;function PI(t,e){const n={},i={};for(const r of t)Object.assign(n,r.property),Object.assign(i,r.normal);return new Ac(n,i,e)}function I1(t){return t.toLowerCase()}let Zn=class{constructor(e,n){this.attribute=n,this.property=e}};Zn.prototype.attribute="",Zn.prototype.booleanish=!1,Zn.prototype.boolean=!1,Zn.prototype.commaOrSpaceSeparated=!1,Zn.prototype.commaSeparated=!1,Zn.prototype.defined=!1,Zn.prototype.mustUseProperty=!1,Zn.prototype.number=!1,Zn.prototype.overloadedBoolean=!1,Zn.prototype.property="",Zn.prototype.spaceSeparated=!1,Zn.prototype.space=void 0;let Sz=0;const nt=Yo(),on=Yo(),R1=Yo(),be=Yo(),Pt=Yo(),ml=Yo(),yi=Yo();function Yo(){return 2**++Sz}const L1=Object.freeze(Object.defineProperty({__proto__:null,boolean:nt,booleanish:on,commaOrSpaceSeparated:yi,commaSeparated:ml,number:be,overloadedBoolean:R1,spaceSeparated:Pt},Symbol.toStringTag,{value:"Module"})),P1=Object.keys(L1);let k1=class extends Zn{constructor(e,n,i,r){let s=-1;if(super(e,n),kI(this,"space",r),typeof i=="number")for(;++s<P1.length;){const o=P1[s];kI(this,P1[s],(i&L1[o])===L1[o])}}};k1.prototype.defined=!0;function kI(t,e,n){n&&(t[e]=n)}function gl(t){const e={},n={};for(const[i,r]of Object.entries(t.properties)){const s=new k1(i,t.transform(t.attributes||{},i),r,t.space);t.mustUseProperty&&t.mustUseProperty.includes(i)&&(s.mustUseProperty=!0),e[i]=s,n[I1(i)]=i,n[I1(s.attribute)]=i}return new Ac(e,n,t.space)}const DI=gl({properties:{ariaActiveDescendant:null,ariaAtomic:on,ariaAutoComplete:null,ariaBusy:on,ariaChecked:on,ariaColCount:be,ariaColIndex:be,ariaColSpan:be,ariaControls:Pt,ariaCurrent:null,ariaDescribedBy:Pt,ariaDetails:null,ariaDisabled:on,ariaDropEffect:Pt,ariaErrorMessage:null,ariaExpanded:on,ariaFlowTo:Pt,ariaGrabbed:on,ariaHasPopup:null,ariaHidden:on,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:Pt,ariaLevel:be,ariaLive:null,ariaModal:on,ariaMultiLine:on,ariaMultiSelectable:on,ariaOrientation:null,ariaOwns:Pt,ariaPlaceholder:null,ariaPosInSet:be,ariaPressed:on,ariaReadOnly:on,ariaRelevant:null,ariaRequired:on,ariaRoleDescription:Pt,ariaRowCount:be,ariaRowIndex:be,ariaRowSpan:be,ariaSelected:on,ariaSetSize:be,ariaSort:null,ariaValueMax:be,ariaValueMin:be,ariaValueNow:be,ariaValueText:null,role:null},transform(t,e){return e==="role"?e:"aria-"+e.slice(4).toLowerCase()}});function OI(t,e){return e in t?t[e]:e}function NI(t,e){return OI(t,e.toLowerCase())}const xz=gl({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:ml,acceptCharset:Pt,accessKey:Pt,action:null,allow:null,allowFullScreen:nt,allowPaymentRequest:nt,allowUserMedia:nt,alt:null,as:null,async:nt,autoCapitalize:null,autoComplete:Pt,autoFocus:nt,autoPlay:nt,blocking:Pt,capture:null,charSet:null,checked:nt,cite:null,className:Pt,cols:be,colSpan:null,content:null,contentEditable:on,controls:nt,controlsList:Pt,coords:be|ml,crossOrigin:null,data:null,dateTime:null,decoding:null,default:nt,defer:nt,dir:null,dirName:null,disabled:nt,download:R1,draggable:on,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:nt,formTarget:null,headers:Pt,height:be,hidden:R1,high:be,href:null,hrefLang:null,htmlFor:Pt,httpEquiv:Pt,id:null,imageSizes:null,imageSrcSet:null,inert:nt,inputMode:null,integrity:null,is:null,isMap:nt,itemId:null,itemProp:Pt,itemRef:Pt,itemScope:nt,itemType:Pt,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:nt,low:be,manifest:null,max:null,maxLength:be,media:null,method:null,min:null,minLength:be,multiple:nt,muted:nt,name:null,nonce:null,noModule:nt,noValidate:nt,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:nt,optimum:be,pattern:null,ping:Pt,placeholder:null,playsInline:nt,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:nt,referrerPolicy:null,rel:Pt,required:nt,reversed:nt,rows:be,rowSpan:be,sandbox:Pt,scope:null,scoped:nt,seamless:nt,selected:nt,shadowRootClonable:nt,shadowRootDelegatesFocus:nt,shadowRootMode:null,shape:null,size:be,sizes:null,slot:null,span:be,spellCheck:on,src:null,srcDoc:null,srcLang:null,srcSet:null,start:be,step:null,style:null,tabIndex:be,target:null,title:null,translate:null,type:null,typeMustMatch:nt,useMap:null,value:on,width:be,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:Pt,axis:null,background:null,bgColor:null,border:be,borderColor:null,bottomMargin:be,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:nt,declare:nt,event:null,face:null,frame:null,frameBorder:null,hSpace:be,leftMargin:be,link:null,longDesc:null,lowSrc:null,marginHeight:be,marginWidth:be,noResize:nt,noHref:nt,noShade:nt,noWrap:nt,object:null,profile:null,prompt:null,rev:null,rightMargin:be,rules:null,scheme:null,scrolling:on,standby:null,summary:null,text:null,topMargin:be,valueType:null,version:null,vAlign:null,vLink:null,vSpace:be,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:nt,disableRemotePlayback:nt,prefix:null,property:null,results:be,security:null,unselectable:null},space:"html",transform:NI}),wz=gl({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:yi,accentHeight:be,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:be,amplitude:be,arabicForm:null,ascent:be,attributeName:null,attributeType:null,azimuth:be,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:be,by:null,calcMode:null,capHeight:be,className:Pt,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:be,diffuseConstant:be,direction:null,display:null,dur:null,divisor:be,dominantBaseline:null,download:nt,dx:null,dy:null,edgeMode:null,editable:null,elevation:be,enableBackground:null,end:null,event:null,exponent:be,externalResourcesRequired:null,fill:null,fillOpacity:be,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:ml,g2:ml,glyphName:ml,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:be,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:be,horizOriginX:be,horizOriginY:be,id:null,ideographic:be,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:be,k:be,k1:be,k2:be,k3:be,k4:be,kernelMatrix:yi,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:be,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:be,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:be,overlineThickness:be,paintOrder:null,panose1:null,path:null,pathLength:be,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:Pt,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:be,pointsAtY:be,pointsAtZ:be,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:yi,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:yi,rev:yi,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:yi,requiredFeatures:yi,requiredFonts:yi,requiredFormats:yi,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:be,specularExponent:be,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:be,strikethroughThickness:be,string:null,stroke:null,strokeDashArray:yi,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:be,strokeOpacity:be,strokeWidth:null,style:null,surfaceScale:be,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:yi,tabIndex:be,tableValues:null,target:null,targetX:be,targetY:be,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:yi,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:be,underlineThickness:be,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:be,values:null,vAlphabetic:be,vMathematical:be,vectorEffect:null,vHanging:be,vIdeographic:be,version:null,vertAdvY:be,vertOriginX:be,vertOriginY:be,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:be,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:OI}),MI=gl({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(t,e){return"xlink:"+e.slice(5).toLowerCase()}}),FI=gl({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:NI}),BI=gl({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(t,e){return"xml:"+e.slice(3).toLowerCase()}}),_z=/[A-Z]/g,UI=/-[a-z]/g,Az=/^data[-\w.:]+$/i;function Cz(t,e){const n=I1(e);let i=e,r=Zn;if(n in t.normal)return t.property[t.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&Az.test(e)){if(e.charAt(4)==="-"){const s=e.slice(5).replace(UI,Rz);i="data"+s.charAt(0).toUpperCase()+s.slice(1)}else{const s=e.slice(4);if(!UI.test(s)){let o=s.replace(_z,Iz);o.charAt(0)!=="-"&&(o="-"+o),e="data"+o}}r=k1}return new r(i,e)}function Iz(t){return"-"+t.toLowerCase()}function Rz(t){return t.charAt(1).toUpperCase()}const HI=PI([DI,xz,MI,FI,BI],"html"),$I=PI([DI,wz,MI,FI,BI],"svg");function Lz(t){const e=String(t),n=[];return{toOffset:r,toPoint:i};function i(s){if(typeof s=="number"&&s>-1&&s<=e.length){let o=0;for(;;){let a=n[o];if(a===void 0){const l=zI(e,n[o-1]);a=l===-1?e.length+1:l+1,n[o]=a}if(a>s)return{line:o+1,column:s-(o>0?n[o-1]:0)+1,offset:s};o++}}}function r(s){if(s&&typeof s.line=="number"&&typeof s.column=="number"&&!Number.isNaN(s.line)&&!Number.isNaN(s.column)){for(;n.length<s.line;){const a=n[n.length-1],l=zI(e,a),u=l===-1?e.length+1:l+1;if(a===u)break;n.push(u)}const o=(s.line>1?n[s.line-2]:0)+s.column-1;if(o<n[s.line-1])return o}}}function zI(t,e){const n=t.indexOf("\r",e),i=t.indexOf(`
`,e);return i===-1?n:n===-1||n+1===i?i:n<i?n:i}const Xo={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},VI={}.hasOwnProperty,Pz=Object.prototype;function kz(t,e){const n=e||{};return D1({file:n.file||void 0,location:!1,schema:n.space==="svg"?$I:HI,verbose:n.verbose||!1},t)}function D1(t,e){let n;switch(e.nodeName){case"#comment":{const i=e;return n={type:"comment",value:i.data},Th(t,i,n),n}case"#document":case"#document-fragment":{const i=e,r="mode"in i?i.mode==="quirks"||i.mode==="limited-quirks":!1;if(n={type:"root",children:GI(t,e.childNodes),data:{quirksMode:r}},t.file&&t.location){const s=String(t.file),o=Lz(s),a=o.toPoint(0),l=o.toPoint(s.length);n.position={start:a,end:l}}return n}case"#documentType":{const i=e;return n={type:"doctype"},Th(t,i,n),n}case"#text":{const i=e;return n={type:"text",value:i.value},Th(t,i,n),n}default:return n=Dz(t,e),n}}function GI(t,e){let n=-1;const i=[];for(;++n<e.length;){const r=D1(t,e[n]);i.push(r)}return i}function Dz(t,e){const n=t.schema;t.schema=e.namespaceURI===Xo.svg?$I:HI;let i=-1;const r={};for(;++i<e.attrs.length;){const a=e.attrs[i],l=(a.prefix?a.prefix+":":"")+a.name;VI.call(Pz,l)||(r[l]=a.value)}const o=(t.schema.space==="svg"?Tz:Ez)(e.tagName,r,GI(t,e.childNodes));if(Th(t,e,o),o.tagName==="template"){const a=e,l=a.sourceCodeLocation,u=l&&l.startTag&&yl(l.startTag),c=l&&l.endTag&&yl(l.endTag),d=D1(t,a.content);u&&c&&t.file&&(d.position={start:u.end,end:c.start}),o.content=d}return t.schema=n,o}function Th(t,e,n){if("sourceCodeLocation"in e&&e.sourceCodeLocation&&t.file){const i=Oz(t,n,e.sourceCodeLocation);i&&(t.location=!0,n.position=i)}}function Oz(t,e,n){const i=yl(n);if(e.type==="element"){const r=e.children[e.children.length-1];if(i&&!n.endTag&&r&&r.position&&r.position.end&&(i.end=Object.assign({},r.position.end)),t.verbose){const s={};let o;if(n.attrs)for(o in n.attrs)VI.call(n.attrs,o)&&(s[Cz(t.schema,o).property]=yl(n.attrs[o]));n.startTag;const a=yl(n.startTag),l=n.endTag?yl(n.endTag):void 0,u={opening:a};l&&(u.closing=l),u.properties=s,e.data={position:u}}}return i}function yl(t){const e=jI({line:t.startLine,column:t.startCol,offset:t.startOffset}),n=jI({line:t.endLine,column:t.endCol,offset:t.endOffset});return e||n?{start:e,end:n}:void 0}function jI(t){return t.line&&t.column?t:void 0}let Cc=class{constructor(e,n,i){this.property=e,this.normal=n,i&&(this.space=i)}};Cc.prototype.property={},Cc.prototype.normal={},Cc.prototype.space=null;function WI(t,e){const n={},i={};let r=-1;for(;++r<t.length;)Object.assign(n,t[r].property),Object.assign(i,t[r].normal);return new Cc(n,i,e)}function O1(t){return t.toLowerCase()}let Fi=class{constructor(e,n){this.property=e,this.attribute=n}};Fi.prototype.space=null,Fi.prototype.boolean=!1,Fi.prototype.booleanish=!1,Fi.prototype.overloadedBoolean=!1,Fi.prototype.number=!1,Fi.prototype.commaSeparated=!1,Fi.prototype.spaceSeparated=!1,Fi.prototype.commaOrSpaceSeparated=!1,Fi.prototype.mustUseProperty=!1,Fi.prototype.defined=!1;let Nz=0;const Je=Qo(),an=Qo(),qI=Qo(),Ee=Qo(),kt=Qo(),vl=Qo(),vi=Qo();function Qo(){return 2**++Nz}const N1=Object.freeze(Object.defineProperty({__proto__:null,boolean:Je,booleanish:an,commaOrSpaceSeparated:vi,commaSeparated:vl,number:Ee,overloadedBoolean:qI,spaceSeparated:kt},Symbol.toStringTag,{value:"Module"})),M1=Object.keys(N1);let F1=class extends Fi{constructor(e,n,i,r){let s=-1;if(super(e,n),KI(this,"space",r),typeof i=="number")for(;++s<M1.length;){const o=M1[s];KI(this,M1[s],(i&N1[o])===N1[o])}}};F1.prototype.defined=!0;function KI(t,e,n){n&&(t[e]=n)}const Mz={}.hasOwnProperty;function bl(t){const e={},n={};let i;for(i in t.properties)if(Mz.call(t.properties,i)){const r=t.properties[i],s=new F1(i,t.transform(t.attributes||{},i),r,t.space);t.mustUseProperty&&t.mustUseProperty.includes(i)&&(s.mustUseProperty=!0),e[i]=s,n[O1(i)]=i,n[O1(s.attribute)]=i}return new Cc(e,n,t.space)}const YI=bl({space:"xlink",transform(t,e){return"xlink:"+e.slice(5).toLowerCase()},properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null}}),XI=bl({space:"xml",transform(t,e){return"xml:"+e.slice(3).toLowerCase()},properties:{xmlLang:null,xmlBase:null,xmlSpace:null}});function QI(t,e){return e in t?t[e]:e}function ZI(t,e){return QI(t,e.toLowerCase())}const JI=bl({space:"xmlns",attributes:{xmlnsxlink:"xmlns:xlink"},transform:ZI,properties:{xmlns:null,xmlnsXLink:null}}),eR=bl({transform(t,e){return e==="role"?e:"aria-"+e.slice(4).toLowerCase()},properties:{ariaActiveDescendant:null,ariaAtomic:an,ariaAutoComplete:null,ariaBusy:an,ariaChecked:an,ariaColCount:Ee,ariaColIndex:Ee,ariaColSpan:Ee,ariaControls:kt,ariaCurrent:null,ariaDescribedBy:kt,ariaDetails:null,ariaDisabled:an,ariaDropEffect:kt,ariaErrorMessage:null,ariaExpanded:an,ariaFlowTo:kt,ariaGrabbed:an,ariaHasPopup:null,ariaHidden:an,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:kt,ariaLevel:Ee,ariaLive:null,ariaModal:an,ariaMultiLine:an,ariaMultiSelectable:an,ariaOrientation:null,ariaOwns:kt,ariaPlaceholder:null,ariaPosInSet:Ee,ariaPressed:an,ariaReadOnly:an,ariaRelevant:null,ariaRequired:an,ariaRoleDescription:kt,ariaRowCount:Ee,ariaRowIndex:Ee,ariaRowSpan:Ee,ariaSelected:an,ariaSetSize:Ee,ariaSort:null,ariaValueMax:Ee,ariaValueMin:Ee,ariaValueNow:Ee,ariaValueText:null,role:null}}),Fz=bl({space:"html",attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},transform:ZI,mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:vl,acceptCharset:kt,accessKey:kt,action:null,allow:null,allowFullScreen:Je,allowPaymentRequest:Je,allowUserMedia:Je,alt:null,as:null,async:Je,autoCapitalize:null,autoComplete:kt,autoFocus:Je,autoPlay:Je,blocking:kt,capture:null,charSet:null,checked:Je,cite:null,className:kt,cols:Ee,colSpan:null,content:null,contentEditable:an,controls:Je,controlsList:kt,coords:Ee|vl,crossOrigin:null,data:null,dateTime:null,decoding:null,default:Je,defer:Je,dir:null,dirName:null,disabled:Je,download:qI,draggable:an,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:Je,formTarget:null,headers:kt,height:Ee,hidden:Je,high:Ee,href:null,hrefLang:null,htmlFor:kt,httpEquiv:kt,id:null,imageSizes:null,imageSrcSet:null,inert:Je,inputMode:null,integrity:null,is:null,isMap:Je,itemId:null,itemProp:kt,itemRef:kt,itemScope:Je,itemType:kt,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:Je,low:Ee,manifest:null,max:null,maxLength:Ee,media:null,method:null,min:null,minLength:Ee,multiple:Je,muted:Je,name:null,nonce:null,noModule:Je,noValidate:Je,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:Je,optimum:Ee,pattern:null,ping:kt,placeholder:null,playsInline:Je,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:Je,referrerPolicy:null,rel:kt,required:Je,reversed:Je,rows:Ee,rowSpan:Ee,sandbox:kt,scope:null,scoped:Je,seamless:Je,selected:Je,shadowRootClonable:Je,shadowRootDelegatesFocus:Je,shadowRootMode:null,shape:null,size:Ee,sizes:null,slot:null,span:Ee,spellCheck:an,src:null,srcDoc:null,srcLang:null,srcSet:null,start:Ee,step:null,style:null,tabIndex:Ee,target:null,title:null,translate:null,type:null,typeMustMatch:Je,useMap:null,value:an,width:Ee,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:kt,axis:null,background:null,bgColor:null,border:Ee,borderColor:null,bottomMargin:Ee,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:Je,declare:Je,event:null,face:null,frame:null,frameBorder:null,hSpace:Ee,leftMargin:Ee,link:null,longDesc:null,lowSrc:null,marginHeight:Ee,marginWidth:Ee,noResize:Je,noHref:Je,noShade:Je,noWrap:Je,object:null,profile:null,prompt:null,rev:null,rightMargin:Ee,rules:null,scheme:null,scrolling:an,standby:null,summary:null,text:null,topMargin:Ee,valueType:null,version:null,vAlign:null,vLink:null,vSpace:Ee,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:Je,disableRemotePlayback:Je,prefix:null,property:null,results:Ee,security:null,unselectable:null}}),Bz=bl({space:"svg",attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},transform:QI,properties:{about:vi,accentHeight:Ee,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:Ee,amplitude:Ee,arabicForm:null,ascent:Ee,attributeName:null,attributeType:null,azimuth:Ee,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:Ee,by:null,calcMode:null,capHeight:Ee,className:kt,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:Ee,diffuseConstant:Ee,direction:null,display:null,dur:null,divisor:Ee,dominantBaseline:null,download:Je,dx:null,dy:null,edgeMode:null,editable:null,elevation:Ee,enableBackground:null,end:null,event:null,exponent:Ee,externalResourcesRequired:null,fill:null,fillOpacity:Ee,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:vl,g2:vl,glyphName:vl,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:Ee,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:Ee,horizOriginX:Ee,horizOriginY:Ee,id:null,ideographic:Ee,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:Ee,k:Ee,k1:Ee,k2:Ee,k3:Ee,k4:Ee,kernelMatrix:vi,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:Ee,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:Ee,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:Ee,overlineThickness:Ee,paintOrder:null,panose1:null,path:null,pathLength:Ee,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:kt,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:Ee,pointsAtY:Ee,pointsAtZ:Ee,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:vi,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:vi,rev:vi,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:vi,requiredFeatures:vi,requiredFonts:vi,requiredFormats:vi,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:Ee,specularExponent:Ee,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:Ee,strikethroughThickness:Ee,string:null,stroke:null,strokeDashArray:vi,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:Ee,strokeOpacity:Ee,strokeWidth:null,style:null,surfaceScale:Ee,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:vi,tabIndex:Ee,tableValues:null,target:null,targetX:Ee,targetY:Ee,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:vi,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:Ee,underlineThickness:Ee,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:Ee,values:null,vAlphabetic:Ee,vMathematical:Ee,vectorEffect:null,vHanging:Ee,vIdeographic:Ee,version:null,vertAdvY:Ee,vertOriginX:Ee,vertOriginY:Ee,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:Ee,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null}}),Uz=/^data[-\w.:]+$/i,tR=/-[a-z]/g,Hz=/[A-Z]/g;function $z(t,e){const n=O1(e);let i=e,r=Fi;if(n in t.normal)return t.property[t.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&Uz.test(e)){if(e.charAt(4)==="-"){const s=e.slice(5).replace(tR,Vz);i="data"+s.charAt(0).toUpperCase()+s.slice(1)}else{const s=e.slice(4);if(!tR.test(s)){let o=s.replace(Hz,zz);o.charAt(0)!=="-"&&(o="-"+o),e="data"+o}}r=F1}return new r(i,e)}function zz(t){return"-"+t.toLowerCase()}function Vz(t){return t.charAt(1).toUpperCase()}const Gz=WI([XI,YI,JI,eR,Fz],"html"),nR=WI([XI,YI,JI,eR,Bz],"svg"),iR={}.hasOwnProperty;function B1(t,e){const n=e||{};function i(r,...s){let o=i.invalid;const a=i.handlers;if(r&&iR.call(r,t)){const l=String(r[t]);o=iR.call(a,l)?a[l]:i.unknown}if(o)return o.call(this,r,...s)}return i.handlers=n.handlers||{},i.invalid=n.invalid,i.unknown=n.unknown,i}const jz={},Wz={}.hasOwnProperty,rR=B1("type",{handlers:{root:Kz,element:Jz,text:Qz,comment:Zz,doctype:Xz}});function qz(t,e){const i=(e||jz).space;return rR(t,i==="svg"?nR:Gz)}function Kz(t,e){const n={nodeName:"#document",mode:(t.data||{}).quirksMode?"quirks":"no-quirks",childNodes:[]};return n.childNodes=U1(t.children,n,e),El(t,n),n}function Yz(t,e){const n={nodeName:"#document-fragment",childNodes:[]};return n.childNodes=U1(t.children,n,e),El(t,n),n}function Xz(t){const e={nodeName:"#documentType",name:"html",publicId:"",systemId:"",parentNode:null};return El(t,e),e}function Qz(t){const e={nodeName:"#text",value:t.value,parentNode:null};return El(t,e),e}function Zz(t){const e={nodeName:"#comment",data:t.value,parentNode:null};return El(t,e),e}function Jz(t,e){const n=e;let i=n;t.type==="element"&&t.tagName.toLowerCase()==="svg"&&n.space==="html"&&(i=nR);const r=[];let s;if(t.properties){for(s in t.properties)if(s!=="children"&&Wz.call(t.properties,s)){const l=eV(i,s,t.properties[s]);l&&r.push(l)}}const o=i.space,a={nodeName:t.tagName,tagName:t.tagName,attrs:r,namespaceURI:Xo[o],childNodes:[],parentNode:null};return a.childNodes=U1(t.children,a,i),El(t,a),t.tagName==="template"&&t.content&&(a.content=Yz(t.content,i)),a}function eV(t,e,n){const i=$z(t,e);if(n===!1||n===null||n===void 0||typeof n=="number"&&Number.isNaN(n)||!n&&i.boolean)return;Array.isArray(n)&&(n=i.commaSeparated?_I(n):II(n));const r={name:i.attribute,value:n===!0?"":String(n)};if(i.space&&i.space!=="html"&&i.space!=="svg"){const s=r.name.indexOf(":");s<0?r.prefix="":(r.name=r.name.slice(s+1),r.prefix=i.attribute.slice(0,s)),r.namespace=Xo[i.space]}return r}function U1(t,e,n){let i=-1;const r=[];if(t)for(;++i<t.length;){const s=rR(t[i],n);s.parentNode=e,r.push(s)}return r}function El(t,e){const n=t.position;n&&n.start&&n.end&&(n.start.offset,n.end.offset,e.sourceCodeLocation={startLine:n.start.line,startCol:n.start.column,startOffset:n.start.offset,endLine:n.end.line,endCol:n.end.column,endOffset:n.end.offset})}const sR=["area","base","basefont","bgsound","br","col","command","embed","frame","hr","image","img","input","keygen","link","meta","param","source","track","wbr"],tV=new Set([65534,65535,131070,131071,196606,196607,262142,262143,327678,327679,393214,393215,458750,458751,524286,524287,589822,589823,655358,655359,720894,720895,786430,786431,851966,851967,917502,917503,983038,983039,1048574,1048575,1114110,1114111]),$t="";var $;(function(t){t[t.EOF=-1]="EOF",t[t.NULL=0]="NULL",t[t.TABULATION=9]="TABULATION",t[t.CARRIAGE_RETURN=13]="CARRIAGE_RETURN",t[t.LINE_FEED=10]="LINE_FEED",t[t.FORM_FEED=12]="FORM_FEED",t[t.SPACE=32]="SPACE",t[t.EXCLAMATION_MARK=33]="EXCLAMATION_MARK",t[t.QUOTATION_MARK=34]="QUOTATION_MARK",t[t.AMPERSAND=38]="AMPERSAND",t[t.APOSTROPHE=39]="APOSTROPHE",t[t.HYPHEN_MINUS=45]="HYPHEN_MINUS",t[t.SOLIDUS=47]="SOLIDUS",t[t.DIGIT_0=48]="DIGIT_0",t[t.DIGIT_9=57]="DIGIT_9",t[t.SEMICOLON=59]="SEMICOLON",t[t.LESS_THAN_SIGN=60]="LESS_THAN_SIGN",t[t.EQUALS_SIGN=61]="EQUALS_SIGN",t[t.GREATER_THAN_SIGN=62]="GREATER_THAN_SIGN",t[t.QUESTION_MARK=63]="QUESTION_MARK",t[t.LATIN_CAPITAL_A=65]="LATIN_CAPITAL_A",t[t.LATIN_CAPITAL_Z=90]="LATIN_CAPITAL_Z",t[t.RIGHT_SQUARE_BRACKET=93]="RIGHT_SQUARE_BRACKET",t[t.GRAVE_ACCENT=96]="GRAVE_ACCENT",t[t.LATIN_SMALL_A=97]="LATIN_SMALL_A",t[t.LATIN_SMALL_Z=122]="LATIN_SMALL_Z"})($||($={}));const Jn={DASH_DASH:"--",CDATA_START:"[CDATA[",DOCTYPE:"doctype",SCRIPT:"script",PUBLIC:"public",SYSTEM:"system"};function oR(t){return t>=55296&&t<=57343}function nV(t){return t>=56320&&t<=57343}function iV(t,e){return(t-55296)*1024+9216+e}function aR(t){return t!==32&&t!==10&&t!==13&&t!==9&&t!==12&&t>=1&&t<=31||t>=127&&t<=159}function lR(t){return t>=64976&&t<=65007||tV.has(t)}var se;(function(t){t.controlCharacterInInputStream="control-character-in-input-stream",t.noncharacterInInputStream="noncharacter-in-input-stream",t.surrogateInInputStream="surrogate-in-input-stream",t.nonVoidHtmlElementStartTagWithTrailingSolidus="non-void-html-element-start-tag-with-trailing-solidus",t.endTagWithAttributes="end-tag-with-attributes",t.endTagWithTrailingSolidus="end-tag-with-trailing-solidus",t.unexpectedSolidusInTag="unexpected-solidus-in-tag",t.unexpectedNullCharacter="unexpected-null-character",t.unexpectedQuestionMarkInsteadOfTagName="unexpected-question-mark-instead-of-tag-name",t.invalidFirstCharacterOfTagName="invalid-first-character-of-tag-name",t.unexpectedEqualsSignBeforeAttributeName="unexpected-equals-sign-before-attribute-name",t.missingEndTagName="missing-end-tag-name",t.unexpectedCharacterInAttributeName="unexpected-character-in-attribute-name",t.unknownNamedCharacterReference="unknown-named-character-reference",t.missingSemicolonAfterCharacterReference="missing-semicolon-after-character-reference",t.unexpectedCharacterAfterDoctypeSystemIdentifier="unexpected-character-after-doctype-system-identifier",t.unexpectedCharacterInUnquotedAttributeValue="unexpected-character-in-unquoted-attribute-value",t.eofBeforeTagName="eof-before-tag-name",t.eofInTag="eof-in-tag",t.missingAttributeValue="missing-attribute-value",t.missingWhitespaceBetweenAttributes="missing-whitespace-between-attributes",t.missingWhitespaceAfterDoctypePublicKeyword="missing-whitespace-after-doctype-public-keyword",t.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers="missing-whitespace-between-doctype-public-and-system-identifiers",t.missingWhitespaceAfterDoctypeSystemKeyword="missing-whitespace-after-doctype-system-keyword",t.missingQuoteBeforeDoctypePublicIdentifier="missing-quote-before-doctype-public-identifier",t.missingQuoteBeforeDoctypeSystemIdentifier="missing-quote-before-doctype-system-identifier",t.missingDoctypePublicIdentifier="missing-doctype-public-identifier",t.missingDoctypeSystemIdentifier="missing-doctype-system-identifier",t.abruptDoctypePublicIdentifier="abrupt-doctype-public-identifier",t.abruptDoctypeSystemIdentifier="abrupt-doctype-system-identifier",t.cdataInHtmlContent="cdata-in-html-content",t.incorrectlyOpenedComment="incorrectly-opened-comment",t.eofInScriptHtmlCommentLikeText="eof-in-script-html-comment-like-text",t.eofInDoctype="eof-in-doctype",t.nestedComment="nested-comment",t.abruptClosingOfEmptyComment="abrupt-closing-of-empty-comment",t.eofInComment="eof-in-comment",t.incorrectlyClosedComment="incorrectly-closed-comment",t.eofInCdata="eof-in-cdata",t.absenceOfDigitsInNumericCharacterReference="absence-of-digits-in-numeric-character-reference",t.nullCharacterReference="null-character-reference",t.surrogateCharacterReference="surrogate-character-reference",t.characterReferenceOutsideUnicodeRange="character-reference-outside-unicode-range",t.controlCharacterReference="control-character-reference",t.noncharacterCharacterReference="noncharacter-character-reference",t.missingWhitespaceBeforeDoctypeName="missing-whitespace-before-doctype-name",t.missingDoctypeName="missing-doctype-name",t.invalidCharacterSequenceAfterDoctypeName="invalid-character-sequence-after-doctype-name",t.duplicateAttribute="duplicate-attribute",t.nonConformingDoctype="non-conforming-doctype",t.missingDoctype="missing-doctype",t.misplacedDoctype="misplaced-doctype",t.endTagWithoutMatchingOpenElement="end-tag-without-matching-open-element",t.closingOfElementWithOpenChildElements="closing-of-element-with-open-child-elements",t.disallowedContentInNoscriptInHead="disallowed-content-in-noscript-in-head",t.openElementsLeftAfterEof="open-elements-left-after-eof",t.abandonedHeadElementChild="abandoned-head-element-child",t.misplacedStartTagForHeadElement="misplaced-start-tag-for-head-element",t.nestedNoscriptInHead="nested-noscript-in-head",t.eofInElementThatCanContainOnlyText="eof-in-element-that-can-contain-only-text"})(se||(se={}));const rV=65536;class sV{constructor(e){this.handler=e,this.html="",this.pos=-1,this.lastGapPos=-2,this.gapStack=[],this.skipNextNewLine=!1,this.lastChunkWritten=!1,this.endOfChunkHit=!1,this.bufferWaterline=rV,this.isEol=!1,this.lineStartPos=0,this.droppedBufferSize=0,this.line=1,this.lastErrOffset=-1}get col(){return this.pos-this.lineStartPos+ +(this.lastGapPos!==this.pos)}get offset(){return this.droppedBufferSize+this.pos}getError(e,n){const{line:i,col:r,offset:s}=this,o=r+n,a=s+n;return{code:e,startLine:i,endLine:i,startCol:o,endCol:o,startOffset:a,endOffset:a}}_err(e){this.handler.onParseError&&this.lastErrOffset!==this.offset&&(this.lastErrOffset=this.offset,this.handler.onParseError(this.getError(e,0)))}_addGap(){this.gapStack.push(this.lastGapPos),this.lastGapPos=this.pos}_processSurrogate(e){if(this.pos!==this.html.length-1){const n=this.html.charCodeAt(this.pos+1);if(nV(n))return this.pos++,this._addGap(),iV(e,n)}else if(!this.lastChunkWritten)return this.endOfChunkHit=!0,$.EOF;return this._err(se.surrogateInInputStream),e}willDropParsedChunk(){return this.pos>this.bufferWaterline}dropParsedChunk(){this.willDropParsedChunk()&&(this.html=this.html.substring(this.pos),this.lineStartPos-=this.pos,this.droppedBufferSize+=this.pos,this.pos=0,this.lastGapPos=-2,this.gapStack.length=0)}write(e,n){this.html.length>0?this.html+=e:this.html=e,this.endOfChunkHit=!1,this.lastChunkWritten=n}insertHtmlAtCurrentPos(e){this.html=this.html.substring(0,this.pos+1)+e+this.html.substring(this.pos+1),this.endOfChunkHit=!1}startsWith(e,n){if(this.pos+e.length>this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,!1;if(n)return this.html.startsWith(e,this.pos);for(let i=0;i<e.length;i++)if((this.html.charCodeAt(this.pos+i)|32)!==e.charCodeAt(i))return!1;return!0}peek(e){const n=this.pos+e;if(n>=this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,$.EOF;const i=this.html.charCodeAt(n);return i===$.CARRIAGE_RETURN?$.LINE_FEED:i}advance(){if(this.pos++,this.isEol&&(this.isEol=!1,this.line++,this.lineStartPos=this.pos),this.pos>=this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,$.EOF;let e=this.html.charCodeAt(this.pos);return e===$.CARRIAGE_RETURN?(this.isEol=!0,this.skipNextNewLine=!0,$.LINE_FEED):e===$.LINE_FEED&&(this.isEol=!0,this.skipNextNewLine)?(this.line--,this.skipNextNewLine=!1,this._addGap(),this.advance()):(this.skipNextNewLine=!1,oR(e)&&(e=this._processSurrogate(e)),this.handler.onParseError===null||e>31&&e<127||e===$.LINE_FEED||e===$.CARRIAGE_RETURN||e>159&&e<64976||this._checkForProblematicCharacters(e),e)}_checkForProblematicCharacters(e){aR(e)?this._err(se.controlCharacterInInputStream):lR(e)&&this._err(se.noncharacterInInputStream)}retreat(e){for(this.pos-=e;this.pos<this.lastGapPos;)this.lastGapPos=this.gapStack.pop(),this.pos--;this.isEol=!1}}var ct;(function(t){t[t.CHARACTER=0]="CHARACTER",t[t.NULL_CHARACTER=1]="NULL_CHARACTER",t[t.WHITESPACE_CHARACTER=2]="WHITESPACE_CHARACTER",t[t.START_TAG=3]="START_TAG",t[t.END_TAG=4]="END_TAG",t[t.COMMENT=5]="COMMENT",t[t.DOCTYPE=6]="DOCTYPE",t[t.EOF=7]="EOF",t[t.HIBERNATION=8]="HIBERNATION"})(ct||(ct={}));function uR(t,e){for(let n=t.attrs.length-1;n>=0;n--)if(t.attrs[n].name===e)return t.attrs[n].value;return null}const oV=new Uint16Array('<\0\0\0\0\0\0EMabcfglmnoprstu\\bfmsligP&cutereve;iyx}rc;r;ravepha;acr;d;gpon;f;plyFunction;ingcsr;ign;ildemlaceforsucrkslash;;ed;y;crtause;noullis;a;r;pf;eve;cmpeq;HOacdefhilorsucy;PYcpyute;;italDifferentialD;leys;aeioron;dilrc;nint;ot;dnilla;terDot;i;rcleDMPTot;inus;lus;imes;ocskwiseContourIntegral;eCurlyDQoubleQuote;uote;lnpuon;e;gitruent;nt;ourIntegral;fr;oduct;nterClockwiseContourIntegral;oss;cr;p;Cap;DJSZacefios;otrahd;cy;cy;cy;grsger;r;hv;ayron;;l;ta;r;afcmriticalADGTcute;o;bleAcute;rave;ilde;ond;ferentialD;\0\0\0\0f;;DEot;qual;bleCDLRUVontourIntegrao\0\0nArrow;eoftARTrrow;ightArrow;engLReftARrrow;ightArrow;ightArrow;ightATrrow;ee;p\0\0rrow;ownArrow;erticalBar;nABLRTarrow;BUar;pArrow;reve;eft\0\0ightVector;eeVector;ector;Bar;ight\0eeVector;ector;Bar;ee;Arrow;ctr;rok;NTacdfglmopqstuxG;Hcuteaiyron;rc;ot;r;raveement;apcr;ty\0\0mallSquare;erySmallSquare;gpon;f;silon;uail;Tilde;librium;cir;m;a;mlipsts;onentialE;cfiosy;r;lled\0\0mallSquare;erySmallSquare;\0\0\0f;All;riertrf;cJTabcdfgorstcy;>mma;d;reve;eiydil;rc;;ot;r;;pf;eaterEFGLSTqual;Less;ullEqual;reater;ess;lantEqual;ilde;cr;;AacfiosuRDcy;ctek;;irc;r;lbertSpace;\0f;izontalLine;ctrok;mpownHumqual;EJOacdfgmnostucy;lig;cy;cuteiyrc;ot;r;rave;apcgr;inaryI;lie\0;egrral;section;isibleCTomma;imes;gpton;f;a;cr;ilde;\0cy;lcfosuiyrc;;r;pf;\0r;rcy;kcy;HJacfoscy;cy;ppa;eydil;;r;pf;cr;JTaceflmostcy;<cmnprute;bda;g;lacetrf;r;aeyron;dil;;fstACDFRTUVarnrgleBracket;row;BRar;ightArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ightAVrrow;ector;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;ightsEFGLSTqualGreater;ullEqual;reater;ess;lantEqual;ilde;r;;eftarrow;idot;npwgLRlreftARrrow;ightArrow;ightArrow;eftarightightf;erLReftArrow;ightArrow;cht;rok;;acefiosup;y;dliumSpace;lintrf;r;nusPlus;pf;c;Jacefostucy;cute;aeyron;dil;;gswativeMTVediumSpace;hicneryThitedGLreaterGreateessLesLine;r;Bnptreak;BreakingSpace;f;;CDEGHLNPRSTVoungruent;pCap;oubleVerticalBar;lqxement;ual;Tilde;ists;reater;EFGLSTqual;ullEqual;reater;ess;lantEqual;ilde;umpownHump;qual;efstTriangle;BEar;qual;s;EGLSTqual;reater;ess;lantEqual;ilde;estedGLreaterGreater;essLess;recedes;ESqual;lantEqual;eiverseElement;ghtTriangle;BEar;qual;quuareSubpset;Equal;erset;Equal;bcpset;Equal;ceeds;ESTqual;lantEqual;ilde;erset;Equal;ilde;EFTqual;ullEqual;ilde;erticalBar;cr;ilde;Eacdfgmoprstuvlig;cuteiyrc;blac;r;raveaeicr;ga;cron;pf;enCurlyDQoubleQuote;uote;;clr;ashidees;mlerBParr;acek;et;arenthesis;acfhilorsrtialD;y;r;i;;usMinus;ipncareplanf;;eiocedes;ESTqual;lantEqual;ilde;me;dpuct;ortion;al;cir;;UfosOT"r;pf;cr;BEacefhiorsuarr;Gcnrute;g;r;tl;aeyron;dil;;;verseEUlqement;uilibrium;pEquilibrium;ro;ghtACDFTUVanrgleBracket;row;BLar;eftArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;puf;ndImplies;ightarrow;chr;;leDelayed;HOacfhimoqstuCcHcy;y;FTcy;cute;;aeiyron;dil;rc;;r;ortDLRUownArroweftArrowightArrowpArrow;gma;allCircle;pf;\0\0t;are;ISUntersection;ubpset;Equal;erset;Equal;nion;cr;ar;bcmp;set;Equal;cheeds;ESTqual;lantEqual;ilde;Th;;esrset;Equal;etHRSacfhiorsORNADE;Hccy;y;bu;;aeyron;dil;;r;ei\0efore;a;cnkSpace;Space;lde;EFTqual;ullEqual;ilde;pf;ipleDot;ctr;rok;\0\0\0\0\0\0\0cruter;ocir;r\0y;ve;iyrc;blac;r;raveacr;dierBParr;acek;et;arenthesis;on;Plus;gpon;f;ADETadpsrrow;BDar;ownArrow;ownArrow;quilibrium;ee;Arrow;ownerLReftArrow;ightArrow;i;lon;ing;cr;ilde;mlDbcdefosvash;ar;y;ash;l;er;btyar;;icalBLSTar;ine;eparator;ilde;ThinSpace;r;pf;cr;dash;cefosirc;dge;r;pf;cr;fiosr;;pf;cr;AIUacfosucy;cy;cy;cuteiyrc;;r;pf;cr;ml;Hacdefoscy;cute;ayron;;ot;\0oWidta;r;pf;cr;\0\0\0\0\0\0\0cutereve;;Ediuy;;rcte;lig;r;raveepfpsym;ha;apcclr;g;\0\0;adsvnd;;lope;;;elmrsz;esd;a;;;;;;;;t;vb;d;pth;arr;gpon;f;;Eaeiop;cir;;d;s;rox;eingctyr;;mp;eildemlcioninnt;Nabcdefiklnoprsuot;crkcepsong;psilon;rime;im;eq;ee;ed;gerk;tbrk;oy;quo;cmprtaus;eptyv;snoahw;;een;r;gcostuvwaiurc;pdptot;lus;imes;\0\0cup;ar;riangleduown;p;plus;earow;akocnklstozenge;riangle;dlrown;eft;ight;k;\0\0;;4;ck;eo;q=uiv;t;ptwxf;;tomtie;DHUVbdhmptuvLRlr;;;;;DUdu;;;;LRlr;;;;;HLRhlr;;;;;;ox;LRlr;;;;;DUdu;;;;inus;lus;imes;LRlr;;;;;HLRhlr;;;;;;evbarceior;mi;m;el;bh;sub;l;etp;Ee;;q\0\0\0\0\0\0\0\0\0\0cprute;;abcdsnd;rcup;aup;p;ot;;eot;aeiu\0s;on;dilrc;ps;sm;ot;dmnilptyv;t;err;ceiy;ck;mark;r;Ecefms;;elq;e\0\0rrowlreft;ight;RSacd;st;irc;ash;nint;id;cir;ubs;uit\0on;e;q\0\0a;t;;flemxente\0;dot;nfry;o;sr;aorr;ss;cur;bp;e;;e;dot;delprvwarrlr;;\0\0r;c;arr;p;;bcdosrcap;aup;p;ot;r;;alrvrr;m;yevwq\0\0reuee;edge;enearrowlreftightecioninnt;lcty;AHabcdefhijlorstuwzrar;glrsger;eth;h;varow;aayron;;;aogrr;tseq;glmta;ptyv;irsht;;arlraegsvm;osnd;suit;amma;in;;iode;ontimes;ncy;c\0\0rn;op;lptuwlar;f;;empsq;dot;inus;lus;quare;blebarwedgnadhownarrowarpoonlrefighkaro\0\0rn;op;cotry;;l;rok;drot;i;fahraangle;ciy;grarr;DacdefglmnopqrstuxDoocsuteter;aioyron;r;clon;;ot;Drot;;;rsave;dot;;ilsnters;;;dot;apscr;ty;svetp1;;;gs;p;gpon;f;alsr;sl;us;i;lvon;csuviorc\0\0antgltressaeils;st;v;DD;parsl;Daot;rr;cdir;oah;mrlo;cipl;seoctationential\0\0\0\0\0\0\0llingdotsey;male;ilrlig;\0\0g;ig;;lig;lig;fjaltt;ig;ns;of;\0f;ak;v;artint;aocs\0\0;;;;\0;;\0\0;;5;\0;;8;l;wn;cr;Eabcdefgijlnorstv;l;cmpute;ma;d;reve;iyrc;;ot;;lqs;qslan;cdlc;ot;o;l;;es;r;;gmel;cy;;Eaj;;;Eaes;p;prox;q;qim;pf;cir;m;el;;>;cdlqrci;r;ot;Par;uest;adels\0pror;qlqlesienrtneqq;Aabcefkosyrilmrrsfildrcy;;cwir;;ar;irc;alrrts;uitlip;con;r;sewarow;arow;amoprrr;tht;klreftarrow;ightarrow;f;bar;cltr;asrok;bpull;hen\0\0\0\0\0\0cute;iyrc;cxy;clfr;rave;inoinnt;t;fin;ta;lig;aopcgtr;elpinarh;f;ed;;cfotare;in;tie;do;celpal;grerarhk;rod;cgpty;on;f;a;uestcir;n;Edsv;ot;;v;;ilde;\0cy;lcfmosuiyrc;;r;ath;pf;\0r;rcy;kcy;acfghjosppa;v;eydil;;r;reen;cy;cy;pf;cr;ABEHabcdefghjlmnoprstuvartrail;arr;;g;ar;\0\0\0\0\0\0\0\0\0ute;mptyv;rabda;g;dl;;uor;bfhlpst;fs;s;p;l;im;l;;aeil;;s;abrrr;rk;akcek;;es;ldu;;aeuyron;diil;;cqrsa;uo;rduhar;shar;h;;fgqstahlrtrrow;taarpoonduownpeftarrows;ightahsrrow;sarpoonquigarrohreetimes;;qslan;cdgsc;ot;o;r;;es;adegspproot;qgqgtiilrsht;;;E;rdu;l;lk;cy;;achtrorneard;ri;iodot;ust;acheEaes;p;prox;q;qim;abnoptwznrg;r;rglmreftarightapsto;ightparrowlrefight;aflr;;us;imes;st;;efngear;lt;achmtrornear;d;;ri;achiqtquo;r;m;eg;;buo;r;rok;<;cdhilqrci;r;remes;arr;uest;Piar;;efrdushar;har;enrtneqq;DacdefhilnopsuDot;clprret;;ese;sto;dluowefker;oymma;;ash;asuredangler;o;cdnro;acdsir;otus;bd;u;p;dpels;f;ctr;pos;lmtimap;GLRVabcdefghijlmoprstuvwgt;;veltftarrrow;ightarrow;;;vightarrow;Ddash;ash;bcnptlaute;g;;Eiop;d;s;rour;al;s\0pmp;eaeouy\0;on;dil;ng;dot;p;;ash;;Aadqsxrr;rhrk;;oot;uieiar;ist;sr;Eest;qs;qslani;rAaprrr;ar;;sv;d;cy;AEadestr;rr;r;;fqstarrroightarro;qslan;si;ri;eiptf;;inn;Edv;ot;;;i;v;;aorr;astllel;;lint;;ceu;c;eAaitrrr;cw;;ghtarrowri;echimpqu;ceru;ort\0\0arm;e;qsubpbcp;Ees;et;eq;qc;e;Ees;et;eq;qgilrldeianglelreft;eight;e;m;esro;p;DHadgilrsash;arr;p;ash;et;;>nfin;Aetrr;;;r<ie;Atrr;rie;im;Aanrr;rhrk;;oear;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0csuteiyr;c;abioslac;v;old;lig;crir;;\0\0\0n;ave;bmar;acitrirr;oss;n;aeicr;ga;cdnron;;pf;aelr;rp;;adiosvr;efmr;ofgof;r;lope;;cloashl;idees;as;mlbar;\0\0\0\0\0\0\0\0\0r;ast;lle\0\0m;;y;rcimptnt;od;il;enk;r;imo;v;mane;;tvchfork;aunckk;h;s;abcdemstcir;ir;ou;;nim;wo;ipuntint;f;nd;Eaceinosu;p;u;c;acenspprourlyeaespprox;qq;im;ime;sEasdfpalslar;ine;urf;;trel;cir;;ncsp;fiopsur;pf;rime;cr;aeoteirnionnt;st;eABHabcdefhilmnoprstuxartrail;arar;cdenqrteu;te;imptyv;g;del;;uor;abcfhlpstwp;;fs;;s;l;im;l;;aiil;o;nalabrrrk;akcek;;es;ldu;;aeuyron;diil;;clqsa;dhar;uo;rh;acgl;ipsnart;ilrsht;;aordu;l;;v;gnshtahlrstrrow;taarpoonduowpeftahrrowarpoonightarrows;quigarrohreetimes;g;ingdotseahmra;oust;achemid;abptnrg;r;raflr;;us;imes;apr;gt;olint;arachqquo;r;buo;rhirremes;i;efltri;luhar;;\0\0\0\0\0\0\0cute;qu;Eaceinpsy;\0;on;u;dil;rc;Eas;p;im;olint;i;ot;be;Aacmstxrr;rhr;oti;war;minnut;r;oacoyrp;hycy;;rt\0\0iaragmma;fv;;deglnprot;;q;E;;E;e;lus;arr;araeitlslsetmhp;parsl;dle;;e;s;flptcy;;b;ar;f;adres;uitcsuaup;s;p;s;ubp;eset;e;eset;e;afrarcemtr;tmiararr;fanighteppsilohsbcmnp;Edemnprs;ot;;dot;ult;Ee;;lus;arr;eiut;enq;qeq;qm;bp;;c;acenspprourlyeaespproqg;123;Edehlmnps;ost;ub;;dot;soul;b;arr;ult;Ee;;lus;eiut;enq;qeq;qm;bp;;Aanrr;rhr;owar;lig\0\0\0\0\0\0\0\0\0\0\0\0get;;raeyron;dil;;lrec;r;eiko\0e4fa;svym;cnkaspproimsasrnes;bd;ar;;eps;bcfot;ir;;ork;rime;aipdadempstngle;dlqrowneft;e;ight;eot;inus;lus;b;ime;ezium;chtry;;cy;rok;ioxheadlreftarroightarrowAHabcdfghlmoprstuwrar;cruter\0y;ve;iyrc;abhrlac;airsht;;raverlrlk;ct\0\0rn;erop;ri;alcr;gpon;f;adhlsuownarpoonlrefighi;hlonparrows;cit\0\0rn;erop;ng;ri;cr;dirot;lde;i;famrlangle;ABDacdeflnoprszrar;v;asnrgrt;eknprstappothinhirop;hiugmbpsetneq;q;setneq;q;hretianglelreftighty;ashelr;bear;q;lip;btar;trsubppf;rotrcur;bpnEenEeigzag;cefoprsirc;dibgar;e;q;erp;r;pf;;eatcr;\0\0\0\0\0\0\0trr;Aarr;Aarrais;dptfl;imAarrcqr;ptracefiosucuyte;iyrc;;nr;cy;pf;cr;cmy;lacdefhioswcute;ayron;;ot;ettra;r;cy;grarr;pf;cr;jn;j;'.split("").map(t=>t.charCodeAt(0))),aV=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]);function lV(t){var e;return t>=55296&&t<=57343||t>1114111?65533:(e=aV.get(t))!==null&&e!==void 0?e:t}var vn;(function(t){t[t.NUM=35]="NUM",t[t.SEMI=59]="SEMI",t[t.EQUALS=61]="EQUALS",t[t.ZERO=48]="ZERO",t[t.NINE=57]="NINE",t[t.LOWER_A=97]="LOWER_A",t[t.LOWER_F=102]="LOWER_F",t[t.LOWER_X=120]="LOWER_X",t[t.LOWER_Z=122]="LOWER_Z",t[t.UPPER_A=65]="UPPER_A",t[t.UPPER_F=70]="UPPER_F",t[t.UPPER_Z=90]="UPPER_Z"})(vn||(vn={}));const uV=32;var Zs;(function(t){t[t.VALUE_LENGTH=49152]="VALUE_LENGTH",t[t.BRANCH_LENGTH=16256]="BRANCH_LENGTH",t[t.JUMP_TABLE=127]="JUMP_TABLE"})(Zs||(Zs={}));function H1(t){return t>=vn.ZERO&&t<=vn.NINE}function cV(t){return t>=vn.UPPER_A&&t<=vn.UPPER_F||t>=vn.LOWER_A&&t<=vn.LOWER_F}function dV(t){return t>=vn.UPPER_A&&t<=vn.UPPER_Z||t>=vn.LOWER_A&&t<=vn.LOWER_Z||H1(t)}function fV(t){return t===vn.EQUALS||dV(t)}var bn;(function(t){t[t.EntityStart=0]="EntityStart",t[t.NumericStart=1]="NumericStart",t[t.NumericDecimal=2]="NumericDecimal",t[t.NumericHex=3]="NumericHex",t[t.NamedEntity=4]="NamedEntity"})(bn||(bn={}));var os;(function(t){t[t.Legacy=0]="Legacy",t[t.Strict=1]="Strict",t[t.Attribute=2]="Attribute"})(os||(os={}));class hV{constructor(e,n,i){this.decodeTree=e,this.emitCodePoint=n,this.errors=i,this.state=bn.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=os.Strict}startEntity(e){this.decodeMode=e,this.state=bn.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1}write(e,n){switch(this.state){case bn.EntityStart:return e.charCodeAt(n)===vn.NUM?(this.state=bn.NumericStart,this.consumed+=1,this.stateNumericStart(e,n+1)):(this.state=bn.NamedEntity,this.stateNamedEntity(e,n));case bn.NumericStart:return this.stateNumericStart(e,n);case bn.NumericDecimal:return this.stateNumericDecimal(e,n);case bn.NumericHex:return this.stateNumericHex(e,n);case bn.NamedEntity:return this.stateNamedEntity(e,n)}}stateNumericStart(e,n){return n>=e.length?-1:(e.charCodeAt(n)|uV)===vn.LOWER_X?(this.state=bn.NumericHex,this.consumed+=1,this.stateNumericHex(e,n+1)):(this.state=bn.NumericDecimal,this.stateNumericDecimal(e,n))}addToNumericResult(e,n,i,r){if(n!==i){const s=i-n;this.result=this.result*Math.pow(r,s)+Number.parseInt(e.substr(n,s),r),this.consumed+=s}}stateNumericHex(e,n){const i=n;for(;n<e.length;){const r=e.charCodeAt(n);if(H1(r)||cV(r))n+=1;else return this.addToNumericResult(e,i,n,16),this.emitNumericEntity(r,3)}return this.addToNumericResult(e,i,n,16),-1}stateNumericDecimal(e,n){const i=n;for(;n<e.length;){const r=e.charCodeAt(n);if(H1(r))n+=1;else return this.addToNumericResult(e,i,n,10),this.emitNumericEntity(r,2)}return this.addToNumericResult(e,i,n,10),-1}emitNumericEntity(e,n){var i;if(this.consumed<=n)return(i=this.errors)===null||i===void 0||i.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(e===vn.SEMI)this.consumed+=1;else if(this.decodeMode===os.Strict)return 0;return this.emitCodePoint(lV(this.result),this.consumed),this.errors&&(e!==vn.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed}stateNamedEntity(e,n){const{decodeTree:i}=this;let r=i[this.treeIndex],s=(r&Zs.VALUE_LENGTH)>>14;for(;n<e.length;n++,this.excess++){const o=e.charCodeAt(n);if(this.treeIndex=pV(i,r,this.treeIndex+Math.max(1,s),o),this.treeIndex<0)return this.result===0||this.decodeMode===os.Attribute&&(s===0||fV(o))?0:this.emitNotTerminatedNamedEntity();if(r=i[this.treeIndex],s=(r&Zs.VALUE_LENGTH)>>14,s!==0){if(o===vn.SEMI)return this.emitNamedEntityData(this.treeIndex,s,this.consumed+this.excess);this.decodeMode!==os.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1}emitNotTerminatedNamedEntity(){var e;const{result:n,decodeTree:i}=this,r=(i[n]&Zs.VALUE_LENGTH)>>14;return this.emitNamedEntityData(n,r,this.consumed),(e=this.errors)===null||e===void 0||e.missingSemicolonAfterCharacterReference(),this.consumed}emitNamedEntityData(e,n,i){const{decodeTree:r}=this;return this.emitCodePoint(n===1?r[e]&~Zs.VALUE_LENGTH:r[e+1],i),n===3&&this.emitCodePoint(r[e+2],i),i}end(){var e;switch(this.state){case bn.NamedEntity:return this.result!==0&&(this.decodeMode!==os.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case bn.NumericDecimal:return this.emitNumericEntity(0,2);case bn.NumericHex:return this.emitNumericEntity(0,3);case bn.NumericStart:return(e=this.errors)===null||e===void 0||e.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case bn.EntityStart:return 0}}}function pV(t,e,n,i){const r=(e&Zs.BRANCH_LENGTH)>>7,s=e&Zs.JUMP_TABLE;if(r===0)return s!==0&&i===s?n:-1;if(s){const l=i-s;return l<0||l>=r?-1:t[n+l]-1}let o=n,a=o+r-1;for(;o<=a;){const l=o+a>>>1,u=t[l];if(u<i)o=l+1;else if(u>i)a=l-1;else return t[l+r]}return-1}var he;(function(t){t.HTML="http://www.w3.org/1999/xhtml",t.MATHML="http://www.w3.org/1998/Math/MathML",t.SVG="http://www.w3.org/2000/svg",t.XLINK="http://www.w3.org/1999/xlink",t.XML="http://www.w3.org/XML/1998/namespace",t.XMLNS="http://www.w3.org/2000/xmlns/"})(he||(he={}));var Zo;(function(t){t.TYPE="type",t.ACTION="action",t.ENCODING="encoding",t.PROMPT="prompt",t.NAME="name",t.COLOR="color",t.FACE="face",t.SIZE="size"})(Zo||(Zo={}));var Bi;(function(t){t.NO_QUIRKS="no-quirks",t.QUIRKS="quirks",t.LIMITED_QUIRKS="limited-quirks"})(Bi||(Bi={}));var J;(function(t){t.A="a",t.ADDRESS="address",t.ANNOTATION_XML="annotation-xml",t.APPLET="applet",t.AREA="area",t.ARTICLE="article",t.ASIDE="aside",t.B="b",t.BASE="base",t.BASEFONT="basefont",t.BGSOUND="bgsound",t.BIG="big",t.BLOCKQUOTE="blockquote",t.BODY="body",t.BR="br",t.BUTTON="button",t.CAPTION="caption",t.CENTER="center",t.CODE="code",t.COL="col",t.COLGROUP="colgroup",t.DD="dd",t.DESC="desc",t.DETAILS="details",t.DIALOG="dialog",t.DIR="dir",t.DIV="div",t.DL="dl",t.DT="dt",t.EM="em",t.EMBED="embed",t.FIELDSET="fieldset",t.FIGCAPTION="figcaption",t.FIGURE="figure",t.FONT="font",t.FOOTER="footer",t.FOREIGN_OBJECT="foreignObject",t.FORM="form",t.FRAME="frame",t.FRAMESET="frameset",t.H1="h1",t.H2="h2",t.H3="h3",t.H4="h4",t.H5="h5",t.H6="h6",t.HEAD="head",t.HEADER="header",t.HGROUP="hgroup",t.HR="hr",t.HTML="html",t.I="i",t.IMG="img",t.IMAGE="image",t.INPUT="input",t.IFRAME="iframe",t.KEYGEN="keygen",t.LABEL="label",t.LI="li",t.LINK="link",t.LISTING="listing",t.MAIN="main",t.MALIGNMARK="malignmark",t.MARQUEE="marquee",t.MATH="math",t.MENU="menu",t.META="meta",t.MGLYPH="mglyph",t.MI="mi",t.MO="mo",t.MN="mn",t.MS="ms",t.MTEXT="mtext",t.NAV="nav",t.NOBR="nobr",t.NOFRAMES="noframes",t.NOEMBED="noembed",t.NOSCRIPT="noscript",t.OBJECT="object",t.OL="ol",t.OPTGROUP="optgroup",t.OPTION="option",t.P="p",t.PARAM="param",t.PLAINTEXT="plaintext",t.PRE="pre",t.RB="rb",t.RP="rp",t.RT="rt",t.RTC="rtc",t.RUBY="ruby",t.S="s",t.SCRIPT="script",t.SEARCH="search",t.SECTION="section",t.SELECT="select",t.SOURCE="source",t.SMALL="small",t.SPAN="span",t.STRIKE="strike",t.STRONG="strong",t.STYLE="style",t.SUB="sub",t.SUMMARY="summary",t.SUP="sup",t.TABLE="table",t.TBODY="tbody",t.TEMPLATE="template",t.TEXTAREA="textarea",t.TFOOT="tfoot",t.TD="td",t.TH="th",t.THEAD="thead",t.TITLE="title",t.TR="tr",t.TRACK="track",t.TT="tt",t.U="u",t.UL="ul",t.SVG="svg",t.VAR="var",t.WBR="wbr",t.XMP="xmp"})(J||(J={}));var E;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.A=1]="A",t[t.ADDRESS=2]="ADDRESS",t[t.ANNOTATION_XML=3]="ANNOTATION_XML",t[t.APPLET=4]="APPLET",t[t.AREA=5]="AREA",t[t.ARTICLE=6]="ARTICLE",t[t.ASIDE=7]="ASIDE",t[t.B=8]="B",t[t.BASE=9]="BASE",t[t.BASEFONT=10]="BASEFONT",t[t.BGSOUND=11]="BGSOUND",t[t.BIG=12]="BIG",t[t.BLOCKQUOTE=13]="BLOCKQUOTE",t[t.BODY=14]="BODY",t[t.BR=15]="BR",t[t.BUTTON=16]="BUTTON",t[t.CAPTION=17]="CAPTION",t[t.CENTER=18]="CENTER",t[t.CODE=19]="CODE",t[t.COL=20]="COL",t[t.COLGROUP=21]="COLGROUP",t[t.DD=22]="DD",t[t.DESC=23]="DESC",t[t.DETAILS=24]="DETAILS",t[t.DIALOG=25]="DIALOG",t[t.DIR=26]="DIR",t[t.DIV=27]="DIV",t[t.DL=28]="DL",t[t.DT=29]="DT",t[t.EM=30]="EM",t[t.EMBED=31]="EMBED",t[t.FIELDSET=32]="FIELDSET",t[t.FIGCAPTION=33]="FIGCAPTION",t[t.FIGURE=34]="FIGURE",t[t.FONT=35]="FONT",t[t.FOOTER=36]="FOOTER",t[t.FOREIGN_OBJECT=37]="FOREIGN_OBJECT",t[t.FORM=38]="FORM",t[t.FRAME=39]="FRAME",t[t.FRAMESET=40]="FRAMESET",t[t.H1=41]="H1",t[t.H2=42]="H2",t[t.H3=43]="H3",t[t.H4=44]="H4",t[t.H5=45]="H5",t[t.H6=46]="H6",t[t.HEAD=47]="HEAD",t[t.HEADER=48]="HEADER",t[t.HGROUP=49]="HGROUP",t[t.HR=50]="HR",t[t.HTML=51]="HTML",t[t.I=52]="I",t[t.IMG=53]="IMG",t[t.IMAGE=54]="IMAGE",t[t.INPUT=55]="INPUT",t[t.IFRAME=56]="IFRAME",t[t.KEYGEN=57]="KEYGEN",t[t.LABEL=58]="LABEL",t[t.LI=59]="LI",t[t.LINK=60]="LINK",t[t.LISTING=61]="LISTING",t[t.MAIN=62]="MAIN",t[t.MALIGNMARK=63]="MALIGNMARK",t[t.MARQUEE=64]="MARQUEE",t[t.MATH=65]="MATH",t[t.MENU=66]="MENU",t[t.META=67]="META",t[t.MGLYPH=68]="MGLYPH",t[t.MI=69]="MI",t[t.MO=70]="MO",t[t.MN=71]="MN",t[t.MS=72]="MS",t[t.MTEXT=73]="MTEXT",t[t.NAV=74]="NAV",t[t.NOBR=75]="NOBR",t[t.NOFRAMES=76]="NOFRAMES",t[t.NOEMBED=77]="NOEMBED",t[t.NOSCRIPT=78]="NOSCRIPT",t[t.OBJECT=79]="OBJECT",t[t.OL=80]="OL",t[t.OPTGROUP=81]="OPTGROUP",t[t.OPTION=82]="OPTION",t[t.P=83]="P",t[t.PARAM=84]="PARAM",t[t.PLAINTEXT=85]="PLAINTEXT",t[t.PRE=86]="PRE",t[t.RB=87]="RB",t[t.RP=88]="RP",t[t.RT=89]="RT",t[t.RTC=90]="RTC",t[t.RUBY=91]="RUBY",t[t.S=92]="S",t[t.SCRIPT=93]="SCRIPT",t[t.SEARCH=94]="SEARCH",t[t.SECTION=95]="SECTION",t[t.SELECT=96]="SELECT",t[t.SOURCE=97]="SOURCE",t[t.SMALL=98]="SMALL",t[t.SPAN=99]="SPAN",t[t.STRIKE=100]="STRIKE",t[t.STRONG=101]="STRONG",t[t.STYLE=102]="STYLE",t[t.SUB=103]="SUB",t[t.SUMMARY=104]="SUMMARY",t[t.SUP=105]="SUP",t[t.TABLE=106]="TABLE",t[t.TBODY=107]="TBODY",t[t.TEMPLATE=108]="TEMPLATE",t[t.TEXTAREA=109]="TEXTAREA",t[t.TFOOT=110]="TFOOT",t[t.TD=111]="TD",t[t.TH=112]="TH",t[t.THEAD=113]="THEAD",t[t.TITLE=114]="TITLE",t[t.TR=115]="TR",t[t.TRACK=116]="TRACK",t[t.TT=117]="TT",t[t.U=118]="U",t[t.UL=119]="UL",t[t.SVG=120]="SVG",t[t.VAR=121]="VAR",t[t.WBR=122]="WBR",t[t.XMP=123]="XMP"})(E||(E={}));const mV=new Map([[J.A,E.A],[J.ADDRESS,E.ADDRESS],[J.ANNOTATION_XML,E.ANNOTATION_XML],[J.APPLET,E.APPLET],[J.AREA,E.AREA],[J.ARTICLE,E.ARTICLE],[J.ASIDE,E.ASIDE],[J.B,E.B],[J.BASE,E.BASE],[J.BASEFONT,E.BASEFONT],[J.BGSOUND,E.BGSOUND],[J.BIG,E.BIG],[J.BLOCKQUOTE,E.BLOCKQUOTE],[J.BODY,E.BODY],[J.BR,E.BR],[J.BUTTON,E.BUTTON],[J.CAPTION,E.CAPTION],[J.CENTER,E.CENTER],[J.CODE,E.CODE],[J.COL,E.COL],[J.COLGROUP,E.COLGROUP],[J.DD,E.DD],[J.DESC,E.DESC],[J.DETAILS,E.DETAILS],[J.DIALOG,E.DIALOG],[J.DIR,E.DIR],[J.DIV,E.DIV],[J.DL,E.DL],[J.DT,E.DT],[J.EM,E.EM],[J.EMBED,E.EMBED],[J.FIELDSET,E.FIELDSET],[J.FIGCAPTION,E.FIGCAPTION],[J.FIGURE,E.FIGURE],[J.FONT,E.FONT],[J.FOOTER,E.FOOTER],[J.FOREIGN_OBJECT,E.FOREIGN_OBJECT],[J.FORM,E.FORM],[J.FRAME,E.FRAME],[J.FRAMESET,E.FRAMESET],[J.H1,E.H1],[J.H2,E.H2],[J.H3,E.H3],[J.H4,E.H4],[J.H5,E.H5],[J.H6,E.H6],[J.HEAD,E.HEAD],[J.HEADER,E.HEADER],[J.HGROUP,E.HGROUP],[J.HR,E.HR],[J.HTML,E.HTML],[J.I,E.I],[J.IMG,E.IMG],[J.IMAGE,E.IMAGE],[J.INPUT,E.INPUT],[J.IFRAME,E.IFRAME],[J.KEYGEN,E.KEYGEN],[J.LABEL,E.LABEL],[J.LI,E.LI],[J.LINK,E.LINK],[J.LISTING,E.LISTING],[J.MAIN,E.MAIN],[J.MALIGNMARK,E.MALIGNMARK],[J.MARQUEE,E.MARQUEE],[J.MATH,E.MATH],[J.MENU,E.MENU],[J.META,E.META],[J.MGLYPH,E.MGLYPH],[J.MI,E.MI],[J.MO,E.MO],[J.MN,E.MN],[J.MS,E.MS],[J.MTEXT,E.MTEXT],[J.NAV,E.NAV],[J.NOBR,E.NOBR],[J.NOFRAMES,E.NOFRAMES],[J.NOEMBED,E.NOEMBED],[J.NOSCRIPT,E.NOSCRIPT],[J.OBJECT,E.OBJECT],[J.OL,E.OL],[J.OPTGROUP,E.OPTGROUP],[J.OPTION,E.OPTION],[J.P,E.P],[J.PARAM,E.PARAM],[J.PLAINTEXT,E.PLAINTEXT],[J.PRE,E.PRE],[J.RB,E.RB],[J.RP,E.RP],[J.RT,E.RT],[J.RTC,E.RTC],[J.RUBY,E.RUBY],[J.S,E.S],[J.SCRIPT,E.SCRIPT],[J.SEARCH,E.SEARCH],[J.SECTION,E.SECTION],[J.SELECT,E.SELECT],[J.SOURCE,E.SOURCE],[J.SMALL,E.SMALL],[J.SPAN,E.SPAN],[J.STRIKE,E.STRIKE],[J.STRONG,E.STRONG],[J.STYLE,E.STYLE],[J.SUB,E.SUB],[J.SUMMARY,E.SUMMARY],[J.SUP,E.SUP],[J.TABLE,E.TABLE],[J.TBODY,E.TBODY],[J.TEMPLATE,E.TEMPLATE],[J.TEXTAREA,E.TEXTAREA],[J.TFOOT,E.TFOOT],[J.TD,E.TD],[J.TH,E.TH],[J.THEAD,E.THEAD],[J.TITLE,E.TITLE],[J.TR,E.TR],[J.TRACK,E.TRACK],[J.TT,E.TT],[J.U,E.U],[J.UL,E.UL],[J.SVG,E.SVG],[J.VAR,E.VAR],[J.WBR,E.WBR],[J.XMP,E.XMP]]);function Tl(t){var e;return(e=mV.get(t))!==null&&e!==void 0?e:E.UNKNOWN}const ge=E,gV={[he.HTML]:new Set([ge.ADDRESS,ge.APPLET,ge.AREA,ge.ARTICLE,ge.ASIDE,ge.BASE,ge.BASEFONT,ge.BGSOUND,ge.BLOCKQUOTE,ge.BODY,ge.BR,ge.BUTTON,ge.CAPTION,ge.CENTER,ge.COL,ge.COLGROUP,ge.DD,ge.DETAILS,ge.DIR,ge.DIV,ge.DL,ge.DT,ge.EMBED,ge.FIELDSET,ge.FIGCAPTION,ge.FIGURE,ge.FOOTER,ge.FORM,ge.FRAME,ge.FRAMESET,ge.H1,ge.H2,ge.H3,ge.H4,ge.H5,ge.H6,ge.HEAD,ge.HEADER,ge.HGROUP,ge.HR,ge.HTML,ge.IFRAME,ge.IMG,ge.INPUT,ge.LI,ge.LINK,ge.LISTING,ge.MAIN,ge.MARQUEE,ge.MENU,ge.META,ge.NAV,ge.NOEMBED,ge.NOFRAMES,ge.NOSCRIPT,ge.OBJECT,ge.OL,ge.P,ge.PARAM,ge.PLAINTEXT,ge.PRE,ge.SCRIPT,ge.SECTION,ge.SELECT,ge.SOURCE,ge.STYLE,ge.SUMMARY,ge.TABLE,ge.TBODY,ge.TD,ge.TEMPLATE,ge.TEXTAREA,ge.TFOOT,ge.TH,ge.THEAD,ge.TITLE,ge.TR,ge.TRACK,ge.UL,ge.WBR,ge.XMP]),[he.MATHML]:new Set([ge.MI,ge.MO,ge.MN,ge.MS,ge.MTEXT,ge.ANNOTATION_XML]),[he.SVG]:new Set([ge.TITLE,ge.FOREIGN_OBJECT,ge.DESC]),[he.XLINK]:new Set,[he.XML]:new Set,[he.XMLNS]:new Set},$1=new Set([ge.H1,ge.H2,ge.H3,ge.H4,ge.H5,ge.H6]);J.STYLE,J.SCRIPT,J.XMP,J.IFRAME,J.NOEMBED,J.NOFRAMES,J.PLAINTEXT;var W;(function(t){t[t.DATA=0]="DATA",t[t.RCDATA=1]="RCDATA",t[t.RAWTEXT=2]="RAWTEXT",t[t.SCRIPT_DATA=3]="SCRIPT_DATA",t[t.PLAINTEXT=4]="PLAINTEXT",t[t.TAG_OPEN=5]="TAG_OPEN",t[t.END_TAG_OPEN=6]="END_TAG_OPEN",t[t.TAG_NAME=7]="TAG_NAME",t[t.RCDATA_LESS_THAN_SIGN=8]="RCDATA_LESS_THAN_SIGN",t[t.RCDATA_END_TAG_OPEN=9]="RCDATA_END_TAG_OPEN",t[t.RCDATA_END_TAG_NAME=10]="RCDATA_END_TAG_NAME",t[t.RAWTEXT_LESS_THAN_SIGN=11]="RAWTEXT_LESS_THAN_SIGN",t[t.RAWTEXT_END_TAG_OPEN=12]="RAWTEXT_END_TAG_OPEN",t[t.RAWTEXT_END_TAG_NAME=13]="RAWTEXT_END_TAG_NAME",t[t.SCRIPT_DATA_LESS_THAN_SIGN=14]="SCRIPT_DATA_LESS_THAN_SIGN",t[t.SCRIPT_DATA_END_TAG_OPEN=15]="SCRIPT_DATA_END_TAG_OPEN",t[t.SCRIPT_DATA_END_TAG_NAME=16]="SCRIPT_DATA_END_TAG_NAME",t[t.SCRIPT_DATA_ESCAPE_START=17]="SCRIPT_DATA_ESCAPE_START",t[t.SCRIPT_DATA_ESCAPE_START_DASH=18]="SCRIPT_DATA_ESCAPE_START_DASH",t[t.SCRIPT_DATA_ESCAPED=19]="SCRIPT_DATA_ESCAPED",t[t.SCRIPT_DATA_ESCAPED_DASH=20]="SCRIPT_DATA_ESCAPED_DASH",t[t.SCRIPT_DATA_ESCAPED_DASH_DASH=21]="SCRIPT_DATA_ESCAPED_DASH_DASH",t[t.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN=22]="SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN",t[t.SCRIPT_DATA_ESCAPED_END_TAG_OPEN=23]="SCRIPT_DATA_ESCAPED_END_TAG_OPEN",t[t.SCRIPT_DATA_ESCAPED_END_TAG_NAME=24]="SCRIPT_DATA_ESCAPED_END_TAG_NAME",t[t.SCRIPT_DATA_DOUBLE_ESCAPE_START=25]="SCRIPT_DATA_DOUBLE_ESCAPE_START",t[t.SCRIPT_DATA_DOUBLE_ESCAPED=26]="SCRIPT_DATA_DOUBLE_ESCAPED",t[t.SCRIPT_DATA_DOUBLE_ESCAPED_DASH=27]="SCRIPT_DATA_DOUBLE_ESCAPED_DASH",t[t.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH=28]="SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH",t[t.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN=29]="SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN",t[t.SCRIPT_DATA_DOUBLE_ESCAPE_END=30]="SCRIPT_DATA_DOUBLE_ESCAPE_END",t[t.BEFORE_ATTRIBUTE_NAME=31]="BEFORE_ATTRIBUTE_NAME",t[t.ATTRIBUTE_NAME=32]="ATTRIBUTE_NAME",t[t.AFTER_ATTRIBUTE_NAME=33]="AFTER_ATTRIBUTE_NAME",t[t.BEFORE_ATTRIBUTE_VALUE=34]="BEFORE_ATTRIBUTE_VALUE",t[t.ATTRIBUTE_VALUE_DOUBLE_QUOTED=35]="ATTRIBUTE_VALUE_DOUBLE_QUOTED",t[t.ATTRIBUTE_VALUE_SINGLE_QUOTED=36]="ATTRIBUTE_VALUE_SINGLE_QUOTED",t[t.ATTRIBUTE_VALUE_UNQUOTED=37]="ATTRIBUTE_VALUE_UNQUOTED",t[t.AFTER_ATTRIBUTE_VALUE_QUOTED=38]="AFTER_ATTRIBUTE_VALUE_QUOTED",t[t.SELF_CLOSING_START_TAG=39]="SELF_CLOSING_START_TAG",t[t.BOGUS_COMMENT=40]="BOGUS_COMMENT",t[t.MARKUP_DECLARATION_OPEN=41]="MARKUP_DECLARATION_OPEN",t[t.COMMENT_START=42]="COMMENT_START",t[t.COMMENT_START_DASH=43]="COMMENT_START_DASH",t[t.COMMENT=44]="COMMENT",t[t.COMMENT_LESS_THAN_SIGN=45]="COMMENT_LESS_THAN_SIGN",t[t.COMMENT_LESS_THAN_SIGN_BANG=46]="COMMENT_LESS_THAN_SIGN_BANG",t[t.COMMENT_LESS_THAN_SIGN_BANG_DASH=47]="COMMENT_LESS_THAN_SIGN_BANG_DASH",t[t.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH=48]="COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH",t[t.COMMENT_END_DASH=49]="COMMENT_END_DASH",t[t.COMMENT_END=50]="COMMENT_END",t[t.COMMENT_END_BANG=51]="COMMENT_END_BANG",t[t.DOCTYPE=52]="DOCTYPE",t[t.BEFORE_DOCTYPE_NAME=53]="BEFORE_DOCTYPE_NAME",t[t.DOCTYPE_NAME=54]="DOCTYPE_NAME",t[t.AFTER_DOCTYPE_NAME=55]="AFTER_DOCTYPE_NAME",t[t.AFTER_DOCTYPE_PUBLIC_KEYWORD=56]="AFTER_DOCTYPE_PUBLIC_KEYWORD",t[t.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER=57]="BEFORE_DOCTYPE_PUBLIC_IDENTIFIER",t[t.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED=58]="DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED",t[t.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED=59]="DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED",t[t.AFTER_DOCTYPE_PUBLIC_IDENTIFIER=60]="AFTER_DOCTYPE_PUBLIC_IDENTIFIER",t[t.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS=61]="BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS",t[t.AFTER_DOCTYPE_SYSTEM_KEYWORD=62]="AFTER_DOCTYPE_SYSTEM_KEYWORD",t[t.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER=63]="BEFORE_DOCTYPE_SYSTEM_IDENTIFIER",t[t.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED=64]="DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED",t[t.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED=65]="DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED",t[t.AFTER_DOCTYPE_SYSTEM_IDENTIFIER=66]="AFTER_DOCTYPE_SYSTEM_IDENTIFIER",t[t.BOGUS_DOCTYPE=67]="BOGUS_DOCTYPE",t[t.CDATA_SECTION=68]="CDATA_SECTION",t[t.CDATA_SECTION_BRACKET=69]="CDATA_SECTION_BRACKET",t[t.CDATA_SECTION_END=70]="CDATA_SECTION_END",t[t.CHARACTER_REFERENCE=71]="CHARACTER_REFERENCE",t[t.AMBIGUOUS_AMPERSAND=72]="AMBIGUOUS_AMPERSAND"})(W||(W={}));const Jt={DATA:W.DATA,RCDATA:W.RCDATA,RAWTEXT:W.RAWTEXT,SCRIPT_DATA:W.SCRIPT_DATA,PLAINTEXT:W.PLAINTEXT,CDATA_SECTION:W.CDATA_SECTION};function yV(t){return t>=$.DIGIT_0&&t<=$.DIGIT_9}function Ic(t){return t>=$.LATIN_CAPITAL_A&&t<=$.LATIN_CAPITAL_Z}function vV(t){return t>=$.LATIN_SMALL_A&&t<=$.LATIN_SMALL_Z}function Js(t){return vV(t)||Ic(t)}function cR(t){return Js(t)||yV(t)}function Sh(t){return t+32}function dR(t){return t===$.SPACE||t===$.LINE_FEED||t===$.TABULATION||t===$.FORM_FEED}function fR(t){return dR(t)||t===$.SOLIDUS||t===$.GREATER_THAN_SIGN}function bV(t){return t===$.NULL?se.nullCharacterReference:t>1114111?se.characterReferenceOutsideUnicodeRange:oR(t)?se.surrogateCharacterReference:lR(t)?se.noncharacterCharacterReference:aR(t)||t===$.CARRIAGE_RETURN?se.controlCharacterReference:null}let EV=class{constructor(e,n){this.options=e,this.handler=n,this.paused=!1,this.inLoop=!1,this.inForeignNode=!1,this.lastStartTagName="",this.active=!1,this.state=W.DATA,this.returnState=W.DATA,this.entityStartPos=0,this.consumedAfterSnapshot=-1,this.currentCharacterToken=null,this.currentToken=null,this.currentAttr={name:"",value:""},this.preprocessor=new sV(n),this.currentLocation=this.getCurrentLocation(-1),this.entityDecoder=new hV(oV,(i,r)=>{this.preprocessor.pos=this.entityStartPos+r-1,this._flushCodePointConsumedAsCharacterReference(i)},n.onParseError?{missingSemicolonAfterCharacterReference:()=>{this._err(se.missingSemicolonAfterCharacterReference,1)},absenceOfDigitsInNumericCharacterReference:i=>{this._err(se.absenceOfDigitsInNumericCharacterReference,this.entityStartPos-this.preprocessor.pos+i)},validateNumericCharacterReference:i=>{const r=bV(i);r&&this._err(r,1)}}:void 0)}_err(e,n=0){var i,r;(r=(i=this.handler).onParseError)===null||r===void 0||r.call(i,this.preprocessor.getError(e,n))}getCurrentLocation(e){return this.options.sourceCodeLocationInfo?{startLine:this.preprocessor.line,startCol:this.preprocessor.col-e,startOffset:this.preprocessor.offset-e,endLine:-1,endCol:-1,endOffset:-1}:null}_runParsingLoop(){if(!this.inLoop){for(this.inLoop=!0;this.active&&!this.paused;){this.consumedAfterSnapshot=0;const e=this._consume();this._ensureHibernation()||this._callState(e)}this.inLoop=!1}}pause(){this.paused=!0}resume(e){if(!this.paused)throw new Error("Parser was already resumed");this.paused=!1,!this.inLoop&&(this._runParsingLoop(),this.paused||e==null||e())}write(e,n,i){this.active=!0,this.preprocessor.write(e,n),this._runParsingLoop(),this.paused||i==null||i()}insertHtmlAtCurrentPos(e){this.active=!0,this.preprocessor.insertHtmlAtCurrentPos(e),this._runParsingLoop()}_ensureHibernation(){return this.preprocessor.endOfChunkHit?(this.preprocessor.retreat(this.consumedAfterSnapshot),this.consumedAfterSnapshot=0,this.active=!1,!0):!1}_consume(){return this.consumedAfterSnapshot++,this.preprocessor.advance()}_advanceBy(e){this.consumedAfterSnapshot+=e;for(let n=0;n<e;n++)this.preprocessor.advance()}_consumeSequenceIfMatch(e,n){return this.preprocessor.startsWith(e,n)?(this._advanceBy(e.length-1),!0):!1}_createStartTagToken(){this.currentToken={type:ct.START_TAG,tagName:"",tagID:E.UNKNOWN,selfClosing:!1,ackSelfClosing:!1,attrs:[],location:this.getCurrentLocation(1)}}_createEndTagToken(){this.currentToken={type:ct.END_TAG,tagName:"",tagID:E.UNKNOWN,selfClosing:!1,ackSelfClosing:!1,attrs:[],location:this.getCurrentLocation(2)}}_createCommentToken(e){this.currentToken={type:ct.COMMENT,data:"",location:this.getCurrentLocation(e)}}_createDoctypeToken(e){this.currentToken={type:ct.DOCTYPE,name:e,forceQuirks:!1,publicId:null,systemId:null,location:this.currentLocation}}_createCharacterToken(e,n){this.currentCharacterToken={type:e,chars:n,location:this.currentLocation}}_createAttr(e){this.currentAttr={name:e,value:""},this.currentLocation=this.getCurrentLocation(0)}_leaveAttrName(){var e,n;const i=this.currentToken;if(uR(i,this.currentAttr.name)===null){if(i.attrs.push(this.currentAttr),i.location&&this.currentLocation){const r=(e=(n=i.location).attrs)!==null&&e!==void 0?e:n.attrs=Object.create(null);r[this.currentAttr.name]=this.currentLocation,this._leaveAttrValue()}}else this._err(se.duplicateAttribute)}_leaveAttrValue(){this.currentLocation&&(this.currentLocation.endLine=this.preprocessor.line,this.currentLocation.endCol=this.preprocessor.col,this.currentLocation.endOffset=this.preprocessor.offset)}prepareToken(e){this._emitCurrentCharacterToken(e.location),this.currentToken=null,e.location&&(e.location.endLine=this.preprocessor.line,e.location.endCol=this.preprocessor.col+1,e.location.endOffset=this.preprocessor.offset+1),this.currentLocation=this.getCurrentLocation(-1)}emitCurrentTagToken(){const e=this.currentToken;this.prepareToken(e),e.tagID=Tl(e.tagName),e.type===ct.START_TAG?(this.lastStartTagName=e.tagName,this.handler.onStartTag(e)):(e.attrs.length>0&&this._err(se.endTagWithAttributes),e.selfClosing&&this._err(se.endTagWithTrailingSolidus),this.handler.onEndTag(e)),this.preprocessor.dropParsedChunk()}emitCurrentComment(e){this.prepareToken(e),this.handler.onComment(e),this.preprocessor.dropParsedChunk()}emitCurrentDoctype(e){this.prepareToken(e),this.handler.onDoctype(e),this.preprocessor.dropParsedChunk()}_emitCurrentCharacterToken(e){if(this.currentCharacterToken){switch(e&&this.currentCharacterToken.location&&(this.currentCharacterToken.location.endLine=e.startLine,this.currentCharacterToken.location.endCol=e.startCol,this.currentCharacterToken.location.endOffset=e.startOffset),this.currentCharacterToken.type){case ct.CHARACTER:{this.handler.onCharacter(this.currentCharacterToken);break}case ct.NULL_CHARACTER:{this.handler.onNullCharacter(this.currentCharacterToken);break}case ct.WHITESPACE_CHARACTER:{this.handler.onWhitespaceCharacter(this.currentCharacterToken);break}}this.currentCharacterToken=null}}_emitEOFToken(){const e=this.getCurrentLocation(0);e&&(e.endLine=e.startLine,e.endCol=e.startCol,e.endOffset=e.startOffset),this._emitCurrentCharacterToken(e),this.handler.onEof({type:ct.EOF,location:e}),this.active=!1}_appendCharToCurrentCharacterToken(e,n){if(this.currentCharacterToken)if(this.currentCharacterToken.type===e){this.currentCharacterToken.chars+=n;return}else this.currentLocation=this.getCurrentLocation(0),this._emitCurrentCharacterToken(this.currentLocation),this.preprocessor.dropParsedChunk();this._createCharacterToken(e,n)}_emitCodePoint(e){const n=dR(e)?ct.WHITESPACE_CHARACTER:e===$.NULL?ct.NULL_CHARACTER:ct.CHARACTER;this._appendCharToCurrentCharacterToken(n,String.fromCodePoint(e))}_emitChars(e){this._appendCharToCurrentCharacterToken(ct.CHARACTER,e)}_startCharacterReference(){this.returnState=this.state,this.state=W.CHARACTER_REFERENCE,this.entityStartPos=this.preprocessor.pos,this.entityDecoder.startEntity(this._isCharacterReferenceInAttribute()?os.Attribute:os.Legacy)}_isCharacterReferenceInAttribute(){return this.returnState===W.ATTRIBUTE_VALUE_DOUBLE_QUOTED||this.returnState===W.ATTRIBUTE_VALUE_SINGLE_QUOTED||this.returnState===W.ATTRIBUTE_VALUE_UNQUOTED}_flushCodePointConsumedAsCharacterReference(e){this._isCharacterReferenceInAttribute()?this.currentAttr.value+=String.fromCodePoint(e):this._emitCodePoint(e)}_callState(e){switch(this.state){case W.DATA:{this._stateData(e);break}case W.RCDATA:{this._stateRcdata(e);break}case W.RAWTEXT:{this._stateRawtext(e);break}case W.SCRIPT_DATA:{this._stateScriptData(e);break}case W.PLAINTEXT:{this._statePlaintext(e);break}case W.TAG_OPEN:{this._stateTagOpen(e);break}case W.END_TAG_OPEN:{this._stateEndTagOpen(e);break}case W.TAG_NAME:{this._stateTagName(e);break}case W.RCDATA_LESS_THAN_SIGN:{this._stateRcdataLessThanSign(e);break}case W.RCDATA_END_TAG_OPEN:{this._stateRcdataEndTagOpen(e);break}case W.RCDATA_END_TAG_NAME:{this._stateRcdataEndTagName(e);break}case W.RAWTEXT_LESS_THAN_SIGN:{this._stateRawtextLessThanSign(e);break}case W.RAWTEXT_END_TAG_OPEN:{this._stateRawtextEndTagOpen(e);break}case W.RAWTEXT_END_TAG_NAME:{this._stateRawtextEndTagName(e);break}case W.SCRIPT_DATA_LESS_THAN_SIGN:{this._stateScriptDataLessThanSign(e);break}case W.SCRIPT_DATA_END_TAG_OPEN:{this._stateScriptDataEndTagOpen(e);break}case W.SCRIPT_DATA_END_TAG_NAME:{this._stateScriptDataEndTagName(e);break}case W.SCRIPT_DATA_ESCAPE_START:{this._stateScriptDataEscapeStart(e);break}case W.SCRIPT_DATA_ESCAPE_START_DASH:{this._stateScriptDataEscapeStartDash(e);break}case W.SCRIPT_DATA_ESCAPED:{this._stateScriptDataEscaped(e);break}case W.SCRIPT_DATA_ESCAPED_DASH:{this._stateScriptDataEscapedDash(e);break}case W.SCRIPT_DATA_ESCAPED_DASH_DASH:{this._stateScriptDataEscapedDashDash(e);break}case W.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN:{this._stateScriptDataEscapedLessThanSign(e);break}case W.SCRIPT_DATA_ESCAPED_END_TAG_OPEN:{this._stateScriptDataEscapedEndTagOpen(e);break}case W.SCRIPT_DATA_ESCAPED_END_TAG_NAME:{this._stateScriptDataEscapedEndTagName(e);break}case W.SCRIPT_DATA_DOUBLE_ESCAPE_START:{this._stateScriptDataDoubleEscapeStart(e);break}case W.SCRIPT_DATA_DOUBLE_ESCAPED:{this._stateScriptDataDoubleEscaped(e);break}case W.SCRIPT_DATA_DOUBLE_ESCAPED_DASH:{this._stateScriptDataDoubleEscapedDash(e);break}case W.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH:{this._stateScriptDataDoubleEscapedDashDash(e);break}case W.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN:{this._stateScriptDataDoubleEscapedLessThanSign(e);break}case W.SCRIPT_DATA_DOUBLE_ESCAPE_END:{this._stateScriptDataDoubleEscapeEnd(e);break}case W.BEFORE_ATTRIBUTE_NAME:{this._stateBeforeAttributeName(e);break}case W.ATTRIBUTE_NAME:{this._stateAttributeName(e);break}case W.AFTER_ATTRIBUTE_NAME:{this._stateAfterAttributeName(e);break}case W.BEFORE_ATTRIBUTE_VALUE:{this._stateBeforeAttributeValue(e);break}case W.ATTRIBUTE_VALUE_DOUBLE_QUOTED:{this._stateAttributeValueDoubleQuoted(e);break}case W.ATTRIBUTE_VALUE_SINGLE_QUOTED:{this._stateAttributeValueSingleQuoted(e);break}case W.ATTRIBUTE_VALUE_UNQUOTED:{this._stateAttributeValueUnquoted(e);break}case W.AFTER_ATTRIBUTE_VALUE_QUOTED:{this._stateAfterAttributeValueQuoted(e);break}case W.SELF_CLOSING_START_TAG:{this._stateSelfClosingStartTag(e);break}case W.BOGUS_COMMENT:{this._stateBogusComment(e);break}case W.MARKUP_DECLARATION_OPEN:{this._stateMarkupDeclarationOpen(e);break}case W.COMMENT_START:{this._stateCommentStart(e);break}case W.COMMENT_START_DASH:{this._stateCommentStartDash(e);break}case W.COMMENT:{this._stateComment(e);break}case W.COMMENT_LESS_THAN_SIGN:{this._stateCommentLessThanSign(e);break}case W.COMMENT_LESS_THAN_SIGN_BANG:{this._stateCommentLessThanSignBang(e);break}case W.COMMENT_LESS_THAN_SIGN_BANG_DASH:{this._stateCommentLessThanSignBangDash(e);break}case W.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH:{this._stateCommentLessThanSignBangDashDash(e);break}case W.COMMENT_END_DASH:{this._stateCommentEndDash(e);break}case W.COMMENT_END:{this._stateCommentEnd(e);break}case W.COMMENT_END_BANG:{this._stateCommentEndBang(e);break}case W.DOCTYPE:{this._stateDoctype(e);break}case W.BEFORE_DOCTYPE_NAME:{this._stateBeforeDoctypeName(e);break}case W.DOCTYPE_NAME:{this._stateDoctypeName(e);break}case W.AFTER_DOCTYPE_NAME:{this._stateAfterDoctypeName(e);break}case W.AFTER_DOCTYPE_PUBLIC_KEYWORD:{this._stateAfterDoctypePublicKeyword(e);break}case W.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER:{this._stateBeforeDoctypePublicIdentifier(e);break}case W.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED:{this._stateDoctypePublicIdentifierDoubleQuoted(e);break}case W.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED:{this._stateDoctypePublicIdentifierSingleQuoted(e);break}case W.AFTER_DOCTYPE_PUBLIC_IDENTIFIER:{this._stateAfterDoctypePublicIdentifier(e);break}case W.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS:{this._stateBetweenDoctypePublicAndSystemIdentifiers(e);break}case W.AFTER_DOCTYPE_SYSTEM_KEYWORD:{this._stateAfterDoctypeSystemKeyword(e);break}case W.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER:{this._stateBeforeDoctypeSystemIdentifier(e);break}case W.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED:{this._stateDoctypeSystemIdentifierDoubleQuoted(e);break}case W.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED:{this._stateDoctypeSystemIdentifierSingleQuoted(e);break}case W.AFTER_DOCTYPE_SYSTEM_IDENTIFIER:{this._stateAfterDoctypeSystemIdentifier(e);break}case W.BOGUS_DOCTYPE:{this._stateBogusDoctype(e);break}case W.CDATA_SECTION:{this._stateCdataSection(e);break}case W.CDATA_SECTION_BRACKET:{this._stateCdataSectionBracket(e);break}case W.CDATA_SECTION_END:{this._stateCdataSectionEnd(e);break}case W.CHARACTER_REFERENCE:{this._stateCharacterReference();break}case W.AMBIGUOUS_AMPERSAND:{this._stateAmbiguousAmpersand(e);break}default:throw new Error("Unknown state")}}_stateData(e){switch(e){case $.LESS_THAN_SIGN:{this.state=W.TAG_OPEN;break}case $.AMPERSAND:{this._startCharacterReference();break}case $.NULL:{this._err(se.unexpectedNullCharacter),this._emitCodePoint(e);break}case $.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateRcdata(e){switch(e){case $.AMPERSAND:{this._startCharacterReference();break}case $.LESS_THAN_SIGN:{this.state=W.RCDATA_LESS_THAN_SIGN;break}case $.NULL:{this._err(se.unexpectedNullCharacter),this._emitChars($t);break}case $.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateRawtext(e){switch(e){case $.LESS_THAN_SIGN:{this.state=W.RAWTEXT_LESS_THAN_SIGN;break}case $.NULL:{this._err(se.unexpectedNullCharacter),this._emitChars($t);break}case $.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateScriptData(e){switch(e){case $.LESS_THAN_SIGN:{this.state=W.SCRIPT_DATA_LESS_THAN_SIGN;break}case $.NULL:{this._err(se.unexpectedNullCharacter),this._emitChars($t);break}case $.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_statePlaintext(e){switch(e){case $.NULL:{this._err(se.unexpectedNullCharacter),this._emitChars($t);break}case $.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateTagOpen(e){if(Js(e))this._createStartTagToken(),this.state=W.TAG_NAME,this._stateTagName(e);else switch(e){case $.EXCLAMATION_MARK:{this.state=W.MARKUP_DECLARATION_OPEN;break}case $.SOLIDUS:{this.state=W.END_TAG_OPEN;break}case $.QUESTION_MARK:{this._err(se.unexpectedQuestionMarkInsteadOfTagName),this._createCommentToken(1),this.state=W.BOGUS_COMMENT,this._stateBogusComment(e);break}case $.EOF:{this._err(se.eofBeforeTagName),this._emitChars("<"),this._emitEOFToken();break}default:this._err(se.invalidFirstCharacterOfTagName),this._emitChars("<"),this.state=W.DATA,this._stateData(e)}}_stateEndTagOpen(e){if(Js(e))this._createEndTagToken(),this.state=W.TAG_NAME,this._stateTagName(e);else switch(e){case $.GREATER_THAN_SIGN:{this._err(se.missingEndTagName),this.state=W.DATA;break}case $.EOF:{this._err(se.eofBeforeTagName),this._emitChars("</"),this._emitEOFToken();break}default:this._err(se.invalidFirstCharacterOfTagName),this._createCommentToken(2),this.state=W.BOGUS_COMMENT,this._stateBogusComment(e)}}_stateTagName(e){const n=this.currentToken;switch(e){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:{this.state=W.BEFORE_ATTRIBUTE_NAME;break}case $.SOLIDUS:{this.state=W.SELF_CLOSING_START_TAG;break}case $.GREATER_THAN_SIGN:{this.state=W.DATA,this.emitCurrentTagToken();break}case $.NULL:{this._err(se.unexpectedNullCharacter),n.tagName+=$t;break}case $.EOF:{this._err(se.eofInTag),this._emitEOFToken();break}default:n.tagName+=String.fromCodePoint(Ic(e)?Sh(e):e)}}_stateRcdataLessThanSign(e){e===$.SOLIDUS?this.state=W.RCDATA_END_TAG_OPEN:(this._emitChars("<"),this.state=W.RCDATA,this._stateRcdata(e))}_stateRcdataEndTagOpen(e){Js(e)?(this.state=W.RCDATA_END_TAG_NAME,this._stateRcdataEndTagName(e)):(this._emitChars("</"),this.state=W.RCDATA,this._stateRcdata(e))}handleSpecialEndTag(e){if(!this.preprocessor.startsWith(this.lastStartTagName,!1))return!this._ensureHibernation();this._createEndTagToken();const n=this.currentToken;switch(n.tagName=this.lastStartTagName,this.preprocessor.peek(this.lastStartTagName.length)){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:return this._advanceBy(this.lastStartTagName.length),this.state=W.BEFORE_ATTRIBUTE_NAME,!1;case $.SOLIDUS:return this._advanceBy(this.lastStartTagName.length),this.state=W.SELF_CLOSING_START_TAG,!1;case $.GREATER_THAN_SIGN:return this._advanceBy(this.lastStartTagName.length),this.emitCurrentTagToken(),this.state=W.DATA,!1;default:return!this._ensureHibernation()}}_stateRcdataEndTagName(e){this.handleSpecialEndTag(e)&&(this._emitChars("</"),this.state=W.RCDATA,this._stateRcdata(e))}_stateRawtextLessThanSign(e){e===$.SOLIDUS?this.state=W.RAWTEXT_END_TAG_OPEN:(this._emitChars("<"),this.state=W.RAWTEXT,this._stateRawtext(e))}_stateRawtextEndTagOpen(e){Js(e)?(this.state=W.RAWTEXT_END_TAG_NAME,this._stateRawtextEndTagName(e)):(this._emitChars("</"),this.state=W.RAWTEXT,this._stateRawtext(e))}_stateRawtextEndTagName(e){this.handleSpecialEndTag(e)&&(this._emitChars("</"),this.state=W.RAWTEXT,this._stateRawtext(e))}_stateScriptDataLessThanSign(e){switch(e){case $.SOLIDUS:{this.state=W.SCRIPT_DATA_END_TAG_OPEN;break}case $.EXCLAMATION_MARK:{this.state=W.SCRIPT_DATA_ESCAPE_START,this._emitChars("<!");break}default:this._emitChars("<"),this.state=W.SCRIPT_DATA,this._stateScriptData(e)}}_stateScriptDataEndTagOpen(e){Js(e)?(this.state=W.SCRIPT_DATA_END_TAG_NAME,this._stateScriptDataEndTagName(e)):(this._emitChars("</"),this.state=W.SCRIPT_DATA,this._stateScriptData(e))}_stateScriptDataEndTagName(e){this.handleSpecialEndTag(e)&&(this._emitChars("</"),this.state=W.SCRIPT_DATA,this._stateScriptData(e))}_stateScriptDataEscapeStart(e){e===$.HYPHEN_MINUS?(this.state=W.SCRIPT_DATA_ESCAPE_START_DASH,this._emitChars("-")):(this.state=W.SCRIPT_DATA,this._stateScriptData(e))}_stateScriptDataEscapeStartDash(e){e===$.HYPHEN_MINUS?(this.state=W.SCRIPT_DATA_ESCAPED_DASH_DASH,this._emitChars("-")):(this.state=W.SCRIPT_DATA,this._stateScriptData(e))}_stateScriptDataEscaped(e){switch(e){case $.HYPHEN_MINUS:{this.state=W.SCRIPT_DATA_ESCAPED_DASH,this._emitChars("-");break}case $.LESS_THAN_SIGN:{this.state=W.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case $.NULL:{this._err(se.unexpectedNullCharacter),this._emitChars($t);break}case $.EOF:{this._err(se.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateScriptDataEscapedDash(e){switch(e){case $.HYPHEN_MINUS:{this.state=W.SCRIPT_DATA_ESCAPED_DASH_DASH,this._emitChars("-");break}case $.LESS_THAN_SIGN:{this.state=W.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case $.NULL:{this._err(se.unexpectedNullCharacter),this.state=W.SCRIPT_DATA_ESCAPED,this._emitChars($t);break}case $.EOF:{this._err(se.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=W.SCRIPT_DATA_ESCAPED,this._emitCodePoint(e)}}_stateScriptDataEscapedDashDash(e){switch(e){case $.HYPHEN_MINUS:{this._emitChars("-");break}case $.LESS_THAN_SIGN:{this.state=W.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case $.GREATER_THAN_SIGN:{this.state=W.SCRIPT_DATA,this._emitChars(">");break}case $.NULL:{this._err(se.unexpectedNullCharacter),this.state=W.SCRIPT_DATA_ESCAPED,this._emitChars($t);break}case $.EOF:{this._err(se.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=W.SCRIPT_DATA_ESCAPED,this._emitCodePoint(e)}}_stateScriptDataEscapedLessThanSign(e){e===$.SOLIDUS?this.state=W.SCRIPT_DATA_ESCAPED_END_TAG_OPEN:Js(e)?(this._emitChars("<"),this.state=W.SCRIPT_DATA_DOUBLE_ESCAPE_START,this._stateScriptDataDoubleEscapeStart(e)):(this._emitChars("<"),this.state=W.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(e))}_stateScriptDataEscapedEndTagOpen(e){Js(e)?(this.state=W.SCRIPT_DATA_ESCAPED_END_TAG_NAME,this._stateScriptDataEscapedEndTagName(e)):(this._emitChars("</"),this.state=W.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(e))}_stateScriptDataEscapedEndTagName(e){this.handleSpecialEndTag(e)&&(this._emitChars("</"),this.state=W.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(e))}_stateScriptDataDoubleEscapeStart(e){if(this.preprocessor.startsWith(Jn.SCRIPT,!1)&&fR(this.preprocessor.peek(Jn.SCRIPT.length))){this._emitCodePoint(e);for(let n=0;n<Jn.SCRIPT.length;n++)this._emitCodePoint(this._consume());this.state=W.SCRIPT_DATA_DOUBLE_ESCAPED}else this._ensureHibernation()||(this.state=W.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(e))}_stateScriptDataDoubleEscaped(e){switch(e){case $.HYPHEN_MINUS:{this.state=W.SCRIPT_DATA_DOUBLE_ESCAPED_DASH,this._emitChars("-");break}case $.LESS_THAN_SIGN:{this.state=W.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case $.NULL:{this._err(se.unexpectedNullCharacter),this._emitChars($t);break}case $.EOF:{this._err(se.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateScriptDataDoubleEscapedDash(e){switch(e){case $.HYPHEN_MINUS:{this.state=W.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH,this._emitChars("-");break}case $.LESS_THAN_SIGN:{this.state=W.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case $.NULL:{this._err(se.unexpectedNullCharacter),this.state=W.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitChars($t);break}case $.EOF:{this._err(se.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=W.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitCodePoint(e)}}_stateScriptDataDoubleEscapedDashDash(e){switch(e){case $.HYPHEN_MINUS:{this._emitChars("-");break}case $.LESS_THAN_SIGN:{this.state=W.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case $.GREATER_THAN_SIGN:{this.state=W.SCRIPT_DATA,this._emitChars(">");break}case $.NULL:{this._err(se.unexpectedNullCharacter),this.state=W.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitChars($t);break}case $.EOF:{this._err(se.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=W.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitCodePoint(e)}}_stateScriptDataDoubleEscapedLessThanSign(e){e===$.SOLIDUS?(this.state=W.SCRIPT_DATA_DOUBLE_ESCAPE_END,this._emitChars("/")):(this.state=W.SCRIPT_DATA_DOUBLE_ESCAPED,this._stateScriptDataDoubleEscaped(e))}_stateScriptDataDoubleEscapeEnd(e){if(this.preprocessor.startsWith(Jn.SCRIPT,!1)&&fR(this.preprocessor.peek(Jn.SCRIPT.length))){this._emitCodePoint(e);for(let n=0;n<Jn.SCRIPT.length;n++)this._emitCodePoint(this._consume());this.state=W.SCRIPT_DATA_ESCAPED}else this._ensureHibernation()||(this.state=W.SCRIPT_DATA_DOUBLE_ESCAPED,this._stateScriptDataDoubleEscaped(e))}_stateBeforeAttributeName(e){switch(e){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:break;case $.SOLIDUS:case $.GREATER_THAN_SIGN:case $.EOF:{this.state=W.AFTER_ATTRIBUTE_NAME,this._stateAfterAttributeName(e);break}case $.EQUALS_SIGN:{this._err(se.unexpectedEqualsSignBeforeAttributeName),this._createAttr("="),this.state=W.ATTRIBUTE_NAME;break}default:this._createAttr(""),this.state=W.ATTRIBUTE_NAME,this._stateAttributeName(e)}}_stateAttributeName(e){switch(e){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:case $.SOLIDUS:case $.GREATER_THAN_SIGN:case $.EOF:{this._leaveAttrName(),this.state=W.AFTER_ATTRIBUTE_NAME,this._stateAfterAttributeName(e);break}case $.EQUALS_SIGN:{this._leaveAttrName(),this.state=W.BEFORE_ATTRIBUTE_VALUE;break}case $.QUOTATION_MARK:case $.APOSTROPHE:case $.LESS_THAN_SIGN:{this._err(se.unexpectedCharacterInAttributeName),this.currentAttr.name+=String.fromCodePoint(e);break}case $.NULL:{this._err(se.unexpectedNullCharacter),this.currentAttr.name+=$t;break}default:this.currentAttr.name+=String.fromCodePoint(Ic(e)?Sh(e):e)}}_stateAfterAttributeName(e){switch(e){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:break;case $.SOLIDUS:{this.state=W.SELF_CLOSING_START_TAG;break}case $.EQUALS_SIGN:{this.state=W.BEFORE_ATTRIBUTE_VALUE;break}case $.GREATER_THAN_SIGN:{this.state=W.DATA,this.emitCurrentTagToken();break}case $.EOF:{this._err(se.eofInTag),this._emitEOFToken();break}default:this._createAttr(""),this.state=W.ATTRIBUTE_NAME,this._stateAttributeName(e)}}_stateBeforeAttributeValue(e){switch(e){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:break;case $.QUOTATION_MARK:{this.state=W.ATTRIBUTE_VALUE_DOUBLE_QUOTED;break}case $.APOSTROPHE:{this.state=W.ATTRIBUTE_VALUE_SINGLE_QUOTED;break}case $.GREATER_THAN_SIGN:{this._err(se.missingAttributeValue),this.state=W.DATA,this.emitCurrentTagToken();break}default:this.state=W.ATTRIBUTE_VALUE_UNQUOTED,this._stateAttributeValueUnquoted(e)}}_stateAttributeValueDoubleQuoted(e){switch(e){case $.QUOTATION_MARK:{this.state=W.AFTER_ATTRIBUTE_VALUE_QUOTED;break}case $.AMPERSAND:{this._startCharacterReference();break}case $.NULL:{this._err(se.unexpectedNullCharacter),this.currentAttr.value+=$t;break}case $.EOF:{this._err(se.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(e)}}_stateAttributeValueSingleQuoted(e){switch(e){case $.APOSTROPHE:{this.state=W.AFTER_ATTRIBUTE_VALUE_QUOTED;break}case $.AMPERSAND:{this._startCharacterReference();break}case $.NULL:{this._err(se.unexpectedNullCharacter),this.currentAttr.value+=$t;break}case $.EOF:{this._err(se.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(e)}}_stateAttributeValueUnquoted(e){switch(e){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:{this._leaveAttrValue(),this.state=W.BEFORE_ATTRIBUTE_NAME;break}case $.AMPERSAND:{this._startCharacterReference();break}case $.GREATER_THAN_SIGN:{this._leaveAttrValue(),this.state=W.DATA,this.emitCurrentTagToken();break}case $.NULL:{this._err(se.unexpectedNullCharacter),this.currentAttr.value+=$t;break}case $.QUOTATION_MARK:case $.APOSTROPHE:case $.LESS_THAN_SIGN:case $.EQUALS_SIGN:case $.GRAVE_ACCENT:{this._err(se.unexpectedCharacterInUnquotedAttributeValue),this.currentAttr.value+=String.fromCodePoint(e);break}case $.EOF:{this._err(se.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(e)}}_stateAfterAttributeValueQuoted(e){switch(e){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:{this._leaveAttrValue(),this.state=W.BEFORE_ATTRIBUTE_NAME;break}case $.SOLIDUS:{this._leaveAttrValue(),this.state=W.SELF_CLOSING_START_TAG;break}case $.GREATER_THAN_SIGN:{this._leaveAttrValue(),this.state=W.DATA,this.emitCurrentTagToken();break}case $.EOF:{this._err(se.eofInTag),this._emitEOFToken();break}default:this._err(se.missingWhitespaceBetweenAttributes),this.state=W.BEFORE_ATTRIBUTE_NAME,this._stateBeforeAttributeName(e)}}_stateSelfClosingStartTag(e){switch(e){case $.GREATER_THAN_SIGN:{const n=this.currentToken;n.selfClosing=!0,this.state=W.DATA,this.emitCurrentTagToken();break}case $.EOF:{this._err(se.eofInTag),this._emitEOFToken();break}default:this._err(se.unexpectedSolidusInTag),this.state=W.BEFORE_ATTRIBUTE_NAME,this._stateBeforeAttributeName(e)}}_stateBogusComment(e){const n=this.currentToken;switch(e){case $.GREATER_THAN_SIGN:{this.state=W.DATA,this.emitCurrentComment(n);break}case $.EOF:{this.emitCurrentComment(n),this._emitEOFToken();break}case $.NULL:{this._err(se.unexpectedNullCharacter),n.data+=$t;break}default:n.data+=String.fromCodePoint(e)}}_stateMarkupDeclarationOpen(e){this._consumeSequenceIfMatch(Jn.DASH_DASH,!0)?(this._createCommentToken(Jn.DASH_DASH.length+1),this.state=W.COMMENT_START):this._consumeSequenceIfMatch(Jn.DOCTYPE,!1)?(this.currentLocation=this.getCurrentLocation(Jn.DOCTYPE.length+1),this.state=W.DOCTYPE):this._consumeSequenceIfMatch(Jn.CDATA_START,!0)?this.inForeignNode?this.state=W.CDATA_SECTION:(this._err(se.cdataInHtmlContent),this._createCommentToken(Jn.CDATA_START.length+1),this.currentToken.data="[CDATA[",this.state=W.BOGUS_COMMENT):this._ensureHibernation()||(this._err(se.incorrectlyOpenedComment),this._createCommentToken(2),this.state=W.BOGUS_COMMENT,this._stateBogusComment(e))}_stateCommentStart(e){switch(e){case $.HYPHEN_MINUS:{this.state=W.COMMENT_START_DASH;break}case $.GREATER_THAN_SIGN:{this._err(se.abruptClosingOfEmptyComment),this.state=W.DATA;const n=this.currentToken;this.emitCurrentComment(n);break}default:this.state=W.COMMENT,this._stateComment(e)}}_stateCommentStartDash(e){const n=this.currentToken;switch(e){case $.HYPHEN_MINUS:{this.state=W.COMMENT_END;break}case $.GREATER_THAN_SIGN:{this._err(se.abruptClosingOfEmptyComment),this.state=W.DATA,this.emitCurrentComment(n);break}case $.EOF:{this._err(se.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+="-",this.state=W.COMMENT,this._stateComment(e)}}_stateComment(e){const n=this.currentToken;switch(e){case $.HYPHEN_MINUS:{this.state=W.COMMENT_END_DASH;break}case $.LESS_THAN_SIGN:{n.data+="<",this.state=W.COMMENT_LESS_THAN_SIGN;break}case $.NULL:{this._err(se.unexpectedNullCharacter),n.data+=$t;break}case $.EOF:{this._err(se.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+=String.fromCodePoint(e)}}_stateCommentLessThanSign(e){const n=this.currentToken;switch(e){case $.EXCLAMATION_MARK:{n.data+="!",this.state=W.COMMENT_LESS_THAN_SIGN_BANG;break}case $.LESS_THAN_SIGN:{n.data+="<";break}default:this.state=W.COMMENT,this._stateComment(e)}}_stateCommentLessThanSignBang(e){e===$.HYPHEN_MINUS?this.state=W.COMMENT_LESS_THAN_SIGN_BANG_DASH:(this.state=W.COMMENT,this._stateComment(e))}_stateCommentLessThanSignBangDash(e){e===$.HYPHEN_MINUS?this.state=W.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH:(this.state=W.COMMENT_END_DASH,this._stateCommentEndDash(e))}_stateCommentLessThanSignBangDashDash(e){e!==$.GREATER_THAN_SIGN&&e!==$.EOF&&this._err(se.nestedComment),this.state=W.COMMENT_END,this._stateCommentEnd(e)}_stateCommentEndDash(e){const n=this.currentToken;switch(e){case $.HYPHEN_MINUS:{this.state=W.COMMENT_END;break}case $.EOF:{this._err(se.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+="-",this.state=W.COMMENT,this._stateComment(e)}}_stateCommentEnd(e){const n=this.currentToken;switch(e){case $.GREATER_THAN_SIGN:{this.state=W.DATA,this.emitCurrentComment(n);break}case $.EXCLAMATION_MARK:{this.state=W.COMMENT_END_BANG;break}case $.HYPHEN_MINUS:{n.data+="-";break}case $.EOF:{this._err(se.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+="--",this.state=W.COMMENT,this._stateComment(e)}}_stateCommentEndBang(e){const n=this.currentToken;switch(e){case $.HYPHEN_MINUS:{n.data+="--!",this.state=W.COMMENT_END_DASH;break}case $.GREATER_THAN_SIGN:{this._err(se.incorrectlyClosedComment),this.state=W.DATA,this.emitCurrentComment(n);break}case $.EOF:{this._err(se.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+="--!",this.state=W.COMMENT,this._stateComment(e)}}_stateDoctype(e){switch(e){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:{this.state=W.BEFORE_DOCTYPE_NAME;break}case $.GREATER_THAN_SIGN:{this.state=W.BEFORE_DOCTYPE_NAME,this._stateBeforeDoctypeName(e);break}case $.EOF:{this._err(se.eofInDoctype),this._createDoctypeToken(null);const n=this.currentToken;n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(se.missingWhitespaceBeforeDoctypeName),this.state=W.BEFORE_DOCTYPE_NAME,this._stateBeforeDoctypeName(e)}}_stateBeforeDoctypeName(e){if(Ic(e))this._createDoctypeToken(String.fromCharCode(Sh(e))),this.state=W.DOCTYPE_NAME;else switch(e){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:break;case $.NULL:{this._err(se.unexpectedNullCharacter),this._createDoctypeToken($t),this.state=W.DOCTYPE_NAME;break}case $.GREATER_THAN_SIGN:{this._err(se.missingDoctypeName),this._createDoctypeToken(null);const n=this.currentToken;n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=W.DATA;break}case $.EOF:{this._err(se.eofInDoctype),this._createDoctypeToken(null);const n=this.currentToken;n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._createDoctypeToken(String.fromCodePoint(e)),this.state=W.DOCTYPE_NAME}}_stateDoctypeName(e){const n=this.currentToken;switch(e){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:{this.state=W.AFTER_DOCTYPE_NAME;break}case $.GREATER_THAN_SIGN:{this.state=W.DATA,this.emitCurrentDoctype(n);break}case $.NULL:{this._err(se.unexpectedNullCharacter),n.name+=$t;break}case $.EOF:{this._err(se.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.name+=String.fromCodePoint(Ic(e)?Sh(e):e)}}_stateAfterDoctypeName(e){const n=this.currentToken;switch(e){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:break;case $.GREATER_THAN_SIGN:{this.state=W.DATA,this.emitCurrentDoctype(n);break}case $.EOF:{this._err(se.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._consumeSequenceIfMatch(Jn.PUBLIC,!1)?this.state=W.AFTER_DOCTYPE_PUBLIC_KEYWORD:this._consumeSequenceIfMatch(Jn.SYSTEM,!1)?this.state=W.AFTER_DOCTYPE_SYSTEM_KEYWORD:this._ensureHibernation()||(this._err(se.invalidCharacterSequenceAfterDoctypeName),n.forceQuirks=!0,this.state=W.BOGUS_DOCTYPE,this._stateBogusDoctype(e))}}_stateAfterDoctypePublicKeyword(e){const n=this.currentToken;switch(e){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:{this.state=W.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER;break}case $.QUOTATION_MARK:{this._err(se.missingWhitespaceAfterDoctypePublicKeyword),n.publicId="",this.state=W.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED;break}case $.APOSTROPHE:{this._err(se.missingWhitespaceAfterDoctypePublicKeyword),n.publicId="",this.state=W.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED;break}case $.GREATER_THAN_SIGN:{this._err(se.missingDoctypePublicIdentifier),n.forceQuirks=!0,this.state=W.DATA,this.emitCurrentDoctype(n);break}case $.EOF:{this._err(se.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(se.missingQuoteBeforeDoctypePublicIdentifier),n.forceQuirks=!0,this.state=W.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateBeforeDoctypePublicIdentifier(e){const n=this.currentToken;switch(e){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:break;case $.QUOTATION_MARK:{n.publicId="",this.state=W.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED;break}case $.APOSTROPHE:{n.publicId="",this.state=W.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED;break}case $.GREATER_THAN_SIGN:{this._err(se.missingDoctypePublicIdentifier),n.forceQuirks=!0,this.state=W.DATA,this.emitCurrentDoctype(n);break}case $.EOF:{this._err(se.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(se.missingQuoteBeforeDoctypePublicIdentifier),n.forceQuirks=!0,this.state=W.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateDoctypePublicIdentifierDoubleQuoted(e){const n=this.currentToken;switch(e){case $.QUOTATION_MARK:{this.state=W.AFTER_DOCTYPE_PUBLIC_IDENTIFIER;break}case $.NULL:{this._err(se.unexpectedNullCharacter),n.publicId+=$t;break}case $.GREATER_THAN_SIGN:{this._err(se.abruptDoctypePublicIdentifier),n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=W.DATA;break}case $.EOF:{this._err(se.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.publicId+=String.fromCodePoint(e)}}_stateDoctypePublicIdentifierSingleQuoted(e){const n=this.currentToken;switch(e){case $.APOSTROPHE:{this.state=W.AFTER_DOCTYPE_PUBLIC_IDENTIFIER;break}case $.NULL:{this._err(se.unexpectedNullCharacter),n.publicId+=$t;break}case $.GREATER_THAN_SIGN:{this._err(se.abruptDoctypePublicIdentifier),n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=W.DATA;break}case $.EOF:{this._err(se.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.publicId+=String.fromCodePoint(e)}}_stateAfterDoctypePublicIdentifier(e){const n=this.currentToken;switch(e){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:{this.state=W.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS;break}case $.GREATER_THAN_SIGN:{this.state=W.DATA,this.emitCurrentDoctype(n);break}case $.QUOTATION_MARK:{this._err(se.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers),n.systemId="",this.state=W.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case $.APOSTROPHE:{this._err(se.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers),n.systemId="",this.state=W.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case $.EOF:{this._err(se.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(se.missingQuoteBeforeDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=W.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateBetweenDoctypePublicAndSystemIdentifiers(e){const n=this.currentToken;switch(e){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:break;case $.GREATER_THAN_SIGN:{this.emitCurrentDoctype(n),this.state=W.DATA;break}case $.QUOTATION_MARK:{n.systemId="",this.state=W.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case $.APOSTROPHE:{n.systemId="",this.state=W.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case $.EOF:{this._err(se.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(se.missingQuoteBeforeDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=W.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateAfterDoctypeSystemKeyword(e){const n=this.currentToken;switch(e){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:{this.state=W.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER;break}case $.QUOTATION_MARK:{this._err(se.missingWhitespaceAfterDoctypeSystemKeyword),n.systemId="",this.state=W.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case $.APOSTROPHE:{this._err(se.missingWhitespaceAfterDoctypeSystemKeyword),n.systemId="",this.state=W.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case $.GREATER_THAN_SIGN:{this._err(se.missingDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=W.DATA,this.emitCurrentDoctype(n);break}case $.EOF:{this._err(se.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(se.missingQuoteBeforeDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=W.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateBeforeDoctypeSystemIdentifier(e){const n=this.currentToken;switch(e){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:break;case $.QUOTATION_MARK:{n.systemId="",this.state=W.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case $.APOSTROPHE:{n.systemId="",this.state=W.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case $.GREATER_THAN_SIGN:{this._err(se.missingDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=W.DATA,this.emitCurrentDoctype(n);break}case $.EOF:{this._err(se.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(se.missingQuoteBeforeDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=W.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateDoctypeSystemIdentifierDoubleQuoted(e){const n=this.currentToken;switch(e){case $.QUOTATION_MARK:{this.state=W.AFTER_DOCTYPE_SYSTEM_IDENTIFIER;break}case $.NULL:{this._err(se.unexpectedNullCharacter),n.systemId+=$t;break}case $.GREATER_THAN_SIGN:{this._err(se.abruptDoctypeSystemIdentifier),n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=W.DATA;break}case $.EOF:{this._err(se.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.systemId+=String.fromCodePoint(e)}}_stateDoctypeSystemIdentifierSingleQuoted(e){const n=this.currentToken;switch(e){case $.APOSTROPHE:{this.state=W.AFTER_DOCTYPE_SYSTEM_IDENTIFIER;break}case $.NULL:{this._err(se.unexpectedNullCharacter),n.systemId+=$t;break}case $.GREATER_THAN_SIGN:{this._err(se.abruptDoctypeSystemIdentifier),n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=W.DATA;break}case $.EOF:{this._err(se.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.systemId+=String.fromCodePoint(e)}}_stateAfterDoctypeSystemIdentifier(e){const n=this.currentToken;switch(e){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:break;case $.GREATER_THAN_SIGN:{this.emitCurrentDoctype(n),this.state=W.DATA;break}case $.EOF:{this._err(se.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(se.unexpectedCharacterAfterDoctypeSystemIdentifier),this.state=W.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateBogusDoctype(e){const n=this.currentToken;switch(e){case $.GREATER_THAN_SIGN:{this.emitCurrentDoctype(n),this.state=W.DATA;break}case $.NULL:{this._err(se.unexpectedNullCharacter);break}case $.EOF:{this.emitCurrentDoctype(n),this._emitEOFToken();break}}}_stateCdataSection(e){switch(e){case $.RIGHT_SQUARE_BRACKET:{this.state=W.CDATA_SECTION_BRACKET;break}case $.EOF:{this._err(se.eofInCdata),this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateCdataSectionBracket(e){e===$.RIGHT_SQUARE_BRACKET?this.state=W.CDATA_SECTION_END:(this._emitChars("]"),this.state=W.CDATA_SECTION,this._stateCdataSection(e))}_stateCdataSectionEnd(e){switch(e){case $.GREATER_THAN_SIGN:{this.state=W.DATA;break}case $.RIGHT_SQUARE_BRACKET:{this._emitChars("]");break}default:this._emitChars("]]"),this.state=W.CDATA_SECTION,this._stateCdataSection(e)}}_stateCharacterReference(){let e=this.entityDecoder.write(this.preprocessor.html,this.preprocessor.pos);if(e<0)if(this.preprocessor.lastChunkWritten)e=this.entityDecoder.end();else{this.active=!1,this.preprocessor.pos=this.preprocessor.html.length-1,this.consumedAfterSnapshot=0,this.preprocessor.endOfChunkHit=!0;return}e===0?(this.preprocessor.pos=this.entityStartPos,this._flushCodePointConsumedAsCharacterReference($.AMPERSAND),this.state=!this._isCharacterReferenceInAttribute()&&cR(this.preprocessor.peek(1))?W.AMBIGUOUS_AMPERSAND:this.returnState):this.state=this.returnState}_stateAmbiguousAmpersand(e){cR(e)?this._flushCodePointConsumedAsCharacterReference(e):(e===$.SEMICOLON&&this._err(se.unknownNamedCharacterReference),this.state=this.returnState,this._callState(e))}};const hR=new Set([E.DD,E.DT,E.LI,E.OPTGROUP,E.OPTION,E.P,E.RB,E.RP,E.RT,E.RTC]),pR=new Set([...hR,E.CAPTION,E.COLGROUP,E.TBODY,E.TD,E.TFOOT,E.TH,E.THEAD,E.TR]),xh=new Set([E.APPLET,E.CAPTION,E.HTML,E.MARQUEE,E.OBJECT,E.TABLE,E.TD,E.TEMPLATE,E.TH]),TV=new Set([...xh,E.OL,E.UL]),SV=new Set([...xh,E.BUTTON]),mR=new Set([E.ANNOTATION_XML,E.MI,E.MN,E.MO,E.MS,E.MTEXT]),gR=new Set([E.DESC,E.FOREIGN_OBJECT,E.TITLE]),xV=new Set([E.TR,E.TEMPLATE,E.HTML]),wV=new Set([E.TBODY,E.TFOOT,E.THEAD,E.TEMPLATE,E.HTML]),_V=new Set([E.TABLE,E.TEMPLATE,E.HTML]),AV=new Set([E.TD,E.TH]);class CV{get currentTmplContentOrNode(){return this._isInTemplate()?this.treeAdapter.getTemplateContent(this.current):this.current}constructor(e,n,i){this.treeAdapter=n,this.handler=i,this.items=[],this.tagIDs=[],this.stackTop=-1,this.tmplCount=0,this.currentTagId=E.UNKNOWN,this.current=e}_indexOf(e){return this.items.lastIndexOf(e,this.stackTop)}_isInTemplate(){return this.currentTagId===E.TEMPLATE&&this.treeAdapter.getNamespaceURI(this.current)===he.HTML}_updateCurrentElement(){this.current=this.items[this.stackTop],this.currentTagId=this.tagIDs[this.stackTop]}push(e,n){this.stackTop++,this.items[this.stackTop]=e,this.current=e,this.tagIDs[this.stackTop]=n,this.currentTagId=n,this._isInTemplate()&&this.tmplCount++,this.handler.onItemPush(e,n,!0)}pop(){const e=this.current;this.tmplCount>0&&this._isInTemplate()&&this.tmplCount--,this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(e,!0)}replace(e,n){const i=this._indexOf(e);this.items[i]=n,i===this.stackTop&&(this.current=n)}insertAfter(e,n,i){const r=this._indexOf(e)+1;this.items.splice(r,0,n),this.tagIDs.splice(r,0,i),this.stackTop++,r===this.stackTop&&this._updateCurrentElement(),this.current&&this.currentTagId!==void 0&&this.handler.onItemPush(this.current,this.currentTagId,r===this.stackTop)}popUntilTagNamePopped(e){let n=this.stackTop+1;do n=this.tagIDs.lastIndexOf(e,n-1);while(n>0&&this.treeAdapter.getNamespaceURI(this.items[n])!==he.HTML);this.shortenToLength(Math.max(n,0))}shortenToLength(e){for(;this.stackTop>=e;){const n=this.current;this.tmplCount>0&&this._isInTemplate()&&(this.tmplCount-=1),this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(n,this.stackTop<e)}}popUntilElementPopped(e){const n=this._indexOf(e);this.shortenToLength(Math.max(n,0))}popUntilPopped(e,n){const i=this._indexOfTagNames(e,n);this.shortenToLength(Math.max(i,0))}popUntilNumberedHeaderPopped(){this.popUntilPopped($1,he.HTML)}popUntilTableCellPopped(){this.popUntilPopped(AV,he.HTML)}popAllUpToHtmlElement(){this.tmplCount=0,this.shortenToLength(1)}_indexOfTagNames(e,n){for(let i=this.stackTop;i>=0;i--)if(e.has(this.tagIDs[i])&&this.treeAdapter.getNamespaceURI(this.items[i])===n)return i;return-1}clearBackTo(e,n){const i=this._indexOfTagNames(e,n);this.shortenToLength(i+1)}clearBackToTableContext(){this.clearBackTo(_V,he.HTML)}clearBackToTableBodyContext(){this.clearBackTo(wV,he.HTML)}clearBackToTableRowContext(){this.clearBackTo(xV,he.HTML)}remove(e){const n=this._indexOf(e);n>=0&&(n===this.stackTop?this.pop():(this.items.splice(n,1),this.tagIDs.splice(n,1),this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(e,!1)))}tryPeekProperlyNestedBodyElement(){return this.stackTop>=1&&this.tagIDs[1]===E.BODY?this.items[1]:null}contains(e){return this._indexOf(e)>-1}getCommonAncestor(e){const n=this._indexOf(e)-1;return n>=0?this.items[n]:null}isRootHtmlElementCurrent(){return this.stackTop===0&&this.tagIDs[0]===E.HTML}hasInDynamicScope(e,n){for(let i=this.stackTop;i>=0;i--){const r=this.tagIDs[i];switch(this.treeAdapter.getNamespaceURI(this.items[i])){case he.HTML:{if(r===e)return!0;if(n.has(r))return!1;break}case he.SVG:{if(gR.has(r))return!1;break}case he.MATHML:{if(mR.has(r))return!1;break}}}return!0}hasInScope(e){return this.hasInDynamicScope(e,xh)}hasInListItemScope(e){return this.hasInDynamicScope(e,TV)}hasInButtonScope(e){return this.hasInDynamicScope(e,SV)}hasNumberedHeaderInScope(){for(let e=this.stackTop;e>=0;e--){const n=this.tagIDs[e];switch(this.treeAdapter.getNamespaceURI(this.items[e])){case he.HTML:{if($1.has(n))return!0;if(xh.has(n))return!1;break}case he.SVG:{if(gR.has(n))return!1;break}case he.MATHML:{if(mR.has(n))return!1;break}}}return!0}hasInTableScope(e){for(let n=this.stackTop;n>=0;n--)if(this.treeAdapter.getNamespaceURI(this.items[n])===he.HTML)switch(this.tagIDs[n]){case e:return!0;case E.TABLE:case E.HTML:return!1}return!0}hasTableBodyContextInTableScope(){for(let e=this.stackTop;e>=0;e--)if(this.treeAdapter.getNamespaceURI(this.items[e])===he.HTML)switch(this.tagIDs[e]){case E.TBODY:case E.THEAD:case E.TFOOT:return!0;case E.TABLE:case E.HTML:return!1}return!0}hasInSelectScope(e){for(let n=this.stackTop;n>=0;n--)if(this.treeAdapter.getNamespaceURI(this.items[n])===he.HTML)switch(this.tagIDs[n]){case e:return!0;case E.OPTION:case E.OPTGROUP:break;default:return!1}return!0}generateImpliedEndTags(){for(;this.currentTagId!==void 0&&hR.has(this.currentTagId);)this.pop()}generateImpliedEndTagsThoroughly(){for(;this.currentTagId!==void 0&&pR.has(this.currentTagId);)this.pop()}generateImpliedEndTagsWithExclusion(e){for(;this.currentTagId!==void 0&&this.currentTagId!==e&&pR.has(this.currentTagId);)this.pop()}}const z1=3;var br;(function(t){t[t.Marker=0]="Marker",t[t.Element=1]="Element"})(br||(br={}));const yR={type:br.Marker};class IV{constructor(e){this.treeAdapter=e,this.entries=[],this.bookmark=null}_getNoahArkConditionCandidates(e,n){const i=[],r=n.length,s=this.treeAdapter.getTagName(e),o=this.treeAdapter.getNamespaceURI(e);for(let a=0;a<this.entries.length;a++){const l=this.entries[a];if(l.type===br.Marker)break;const{element:u}=l;if(this.treeAdapter.getTagName(u)===s&&this.treeAdapter.getNamespaceURI(u)===o){const c=this.treeAdapter.getAttrList(u);c.length===r&&i.push({idx:a,attrs:c})}}return i}_ensureNoahArkCondition(e){if(this.entries.length<z1)return;const n=this.treeAdapter.getAttrList(e),i=this._getNoahArkConditionCandidates(e,n);if(i.length<z1)return;const r=new Map(n.map(o=>[o.name,o.value]));let s=0;for(let o=0;o<i.length;o++){const a=i[o];a.attrs.every(l=>r.get(l.name)===l.value)&&(s+=1,s>=z1&&this.entries.splice(a.idx,1))}}insertMarker(){this.entries.unshift(yR)}pushElement(e,n){this._ensureNoahArkCondition(e),this.entries.unshift({type:br.Element,element:e,token:n})}insertElementAfterBookmark(e,n){const i=this.entries.indexOf(this.bookmark);this.entries.splice(i,0,{type:br.Element,element:e,token:n})}removeEntry(e){const n=this.entries.indexOf(e);n!==-1&&this.entries.splice(n,1)}clearToLastMarker(){const e=this.entries.indexOf(yR);e===-1?this.entries.length=0:this.entries.splice(0,e+1)}getElementEntryInScopeWithTagName(e){const n=this.entries.find(i=>i.type===br.Marker||this.treeAdapter.getTagName(i.element)===e);return n&&n.type===br.Element?n:null}getElementEntry(e){return this.entries.find(n=>n.type===br.Element&&n.element===e)}}const eo={createDocument(){return{nodeName:"#document",mode:Bi.NO_QUIRKS,childNodes:[]}},createDocumentFragment(){return{nodeName:"#document-fragment",childNodes:[]}},createElement(t,e,n){return{nodeName:t,tagName:t,attrs:n,namespaceURI:e,childNodes:[],parentNode:null}},createCommentNode(t){return{nodeName:"#comment",data:t,parentNode:null}},createTextNode(t){return{nodeName:"#text",value:t,parentNode:null}},appendChild(t,e){t.childNodes.push(e),e.parentNode=t},insertBefore(t,e,n){const i=t.childNodes.indexOf(n);t.childNodes.splice(i,0,e),e.parentNode=t},setTemplateContent(t,e){t.content=e},getTemplateContent(t){return t.content},setDocumentType(t,e,n,i){const r=t.childNodes.find(s=>s.nodeName==="#documentType");if(r)r.name=e,r.publicId=n,r.systemId=i;else{const s={nodeName:"#documentType",name:e,publicId:n,systemId:i,parentNode:null};eo.appendChild(t,s)}},setDocumentMode(t,e){t.mode=e},getDocumentMode(t){return t.mode},detachNode(t){if(t.parentNode){const e=t.parentNode.childNodes.indexOf(t);t.parentNode.childNodes.splice(e,1),t.parentNode=null}},insertText(t,e){if(t.childNodes.length>0){const n=t.childNodes[t.childNodes.length-1];if(eo.isTextNode(n)){n.value+=e;return}}eo.appendChild(t,eo.createTextNode(e))},insertTextBefore(t,e,n){const i=t.childNodes[t.childNodes.indexOf(n)-1];i&&eo.isTextNode(i)?i.value+=e:eo.insertBefore(t,eo.createTextNode(e),n)},adoptAttributes(t,e){const n=new Set(t.attrs.map(i=>i.name));for(let i=0;i<e.length;i++)n.has(e[i].name)||t.attrs.push(e[i])},getFirstChild(t){return t.childNodes[0]},getChildNodes(t){return t.childNodes},getParentNode(t){return t.parentNode},getAttrList(t){return t.attrs},getTagName(t){return t.tagName},getNamespaceURI(t){return t.namespaceURI},getTextNodeContent(t){return t.value},getCommentNodeContent(t){return t.data},getDocumentTypeNodeName(t){return t.name},getDocumentTypeNodePublicId(t){return t.publicId},getDocumentTypeNodeSystemId(t){return t.systemId},isTextNode(t){return t.nodeName==="#text"},isCommentNode(t){return t.nodeName==="#comment"},isDocumentTypeNode(t){return t.nodeName==="#documentType"},isElementNode(t){return Object.prototype.hasOwnProperty.call(t,"tagName")},setNodeSourceCodeLocation(t,e){t.sourceCodeLocation=e},getNodeSourceCodeLocation(t){return t.sourceCodeLocation},updateNodeSourceCodeLocation(t,e){t.sourceCodeLocation={...t.sourceCodeLocation,...e}}},vR="html",RV="about:legacy-compat",LV="http://www.ibm.com/data/dtd/v11/ibmxhtml1-transitional.dtd",bR=["+//silmaril//dtd html pro v0r11 19970101//","-//as//dtd html 3.0 aswedit + extensions//","-//advasoft ltd//dtd html 3.0 aswedit + extensions//","-//ietf//dtd html 2.0 level 1//","-//ietf//dtd html 2.0 level 2//","-//ietf//dtd html 2.0 strict level 1//","-//ietf//dtd html 2.0 strict level 2//","-//ietf//dtd html 2.0 strict//","-//ietf//dtd html 2.0//","-//ietf//dtd html 2.1e//","-//ietf//dtd html 3.0//","-//ietf//dtd html 3.2 final//","-//ietf//dtd html 3.2//","-//ietf//dtd html 3//","-//ietf//dtd html level 0//","-//ietf//dtd html level 1//","-//ietf//dtd html level 2//","-//ietf//dtd html level 3//","-//ietf//dtd html strict level 0//","-//ietf//dtd html strict level 1//","-//ietf//dtd html strict level 2//","-//ietf//dtd html strict level 3//","-//ietf//dtd html strict//","-//ietf//dtd html//","-//metrius//dtd metrius presentational//","-//microsoft//dtd internet explorer 2.0 html strict//","-//microsoft//dtd internet explorer 2.0 html//","-//microsoft//dtd internet explorer 2.0 tables//","-//microsoft//dtd internet explorer 3.0 html strict//","-//microsoft//dtd internet explorer 3.0 html//","-//microsoft//dtd internet explorer 3.0 tables//","-//netscape comm. corp.//dtd html//","-//netscape comm. corp.//dtd strict html//","-//o'reilly and associates//dtd html 2.0//","-//o'reilly and associates//dtd html extended 1.0//","-//o'reilly and associates//dtd html extended relaxed 1.0//","-//sq//dtd html 2.0 hotmetal + extensions//","-//softquad software//dtd hotmetal pro 6.0::19990601::extensions to html 4.0//","-//softquad//dtd hotmetal pro 4.0::19971010::extensions to html 4.0//","-//spyglass//dtd html 2.0 extended//","-//sun microsystems corp.//dtd hotjava html//","-//sun microsystems corp.//dtd hotjava strict html//","-//w3c//dtd html 3 1995-03-24//","-//w3c//dtd html 3.2 draft//","-//w3c//dtd html 3.2 final//","-//w3c//dtd html 3.2//","-//w3c//dtd html 3.2s draft//","-//w3c//dtd html 4.0 frameset//","-//w3c//dtd html 4.0 transitional//","-//w3c//dtd html experimental 19960712//","-//w3c//dtd html experimental 970421//","-//w3c//dtd w3 html//","-//w3o//dtd w3 html 3.0//","-//webtechs//dtd mozilla html 2.0//","-//webtechs//dtd mozilla html//"],PV=[...bR,"-//w3c//dtd html 4.01 frameset//","-//w3c//dtd html 4.01 transitional//"],kV=new Set(["-//w3o//dtd w3 html strict 3.0//en//","-/w3c/dtd html 4.0 transitional/en","html"]),ER=["-//w3c//dtd xhtml 1.0 frameset//","-//w3c//dtd xhtml 1.0 transitional//"],DV=[...ER,"-//w3c//dtd html 4.01 frameset//","-//w3c//dtd html 4.01 transitional//"];function TR(t,e){return e.some(n=>t.startsWith(n))}function OV(t){return t.name===vR&&t.publicId===null&&(t.systemId===null||t.systemId===RV)}function NV(t){if(t.name!==vR)return Bi.QUIRKS;const{systemId:e}=t;if(e&&e.toLowerCase()===LV)return Bi.QUIRKS;let{publicId:n}=t;if(n!==null){if(n=n.toLowerCase(),kV.has(n))return Bi.QUIRKS;let i=e===null?PV:bR;if(TR(n,i))return Bi.QUIRKS;if(i=e===null?ER:DV,TR(n,i))return Bi.LIMITED_QUIRKS}return Bi.NO_QUIRKS}const SR={TEXT_HTML:"text/html",APPLICATION_XML:"application/xhtml+xml"},MV="definitionurl",FV="definitionURL",BV=new Map(["attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(t=>[t.toLowerCase(),t])),UV=new Map([["xlink:actuate",{prefix:"xlink",name:"actuate",namespace:he.XLINK}],["xlink:arcrole",{prefix:"xlink",name:"arcrole",namespace:he.XLINK}],["xlink:href",{prefix:"xlink",name:"href",namespace:he.XLINK}],["xlink:role",{prefix:"xlink",name:"role",namespace:he.XLINK}],["xlink:show",{prefix:"xlink",name:"show",namespace:he.XLINK}],["xlink:title",{prefix:"xlink",name:"title",namespace:he.XLINK}],["xlink:type",{prefix:"xlink",name:"type",namespace:he.XLINK}],["xml:lang",{prefix:"xml",name:"lang",namespace:he.XML}],["xml:space",{prefix:"xml",name:"space",namespace:he.XML}],["xmlns",{prefix:"",name:"xmlns",namespace:he.XMLNS}],["xmlns:xlink",{prefix:"xmlns",name:"xlink",namespace:he.XMLNS}]]),HV=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(t=>[t.toLowerCase(),t])),$V=new Set([E.B,E.BIG,E.BLOCKQUOTE,E.BODY,E.BR,E.CENTER,E.CODE,E.DD,E.DIV,E.DL,E.DT,E.EM,E.EMBED,E.H1,E.H2,E.H3,E.H4,E.H5,E.H6,E.HEAD,E.HR,E.I,E.IMG,E.LI,E.LISTING,E.MENU,E.META,E.NOBR,E.OL,E.P,E.PRE,E.RUBY,E.S,E.SMALL,E.SPAN,E.STRONG,E.STRIKE,E.SUB,E.SUP,E.TABLE,E.TT,E.U,E.UL,E.VAR]);function zV(t){const e=t.tagID;return e===E.FONT&&t.attrs.some(({name:i})=>i===Zo.COLOR||i===Zo.SIZE||i===Zo.FACE)||$V.has(e)}function xR(t){for(let e=0;e<t.attrs.length;e++)if(t.attrs[e].name===MV){t.attrs[e].name=FV;break}}function wR(t){for(let e=0;e<t.attrs.length;e++){const n=BV.get(t.attrs[e].name);n!=null&&(t.attrs[e].name=n)}}function V1(t){for(let e=0;e<t.attrs.length;e++){const n=UV.get(t.attrs[e].name);n&&(t.attrs[e].prefix=n.prefix,t.attrs[e].name=n.name,t.attrs[e].namespace=n.namespace)}}function VV(t){const e=HV.get(t.tagName);e!=null&&(t.tagName=e,t.tagID=Tl(t.tagName))}function GV(t,e){return e===he.MATHML&&(t===E.MI||t===E.MO||t===E.MN||t===E.MS||t===E.MTEXT)}function jV(t,e,n){if(e===he.MATHML&&t===E.ANNOTATION_XML){for(let i=0;i<n.length;i++)if(n[i].name===Zo.ENCODING){const r=n[i].value.toLowerCase();return r===SR.TEXT_HTML||r===SR.APPLICATION_XML}}return e===he.SVG&&(t===E.FOREIGN_OBJECT||t===E.DESC||t===E.TITLE)}function WV(t,e,n,i){return(!i||i===he.HTML)&&jV(t,e,n)||(!i||i===he.MATHML)&&GV(t,e)}const qV="hidden",KV=8,YV=3;var q;(function(t){t[t.INITIAL=0]="INITIAL",t[t.BEFORE_HTML=1]="BEFORE_HTML",t[t.BEFORE_HEAD=2]="BEFORE_HEAD",t[t.IN_HEAD=3]="IN_HEAD",t[t.IN_HEAD_NO_SCRIPT=4]="IN_HEAD_NO_SCRIPT",t[t.AFTER_HEAD=5]="AFTER_HEAD",t[t.IN_BODY=6]="IN_BODY",t[t.TEXT=7]="TEXT",t[t.IN_TABLE=8]="IN_TABLE",t[t.IN_TABLE_TEXT=9]="IN_TABLE_TEXT",t[t.IN_CAPTION=10]="IN_CAPTION",t[t.IN_COLUMN_GROUP=11]="IN_COLUMN_GROUP",t[t.IN_TABLE_BODY=12]="IN_TABLE_BODY",t[t.IN_ROW=13]="IN_ROW",t[t.IN_CELL=14]="IN_CELL",t[t.IN_SELECT=15]="IN_SELECT",t[t.IN_SELECT_IN_TABLE=16]="IN_SELECT_IN_TABLE",t[t.IN_TEMPLATE=17]="IN_TEMPLATE",t[t.AFTER_BODY=18]="AFTER_BODY",t[t.IN_FRAMESET=19]="IN_FRAMESET",t[t.AFTER_FRAMESET=20]="AFTER_FRAMESET",t[t.AFTER_AFTER_BODY=21]="AFTER_AFTER_BODY",t[t.AFTER_AFTER_FRAMESET=22]="AFTER_AFTER_FRAMESET"})(q||(q={}));const XV={startLine:-1,startCol:-1,startOffset:-1,endLine:-1,endCol:-1,endOffset:-1},_R=new Set([E.TABLE,E.TBODY,E.TFOOT,E.THEAD,E.TR]),AR={scriptingEnabled:!0,sourceCodeLocationInfo:!1,treeAdapter:eo,onParseError:null};let CR=class{constructor(e,n,i=null,r=null){this.fragmentContext=i,this.scriptHandler=r,this.currentToken=null,this.stopped=!1,this.insertionMode=q.INITIAL,this.originalInsertionMode=q.INITIAL,this.headElement=null,this.formElement=null,this.currentNotInHTML=!1,this.tmplInsertionModeStack=[],this.pendingCharacterTokens=[],this.hasNonWhitespacePendingCharacterToken=!1,this.framesetOk=!0,this.skipNextNewLine=!1,this.fosterParentingEnabled=!1,this.options={...AR,...e},this.treeAdapter=this.options.treeAdapter,this.onParseError=this.options.onParseError,this.onParseError&&(this.options.sourceCodeLocationInfo=!0),this.document=n??this.treeAdapter.createDocument(),this.tokenizer=new EV(this.options,this),this.activeFormattingElements=new IV(this.treeAdapter),this.fragmentContextID=i?Tl(this.treeAdapter.getTagName(i)):E.UNKNOWN,this._setContextModes(i??this.document,this.fragmentContextID),this.openElements=new CV(this.document,this.treeAdapter,this)}static parse(e,n){const i=new this(n);return i.tokenizer.write(e,!0),i.document}static getFragmentParser(e,n){const i={...AR,...n};e??(e=i.treeAdapter.createElement(J.TEMPLATE,he.HTML,[]));const r=i.treeAdapter.createElement("documentmock",he.HTML,[]),s=new this(i,r,e);return s.fragmentContextID===E.TEMPLATE&&s.tmplInsertionModeStack.unshift(q.IN_TEMPLATE),s._initTokenizerForFragmentParsing(),s._insertFakeRootElement(),s._resetInsertionMode(),s._findFormInFragmentContext(),s}getFragment(){const e=this.treeAdapter.getFirstChild(this.document),n=this.treeAdapter.createDocumentFragment();return this._adoptNodes(e,n),n}_err(e,n,i){var r;if(!this.onParseError)return;const s=(r=e.location)!==null&&r!==void 0?r:XV,o={code:n,startLine:s.startLine,startCol:s.startCol,startOffset:s.startOffset,endLine:i?s.startLine:s.endLine,endCol:i?s.startCol:s.endCol,endOffset:i?s.startOffset:s.endOffset};this.onParseError(o)}onItemPush(e,n,i){var r,s;(s=(r=this.treeAdapter).onItemPush)===null||s===void 0||s.call(r,e),i&&this.openElements.stackTop>0&&this._setContextModes(e,n)}onItemPop(e,n){var i,r;if(this.options.sourceCodeLocationInfo&&this._setEndLocation(e,this.currentToken),(r=(i=this.treeAdapter).onItemPop)===null||r===void 0||r.call(i,e,this.openElements.current),n){let s,o;this.openElements.stackTop===0&&this.fragmentContext?(s=this.fragmentContext,o=this.fragmentContextID):{current:s,currentTagId:o}=this.openElements,this._setContextModes(s,o)}}_setContextModes(e,n){const i=e===this.document||e&&this.treeAdapter.getNamespaceURI(e)===he.HTML;this.currentNotInHTML=!i,this.tokenizer.inForeignNode=!i&&e!==void 0&&n!==void 0&&!this._isIntegrationPoint(n,e)}_switchToTextParsing(e,n){this._insertElement(e,he.HTML),this.tokenizer.state=n,this.originalInsertionMode=this.insertionMode,this.insertionMode=q.TEXT}switchToPlaintextParsing(){this.insertionMode=q.TEXT,this.originalInsertionMode=q.IN_BODY,this.tokenizer.state=Jt.PLAINTEXT}_getAdjustedCurrentElement(){return this.openElements.stackTop===0&&this.fragmentContext?this.fragmentContext:this.openElements.current}_findFormInFragmentContext(){let e=this.fragmentContext;for(;e;){if(this.treeAdapter.getTagName(e)===J.FORM){this.formElement=e;break}e=this.treeAdapter.getParentNode(e)}}_initTokenizerForFragmentParsing(){if(!(!this.fragmentContext||this.treeAdapter.getNamespaceURI(this.fragmentContext)!==he.HTML))switch(this.fragmentContextID){case E.TITLE:case E.TEXTAREA:{this.tokenizer.state=Jt.RCDATA;break}case E.STYLE:case E.XMP:case E.IFRAME:case E.NOEMBED:case E.NOFRAMES:case E.NOSCRIPT:{this.tokenizer.state=Jt.RAWTEXT;break}case E.SCRIPT:{this.tokenizer.state=Jt.SCRIPT_DATA;break}case E.PLAINTEXT:{this.tokenizer.state=Jt.PLAINTEXT;break}}}_setDocumentType(e){const n=e.name||"",i=e.publicId||"",r=e.systemId||"";if(this.treeAdapter.setDocumentType(this.document,n,i,r),e.location){const o=this.treeAdapter.getChildNodes(this.document).find(a=>this.treeAdapter.isDocumentTypeNode(a));o&&this.treeAdapter.setNodeSourceCodeLocation(o,e.location)}}_attachElementToTree(e,n){if(this.options.sourceCodeLocationInfo){const i=n&&{...n,startTag:n};this.treeAdapter.setNodeSourceCodeLocation(e,i)}if(this._shouldFosterParentOnInsertion())this._fosterParentElement(e);else{const i=this.openElements.currentTmplContentOrNode;this.treeAdapter.appendChild(i??this.document,e)}}_appendElement(e,n){const i=this.treeAdapter.createElement(e.tagName,n,e.attrs);this._attachElementToTree(i,e.location)}_insertElement(e,n){const i=this.treeAdapter.createElement(e.tagName,n,e.attrs);this._attachElementToTree(i,e.location),this.openElements.push(i,e.tagID)}_insertFakeElement(e,n){const i=this.treeAdapter.createElement(e,he.HTML,[]);this._attachElementToTree(i,null),this.openElements.push(i,n)}_insertTemplate(e){const n=this.treeAdapter.createElement(e.tagName,he.HTML,e.attrs),i=this.treeAdapter.createDocumentFragment();this.treeAdapter.setTemplateContent(n,i),this._attachElementToTree(n,e.location),this.openElements.push(n,e.tagID),this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(i,null)}_insertFakeRootElement(){const e=this.treeAdapter.createElement(J.HTML,he.HTML,[]);this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(e,null),this.treeAdapter.appendChild(this.openElements.current,e),this.openElements.push(e,E.HTML)}_appendCommentNode(e,n){const i=this.treeAdapter.createCommentNode(e.data);this.treeAdapter.appendChild(n,i),this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(i,e.location)}_insertCharacters(e){let n,i;if(this._shouldFosterParentOnInsertion()?({parent:n,beforeElement:i}=this._findFosterParentingLocation(),i?this.treeAdapter.insertTextBefore(n,e.chars,i):this.treeAdapter.insertText(n,e.chars)):(n=this.openElements.currentTmplContentOrNode,this.treeAdapter.insertText(n,e.chars)),!e.location)return;const r=this.treeAdapter.getChildNodes(n),s=i?r.lastIndexOf(i):r.length,o=r[s-1];if(this.treeAdapter.getNodeSourceCodeLocation(o)){const{endLine:l,endCol:u,endOffset:c}=e.location;this.treeAdapter.updateNodeSourceCodeLocation(o,{endLine:l,endCol:u,endOffset:c})}else this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(o,e.location)}_adoptNodes(e,n){for(let i=this.treeAdapter.getFirstChild(e);i;i=this.treeAdapter.getFirstChild(e))this.treeAdapter.detachNode(i),this.treeAdapter.appendChild(n,i)}_setEndLocation(e,n){if(this.treeAdapter.getNodeSourceCodeLocation(e)&&n.location){const i=n.location,r=this.treeAdapter.getTagName(e),s=n.type===ct.END_TAG&&r===n.tagName?{endTag:{...i},endLine:i.endLine,endCol:i.endCol,endOffset:i.endOffset}:{endLine:i.startLine,endCol:i.startCol,endOffset:i.startOffset};this.treeAdapter.updateNodeSourceCodeLocation(e,s)}}shouldProcessStartTagTokenInForeignContent(e){if(!this.currentNotInHTML)return!1;let n,i;return this.openElements.stackTop===0&&this.fragmentContext?(n=this.fragmentContext,i=this.fragmentContextID):{current:n,currentTagId:i}=this.openElements,e.tagID===E.SVG&&this.treeAdapter.getTagName(n)===J.ANNOTATION_XML&&this.treeAdapter.getNamespaceURI(n)===he.MATHML?!1:this.tokenizer.inForeignNode||(e.tagID===E.MGLYPH||e.tagID===E.MALIGNMARK)&&i!==void 0&&!this._isIntegrationPoint(i,n,he.HTML)}_processToken(e){switch(e.type){case ct.CHARACTER:{this.onCharacter(e);break}case ct.NULL_CHARACTER:{this.onNullCharacter(e);break}case ct.COMMENT:{this.onComment(e);break}case ct.DOCTYPE:{this.onDoctype(e);break}case ct.START_TAG:{this._processStartTag(e);break}case ct.END_TAG:{this.onEndTag(e);break}case ct.EOF:{this.onEof(e);break}case ct.WHITESPACE_CHARACTER:{this.onWhitespaceCharacter(e);break}}}_isIntegrationPoint(e,n,i){const r=this.treeAdapter.getNamespaceURI(n),s=this.treeAdapter.getAttrList(n);return WV(e,r,s,i)}_reconstructActiveFormattingElements(){const e=this.activeFormattingElements.entries.length;if(e){const n=this.activeFormattingElements.entries.findIndex(r=>r.type===br.Marker||this.openElements.contains(r.element)),i=n===-1?e-1:n-1;for(let r=i;r>=0;r--){const s=this.activeFormattingElements.entries[r];this._insertElement(s.token,this.treeAdapter.getNamespaceURI(s.element)),s.element=this.openElements.current}}}_closeTableCell(){this.openElements.generateImpliedEndTags(),this.openElements.popUntilTableCellPopped(),this.activeFormattingElements.clearToLastMarker(),this.insertionMode=q.IN_ROW}_closePElement(){this.openElements.generateImpliedEndTagsWithExclusion(E.P),this.openElements.popUntilTagNamePopped(E.P)}_resetInsertionMode(){for(let e=this.openElements.stackTop;e>=0;e--)switch(e===0&&this.fragmentContext?this.fragmentContextID:this.openElements.tagIDs[e]){case E.TR:{this.insertionMode=q.IN_ROW;return}case E.TBODY:case E.THEAD:case E.TFOOT:{this.insertionMode=q.IN_TABLE_BODY;return}case E.CAPTION:{this.insertionMode=q.IN_CAPTION;return}case E.COLGROUP:{this.insertionMode=q.IN_COLUMN_GROUP;return}case E.TABLE:{this.insertionMode=q.IN_TABLE;return}case E.BODY:{this.insertionMode=q.IN_BODY;return}case E.FRAMESET:{this.insertionMode=q.IN_FRAMESET;return}case E.SELECT:{this._resetInsertionModeForSelect(e);return}case E.TEMPLATE:{this.insertionMode=this.tmplInsertionModeStack[0];return}case E.HTML:{this.insertionMode=this.headElement?q.AFTER_HEAD:q.BEFORE_HEAD;return}case E.TD:case E.TH:{if(e>0){this.insertionMode=q.IN_CELL;return}break}case E.HEAD:{if(e>0){this.insertionMode=q.IN_HEAD;return}break}}this.insertionMode=q.IN_BODY}_resetInsertionModeForSelect(e){if(e>0)for(let n=e-1;n>0;n--){const i=this.openElements.tagIDs[n];if(i===E.TEMPLATE)break;if(i===E.TABLE){this.insertionMode=q.IN_SELECT_IN_TABLE;return}}this.insertionMode=q.IN_SELECT}_isElementCausesFosterParenting(e){return _R.has(e)}_shouldFosterParentOnInsertion(){return this.fosterParentingEnabled&&this.openElements.currentTagId!==void 0&&this._isElementCausesFosterParenting(this.openElements.currentTagId)}_findFosterParentingLocation(){for(let e=this.openElements.stackTop;e>=0;e--){const n=this.openElements.items[e];switch(this.openElements.tagIDs[e]){case E.TEMPLATE:{if(this.treeAdapter.getNamespaceURI(n)===he.HTML)return{parent:this.treeAdapter.getTemplateContent(n),beforeElement:null};break}case E.TABLE:{const i=this.treeAdapter.getParentNode(n);return i?{parent:i,beforeElement:n}:{parent:this.openElements.items[e-1],beforeElement:null}}}}return{parent:this.openElements.items[0],beforeElement:null}}_fosterParentElement(e){const n=this._findFosterParentingLocation();n.beforeElement?this.treeAdapter.insertBefore(n.parent,e,n.beforeElement):this.treeAdapter.appendChild(n.parent,e)}_isSpecialElement(e,n){const i=this.treeAdapter.getNamespaceURI(e);return gV[i].has(n)}onCharacter(e){if(this.skipNextNewLine=!1,this.tokenizer.inForeignNode){Aj(this,e);return}switch(this.insertionMode){case q.INITIAL:{Rc(this,e);break}case q.BEFORE_HTML:{Lc(this,e);break}case q.BEFORE_HEAD:{Pc(this,e);break}case q.IN_HEAD:{kc(this,e);break}case q.IN_HEAD_NO_SCRIPT:{Dc(this,e);break}case q.AFTER_HEAD:{Oc(this,e);break}case q.IN_BODY:case q.IN_CAPTION:case q.IN_CELL:case q.IN_TEMPLATE:{RR(this,e);break}case q.TEXT:case q.IN_SELECT:case q.IN_SELECT_IN_TABLE:{this._insertCharacters(e);break}case q.IN_TABLE:case q.IN_TABLE_BODY:case q.IN_ROW:{q1(this,e);break}case q.IN_TABLE_TEXT:{FR(this,e);break}case q.IN_COLUMN_GROUP:{Ah(this,e);break}case q.AFTER_BODY:{Rh(this,e);break}case q.AFTER_AFTER_BODY:{Lh(this,e);break}}}onNullCharacter(e){if(this.skipNextNewLine=!1,this.tokenizer.inForeignNode){_j(this,e);return}switch(this.insertionMode){case q.INITIAL:{Rc(this,e);break}case q.BEFORE_HTML:{Lc(this,e);break}case q.BEFORE_HEAD:{Pc(this,e);break}case q.IN_HEAD:{kc(this,e);break}case q.IN_HEAD_NO_SCRIPT:{Dc(this,e);break}case q.AFTER_HEAD:{Oc(this,e);break}case q.TEXT:{this._insertCharacters(e);break}case q.IN_TABLE:case q.IN_TABLE_BODY:case q.IN_ROW:{q1(this,e);break}case q.IN_COLUMN_GROUP:{Ah(this,e);break}case q.AFTER_BODY:{Rh(this,e);break}case q.AFTER_AFTER_BODY:{Lh(this,e);break}}}onComment(e){if(this.skipNextNewLine=!1,this.currentNotInHTML){j1(this,e);return}switch(this.insertionMode){case q.INITIAL:case q.BEFORE_HTML:case q.BEFORE_HEAD:case q.IN_HEAD:case q.IN_HEAD_NO_SCRIPT:case q.AFTER_HEAD:case q.IN_BODY:case q.IN_TABLE:case q.IN_CAPTION:case q.IN_COLUMN_GROUP:case q.IN_TABLE_BODY:case q.IN_ROW:case q.IN_CELL:case q.IN_SELECT:case q.IN_SELECT_IN_TABLE:case q.IN_TEMPLATE:case q.IN_FRAMESET:case q.AFTER_FRAMESET:{j1(this,e);break}case q.IN_TABLE_TEXT:{Fc(this,e);break}case q.AFTER_BODY:{iG(this,e);break}case q.AFTER_AFTER_BODY:case q.AFTER_AFTER_FRAMESET:{rG(this,e);break}}}onDoctype(e){switch(this.skipNextNewLine=!1,this.insertionMode){case q.INITIAL:{sG(this,e);break}case q.BEFORE_HEAD:case q.IN_HEAD:case q.IN_HEAD_NO_SCRIPT:case q.AFTER_HEAD:{this._err(e,se.misplacedDoctype);break}case q.IN_TABLE_TEXT:{Fc(this,e);break}}}onStartTag(e){this.skipNextNewLine=!1,this.currentToken=e,this._processStartTag(e),e.selfClosing&&!e.ackSelfClosing&&this._err(e,se.nonVoidHtmlElementStartTagWithTrailingSolidus)}_processStartTag(e){this.shouldProcessStartTagTokenInForeignContent(e)?Cj(this,e):this._startTagOutsideForeignContent(e)}_startTagOutsideForeignContent(e){switch(this.insertionMode){case q.INITIAL:{Rc(this,e);break}case q.BEFORE_HTML:{oG(this,e);break}case q.BEFORE_HEAD:{lG(this,e);break}case q.IN_HEAD:{Zi(this,e);break}case q.IN_HEAD_NO_SCRIPT:{dG(this,e);break}case q.AFTER_HEAD:{hG(this,e);break}case q.IN_BODY:{On(this,e);break}case q.IN_TABLE:{Sl(this,e);break}case q.IN_TABLE_TEXT:{Fc(this,e);break}case q.IN_CAPTION:{uj(this,e);break}case q.IN_COLUMN_GROUP:{K1(this,e);break}case q.IN_TABLE_BODY:{Ch(this,e);break}case q.IN_ROW:{Ih(this,e);break}case q.IN_CELL:{fj(this,e);break}case q.IN_SELECT:{HR(this,e);break}case q.IN_SELECT_IN_TABLE:{pj(this,e);break}case q.IN_TEMPLATE:{gj(this,e);break}case q.AFTER_BODY:{vj(this,e);break}case q.IN_FRAMESET:{bj(this,e);break}case q.AFTER_FRAMESET:{Tj(this,e);break}case q.AFTER_AFTER_BODY:{xj(this,e);break}case q.AFTER_AFTER_FRAMESET:{wj(this,e);break}}}onEndTag(e){this.skipNextNewLine=!1,this.currentToken=e,this.currentNotInHTML?Ij(this,e):this._endTagOutsideForeignContent(e)}_endTagOutsideForeignContent(e){switch(this.insertionMode){case q.INITIAL:{Rc(this,e);break}case q.BEFORE_HTML:{aG(this,e);break}case q.BEFORE_HEAD:{uG(this,e);break}case q.IN_HEAD:{cG(this,e);break}case q.IN_HEAD_NO_SCRIPT:{fG(this,e);break}case q.AFTER_HEAD:{pG(this,e);break}case q.IN_BODY:{_h(this,e);break}case q.TEXT:{JG(this,e);break}case q.IN_TABLE:{Nc(this,e);break}case q.IN_TABLE_TEXT:{Fc(this,e);break}case q.IN_CAPTION:{cj(this,e);break}case q.IN_COLUMN_GROUP:{dj(this,e);break}case q.IN_TABLE_BODY:{Y1(this,e);break}case q.IN_ROW:{UR(this,e);break}case q.IN_CELL:{hj(this,e);break}case q.IN_SELECT:{$R(this,e);break}case q.IN_SELECT_IN_TABLE:{mj(this,e);break}case q.IN_TEMPLATE:{yj(this,e);break}case q.AFTER_BODY:{VR(this,e);break}case q.IN_FRAMESET:{Ej(this,e);break}case q.AFTER_FRAMESET:{Sj(this,e);break}case q.AFTER_AFTER_BODY:{Lh(this,e);break}}}onEof(e){switch(this.insertionMode){case q.INITIAL:{Rc(this,e);break}case q.BEFORE_HTML:{Lc(this,e);break}case q.BEFORE_HEAD:{Pc(this,e);break}case q.IN_HEAD:{kc(this,e);break}case q.IN_HEAD_NO_SCRIPT:{Dc(this,e);break}case q.AFTER_HEAD:{Oc(this,e);break}case q.IN_BODY:case q.IN_TABLE:case q.IN_CAPTION:case q.IN_COLUMN_GROUP:case q.IN_TABLE_BODY:case q.IN_ROW:case q.IN_CELL:case q.IN_SELECT:case q.IN_SELECT_IN_TABLE:{NR(this,e);break}case q.TEXT:{ej(this,e);break}case q.IN_TABLE_TEXT:{Fc(this,e);break}case q.IN_TEMPLATE:{zR(this,e);break}case q.AFTER_BODY:case q.IN_FRAMESET:case q.AFTER_FRAMESET:case q.AFTER_AFTER_BODY:case q.AFTER_AFTER_FRAMESET:{W1(this,e);break}}}onWhitespaceCharacter(e){if(this.skipNextNewLine&&(this.skipNextNewLine=!1,e.chars.charCodeAt(0)===$.LINE_FEED)){if(e.chars.length===1)return;e.chars=e.chars.substr(1)}if(this.tokenizer.inForeignNode){this._insertCharacters(e);return}switch(this.insertionMode){case q.IN_HEAD:case q.IN_HEAD_NO_SCRIPT:case q.AFTER_HEAD:case q.TEXT:case q.IN_COLUMN_GROUP:case q.IN_SELECT:case q.IN_SELECT_IN_TABLE:case q.IN_FRAMESET:case q.AFTER_FRAMESET:{this._insertCharacters(e);break}case q.IN_BODY:case q.IN_CAPTION:case q.IN_CELL:case q.IN_TEMPLATE:case q.AFTER_BODY:case q.AFTER_AFTER_BODY:case q.AFTER_AFTER_FRAMESET:{IR(this,e);break}case q.IN_TABLE:case q.IN_TABLE_BODY:case q.IN_ROW:{q1(this,e);break}case q.IN_TABLE_TEXT:{MR(this,e);break}}}};function QV(t,e){let n=t.activeFormattingElements.getElementEntryInScopeWithTagName(e.tagName);return n?t.openElements.contains(n.element)?t.openElements.hasInScope(e.tagID)||(n=null):(t.activeFormattingElements.removeEntry(n),n=null):OR(t,e),n}function ZV(t,e){let n=null,i=t.openElements.stackTop;for(;i>=0;i--){const r=t.openElements.items[i];if(r===e.element)break;t._isSpecialElement(r,t.openElements.tagIDs[i])&&(n=r)}return n||(t.openElements.shortenToLength(Math.max(i,0)),t.activeFormattingElements.removeEntry(e)),n}function JV(t,e,n){let i=e,r=t.openElements.getCommonAncestor(e);for(let s=0,o=r;o!==n;s++,o=r){r=t.openElements.getCommonAncestor(o);const a=t.activeFormattingElements.getElementEntry(o),l=a&&s>=YV;!a||l?(l&&t.activeFormattingElements.removeEntry(a),t.openElements.remove(o)):(o=eG(t,a),i===e&&(t.activeFormattingElements.bookmark=a),t.treeAdapter.detachNode(i),t.treeAdapter.appendChild(o,i),i=o)}return i}function eG(t,e){const n=t.treeAdapter.getNamespaceURI(e.element),i=t.treeAdapter.createElement(e.token.tagName,n,e.token.attrs);return t.openElements.replace(e.element,i),e.element=i,i}function tG(t,e,n){const i=t.treeAdapter.getTagName(e),r=Tl(i);if(t._isElementCausesFosterParenting(r))t._fosterParentElement(n);else{const s=t.treeAdapter.getNamespaceURI(e);r===E.TEMPLATE&&s===he.HTML&&(e=t.treeAdapter.getTemplateContent(e)),t.treeAdapter.appendChild(e,n)}}function nG(t,e,n){const i=t.treeAdapter.getNamespaceURI(n.element),{token:r}=n,s=t.treeAdapter.createElement(r.tagName,i,r.attrs);t._adoptNodes(e,s),t.treeAdapter.appendChild(e,s),t.activeFormattingElements.insertElementAfterBookmark(s,r),t.activeFormattingElements.removeEntry(n),t.openElements.remove(n.element),t.openElements.insertAfter(e,s,r.tagID)}function G1(t,e){for(let n=0;n<KV;n++){const i=QV(t,e);if(!i)break;const r=ZV(t,i);if(!r)break;t.activeFormattingElements.bookmark=i;const s=JV(t,r,i.element),o=t.openElements.getCommonAncestor(i.element);t.treeAdapter.detachNode(s),o&&tG(t,o,s),nG(t,r,i)}}function j1(t,e){t._appendCommentNode(e,t.openElements.currentTmplContentOrNode)}function iG(t,e){t._appendCommentNode(e,t.openElements.items[0])}function rG(t,e){t._appendCommentNode(e,t.document)}function W1(t,e){if(t.stopped=!0,e.location){const n=t.fragmentContext?0:2;for(let i=t.openElements.stackTop;i>=n;i--)t._setEndLocation(t.openElements.items[i],e);if(!t.fragmentContext&&t.openElements.stackTop>=0){const i=t.openElements.items[0],r=t.treeAdapter.getNodeSourceCodeLocation(i);if(r&&!r.endTag&&(t._setEndLocation(i,e),t.openElements.stackTop>=1)){const s=t.openElements.items[1],o=t.treeAdapter.getNodeSourceCodeLocation(s);o&&!o.endTag&&t._setEndLocation(s,e)}}}}function sG(t,e){t._setDocumentType(e);const n=e.forceQuirks?Bi.QUIRKS:NV(e);OV(e)||t._err(e,se.nonConformingDoctype),t.treeAdapter.setDocumentMode(t.document,n),t.insertionMode=q.BEFORE_HTML}function Rc(t,e){t._err(e,se.missingDoctype,!0),t.treeAdapter.setDocumentMode(t.document,Bi.QUIRKS),t.insertionMode=q.BEFORE_HTML,t._processToken(e)}function oG(t,e){e.tagID===E.HTML?(t._insertElement(e,he.HTML),t.insertionMode=q.BEFORE_HEAD):Lc(t,e)}function aG(t,e){const n=e.tagID;(n===E.HTML||n===E.HEAD||n===E.BODY||n===E.BR)&&Lc(t,e)}function Lc(t,e){t._insertFakeRootElement(),t.insertionMode=q.BEFORE_HEAD,t._processToken(e)}function lG(t,e){switch(e.tagID){case E.HTML:{On(t,e);break}case E.HEAD:{t._insertElement(e,he.HTML),t.headElement=t.openElements.current,t.insertionMode=q.IN_HEAD;break}default:Pc(t,e)}}function uG(t,e){const n=e.tagID;n===E.HEAD||n===E.BODY||n===E.HTML||n===E.BR?Pc(t,e):t._err(e,se.endTagWithoutMatchingOpenElement)}function Pc(t,e){t._insertFakeElement(J.HEAD,E.HEAD),t.headElement=t.openElements.current,t.insertionMode=q.IN_HEAD,t._processToken(e)}function Zi(t,e){switch(e.tagID){case E.HTML:{On(t,e);break}case E.BASE:case E.BASEFONT:case E.BGSOUND:case E.LINK:case E.META:{t._appendElement(e,he.HTML),e.ackSelfClosing=!0;break}case E.TITLE:{t._switchToTextParsing(e,Jt.RCDATA);break}case E.NOSCRIPT:{t.options.scriptingEnabled?t._switchToTextParsing(e,Jt.RAWTEXT):(t._insertElement(e,he.HTML),t.insertionMode=q.IN_HEAD_NO_SCRIPT);break}case E.NOFRAMES:case E.STYLE:{t._switchToTextParsing(e,Jt.RAWTEXT);break}case E.SCRIPT:{t._switchToTextParsing(e,Jt.SCRIPT_DATA);break}case E.TEMPLATE:{t._insertTemplate(e),t.activeFormattingElements.insertMarker(),t.framesetOk=!1,t.insertionMode=q.IN_TEMPLATE,t.tmplInsertionModeStack.unshift(q.IN_TEMPLATE);break}case E.HEAD:{t._err(e,se.misplacedStartTagForHeadElement);break}default:kc(t,e)}}function cG(t,e){switch(e.tagID){case E.HEAD:{t.openElements.pop(),t.insertionMode=q.AFTER_HEAD;break}case E.BODY:case E.BR:case E.HTML:{kc(t,e);break}case E.TEMPLATE:{Jo(t,e);break}default:t._err(e,se.endTagWithoutMatchingOpenElement)}}function Jo(t,e){t.openElements.tmplCount>0?(t.openElements.generateImpliedEndTagsThoroughly(),t.openElements.currentTagId!==E.TEMPLATE&&t._err(e,se.closingOfElementWithOpenChildElements),t.openElements.popUntilTagNamePopped(E.TEMPLATE),t.activeFormattingElements.clearToLastMarker(),t.tmplInsertionModeStack.shift(),t._resetInsertionMode()):t._err(e,se.endTagWithoutMatchingOpenElement)}function kc(t,e){t.openElements.pop(),t.insertionMode=q.AFTER_HEAD,t._processToken(e)}function dG(t,e){switch(e.tagID){case E.HTML:{On(t,e);break}case E.BASEFONT:case E.BGSOUND:case E.HEAD:case E.LINK:case E.META:case E.NOFRAMES:case E.STYLE:{Zi(t,e);break}case E.NOSCRIPT:{t._err(e,se.nestedNoscriptInHead);break}default:Dc(t,e)}}function fG(t,e){switch(e.tagID){case E.NOSCRIPT:{t.openElements.pop(),t.insertionMode=q.IN_HEAD;break}case E.BR:{Dc(t,e);break}default:t._err(e,se.endTagWithoutMatchingOpenElement)}}function Dc(t,e){const n=e.type===ct.EOF?se.openElementsLeftAfterEof:se.disallowedContentInNoscriptInHead;t._err(e,n),t.openElements.pop(),t.insertionMode=q.IN_HEAD,t._processToken(e)}function hG(t,e){switch(e.tagID){case E.HTML:{On(t,e);break}case E.BODY:{t._insertElement(e,he.HTML),t.framesetOk=!1,t.insertionMode=q.IN_BODY;break}case E.FRAMESET:{t._insertElement(e,he.HTML),t.insertionMode=q.IN_FRAMESET;break}case E.BASE:case E.BASEFONT:case E.BGSOUND:case E.LINK:case E.META:case E.NOFRAMES:case E.SCRIPT:case E.STYLE:case E.TEMPLATE:case E.TITLE:{t._err(e,se.abandonedHeadElementChild),t.openElements.push(t.headElement,E.HEAD),Zi(t,e),t.openElements.remove(t.headElement);break}case E.HEAD:{t._err(e,se.misplacedStartTagForHeadElement);break}default:Oc(t,e)}}function pG(t,e){switch(e.tagID){case E.BODY:case E.HTML:case E.BR:{Oc(t,e);break}case E.TEMPLATE:{Jo(t,e);break}default:t._err(e,se.endTagWithoutMatchingOpenElement)}}function Oc(t,e){t._insertFakeElement(J.BODY,E.BODY),t.insertionMode=q.IN_BODY,wh(t,e)}function wh(t,e){switch(e.type){case ct.CHARACTER:{RR(t,e);break}case ct.WHITESPACE_CHARACTER:{IR(t,e);break}case ct.COMMENT:{j1(t,e);break}case ct.START_TAG:{On(t,e);break}case ct.END_TAG:{_h(t,e);break}case ct.EOF:{NR(t,e);break}}}function IR(t,e){t._reconstructActiveFormattingElements(),t._insertCharacters(e)}function RR(t,e){t._reconstructActiveFormattingElements(),t._insertCharacters(e),t.framesetOk=!1}function mG(t,e){t.openElements.tmplCount===0&&t.treeAdapter.adoptAttributes(t.openElements.items[0],e.attrs)}function gG(t,e){const n=t.openElements.tryPeekProperlyNestedBodyElement();n&&t.openElements.tmplCount===0&&(t.framesetOk=!1,t.treeAdapter.adoptAttributes(n,e.attrs))}function yG(t,e){const n=t.openElements.tryPeekProperlyNestedBodyElement();t.framesetOk&&n&&(t.treeAdapter.detachNode(n),t.openElements.popAllUpToHtmlElement(),t._insertElement(e,he.HTML),t.insertionMode=q.IN_FRAMESET)}function vG(t,e){t.openElements.hasInButtonScope(E.P)&&t._closePElement(),t._insertElement(e,he.HTML)}function bG(t,e){t.openElements.hasInButtonScope(E.P)&&t._closePElement(),t.openElements.currentTagId!==void 0&&$1.has(t.openElements.currentTagId)&&t.openElements.pop(),t._insertElement(e,he.HTML)}function EG(t,e){t.openElements.hasInButtonScope(E.P)&&t._closePElement(),t._insertElement(e,he.HTML),t.skipNextNewLine=!0,t.framesetOk=!1}function TG(t,e){const n=t.openElements.tmplCount>0;(!t.formElement||n)&&(t.openElements.hasInButtonScope(E.P)&&t._closePElement(),t._insertElement(e,he.HTML),n||(t.formElement=t.openElements.current))}function SG(t,e){t.framesetOk=!1;const n=e.tagID;for(let i=t.openElements.stackTop;i>=0;i--){const r=t.openElements.tagIDs[i];if(n===E.LI&&r===E.LI||(n===E.DD||n===E.DT)&&(r===E.DD||r===E.DT)){t.openElements.generateImpliedEndTagsWithExclusion(r),t.openElements.popUntilTagNamePopped(r);break}if(r!==E.ADDRESS&&r!==E.DIV&&r!==E.P&&t._isSpecialElement(t.openElements.items[i],r))break}t.openElements.hasInButtonScope(E.P)&&t._closePElement(),t._insertElement(e,he.HTML)}function xG(t,e){t.openElements.hasInButtonScope(E.P)&&t._closePElement(),t._insertElement(e,he.HTML),t.tokenizer.state=Jt.PLAINTEXT}function wG(t,e){t.openElements.hasInScope(E.BUTTON)&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilTagNamePopped(E.BUTTON)),t._reconstructActiveFormattingElements(),t._insertElement(e,he.HTML),t.framesetOk=!1}function _G(t,e){const n=t.activeFormattingElements.getElementEntryInScopeWithTagName(J.A);n&&(G1(t,e),t.openElements.remove(n.element),t.activeFormattingElements.removeEntry(n)),t._reconstructActiveFormattingElements(),t._insertElement(e,he.HTML),t.activeFormattingElements.pushElement(t.openElements.current,e)}function AG(t,e){t._reconstructActiveFormattingElements(),t._insertElement(e,he.HTML),t.activeFormattingElements.pushElement(t.openElements.current,e)}function CG(t,e){t._reconstructActiveFormattingElements(),t.openElements.hasInScope(E.NOBR)&&(G1(t,e),t._reconstructActiveFormattingElements()),t._insertElement(e,he.HTML),t.activeFormattingElements.pushElement(t.openElements.current,e)}function IG(t,e){t._reconstructActiveFormattingElements(),t._insertElement(e,he.HTML),t.activeFormattingElements.insertMarker(),t.framesetOk=!1}function RG(t,e){t.treeAdapter.getDocumentMode(t.document)!==Bi.QUIRKS&&t.openElements.hasInButtonScope(E.P)&&t._closePElement(),t._insertElement(e,he.HTML),t.framesetOk=!1,t.insertionMode=q.IN_TABLE}function LR(t,e){t._reconstructActiveFormattingElements(),t._appendElement(e,he.HTML),t.framesetOk=!1,e.ackSelfClosing=!0}function PR(t){const e=uR(t,Zo.TYPE);return e!=null&&e.toLowerCase()===qV}function LG(t,e){t._reconstructActiveFormattingElements(),t._appendElement(e,he.HTML),PR(e)||(t.framesetOk=!1),e.ackSelfClosing=!0}function PG(t,e){t._appendElement(e,he.HTML),e.ackSelfClosing=!0}function kG(t,e){t.openElements.hasInButtonScope(E.P)&&t._closePElement(),t._appendElement(e,he.HTML),t.framesetOk=!1,e.ackSelfClosing=!0}function DG(t,e){e.tagName=J.IMG,e.tagID=E.IMG,LR(t,e)}function OG(t,e){t._insertElement(e,he.HTML),t.skipNextNewLine=!0,t.tokenizer.state=Jt.RCDATA,t.originalInsertionMode=t.insertionMode,t.framesetOk=!1,t.insertionMode=q.TEXT}function NG(t,e){t.openElements.hasInButtonScope(E.P)&&t._closePElement(),t._reconstructActiveFormattingElements(),t.framesetOk=!1,t._switchToTextParsing(e,Jt.RAWTEXT)}function MG(t,e){t.framesetOk=!1,t._switchToTextParsing(e,Jt.RAWTEXT)}function kR(t,e){t._switchToTextParsing(e,Jt.RAWTEXT)}function FG(t,e){t._reconstructActiveFormattingElements(),t._insertElement(e,he.HTML),t.framesetOk=!1,t.insertionMode=t.insertionMode===q.IN_TABLE||t.insertionMode===q.IN_CAPTION||t.insertionMode===q.IN_TABLE_BODY||t.insertionMode===q.IN_ROW||t.insertionMode===q.IN_CELL?q.IN_SELECT_IN_TABLE:q.IN_SELECT}function BG(t,e){t.openElements.currentTagId===E.OPTION&&t.openElements.pop(),t._reconstructActiveFormattingElements(),t._insertElement(e,he.HTML)}function UG(t,e){t.openElements.hasInScope(E.RUBY)&&t.openElements.generateImpliedEndTags(),t._insertElement(e,he.HTML)}function HG(t,e){t.openElements.hasInScope(E.RUBY)&&t.openElements.generateImpliedEndTagsWithExclusion(E.RTC),t._insertElement(e,he.HTML)}function $G(t,e){t._reconstructActiveFormattingElements(),xR(e),V1(e),e.selfClosing?t._appendElement(e,he.MATHML):t._insertElement(e,he.MATHML),e.ackSelfClosing=!0}function zG(t,e){t._reconstructActiveFormattingElements(),wR(e),V1(e),e.selfClosing?t._appendElement(e,he.SVG):t._insertElement(e,he.SVG),e.ackSelfClosing=!0}function DR(t,e){t._reconstructActiveFormattingElements(),t._insertElement(e,he.HTML)}function On(t,e){switch(e.tagID){case E.I:case E.S:case E.B:case E.U:case E.EM:case E.TT:case E.BIG:case E.CODE:case E.FONT:case E.SMALL:case E.STRIKE:case E.STRONG:{AG(t,e);break}case E.A:{_G(t,e);break}case E.H1:case E.H2:case E.H3:case E.H4:case E.H5:case E.H6:{bG(t,e);break}case E.P:case E.DL:case E.OL:case E.UL:case E.DIV:case E.DIR:case E.NAV:case E.MAIN:case E.MENU:case E.ASIDE:case E.CENTER:case E.FIGURE:case E.FOOTER:case E.HEADER:case E.HGROUP:case E.DIALOG:case E.DETAILS:case E.ADDRESS:case E.ARTICLE:case E.SEARCH:case E.SECTION:case E.SUMMARY:case E.FIELDSET:case E.BLOCKQUOTE:case E.FIGCAPTION:{vG(t,e);break}case E.LI:case E.DD:case E.DT:{SG(t,e);break}case E.BR:case E.IMG:case E.WBR:case E.AREA:case E.EMBED:case E.KEYGEN:{LR(t,e);break}case E.HR:{kG(t,e);break}case E.RB:case E.RTC:{UG(t,e);break}case E.RT:case E.RP:{HG(t,e);break}case E.PRE:case E.LISTING:{EG(t,e);break}case E.XMP:{NG(t,e);break}case E.SVG:{zG(t,e);break}case E.HTML:{mG(t,e);break}case E.BASE:case E.LINK:case E.META:case E.STYLE:case E.TITLE:case E.SCRIPT:case E.BGSOUND:case E.BASEFONT:case E.TEMPLATE:{Zi(t,e);break}case E.BODY:{gG(t,e);break}case E.FORM:{TG(t,e);break}case E.NOBR:{CG(t,e);break}case E.MATH:{$G(t,e);break}case E.TABLE:{RG(t,e);break}case E.INPUT:{LG(t,e);break}case E.PARAM:case E.TRACK:case E.SOURCE:{PG(t,e);break}case E.IMAGE:{DG(t,e);break}case E.BUTTON:{wG(t,e);break}case E.APPLET:case E.OBJECT:case E.MARQUEE:{IG(t,e);break}case E.IFRAME:{MG(t,e);break}case E.SELECT:{FG(t,e);break}case E.OPTION:case E.OPTGROUP:{BG(t,e);break}case E.NOEMBED:case E.NOFRAMES:{kR(t,e);break}case E.FRAMESET:{yG(t,e);break}case E.TEXTAREA:{OG(t,e);break}case E.NOSCRIPT:{t.options.scriptingEnabled?kR(t,e):DR(t,e);break}case E.PLAINTEXT:{xG(t,e);break}case E.COL:case E.TH:case E.TD:case E.TR:case E.HEAD:case E.FRAME:case E.TBODY:case E.TFOOT:case E.THEAD:case E.CAPTION:case E.COLGROUP:break;default:DR(t,e)}}function VG(t,e){if(t.openElements.hasInScope(E.BODY)&&(t.insertionMode=q.AFTER_BODY,t.options.sourceCodeLocationInfo)){const n=t.openElements.tryPeekProperlyNestedBodyElement();n&&t._setEndLocation(n,e)}}function GG(t,e){t.openElements.hasInScope(E.BODY)&&(t.insertionMode=q.AFTER_BODY,VR(t,e))}function jG(t,e){const n=e.tagID;t.openElements.hasInScope(n)&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilTagNamePopped(n))}function WG(t){const e=t.openElements.tmplCount>0,{formElement:n}=t;e||(t.formElement=null),(n||e)&&t.openElements.hasInScope(E.FORM)&&(t.openElements.generateImpliedEndTags(),e?t.openElements.popUntilTagNamePopped(E.FORM):n&&t.openElements.remove(n))}function qG(t){t.openElements.hasInButtonScope(E.P)||t._insertFakeElement(J.P,E.P),t._closePElement()}function KG(t){t.openElements.hasInListItemScope(E.LI)&&(t.openElements.generateImpliedEndTagsWithExclusion(E.LI),t.openElements.popUntilTagNamePopped(E.LI))}function YG(t,e){const n=e.tagID;t.openElements.hasInScope(n)&&(t.openElements.generateImpliedEndTagsWithExclusion(n),t.openElements.popUntilTagNamePopped(n))}function XG(t){t.openElements.hasNumberedHeaderInScope()&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilNumberedHeaderPopped())}function QG(t,e){const n=e.tagID;t.openElements.hasInScope(n)&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilTagNamePopped(n),t.activeFormattingElements.clearToLastMarker())}function ZG(t){t._reconstructActiveFormattingElements(),t._insertFakeElement(J.BR,E.BR),t.openElements.pop(),t.framesetOk=!1}function OR(t,e){const n=e.tagName,i=e.tagID;for(let r=t.openElements.stackTop;r>0;r--){const s=t.openElements.items[r],o=t.openElements.tagIDs[r];if(i===o&&(i!==E.UNKNOWN||t.treeAdapter.getTagName(s)===n)){t.openElements.generateImpliedEndTagsWithExclusion(i),t.openElements.stackTop>=r&&t.openElements.shortenToLength(r);break}if(t._isSpecialElement(s,o))break}}function _h(t,e){switch(e.tagID){case E.A:case E.B:case E.I:case E.S:case E.U:case E.EM:case E.TT:case E.BIG:case E.CODE:case E.FONT:case E.NOBR:case E.SMALL:case E.STRIKE:case E.STRONG:{G1(t,e);break}case E.P:{qG(t);break}case E.DL:case E.UL:case E.OL:case E.DIR:case E.DIV:case E.NAV:case E.PRE:case E.MAIN:case E.MENU:case E.ASIDE:case E.BUTTON:case E.CENTER:case E.FIGURE:case E.FOOTER:case E.HEADER:case E.HGROUP:case E.DIALOG:case E.ADDRESS:case E.ARTICLE:case E.DETAILS:case E.SEARCH:case E.SECTION:case E.SUMMARY:case E.LISTING:case E.FIELDSET:case E.BLOCKQUOTE:case E.FIGCAPTION:{jG(t,e);break}case E.LI:{KG(t);break}case E.DD:case E.DT:{YG(t,e);break}case E.H1:case E.H2:case E.H3:case E.H4:case E.H5:case E.H6:{XG(t);break}case E.BR:{ZG(t);break}case E.BODY:{VG(t,e);break}case E.HTML:{GG(t,e);break}case E.FORM:{WG(t);break}case E.APPLET:case E.OBJECT:case E.MARQUEE:{QG(t,e);break}case E.TEMPLATE:{Jo(t,e);break}default:OR(t,e)}}function NR(t,e){t.tmplInsertionModeStack.length>0?zR(t,e):W1(t,e)}function JG(t,e){var n;e.tagID===E.SCRIPT&&((n=t.scriptHandler)===null||n===void 0||n.call(t,t.openElements.current)),t.openElements.pop(),t.insertionMode=t.originalInsertionMode}function ej(t,e){t._err(e,se.eofInElementThatCanContainOnlyText),t.openElements.pop(),t.insertionMode=t.originalInsertionMode,t.onEof(e)}function q1(t,e){if(t.openElements.currentTagId!==void 0&&_R.has(t.openElements.currentTagId))switch(t.pendingCharacterTokens.length=0,t.hasNonWhitespacePendingCharacterToken=!1,t.originalInsertionMode=t.insertionMode,t.insertionMode=q.IN_TABLE_TEXT,e.type){case ct.CHARACTER:{FR(t,e);break}case ct.WHITESPACE_CHARACTER:{MR(t,e);break}}else Mc(t,e)}function tj(t,e){t.openElements.clearBackToTableContext(),t.activeFormattingElements.insertMarker(),t._insertElement(e,he.HTML),t.insertionMode=q.IN_CAPTION}function nj(t,e){t.openElements.clearBackToTableContext(),t._insertElement(e,he.HTML),t.insertionMode=q.IN_COLUMN_GROUP}function ij(t,e){t.openElements.clearBackToTableContext(),t._insertFakeElement(J.COLGROUP,E.COLGROUP),t.insertionMode=q.IN_COLUMN_GROUP,K1(t,e)}function rj(t,e){t.openElements.clearBackToTableContext(),t._insertElement(e,he.HTML),t.insertionMode=q.IN_TABLE_BODY}function sj(t,e){t.openElements.clearBackToTableContext(),t._insertFakeElement(J.TBODY,E.TBODY),t.insertionMode=q.IN_TABLE_BODY,Ch(t,e)}function oj(t,e){t.openElements.hasInTableScope(E.TABLE)&&(t.openElements.popUntilTagNamePopped(E.TABLE),t._resetInsertionMode(),t._processStartTag(e))}function aj(t,e){PR(e)?t._appendElement(e,he.HTML):Mc(t,e),e.ackSelfClosing=!0}function lj(t,e){!t.formElement&&t.openElements.tmplCount===0&&(t._insertElement(e,he.HTML),t.formElement=t.openElements.current,t.openElements.pop())}function Sl(t,e){switch(e.tagID){case E.TD:case E.TH:case E.TR:{sj(t,e);break}case E.STYLE:case E.SCRIPT:case E.TEMPLATE:{Zi(t,e);break}case E.COL:{ij(t,e);break}case E.FORM:{lj(t,e);break}case E.TABLE:{oj(t,e);break}case E.TBODY:case E.TFOOT:case E.THEAD:{rj(t,e);break}case E.INPUT:{aj(t,e);break}case E.CAPTION:{tj(t,e);break}case E.COLGROUP:{nj(t,e);break}default:Mc(t,e)}}function Nc(t,e){switch(e.tagID){case E.TABLE:{t.openElements.hasInTableScope(E.TABLE)&&(t.openElements.popUntilTagNamePopped(E.TABLE),t._resetInsertionMode());break}case E.TEMPLATE:{Jo(t,e);break}case E.BODY:case E.CAPTION:case E.COL:case E.COLGROUP:case E.HTML:case E.TBODY:case E.TD:case E.TFOOT:case E.TH:case E.THEAD:case E.TR:break;default:Mc(t,e)}}function Mc(t,e){const n=t.fosterParentingEnabled;t.fosterParentingEnabled=!0,wh(t,e),t.fosterParentingEnabled=n}function MR(t,e){t.pendingCharacterTokens.push(e)}function FR(t,e){t.pendingCharacterTokens.push(e),t.hasNonWhitespacePendingCharacterToken=!0}function Fc(t,e){let n=0;if(t.hasNonWhitespacePendingCharacterToken)for(;n<t.pendingCharacterTokens.length;n++)Mc(t,t.pendingCharacterTokens[n]);else for(;n<t.pendingCharacterTokens.length;n++)t._insertCharacters(t.pendingCharacterTokens[n]);t.insertionMode=t.originalInsertionMode,t._processToken(e)}const BR=new Set([E.CAPTION,E.COL,E.COLGROUP,E.TBODY,E.TD,E.TFOOT,E.TH,E.THEAD,E.TR]);function uj(t,e){const n=e.tagID;BR.has(n)?t.openElements.hasInTableScope(E.CAPTION)&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilTagNamePopped(E.CAPTION),t.activeFormattingElements.clearToLastMarker(),t.insertionMode=q.IN_TABLE,Sl(t,e)):On(t,e)}function cj(t,e){const n=e.tagID;switch(n){case E.CAPTION:case E.TABLE:{t.openElements.hasInTableScope(E.CAPTION)&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilTagNamePopped(E.CAPTION),t.activeFormattingElements.clearToLastMarker(),t.insertionMode=q.IN_TABLE,n===E.TABLE&&Nc(t,e));break}case E.BODY:case E.COL:case E.COLGROUP:case E.HTML:case E.TBODY:case E.TD:case E.TFOOT:case E.TH:case E.THEAD:case E.TR:break;default:_h(t,e)}}function K1(t,e){switch(e.tagID){case E.HTML:{On(t,e);break}case E.COL:{t._appendElement(e,he.HTML),e.ackSelfClosing=!0;break}case E.TEMPLATE:{Zi(t,e);break}default:Ah(t,e)}}function dj(t,e){switch(e.tagID){case E.COLGROUP:{t.openElements.currentTagId===E.COLGROUP&&(t.openElements.pop(),t.insertionMode=q.IN_TABLE);break}case E.TEMPLATE:{Jo(t,e);break}case E.COL:break;default:Ah(t,e)}}function Ah(t,e){t.openElements.currentTagId===E.COLGROUP&&(t.openElements.pop(),t.insertionMode=q.IN_TABLE,t._processToken(e))}function Ch(t,e){switch(e.tagID){case E.TR:{t.openElements.clearBackToTableBodyContext(),t._insertElement(e,he.HTML),t.insertionMode=q.IN_ROW;break}case E.TH:case E.TD:{t.openElements.clearBackToTableBodyContext(),t._insertFakeElement(J.TR,E.TR),t.insertionMode=q.IN_ROW,Ih(t,e);break}case E.CAPTION:case E.COL:case E.COLGROUP:case E.TBODY:case E.TFOOT:case E.THEAD:{t.openElements.hasTableBodyContextInTableScope()&&(t.openElements.clearBackToTableBodyContext(),t.openElements.pop(),t.insertionMode=q.IN_TABLE,Sl(t,e));break}default:Sl(t,e)}}function Y1(t,e){const n=e.tagID;switch(e.tagID){case E.TBODY:case E.TFOOT:case E.THEAD:{t.openElements.hasInTableScope(n)&&(t.openElements.clearBackToTableBodyContext(),t.openElements.pop(),t.insertionMode=q.IN_TABLE);break}case E.TABLE:{t.openElements.hasTableBodyContextInTableScope()&&(t.openElements.clearBackToTableBodyContext(),t.openElements.pop(),t.insertionMode=q.IN_TABLE,Nc(t,e));break}case E.BODY:case E.CAPTION:case E.COL:case E.COLGROUP:case E.HTML:case E.TD:case E.TH:case E.TR:break;default:Nc(t,e)}}function Ih(t,e){switch(e.tagID){case E.TH:case E.TD:{t.openElements.clearBackToTableRowContext(),t._insertElement(e,he.HTML),t.insertionMode=q.IN_CELL,t.activeFormattingElements.insertMarker();break}case E.CAPTION:case E.COL:case E.COLGROUP:case E.TBODY:case E.TFOOT:case E.THEAD:case E.TR:{t.openElements.hasInTableScope(E.TR)&&(t.openElements.clearBackToTableRowContext(),t.openElements.pop(),t.insertionMode=q.IN_TABLE_BODY,Ch(t,e));break}default:Sl(t,e)}}function UR(t,e){switch(e.tagID){case E.TR:{t.openElements.hasInTableScope(E.TR)&&(t.openElements.clearBackToTableRowContext(),t.openElements.pop(),t.insertionMode=q.IN_TABLE_BODY);break}case E.TABLE:{t.openElements.hasInTableScope(E.TR)&&(t.openElements.clearBackToTableRowContext(),t.openElements.pop(),t.insertionMode=q.IN_TABLE_BODY,Y1(t,e));break}case E.TBODY:case E.TFOOT:case E.THEAD:{(t.openElements.hasInTableScope(e.tagID)||t.openElements.hasInTableScope(E.TR))&&(t.openElements.clearBackToTableRowContext(),t.openElements.pop(),t.insertionMode=q.IN_TABLE_BODY,Y1(t,e));break}case E.BODY:case E.CAPTION:case E.COL:case E.COLGROUP:case E.HTML:case E.TD:case E.TH:break;default:Nc(t,e)}}function fj(t,e){const n=e.tagID;BR.has(n)?(t.openElements.hasInTableScope(E.TD)||t.openElements.hasInTableScope(E.TH))&&(t._closeTableCell(),Ih(t,e)):On(t,e)}function hj(t,e){const n=e.tagID;switch(n){case E.TD:case E.TH:{t.openElements.hasInTableScope(n)&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilTagNamePopped(n),t.activeFormattingElements.clearToLastMarker(),t.insertionMode=q.IN_ROW);break}case E.TABLE:case E.TBODY:case E.TFOOT:case E.THEAD:case E.TR:{t.openElements.hasInTableScope(n)&&(t._closeTableCell(),UR(t,e));break}case E.BODY:case E.CAPTION:case E.COL:case E.COLGROUP:case E.HTML:break;default:_h(t,e)}}function HR(t,e){switch(e.tagID){case E.HTML:{On(t,e);break}case E.OPTION:{t.openElements.currentTagId===E.OPTION&&t.openElements.pop(),t._insertElement(e,he.HTML);break}case E.OPTGROUP:{t.openElements.currentTagId===E.OPTION&&t.openElements.pop(),t.openElements.currentTagId===E.OPTGROUP&&t.openElements.pop(),t._insertElement(e,he.HTML);break}case E.HR:{t.openElements.currentTagId===E.OPTION&&t.openElements.pop(),t.openElements.currentTagId===E.OPTGROUP&&t.openElements.pop(),t._appendElement(e,he.HTML),e.ackSelfClosing=!0;break}case E.INPUT:case E.KEYGEN:case E.TEXTAREA:case E.SELECT:{t.openElements.hasInSelectScope(E.SELECT)&&(t.openElements.popUntilTagNamePopped(E.SELECT),t._resetInsertionMode(),e.tagID!==E.SELECT&&t._processStartTag(e));break}case E.SCRIPT:case E.TEMPLATE:{Zi(t,e);break}}}function $R(t,e){switch(e.tagID){case E.OPTGROUP:{t.openElements.stackTop>0&&t.openElements.currentTagId===E.OPTION&&t.openElements.tagIDs[t.openElements.stackTop-1]===E.OPTGROUP&&t.openElements.pop(),t.openElements.currentTagId===E.OPTGROUP&&t.openElements.pop();break}case E.OPTION:{t.openElements.currentTagId===E.OPTION&&t.openElements.pop();break}case E.SELECT:{t.openElements.hasInSelectScope(E.SELECT)&&(t.openElements.popUntilTagNamePopped(E.SELECT),t._resetInsertionMode());break}case E.TEMPLATE:{Jo(t,e);break}}}function pj(t,e){const n=e.tagID;n===E.CAPTION||n===E.TABLE||n===E.TBODY||n===E.TFOOT||n===E.THEAD||n===E.TR||n===E.TD||n===E.TH?(t.openElements.popUntilTagNamePopped(E.SELECT),t._resetInsertionMode(),t._processStartTag(e)):HR(t,e)}function mj(t,e){const n=e.tagID;n===E.CAPTION||n===E.TABLE||n===E.TBODY||n===E.TFOOT||n===E.THEAD||n===E.TR||n===E.TD||n===E.TH?t.openElements.hasInTableScope(n)&&(t.openElements.popUntilTagNamePopped(E.SELECT),t._resetInsertionMode(),t.onEndTag(e)):$R(t,e)}function gj(t,e){switch(e.tagID){case E.BASE:case E.BASEFONT:case E.BGSOUND:case E.LINK:case E.META:case E.NOFRAMES:case E.SCRIPT:case E.STYLE:case E.TEMPLATE:case E.TITLE:{Zi(t,e);break}case E.CAPTION:case E.COLGROUP:case E.TBODY:case E.TFOOT:case E.THEAD:{t.tmplInsertionModeStack[0]=q.IN_TABLE,t.insertionMode=q.IN_TABLE,Sl(t,e);break}case E.COL:{t.tmplInsertionModeStack[0]=q.IN_COLUMN_GROUP,t.insertionMode=q.IN_COLUMN_GROUP,K1(t,e);break}case E.TR:{t.tmplInsertionModeStack[0]=q.IN_TABLE_BODY,t.insertionMode=q.IN_TABLE_BODY,Ch(t,e);break}case E.TD:case E.TH:{t.tmplInsertionModeStack[0]=q.IN_ROW,t.insertionMode=q.IN_ROW,Ih(t,e);break}default:t.tmplInsertionModeStack[0]=q.IN_BODY,t.insertionMode=q.IN_BODY,On(t,e)}}function yj(t,e){e.tagID===E.TEMPLATE&&Jo(t,e)}function zR(t,e){t.openElements.tmplCount>0?(t.openElements.popUntilTagNamePopped(E.TEMPLATE),t.activeFormattingElements.clearToLastMarker(),t.tmplInsertionModeStack.shift(),t._resetInsertionMode(),t.onEof(e)):W1(t,e)}function vj(t,e){e.tagID===E.HTML?On(t,e):Rh(t,e)}function VR(t,e){var n;if(e.tagID===E.HTML){if(t.fragmentContext||(t.insertionMode=q.AFTER_AFTER_BODY),t.options.sourceCodeLocationInfo&&t.openElements.tagIDs[0]===E.HTML){t._setEndLocation(t.openElements.items[0],e);const i=t.openElements.items[1];i&&!(!((n=t.treeAdapter.getNodeSourceCodeLocation(i))===null||n===void 0)&&n.endTag)&&t._setEndLocation(i,e)}}else Rh(t,e)}function Rh(t,e){t.insertionMode=q.IN_BODY,wh(t,e)}function bj(t,e){switch(e.tagID){case E.HTML:{On(t,e);break}case E.FRAMESET:{t._insertElement(e,he.HTML);break}case E.FRAME:{t._appendElement(e,he.HTML),e.ackSelfClosing=!0;break}case E.NOFRAMES:{Zi(t,e);break}}}function Ej(t,e){e.tagID===E.FRAMESET&&!t.openElements.isRootHtmlElementCurrent()&&(t.openElements.pop(),!t.fragmentContext&&t.openElements.currentTagId!==E.FRAMESET&&(t.insertionMode=q.AFTER_FRAMESET))}function Tj(t,e){switch(e.tagID){case E.HTML:{On(t,e);break}case E.NOFRAMES:{Zi(t,e);break}}}function Sj(t,e){e.tagID===E.HTML&&(t.insertionMode=q.AFTER_AFTER_FRAMESET)}function xj(t,e){e.tagID===E.HTML?On(t,e):Lh(t,e)}function Lh(t,e){t.insertionMode=q.IN_BODY,wh(t,e)}function wj(t,e){switch(e.tagID){case E.HTML:{On(t,e);break}case E.NOFRAMES:{Zi(t,e);break}}}function _j(t,e){e.chars=$t,t._insertCharacters(e)}function Aj(t,e){t._insertCharacters(e),t.framesetOk=!1}function GR(t){for(;t.treeAdapter.getNamespaceURI(t.openElements.current)!==he.HTML&&t.openElements.currentTagId!==void 0&&!t._isIntegrationPoint(t.openElements.currentTagId,t.openElements.current);)t.openElements.pop()}function Cj(t,e){if(zV(e))GR(t),t._startTagOutsideForeignContent(e);else{const n=t._getAdjustedCurrentElement(),i=t.treeAdapter.getNamespaceURI(n);i===he.MATHML?xR(e):i===he.SVG&&(VV(e),wR(e)),V1(e),e.selfClosing?t._appendElement(e,i):t._insertElement(e,i),e.ackSelfClosing=!0}}function Ij(t,e){if(e.tagID===E.P||e.tagID===E.BR){GR(t),t._endTagOutsideForeignContent(e);return}for(let n=t.openElements.stackTop;n>0;n--){const i=t.openElements.items[n];if(t.treeAdapter.getNamespaceURI(i)===he.HTML){t._endTagOutsideForeignContent(e);break}const r=t.treeAdapter.getTagName(i);if(r.toLowerCase()===e.tagName){e.tagName=r,t.openElements.shortenToLength(n);break}}}J.AREA,J.BASE,J.BASEFONT,J.BGSOUND,J.BR,J.COL,J.EMBED,J.FRAME,J.HR,J.IMG,J.INPUT,J.KEYGEN,J.LINK,J.META,J.PARAM,J.SOURCE,J.TRACK,J.WBR;const jR=WR("end"),ea=WR("start");function WR(t){return e;function e(n){const i=n&&n.position&&n.position[t]||{};if(typeof i.line=="number"&&i.line>0&&typeof i.column=="number"&&i.column>0)return{line:i.line,column:i.column,offset:typeof i.offset=="number"&&i.offset>-1?i.offset:void 0}}}const qR=function(t){if(t==null)return kj;if(typeof t=="function")return Ph(t);if(typeof t=="object")return Array.isArray(t)?Rj(t):Lj(t);if(typeof t=="string")return Pj(t);throw new Error("Expected function, string, or object as test")};function Rj(t){const e=[];let n=-1;for(;++n<t.length;)e[n]=qR(t[n]);return Ph(i);function i(...r){let s=-1;for(;++s<e.length;)if(e[s].apply(this,r))return!0;return!1}}function Lj(t){const e=t;return Ph(n);function n(i){const r=i;let s;for(s in t)if(r[s]!==e[s])return!1;return!0}}function Pj(t){return Ph(e);function e(n){return n&&n.type===t}}function Ph(t){return e;function e(n,i,r){return!!(Dj(n)&&t.call(this,n,typeof i=="number"?i:void 0,r||void 0))}}function kj(){return!0}function Dj(t){return t!==null&&typeof t=="object"&&"type"in t}function lye(t){return t}const KR=[],Oj=!0,kh=!1,Nj="skip";function YR(t,e,n,i){let r;typeof e=="function"&&typeof n!="function"?(i=n,n=e):r=e;const s=qR(r),o=i?-1:1;a(t,void 0,[])();function a(l,u,c){const d=l&&typeof l=="object"?l:{};if(typeof d.type=="string"){const h=typeof d.tagName=="string"?d.tagName:typeof d.name=="string"?d.name:void 0;Object.defineProperty(f,"name",{value:"node ("+(l.type+(h?"<"+h+">":""))+")"})}return f;function f(){let h=KR,p,m,y;if((!e||s(l,u,c[c.length-1]||void 0))&&(h=Mj(n(l,c)),h[0]===kh))return h;if("children"in l&&l.children){const g=l;if(g.children&&h[0]!==Nj)for(m=(i?g.children.length:-1)+o,y=c.concat(g);m>-1&&m<g.children.length;){const v=g.children[m];if(p=a(v,m,y)(),p[0]===kh)return p;m=typeof p[1]=="number"?p[1]:m+o}}return h}}}function Mj(t){return Array.isArray(t)?t:typeof t=="number"?[Oj,t]:t==null?KR:[t]}function Dh(t,e,n,i){let r,s,o;typeof e=="function"&&typeof n!="function"?(s=void 0,o=e,r=n):(s=e,o=n,r=i),YR(t,s,a,r);function a(l,u){const c=u[u.length-1],d=c?c.children.indexOf(l):void 0;return o(l,d,c)}}const Fj=/<(\/?)(iframe|noembed|noframes|plaintext|script|style|textarea|title|xmp)(?=[\t\n\f\r />])/gi,Bj=new Set(["mdxFlowExpression","mdxJsxFlowElement","mdxJsxTextElement","mdxTextExpression","mdxjsEsm"]),XR={sourceCodeLocationInfo:!0,scriptingEnabled:!1};function QR(t,e){const n=Kj(t),i=B1("type",{handlers:{root:Uj,element:Hj,text:$j,comment:JR,doctype:zj,raw:Gj},unknown:jj}),r={parser:n?new CR(XR):CR.getFragmentParser(void 0,XR),handle(a){i(a,r)},stitches:!1,options:e||{}};i(t,r),xl(r,ea());const s=n?r.parser.document:r.parser.getFragment(),o=kz(s,{file:r.options.file});return r.stitches&&Dh(o,"comment",function(a,l,u){const c=a;if(c.value.stitch&&u&&l!==void 0){const d=u.children;return d[l]=c.value.stitch,l}}),o.type==="root"&&o.children.length===1&&o.children[0].type===t.type?o.children[0]:o}function ZR(t,e){let n=-1;if(t)for(;++n<t.length;)e.handle(t[n])}function Uj(t,e){ZR(t.children,e)}function Hj(t,e){Wj(t,e),ZR(t.children,e),qj(t,e)}function $j(t,e){e.parser.tokenizer.state>4&&(e.parser.tokenizer.state=0);const n={type:ct.CHARACTER,chars:t.value,location:Bc(t)};xl(e,ea(t)),e.parser.currentToken=n,e.parser._processToken(e.parser.currentToken)}function zj(t,e){const n={type:ct.DOCTYPE,name:"html",forceQuirks:!1,publicId:"",systemId:"",location:Bc(t)};xl(e,ea(t)),e.parser.currentToken=n,e.parser._processToken(e.parser.currentToken)}function Vj(t,e){e.stitches=!0;const n=Yj(t);if("children"in t&&"children"in n){const i=QR({type:"root",children:t.children},e.options);n.children=i.children}JR({type:"comment",value:{stitch:n}},e)}function JR(t,e){const n=t.value,i={type:ct.COMMENT,data:n,location:Bc(t)};xl(e,ea(t)),e.parser.currentToken=i,e.parser._processToken(e.parser.currentToken)}function Gj(t,e){if(e.parser.tokenizer.preprocessor.html="",e.parser.tokenizer.preprocessor.pos=-1,e.parser.tokenizer.preprocessor.lastGapPos=-2,e.parser.tokenizer.preprocessor.gapStack=[],e.parser.tokenizer.preprocessor.skipNextNewLine=!1,e.parser.tokenizer.preprocessor.lastChunkWritten=!1,e.parser.tokenizer.preprocessor.endOfChunkHit=!1,e.parser.tokenizer.preprocessor.isEol=!1,eL(e,ea(t)),e.parser.tokenizer.write(e.options.tagfilter?t.value.replace(Fj,"&lt;$1$2"):t.value,!1),e.parser.tokenizer._runParsingLoop(),e.parser.tokenizer.state===72||e.parser.tokenizer.state===78){e.parser.tokenizer.preprocessor.lastChunkWritten=!0;const n=e.parser.tokenizer._consume();e.parser.tokenizer._callState(n)}}function jj(t,e){const n=t;if(e.options.passThrough&&e.options.passThrough.includes(n.type))Vj(n,e);else{let i="";throw Bj.has(n.type)&&(i=". It looks like you are using MDX nodes with `hast-util-raw` (or `rehype-raw`). If you use this because you are using remark or rehype plugins that inject `'html'` nodes, then please raise an issue with that plugin, as its a bad and slow idea. If you use this because you are using markdown syntax, then you have to configure this utility (or plugin) to pass through these nodes (see `passThrough` in docs), but you can also migrate to use the MDX syntax"),new Error("Cannot compile `"+n.type+"` node"+i)}}function xl(t,e){eL(t,e);const n=t.parser.tokenizer.currentCharacterToken;n&&n.location&&(n.location.endLine=t.parser.tokenizer.preprocessor.line,n.location.endCol=t.parser.tokenizer.preprocessor.col+1,n.location.endOffset=t.parser.tokenizer.preprocessor.offset+1,t.parser.currentToken=n,t.parser._processToken(t.parser.currentToken)),t.parser.tokenizer.paused=!1,t.parser.tokenizer.inLoop=!1,t.parser.tokenizer.active=!1,t.parser.tokenizer.returnState=Jt.DATA,t.parser.tokenizer.charRefCode=-1,t.parser.tokenizer.consumedAfterSnapshot=-1,t.parser.tokenizer.currentLocation=null,t.parser.tokenizer.currentCharacterToken=null,t.parser.tokenizer.currentToken=null,t.parser.tokenizer.currentAttr={name:"",value:""}}function eL(t,e){if(e&&e.offset!==void 0){const n={startLine:e.line,startCol:e.column,startOffset:e.offset,endLine:-1,endCol:-1,endOffset:-1};t.parser.tokenizer.preprocessor.lineStartPos=-e.column+1,t.parser.tokenizer.preprocessor.droppedBufferSize=e.offset,t.parser.tokenizer.preprocessor.line=e.line,t.parser.tokenizer.currentLocation=n}}function Wj(t,e){const n=t.tagName.toLowerCase();if(e.parser.tokenizer.state===Jt.PLAINTEXT)return;xl(e,ea(t));const i=e.parser.openElements.current;let r="namespaceURI"in i?i.namespaceURI:Xo.html;r===Xo.html&&n==="svg"&&(r=Xo.svg);const s=qz({...t,children:[]},{space:r===Xo.svg?"svg":"html"}),o={type:ct.START_TAG,tagName:n,tagID:Tl(n),selfClosing:!1,ackSelfClosing:!1,attrs:"attrs"in s?s.attrs:[],location:Bc(t)};e.parser.currentToken=o,e.parser._processToken(e.parser.currentToken),e.parser.tokenizer.lastStartTagName=n}function qj(t,e){const n=t.tagName.toLowerCase();if(!e.parser.tokenizer.inForeignNode&&sR.includes(n)||e.parser.tokenizer.state===Jt.PLAINTEXT)return;xl(e,jR(t));const i={type:ct.END_TAG,tagName:n,tagID:Tl(n),selfClosing:!1,ackSelfClosing:!1,attrs:[],location:Bc(t)};e.parser.currentToken=i,e.parser._processToken(e.parser.currentToken),n===e.parser.tokenizer.lastStartTagName&&(e.parser.tokenizer.state===Jt.RCDATA||e.parser.tokenizer.state===Jt.RAWTEXT||e.parser.tokenizer.state===Jt.SCRIPT_DATA)&&(e.parser.tokenizer.state=Jt.DATA)}function Kj(t){const e=t.type==="root"?t.children[0]:t;return!!(e&&(e.type==="doctype"||e.type==="element"&&e.tagName.toLowerCase()==="html"))}function Bc(t){const e=ea(t)||{line:void 0,column:void 0,offset:void 0},n=jR(t)||{line:void 0,column:void 0,offset:void 0};return{startLine:e.line,startCol:e.column,startOffset:e.offset,endLine:n.line,endCol:n.column,endOffset:n.offset}}function Yj(t){return"children"in t?fl({...t,children:[]}):fl(t)}function Xj(t){return function(e,n){return QR(e,{...t,file:n})}}class Uc{constructor(e,n,i){this.normal=n,this.property=e,i&&(this.space=i)}}Uc.prototype.normal={},Uc.prototype.property={},Uc.prototype.space=void 0;function tL(t,e){const n={},i={};for(const r of t)Object.assign(n,r.property),Object.assign(i,r.normal);return new Uc(n,i,e)}function X1(t){return t.toLowerCase()}class ei{constructor(e,n){this.attribute=n,this.property=e}}ei.prototype.attribute="",ei.prototype.booleanish=!1,ei.prototype.boolean=!1,ei.prototype.commaOrSpaceSeparated=!1,ei.prototype.commaSeparated=!1,ei.prototype.defined=!1,ei.prototype.mustUseProperty=!1,ei.prototype.number=!1,ei.prototype.overloadedBoolean=!1,ei.prototype.property="",ei.prototype.spaceSeparated=!1,ei.prototype.space=void 0;let Qj=0;const it=ta(),ln=ta(),Q1=ta(),Te=ta(),Dt=ta(),wl=ta(),bi=ta();function ta(){return 2**++Qj}const Z1=Object.freeze(Object.defineProperty({__proto__:null,boolean:it,booleanish:ln,commaOrSpaceSeparated:bi,commaSeparated:wl,number:Te,overloadedBoolean:Q1,spaceSeparated:Dt},Symbol.toStringTag,{value:"Module"})),J1=Object.keys(Z1);class ev extends ei{constructor(e,n,i,r){let s=-1;if(super(e,n),nL(this,"space",r),typeof i=="number")for(;++s<J1.length;){const o=J1[s];nL(this,J1[s],(i&Z1[o])===Z1[o])}}}ev.prototype.defined=!0;function nL(t,e,n){n&&(t[e]=n)}function _l(t){const e={},n={};for(const[i,r]of Object.entries(t.properties)){const s=new ev(i,t.transform(t.attributes||{},i),r,t.space);t.mustUseProperty&&t.mustUseProperty.includes(i)&&(s.mustUseProperty=!0),e[i]=s,n[X1(i)]=i,n[X1(s.attribute)]=i}return new Uc(e,n,t.space)}const iL=_l({properties:{ariaActiveDescendant:null,ariaAtomic:ln,ariaAutoComplete:null,ariaBusy:ln,ariaChecked:ln,ariaColCount:Te,ariaColIndex:Te,ariaColSpan:Te,ariaControls:Dt,ariaCurrent:null,ariaDescribedBy:Dt,ariaDetails:null,ariaDisabled:ln,ariaDropEffect:Dt,ariaErrorMessage:null,ariaExpanded:ln,ariaFlowTo:Dt,ariaGrabbed:ln,ariaHasPopup:null,ariaHidden:ln,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:Dt,ariaLevel:Te,ariaLive:null,ariaModal:ln,ariaMultiLine:ln,ariaMultiSelectable:ln,ariaOrientation:null,ariaOwns:Dt,ariaPlaceholder:null,ariaPosInSet:Te,ariaPressed:ln,ariaReadOnly:ln,ariaRelevant:null,ariaRequired:ln,ariaRoleDescription:Dt,ariaRowCount:Te,ariaRowIndex:Te,ariaRowSpan:Te,ariaSelected:ln,ariaSetSize:Te,ariaSort:null,ariaValueMax:Te,ariaValueMin:Te,ariaValueNow:Te,ariaValueText:null,role:null},transform(t,e){return e==="role"?e:"aria-"+e.slice(4).toLowerCase()}});function rL(t,e){return e in t?t[e]:e}function sL(t,e){return rL(t,e.toLowerCase())}const Zj=_l({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:wl,acceptCharset:Dt,accessKey:Dt,action:null,allow:null,allowFullScreen:it,allowPaymentRequest:it,allowUserMedia:it,alt:null,as:null,async:it,autoCapitalize:null,autoComplete:Dt,autoFocus:it,autoPlay:it,blocking:Dt,capture:null,charSet:null,checked:it,cite:null,className:Dt,cols:Te,colSpan:null,content:null,contentEditable:ln,controls:it,controlsList:Dt,coords:Te|wl,crossOrigin:null,data:null,dateTime:null,decoding:null,default:it,defer:it,dir:null,dirName:null,disabled:it,download:Q1,draggable:ln,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:it,formTarget:null,headers:Dt,height:Te,hidden:Q1,high:Te,href:null,hrefLang:null,htmlFor:Dt,httpEquiv:Dt,id:null,imageSizes:null,imageSrcSet:null,inert:it,inputMode:null,integrity:null,is:null,isMap:it,itemId:null,itemProp:Dt,itemRef:Dt,itemScope:it,itemType:Dt,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:it,low:Te,manifest:null,max:null,maxLength:Te,media:null,method:null,min:null,minLength:Te,multiple:it,muted:it,name:null,nonce:null,noModule:it,noValidate:it,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:it,optimum:Te,pattern:null,ping:Dt,placeholder:null,playsInline:it,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:it,referrerPolicy:null,rel:Dt,required:it,reversed:it,rows:Te,rowSpan:Te,sandbox:Dt,scope:null,scoped:it,seamless:it,selected:it,shadowRootClonable:it,shadowRootDelegatesFocus:it,shadowRootMode:null,shape:null,size:Te,sizes:null,slot:null,span:Te,spellCheck:ln,src:null,srcDoc:null,srcLang:null,srcSet:null,start:Te,step:null,style:null,tabIndex:Te,target:null,title:null,translate:null,type:null,typeMustMatch:it,useMap:null,value:ln,width:Te,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:Dt,axis:null,background:null,bgColor:null,border:Te,borderColor:null,bottomMargin:Te,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:it,declare:it,event:null,face:null,frame:null,frameBorder:null,hSpace:Te,leftMargin:Te,link:null,longDesc:null,lowSrc:null,marginHeight:Te,marginWidth:Te,noResize:it,noHref:it,noShade:it,noWrap:it,object:null,profile:null,prompt:null,rev:null,rightMargin:Te,rules:null,scheme:null,scrolling:ln,standby:null,summary:null,text:null,topMargin:Te,valueType:null,version:null,vAlign:null,vLink:null,vSpace:Te,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:it,disableRemotePlayback:it,prefix:null,property:null,results:Te,security:null,unselectable:null},space:"html",transform:sL}),Jj=_l({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:bi,accentHeight:Te,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:Te,amplitude:Te,arabicForm:null,ascent:Te,attributeName:null,attributeType:null,azimuth:Te,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:Te,by:null,calcMode:null,capHeight:Te,className:Dt,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:Te,diffuseConstant:Te,direction:null,display:null,dur:null,divisor:Te,dominantBaseline:null,download:it,dx:null,dy:null,edgeMode:null,editable:null,elevation:Te,enableBackground:null,end:null,event:null,exponent:Te,externalResourcesRequired:null,fill:null,fillOpacity:Te,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:wl,g2:wl,glyphName:wl,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:Te,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:Te,horizOriginX:Te,horizOriginY:Te,id:null,ideographic:Te,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:Te,k:Te,k1:Te,k2:Te,k3:Te,k4:Te,kernelMatrix:bi,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:Te,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:Te,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:Te,overlineThickness:Te,paintOrder:null,panose1:null,path:null,pathLength:Te,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:Dt,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:Te,pointsAtY:Te,pointsAtZ:Te,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:bi,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:bi,rev:bi,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:bi,requiredFeatures:bi,requiredFonts:bi,requiredFormats:bi,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:Te,specularExponent:Te,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:Te,strikethroughThickness:Te,string:null,stroke:null,strokeDashArray:bi,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:Te,strokeOpacity:Te,strokeWidth:null,style:null,surfaceScale:Te,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:bi,tabIndex:Te,tableValues:null,target:null,targetX:Te,targetY:Te,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:bi,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:Te,underlineThickness:Te,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:Te,values:null,vAlphabetic:Te,vMathematical:Te,vectorEffect:null,vHanging:Te,vIdeographic:Te,version:null,vertAdvY:Te,vertOriginX:Te,vertOriginY:Te,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:Te,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:rL}),oL=_l({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(t,e){return"xlink:"+e.slice(5).toLowerCase()}}),aL=_l({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:sL}),lL=_l({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(t,e){return"xml:"+e.slice(3).toLowerCase()}}),eW=/[A-Z]/g,uL=/-[a-z]/g,tW=/^data[-\w.:]+$/i;function nW(t,e){const n=X1(e);let i=e,r=ei;if(n in t.normal)return t.property[t.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&tW.test(e)){if(e.charAt(4)==="-"){const s=e.slice(5).replace(uL,rW);i="data"+s.charAt(0).toUpperCase()+s.slice(1)}else{const s=e.slice(4);if(!uL.test(s)){let o=s.replace(eW,iW);o.charAt(0)!=="-"&&(o="-"+o),e="data"+o}}r=ev}return new r(i,e)}function iW(t){return"-"+t.toLowerCase()}function rW(t){return t.charAt(1).toUpperCase()}const sW=tL([iL,Zj,oL,aL,lL],"html"),cL=tL([iL,Jj,oL,aL,lL],"svg"),oW=/["&'<>`]/g,aW=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,lW=/[\x01-\t\v\f\x0E-\x1F\x7F\x81\x8D\x8F\x90\x9D\xA0-\uFFFF]/g,uW=/[|\\{}()[\]^$+*?.]/g,dL=new WeakMap;function cW(t,e){if(t=t.replace(e.subset?dW(e.subset):oW,i),e.subset||e.escapeOnly)return t;return t.replace(aW,n).replace(lW,i);function n(r,s,o){return e.format((r.charCodeAt(0)-55296)*1024+r.charCodeAt(1)-56320+65536,o.charCodeAt(s+2),e)}function i(r,s,o){return e.format(r.charCodeAt(0),o.charCodeAt(s+1),e)}}function dW(t){let e=dL.get(t);return e||(e=fW(t),dL.set(t,e)),e}function fW(t){const e=[];let n=-1;for(;++n<t.length;)e.push(t[n].replace(uW,"\\$&"));return new RegExp("(?:"+e.join("|")+")","g")}const hW=/[\dA-Fa-f]/;function pW(t,e,n){const i="&#x"+t.toString(16).toUpperCase();return n&&e&&!hW.test(String.fromCharCode(e))?i:i+";"}const mW=/\d/;function gW(t,e,n){const i="&#"+String(t);return n&&e&&!mW.test(String.fromCharCode(e))?i:i+";"}const yW=["AElig","AMP","Aacute","Acirc","Agrave","Aring","Atilde","Auml","COPY","Ccedil","ETH","Eacute","Ecirc","Egrave","Euml","GT","Iacute","Icirc","Igrave","Iuml","LT","Ntilde","Oacute","Ocirc","Ograve","Oslash","Otilde","Ouml","QUOT","REG","THORN","Uacute","Ucirc","Ugrave","Uuml","Yacute","aacute","acirc","acute","aelig","agrave","amp","aring","atilde","auml","brvbar","ccedil","cedil","cent","copy","curren","deg","divide","eacute","ecirc","egrave","eth","euml","frac12","frac14","frac34","gt","iacute","icirc","iexcl","igrave","iquest","iuml","laquo","lt","macr","micro","middot","nbsp","not","ntilde","oacute","ocirc","ograve","ordf","ordm","oslash","otilde","ouml","para","plusmn","pound","quot","raquo","reg","sect","shy","sup1","sup2","sup3","szlig","thorn","times","uacute","ucirc","ugrave","uml","uuml","yacute","yen","yuml"],tv={nbsp:"",iexcl:"",cent:"",pound:"",curren:"",yen:"",brvbar:"",sect:"",uml:"",copy:"",ordf:"",laquo:"",not:"",shy:"",reg:"",macr:"",deg:"",plusmn:"",sup2:"",sup3:"",acute:"",micro:"",para:"",middot:"",cedil:"",sup1:"",ordm:"",raquo:"",frac14:"",frac12:"",frac34:"",iquest:"",Agrave:"",Aacute:"",Acirc:"",Atilde:"",Auml:"",Aring:"",AElig:"",Ccedil:"",Egrave:"",Eacute:"",Ecirc:"",Euml:"",Igrave:"",Iacute:"",Icirc:"",Iuml:"",ETH:"",Ntilde:"",Ograve:"",Oacute:"",Ocirc:"",Otilde:"",Ouml:"",times:"",Oslash:"",Ugrave:"",Uacute:"",Ucirc:"",Uuml:"",Yacute:"",THORN:"",szlig:"",agrave:"",aacute:"",acirc:"",atilde:"",auml:"",aring:"",aelig:"",ccedil:"",egrave:"",eacute:"",ecirc:"",euml:"",igrave:"",iacute:"",icirc:"",iuml:"",eth:"",ntilde:"",ograve:"",oacute:"",ocirc:"",otilde:"",ouml:"",divide:"",oslash:"",ugrave:"",uacute:"",ucirc:"",uuml:"",yacute:"",thorn:"",yuml:"",fnof:"",Alpha:"",Beta:"",Gamma:"",Delta:"",Epsilon:"",Zeta:"",Eta:"",Theta:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Xi:"",Omicron:"",Pi:"",Rho:"",Sigma:"",Tau:"",Upsilon:"",Phi:"",Chi:"",Psi:"",Omega:"",alpha:"",beta:"",gamma:"",delta:"",epsilon:"",zeta:"",eta:"",theta:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",xi:"",omicron:"",pi:"",rho:"",sigmaf:"",sigma:"",tau:"",upsilon:"",phi:"",chi:"",psi:"",omega:"",thetasym:"",upsih:"",piv:"",bull:"",hellip:"",prime:"",Prime:"",oline:"",frasl:"",weierp:"",image:"",real:"",trade:"",alefsym:"",larr:"",uarr:"",rarr:"",darr:"",harr:"",crarr:"",lArr:"",uArr:"",rArr:"",dArr:"",hArr:"",forall:"",part:"",exist:"",empty:"",nabla:"",isin:"",notin:"",ni:"",prod:"",sum:"",minus:"",lowast:"",radic:"",prop:"",infin:"",ang:"",and:"",or:"",cap:"",cup:"",int:"",there4:"",sim:"",cong:"",asymp:"",ne:"",equiv:"",le:"",ge:"",sub:"",sup:"",nsub:"",sube:"",supe:"",oplus:"",otimes:"",perp:"",sdot:"",lceil:"",rceil:"",lfloor:"",rfloor:"",lang:"",rang:"",loz:"",spades:"",clubs:"",hearts:"",diams:"",quot:'"',amp:"&",lt:"<",gt:">",OElig:"",oelig:"",Scaron:"",scaron:"",Yuml:"",circ:"",tilde:"",ensp:"",emsp:"",thinsp:"",zwnj:"",zwj:"",lrm:"",rlm:"",ndash:"",mdash:"",lsquo:"",rsquo:"",sbquo:"",ldquo:"",rdquo:"",bdquo:"",dagger:"",Dagger:"",permil:"",lsaquo:"",rsaquo:"",euro:""},vW=["cent","copy","divide","gt","lt","not","para","times"],fL={}.hasOwnProperty,nv={};let Oh;for(Oh in tv)fL.call(tv,Oh)&&(nv[tv[Oh]]=Oh);const bW=/[^\dA-Za-z]/;function EW(t,e,n,i){const r=String.fromCharCode(t);if(fL.call(nv,r)){const s=nv[r],o="&"+s;return n&&yW.includes(s)&&!vW.includes(s)&&(!i||e&&e!==61&&bW.test(String.fromCharCode(e)))?o:o+";"}return""}function TW(t,e,n){let i=pW(t,e,n.omitOptionalSemicolons),r;if((n.useNamedReferences||n.useShortestReferences)&&(r=EW(t,e,n.omitOptionalSemicolons,n.attribute)),(n.useShortestReferences||!r)&&n.useShortestReferences){const s=gW(t,e,n.omitOptionalSemicolons);s.length<i.length&&(i=s)}return r&&(!n.useShortestReferences||r.length<i.length)?r:i}function Al(t,e){return cW(t,Object.assign({format:TW},e))}const SW=/^>|^->|<!--|-->|--!>|<!-$/g,xW=[">"],wW=["<",">"];function _W(t,e,n,i){return i.settings.bogusComments?"<?"+Al(t.value,Object.assign({},i.settings.characterReferences,{subset:xW}))+">":"<!--"+t.value.replace(SW,r)+"-->";function r(s){return Al(s,Object.assign({},i.settings.characterReferences,{subset:wW}))}}function AW(t,e,n,i){return"<!"+(i.settings.upperDoctype?"DOCTYPE":"doctype")+(i.settings.tightDoctype?"":" ")+"html>"}function Nh(t,e){const n=String(t);if(typeof e!="string")throw new TypeError("Expected character");let i=0,r=n.indexOf(e);for(;r!==-1;)i++,r=n.indexOf(e,r+e.length);return i}const CW=/[ \t\n\f\r]/g;function iv(t){return typeof t=="object"?t.type==="text"?hL(t.value):!1:hL(t)}function hL(t){return t.replace(CW,"")===""}const hn=mL(1),pL=mL(-1),IW=[];function mL(t){return e;function e(n,i,r){const s=n?n.children:IW;let o=(i||0)+t,a=s[o];if(!r)for(;a&&iv(a);)o+=t,a=s[o];return a}}const RW={}.hasOwnProperty;function gL(t){return e;function e(n,i,r){return RW.call(t,n.tagName)&&t[n.tagName](n,i,r)}}const rv=gL({body:PW,caption:sv,colgroup:sv,dd:NW,dt:OW,head:sv,html:LW,li:DW,optgroup:MW,option:FW,p:kW,rp:yL,rt:yL,tbody:UW,td:vL,tfoot:HW,th:vL,thead:BW,tr:$W});function sv(t,e,n){const i=hn(n,e,!0);return!i||i.type!=="comment"&&!(i.type==="text"&&iv(i.value.charAt(0)))}function LW(t,e,n){const i=hn(n,e);return!i||i.type!=="comment"}function PW(t,e,n){const i=hn(n,e);return!i||i.type!=="comment"}function kW(t,e,n){const i=hn(n,e);return i?i.type==="element"&&(i.tagName==="address"||i.tagName==="article"||i.tagName==="aside"||i.tagName==="blockquote"||i.tagName==="details"||i.tagName==="div"||i.tagName==="dl"||i.tagName==="fieldset"||i.tagName==="figcaption"||i.tagName==="figure"||i.tagName==="footer"||i.tagName==="form"||i.tagName==="h1"||i.tagName==="h2"||i.tagName==="h3"||i.tagName==="h4"||i.tagName==="h5"||i.tagName==="h6"||i.tagName==="header"||i.tagName==="hgroup"||i.tagName==="hr"||i.tagName==="main"||i.tagName==="menu"||i.tagName==="nav"||i.tagName==="ol"||i.tagName==="p"||i.tagName==="pre"||i.tagName==="section"||i.tagName==="table"||i.tagName==="ul"):!n||!(n.type==="element"&&(n.tagName==="a"||n.tagName==="audio"||n.tagName==="del"||n.tagName==="ins"||n.tagName==="map"||n.tagName==="noscript"||n.tagName==="video"))}function DW(t,e,n){const i=hn(n,e);return!i||i.type==="element"&&i.tagName==="li"}function OW(t,e,n){const i=hn(n,e);return!!(i&&i.type==="element"&&(i.tagName==="dt"||i.tagName==="dd"))}function NW(t,e,n){const i=hn(n,e);return!i||i.type==="element"&&(i.tagName==="dt"||i.tagName==="dd")}function yL(t,e,n){const i=hn(n,e);return!i||i.type==="element"&&(i.tagName==="rp"||i.tagName==="rt")}function MW(t,e,n){const i=hn(n,e);return!i||i.type==="element"&&i.tagName==="optgroup"}function FW(t,e,n){const i=hn(n,e);return!i||i.type==="element"&&(i.tagName==="option"||i.tagName==="optgroup")}function BW(t,e,n){const i=hn(n,e);return!!(i&&i.type==="element"&&(i.tagName==="tbody"||i.tagName==="tfoot"))}function UW(t,e,n){const i=hn(n,e);return!i||i.type==="element"&&(i.tagName==="tbody"||i.tagName==="tfoot")}function HW(t,e,n){return!hn(n,e)}function $W(t,e,n){const i=hn(n,e);return!i||i.type==="element"&&i.tagName==="tr"}function vL(t,e,n){const i=hn(n,e);return!i||i.type==="element"&&(i.tagName==="td"||i.tagName==="th")}const zW=gL({body:jW,colgroup:WW,head:GW,html:VW,tbody:qW});function VW(t){const e=hn(t,-1);return!e||e.type!=="comment"}function GW(t){const e=new Set;for(const i of t.children)if(i.type==="element"&&(i.tagName==="base"||i.tagName==="title")){if(e.has(i.tagName))return!1;e.add(i.tagName)}const n=t.children[0];return!n||n.type==="element"}function jW(t){const e=hn(t,-1,!0);return!e||e.type!=="comment"&&!(e.type==="text"&&iv(e.value.charAt(0)))&&!(e.type==="element"&&(e.tagName==="meta"||e.tagName==="link"||e.tagName==="script"||e.tagName==="style"||e.tagName==="template"))}function WW(t,e,n){const i=pL(n,e),r=hn(t,-1,!0);return n&&i&&i.type==="element"&&i.tagName==="colgroup"&&rv(i,n.children.indexOf(i),n)?!1:!!(r&&r.type==="element"&&r.tagName==="col")}function qW(t,e,n){const i=pL(n,e),r=hn(t,-1);return n&&i&&i.type==="element"&&(i.tagName==="thead"||i.tagName==="tbody")&&rv(i,n.children.indexOf(i),n)?!1:!!(r&&r.type==="element"&&r.tagName==="tr")}const Mh={name:[[`	
\f\r &/=>`.split(""),`	
\f\r "&'/=>\``.split("")],[`\0	
\f\r "&'/<=>`.split(""),`\0	
\f\r "&'/<=>\``.split("")]],unquoted:[[`	
\f\r &>`.split(""),`\0	
\f\r "&'<=>\``.split("")],[`\0	
\f\r "&'<=>\``.split(""),`\0	
\f\r "&'<=>\``.split("")]],single:[["&'".split(""),"\"&'`".split("")],["\0&'".split(""),"\0\"&'`".split("")]],double:[['"&'.split(""),"\"&'`".split("")],['\0"&'.split(""),"\0\"&'`".split("")]]};function KW(t,e,n,i){const r=i.schema,s=r.space==="svg"?!1:i.settings.omitOptionalTags;let o=r.space==="svg"?i.settings.closeEmptyElements:i.settings.voids.includes(t.tagName.toLowerCase());const a=[];let l;r.space==="html"&&t.tagName==="svg"&&(i.schema=cL);const u=YW(i,t.properties),c=i.all(r.space==="html"&&t.tagName==="template"?t.content:t);return i.schema=r,c&&(o=!1),(u||!s||!zW(t,e,n))&&(a.push("<",t.tagName,u?" "+u:""),o&&(r.space==="svg"||i.settings.closeSelfClosing)&&(l=u.charAt(u.length-1),(!i.settings.tightSelfClosing||l==="/"||l&&l!=='"'&&l!=="'")&&a.push(" "),a.push("/")),a.push(">")),a.push(c),!o&&(!s||!rv(t,e,n))&&a.push("</"+t.tagName+">"),a.join("")}function YW(t,e){const n=[];let i=-1,r;if(e){for(r in e)if(e[r]!==null&&e[r]!==void 0){const s=XW(t,r,e[r]);s&&n.push(s)}}for(;++i<n.length;){const s=t.settings.tightAttributes?n[i].charAt(n[i].length-1):void 0;i!==n.length-1&&s!=='"'&&s!=="'"&&(n[i]+=" ")}return n.join("")}function XW(t,e,n){const i=nW(t.schema,e),r=t.settings.allowParseErrors&&t.schema.space==="html"?0:1,s=t.settings.allowDangerousCharacters?0:1;let o=t.quote,a;if(i.overloadedBoolean&&(n===i.attribute||n==="")?n=!0:(i.boolean||i.overloadedBoolean)&&(typeof n!="string"||n===i.attribute||n==="")&&(n=!!n),n==null||n===!1||typeof n=="number"&&Number.isNaN(n))return"";const l=Al(i.attribute,Object.assign({},t.settings.characterReferences,{subset:Mh.name[r][s]}));return n===!0||(n=Array.isArray(n)?(i.commaSeparated?_I:II)(n,{padLeft:!t.settings.tightCommaSeparatedLists}):String(n),t.settings.collapseEmptyAttributes&&!n)?l:(t.settings.preferUnquoted&&(a=Al(n,Object.assign({},t.settings.characterReferences,{attribute:!0,subset:Mh.unquoted[r][s]}))),a!==n&&(t.settings.quoteSmart&&Nh(n,o)>Nh(n,t.alternative)&&(o=t.alternative),a=o+Al(n,Object.assign({},t.settings.characterReferences,{subset:(o==="'"?Mh.single:Mh.double)[r][s],attribute:!0}))+o),l+(a&&"="+a))}const QW=["<","&"];function bL(t,e,n,i){return n&&n.type==="element"&&(n.tagName==="script"||n.tagName==="style")?t.value:Al(t.value,Object.assign({},i.settings.characterReferences,{subset:QW}))}function ZW(t,e,n,i){return i.settings.allowDangerousHtml?t.value:bL(t,e,n,i)}function JW(t,e,n,i){return i.all(t)}const eq=B1("type",{invalid:tq,unknown:nq,handlers:{comment:_W,doctype:AW,element:KW,raw:ZW,root:JW,text:bL}});function tq(t){throw new Error("Expected node, not `"+t+"`")}function nq(t){const e=t;throw new Error("Cannot compile unknown node `"+e.type+"`")}const iq={},rq={},sq=[];function oq(t,e){const n=e||iq,i=n.quote||'"',r=i==='"'?"'":'"';if(i!=='"'&&i!=="'")throw new Error("Invalid quote `"+i+"`, expected `'` or `\"`");return{one:aq,all:lq,settings:{omitOptionalTags:n.omitOptionalTags||!1,allowParseErrors:n.allowParseErrors||!1,allowDangerousCharacters:n.allowDangerousCharacters||!1,quoteSmart:n.quoteSmart||!1,preferUnquoted:n.preferUnquoted||!1,tightAttributes:n.tightAttributes||!1,upperDoctype:n.upperDoctype||!1,tightDoctype:n.tightDoctype||!1,bogusComments:n.bogusComments||!1,tightCommaSeparatedLists:n.tightCommaSeparatedLists||!1,tightSelfClosing:n.tightSelfClosing||!1,collapseEmptyAttributes:n.collapseEmptyAttributes||!1,allowDangerousHtml:n.allowDangerousHtml||!1,voids:n.voids||sR,characterReferences:n.characterReferences||rq,closeSelfClosing:n.closeSelfClosing||!1,closeEmptyElements:n.closeEmptyElements||!1},schema:n.space==="svg"?cL:sW,quote:i,alternative:r}.one(Array.isArray(t)?{type:"root",children:t}:t,void 0,void 0)}function aq(t,e,n){return eq(t,e,n,this)}function lq(t){const e=[],n=t&&t.children||sq;let i=-1;for(;++i<n.length;)e[i]=this.one(n[i],i,t);return e.join("")}function uq(t){const e=this,n={...e.data("settings"),...t};e.compiler=i;function i(r){return oq(r,n)}}const cq=EL(new RegExp("\\p{P}|\\p{S}","u")),dq=EL(/\s/);function EL(t){return e;function e(n){return n!==null&&n>-1&&t.test(String.fromCharCode(n))}}function fq(t){if(typeof t!="string")throw new TypeError("Expected a string");return t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}const TL=function(t){if(t==null)return gq;if(typeof t=="function")return Fh(t);if(typeof t=="object")return Array.isArray(t)?hq(t):pq(t);if(typeof t=="string")return mq(t);throw new Error("Expected function, string, or object as test")};function hq(t){const e=[];let n=-1;for(;++n<t.length;)e[n]=TL(t[n]);return Fh(i);function i(...r){let s=-1;for(;++s<e.length;)if(e[s].apply(this,r))return!0;return!1}}function pq(t){const e=t;return Fh(n);function n(i){const r=i;let s;for(s in t)if(r[s]!==e[s])return!1;return!0}}function mq(t){return Fh(e);function e(n){return n&&n.type===t}}function Fh(t){return e;function e(n,i,r){return!!(yq(n)&&t.call(this,n,typeof i=="number"?i:void 0,r||void 0))}}function gq(){return!0}function yq(t){return t!==null&&typeof t=="object"&&"type"in t}function vq(t,e,n){const r=TL((n||{}).ignore||[]),s=bq(e);let o=-1;for(;++o<s.length;)YR(t,"text",a);function a(u,c){let d=-1,f;for(;++d<c.length;){const h=c[d],p=f?f.children:void 0;if(r(h,p?p.indexOf(h):void 0,f))return;f=h}if(f)return l(u,c)}function l(u,c){const d=c[c.length-1],f=s[o][0],h=s[o][1];let p=0;const y=d.children.indexOf(u);let g=!1,v=[];f.lastIndex=0;let b=f.exec(u.value);for(;b;){const T=b.index,S={index:b.index,input:b.input,stack:[...c,u]};let _=h(...b,S);if(typeof _=="string"&&(_=_.length>0?{type:"text",value:_}:void 0),_===!1?f.lastIndex=T+1:(p!==T&&v.push({type:"text",value:u.value.slice(p,T)}),Array.isArray(_)?v.push(..._):_&&v.push(_),p=T+b[0].length,g=!0),!f.global)break;b=f.exec(u.value)}return g?(p<u.value.length&&v.push({type:"text",value:u.value.slice(p)}),d.children.splice(y,1,...v)):v=[u],y+v.length}}function bq(t){const e=[];if(!Array.isArray(t))throw new TypeError("Expected find and replace tuple or list of tuples");const n=!t[0]||Array.isArray(t[0])?t:[t];let i=-1;for(;++i<n.length;){const r=n[i];e.push([Eq(r[0]),Tq(r[1])])}return e}function Eq(t){return typeof t=="string"?new RegExp(fq(t),"g"):t}function Tq(t){return typeof t=="function"?t:function(){return t}}const ov="phrasing",av=["autolink","link","image","label"];function Sq(){return{transforms:[Rq],enter:{literalAutolink:wq,literalAutolinkEmail:lv,literalAutolinkHttp:lv,literalAutolinkWww:lv},exit:{literalAutolink:Iq,literalAutolinkEmail:Cq,literalAutolinkHttp:_q,literalAutolinkWww:Aq}}}function xq(){return{unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:ov,notInConstruct:av},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:ov,notInConstruct:av},{character:":",before:"[ps]",after:"\\/",inConstruct:ov,notInConstruct:av}]}}function wq(t){this.enter({type:"link",title:null,url:"",children:[]},t)}function lv(t){this.config.enter.autolinkProtocol.call(this,t)}function _q(t){this.config.exit.autolinkProtocol.call(this,t)}function Aq(t){this.config.exit.data.call(this,t);const e=this.stack[this.stack.length-1];e.type,e.url="http://"+this.sliceSerialize(t)}function Cq(t){this.config.exit.autolinkEmail.call(this,t)}function Iq(t){this.exit(t)}function Rq(t){vq(t,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,Lq],[new RegExp("(?<=^|\\s|\\p{P}|\\p{S})([-.\\w+]+)@([-\\w]+(?:\\.[-\\w]+)+)","gu"),Pq]],{ignore:["link","linkReference"]})}function Lq(t,e,n,i,r){let s="";if(!SL(r)||(/^w/i.test(e)&&(n=e+n,e="",s="http://"),!kq(n)))return!1;const o=Dq(n+i);if(!o[0])return!1;const a={type:"link",title:null,url:s+e+o[0],children:[{type:"text",value:e+o[0]}]};return o[1]?[a,{type:"text",value:o[1]}]:a}function Pq(t,e,n,i){return!SL(i,!0)||/[-\d_]$/.test(n)?!1:{type:"link",title:null,url:"mailto:"+e+"@"+n,children:[{type:"text",value:e+"@"+n}]}}function kq(t){const e=t.split(".");return!(e.length<2||e[e.length-1]&&(/_/.test(e[e.length-1])||!/[a-zA-Z\d]/.test(e[e.length-1]))||e[e.length-2]&&(/_/.test(e[e.length-2])||!/[a-zA-Z\d]/.test(e[e.length-2])))}function Dq(t){const e=/[!"&'),.:;<>?\]}]+$/.exec(t);if(!e)return[t,void 0];t=t.slice(0,e.index);let n=e[0],i=n.indexOf(")");const r=Nh(t,"(");let s=Nh(t,")");for(;i!==-1&&r>s;)t+=n.slice(0,i+1),n=n.slice(i+1),i=n.indexOf(")"),s++;return[t,n]}function SL(t,e){const n=t.input.charCodeAt(t.index-1);return(t.index===0||dq(n)||cq(n))&&(!e||n!==47)}function xL(t){return t.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}wL.peek=zq;function Oq(){this.buffer()}function Nq(t){this.enter({type:"footnoteReference",identifier:"",label:""},t)}function Mq(){this.buffer()}function Fq(t){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},t)}function Bq(t){const e=this.resume(),n=this.stack[this.stack.length-1];n.type,n.identifier=xL(this.sliceSerialize(t)).toLowerCase(),n.label=e}function Uq(t){this.exit(t)}function Hq(t){const e=this.resume(),n=this.stack[this.stack.length-1];n.type,n.identifier=xL(this.sliceSerialize(t)).toLowerCase(),n.label=e}function $q(t){this.exit(t)}function zq(){return"["}function wL(t,e,n,i){const r=n.createTracker(i);let s=r.move("[^");const o=n.enter("footnoteReference"),a=n.enter("reference");return s+=r.move(n.safe(n.associationId(t),{after:"]",before:s})),a(),o(),s+=r.move("]"),s}function Vq(){return{enter:{gfmFootnoteCallString:Oq,gfmFootnoteCall:Nq,gfmFootnoteDefinitionLabelString:Mq,gfmFootnoteDefinition:Fq},exit:{gfmFootnoteCallString:Bq,gfmFootnoteCall:Uq,gfmFootnoteDefinitionLabelString:Hq,gfmFootnoteDefinition:$q}}}function Gq(t){let e=!1;return t&&t.firstLineBlank&&(e=!0),{handlers:{footnoteDefinition:n,footnoteReference:wL},unsafe:[{character:"[",inConstruct:["label","phrasing","reference"]}]};function n(i,r,s,o){const a=s.createTracker(o);let l=a.move("[^");const u=s.enter("footnoteDefinition"),c=s.enter("label");return l+=a.move(s.safe(s.associationId(i),{before:l,after:"]"})),c(),l+=a.move("]:"),i.children&&i.children.length>0&&(a.shift(4),l+=a.move((e?`
`:" ")+s.indentLines(s.containerFlow(i,a.current()),e?_L:jq))),u(),l}}function jq(t,e,n){return e===0?t:_L(t,e,n)}function _L(t,e,n){return(n?"":"    ")+t}const Wq=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"];AL.peek=Qq;function qq(){return{canContainEols:["delete"],enter:{strikethrough:Yq},exit:{strikethrough:Xq}}}function Kq(){return{unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:Wq}],handlers:{delete:AL}}}function Yq(t){this.enter({type:"delete",children:[]},t)}function Xq(t){this.exit(t)}function AL(t,e,n,i){const r=n.createTracker(i),s=n.enter("strikethrough");let o=r.move("~~");return o+=n.containerPhrasing(t,{...r.current(),before:o,after:"~"}),o+=r.move("~~"),s(),o}function Qq(){return"~"}function Zq(t){return t.length}function Jq(t,e){const n=e||{},i=(n.align||[]).concat(),r=n.stringLength||Zq,s=[],o=[],a=[],l=[];let u=0,c=-1;for(;++c<t.length;){const m=[],y=[];let g=-1;for(t[c].length>u&&(u=t[c].length);++g<t[c].length;){const v=eK(t[c][g]);if(n.alignDelimiters!==!1){const b=r(v);y[g]=b,(l[g]===void 0||b>l[g])&&(l[g]=b)}m.push(v)}o[c]=m,a[c]=y}let d=-1;if(typeof i=="object"&&"length"in i)for(;++d<u;)s[d]=CL(i[d]);else{const m=CL(i);for(;++d<u;)s[d]=m}d=-1;const f=[],h=[];for(;++d<u;){const m=s[d];let y="",g="";m===99?(y=":",g=":"):m===108?y=":":m===114&&(g=":");let v=n.alignDelimiters===!1?1:Math.max(1,l[d]-y.length-g.length);const b=y+"-".repeat(v)+g;n.alignDelimiters!==!1&&(v=y.length+v+g.length,v>l[d]&&(l[d]=v),h[d]=v),f[d]=b}o.splice(1,0,f),a.splice(1,0,h),c=-1;const p=[];for(;++c<o.length;){const m=o[c],y=a[c];d=-1;const g=[];for(;++d<u;){const v=m[d]||"";let b="",T="";if(n.alignDelimiters!==!1){const S=l[d]-(y[d]||0),_=s[d];_===114?b=" ".repeat(S):_===99?S%2?(b=" ".repeat(S/2+.5),T=" ".repeat(S/2-.5)):(b=" ".repeat(S/2),T=b):T=" ".repeat(S)}n.delimiterStart!==!1&&!d&&g.push("|"),n.padding!==!1&&!(n.alignDelimiters===!1&&v==="")&&(n.delimiterStart!==!1||d)&&g.push(" "),n.alignDelimiters!==!1&&g.push(b),g.push(v),n.alignDelimiters!==!1&&g.push(T),n.padding!==!1&&g.push(" "),(n.delimiterEnd!==!1||d!==u-1)&&g.push("|")}p.push(n.delimiterEnd===!1?g.join("").replace(/ +$/,""):g.join(""))}return p.join(`
`)}function eK(t){return t==null?"":String(t)}function CL(t){const e=typeof t=="string"?t.codePointAt(0):0;return e===67||e===99?99:e===76||e===108?108:e===82||e===114?114:0}function tK(t,e,n,i){const r=n.enter("blockquote"),s=n.createTracker(i);s.move("> "),s.shift(2);const o=n.indentLines(n.containerFlow(t,s.current()),nK);return r(),o}function nK(t,e,n){return">"+(n?"":" ")+t}function iK(t,e){return IL(t,e.inConstruct,!0)&&!IL(t,e.notInConstruct,!1)}function IL(t,e,n){if(typeof e=="string"&&(e=[e]),!e||e.length===0)return n;let i=-1;for(;++i<e.length;)if(t.includes(e[i]))return!0;return!1}function RL(t,e,n,i){let r=-1;for(;++r<n.unsafe.length;)if(n.unsafe[r].character===`
`&&iK(n.stack,n.unsafe[r]))return/[ \t]/.test(i.before)?"":" ";return`\\
`}function LL(t,e){const n=String(t);let i=n.indexOf(e),r=i,s=0,o=0;if(typeof e!="string")throw new TypeError("Expected substring");for(;i!==-1;)i===r?++s>o&&(o=s):s=1,r=i+e.length,i=n.indexOf(e,r);return o}function rK(t,e){return!!(e.options.fences===!1&&t.value&&!t.lang&&/[^ \r\n]/.test(t.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(t.value))}function sK(t){const e=t.options.fence||"`";if(e!=="`"&&e!=="~")throw new Error("Cannot serialize code with `"+e+"` for `options.fence`, expected `` ` `` or `~`");return e}function oK(t,e,n,i){const r=sK(n),s=t.value||"",o=r==="`"?"GraveAccent":"Tilde";if(rK(t,n)){const d=n.enter("codeIndented"),f=n.indentLines(s,aK);return d(),f}const a=n.createTracker(i),l=r.repeat(Math.max(LL(s,r)+1,3)),u=n.enter("codeFenced");let c=a.move(l);if(t.lang){const d=n.enter(`codeFencedLang${o}`);c+=a.move(n.safe(t.lang,{before:c,after:" ",encode:["`"],...a.current()})),d()}if(t.lang&&t.meta){const d=n.enter(`codeFencedMeta${o}`);c+=a.move(" "),c+=a.move(n.safe(t.meta,{before:c,after:`
`,encode:["`"],...a.current()})),d()}return c+=a.move(`
`),s&&(c+=a.move(s+`
`)),c+=a.move(l),u(),c}function aK(t,e,n){return(n?"":"    ")+t}function uv(t){const e=t.options.quote||'"';if(e!=='"'&&e!=="'")throw new Error("Cannot serialize title with `"+e+"` for `options.quote`, expected `\"`, or `'`");return e}function lK(t,e,n,i){const r=uv(n),s=r==='"'?"Quote":"Apostrophe",o=n.enter("definition");let a=n.enter("label");const l=n.createTracker(i);let u=l.move("[");return u+=l.move(n.safe(n.associationId(t),{before:u,after:"]",...l.current()})),u+=l.move("]: "),a(),!t.url||/[\0- \u007F]/.test(t.url)?(a=n.enter("destinationLiteral"),u+=l.move("<"),u+=l.move(n.safe(t.url,{before:u,after:">",...l.current()})),u+=l.move(">")):(a=n.enter("destinationRaw"),u+=l.move(n.safe(t.url,{before:u,after:t.title?" ":`
`,...l.current()}))),a(),t.title&&(a=n.enter(`title${s}`),u+=l.move(" "+r),u+=l.move(n.safe(t.title,{before:u,after:r,...l.current()})),u+=l.move(r),a()),o(),u}function uK(t){const e=t.options.emphasis||"*";if(e!=="*"&&e!=="_")throw new Error("Cannot serialize emphasis with `"+e+"` for `options.emphasis`, expected `*`, or `_`");return e}function Hc(t){return"&#x"+t.toString(16).toUpperCase()+";"}function cK(t){return t!==null&&(t<0||t===32)}const dK=PL(new RegExp("\\p{P}|\\p{S}","u")),fK=PL(/\s/);function PL(t){return e;function e(n){return n!==null&&n>-1&&t.test(String.fromCharCode(n))}}function kL(t){if(t===null||cK(t)||fK(t))return 1;if(dK(t))return 2}function Bh(t,e,n){const i=kL(t),r=kL(e);return i===void 0?r===void 0?n==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:r===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:i===1?r===void 0?{inside:!1,outside:!1}:r===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:r===void 0?{inside:!1,outside:!1}:r===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}DL.peek=hK;function DL(t,e,n,i){const r=uK(n),s=n.enter("emphasis"),o=n.createTracker(i),a=o.move(r);let l=o.move(n.containerPhrasing(t,{after:r,before:a,...o.current()}));const u=l.charCodeAt(0),c=Bh(i.before.charCodeAt(i.before.length-1),u,r);c.inside&&(l=Hc(u)+l.slice(1));const d=l.charCodeAt(l.length-1),f=Bh(i.after.charCodeAt(0),d,r);f.inside&&(l=l.slice(0,-1)+Hc(d));const h=o.move(r);return s(),n.attentionEncodeSurroundingInfo={after:f.outside,before:c.outside},a+l+h}function hK(t,e,n){return n.options.emphasis||"*"}const pK={};function OL(t,e){const n=pK,i=typeof n.includeImageAlt=="boolean"?n.includeImageAlt:!0,r=typeof n.includeHtml=="boolean"?n.includeHtml:!0;return NL(t,i,r)}function NL(t,e,n){if(mK(t)){if("value"in t)return t.type==="html"&&!n?"":t.value;if(e&&"alt"in t&&t.alt)return t.alt;if("children"in t)return ML(t.children,e,n)}return Array.isArray(t)?ML(t,e,n):""}function ML(t,e,n){const i=[];let r=-1;for(;++r<t.length;)i[r]=NL(t[r],e,n);return i.join("")}function mK(t){return!!(t&&typeof t=="object")}function gK(t,e){let n=!1;return Dh(t,function(i){if("value"in i&&/\r?\n|\r/.test(i.value)||i.type==="break")return n=!0,kh}),!!((!t.depth||t.depth<3)&&OL(t)&&(e.options.setext||n))}function yK(t,e,n,i){const r=Math.max(Math.min(6,t.depth||1),1),s=n.createTracker(i);if(gK(t,n)){const c=n.enter("headingSetext"),d=n.enter("phrasing"),f=n.containerPhrasing(t,{...s.current(),before:`
`,after:`
`});return d(),c(),f+`
`+(r===1?"=":"-").repeat(f.length-(Math.max(f.lastIndexOf("\r"),f.lastIndexOf(`
`))+1))}const o="#".repeat(r),a=n.enter("headingAtx"),l=n.enter("phrasing");s.move(o+" ");let u=n.containerPhrasing(t,{before:"# ",after:`
`,...s.current()});return/^[\t ]/.test(u)&&(u=Hc(u.charCodeAt(0))+u.slice(1)),u=u?o+" "+u:o,n.options.closeAtx&&(u+=" "+o),l(),a(),u}FL.peek=vK;function FL(t){return t.value||""}function vK(){return"<"}BL.peek=bK;function BL(t,e,n,i){const r=uv(n),s=r==='"'?"Quote":"Apostrophe",o=n.enter("image");let a=n.enter("label");const l=n.createTracker(i);let u=l.move("![");return u+=l.move(n.safe(t.alt,{before:u,after:"]",...l.current()})),u+=l.move("]("),a(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(a=n.enter("destinationLiteral"),u+=l.move("<"),u+=l.move(n.safe(t.url,{before:u,after:">",...l.current()})),u+=l.move(">")):(a=n.enter("destinationRaw"),u+=l.move(n.safe(t.url,{before:u,after:t.title?" ":")",...l.current()}))),a(),t.title&&(a=n.enter(`title${s}`),u+=l.move(" "+r),u+=l.move(n.safe(t.title,{before:u,after:r,...l.current()})),u+=l.move(r),a()),u+=l.move(")"),o(),u}function bK(){return"!"}UL.peek=EK;function UL(t,e,n,i){const r=t.referenceType,s=n.enter("imageReference");let o=n.enter("label");const a=n.createTracker(i);let l=a.move("![");const u=n.safe(t.alt,{before:l,after:"]",...a.current()});l+=a.move(u+"]["),o();const c=n.stack;n.stack=[],o=n.enter("reference");const d=n.safe(n.associationId(t),{before:l,after:"]",...a.current()});return o(),n.stack=c,s(),r==="full"||!u||u!==d?l+=a.move(d+"]"):r==="shortcut"?l=l.slice(0,-1):l+=a.move("]"),l}function EK(){return"!"}HL.peek=TK;function HL(t,e,n){let i=t.value||"",r="`",s=-1;for(;new RegExp("(^|[^`])"+r+"([^`]|$)").test(i);)r+="`";for(/[^ \r\n]/.test(i)&&(/^[ \r\n]/.test(i)&&/[ \r\n]$/.test(i)||/^`|`$/.test(i))&&(i=" "+i+" ");++s<n.unsafe.length;){const o=n.unsafe[s],a=n.compilePattern(o);let l;if(o.atBreak)for(;l=a.exec(i);){let u=l.index;i.charCodeAt(u)===10&&i.charCodeAt(u-1)===13&&u--,i=i.slice(0,u)+" "+i.slice(l.index+1)}}return r+i+r}function TK(){return"`"}function $L(t,e){const n=OL(t);return!!(!e.options.resourceLink&&t.url&&!t.title&&t.children&&t.children.length===1&&t.children[0].type==="text"&&(n===t.url||"mailto:"+n===t.url)&&/^[a-z][a-z+.-]+:/i.test(t.url)&&!/[\0- <>\u007F]/.test(t.url))}zL.peek=SK;function zL(t,e,n,i){const r=uv(n),s=r==='"'?"Quote":"Apostrophe",o=n.createTracker(i);let a,l;if($L(t,n)){const c=n.stack;n.stack=[],a=n.enter("autolink");let d=o.move("<");return d+=o.move(n.containerPhrasing(t,{before:d,after:">",...o.current()})),d+=o.move(">"),a(),n.stack=c,d}a=n.enter("link"),l=n.enter("label");let u=o.move("[");return u+=o.move(n.containerPhrasing(t,{before:u,after:"](",...o.current()})),u+=o.move("]("),l(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(l=n.enter("destinationLiteral"),u+=o.move("<"),u+=o.move(n.safe(t.url,{before:u,after:">",...o.current()})),u+=o.move(">")):(l=n.enter("destinationRaw"),u+=o.move(n.safe(t.url,{before:u,after:t.title?" ":")",...o.current()}))),l(),t.title&&(l=n.enter(`title${s}`),u+=o.move(" "+r),u+=o.move(n.safe(t.title,{before:u,after:r,...o.current()})),u+=o.move(r),l()),u+=o.move(")"),a(),u}function SK(t,e,n){return $L(t,n)?"<":"["}VL.peek=xK;function VL(t,e,n,i){const r=t.referenceType,s=n.enter("linkReference");let o=n.enter("label");const a=n.createTracker(i);let l=a.move("[");const u=n.containerPhrasing(t,{before:l,after:"]",...a.current()});l+=a.move(u+"]["),o();const c=n.stack;n.stack=[],o=n.enter("reference");const d=n.safe(n.associationId(t),{before:l,after:"]",...a.current()});return o(),n.stack=c,s(),r==="full"||!u||u!==d?l+=a.move(d+"]"):r==="shortcut"?l=l.slice(0,-1):l+=a.move("]"),l}function xK(){return"["}function cv(t){const e=t.options.bullet||"*";if(e!=="*"&&e!=="+"&&e!=="-")throw new Error("Cannot serialize items with `"+e+"` for `options.bullet`, expected `*`, `+`, or `-`");return e}function wK(t){const e=cv(t),n=t.options.bulletOther;if(!n)return e==="*"?"-":"*";if(n!=="*"&&n!=="+"&&n!=="-")throw new Error("Cannot serialize items with `"+n+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(n===e)throw new Error("Expected `bullet` (`"+e+"`) and `bulletOther` (`"+n+"`) to be different");return n}function _K(t){const e=t.options.bulletOrdered||".";if(e!=="."&&e!==")")throw new Error("Cannot serialize items with `"+e+"` for `options.bulletOrdered`, expected `.` or `)`");return e}function GL(t){const e=t.options.rule||"*";if(e!=="*"&&e!=="-"&&e!=="_")throw new Error("Cannot serialize rules with `"+e+"` for `options.rule`, expected `*`, `-`, or `_`");return e}function AK(t,e,n,i){const r=n.enter("list"),s=n.bulletCurrent;let o=t.ordered?_K(n):cv(n);const a=t.ordered?o==="."?")":".":wK(n);let l=e&&n.bulletLastUsed?o===n.bulletLastUsed:!1;if(!t.ordered){const c=t.children?t.children[0]:void 0;if((o==="*"||o==="-")&&c&&(!c.children||!c.children[0])&&n.stack[n.stack.length-1]==="list"&&n.stack[n.stack.length-2]==="listItem"&&n.stack[n.stack.length-3]==="list"&&n.stack[n.stack.length-4]==="listItem"&&n.indexStack[n.indexStack.length-1]===0&&n.indexStack[n.indexStack.length-2]===0&&n.indexStack[n.indexStack.length-3]===0&&(l=!0),GL(n)===o&&c){let d=-1;for(;++d<t.children.length;){const f=t.children[d];if(f&&f.type==="listItem"&&f.children&&f.children[0]&&f.children[0].type==="thematicBreak"){l=!0;break}}}}l&&(o=a),n.bulletCurrent=o;const u=n.containerFlow(t,i);return n.bulletLastUsed=o,n.bulletCurrent=s,r(),u}function CK(t){const e=t.options.listItemIndent||"one";if(e!=="tab"&&e!=="one"&&e!=="mixed")throw new Error("Cannot serialize items with `"+e+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return e}function IK(t,e,n,i){const r=CK(n);let s=n.bulletCurrent||cv(n);e&&e.type==="list"&&e.ordered&&(s=(typeof e.start=="number"&&e.start>-1?e.start:1)+(n.options.incrementListMarker===!1?0:e.children.indexOf(t))+s);let o=s.length+1;(r==="tab"||r==="mixed"&&(e&&e.type==="list"&&e.spread||t.spread))&&(o=Math.ceil(o/4)*4);const a=n.createTracker(i);a.move(s+" ".repeat(o-s.length)),a.shift(o);const l=n.enter("listItem"),u=n.indentLines(n.containerFlow(t,a.current()),c);return l(),u;function c(d,f,h){return f?(h?"":" ".repeat(o))+d:(h?s:s+" ".repeat(o-s.length))+d}}function RK(t,e,n,i){const r=n.enter("paragraph"),s=n.enter("phrasing"),o=n.containerPhrasing(t,i);return s(),r(),o}const jL=function(t){if(t==null)return DK;if(typeof t=="function")return Uh(t);if(typeof t=="object")return Array.isArray(t)?LK(t):PK(t);if(typeof t=="string")return kK(t);throw new Error("Expected function, string, or object as test")};function LK(t){const e=[];let n=-1;for(;++n<t.length;)e[n]=jL(t[n]);return Uh(i);function i(...r){let s=-1;for(;++s<e.length;)if(e[s].apply(this,r))return!0;return!1}}function PK(t){const e=t;return Uh(n);function n(i){const r=i;let s;for(s in t)if(r[s]!==e[s])return!1;return!0}}function kK(t){return Uh(e);function e(n){return n&&n.type===t}}function Uh(t){return e;function e(n,i,r){return!!(OK(n)&&t.call(this,n,typeof i=="number"?i:void 0,r||void 0))}}function DK(){return!0}function OK(t){return t!==null&&typeof t=="object"&&"type"in t}const NK=jL(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function MK(t,e,n,i){return(t.children.some(function(o){return NK(o)})?n.containerPhrasing:n.containerFlow).call(n,t,i)}function FK(t){const e=t.options.strong||"*";if(e!=="*"&&e!=="_")throw new Error("Cannot serialize strong with `"+e+"` for `options.strong`, expected `*`, or `_`");return e}WL.peek=BK;function WL(t,e,n,i){const r=FK(n),s=n.enter("strong"),o=n.createTracker(i),a=o.move(r+r);let l=o.move(n.containerPhrasing(t,{after:r,before:a,...o.current()}));const u=l.charCodeAt(0),c=Bh(i.before.charCodeAt(i.before.length-1),u,r);c.inside&&(l=Hc(u)+l.slice(1));const d=l.charCodeAt(l.length-1),f=Bh(i.after.charCodeAt(0),d,r);f.inside&&(l=l.slice(0,-1)+Hc(d));const h=o.move(r+r);return s(),n.attentionEncodeSurroundingInfo={after:f.outside,before:c.outside},a+l+h}function BK(t,e,n){return n.options.strong||"*"}function UK(t,e,n,i){return n.safe(t.value,i)}function HK(t){const e=t.options.ruleRepetition||3;if(e<3)throw new Error("Cannot serialize rules with repetition `"+e+"` for `options.ruleRepetition`, expected `3` or more");return e}function $K(t,e,n){const i=(GL(n)+(n.options.ruleSpaces?" ":"")).repeat(HK(n));return n.options.ruleSpaces?i.slice(0,-1):i}const zK={blockquote:tK,break:RL,code:oK,definition:lK,emphasis:DL,hardBreak:RL,heading:yK,html:FL,image:BL,imageReference:UL,inlineCode:HL,link:zL,linkReference:VL,list:AK,listItem:IK,paragraph:RK,root:MK,strong:WL,text:UK,thematicBreak:$K},qL=document.createElement("i");function dv(t){const e="&"+t+";";qL.innerHTML=e;const n=qL.textContent;return n.charCodeAt(n.length-1)===59&&t!=="semi"||n===e?!1:n}function VK(){return{enter:{table:GK,tableData:KL,tableHeader:KL,tableRow:WK},exit:{codeText:qK,table:jK,tableData:fv,tableHeader:fv,tableRow:fv}}}function GK(t){const e=t._align;this.enter({type:"table",align:e.map(function(n){return n==="none"?null:n}),children:[]},t),this.data.inTable=!0}function jK(t){this.exit(t),this.data.inTable=void 0}function WK(t){this.enter({type:"tableRow",children:[]},t)}function fv(t){this.exit(t)}function KL(t){this.enter({type:"tableCell",children:[]},t)}function qK(t){let e=this.resume();this.data.inTable&&(e=e.replace(/\\([\\|])/g,KK));const n=this.stack[this.stack.length-1];n.type,n.value=e,this.exit(t)}function KK(t,e){return e==="|"?e:t}function YK(t){const e=t||{},n=e.tableCellPadding,i=e.tablePipeAlign,r=e.stringLength,s=n?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:`
`,inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[	 :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{inlineCode:f,table:o,tableCell:l,tableRow:a}};function o(h,p,m,y){return u(c(h,m,y),h.align)}function a(h,p,m,y){const g=d(h,m,y),v=u([g]);return v.slice(0,v.indexOf(`
`))}function l(h,p,m,y){const g=m.enter("tableCell"),v=m.enter("phrasing"),b=m.containerPhrasing(h,{...y,before:s,after:s});return v(),g(),b}function u(h,p){return Jq(h,{align:p,alignDelimiters:i,padding:n,stringLength:r})}function c(h,p,m){const y=h.children;let g=-1;const v=[],b=p.enter("table");for(;++g<y.length;)v[g]=d(y[g],p,m);return b(),v}function d(h,p,m){const y=h.children;let g=-1;const v=[],b=p.enter("tableRow");for(;++g<y.length;)v[g]=l(y[g],h,p,m);return b(),v}function f(h,p,m){let y=zK.inlineCode(h,p,m);return m.stack.includes("tableCell")&&(y=y.replace(/\|/g,"\\$&")),y}}function XK(t,e,n,i){const r=n.enter("blockquote"),s=n.createTracker(i);s.move("> "),s.shift(2);const o=n.indentLines(n.containerFlow(t,s.current()),QK);return r(),o}function QK(t,e,n){return">"+(n?"":" ")+t}function ZK(t,e){return YL(t,e.inConstruct,!0)&&!YL(t,e.notInConstruct,!1)}function YL(t,e,n){if(typeof e=="string"&&(e=[e]),!e||e.length===0)return n;let i=-1;for(;++i<e.length;)if(t.includes(e[i]))return!0;return!1}function XL(t,e,n,i){let r=-1;for(;++r<n.unsafe.length;)if(n.unsafe[r].character===`
`&&ZK(n.stack,n.unsafe[r]))return/[ \t]/.test(i.before)?"":" ";return`\\
`}function JK(t,e){return!!(e.options.fences===!1&&t.value&&!t.lang&&/[^ \r\n]/.test(t.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(t.value))}function eY(t){const e=t.options.fence||"`";if(e!=="`"&&e!=="~")throw new Error("Cannot serialize code with `"+e+"` for `options.fence`, expected `` ` `` or `~`");return e}function tY(t,e,n,i){const r=eY(n),s=t.value||"",o=r==="`"?"GraveAccent":"Tilde";if(JK(t,n)){const d=n.enter("codeIndented"),f=n.indentLines(s,nY);return d(),f}const a=n.createTracker(i),l=r.repeat(Math.max(LL(s,r)+1,3)),u=n.enter("codeFenced");let c=a.move(l);if(t.lang){const d=n.enter(`codeFencedLang${o}`);c+=a.move(n.safe(t.lang,{before:c,after:" ",encode:["`"],...a.current()})),d()}if(t.lang&&t.meta){const d=n.enter(`codeFencedMeta${o}`);c+=a.move(" "),c+=a.move(n.safe(t.meta,{before:c,after:`
`,encode:["`"],...a.current()})),d()}return c+=a.move(`
`),s&&(c+=a.move(s+`
`)),c+=a.move(l),u(),c}function nY(t,e,n){return(n?"":"    ")+t}function hv(t){const e=t.options.quote||'"';if(e!=='"'&&e!=="'")throw new Error("Cannot serialize title with `"+e+"` for `options.quote`, expected `\"`, or `'`");return e}function iY(t,e,n,i){const r=hv(n),s=r==='"'?"Quote":"Apostrophe",o=n.enter("definition");let a=n.enter("label");const l=n.createTracker(i);let u=l.move("[");return u+=l.move(n.safe(n.associationId(t),{before:u,after:"]",...l.current()})),u+=l.move("]: "),a(),!t.url||/[\0- \u007F]/.test(t.url)?(a=n.enter("destinationLiteral"),u+=l.move("<"),u+=l.move(n.safe(t.url,{before:u,after:">",...l.current()})),u+=l.move(">")):(a=n.enter("destinationRaw"),u+=l.move(n.safe(t.url,{before:u,after:t.title?" ":`
`,...l.current()}))),a(),t.title&&(a=n.enter(`title${s}`),u+=l.move(" "+r),u+=l.move(n.safe(t.title,{before:u,after:r,...l.current()})),u+=l.move(r),a()),o(),u}function rY(t){const e=t.options.emphasis||"*";if(e!=="*"&&e!=="_")throw new Error("Cannot serialize emphasis with `"+e+"` for `options.emphasis`, expected `*`, or `_`");return e}function $c(t){return"&#x"+t.toString(16).toUpperCase()+";"}function sY(t){return t!==null&&(t<0||t===32)}const oY=QL(new RegExp("\\p{P}|\\p{S}","u")),aY=QL(/\s/);function QL(t){return e;function e(n){return n!==null&&n>-1&&t.test(String.fromCharCode(n))}}function ZL(t){if(t===null||sY(t)||aY(t))return 1;if(oY(t))return 2}function Hh(t,e,n){const i=ZL(t),r=ZL(e);return i===void 0?r===void 0?n==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:r===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:i===1?r===void 0?{inside:!1,outside:!1}:r===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:r===void 0?{inside:!1,outside:!1}:r===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}JL.peek=lY;function JL(t,e,n,i){const r=rY(n),s=n.enter("emphasis"),o=n.createTracker(i),a=o.move(r);let l=o.move(n.containerPhrasing(t,{after:r,before:a,...o.current()}));const u=l.charCodeAt(0),c=Hh(i.before.charCodeAt(i.before.length-1),u,r);c.inside&&(l=$c(u)+l.slice(1));const d=l.charCodeAt(l.length-1),f=Hh(i.after.charCodeAt(0),d,r);f.inside&&(l=l.slice(0,-1)+$c(d));const h=o.move(r);return s(),n.attentionEncodeSurroundingInfo={after:f.outside,before:c.outside},a+l+h}function lY(t,e,n){return n.options.emphasis||"*"}const uY={};function eP(t,e){const n=uY,i=typeof n.includeImageAlt=="boolean"?n.includeImageAlt:!0,r=typeof n.includeHtml=="boolean"?n.includeHtml:!0;return tP(t,i,r)}function tP(t,e,n){if(cY(t)){if("value"in t)return t.type==="html"&&!n?"":t.value;if(e&&"alt"in t&&t.alt)return t.alt;if("children"in t)return nP(t.children,e,n)}return Array.isArray(t)?nP(t,e,n):""}function nP(t,e,n){const i=[];let r=-1;for(;++r<t.length;)i[r]=tP(t[r],e,n);return i.join("")}function cY(t){return!!(t&&typeof t=="object")}function dY(t,e){let n=!1;return Dh(t,function(i){if("value"in i&&/\r?\n|\r/.test(i.value)||i.type==="break")return n=!0,kh}),!!((!t.depth||t.depth<3)&&eP(t)&&(e.options.setext||n))}function fY(t,e,n,i){const r=Math.max(Math.min(6,t.depth||1),1),s=n.createTracker(i);if(dY(t,n)){const c=n.enter("headingSetext"),d=n.enter("phrasing"),f=n.containerPhrasing(t,{...s.current(),before:`
`,after:`
`});return d(),c(),f+`
`+(r===1?"=":"-").repeat(f.length-(Math.max(f.lastIndexOf("\r"),f.lastIndexOf(`
`))+1))}const o="#".repeat(r),a=n.enter("headingAtx"),l=n.enter("phrasing");s.move(o+" ");let u=n.containerPhrasing(t,{before:"# ",after:`
`,...s.current()});return/^[\t ]/.test(u)&&(u=$c(u.charCodeAt(0))+u.slice(1)),u=u?o+" "+u:o,n.options.closeAtx&&(u+=" "+o),l(),a(),u}iP.peek=hY;function iP(t){return t.value||""}function hY(){return"<"}rP.peek=pY;function rP(t,e,n,i){const r=hv(n),s=r==='"'?"Quote":"Apostrophe",o=n.enter("image");let a=n.enter("label");const l=n.createTracker(i);let u=l.move("![");return u+=l.move(n.safe(t.alt,{before:u,after:"]",...l.current()})),u+=l.move("]("),a(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(a=n.enter("destinationLiteral"),u+=l.move("<"),u+=l.move(n.safe(t.url,{before:u,after:">",...l.current()})),u+=l.move(">")):(a=n.enter("destinationRaw"),u+=l.move(n.safe(t.url,{before:u,after:t.title?" ":")",...l.current()}))),a(),t.title&&(a=n.enter(`title${s}`),u+=l.move(" "+r),u+=l.move(n.safe(t.title,{before:u,after:r,...l.current()})),u+=l.move(r),a()),u+=l.move(")"),o(),u}function pY(){return"!"}sP.peek=mY;function sP(t,e,n,i){const r=t.referenceType,s=n.enter("imageReference");let o=n.enter("label");const a=n.createTracker(i);let l=a.move("![");const u=n.safe(t.alt,{before:l,after:"]",...a.current()});l+=a.move(u+"]["),o();const c=n.stack;n.stack=[],o=n.enter("reference");const d=n.safe(n.associationId(t),{before:l,after:"]",...a.current()});return o(),n.stack=c,s(),r==="full"||!u||u!==d?l+=a.move(d+"]"):r==="shortcut"?l=l.slice(0,-1):l+=a.move("]"),l}function mY(){return"!"}oP.peek=gY;function oP(t,e,n){let i=t.value||"",r="`",s=-1;for(;new RegExp("(^|[^`])"+r+"([^`]|$)").test(i);)r+="`";for(/[^ \r\n]/.test(i)&&(/^[ \r\n]/.test(i)&&/[ \r\n]$/.test(i)||/^`|`$/.test(i))&&(i=" "+i+" ");++s<n.unsafe.length;){const o=n.unsafe[s],a=n.compilePattern(o);let l;if(o.atBreak)for(;l=a.exec(i);){let u=l.index;i.charCodeAt(u)===10&&i.charCodeAt(u-1)===13&&u--,i=i.slice(0,u)+" "+i.slice(l.index+1)}}return r+i+r}function gY(){return"`"}function aP(t,e){const n=eP(t);return!!(!e.options.resourceLink&&t.url&&!t.title&&t.children&&t.children.length===1&&t.children[0].type==="text"&&(n===t.url||"mailto:"+n===t.url)&&/^[a-z][a-z+.-]+:/i.test(t.url)&&!/[\0- <>\u007F]/.test(t.url))}lP.peek=yY;function lP(t,e,n,i){const r=hv(n),s=r==='"'?"Quote":"Apostrophe",o=n.createTracker(i);let a,l;if(aP(t,n)){const c=n.stack;n.stack=[],a=n.enter("autolink");let d=o.move("<");return d+=o.move(n.containerPhrasing(t,{before:d,after:">",...o.current()})),d+=o.move(">"),a(),n.stack=c,d}a=n.enter("link"),l=n.enter("label");let u=o.move("[");return u+=o.move(n.containerPhrasing(t,{before:u,after:"](",...o.current()})),u+=o.move("]("),l(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(l=n.enter("destinationLiteral"),u+=o.move("<"),u+=o.move(n.safe(t.url,{before:u,after:">",...o.current()})),u+=o.move(">")):(l=n.enter("destinationRaw"),u+=o.move(n.safe(t.url,{before:u,after:t.title?" ":")",...o.current()}))),l(),t.title&&(l=n.enter(`title${s}`),u+=o.move(" "+r),u+=o.move(n.safe(t.title,{before:u,after:r,...o.current()})),u+=o.move(r),l()),u+=o.move(")"),a(),u}function yY(t,e,n){return aP(t,n)?"<":"["}uP.peek=vY;function uP(t,e,n,i){const r=t.referenceType,s=n.enter("linkReference");let o=n.enter("label");const a=n.createTracker(i);let l=a.move("[");const u=n.containerPhrasing(t,{before:l,after:"]",...a.current()});l+=a.move(u+"]["),o();const c=n.stack;n.stack=[],o=n.enter("reference");const d=n.safe(n.associationId(t),{before:l,after:"]",...a.current()});return o(),n.stack=c,s(),r==="full"||!u||u!==d?l+=a.move(d+"]"):r==="shortcut"?l=l.slice(0,-1):l+=a.move("]"),l}function vY(){return"["}function pv(t){const e=t.options.bullet||"*";if(e!=="*"&&e!=="+"&&e!=="-")throw new Error("Cannot serialize items with `"+e+"` for `options.bullet`, expected `*`, `+`, or `-`");return e}function bY(t){const e=pv(t),n=t.options.bulletOther;if(!n)return e==="*"?"-":"*";if(n!=="*"&&n!=="+"&&n!=="-")throw new Error("Cannot serialize items with `"+n+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(n===e)throw new Error("Expected `bullet` (`"+e+"`) and `bulletOther` (`"+n+"`) to be different");return n}function EY(t){const e=t.options.bulletOrdered||".";if(e!=="."&&e!==")")throw new Error("Cannot serialize items with `"+e+"` for `options.bulletOrdered`, expected `.` or `)`");return e}function cP(t){const e=t.options.rule||"*";if(e!=="*"&&e!=="-"&&e!=="_")throw new Error("Cannot serialize rules with `"+e+"` for `options.rule`, expected `*`, `-`, or `_`");return e}function TY(t,e,n,i){const r=n.enter("list"),s=n.bulletCurrent;let o=t.ordered?EY(n):pv(n);const a=t.ordered?o==="."?")":".":bY(n);let l=e&&n.bulletLastUsed?o===n.bulletLastUsed:!1;if(!t.ordered){const c=t.children?t.children[0]:void 0;if((o==="*"||o==="-")&&c&&(!c.children||!c.children[0])&&n.stack[n.stack.length-1]==="list"&&n.stack[n.stack.length-2]==="listItem"&&n.stack[n.stack.length-3]==="list"&&n.stack[n.stack.length-4]==="listItem"&&n.indexStack[n.indexStack.length-1]===0&&n.indexStack[n.indexStack.length-2]===0&&n.indexStack[n.indexStack.length-3]===0&&(l=!0),cP(n)===o&&c){let d=-1;for(;++d<t.children.length;){const f=t.children[d];if(f&&f.type==="listItem"&&f.children&&f.children[0]&&f.children[0].type==="thematicBreak"){l=!0;break}}}}l&&(o=a),n.bulletCurrent=o;const u=n.containerFlow(t,i);return n.bulletLastUsed=o,n.bulletCurrent=s,r(),u}function SY(t){const e=t.options.listItemIndent||"one";if(e!=="tab"&&e!=="one"&&e!=="mixed")throw new Error("Cannot serialize items with `"+e+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return e}function xY(t,e,n,i){const r=SY(n);let s=n.bulletCurrent||pv(n);e&&e.type==="list"&&e.ordered&&(s=(typeof e.start=="number"&&e.start>-1?e.start:1)+(n.options.incrementListMarker===!1?0:e.children.indexOf(t))+s);let o=s.length+1;(r==="tab"||r==="mixed"&&(e&&e.type==="list"&&e.spread||t.spread))&&(o=Math.ceil(o/4)*4);const a=n.createTracker(i);a.move(s+" ".repeat(o-s.length)),a.shift(o);const l=n.enter("listItem"),u=n.indentLines(n.containerFlow(t,a.current()),c);return l(),u;function c(d,f,h){return f?(h?"":" ".repeat(o))+d:(h?s:s+" ".repeat(o-s.length))+d}}function wY(t,e,n,i){const r=n.enter("paragraph"),s=n.enter("phrasing"),o=n.containerPhrasing(t,i);return s(),r(),o}const dP=function(t){if(t==null)return IY;if(typeof t=="function")return $h(t);if(typeof t=="object")return Array.isArray(t)?_Y(t):AY(t);if(typeof t=="string")return CY(t);throw new Error("Expected function, string, or object as test")};function _Y(t){const e=[];let n=-1;for(;++n<t.length;)e[n]=dP(t[n]);return $h(i);function i(...r){let s=-1;for(;++s<e.length;)if(e[s].apply(this,r))return!0;return!1}}function AY(t){const e=t;return $h(n);function n(i){const r=i;let s;for(s in t)if(r[s]!==e[s])return!1;return!0}}function CY(t){return $h(e);function e(n){return n&&n.type===t}}function $h(t){return e;function e(n,i,r){return!!(RY(n)&&t.call(this,n,typeof i=="number"?i:void 0,r||void 0))}}function IY(){return!0}function RY(t){return t!==null&&typeof t=="object"&&"type"in t}const LY=dP(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function PY(t,e,n,i){return(t.children.some(function(o){return LY(o)})?n.containerPhrasing:n.containerFlow).call(n,t,i)}function kY(t){const e=t.options.strong||"*";if(e!=="*"&&e!=="_")throw new Error("Cannot serialize strong with `"+e+"` for `options.strong`, expected `*`, or `_`");return e}fP.peek=DY;function fP(t,e,n,i){const r=kY(n),s=n.enter("strong"),o=n.createTracker(i),a=o.move(r+r);let l=o.move(n.containerPhrasing(t,{after:r,before:a,...o.current()}));const u=l.charCodeAt(0),c=Hh(i.before.charCodeAt(i.before.length-1),u,r);c.inside&&(l=$c(u)+l.slice(1));const d=l.charCodeAt(l.length-1),f=Hh(i.after.charCodeAt(0),d,r);f.inside&&(l=l.slice(0,-1)+$c(d));const h=o.move(r+r);return s(),n.attentionEncodeSurroundingInfo={after:f.outside,before:c.outside},a+l+h}function DY(t,e,n){return n.options.strong||"*"}function OY(t,e,n,i){return n.safe(t.value,i)}function NY(t){const e=t.options.ruleRepetition||3;if(e<3)throw new Error("Cannot serialize rules with repetition `"+e+"` for `options.ruleRepetition`, expected `3` or more");return e}function MY(t,e,n){const i=(cP(n)+(n.options.ruleSpaces?" ":"")).repeat(NY(n));return n.options.ruleSpaces?i.slice(0,-1):i}const FY={blockquote:XK,break:XL,code:tY,definition:iY,emphasis:JL,hardBreak:XL,heading:fY,html:iP,image:rP,imageReference:sP,inlineCode:oP,link:lP,linkReference:uP,list:TY,listItem:xY,paragraph:wY,root:PY,strong:fP,text:OY,thematicBreak:MY};function BY(){return{exit:{taskListCheckValueChecked:hP,taskListCheckValueUnchecked:hP,paragraph:HY}}}function UY(){return{unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:$Y}}}function hP(t){const e=this.stack[this.stack.length-2];e.type,e.checked=t.type==="taskListCheckValueChecked"}function HY(t){const e=this.stack[this.stack.length-2];if(e&&e.type==="listItem"&&typeof e.checked=="boolean"){const n=this.stack[this.stack.length-1];n.type;const i=n.children[0];if(i&&i.type==="text"){const r=e.children;let s=-1,o;for(;++s<r.length;){const a=r[s];if(a.type==="paragraph"){o=a;break}}o===n&&(i.value=i.value.slice(1),i.value.length===0?n.children.shift():n.position&&i.position&&typeof i.position.start.offset=="number"&&(i.position.start.column++,i.position.start.offset++,n.position.start=Object.assign({},i.position.start)))}}this.exit(t)}function $Y(t,e,n,i){const r=t.children[0],s=typeof t.checked=="boolean"&&r&&r.type==="paragraph",o="["+(t.checked?"x":" ")+"] ",a=n.createTracker(i);s&&a.move(o);let l=FY.listItem(t,e,n,{...i,...a.current()});return s&&(l=l.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,u)),l;function u(c){return c+o}}function zY(){return[Sq(),Vq(),qq(),VK(),BY()]}function VY(t){return{extensions:[xq(),Gq(t),Kq(),YK(t),UY()]}}function GY(t,e,n,i){const r=t.length;let s=0,o;if(e<0?e=-e>r?0:r+e:e=e>r?r:e,n=n>0?n:0,i.length<1e4)o=Array.from(i),o.unshift(e,n),t.splice(...o);else for(n&&t.splice(e,n);s<i.length;)o=i.slice(s,s+1e4),o.unshift(e,0),t.splice(...o),s+=1e4,e+=1e4}const pP={}.hasOwnProperty;function jY(t){const e={};let n=-1;for(;++n<t.length;)WY(e,t[n]);return e}function WY(t,e){let n;for(n in e){const r=(pP.call(t,n)?t[n]:void 0)||(t[n]={}),s=e[n];let o;if(s)for(o in s){pP.call(r,o)||(r[o]=[]);const a=s[o];qY(r[o],Array.isArray(a)?a:a?[a]:[])}}}function qY(t,e){let n=-1;const i=[];for(;++n<e.length;)(e[n].add==="after"?t:i).push(e[n]);GY(t,0,0,i)}const zc=zh(/[A-Za-z]/),mv=zh(/[\dA-Za-z]/);function KY(t){return t!==null&&(t<32||t===127)}function Cl(t){return t!==null&&(t<0||t===32)}const mP=zh(new RegExp("\\p{P}|\\p{S}","u")),Vc=zh(/\s/);function zh(t){return e;function e(n){return n!==null&&n>-1&&t.test(String.fromCharCode(n))}}const YY={tokenize:tX,partial:!0},gP={tokenize:nX,partial:!0},yP={tokenize:iX,partial:!0},vP={tokenize:rX,partial:!0},XY={tokenize:sX,partial:!0},bP={name:"wwwAutolink",tokenize:JY,previous:TP},EP={name:"protocolAutolink",tokenize:eX,previous:SP},as={name:"emailAutolink",tokenize:ZY,previous:xP},Er={};function QY(){return{text:Er}}let na=48;for(;na<123;)Er[na]=as,na++,na===58?na=65:na===91&&(na=97);Er[43]=as,Er[45]=as,Er[46]=as,Er[95]=as,Er[72]=[as,EP],Er[104]=[as,EP],Er[87]=[as,bP],Er[119]=[as,bP];function ZY(t,e,n){const i=this;let r,s;return o;function o(d){return!gv(d)||!xP.call(i,i.previous)||yv(i.events)?n(d):(t.enter("literalAutolink"),t.enter("literalAutolinkEmail"),a(d))}function a(d){return gv(d)?(t.consume(d),a):d===64?(t.consume(d),l):n(d)}function l(d){return d===46?t.check(XY,c,u)(d):d===45||d===95||mv(d)?(s=!0,t.consume(d),l):c(d)}function u(d){return t.consume(d),r=!0,l}function c(d){return s&&r&&zc(i.previous)?(t.exit("literalAutolinkEmail"),t.exit("literalAutolink"),e(d)):n(d)}}function JY(t,e,n){const i=this;return r;function r(o){return o!==87&&o!==119||!TP.call(i,i.previous)||yv(i.events)?n(o):(t.enter("literalAutolink"),t.enter("literalAutolinkWww"),t.check(YY,t.attempt(gP,t.attempt(yP,s),n),n)(o))}function s(o){return t.exit("literalAutolinkWww"),t.exit("literalAutolink"),e(o)}}function eX(t,e,n){const i=this;let r="",s=!1;return o;function o(d){return(d===72||d===104)&&SP.call(i,i.previous)&&!yv(i.events)?(t.enter("literalAutolink"),t.enter("literalAutolinkHttp"),r+=String.fromCodePoint(d),t.consume(d),a):n(d)}function a(d){if(zc(d)&&r.length<5)return r+=String.fromCodePoint(d),t.consume(d),a;if(d===58){const f=r.toLowerCase();if(f==="http"||f==="https")return t.consume(d),l}return n(d)}function l(d){return d===47?(t.consume(d),s?u:(s=!0,l)):n(d)}function u(d){return d===null||KY(d)||Cl(d)||Vc(d)||mP(d)?n(d):t.attempt(gP,t.attempt(yP,c),n)(d)}function c(d){return t.exit("literalAutolinkHttp"),t.exit("literalAutolink"),e(d)}}function tX(t,e,n){let i=0;return r;function r(o){return(o===87||o===119)&&i<3?(i++,t.consume(o),r):o===46&&i===3?(t.consume(o),s):n(o)}function s(o){return o===null?n(o):e(o)}}function nX(t,e,n){let i,r,s;return o;function o(u){return u===46||u===95?t.check(vP,l,a)(u):u===null||Cl(u)||Vc(u)||u!==45&&mP(u)?l(u):(s=!0,t.consume(u),o)}function a(u){return u===95?i=!0:(r=i,i=void 0),t.consume(u),o}function l(u){return r||i||!s?n(u):e(u)}}function iX(t,e){let n=0,i=0;return r;function r(o){return o===40?(n++,t.consume(o),r):o===41&&i<n?s(o):o===33||o===34||o===38||o===39||o===41||o===42||o===44||o===46||o===58||o===59||o===60||o===63||o===93||o===95||o===126?t.check(vP,e,s)(o):o===null||Cl(o)||Vc(o)?e(o):(t.consume(o),r)}function s(o){return o===41&&i++,t.consume(o),r}}function rX(t,e,n){return i;function i(a){return a===33||a===34||a===39||a===41||a===42||a===44||a===46||a===58||a===59||a===63||a===95||a===126?(t.consume(a),i):a===38?(t.consume(a),s):a===93?(t.consume(a),r):a===60||a===null||Cl(a)||Vc(a)?e(a):n(a)}function r(a){return a===null||a===40||a===91||Cl(a)||Vc(a)?e(a):i(a)}function s(a){return zc(a)?o(a):n(a)}function o(a){return a===59?(t.consume(a),i):zc(a)?(t.consume(a),o):n(a)}}function sX(t,e,n){return i;function i(s){return t.consume(s),r}function r(s){return mv(s)?n(s):e(s)}}function TP(t){return t===null||t===40||t===42||t===95||t===91||t===93||t===126||Cl(t)}function SP(t){return!zc(t)}function xP(t){return!(t===47||gv(t))}function gv(t){return t===43||t===45||t===46||t===95||mv(t)}function yv(t){let e=t.length,n=!1;for(;e--;){const i=t[e][1];if((i.type==="labelLink"||i.type==="labelImage")&&!i._balanced){n=!0;break}if(i._gfmAutolinkLiteralWalkedInto){n=!1;break}}return t.length>0&&!n&&(t[t.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),n}function oX(t){return t!==null&&t<-2}function Vh(t){return t!==null&&(t<0||t===32)}function vv(t){return t===-2||t===-1||t===32}function bv(t,e,n,i){const r=i?i-1:Number.POSITIVE_INFINITY;let s=0;return o;function o(l){return vv(l)?(t.enter(n),a(l)):e(l)}function a(l){return vv(l)&&s++<r?(t.consume(l),a):(t.exit(n),e(l))}}const aX={partial:!0,tokenize:lX};function lX(t,e,n){return i;function i(s){return vv(s)?bv(t,r,"linePrefix")(s):r(s)}function r(s){return s===null||oX(s)?e(s):n(s)}}function Ev(t){return t.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const uX={tokenize:yX,partial:!0};function cX(){return{document:{91:{name:"gfmFootnoteDefinition",tokenize:pX,continuation:{tokenize:mX},exit:gX}},text:{91:{name:"gfmFootnoteCall",tokenize:hX},93:{name:"gfmPotentialFootnoteCall",add:"after",tokenize:dX,resolveTo:fX}}}}function dX(t,e,n){const i=this;let r=i.events.length;const s=i.parser.gfmFootnotes||(i.parser.gfmFootnotes=[]);let o;for(;r--;){const l=i.events[r][1];if(l.type==="labelImage"){o=l;break}if(l.type==="gfmFootnoteCall"||l.type==="labelLink"||l.type==="label"||l.type==="image"||l.type==="link")break}return a;function a(l){if(!o||!o._balanced)return n(l);const u=Ev(i.sliceSerialize({start:o.end,end:i.now()}));return u.codePointAt(0)!==94||!s.includes(u.slice(1))?n(l):(t.enter("gfmFootnoteCallLabelMarker"),t.consume(l),t.exit("gfmFootnoteCallLabelMarker"),e(l))}}function fX(t,e){let n=t.length;for(;n--;)if(t[n][1].type==="labelImage"&&t[n][0]==="enter"){t[n][1];break}t[n+1][1].type="data",t[n+3][1].type="gfmFootnoteCallLabelMarker";const i={type:"gfmFootnoteCall",start:Object.assign({},t[n+3][1].start),end:Object.assign({},t[t.length-1][1].end)},r={type:"gfmFootnoteCallMarker",start:Object.assign({},t[n+3][1].end),end:Object.assign({},t[n+3][1].end)};r.end.column++,r.end.offset++,r.end._bufferIndex++;const s={type:"gfmFootnoteCallString",start:Object.assign({},r.end),end:Object.assign({},t[t.length-1][1].start)},o={type:"chunkString",contentType:"string",start:Object.assign({},s.start),end:Object.assign({},s.end)},a=[t[n+1],t[n+2],["enter",i,e],t[n+3],t[n+4],["enter",r,e],["exit",r,e],["enter",s,e],["enter",o,e],["exit",o,e],["exit",s,e],t[t.length-2],t[t.length-1],["exit",i,e]];return t.splice(n,t.length-n+1,...a),t}function hX(t,e,n){const i=this,r=i.parser.gfmFootnotes||(i.parser.gfmFootnotes=[]);let s=0,o;return a;function a(d){return t.enter("gfmFootnoteCall"),t.enter("gfmFootnoteCallLabelMarker"),t.consume(d),t.exit("gfmFootnoteCallLabelMarker"),l}function l(d){return d!==94?n(d):(t.enter("gfmFootnoteCallMarker"),t.consume(d),t.exit("gfmFootnoteCallMarker"),t.enter("gfmFootnoteCallString"),t.enter("chunkString").contentType="string",u)}function u(d){if(s>999||d===93&&!o||d===null||d===91||Vh(d))return n(d);if(d===93){t.exit("chunkString");const f=t.exit("gfmFootnoteCallString");return r.includes(Ev(i.sliceSerialize(f)))?(t.enter("gfmFootnoteCallLabelMarker"),t.consume(d),t.exit("gfmFootnoteCallLabelMarker"),t.exit("gfmFootnoteCall"),e):n(d)}return Vh(d)||(o=!0),s++,t.consume(d),d===92?c:u}function c(d){return d===91||d===92||d===93?(t.consume(d),s++,u):u(d)}}function pX(t,e,n){const i=this,r=i.parser.gfmFootnotes||(i.parser.gfmFootnotes=[]);let s,o=0,a;return l;function l(p){return t.enter("gfmFootnoteDefinition")._container=!0,t.enter("gfmFootnoteDefinitionLabel"),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(p),t.exit("gfmFootnoteDefinitionLabelMarker"),u}function u(p){return p===94?(t.enter("gfmFootnoteDefinitionMarker"),t.consume(p),t.exit("gfmFootnoteDefinitionMarker"),t.enter("gfmFootnoteDefinitionLabelString"),t.enter("chunkString").contentType="string",c):n(p)}function c(p){if(o>999||p===93&&!a||p===null||p===91||Vh(p))return n(p);if(p===93){t.exit("chunkString");const m=t.exit("gfmFootnoteDefinitionLabelString");return s=Ev(i.sliceSerialize(m)),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(p),t.exit("gfmFootnoteDefinitionLabelMarker"),t.exit("gfmFootnoteDefinitionLabel"),f}return Vh(p)||(a=!0),o++,t.consume(p),p===92?d:c}function d(p){return p===91||p===92||p===93?(t.consume(p),o++,c):c(p)}function f(p){return p===58?(t.enter("definitionMarker"),t.consume(p),t.exit("definitionMarker"),r.includes(s)||r.push(s),bv(t,h,"gfmFootnoteDefinitionWhitespace")):n(p)}function h(p){return e(p)}}function mX(t,e,n){return t.check(aX,e,t.attempt(uX,e,n))}function gX(t){t.exit("gfmFootnoteDefinition")}function yX(t,e,n){const i=this;return bv(t,r,"gfmFootnoteDefinitionIndent",5);function r(s){const o=i.events[i.events.length-1];return o&&o[1].type==="gfmFootnoteDefinitionIndent"&&o[2].sliceSerialize(o[1],!0).length===4?e(s):n(s)}}function Tv(t,e,n,i){const r=t.length;let s=0,o;if(e<0?e=-e>r?0:r+e:e=e>r?r:e,n=n>0?n:0,i.length<1e4)o=Array.from(i),o.unshift(e,n),t.splice(...o);else for(n&&t.splice(e,n);s<i.length;)o=i.slice(s,s+1e4),o.unshift(e,0),t.splice(...o),s+=1e4,e+=1e4}function vX(t){return t!==null&&(t<0||t===32)}const bX=wP(new RegExp("\\p{P}|\\p{S}","u")),EX=wP(/\s/);function wP(t){return e;function e(n){return n!==null&&n>-1&&t.test(String.fromCharCode(n))}}function _P(t){if(t===null||vX(t)||EX(t))return 1;if(bX(t))return 2}function TX(t,e,n){const i=[];let r=-1;for(;++r<t.length;){const s=t[r].resolveAll;s&&!i.includes(s)&&(e=s(e,n),i.push(s))}return e}function SX(t){let n=(t||{}).singleTilde;const i={name:"strikethrough",tokenize:s,resolveAll:r};return n==null&&(n=!0),{text:{126:i},insideSpan:{null:[i]},attentionMarkers:{null:[126]}};function r(o,a){let l=-1;for(;++l<o.length;)if(o[l][0]==="enter"&&o[l][1].type==="strikethroughSequenceTemporary"&&o[l][1]._close){let u=l;for(;u--;)if(o[u][0]==="exit"&&o[u][1].type==="strikethroughSequenceTemporary"&&o[u][1]._open&&o[l][1].end.offset-o[l][1].start.offset===o[u][1].end.offset-o[u][1].start.offset){o[l][1].type="strikethroughSequence",o[u][1].type="strikethroughSequence";const c={type:"strikethrough",start:Object.assign({},o[u][1].start),end:Object.assign({},o[l][1].end)},d={type:"strikethroughText",start:Object.assign({},o[u][1].end),end:Object.assign({},o[l][1].start)},f=[["enter",c,a],["enter",o[u][1],a],["exit",o[u][1],a],["enter",d,a]],h=a.parser.constructs.insideSpan.null;h&&Tv(f,f.length,0,TX(h,o.slice(u+1,l),a)),Tv(f,f.length,0,[["exit",d,a],["enter",o[l][1],a],["exit",o[l][1],a],["exit",c,a]]),Tv(o,u-1,l-u+3,f),l=u+f.length-2;break}}for(l=-1;++l<o.length;)o[l][1].type==="strikethroughSequenceTemporary"&&(o[l][1].type="data");return o}function s(o,a,l){const u=this.previous,c=this.events;let d=0;return f;function f(p){return u===126&&c[c.length-1][1].type!=="characterEscape"?l(p):(o.enter("strikethroughSequenceTemporary"),h(p))}function h(p){const m=_P(u);if(p===126)return d>1?l(p):(o.consume(p),d++,h);if(d<2&&!n)return l(p);const y=o.exit("strikethroughSequenceTemporary"),g=_P(p);return y._open=!g||g===2&&!!m,y._close=!m||m===2&&!!g,a(p)}}}function Gh(t){return t!==null&&t<-2}function AP(t){return t!==null&&(t<0||t===32)}function ia(t){return t===-2||t===-1||t===32}function Gc(t,e,n,i){const r=i?i-1:Number.POSITIVE_INFINITY;let s=0;return o;function o(l){return ia(l)?(t.enter(n),a(l)):e(l)}function a(l){return ia(l)&&s++<r?(t.consume(l),a):(t.exit(n),e(l))}}class xX{constructor(){this.map=[]}add(e,n,i){wX(this,e,n,i)}consume(e){if(this.map.sort(function(s,o){return s[0]-o[0]}),this.map.length===0)return;let n=this.map.length;const i=[];for(;n>0;)n-=1,i.push(e.slice(this.map[n][0]+this.map[n][1]),this.map[n][2]),e.length=this.map[n][0];i.push(e.slice()),e.length=0;let r=i.pop();for(;r;){for(const s of r)e.push(s);r=i.pop()}this.map.length=0}}function wX(t,e,n,i){let r=0;if(!(n===0&&i.length===0)){for(;r<t.map.length;){if(t.map[r][0]===e){t.map[r][1]+=n,t.map[r][2].push(...i);return}r+=1}t.map.push([e,n,i])}}function _X(t,e){let n=!1;const i=[];for(;e<t.length;){const r=t[e];if(n){if(r[0]==="enter")r[1].type==="tableContent"&&i.push(t[e+1][1].type==="tableDelimiterMarker"?"left":"none");else if(r[1].type==="tableContent"){if(t[e-1][1].type==="tableDelimiterMarker"){const s=i.length-1;i[s]=i[s]==="left"?"center":"right"}}else if(r[1].type==="tableDelimiterRow")break}else r[0]==="enter"&&r[1].type==="tableDelimiterRow"&&(n=!0);e+=1}return i}function AX(){return{flow:{null:{name:"table",tokenize:CX,resolveAll:IX}}}}function CX(t,e,n){const i=this;let r=0,s=0,o;return a;function a(x){let L=i.events.length-1;for(;L>-1;){const K=i.events[L][1].type;if(K==="lineEnding"||K==="linePrefix")L--;else break}const M=L>-1?i.events[L][1].type:null,V=M==="tableHead"||M==="tableRow"?_:l;return V===_&&i.parser.lazy[i.now().line]?n(x):V(x)}function l(x){return t.enter("tableHead"),t.enter("tableRow"),u(x)}function u(x){return x===124||(o=!0,s+=1),c(x)}function c(x){return x===null?n(x):Gh(x)?s>1?(s=0,i.interrupt=!0,t.exit("tableRow"),t.enter("lineEnding"),t.consume(x),t.exit("lineEnding"),h):n(x):ia(x)?Gc(t,c,"whitespace")(x):(s+=1,o&&(o=!1,r+=1),x===124?(t.enter("tableCellDivider"),t.consume(x),t.exit("tableCellDivider"),o=!0,c):(t.enter("data"),d(x)))}function d(x){return x===null||x===124||AP(x)?(t.exit("data"),c(x)):(t.consume(x),x===92?f:d)}function f(x){return x===92||x===124?(t.consume(x),d):d(x)}function h(x){return i.interrupt=!1,i.parser.lazy[i.now().line]?n(x):(t.enter("tableDelimiterRow"),o=!1,ia(x)?Gc(t,p,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(x):p(x))}function p(x){return x===45||x===58?y(x):x===124?(o=!0,t.enter("tableCellDivider"),t.consume(x),t.exit("tableCellDivider"),m):S(x)}function m(x){return ia(x)?Gc(t,y,"whitespace")(x):y(x)}function y(x){return x===58?(s+=1,o=!0,t.enter("tableDelimiterMarker"),t.consume(x),t.exit("tableDelimiterMarker"),g):x===45?(s+=1,g(x)):x===null||Gh(x)?T(x):S(x)}function g(x){return x===45?(t.enter("tableDelimiterFiller"),v(x)):S(x)}function v(x){return x===45?(t.consume(x),v):x===58?(o=!0,t.exit("tableDelimiterFiller"),t.enter("tableDelimiterMarker"),t.consume(x),t.exit("tableDelimiterMarker"),b):(t.exit("tableDelimiterFiller"),b(x))}function b(x){return ia(x)?Gc(t,T,"whitespace")(x):T(x)}function T(x){return x===124?p(x):x===null||Gh(x)?!o||r!==s?S(x):(t.exit("tableDelimiterRow"),t.exit("tableHead"),e(x)):S(x)}function S(x){return n(x)}function _(x){return t.enter("tableRow"),A(x)}function A(x){return x===124?(t.enter("tableCellDivider"),t.consume(x),t.exit("tableCellDivider"),A):x===null||Gh(x)?(t.exit("tableRow"),e(x)):ia(x)?Gc(t,A,"whitespace")(x):(t.enter("data"),P(x))}function P(x){return x===null||x===124||AP(x)?(t.exit("data"),A(x)):(t.consume(x),x===92?O:P)}function O(x){return x===92||x===124?(t.consume(x),P):P(x)}}function IX(t,e){let n=-1,i=!0,r=0,s=[0,0,0,0],o=[0,0,0,0],a=!1,l=0,u,c,d;const f=new xX;for(;++n<t.length;){const h=t[n],p=h[1];h[0]==="enter"?p.type==="tableHead"?(a=!1,l!==0&&(CP(f,e,l,u,c),c=void 0,l=0),u={type:"table",start:Object.assign({},p.start),end:Object.assign({},p.end)},f.add(n,0,[["enter",u,e]])):p.type==="tableRow"||p.type==="tableDelimiterRow"?(i=!0,d=void 0,s=[0,0,0,0],o=[0,n+1,0,0],a&&(a=!1,c={type:"tableBody",start:Object.assign({},p.start),end:Object.assign({},p.end)},f.add(n,0,[["enter",c,e]])),r=p.type==="tableDelimiterRow"?2:c?3:1):r&&(p.type==="data"||p.type==="tableDelimiterMarker"||p.type==="tableDelimiterFiller")?(i=!1,o[2]===0&&(s[1]!==0&&(o[0]=o[1],d=jh(f,e,s,r,void 0,d),s=[0,0,0,0]),o[2]=n)):p.type==="tableCellDivider"&&(i?i=!1:(s[1]!==0&&(o[0]=o[1],d=jh(f,e,s,r,void 0,d)),s=o,o=[s[1],n,0,0])):p.type==="tableHead"?(a=!0,l=n):p.type==="tableRow"||p.type==="tableDelimiterRow"?(l=n,s[1]!==0?(o[0]=o[1],d=jh(f,e,s,r,n,d)):o[1]!==0&&(d=jh(f,e,o,r,n,d)),r=0):r&&(p.type==="data"||p.type==="tableDelimiterMarker"||p.type==="tableDelimiterFiller")&&(o[3]=n)}for(l!==0&&CP(f,e,l,u,c),f.consume(e.events),n=-1;++n<e.events.length;){const h=e.events[n];h[0]==="enter"&&h[1].type==="table"&&(h[1]._align=_X(e.events,n))}return t}function jh(t,e,n,i,r,s){const o=i===1?"tableHeader":i===2?"tableDelimiter":"tableData",a="tableContent";n[0]!==0&&(s.end=Object.assign({},Il(e.events,n[0])),t.add(n[0],0,[["exit",s,e]]));const l=Il(e.events,n[1]);if(s={type:o,start:Object.assign({},l),end:Object.assign({},l)},t.add(n[1],0,[["enter",s,e]]),n[2]!==0){const u=Il(e.events,n[2]),c=Il(e.events,n[3]),d={type:a,start:Object.assign({},u),end:Object.assign({},c)};if(t.add(n[2],0,[["enter",d,e]]),i!==2){const f=e.events[n[2]],h=e.events[n[3]];if(f[1].end=Object.assign({},h[1].end),f[1].type="chunkText",f[1].contentType="text",n[3]>n[2]+1){const p=n[2]+1,m=n[3]-n[2]-1;t.add(p,m,[])}}t.add(n[3]+1,0,[["exit",d,e]])}return r!==void 0&&(s.end=Object.assign({},Il(e.events,r)),t.add(r,0,[["exit",s,e]]),s=void 0),s}function CP(t,e,n,i,r){const s=[],o=Il(e.events,n);r&&(r.end=Object.assign({},o),s.push(["exit",r,e])),i.end=Object.assign({},o),s.push(["exit",i,e]),t.add(n+1,0,s)}function Il(t,e){const n=t[e],i=n[0]==="enter"?"start":"end";return n[1][i]}function RX(t){return t!==null&&t<-2}function LX(t){return t!==null&&(t<0||t===32)}function Sv(t){return t===-2||t===-1||t===32}function PX(t,e,n,i){const r=Number.POSITIVE_INFINITY;let s=0;return o;function o(l){return Sv(l)?(t.enter(n),a(l)):e(l)}function a(l){return Sv(l)&&s++<r?(t.consume(l),a):(t.exit(n),e(l))}}const kX={name:"tasklistCheck",tokenize:OX};function DX(){return{text:{91:kX}}}function OX(t,e,n){const i=this;return r;function r(l){return i.previous!==null||!i._gfmTasklistFirstContentOfListItem?n(l):(t.enter("taskListCheck"),t.enter("taskListCheckMarker"),t.consume(l),t.exit("taskListCheckMarker"),s)}function s(l){return LX(l)?(t.enter("taskListCheckValueUnchecked"),t.consume(l),t.exit("taskListCheckValueUnchecked"),o):l===88||l===120?(t.enter("taskListCheckValueChecked"),t.consume(l),t.exit("taskListCheckValueChecked"),o):n(l)}function o(l){return l===93?(t.enter("taskListCheckMarker"),t.consume(l),t.exit("taskListCheckMarker"),t.exit("taskListCheck"),a):n(l)}function a(l){return RX(l)?e(l):Sv(l)?t.check({tokenize:NX},e,n)(l):n(l)}}function NX(t,e,n){return PX(t,i,"whitespace");function i(r){return r===null?n(r):e(r)}}function MX(t){return jY([QY(),cX(),SX(t),AX(),DX()])}const FX={};function BX(t){const e=this,n=t||FX,i=e.data(),r=i.micromarkExtensions||(i.micromarkExtensions=[]),s=i.fromMarkdownExtensions||(i.fromMarkdownExtensions=[]),o=i.toMarkdownExtensions||(i.toMarkdownExtensions=[]);r.push(MX(n)),s.push(zY()),o.push(VY(n))}const UX={};function HX(t,e){const n=UX,i=typeof n.includeImageAlt=="boolean"?n.includeImageAlt:!0,r=typeof n.includeHtml=="boolean"?n.includeHtml:!0;return IP(t,i,r)}function IP(t,e,n){if($X(t)){if("value"in t)return t.type==="html"&&!n?"":t.value;if(e&&"alt"in t&&t.alt)return t.alt;if("children"in t)return RP(t.children,e,n)}return Array.isArray(t)?RP(t,e,n):""}function RP(t,e,n){const i=[];let r=-1;for(;++r<t.length;)i[r]=IP(t[r],e,n);return i.join("")}function $X(t){return!!(t&&typeof t=="object")}function Tr(t,e,n,i){const r=t.length;let s=0,o;if(e<0?e=-e>r?0:r+e:e=e>r?r:e,n=n>0?n:0,i.length<1e4)o=Array.from(i),o.unshift(e,n),t.splice(...o);else for(n&&t.splice(e,n);s<i.length;)o=i.slice(s,s+1e4),o.unshift(e,0),t.splice(...o),s+=1e4,e+=1e4}function Ui(t,e){return t.length>0?(Tr(t,t.length,0,e),t):e}const LP={}.hasOwnProperty;function zX(t){const e={};let n=-1;for(;++n<t.length;)VX(e,t[n]);return e}function VX(t,e){let n;for(n in e){const r=(LP.call(t,n)?t[n]:void 0)||(t[n]={}),s=e[n];let o;if(s)for(o in s){LP.call(r,o)||(r[o]=[]);const a=s[o];GX(r[o],Array.isArray(a)?a:a?[a]:[])}}}function GX(t,e){let n=-1;const i=[];for(;++n<e.length;)(e[n].add==="after"?t:i).push(e[n]);Tr(t,0,0,i)}function PP(t,e){const n=Number.parseInt(t,e);return n<9||n===11||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||(n&65535)===65535||(n&65535)===65534||n>1114111?"":String.fromCodePoint(n)}function Rl(t){return t.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const Sr=to(/[A-Za-z]/),Ji=to(/[\dA-Za-z]/),jX=to(/[#-'*+\--9=?A-Z^-~]/);function xv(t){return t!==null&&(t<32||t===127)}const wv=to(/\d/),WX=to(/[\dA-Fa-f]/),qX=to(/[!-/:-@[-`{-~]/);function Ke(t){return t!==null&&t<-2}function ti(t){return t!==null&&(t<0||t===32)}function gt(t){return t===-2||t===-1||t===32}const KX=to(new RegExp("\\p{P}|\\p{S}","u")),YX=to(/\s/);function to(t){return e;function e(n){return n!==null&&n>-1&&t.test(String.fromCharCode(n))}}function Ot(t,e,n,i){const r=i?i-1:Number.POSITIVE_INFINITY;let s=0;return o;function o(l){return gt(l)?(t.enter(n),a(l)):e(l)}function a(l){return gt(l)&&s++<r?(t.consume(l),a):(t.exit(n),e(l))}}const XX={tokenize:QX};function QX(t){const e=t.attempt(this.parser.constructs.contentInitial,i,r);let n;return e;function i(a){if(a===null){t.consume(a);return}return t.enter("lineEnding"),t.consume(a),t.exit("lineEnding"),Ot(t,e,"linePrefix")}function r(a){return t.enter("paragraph"),s(a)}function s(a){const l=t.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=l),n=l,o(a)}function o(a){if(a===null){t.exit("chunkText"),t.exit("paragraph"),t.consume(a);return}return Ke(a)?(t.consume(a),t.exit("chunkText"),s):(t.consume(a),o)}}const ZX={tokenize:JX},kP={tokenize:eQ};function JX(t){const e=this,n=[];let i=0,r,s,o;return a;function a(b){if(i<n.length){const T=n[i];return e.containerState=T[1],t.attempt(T[0].continuation,l,u)(b)}return u(b)}function l(b){if(i++,e.containerState._closeFlow){e.containerState._closeFlow=void 0,r&&v();const T=e.events.length;let S=T,_;for(;S--;)if(e.events[S][0]==="exit"&&e.events[S][1].type==="chunkFlow"){_=e.events[S][1].end;break}g(i);let A=T;for(;A<e.events.length;)e.events[A][1].end={..._},A++;return Tr(e.events,S+1,0,e.events.slice(T)),e.events.length=A,u(b)}return a(b)}function u(b){if(i===n.length){if(!r)return f(b);if(r.currentConstruct&&r.currentConstruct.concrete)return p(b);e.interrupt=!!(r.currentConstruct&&!r._gfmTableDynamicInterruptHack)}return e.containerState={},t.check(kP,c,d)(b)}function c(b){return r&&v(),g(i),f(b)}function d(b){return e.parser.lazy[e.now().line]=i!==n.length,o=e.now().offset,p(b)}function f(b){return e.containerState={},t.attempt(kP,h,p)(b)}function h(b){return i++,n.push([e.currentConstruct,e.containerState]),f(b)}function p(b){if(b===null){r&&v(),g(0),t.consume(b);return}return r=r||e.parser.flow(e.now()),t.enter("chunkFlow",{_tokenizer:r,contentType:"flow",previous:s}),m(b)}function m(b){if(b===null){y(t.exit("chunkFlow"),!0),g(0),t.consume(b);return}return Ke(b)?(t.consume(b),y(t.exit("chunkFlow")),i=0,e.interrupt=void 0,a):(t.consume(b),m)}function y(b,T){const S=e.sliceStream(b);if(T&&S.push(null),b.previous=s,s&&(s.next=b),s=b,r.defineSkip(b.start),r.write(S),e.parser.lazy[b.start.line]){let _=r.events.length;for(;_--;)if(r.events[_][1].start.offset<o&&(!r.events[_][1].end||r.events[_][1].end.offset>o))return;const A=e.events.length;let P=A,O,x;for(;P--;)if(e.events[P][0]==="exit"&&e.events[P][1].type==="chunkFlow"){if(O){x=e.events[P][1].end;break}O=!0}for(g(i),_=A;_<e.events.length;)e.events[_][1].end={...x},_++;Tr(e.events,P+1,0,e.events.slice(A)),e.events.length=_}}function g(b){let T=n.length;for(;T-- >b;){const S=n[T];e.containerState=S[1],S[0].exit.call(e,t)}n.length=b}function v(){r.write([null]),s=void 0,r=void 0,e.containerState._closeFlow=void 0}}function eQ(t,e,n){return Ot(t,t.attempt(this.parser.constructs.document,e,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function DP(t){if(t===null||ti(t)||YX(t))return 1;if(KX(t))return 2}function _v(t,e,n){const i=[];let r=-1;for(;++r<t.length;){const s=t[r].resolveAll;s&&!i.includes(s)&&(e=s(e,n),i.push(s))}return e}const Av={name:"attention",resolveAll:tQ,tokenize:nQ};function tQ(t,e){let n=-1,i,r,s,o,a,l,u,c;for(;++n<t.length;)if(t[n][0]==="enter"&&t[n][1].type==="attentionSequence"&&t[n][1]._close){for(i=n;i--;)if(t[i][0]==="exit"&&t[i][1].type==="attentionSequence"&&t[i][1]._open&&e.sliceSerialize(t[i][1]).charCodeAt(0)===e.sliceSerialize(t[n][1]).charCodeAt(0)){if((t[i][1]._close||t[n][1]._open)&&(t[n][1].end.offset-t[n][1].start.offset)%3&&!((t[i][1].end.offset-t[i][1].start.offset+t[n][1].end.offset-t[n][1].start.offset)%3))continue;l=t[i][1].end.offset-t[i][1].start.offset>1&&t[n][1].end.offset-t[n][1].start.offset>1?2:1;const d={...t[i][1].end},f={...t[n][1].start};OP(d,-l),OP(f,l),o={type:l>1?"strongSequence":"emphasisSequence",start:d,end:{...t[i][1].end}},a={type:l>1?"strongSequence":"emphasisSequence",start:{...t[n][1].start},end:f},s={type:l>1?"strongText":"emphasisText",start:{...t[i][1].end},end:{...t[n][1].start}},r={type:l>1?"strong":"emphasis",start:{...o.start},end:{...a.end}},t[i][1].end={...o.start},t[n][1].start={...a.end},u=[],t[i][1].end.offset-t[i][1].start.offset&&(u=Ui(u,[["enter",t[i][1],e],["exit",t[i][1],e]])),u=Ui(u,[["enter",r,e],["enter",o,e],["exit",o,e],["enter",s,e]]),u=Ui(u,_v(e.parser.constructs.insideSpan.null,t.slice(i+1,n),e)),u=Ui(u,[["exit",s,e],["enter",a,e],["exit",a,e],["exit",r,e]]),t[n][1].end.offset-t[n][1].start.offset?(c=2,u=Ui(u,[["enter",t[n][1],e],["exit",t[n][1],e]])):c=0,Tr(t,i-1,n-i+3,u),n=i+u.length-c-2;break}}for(n=-1;++n<t.length;)t[n][1].type==="attentionSequence"&&(t[n][1].type="data");return t}function nQ(t,e){const n=this.parser.constructs.attentionMarkers.null,i=this.previous,r=DP(i);let s;return o;function o(l){return s=l,t.enter("attentionSequence"),a(l)}function a(l){if(l===s)return t.consume(l),a;const u=t.exit("attentionSequence"),c=DP(l),d=!c||c===2&&r||n.includes(l),f=!r||r===2&&c||n.includes(i);return u._open=!!(s===42?d:d&&(r||!f)),u._close=!!(s===42?f:f&&(c||!d)),e(l)}}function OP(t,e){t.column+=e,t.offset+=e,t._bufferIndex+=e}const iQ={name:"autolink",tokenize:rQ};function rQ(t,e,n){let i=0;return r;function r(h){return t.enter("autolink"),t.enter("autolinkMarker"),t.consume(h),t.exit("autolinkMarker"),t.enter("autolinkProtocol"),s}function s(h){return Sr(h)?(t.consume(h),o):h===64?n(h):u(h)}function o(h){return h===43||h===45||h===46||Ji(h)?(i=1,a(h)):u(h)}function a(h){return h===58?(t.consume(h),i=0,l):(h===43||h===45||h===46||Ji(h))&&i++<32?(t.consume(h),a):(i=0,u(h))}function l(h){return h===62?(t.exit("autolinkProtocol"),t.enter("autolinkMarker"),t.consume(h),t.exit("autolinkMarker"),t.exit("autolink"),e):h===null||h===32||h===60||xv(h)?n(h):(t.consume(h),l)}function u(h){return h===64?(t.consume(h),c):jX(h)?(t.consume(h),u):n(h)}function c(h){return Ji(h)?d(h):n(h)}function d(h){return h===46?(t.consume(h),i=0,c):h===62?(t.exit("autolinkProtocol").type="autolinkEmail",t.enter("autolinkMarker"),t.consume(h),t.exit("autolinkMarker"),t.exit("autolink"),e):f(h)}function f(h){if((h===45||Ji(h))&&i++<63){const p=h===45?f:d;return t.consume(h),p}return n(h)}}const Wh={partial:!0,tokenize:sQ};function sQ(t,e,n){return i;function i(s){return gt(s)?Ot(t,r,"linePrefix")(s):r(s)}function r(s){return s===null||Ke(s)?e(s):n(s)}}const NP={continuation:{tokenize:aQ},exit:lQ,name:"blockQuote",tokenize:oQ};function oQ(t,e,n){const i=this;return r;function r(o){if(o===62){const a=i.containerState;return a.open||(t.enter("blockQuote",{_container:!0}),a.open=!0),t.enter("blockQuotePrefix"),t.enter("blockQuoteMarker"),t.consume(o),t.exit("blockQuoteMarker"),s}return n(o)}function s(o){return gt(o)?(t.enter("blockQuotePrefixWhitespace"),t.consume(o),t.exit("blockQuotePrefixWhitespace"),t.exit("blockQuotePrefix"),e):(t.exit("blockQuotePrefix"),e(o))}}function aQ(t,e,n){const i=this;return r;function r(o){return gt(o)?Ot(t,s,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(o):s(o)}function s(o){return t.attempt(NP,e,n)(o)}}function lQ(t){t.exit("blockQuote")}const MP={name:"characterEscape",tokenize:uQ};function uQ(t,e,n){return i;function i(s){return t.enter("characterEscape"),t.enter("escapeMarker"),t.consume(s),t.exit("escapeMarker"),r}function r(s){return qX(s)?(t.enter("characterEscapeValue"),t.consume(s),t.exit("characterEscapeValue"),t.exit("characterEscape"),e):n(s)}}const FP={name:"characterReference",tokenize:cQ};function cQ(t,e,n){const i=this;let r=0,s,o;return a;function a(d){return t.enter("characterReference"),t.enter("characterReferenceMarker"),t.consume(d),t.exit("characterReferenceMarker"),l}function l(d){return d===35?(t.enter("characterReferenceMarkerNumeric"),t.consume(d),t.exit("characterReferenceMarkerNumeric"),u):(t.enter("characterReferenceValue"),s=31,o=Ji,c(d))}function u(d){return d===88||d===120?(t.enter("characterReferenceMarkerHexadecimal"),t.consume(d),t.exit("characterReferenceMarkerHexadecimal"),t.enter("characterReferenceValue"),s=6,o=WX,c):(t.enter("characterReferenceValue"),s=7,o=wv,c(d))}function c(d){if(d===59&&r){const f=t.exit("characterReferenceValue");return o===Ji&&!dv(i.sliceSerialize(f))?n(d):(t.enter("characterReferenceMarker"),t.consume(d),t.exit("characterReferenceMarker"),t.exit("characterReference"),e)}return o(d)&&r++<s?(t.consume(d),c):n(d)}}const BP={partial:!0,tokenize:fQ},UP={concrete:!0,name:"codeFenced",tokenize:dQ};function dQ(t,e,n){const i=this,r={partial:!0,tokenize:S};let s=0,o=0,a;return l;function l(_){return u(_)}function u(_){const A=i.events[i.events.length-1];return s=A&&A[1].type==="linePrefix"?A[2].sliceSerialize(A[1],!0).length:0,a=_,t.enter("codeFenced"),t.enter("codeFencedFence"),t.enter("codeFencedFenceSequence"),c(_)}function c(_){return _===a?(o++,t.consume(_),c):o<3?n(_):(t.exit("codeFencedFenceSequence"),gt(_)?Ot(t,d,"whitespace")(_):d(_))}function d(_){return _===null||Ke(_)?(t.exit("codeFencedFence"),i.interrupt?e(_):t.check(BP,m,T)(_)):(t.enter("codeFencedFenceInfo"),t.enter("chunkString",{contentType:"string"}),f(_))}function f(_){return _===null||Ke(_)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),d(_)):gt(_)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),Ot(t,h,"whitespace")(_)):_===96&&_===a?n(_):(t.consume(_),f)}function h(_){return _===null||Ke(_)?d(_):(t.enter("codeFencedFenceMeta"),t.enter("chunkString",{contentType:"string"}),p(_))}function p(_){return _===null||Ke(_)?(t.exit("chunkString"),t.exit("codeFencedFenceMeta"),d(_)):_===96&&_===a?n(_):(t.consume(_),p)}function m(_){return t.attempt(r,T,y)(_)}function y(_){return t.enter("lineEnding"),t.consume(_),t.exit("lineEnding"),g}function g(_){return s>0&&gt(_)?Ot(t,v,"linePrefix",s+1)(_):v(_)}function v(_){return _===null||Ke(_)?t.check(BP,m,T)(_):(t.enter("codeFlowValue"),b(_))}function b(_){return _===null||Ke(_)?(t.exit("codeFlowValue"),v(_)):(t.consume(_),b)}function T(_){return t.exit("codeFenced"),e(_)}function S(_,A,P){let O=0;return x;function x(U){return _.enter("lineEnding"),_.consume(U),_.exit("lineEnding"),L}function L(U){return _.enter("codeFencedFence"),gt(U)?Ot(_,M,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(U):M(U)}function M(U){return U===a?(_.enter("codeFencedFenceSequence"),V(U)):P(U)}function V(U){return U===a?(O++,_.consume(U),V):O>=o?(_.exit("codeFencedFenceSequence"),gt(U)?Ot(_,K,"whitespace")(U):K(U)):P(U)}function K(U){return U===null||Ke(U)?(_.exit("codeFencedFence"),A(U)):P(U)}}}function fQ(t,e,n){const i=this;return r;function r(o){return o===null?n(o):(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),s)}function s(o){return i.parser.lazy[i.now().line]?n(o):e(o)}}const Cv={name:"codeIndented",tokenize:pQ},hQ={partial:!0,tokenize:mQ};function pQ(t,e,n){const i=this;return r;function r(u){return t.enter("codeIndented"),Ot(t,s,"linePrefix",5)(u)}function s(u){const c=i.events[i.events.length-1];return c&&c[1].type==="linePrefix"&&c[2].sliceSerialize(c[1],!0).length>=4?o(u):n(u)}function o(u){return u===null?l(u):Ke(u)?t.attempt(hQ,o,l)(u):(t.enter("codeFlowValue"),a(u))}function a(u){return u===null||Ke(u)?(t.exit("codeFlowValue"),o(u)):(t.consume(u),a)}function l(u){return t.exit("codeIndented"),e(u)}}function mQ(t,e,n){const i=this;return r;function r(o){return i.parser.lazy[i.now().line]?n(o):Ke(o)?(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),r):Ot(t,s,"linePrefix",5)(o)}function s(o){const a=i.events[i.events.length-1];return a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?e(o):Ke(o)?r(o):n(o)}}const gQ={name:"codeText",previous:vQ,resolve:yQ,tokenize:bQ};function yQ(t){let e=t.length-4,n=3,i,r;if((t[n][1].type==="lineEnding"||t[n][1].type==="space")&&(t[e][1].type==="lineEnding"||t[e][1].type==="space")){for(i=n;++i<e;)if(t[i][1].type==="codeTextData"){t[n][1].type="codeTextPadding",t[e][1].type="codeTextPadding",n+=2,e-=2;break}}for(i=n-1,e++;++i<=e;)r===void 0?i!==e&&t[i][1].type!=="lineEnding"&&(r=i):(i===e||t[i][1].type==="lineEnding")&&(t[r][1].type="codeTextData",i!==r+2&&(t[r][1].end=t[i-1][1].end,t.splice(r+2,i-r-2),e-=i-r-2,i=r+2),r=void 0);return t}function vQ(t){return t!==96||this.events[this.events.length-1][1].type==="characterEscape"}function bQ(t,e,n){let i=0,r,s;return o;function o(d){return t.enter("codeText"),t.enter("codeTextSequence"),a(d)}function a(d){return d===96?(t.consume(d),i++,a):(t.exit("codeTextSequence"),l(d))}function l(d){return d===null?n(d):d===32?(t.enter("space"),t.consume(d),t.exit("space"),l):d===96?(s=t.enter("codeTextSequence"),r=0,c(d)):Ke(d)?(t.enter("lineEnding"),t.consume(d),t.exit("lineEnding"),l):(t.enter("codeTextData"),u(d))}function u(d){return d===null||d===32||d===96||Ke(d)?(t.exit("codeTextData"),l(d)):(t.consume(d),u)}function c(d){return d===96?(t.consume(d),r++,c):r===i?(t.exit("codeTextSequence"),t.exit("codeText"),e(d)):(s.type="codeTextData",u(d))}}class EQ{constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,n){const i=n??Number.POSITIVE_INFINITY;return i<this.left.length?this.left.slice(e,i):e>this.left.length?this.right.slice(this.right.length-i+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-i+this.left.length).reverse())}splice(e,n,i){const r=n||0;this.setCursor(Math.trunc(e));const s=this.right.splice(this.right.length-r,Number.POSITIVE_INFINITY);return i&&jc(this.left,i),s.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(e){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(e)}pushMany(e){this.setCursor(Number.POSITIVE_INFINITY),jc(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),jc(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&this.right.length===0||e<0&&this.left.length===0))if(e<this.left.length){const n=this.left.splice(e,Number.POSITIVE_INFINITY);jc(this.right,n.reverse())}else{const n=this.right.splice(this.left.length+this.right.length-e,Number.POSITIVE_INFINITY);jc(this.left,n.reverse())}}}function jc(t,e){let n=0;if(e.length<1e4)t.push(...e);else for(;n<e.length;)t.push(...e.slice(n,n+1e4)),n+=1e4}function HP(t){const e={};let n=-1,i,r,s,o,a,l,u;const c=new EQ(t);for(;++n<c.length;){for(;n in e;)n=e[n];if(i=c.get(n),n&&i[1].type==="chunkFlow"&&c.get(n-1)[1].type==="listItemPrefix"&&(l=i[1]._tokenizer.events,s=0,s<l.length&&l[s][1].type==="lineEndingBlank"&&(s+=2),s<l.length&&l[s][1].type==="content"))for(;++s<l.length&&l[s][1].type!=="content";)l[s][1].type==="chunkText"&&(l[s][1]._isInFirstContentOfListItem=!0,s++);if(i[0]==="enter")i[1].contentType&&(Object.assign(e,TQ(c,n)),n=e[n],u=!0);else if(i[1]._container){for(s=n,r=void 0;s--;)if(o=c.get(s),o[1].type==="lineEnding"||o[1].type==="lineEndingBlank")o[0]==="enter"&&(r&&(c.get(r)[1].type="lineEndingBlank"),o[1].type="lineEnding",r=s);else if(!(o[1].type==="linePrefix"||o[1].type==="listItemIndent"))break;r&&(i[1].end={...c.get(r)[1].start},a=c.slice(r,n),a.unshift(i),c.splice(r,n-r+1,a))}}return Tr(t,0,Number.POSITIVE_INFINITY,c.slice(0)),!u}function TQ(t,e){const n=t.get(e)[1],i=t.get(e)[2];let r=e-1;const s=[];let o=n._tokenizer;o||(o=i.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(o._contentTypeTextTrailing=!0));const a=o.events,l=[],u={};let c,d,f=-1,h=n,p=0,m=0;const y=[m];for(;h;){for(;t.get(++r)[1]!==h;);s.push(r),h._tokenizer||(c=i.sliceStream(h),h.next||c.push(null),d&&o.defineSkip(h.start),h._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=!0),o.write(c),h._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=void 0)),d=h,h=h.next}for(h=n;++f<a.length;)a[f][0]==="exit"&&a[f-1][0]==="enter"&&a[f][1].type===a[f-1][1].type&&a[f][1].start.line!==a[f][1].end.line&&(m=f+1,y.push(m),h._tokenizer=void 0,h.previous=void 0,h=h.next);for(o.events=[],h?(h._tokenizer=void 0,h.previous=void 0):y.pop(),f=y.length;f--;){const g=a.slice(y[f],y[f+1]),v=s.pop();l.push([v,v+g.length-1]),t.splice(v,2,g)}for(l.reverse(),f=-1;++f<l.length;)u[p+l[f][0]]=p+l[f][1],p+=l[f][1]-l[f][0]-1;return u}const SQ={resolve:wQ,tokenize:_Q},xQ={partial:!0,tokenize:AQ};function wQ(t){return HP(t),t}function _Q(t,e){let n;return i;function i(a){return t.enter("content"),n=t.enter("chunkContent",{contentType:"content"}),r(a)}function r(a){return a===null?s(a):Ke(a)?t.check(xQ,o,s)(a):(t.consume(a),r)}function s(a){return t.exit("chunkContent"),t.exit("content"),e(a)}function o(a){return t.consume(a),t.exit("chunkContent"),n.next=t.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,r}}function AQ(t,e,n){const i=this;return r;function r(o){return t.exit("chunkContent"),t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),Ot(t,s,"linePrefix")}function s(o){if(o===null||Ke(o))return n(o);const a=i.events[i.events.length-1];return!i.parser.constructs.disable.null.includes("codeIndented")&&a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?e(o):t.interrupt(i.parser.constructs.flow,n,e)(o)}}function $P(t,e,n,i,r,s,o,a,l){const u=l||Number.POSITIVE_INFINITY;let c=0;return d;function d(g){return g===60?(t.enter(i),t.enter(r),t.enter(s),t.consume(g),t.exit(s),f):g===null||g===32||g===41||xv(g)?n(g):(t.enter(i),t.enter(o),t.enter(a),t.enter("chunkString",{contentType:"string"}),m(g))}function f(g){return g===62?(t.enter(s),t.consume(g),t.exit(s),t.exit(r),t.exit(i),e):(t.enter(a),t.enter("chunkString",{contentType:"string"}),h(g))}function h(g){return g===62?(t.exit("chunkString"),t.exit(a),f(g)):g===null||g===60||Ke(g)?n(g):(t.consume(g),g===92?p:h)}function p(g){return g===60||g===62||g===92?(t.consume(g),h):h(g)}function m(g){return!c&&(g===null||g===41||ti(g))?(t.exit("chunkString"),t.exit(a),t.exit(o),t.exit(i),e(g)):c<u&&g===40?(t.consume(g),c++,m):g===41?(t.consume(g),c--,m):g===null||g===32||g===40||xv(g)?n(g):(t.consume(g),g===92?y:m)}function y(g){return g===40||g===41||g===92?(t.consume(g),m):m(g)}}function zP(t,e,n,i,r,s){const o=this;let a=0,l;return u;function u(h){return t.enter(i),t.enter(r),t.consume(h),t.exit(r),t.enter(s),c}function c(h){return a>999||h===null||h===91||h===93&&!l||h===94&&!a&&"_hiddenFootnoteSupport"in o.parser.constructs?n(h):h===93?(t.exit(s),t.enter(r),t.consume(h),t.exit(r),t.exit(i),e):Ke(h)?(t.enter("lineEnding"),t.consume(h),t.exit("lineEnding"),c):(t.enter("chunkString",{contentType:"string"}),d(h))}function d(h){return h===null||h===91||h===93||Ke(h)||a++>999?(t.exit("chunkString"),c(h)):(t.consume(h),l||(l=!gt(h)),h===92?f:d)}function f(h){return h===91||h===92||h===93?(t.consume(h),a++,d):d(h)}}function VP(t,e,n,i,r,s){let o;return a;function a(f){return f===34||f===39||f===40?(t.enter(i),t.enter(r),t.consume(f),t.exit(r),o=f===40?41:f,l):n(f)}function l(f){return f===o?(t.enter(r),t.consume(f),t.exit(r),t.exit(i),e):(t.enter(s),u(f))}function u(f){return f===o?(t.exit(s),l(o)):f===null?n(f):Ke(f)?(t.enter("lineEnding"),t.consume(f),t.exit("lineEnding"),Ot(t,u,"linePrefix")):(t.enter("chunkString",{contentType:"string"}),c(f))}function c(f){return f===o||f===null||Ke(f)?(t.exit("chunkString"),u(f)):(t.consume(f),f===92?d:c)}function d(f){return f===o||f===92?(t.consume(f),c):c(f)}}function Wc(t,e){let n;return i;function i(r){return Ke(r)?(t.enter("lineEnding"),t.consume(r),t.exit("lineEnding"),n=!0,i):gt(r)?Ot(t,i,n?"linePrefix":"lineSuffix")(r):e(r)}}const CQ={name:"definition",tokenize:RQ},IQ={partial:!0,tokenize:LQ};function RQ(t,e,n){const i=this;let r;return s;function s(h){return t.enter("definition"),o(h)}function o(h){return zP.call(i,t,a,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(h)}function a(h){return r=Rl(i.sliceSerialize(i.events[i.events.length-1][1]).slice(1,-1)),h===58?(t.enter("definitionMarker"),t.consume(h),t.exit("definitionMarker"),l):n(h)}function l(h){return ti(h)?Wc(t,u)(h):u(h)}function u(h){return $P(t,c,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(h)}function c(h){return t.attempt(IQ,d,d)(h)}function d(h){return gt(h)?Ot(t,f,"whitespace")(h):f(h)}function f(h){return h===null||Ke(h)?(t.exit("definition"),i.parser.defined.push(r),e(h)):n(h)}}function LQ(t,e,n){return i;function i(a){return ti(a)?Wc(t,r)(a):n(a)}function r(a){return VP(t,s,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(a)}function s(a){return gt(a)?Ot(t,o,"whitespace")(a):o(a)}function o(a){return a===null||Ke(a)?e(a):n(a)}}const PQ={name:"hardBreakEscape",tokenize:kQ};function kQ(t,e,n){return i;function i(s){return t.enter("hardBreakEscape"),t.consume(s),r}function r(s){return Ke(s)?(t.exit("hardBreakEscape"),e(s)):n(s)}}const DQ={name:"headingAtx",resolve:OQ,tokenize:NQ};function OQ(t,e){let n=t.length-2,i=3,r,s;return t[i][1].type==="whitespace"&&(i+=2),n-2>i&&t[n][1].type==="whitespace"&&(n-=2),t[n][1].type==="atxHeadingSequence"&&(i===n-1||n-4>i&&t[n-2][1].type==="whitespace")&&(n-=i+1===n?2:4),n>i&&(r={type:"atxHeadingText",start:t[i][1].start,end:t[n][1].end},s={type:"chunkText",start:t[i][1].start,end:t[n][1].end,contentType:"text"},Tr(t,i,n-i+1,[["enter",r,e],["enter",s,e],["exit",s,e],["exit",r,e]])),t}function NQ(t,e,n){let i=0;return r;function r(c){return t.enter("atxHeading"),s(c)}function s(c){return t.enter("atxHeadingSequence"),o(c)}function o(c){return c===35&&i++<6?(t.consume(c),o):c===null||ti(c)?(t.exit("atxHeadingSequence"),a(c)):n(c)}function a(c){return c===35?(t.enter("atxHeadingSequence"),l(c)):c===null||Ke(c)?(t.exit("atxHeading"),e(c)):gt(c)?Ot(t,a,"whitespace")(c):(t.enter("atxHeadingText"),u(c))}function l(c){return c===35?(t.consume(c),l):(t.exit("atxHeadingSequence"),a(c))}function u(c){return c===null||c===35||ti(c)?(t.exit("atxHeadingText"),a(c)):(t.consume(c),u)}}const MQ=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],GP=["pre","script","style","textarea"],FQ={concrete:!0,name:"htmlFlow",resolveTo:HQ,tokenize:$Q},BQ={partial:!0,tokenize:VQ},UQ={partial:!0,tokenize:zQ};function HQ(t){let e=t.length;for(;e--&&!(t[e][0]==="enter"&&t[e][1].type==="htmlFlow"););return e>1&&t[e-2][1].type==="linePrefix"&&(t[e][1].start=t[e-2][1].start,t[e+1][1].start=t[e-2][1].start,t.splice(e-2,2)),t}function $Q(t,e,n){const i=this;let r,s,o,a,l;return u;function u(N){return c(N)}function c(N){return t.enter("htmlFlow"),t.enter("htmlFlowData"),t.consume(N),d}function d(N){return N===33?(t.consume(N),f):N===47?(t.consume(N),s=!0,m):N===63?(t.consume(N),r=3,i.interrupt?e:D):Sr(N)?(t.consume(N),o=String.fromCharCode(N),y):n(N)}function f(N){return N===45?(t.consume(N),r=2,h):N===91?(t.consume(N),r=5,a=0,p):Sr(N)?(t.consume(N),r=4,i.interrupt?e:D):n(N)}function h(N){return N===45?(t.consume(N),i.interrupt?e:D):n(N)}function p(N){const le="CDATA[";return N===le.charCodeAt(a++)?(t.consume(N),a===le.length?i.interrupt?e:M:p):n(N)}function m(N){return Sr(N)?(t.consume(N),o=String.fromCharCode(N),y):n(N)}function y(N){if(N===null||N===47||N===62||ti(N)){const le=N===47,we=o.toLowerCase();return!le&&!s&&GP.includes(we)?(r=1,i.interrupt?e(N):M(N)):MQ.includes(o.toLowerCase())?(r=6,le?(t.consume(N),g):i.interrupt?e(N):M(N)):(r=7,i.interrupt&&!i.parser.lazy[i.now().line]?n(N):s?v(N):b(N))}return N===45||Ji(N)?(t.consume(N),o+=String.fromCharCode(N),y):n(N)}function g(N){return N===62?(t.consume(N),i.interrupt?e:M):n(N)}function v(N){return gt(N)?(t.consume(N),v):x(N)}function b(N){return N===47?(t.consume(N),x):N===58||N===95||Sr(N)?(t.consume(N),T):gt(N)?(t.consume(N),b):x(N)}function T(N){return N===45||N===46||N===58||N===95||Ji(N)?(t.consume(N),T):S(N)}function S(N){return N===61?(t.consume(N),_):gt(N)?(t.consume(N),S):b(N)}function _(N){return N===null||N===60||N===61||N===62||N===96?n(N):N===34||N===39?(t.consume(N),l=N,A):gt(N)?(t.consume(N),_):P(N)}function A(N){return N===l?(t.consume(N),l=null,O):N===null||Ke(N)?n(N):(t.consume(N),A)}function P(N){return N===null||N===34||N===39||N===47||N===60||N===61||N===62||N===96||ti(N)?S(N):(t.consume(N),P)}function O(N){return N===47||N===62||gt(N)?b(N):n(N)}function x(N){return N===62?(t.consume(N),L):n(N)}function L(N){return N===null||Ke(N)?M(N):gt(N)?(t.consume(N),L):n(N)}function M(N){return N===45&&r===2?(t.consume(N),j):N===60&&r===1?(t.consume(N),G):N===62&&r===4?(t.consume(N),ee):N===63&&r===3?(t.consume(N),D):N===93&&r===5?(t.consume(N),Y):Ke(N)&&(r===6||r===7)?(t.exit("htmlFlowData"),t.check(BQ,ne,V)(N)):N===null||Ke(N)?(t.exit("htmlFlowData"),V(N)):(t.consume(N),M)}function V(N){return t.check(UQ,K,ne)(N)}function K(N){return t.enter("lineEnding"),t.consume(N),t.exit("lineEnding"),U}function U(N){return N===null||Ke(N)?V(N):(t.enter("htmlFlowData"),M(N))}function j(N){return N===45?(t.consume(N),D):M(N)}function G(N){return N===47?(t.consume(N),o="",H):M(N)}function H(N){if(N===62){const le=o.toLowerCase();return GP.includes(le)?(t.consume(N),ee):M(N)}return Sr(N)&&o.length<8?(t.consume(N),o+=String.fromCharCode(N),H):M(N)}function Y(N){return N===93?(t.consume(N),D):M(N)}function D(N){return N===62?(t.consume(N),ee):N===45&&r===2?(t.consume(N),D):M(N)}function ee(N){return N===null||Ke(N)?(t.exit("htmlFlowData"),ne(N)):(t.consume(N),ee)}function ne(N){return t.exit("htmlFlow"),e(N)}}function zQ(t,e,n){const i=this;return r;function r(o){return Ke(o)?(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),s):n(o)}function s(o){return i.parser.lazy[i.now().line]?n(o):e(o)}}function VQ(t,e,n){return i;function i(r){return t.enter("lineEnding"),t.consume(r),t.exit("lineEnding"),t.attempt(Wh,e,n)}}const GQ={name:"htmlText",tokenize:jQ};function jQ(t,e,n){const i=this;let r,s,o;return a;function a(D){return t.enter("htmlText"),t.enter("htmlTextData"),t.consume(D),l}function l(D){return D===33?(t.consume(D),u):D===47?(t.consume(D),S):D===63?(t.consume(D),b):Sr(D)?(t.consume(D),P):n(D)}function u(D){return D===45?(t.consume(D),c):D===91?(t.consume(D),s=0,p):Sr(D)?(t.consume(D),v):n(D)}function c(D){return D===45?(t.consume(D),h):n(D)}function d(D){return D===null?n(D):D===45?(t.consume(D),f):Ke(D)?(o=d,G(D)):(t.consume(D),d)}function f(D){return D===45?(t.consume(D),h):d(D)}function h(D){return D===62?j(D):D===45?f(D):d(D)}function p(D){const ee="CDATA[";return D===ee.charCodeAt(s++)?(t.consume(D),s===ee.length?m:p):n(D)}function m(D){return D===null?n(D):D===93?(t.consume(D),y):Ke(D)?(o=m,G(D)):(t.consume(D),m)}function y(D){return D===93?(t.consume(D),g):m(D)}function g(D){return D===62?j(D):D===93?(t.consume(D),g):m(D)}function v(D){return D===null||D===62?j(D):Ke(D)?(o=v,G(D)):(t.consume(D),v)}function b(D){return D===null?n(D):D===63?(t.consume(D),T):Ke(D)?(o=b,G(D)):(t.consume(D),b)}function T(D){return D===62?j(D):b(D)}function S(D){return Sr(D)?(t.consume(D),_):n(D)}function _(D){return D===45||Ji(D)?(t.consume(D),_):A(D)}function A(D){return Ke(D)?(o=A,G(D)):gt(D)?(t.consume(D),A):j(D)}function P(D){return D===45||Ji(D)?(t.consume(D),P):D===47||D===62||ti(D)?O(D):n(D)}function O(D){return D===47?(t.consume(D),j):D===58||D===95||Sr(D)?(t.consume(D),x):Ke(D)?(o=O,G(D)):gt(D)?(t.consume(D),O):j(D)}function x(D){return D===45||D===46||D===58||D===95||Ji(D)?(t.consume(D),x):L(D)}function L(D){return D===61?(t.consume(D),M):Ke(D)?(o=L,G(D)):gt(D)?(t.consume(D),L):O(D)}function M(D){return D===null||D===60||D===61||D===62||D===96?n(D):D===34||D===39?(t.consume(D),r=D,V):Ke(D)?(o=M,G(D)):gt(D)?(t.consume(D),M):(t.consume(D),K)}function V(D){return D===r?(t.consume(D),r=void 0,U):D===null?n(D):Ke(D)?(o=V,G(D)):(t.consume(D),V)}function K(D){return D===null||D===34||D===39||D===60||D===61||D===96?n(D):D===47||D===62||ti(D)?O(D):(t.consume(D),K)}function U(D){return D===47||D===62||ti(D)?O(D):n(D)}function j(D){return D===62?(t.consume(D),t.exit("htmlTextData"),t.exit("htmlText"),e):n(D)}function G(D){return t.exit("htmlTextData"),t.enter("lineEnding"),t.consume(D),t.exit("lineEnding"),H}function H(D){return gt(D)?Ot(t,Y,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(D):Y(D)}function Y(D){return t.enter("htmlTextData"),o(D)}}const Iv={name:"labelEnd",resolveAll:YQ,resolveTo:XQ,tokenize:QQ},WQ={tokenize:ZQ},qQ={tokenize:JQ},KQ={tokenize:eZ};function YQ(t){let e=-1;const n=[];for(;++e<t.length;){const i=t[e][1];if(n.push(t[e]),i.type==="labelImage"||i.type==="labelLink"||i.type==="labelEnd"){const r=i.type==="labelImage"?4:2;i.type="data",e+=r}}return t.length!==n.length&&Tr(t,0,t.length,n),t}function XQ(t,e){let n=t.length,i=0,r,s,o,a;for(;n--;)if(r=t[n][1],s){if(r.type==="link"||r.type==="labelLink"&&r._inactive)break;t[n][0]==="enter"&&r.type==="labelLink"&&(r._inactive=!0)}else if(o){if(t[n][0]==="enter"&&(r.type==="labelImage"||r.type==="labelLink")&&!r._balanced&&(s=n,r.type!=="labelLink")){i=2;break}}else r.type==="labelEnd"&&(o=n);const l={type:t[s][1].type==="labelLink"?"link":"image",start:{...t[s][1].start},end:{...t[t.length-1][1].end}},u={type:"label",start:{...t[s][1].start},end:{...t[o][1].end}},c={type:"labelText",start:{...t[s+i+2][1].end},end:{...t[o-2][1].start}};return a=[["enter",l,e],["enter",u,e]],a=Ui(a,t.slice(s+1,s+i+3)),a=Ui(a,[["enter",c,e]]),a=Ui(a,_v(e.parser.constructs.insideSpan.null,t.slice(s+i+4,o-3),e)),a=Ui(a,[["exit",c,e],t[o-2],t[o-1],["exit",u,e]]),a=Ui(a,t.slice(o+1)),a=Ui(a,[["exit",l,e]]),Tr(t,s,t.length,a),t}function QQ(t,e,n){const i=this;let r=i.events.length,s,o;for(;r--;)if((i.events[r][1].type==="labelImage"||i.events[r][1].type==="labelLink")&&!i.events[r][1]._balanced){s=i.events[r][1];break}return a;function a(f){return s?s._inactive?d(f):(o=i.parser.defined.includes(Rl(i.sliceSerialize({start:s.end,end:i.now()}))),t.enter("labelEnd"),t.enter("labelMarker"),t.consume(f),t.exit("labelMarker"),t.exit("labelEnd"),l):n(f)}function l(f){return f===40?t.attempt(WQ,c,o?c:d)(f):f===91?t.attempt(qQ,c,o?u:d)(f):o?c(f):d(f)}function u(f){return t.attempt(KQ,c,d)(f)}function c(f){return e(f)}function d(f){return s._balanced=!0,n(f)}}function ZQ(t,e,n){return i;function i(d){return t.enter("resource"),t.enter("resourceMarker"),t.consume(d),t.exit("resourceMarker"),r}function r(d){return ti(d)?Wc(t,s)(d):s(d)}function s(d){return d===41?c(d):$P(t,o,a,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(d)}function o(d){return ti(d)?Wc(t,l)(d):c(d)}function a(d){return n(d)}function l(d){return d===34||d===39||d===40?VP(t,u,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(d):c(d)}function u(d){return ti(d)?Wc(t,c)(d):c(d)}function c(d){return d===41?(t.enter("resourceMarker"),t.consume(d),t.exit("resourceMarker"),t.exit("resource"),e):n(d)}}function JQ(t,e,n){const i=this;return r;function r(a){return zP.call(i,t,s,o,"reference","referenceMarker","referenceString")(a)}function s(a){return i.parser.defined.includes(Rl(i.sliceSerialize(i.events[i.events.length-1][1]).slice(1,-1)))?e(a):n(a)}function o(a){return n(a)}}function eZ(t,e,n){return i;function i(s){return t.enter("reference"),t.enter("referenceMarker"),t.consume(s),t.exit("referenceMarker"),r}function r(s){return s===93?(t.enter("referenceMarker"),t.consume(s),t.exit("referenceMarker"),t.exit("reference"),e):n(s)}}const tZ={name:"labelStartImage",resolveAll:Iv.resolveAll,tokenize:nZ};function nZ(t,e,n){const i=this;return r;function r(a){return t.enter("labelImage"),t.enter("labelImageMarker"),t.consume(a),t.exit("labelImageMarker"),s}function s(a){return a===91?(t.enter("labelMarker"),t.consume(a),t.exit("labelMarker"),t.exit("labelImage"),o):n(a)}function o(a){return a===94&&"_hiddenFootnoteSupport"in i.parser.constructs?n(a):e(a)}}const iZ={name:"labelStartLink",resolveAll:Iv.resolveAll,tokenize:rZ};function rZ(t,e,n){const i=this;return r;function r(o){return t.enter("labelLink"),t.enter("labelMarker"),t.consume(o),t.exit("labelMarker"),t.exit("labelLink"),s}function s(o){return o===94&&"_hiddenFootnoteSupport"in i.parser.constructs?n(o):e(o)}}const Rv={name:"lineEnding",tokenize:sZ};function sZ(t,e){return n;function n(i){return t.enter("lineEnding"),t.consume(i),t.exit("lineEnding"),Ot(t,e,"linePrefix")}}const qh={name:"thematicBreak",tokenize:oZ};function oZ(t,e,n){let i=0,r;return s;function s(u){return t.enter("thematicBreak"),o(u)}function o(u){return r=u,a(u)}function a(u){return u===r?(t.enter("thematicBreakSequence"),l(u)):i>=3&&(u===null||Ke(u))?(t.exit("thematicBreak"),e(u)):n(u)}function l(u){return u===r?(t.consume(u),i++,l):(t.exit("thematicBreakSequence"),gt(u)?Ot(t,a,"whitespace")(u):a(u))}}const ni={continuation:{tokenize:cZ},exit:fZ,name:"list",tokenize:uZ},aZ={partial:!0,tokenize:hZ},lZ={partial:!0,tokenize:dZ};function uZ(t,e,n){const i=this,r=i.events[i.events.length-1];let s=r&&r[1].type==="linePrefix"?r[2].sliceSerialize(r[1],!0).length:0,o=0;return a;function a(h){const p=i.containerState.type||(h===42||h===43||h===45?"listUnordered":"listOrdered");if(p==="listUnordered"?!i.containerState.marker||h===i.containerState.marker:wv(h)){if(i.containerState.type||(i.containerState.type=p,t.enter(p,{_container:!0})),p==="listUnordered")return t.enter("listItemPrefix"),h===42||h===45?t.check(qh,n,u)(h):u(h);if(!i.interrupt||h===49)return t.enter("listItemPrefix"),t.enter("listItemValue"),l(h)}return n(h)}function l(h){return wv(h)&&++o<10?(t.consume(h),l):(!i.interrupt||o<2)&&(i.containerState.marker?h===i.containerState.marker:h===41||h===46)?(t.exit("listItemValue"),u(h)):n(h)}function u(h){return t.enter("listItemMarker"),t.consume(h),t.exit("listItemMarker"),i.containerState.marker=i.containerState.marker||h,t.check(Wh,i.interrupt?n:c,t.attempt(aZ,f,d))}function c(h){return i.containerState.initialBlankLine=!0,s++,f(h)}function d(h){return gt(h)?(t.enter("listItemPrefixWhitespace"),t.consume(h),t.exit("listItemPrefixWhitespace"),f):n(h)}function f(h){return i.containerState.size=s+i.sliceSerialize(t.exit("listItemPrefix"),!0).length,e(h)}}function cZ(t,e,n){const i=this;return i.containerState._closeFlow=void 0,t.check(Wh,r,s);function r(a){return i.containerState.furtherBlankLines=i.containerState.furtherBlankLines||i.containerState.initialBlankLine,Ot(t,e,"listItemIndent",i.containerState.size+1)(a)}function s(a){return i.containerState.furtherBlankLines||!gt(a)?(i.containerState.furtherBlankLines=void 0,i.containerState.initialBlankLine=void 0,o(a)):(i.containerState.furtherBlankLines=void 0,i.containerState.initialBlankLine=void 0,t.attempt(lZ,e,o)(a))}function o(a){return i.containerState._closeFlow=!0,i.interrupt=void 0,Ot(t,t.attempt(ni,e,n),"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(a)}}function dZ(t,e,n){const i=this;return Ot(t,r,"listItemIndent",i.containerState.size+1);function r(s){const o=i.events[i.events.length-1];return o&&o[1].type==="listItemIndent"&&o[2].sliceSerialize(o[1],!0).length===i.containerState.size?e(s):n(s)}}function fZ(t){t.exit(this.containerState.type)}function hZ(t,e,n){const i=this;return Ot(t,r,"listItemPrefixWhitespace",i.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function r(s){const o=i.events[i.events.length-1];return!gt(s)&&o&&o[1].type==="listItemPrefixWhitespace"?e(s):n(s)}}const jP={name:"setextUnderline",resolveTo:pZ,tokenize:mZ};function pZ(t,e){let n=t.length,i,r,s;for(;n--;)if(t[n][0]==="enter"){if(t[n][1].type==="content"){i=n;break}t[n][1].type==="paragraph"&&(r=n)}else t[n][1].type==="content"&&t.splice(n,1),!s&&t[n][1].type==="definition"&&(s=n);const o={type:"setextHeading",start:{...t[i][1].start},end:{...t[t.length-1][1].end}};return t[r][1].type="setextHeadingText",s?(t.splice(r,0,["enter",o,e]),t.splice(s+1,0,["exit",t[i][1],e]),t[i][1].end={...t[s][1].end}):t[i][1]=o,t.push(["exit",o,e]),t}function mZ(t,e,n){const i=this;let r;return s;function s(u){let c=i.events.length,d;for(;c--;)if(i.events[c][1].type!=="lineEnding"&&i.events[c][1].type!=="linePrefix"&&i.events[c][1].type!=="content"){d=i.events[c][1].type==="paragraph";break}return!i.parser.lazy[i.now().line]&&(i.interrupt||d)?(t.enter("setextHeadingLine"),r=u,o(u)):n(u)}function o(u){return t.enter("setextHeadingLineSequence"),a(u)}function a(u){return u===r?(t.consume(u),a):(t.exit("setextHeadingLineSequence"),gt(u)?Ot(t,l,"lineSuffix")(u):l(u))}function l(u){return u===null||Ke(u)?(t.exit("setextHeadingLine"),e(u)):n(u)}}const gZ={tokenize:yZ};function yZ(t){const e=this,n=t.attempt(Wh,i,t.attempt(this.parser.constructs.flowInitial,r,Ot(t,t.attempt(this.parser.constructs.flow,r,t.attempt(SQ,r)),"linePrefix")));return n;function i(s){if(s===null){t.consume(s);return}return t.enter("lineEndingBlank"),t.consume(s),t.exit("lineEndingBlank"),e.currentConstruct=void 0,n}function r(s){if(s===null){t.consume(s);return}return t.enter("lineEnding"),t.consume(s),t.exit("lineEnding"),e.currentConstruct=void 0,n}}const vZ={resolveAll:qP()},bZ=WP("string"),EZ=WP("text");function WP(t){return{resolveAll:qP(t==="text"?TZ:void 0),tokenize:e};function e(n){const i=this,r=this.parser.constructs[t],s=n.attempt(r,o,a);return o;function o(c){return u(c)?s(c):a(c)}function a(c){if(c===null){n.consume(c);return}return n.enter("data"),n.consume(c),l}function l(c){return u(c)?(n.exit("data"),s(c)):(n.consume(c),l)}function u(c){if(c===null)return!0;const d=r[c];let f=-1;if(d)for(;++f<d.length;){const h=d[f];if(!h.previous||h.previous.call(i,i.previous))return!0}return!1}}}function qP(t){return e;function e(n,i){let r=-1,s;for(;++r<=n.length;)s===void 0?n[r]&&n[r][1].type==="data"&&(s=r,r++):(!n[r]||n[r][1].type!=="data")&&(r!==s+2&&(n[s][1].end=n[r-1][1].end,n.splice(s+2,r-s-2),r=s+2),s=void 0);return t?t(n,i):n}}function TZ(t,e){let n=0;for(;++n<=t.length;)if((n===t.length||t[n][1].type==="lineEnding")&&t[n-1][1].type==="data"){const i=t[n-1][1],r=e.sliceStream(i);let s=r.length,o=-1,a=0,l;for(;s--;){const u=r[s];if(typeof u=="string"){for(o=u.length;u.charCodeAt(o-1)===32;)a++,o--;if(o)break;o=-1}else if(u===-2)l=!0,a++;else if(u!==-1){s++;break}}if(e._contentTypeTextTrailing&&n===t.length&&(a=0),a){const u={type:n===t.length||l||a<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:s?o:i.start._bufferIndex+o,_index:i.start._index+s,line:i.end.line,column:i.end.column-a,offset:i.end.offset-a},end:{...i.end}};i.end={...u.start},i.start.offset===i.end.offset?Object.assign(i,u):(t.splice(n,0,["enter",u,e],["exit",u,e]),n+=2)}n++}return t}const SZ=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:{null:[42,95]},contentInitial:{91:CQ},disable:{null:[]},document:{42:ni,43:ni,45:ni,48:ni,49:ni,50:ni,51:ni,52:ni,53:ni,54:ni,55:ni,56:ni,57:ni,62:NP},flow:{35:DQ,42:qh,45:[jP,qh],60:FQ,61:jP,95:qh,96:UP,126:UP},flowInitial:{[-2]:Cv,[-1]:Cv,32:Cv},insideSpan:{null:[Av,vZ]},string:{38:FP,92:MP},text:{[-5]:Rv,[-4]:Rv,[-3]:Rv,33:tZ,38:FP,42:Av,60:[iQ,GQ],91:iZ,92:[PQ,MP],93:Iv,95:Av,96:gQ}},Symbol.toStringTag,{value:"Module"}));function xZ(t,e,n){let i={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0};const r={},s=[];let o=[],a=[];const l={attempt:A(S),check:A(_),consume:v,enter:b,exit:T,interrupt:A(_,{interrupt:!0})},u={code:null,containerState:{},defineSkip:m,events:[],now:p,parser:t,previous:null,sliceSerialize:f,sliceStream:h,write:d};let c=e.tokenize.call(u,l);return e.resolveAll&&s.push(e),u;function d(L){return o=Ui(o,L),y(),o[o.length-1]!==null?[]:(P(e,0),u.events=_v(s,u.events,u),u.events)}function f(L,M){return _Z(h(L),M)}function h(L){return wZ(o,L)}function p(){const{_bufferIndex:L,_index:M,line:V,column:K,offset:U}=i;return{_bufferIndex:L,_index:M,line:V,column:K,offset:U}}function m(L){r[L.line]=L.column,x()}function y(){let L;for(;i._index<o.length;){const M=o[i._index];if(typeof M=="string")for(L=i._index,i._bufferIndex<0&&(i._bufferIndex=0);i._index===L&&i._bufferIndex<M.length;)g(M.charCodeAt(i._bufferIndex));else g(M)}}function g(L){c=c(L)}function v(L){Ke(L)?(i.line++,i.column=1,i.offset+=L===-3?2:1,x()):L!==-1&&(i.column++,i.offset++),i._bufferIndex<0?i._index++:(i._bufferIndex++,i._bufferIndex===o[i._index].length&&(i._bufferIndex=-1,i._index++)),u.previous=L}function b(L,M){const V=M||{};return V.type=L,V.start=p(),u.events.push(["enter",V,u]),a.push(V),V}function T(L){const M=a.pop();return M.end=p(),u.events.push(["exit",M,u]),M}function S(L,M){P(L,M.from)}function _(L,M){M.restore()}function A(L,M){return V;function V(K,U,j){let G,H,Y,D;return Array.isArray(K)?ne(K):"tokenize"in K?ne([K]):ee(K);function ee(ce){return re;function re(Ae){const $e=Ae!==null&&ce[Ae],Ie=Ae!==null&&ce.null,Me=[...Array.isArray($e)?$e:$e?[$e]:[],...Array.isArray(Ie)?Ie:Ie?[Ie]:[]];return ne(Me)(Ae)}}function ne(ce){return G=ce,H=0,ce.length===0?j:N(ce[H])}function N(ce){return re;function re(Ae){return D=O(),Y=ce,ce.partial||(u.currentConstruct=ce),ce.name&&u.parser.constructs.disable.null.includes(ce.name)?we():ce.tokenize.call(M?Object.assign(Object.create(u),M):u,l,le,we)(Ae)}}function le(ce){return L(Y,D),U}function we(ce){return D.restore(),++H<G.length?N(G[H]):j}}}function P(L,M){L.resolveAll&&!s.includes(L)&&s.push(L),L.resolve&&Tr(u.events,M,u.events.length-M,L.resolve(u.events.slice(M),u)),L.resolveTo&&(u.events=L.resolveTo(u.events,u))}function O(){const L=p(),M=u.previous,V=u.currentConstruct,K=u.events.length,U=Array.from(a);return{from:K,restore:j};function j(){i=L,u.previous=M,u.currentConstruct=V,u.events.length=K,a=U,x()}}function x(){i.line in r&&i.column<2&&(i.column=r[i.line],i.offset+=r[i.line]-1)}}function wZ(t,e){const n=e.start._index,i=e.start._bufferIndex,r=e.end._index,s=e.end._bufferIndex;let o;if(n===r)o=[t[n].slice(i,s)];else{if(o=t.slice(n,r),i>-1){const a=o[0];typeof a=="string"?o[0]=a.slice(i):o.shift()}s>0&&o.push(t[r].slice(0,s))}return o}function _Z(t,e){let n=-1;const i=[];let r;for(;++n<t.length;){const s=t[n];let o;if(typeof s=="string")o=s;else switch(s){case-5:{o="\r";break}case-4:{o=`
`;break}case-3:{o=`\r
`;break}case-2:{o=e?" ":"	";break}case-1:{if(!e&&r)continue;o=" ";break}default:o=String.fromCharCode(s)}r=s===-2,i.push(o)}return i.join("")}function AZ(t){const i={constructs:zX([SZ,...(t||{}).extensions||[]]),content:r(XX),defined:[],document:r(ZX),flow:r(gZ),lazy:{},string:r(bZ),text:r(EZ)};return i;function r(s){return o;function o(a){return xZ(i,s,a)}}}function CZ(t){for(;!HP(t););return t}const KP=/[\0\t\n\r]/g;function IZ(){let t=1,e="",n=!0,i;return r;function r(s,o,a){const l=[];let u,c,d,f,h;for(s=e+(typeof s=="string"?s.toString():new TextDecoder(o||void 0).decode(s)),d=0,e="",n&&(s.charCodeAt(0)===65279&&d++,n=void 0);d<s.length;){if(KP.lastIndex=d,u=KP.exec(s),f=u&&u.index!==void 0?u.index:s.length,h=s.charCodeAt(f),!u){e=s.slice(d);break}if(h===10&&d===f&&i)l.push(-3),i=void 0;else switch(i&&(l.push(-5),i=void 0),d<f&&(l.push(s.slice(d,f)),t+=f-d),h){case 0:{l.push(65533),t++;break}case 9:{for(c=Math.ceil(t/4)*4,l.push(-2);t++<c;)l.push(-1);break}case 10:{l.push(-4),t=1;break}default:i=!0,t=1}d=f+1}return a&&(i&&l.push(-5),e&&l.push(e),l.push(null)),l}}const RZ=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function LZ(t){return t.replace(RZ,PZ)}function PZ(t,e,n){if(e)return e;if(n.charCodeAt(0)===35){const r=n.charCodeAt(1),s=r===120||r===88;return PP(n.slice(s?2:1),s?16:10)}return dv(n)||t}function Kh(t){return!t||typeof t!="object"?"":"position"in t||"type"in t?YP(t.position):"start"in t||"end"in t?YP(t):"line"in t||"column"in t?Lv(t):""}function Lv(t){return XP(t&&t.line)+":"+XP(t&&t.column)}function YP(t){return Lv(t&&t.start)+"-"+Lv(t&&t.end)}function XP(t){return t&&typeof t=="number"?t:1}const QP={}.hasOwnProperty;function kZ(t,e,n){return typeof e!="string"&&(n=e,e=void 0),DZ(n)(CZ(AZ(n).document().write(IZ()(t,e,!0))))}function DZ(t){const e={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:s(Z),autolinkProtocol:O,autolinkEmail:O,atxHeading:s(Bt),blockQuote:s(Ie),characterEscape:O,characterReference:O,codeFenced:s(Me),codeFencedFenceInfo:o,codeFencedFenceMeta:o,codeIndented:s(Me,o),codeText:s(Ne,o),codeTextData:O,data:O,codeFlowValue:O,definition:s(at),definitionDestinationString:o,definitionLabelString:o,definitionTitleString:o,emphasis:s(wt),hardBreakEscape:s(We),hardBreakTrailing:s(We),htmlFlow:s(w,o),htmlFlowData:O,htmlText:s(w,o),htmlTextData:O,image:s(B),label:o,link:s(Z),listItem:s(de),listItemValue:f,listOrdered:s(fe,d),listUnordered:s(fe),paragraph:s(Fe),reference:N,referenceString:o,resourceDestinationString:o,resourceTitleString:o,setextHeading:s(Bt),strong:s(_e),thematicBreak:s(mt)},exit:{atxHeading:l(),atxHeadingSequence:S,autolink:l(),autolinkEmail:$e,autolinkProtocol:Ae,blockQuote:l(),characterEscapeValue:x,characterReferenceMarkerHexadecimal:we,characterReferenceMarkerNumeric:we,characterReferenceValue:ce,characterReference:re,codeFenced:l(y),codeFencedFence:m,codeFencedFenceInfo:h,codeFencedFenceMeta:p,codeFlowValue:x,codeIndented:l(g),codeText:l(U),codeTextData:x,data:x,definition:l(),definitionDestinationString:T,definitionLabelString:v,definitionTitleString:b,emphasis:l(),hardBreakEscape:l(M),hardBreakTrailing:l(M),htmlFlow:l(V),htmlFlowData:x,htmlText:l(K),htmlTextData:x,image:l(G),label:Y,labelText:H,lineEnding:L,link:l(j),listItem:l(),listOrdered:l(),listUnordered:l(),paragraph:l(),referenceString:le,resourceDestinationString:D,resourceTitleString:ee,resource:ne,setextHeading:l(P),setextHeadingLineSequence:A,setextHeadingText:_,strong:l(),thematicBreak:l()}};ZP(e,(t||{}).mdastExtensions||[]);const n={};return i;function i(te){let oe={type:"root",children:[]};const ke={stack:[oe],tokenStack:[],config:e,enter:a,exit:u,buffer:o,resume:c,data:n},R=[];let I=-1;for(;++I<te.length;)if(te[I][1].type==="listOrdered"||te[I][1].type==="listUnordered")if(te[I][0]==="enter")R.push(I);else{const F=R.pop();I=r(te,F,I)}for(I=-1;++I<te.length;){const F=e[te[I][0]];QP.call(F,te[I][1].type)&&F[te[I][1].type].call(Object.assign({sliceSerialize:te[I][2].sliceSerialize},ke),te[I][1])}if(ke.tokenStack.length>0){const F=ke.tokenStack[ke.tokenStack.length-1];(F[1]||JP).call(ke,void 0,F[0])}for(oe.position={start:no(te.length>0?te[0][1].start:{line:1,column:1,offset:0}),end:no(te.length>0?te[te.length-2][1].end:{line:1,column:1,offset:0})},I=-1;++I<e.transforms.length;)oe=e.transforms[I](oe)||oe;return oe}function r(te,oe,ke){let R=oe-1,I=-1,F=!1,z,ie,pe,Ve;for(;++R<=ke;){const Ze=te[R];switch(Ze[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{Ze[0]==="enter"?I++:I--,Ve=void 0;break}case"lineEndingBlank":{Ze[0]==="enter"&&(z&&!Ve&&!I&&!pe&&(pe=R),Ve=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:Ve=void 0}if(!I&&Ze[0]==="enter"&&Ze[1].type==="listItemPrefix"||I===-1&&Ze[0]==="exit"&&(Ze[1].type==="listUnordered"||Ze[1].type==="listOrdered")){if(z){let je=R;for(ie=void 0;je--;){const Yt=te[je];if(Yt[1].type==="lineEnding"||Yt[1].type==="lineEndingBlank"){if(Yt[0]==="exit")continue;ie&&(te[ie][1].type="lineEndingBlank",F=!0),Yt[1].type="lineEnding",ie=je}else if(!(Yt[1].type==="linePrefix"||Yt[1].type==="blockQuotePrefix"||Yt[1].type==="blockQuotePrefixWhitespace"||Yt[1].type==="blockQuoteMarker"||Yt[1].type==="listItemIndent"))break}pe&&(!ie||pe<ie)&&(z._spread=!0),z.end=Object.assign({},ie?te[ie][1].start:Ze[1].end),te.splice(ie||R,0,["exit",z,Ze[2]]),R++,ke++}if(Ze[1].type==="listItemPrefix"){const je={type:"listItem",_spread:!1,start:Object.assign({},Ze[1].start),end:void 0};z=je,te.splice(R,0,["enter",je,Ze[2]]),R++,ke++,pe=void 0,Ve=!0}}}return te[oe][1]._spread=F,ke}function s(te,oe){return ke;function ke(R){a.call(this,te(R),R),oe&&oe.call(this,R)}}function o(){this.stack.push({type:"fragment",children:[]})}function a(te,oe,ke){this.stack[this.stack.length-1].children.push(te),this.stack.push(te),this.tokenStack.push([oe,ke||void 0]),te.position={start:no(oe.start),end:void 0}}function l(te){return oe;function oe(ke){te&&te.call(this,ke),u.call(this,ke)}}function u(te,oe){const ke=this.stack.pop(),R=this.tokenStack.pop();if(R)R[0].type!==te.type&&(oe?oe.call(this,te,R[0]):(R[1]||JP).call(this,te,R[0]));else throw new Error("Cannot close `"+te.type+"` ("+Kh({start:te.start,end:te.end})+"): its not open");ke.position.end=no(te.end)}function c(){return HX(this.stack.pop())}function d(){this.data.expectingFirstListItemValue=!0}function f(te){if(this.data.expectingFirstListItemValue){const oe=this.stack[this.stack.length-2];oe.start=Number.parseInt(this.sliceSerialize(te),10),this.data.expectingFirstListItemValue=void 0}}function h(){const te=this.resume(),oe=this.stack[this.stack.length-1];oe.lang=te}function p(){const te=this.resume(),oe=this.stack[this.stack.length-1];oe.meta=te}function m(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function y(){const te=this.resume(),oe=this.stack[this.stack.length-1];oe.value=te.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function g(){const te=this.resume(),oe=this.stack[this.stack.length-1];oe.value=te.replace(/(\r?\n|\r)$/g,"")}function v(te){const oe=this.resume(),ke=this.stack[this.stack.length-1];ke.label=oe,ke.identifier=Rl(this.sliceSerialize(te)).toLowerCase()}function b(){const te=this.resume(),oe=this.stack[this.stack.length-1];oe.title=te}function T(){const te=this.resume(),oe=this.stack[this.stack.length-1];oe.url=te}function S(te){const oe=this.stack[this.stack.length-1];if(!oe.depth){const ke=this.sliceSerialize(te).length;oe.depth=ke}}function _(){this.data.setextHeadingSlurpLineEnding=!0}function A(te){const oe=this.stack[this.stack.length-1];oe.depth=this.sliceSerialize(te).codePointAt(0)===61?1:2}function P(){this.data.setextHeadingSlurpLineEnding=void 0}function O(te){const ke=this.stack[this.stack.length-1].children;let R=ke[ke.length-1];(!R||R.type!=="text")&&(R=ht(),R.position={start:no(te.start),end:void 0},ke.push(R)),this.stack.push(R)}function x(te){const oe=this.stack.pop();oe.value+=this.sliceSerialize(te),oe.position.end=no(te.end)}function L(te){const oe=this.stack[this.stack.length-1];if(this.data.atHardBreak){const ke=oe.children[oe.children.length-1];ke.position.end=no(te.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&e.canContainEols.includes(oe.type)&&(O.call(this,te),x.call(this,te))}function M(){this.data.atHardBreak=!0}function V(){const te=this.resume(),oe=this.stack[this.stack.length-1];oe.value=te}function K(){const te=this.resume(),oe=this.stack[this.stack.length-1];oe.value=te}function U(){const te=this.resume(),oe=this.stack[this.stack.length-1];oe.value=te}function j(){const te=this.stack[this.stack.length-1];if(this.data.inReference){const oe=this.data.referenceType||"shortcut";te.type+="Reference",te.referenceType=oe,delete te.url,delete te.title}else delete te.identifier,delete te.label;this.data.referenceType=void 0}function G(){const te=this.stack[this.stack.length-1];if(this.data.inReference){const oe=this.data.referenceType||"shortcut";te.type+="Reference",te.referenceType=oe,delete te.url,delete te.title}else delete te.identifier,delete te.label;this.data.referenceType=void 0}function H(te){const oe=this.sliceSerialize(te),ke=this.stack[this.stack.length-2];ke.label=LZ(oe),ke.identifier=Rl(oe).toLowerCase()}function Y(){const te=this.stack[this.stack.length-1],oe=this.resume(),ke=this.stack[this.stack.length-1];if(this.data.inReference=!0,ke.type==="link"){const R=te.children;ke.children=R}else ke.alt=oe}function D(){const te=this.resume(),oe=this.stack[this.stack.length-1];oe.url=te}function ee(){const te=this.resume(),oe=this.stack[this.stack.length-1];oe.title=te}function ne(){this.data.inReference=void 0}function N(){this.data.referenceType="collapsed"}function le(te){const oe=this.resume(),ke=this.stack[this.stack.length-1];ke.label=oe,ke.identifier=Rl(this.sliceSerialize(te)).toLowerCase(),this.data.referenceType="full"}function we(te){this.data.characterReferenceType=te.type}function ce(te){const oe=this.sliceSerialize(te),ke=this.data.characterReferenceType;let R;ke?(R=PP(oe,ke==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):R=dv(oe);const I=this.stack[this.stack.length-1];I.value+=R}function re(te){const oe=this.stack.pop();oe.position.end=no(te.end)}function Ae(te){x.call(this,te);const oe=this.stack[this.stack.length-1];oe.url=this.sliceSerialize(te)}function $e(te){x.call(this,te);const oe=this.stack[this.stack.length-1];oe.url="mailto:"+this.sliceSerialize(te)}function Ie(){return{type:"blockquote",children:[]}}function Me(){return{type:"code",lang:null,meta:null,value:""}}function Ne(){return{type:"inlineCode",value:""}}function at(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function wt(){return{type:"emphasis",children:[]}}function Bt(){return{type:"heading",depth:0,children:[]}}function We(){return{type:"break"}}function w(){return{type:"html",value:""}}function B(){return{type:"image",title:null,url:"",alt:null}}function Z(){return{type:"link",title:null,url:"",children:[]}}function fe(te){return{type:"list",ordered:te.type==="listOrdered",start:null,spread:te._spread,children:[]}}function de(te){return{type:"listItem",spread:te._spread,checked:null,children:[]}}function Fe(){return{type:"paragraph",children:[]}}function _e(){return{type:"strong",children:[]}}function ht(){return{type:"text",value:""}}function mt(){return{type:"thematicBreak"}}}function no(t){return{line:t.line,column:t.column,offset:t.offset}}function ZP(t,e){let n=-1;for(;++n<e.length;){const i=e[n];Array.isArray(i)?ZP(t,i):OZ(t,i)}}function OZ(t,e){let n;for(n in e)if(QP.call(e,n))switch(n){case"canContainEols":{const i=e[n];i&&t[n].push(...i);break}case"transforms":{const i=e[n];i&&t[n].push(...i);break}case"enter":case"exit":{const i=e[n];i&&Object.assign(t[n],i);break}}}function JP(t,e){throw t?new Error("Cannot close `"+t.type+"` ("+Kh({start:t.start,end:t.end})+"): a different token (`"+e.type+"`, "+Kh({start:e.start,end:e.end})+") is open"):new Error("Cannot close document, a token (`"+e.type+"`, "+Kh({start:e.start,end:e.end})+") is still open")}function NZ(t){const e=this;e.parser=n;function n(i){return kZ(i,{...e.data("settings"),...t,extensions:e.data("micromarkExtensions")||[],mdastExtensions:e.data("fromMarkdownExtensions")||[]})}}function MZ(t,e){const n={type:"element",tagName:"blockquote",properties:{},children:t.wrap(t.all(e),!0)};return t.patch(e,n),t.applyData(e,n)}function FZ(t,e){const n={type:"element",tagName:"br",properties:{},children:[]};return t.patch(e,n),[t.applyData(e,n),{type:"text",value:`
`}]}function BZ(t,e){const n=e.value?e.value+`
`:"",i={};e.lang&&(i.className=["language-"+e.lang]);let r={type:"element",tagName:"code",properties:i,children:[{type:"text",value:n}]};return e.meta&&(r.data={meta:e.meta}),t.patch(e,r),r=t.applyData(e,r),r={type:"element",tagName:"pre",properties:{},children:[r]},t.patch(e,r),r}function UZ(t,e){const n={type:"element",tagName:"del",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function HZ(t,e){const n={type:"element",tagName:"em",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}const ek=$Z(/[\dA-Za-z]/);function $Z(t){return e;function e(n){return n!==null&&n>-1&&t.test(String.fromCharCode(n))}}function Ll(t){const e=[];let n=-1,i=0,r=0;for(;++n<t.length;){const s=t.charCodeAt(n);let o="";if(s===37&&ek(t.charCodeAt(n+1))&&ek(t.charCodeAt(n+2)))r=2;else if(s<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(s))||(o=String.fromCharCode(s));else if(s>55295&&s<57344){const a=t.charCodeAt(n+1);s<56320&&a>56319&&a<57344?(o=String.fromCharCode(s,a),r=1):o=""}else o=String.fromCharCode(s);o&&(e.push(t.slice(i,n),encodeURIComponent(o)),i=n+r+1,o=""),r&&(n+=r,r=0)}return e.join("")+t.slice(i)}function zZ(t,e){const n=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",i=String(e.identifier).toUpperCase(),r=Ll(i.toLowerCase()),s=t.footnoteOrder.indexOf(i);let o,a=t.footnoteCounts.get(i);a===void 0?(a=0,t.footnoteOrder.push(i),o=t.footnoteOrder.length):o=s+1,a+=1,t.footnoteCounts.set(i,a);const l={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+r,id:n+"fnref-"+r+(a>1?"-"+a:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(o)}]};t.patch(e,l);const u={type:"element",tagName:"sup",properties:{},children:[l]};return t.patch(e,u),t.applyData(e,u)}function VZ(t,e){const n={type:"element",tagName:"h"+e.depth,properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function GZ(t,e){if(t.options.allowDangerousHtml){const n={type:"raw",value:e.value};return t.patch(e,n),t.applyData(e,n)}}function tk(t,e){const n=e.referenceType;let i="]";if(n==="collapsed"?i+="[]":n==="full"&&(i+="["+(e.label||e.identifier)+"]"),e.type==="imageReference")return[{type:"text",value:"!["+e.alt+i}];const r=t.all(e),s=r[0];s&&s.type==="text"?s.value="["+s.value:r.unshift({type:"text",value:"["});const o=r[r.length-1];return o&&o.type==="text"?o.value+=i:r.push({type:"text",value:i}),r}function jZ(t,e){const n=String(e.identifier).toUpperCase(),i=t.definitionById.get(n);if(!i)return tk(t,e);const r={src:Ll(i.url||""),alt:e.alt};i.title!==null&&i.title!==void 0&&(r.title=i.title);const s={type:"element",tagName:"img",properties:r,children:[]};return t.patch(e,s),t.applyData(e,s)}function WZ(t,e){const n={src:Ll(e.url)};e.alt!==null&&e.alt!==void 0&&(n.alt=e.alt),e.title!==null&&e.title!==void 0&&(n.title=e.title);const i={type:"element",tagName:"img",properties:n,children:[]};return t.patch(e,i),t.applyData(e,i)}function qZ(t,e){const n={type:"text",value:e.value.replace(/\r?\n|\r/g," ")};t.patch(e,n);const i={type:"element",tagName:"code",properties:{},children:[n]};return t.patch(e,i),t.applyData(e,i)}function KZ(t,e){const n=String(e.identifier).toUpperCase(),i=t.definitionById.get(n);if(!i)return tk(t,e);const r={href:Ll(i.url||"")};i.title!==null&&i.title!==void 0&&(r.title=i.title);const s={type:"element",tagName:"a",properties:r,children:t.all(e)};return t.patch(e,s),t.applyData(e,s)}function YZ(t,e){const n={href:Ll(e.url)};e.title!==null&&e.title!==void 0&&(n.title=e.title);const i={type:"element",tagName:"a",properties:n,children:t.all(e)};return t.patch(e,i),t.applyData(e,i)}function XZ(t,e,n){const i=t.all(e),r=n?QZ(n):nk(e),s={},o=[];if(typeof e.checked=="boolean"){const c=i[0];let d;c&&c.type==="element"&&c.tagName==="p"?d=c:(d={type:"element",tagName:"p",properties:{},children:[]},i.unshift(d)),d.children.length>0&&d.children.unshift({type:"text",value:" "}),d.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:e.checked,disabled:!0},children:[]}),s.className=["task-list-item"]}let a=-1;for(;++a<i.length;){const c=i[a];(r||a!==0||c.type!=="element"||c.tagName!=="p")&&o.push({type:"text",value:`
`}),c.type==="element"&&c.tagName==="p"&&!r?o.push(...c.children):o.push(c)}const l=i[i.length-1];l&&(r||l.type!=="element"||l.tagName!=="p")&&o.push({type:"text",value:`
`});const u={type:"element",tagName:"li",properties:s,children:o};return t.patch(e,u),t.applyData(e,u)}function QZ(t){let e=!1;if(t.type==="list"){e=t.spread||!1;const n=t.children;let i=-1;for(;!e&&++i<n.length;)e=nk(n[i])}return e}function nk(t){const e=t.spread;return e??t.children.length>1}function ZZ(t,e){const n={},i=t.all(e);let r=-1;for(typeof e.start=="number"&&e.start!==1&&(n.start=e.start);++r<i.length;){const o=i[r];if(o.type==="element"&&o.tagName==="li"&&o.properties&&Array.isArray(o.properties.className)&&o.properties.className.includes("task-list-item")){n.className=["contains-task-list"];break}}const s={type:"element",tagName:e.ordered?"ol":"ul",properties:n,children:t.wrap(i,!0)};return t.patch(e,s),t.applyData(e,s)}function JZ(t,e){const n={type:"element",tagName:"p",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function eJ(t,e){const n={type:"root",children:t.wrap(t.all(e))};return t.patch(e,n),t.applyData(e,n)}function tJ(t,e){const n={type:"element",tagName:"strong",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}const ik=sk("end"),rk=sk("start");function sk(t){return e;function e(n){const i=n&&n.position&&n.position[t]||{};if(typeof i.line=="number"&&i.line>0&&typeof i.column=="number"&&i.column>0)return{line:i.line,column:i.column,offset:typeof i.offset=="number"&&i.offset>-1?i.offset:void 0}}}function nJ(t){const e=rk(t),n=ik(t);if(e&&n)return{start:e,end:n}}function iJ(t,e){const n=t.all(e),i=n.shift(),r=[];if(i){const o={type:"element",tagName:"thead",properties:{},children:t.wrap([i],!0)};t.patch(e.children[0],o),r.push(o)}if(n.length>0){const o={type:"element",tagName:"tbody",properties:{},children:t.wrap(n,!0)},a=rk(e.children[1]),l=ik(e.children[e.children.length-1]);a&&l&&(o.position={start:a,end:l}),r.push(o)}const s={type:"element",tagName:"table",properties:{},children:t.wrap(r,!0)};return t.patch(e,s),t.applyData(e,s)}function rJ(t,e,n){const i=n?n.children:void 0,s=(i?i.indexOf(e):1)===0?"th":"td",o=n&&n.type==="table"?n.align:void 0,a=o?o.length:e.children.length;let l=-1;const u=[];for(;++l<a;){const d=e.children[l],f={},h=o?o[l]:void 0;h&&(f.align=h);let p={type:"element",tagName:s,properties:f,children:[]};d&&(p.children=t.all(d),t.patch(d,p),p=t.applyData(d,p)),u.push(p)}const c={type:"element",tagName:"tr",properties:{},children:t.wrap(u,!0)};return t.patch(e,c),t.applyData(e,c)}function sJ(t,e){const n={type:"element",tagName:"td",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}const ok=9,ak=32;function oJ(t){const e=String(t),n=/\r?\n|\r/g;let i=n.exec(e),r=0;const s=[];for(;i;)s.push(lk(e.slice(r,i.index),r>0,!0),i[0]),r=i.index+i[0].length,i=n.exec(e);return s.push(lk(e.slice(r),r>0,!1)),s.join("")}function lk(t,e,n){let i=0,r=t.length;if(e){let s=t.codePointAt(i);for(;s===ok||s===ak;)i++,s=t.codePointAt(i)}if(n){let s=t.codePointAt(r-1);for(;s===ok||s===ak;)r--,s=t.codePointAt(r-1)}return r>i?t.slice(i,r):""}function aJ(t,e){const n={type:"text",value:oJ(String(e.value))};return t.patch(e,n),t.applyData(e,n)}function lJ(t,e){const n={type:"element",tagName:"hr",properties:{},children:[]};return t.patch(e,n),t.applyData(e,n)}const uJ={blockquote:MZ,break:FZ,code:BZ,delete:UZ,emphasis:HZ,footnoteReference:zZ,heading:VZ,html:GZ,imageReference:jZ,image:WZ,inlineCode:qZ,linkReference:KZ,link:YZ,listItem:XZ,list:ZZ,paragraph:JZ,root:eJ,strong:tJ,table:iJ,tableCell:sJ,tableRow:rJ,text:aJ,thematicBreak:lJ,toml:Yh,yaml:Yh,definition:Yh,footnoteDefinition:Yh};function Yh(){}function cJ(t,e){const n=[{type:"text",value:""}];return e>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(e)}]}),n}function dJ(t,e){return"Back to reference "+(t+1)+(e>1?"-"+e:"")}function fJ(t){const e=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",n=t.options.footnoteBackContent||cJ,i=t.options.footnoteBackLabel||dJ,r=t.options.footnoteLabel||"Footnotes",s=t.options.footnoteLabelTagName||"h2",o=t.options.footnoteLabelProperties||{className:["sr-only"]},a=[];let l=-1;for(;++l<t.footnoteOrder.length;){const u=t.footnoteById.get(t.footnoteOrder[l]);if(!u)continue;const c=t.all(u),d=String(u.identifier).toUpperCase(),f=Ll(d.toLowerCase());let h=0;const p=[],m=t.footnoteCounts.get(d);for(;m!==void 0&&++h<=m;){p.length>0&&p.push({type:"text",value:" "});let v=typeof n=="string"?n:n(l,h);typeof v=="string"&&(v={type:"text",value:v}),p.push({type:"element",tagName:"a",properties:{href:"#"+e+"fnref-"+f+(h>1?"-"+h:""),dataFootnoteBackref:"",ariaLabel:typeof i=="string"?i:i(l,h),className:["data-footnote-backref"]},children:Array.isArray(v)?v:[v]})}const y=c[c.length-1];if(y&&y.type==="element"&&y.tagName==="p"){const v=y.children[y.children.length-1];v&&v.type==="text"?v.value+=" ":y.children.push({type:"text",value:" "}),y.children.push(...p)}else c.push(...p);const g={type:"element",tagName:"li",properties:{id:e+"fn-"+f},children:t.wrap(c,!0)};t.patch(u,g),a.push(g)}if(a.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:s,properties:{...fl(o),id:"footnote-label"},children:[{type:"text",value:r}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:t.wrap(a,!0)},{type:"text",value:`
`}]}}const Pv={}.hasOwnProperty,hJ={};function pJ(t,e){const n=e||hJ,i=new Map,r=new Map,s=new Map,o={...uJ,...n.handlers},a={all:u,applyData:gJ,definitionById:i,footnoteById:r,footnoteCounts:s,footnoteOrder:[],handlers:o,one:l,options:n,patch:mJ,wrap:vJ};return Dh(t,function(c){if(c.type==="definition"||c.type==="footnoteDefinition"){const d=c.type==="definition"?i:r,f=String(c.identifier).toUpperCase();d.has(f)||d.set(f,c)}}),a;function l(c,d){const f=c.type,h=a.handlers[f];if(Pv.call(a.handlers,f)&&h)return h(a,c,d);if(a.options.passThrough&&a.options.passThrough.includes(f)){if("children"in c){const{children:m,...y}=c,g=fl(y);return g.children=a.all(c),g}return fl(c)}return(a.options.unknownHandler||yJ)(a,c,d)}function u(c){const d=[];if("children"in c){const f=c.children;let h=-1;for(;++h<f.length;){const p=a.one(f[h],c);if(p){if(h&&f[h-1].type==="break"&&(!Array.isArray(p)&&p.type==="text"&&(p.value=uk(p.value)),!Array.isArray(p)&&p.type==="element")){const m=p.children[0];m&&m.type==="text"&&(m.value=uk(m.value))}Array.isArray(p)?d.push(...p):d.push(p)}}}return d}}function mJ(t,e){t.position&&(e.position=nJ(t))}function gJ(t,e){let n=e;if(t&&t.data){const i=t.data.hName,r=t.data.hChildren,s=t.data.hProperties;if(typeof i=="string")if(n.type==="element")n.tagName=i;else{const o="children"in n?n.children:[n];n={type:"element",tagName:i,properties:{},children:o}}n.type==="element"&&s&&Object.assign(n.properties,fl(s)),"children"in n&&n.children&&r!==null&&r!==void 0&&(n.children=r)}return n}function yJ(t,e){const n=e.data||{},i="value"in e&&!(Pv.call(n,"hProperties")||Pv.call(n,"hChildren"))?{type:"text",value:e.value}:{type:"element",tagName:"div",properties:{},children:t.all(e)};return t.patch(e,i),t.applyData(e,i)}function vJ(t,e){const n=[];let i=-1;for(e&&n.push({type:"text",value:`
`});++i<t.length;)i&&n.push({type:"text",value:`
`}),n.push(t[i]);return e&&t.length>0&&n.push({type:"text",value:`
`}),n}function uk(t){let e=0,n=t.charCodeAt(e);for(;n===9||n===32;)e++,n=t.charCodeAt(e);return t.slice(e)}function ck(t,e){const n=pJ(t,e),i=n.one(t,void 0),r=fJ(n),s=Array.isArray(i)?{type:"root",children:i}:i||{type:"root",children:[]};return r&&s.children.push({type:"text",value:`
`},r),s}function bJ(t,e){return t&&"run"in t?async function(n,i){const r=ck(n,{file:i,...e});await t.run(r,i)}:function(n,i){return ck(n,{file:i,...t||e})}}function dk(t){if(t)throw t}var Xh=Object.prototype.hasOwnProperty,fk=Object.prototype.toString,hk=Object.defineProperty,pk=Object.getOwnPropertyDescriptor,mk=function(e){return typeof Array.isArray=="function"?Array.isArray(e):fk.call(e)==="[object Array]"},gk=function(e){if(!e||fk.call(e)!=="[object Object]")return!1;var n=Xh.call(e,"constructor"),i=e.constructor&&e.constructor.prototype&&Xh.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!n&&!i)return!1;var r;for(r in e);return typeof r>"u"||Xh.call(e,r)},yk=function(e,n){hk&&n.name==="__proto__"?hk(e,n.name,{enumerable:!0,configurable:!0,value:n.newValue,writable:!0}):e[n.name]=n.newValue},vk=function(e,n){if(n==="__proto__")if(Xh.call(e,n)){if(pk)return pk(e,n).value}else return;return e[n]},EJ=function t(){var e,n,i,r,s,o,a=arguments[0],l=1,u=arguments.length,c=!1;for(typeof a=="boolean"&&(c=a,a=arguments[1]||{},l=2),(a==null||typeof a!="object"&&typeof a!="function")&&(a={});l<u;++l)if(e=arguments[l],e!=null)for(n in e)i=vk(a,n),r=vk(e,n),a!==r&&(c&&r&&(gk(r)||(s=mk(r)))?(s?(s=!1,o=i&&mk(i)?i:[]):o=i&&gk(i)?i:{},yk(a,{name:n,newValue:t(c,o,r)})):typeof r<"u"&&yk(a,{name:n,newValue:r}));return a};const kv=Md(EJ);function Dv(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)}function TJ(){const t=[],e={run:n,use:i};return e;function n(...r){let s=-1;const o=r.pop();if(typeof o!="function")throw new TypeError("Expected function as last argument, not "+o);a(null,...r);function a(l,...u){const c=t[++s];let d=-1;if(l){o(l);return}for(;++d<r.length;)(u[d]===null||u[d]===void 0)&&(u[d]=r[d]);r=u,c?SJ(c,a)(...u):o(null,...u)}}function i(r){if(typeof r!="function")throw new TypeError("Expected `middelware` to be a function, not "+r);return t.push(r),e}}function SJ(t,e){let n;return i;function i(...o){const a=t.length>o.length;let l;a&&o.push(r);try{l=t.apply(this,o)}catch(u){const c=u;if(a&&n)throw c;return r(c)}a||(l&&l.then&&typeof l.then=="function"?l.then(s,r):l instanceof Error?r(l):s(l))}function r(o,...a){n||(n=!0,e(o,...a))}function s(o){r(null,o)}}function xJ(t){return!t||typeof t!="object"?"":"position"in t||"type"in t?bk(t.position):"start"in t||"end"in t?bk(t):"line"in t||"column"in t?Ov(t):""}function Ov(t){return Ek(t&&t.line)+":"+Ek(t&&t.column)}function bk(t){return Ov(t&&t.start)+"-"+Ov(t&&t.end)}function Ek(t){return t&&typeof t=="number"?t:1}class ii extends Error{constructor(e,n,i){super(),typeof n=="string"&&(i=n,n=void 0);let r="",s={},o=!1;if(n&&("line"in n&&"column"in n?s={place:n}:"start"in n&&"end"in n?s={place:n}:"type"in n?s={ancestors:[n],place:n.position}:s={...n}),typeof e=="string"?r=e:!s.cause&&e&&(o=!0,r=e.message,s.cause=e),!s.ruleId&&!s.source&&typeof i=="string"){const l=i.indexOf(":");l===-1?s.ruleId=i:(s.source=i.slice(0,l),s.ruleId=i.slice(l+1))}if(!s.place&&s.ancestors&&s.ancestors){const l=s.ancestors[s.ancestors.length-1];l&&(s.place=l.position)}const a=s.place&&"start"in s.place?s.place.start:s.place;this.ancestors=s.ancestors||void 0,this.cause=s.cause||void 0,this.column=a?a.column:void 0,this.fatal=void 0,this.file="",this.message=r,this.line=a?a.line:void 0,this.name=xJ(s.place)||"1:1",this.place=s.place||void 0,this.reason=this.message,this.ruleId=s.ruleId||void 0,this.source=s.source||void 0,this.stack=o&&s.cause&&typeof s.cause.stack=="string"?s.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}ii.prototype.file="",ii.prototype.name="",ii.prototype.reason="",ii.prototype.message="",ii.prototype.stack="",ii.prototype.column=void 0,ii.prototype.line=void 0,ii.prototype.ancestors=void 0,ii.prototype.cause=void 0,ii.prototype.fatal=void 0,ii.prototype.place=void 0,ii.prototype.ruleId=void 0,ii.prototype.source=void 0;const xr={basename:wJ,dirname:_J,extname:AJ,join:CJ,sep:"/"};function wJ(t,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');qc(t);let n=0,i=-1,r=t.length,s;if(e===void 0||e.length===0||e.length>t.length){for(;r--;)if(t.codePointAt(r)===47){if(s){n=r+1;break}}else i<0&&(s=!0,i=r+1);return i<0?"":t.slice(n,i)}if(e===t)return"";let o=-1,a=e.length-1;for(;r--;)if(t.codePointAt(r)===47){if(s){n=r+1;break}}else o<0&&(s=!0,o=r+1),a>-1&&(t.codePointAt(r)===e.codePointAt(a--)?a<0&&(i=r):(a=-1,i=o));return n===i?i=o:i<0&&(i=t.length),t.slice(n,i)}function _J(t){if(qc(t),t.length===0)return".";let e=-1,n=t.length,i;for(;--n;)if(t.codePointAt(n)===47){if(i){e=n;break}}else i||(i=!0);return e<0?t.codePointAt(0)===47?"/":".":e===1&&t.codePointAt(0)===47?"//":t.slice(0,e)}function AJ(t){qc(t);let e=t.length,n=-1,i=0,r=-1,s=0,o;for(;e--;){const a=t.codePointAt(e);if(a===47){if(o){i=e+1;break}continue}n<0&&(o=!0,n=e+1),a===46?r<0?r=e:s!==1&&(s=1):r>-1&&(s=-1)}return r<0||n<0||s===0||s===1&&r===n-1&&r===i+1?"":t.slice(r,n)}function CJ(...t){let e=-1,n;for(;++e<t.length;)qc(t[e]),t[e]&&(n=n===void 0?t[e]:n+"/"+t[e]);return n===void 0?".":IJ(n)}function IJ(t){qc(t);const e=t.codePointAt(0)===47;let n=RJ(t,!e);return n.length===0&&!e&&(n="."),n.length>0&&t.codePointAt(t.length-1)===47&&(n+="/"),e?"/"+n:n}function RJ(t,e){let n="",i=0,r=-1,s=0,o=-1,a,l;for(;++o<=t.length;){if(o<t.length)a=t.codePointAt(o);else{if(a===47)break;a=47}if(a===47){if(!(r===o-1||s===1))if(r!==o-1&&s===2){if(n.length<2||i!==2||n.codePointAt(n.length-1)!==46||n.codePointAt(n.length-2)!==46){if(n.length>2){if(l=n.lastIndexOf("/"),l!==n.length-1){l<0?(n="",i=0):(n=n.slice(0,l),i=n.length-1-n.lastIndexOf("/")),r=o,s=0;continue}}else if(n.length>0){n="",i=0,r=o,s=0;continue}}e&&(n=n.length>0?n+"/..":"..",i=2)}else n.length>0?n+="/"+t.slice(r+1,o):n=t.slice(r+1,o),i=o-r-1;r=o,s=0}else a===46&&s>-1?s++:s=-1}return n}function qc(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}const LJ={cwd:PJ};function PJ(){return"/"}function Nv(t){return!!(t!==null&&typeof t=="object"&&"href"in t&&t.href&&"protocol"in t&&t.protocol&&t.auth===void 0)}function kJ(t){if(typeof t=="string")t=new URL(t);else if(!Nv(t)){const e=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+t+"`");throw e.code="ERR_INVALID_ARG_TYPE",e}if(t.protocol!=="file:"){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return DJ(t)}function DJ(t){if(t.hostname!==""){const i=new TypeError('File URL host must be "localhost" or empty on darwin');throw i.code="ERR_INVALID_FILE_URL_HOST",i}const e=t.pathname;let n=-1;for(;++n<e.length;)if(e.codePointAt(n)===37&&e.codePointAt(n+1)===50){const i=e.codePointAt(n+2);if(i===70||i===102){const r=new TypeError("File URL path must not include encoded / characters");throw r.code="ERR_INVALID_FILE_URL_PATH",r}}return decodeURIComponent(e)}const Mv=["history","path","basename","stem","extname","dirname"];class OJ{constructor(e){let n;e?Nv(e)?n={path:e}:typeof e=="string"||NJ(e)?n={value:e}:n=e:n={},this.cwd="cwd"in n?"":LJ.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let i=-1;for(;++i<Mv.length;){const s=Mv[i];s in n&&n[s]!==void 0&&n[s]!==null&&(this[s]=s==="history"?[...n[s]]:n[s])}let r;for(r in n)Mv.includes(r)||(this[r]=n[r])}get basename(){return typeof this.path=="string"?xr.basename(this.path):void 0}set basename(e){Bv(e,"basename"),Fv(e,"basename"),this.path=xr.join(this.dirname||"",e)}get dirname(){return typeof this.path=="string"?xr.dirname(this.path):void 0}set dirname(e){Tk(this.basename,"dirname"),this.path=xr.join(e||"",this.basename)}get extname(){return typeof this.path=="string"?xr.extname(this.path):void 0}set extname(e){if(Fv(e,"extname"),Tk(this.dirname,"extname"),e){if(e.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=xr.join(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){Nv(e)&&(e=kJ(e)),Bv(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return typeof this.path=="string"?xr.basename(this.path,this.extname):void 0}set stem(e){Bv(e,"stem"),Fv(e,"stem"),this.path=xr.join(this.dirname||"",e+(this.extname||""))}fail(e,n,i){const r=this.message(e,n,i);throw r.fatal=!0,r}info(e,n,i){const r=this.message(e,n,i);return r.fatal=void 0,r}message(e,n,i){const r=new ii(e,n,i);return this.path&&(r.name=this.path+":"+r.name,r.file=this.path),r.fatal=!1,this.messages.push(r),r}toString(e){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(e||void 0).decode(this.value)}}function Fv(t,e){if(t&&t.includes(xr.sep))throw new Error("`"+e+"` cannot be a path: did not expect `"+xr.sep+"`")}function Bv(t,e){if(!t)throw new Error("`"+e+"` cannot be empty")}function Tk(t,e){if(!t)throw new Error("Setting `"+e+"` requires `path` to be set too")}function NJ(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const MJ=function(t){const i=this.constructor.prototype,r=i[t],s=function(){return r.apply(s,arguments)};return Object.setPrototypeOf(s,i),s},FJ={}.hasOwnProperty;let BJ=class h8 extends MJ{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=TJ()}copy(){const e=new h8;let n=-1;for(;++n<this.attachers.length;){const i=this.attachers[n];e.use(...i)}return e.data(kv(!0,{},this.namespace)),e}data(e,n){return typeof e=="string"?arguments.length===2?($v("data",this.frozen),this.namespace[e]=n,this):FJ.call(this.namespace,e)&&this.namespace[e]||void 0:e?($v("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[n,...i]=this.attachers[this.freezeIndex];if(i[0]===!1)continue;i[0]===!0&&(i[0]=void 0);const r=n.call(e,...i);typeof r=="function"&&this.transformers.use(r)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const n=Qh(e),i=this.parser||this.Parser;return Uv("parse",i),i(String(n),n)}process(e,n){const i=this;return this.freeze(),Uv("process",this.parser||this.Parser),Hv("process",this.compiler||this.Compiler),n?r(void 0,n):new Promise(r);function r(s,o){const a=Qh(e),l=i.parse(a);i.run(l,a,function(c,d,f){if(c||!d||!f)return u(c);const h=d,p=i.stringify(h,f);$J(p)?f.value=p:f.result=p,u(c,f)});function u(c,d){c||!d?o(c):s?s(d):n(void 0,d)}}}processSync(e){let n=!1,i;return this.freeze(),Uv("processSync",this.parser||this.Parser),Hv("processSync",this.compiler||this.Compiler),this.process(e,r),xk("processSync","process",n),i;function r(s,o){n=!0,dk(s),i=o}}run(e,n,i){Sk(e),this.freeze();const r=this.transformers;return!i&&typeof n=="function"&&(i=n,n=void 0),i?s(void 0,i):new Promise(s);function s(o,a){const l=Qh(n);r.run(e,l,u);function u(c,d,f){const h=d||e;c?a(c):o?o(h):i(void 0,h,f)}}}runSync(e,n){let i=!1,r;return this.run(e,n,s),xk("runSync","run",i),r;function s(o,a){dk(o),r=a,i=!0}}stringify(e,n){this.freeze();const i=Qh(n),r=this.compiler||this.Compiler;return Hv("stringify",r),Sk(e),r(e,i)}use(e,...n){const i=this.attachers,r=this.namespace;if($v("use",this.frozen),e!=null)if(typeof e=="function")l(e,n);else if(typeof e=="object")Array.isArray(e)?a(e):o(e);else throw new TypeError("Expected usable value, not `"+e+"`");return this;function s(u){if(typeof u=="function")l(u,[]);else if(typeof u=="object")if(Array.isArray(u)){const[c,...d]=u;l(c,d)}else o(u);else throw new TypeError("Expected usable value, not `"+u+"`")}function o(u){if(!("plugins"in u)&&!("settings"in u))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");a(u.plugins),u.settings&&(r.settings=kv(!0,r.settings,u.settings))}function a(u){let c=-1;if(u!=null)if(Array.isArray(u))for(;++c<u.length;){const d=u[c];s(d)}else throw new TypeError("Expected a list of plugins, not `"+u+"`")}function l(u,c){let d=-1,f=-1;for(;++d<i.length;)if(i[d][0]===u){f=d;break}if(f===-1)i.push([u,...c]);else if(c.length>0){let[h,...p]=c;const m=i[f][1];Dv(m)&&Dv(h)&&(h=kv(!0,m,h)),i[f]=[u,h,...p]}}}};const UJ=new BJ().freeze();function Uv(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `parser`")}function Hv(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `compiler`")}function $v(t,e){if(e)throw new Error("Cannot call `"+t+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function Sk(t){if(!Dv(t)||typeof t.type!="string")throw new TypeError("Expected node, got `"+t+"`")}function xk(t,e,n){if(!n)throw new Error("`"+t+"` finished async. Use `"+e+"` instead")}function Qh(t){return HJ(t)?t:new OJ(t)}function HJ(t){return!!(t&&typeof t=="object"&&"message"in t&&"messages"in t)}function $J(t){return typeof t=="string"||zJ(t)}function zJ(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}var wk={exports:{}},Kc={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _k;function VJ(){if(_k)return Kc;_k=1;var t=lt,e=Symbol.for("react.element"),n=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,r=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function o(a,l,u){var c,d={},f=null,h=null;u!==void 0&&(f=""+u),l.key!==void 0&&(f=""+l.key),l.ref!==void 0&&(h=l.ref);for(c in l)i.call(l,c)&&!s.hasOwnProperty(c)&&(d[c]=l[c]);if(a&&a.defaultProps)for(c in l=a.defaultProps,l)d[c]===void 0&&(d[c]=l[c]);return{$$typeof:e,type:a,key:f,ref:h,props:d,_owner:r.current}}return Kc.Fragment=n,Kc.jsx=o,Kc.jsxs=o,Kc}wk.exports=VJ();var GJ=wk.exports;async function jJ(t){const e=await UJ().use(NZ).use(BX).use(bJ,{allowDangerousHtml:!0}).use(Xj).use(uq).processSync(t);return String(e)}function WJ(t){const[e,n]=lt.useState("");return lt.useEffect(()=>{(async()=>{const i=await jJ(t);n(i)})()},[t]),{html:e,jsx:GJ.jsx("div",{dangerouslySetInnerHTML:{__html:e}})}}const qJ=({value:t,handleClick:e})=>{const n=WJ(t);return k(gh,{onClick:e},k(yh,{dangerouslySetInnerHTML:{__html:n.html}}))},Ak=({value:t,handleClick:e,isContentSearch:n})=>k(gh,{onClick:e},k(yh,{dangerouslySetInnerHTML:{__html:t},"data-content-search":n}));function er(t,e){this.message=t,this.error=e}er.prototype=Object.create(Error.prototype);const zv=/([0-9]+)?:?([0-9]{2}):([0-9]{2}\.[0-9]{2,3})/;function KJ(t,e){e||(e={});const{meta:n=!1,strict:i=!0}=e;if(typeof t!="string")throw new er("Input must be a string");t=t.trim(),t=t.replace(/\r\n/g,`
`),t=t.replace(/\r/g,`
`);const r=t.split(`

`),s=r.shift();if(!s.startsWith("WEBVTT"))throw new er('Must start with "WEBVTT"');const o=s.split(`
`),a=o[0].replace("WEBVTT","");if(a.length>0&&a[0]!==" "&&a[0]!=="	")throw new er("Header comment must start with space or tab");if(r.length===0&&o.length===1)return{valid:!0,strict:i,cues:[],errors:[]};if(!n&&o.length>1&&o[1]!=="")throw new er("Missing blank line after signature");const{cues:l,errors:u}=XJ(r,i);if(i&&u.length>0)throw u[0];const c=n?YJ(o):null,d={valid:u.length===0,strict:i,cues:l,errors:u};return n&&(d.meta=c),d}function YJ(t){const e={};return t.slice(1).forEach(n=>{const i=n.indexOf(":"),r=n.slice(0,i).trim(),s=n.slice(i+1).trim();e[r]=s}),Object.keys(e).length>0?e:null}function XJ(t,e){const n=[];return{cues:t.map((r,s)=>{try{return QJ(r,s,e)}catch(o){return n.push(o),null}}).filter(Boolean),errors:n}}function QJ(t,e,n){let i="",r=0,s=.01,o="",a="";const l=t.split(`
`).filter(Boolean);if(l.length>0&&l[0].trim().startsWith("NOTE"))return null;if(l.length===1&&!l[0].includes("-->"))throw new er(`Cue identifier cannot be standalone (cue #${e})`);if(l.length>1&&!(l[0].includes("-->")||l[1].includes("-->"))){const c=`Cue identifier needs to be followed by timestamp (cue #${e})`;throw new er(c)}l.length>1&&l[1].includes("-->")&&(i=l.shift());const u=typeof l[0]=="string"&&l[0].split(" --> ");if(u.length!==2||!Ck(u[0])||!Ck(u[1]))throw new er(`Invalid cue timestamp (cue #${e})`);if(r=Ik(u[0]),s=Ik(u[1]),n){if(r>s)throw new er(`Start timestamp greater than end (cue #${e})`);if(s<=r)throw new er(`End must be greater than start (cue #${e})`)}if(!n&&s<r)throw new er(`End must be greater or equal to start when not strict (cue #${e})`);return a=u[1].replace(zv,"").trim(),l.shift(),o=l.join(`
`),o?{identifier:i,start:r,end:s,text:o,styles:a}:!1}function Ck(t){return zv.test(t)}function Ik(t){const e=t.match(zv);let n=parseFloat(e[1]||0)*60*60;return n+=parseFloat(e[2])*60,n+=parseFloat(e[3]),n}var Rk={parse:KJ};function $n(t,e){this.message=t,this.error=e}$n.prototype=Object.create(Error.prototype);function ZJ(t){if(!t)throw new $n("Input must be non-null");if(typeof t!="object")throw new $n("Input must be an object");if(Array.isArray(t))throw new $n("Input cannot be array");if(!t.valid)throw new $n("Input must be valid");let e=`WEBVTT
`;if(t.meta){if(typeof t.meta!="object"||Array.isArray(t.meta))throw new $n("Metadata must be an object");Object.entries(t.meta).forEach(i=>{if(typeof i[1]!="string")throw new $n(`Metadata value for "${i[0]}" must be string`);e+=`${i[0]}: ${i[1]}
`})}let n=null;return t.cues.forEach((i,r)=>{if(n&&n>i.start)throw new $n(`Cue number ${r} is not in chronological order`);n=i.start,e+=`
`,e+=JJ(i),e+=`
`}),e}function JJ(t){if(typeof t!="object")throw new $n("Cue malformed: not of type object");if(typeof t.identifier!="string"&&typeof t.identifier!="number"&&t.identifier!==null)throw new $n(`Cue malformed: identifier value is not a string.
    ${JSON.stringify(t)}`);if(isNaN(t.start))throw new $n(`Cue malformed: null start value.
    ${JSON.stringify(t)}`);if(isNaN(t.end))throw new $n(`Cue malformed: null end value.
    ${JSON.stringify(t)}`);if(t.start>=t.end)throw new $n(`Cue malformed: start timestamp greater than end
    ${JSON.stringify(t)}`);if(typeof t.text!="string")throw new $n(`Cue malformed: null text value.
    ${JSON.stringify(t)}`);if(typeof t.styles!="string")throw new $n(`Cue malformed: null styles value.
    ${JSON.stringify(t)}`);let e="";t.identifier.length>0&&(e+=`${t.identifier}
`);const n=Lk(t.start),i=Lk(t.end);return e+=`${n} --> ${i}`,e+=t.styles?` ${t.styles}`:"",e+=`
${t.text}`,e}function Lk(t){const e=Zh(eee(t),2),n=Zh(tee(t),2),i=Zh(nee(t),2),r=Zh(iee(t),3);return`${e}:${n}:${i}.${r}`}function Zh(t,e){let n=`${t}`;for(;n.length<e;)n=`0${n}`;return n}function eee(t){return Math.floor(t/60/60)}function tee(t){return Math.floor(t/60)%60}function nee(t){return Math.floor(t%60)}function iee(t){return Math.floor((t%1).toFixed(4)*1e3)}var ree={compile:ZJ};const see=Rk.parse;function oee(t,e){e=e||10;const n=see(t),i=[];let r=[],s=null,o=0,a=0;return n.cues.forEach((l,u)=>{const c=u===0,d=u===n.cues.length-1,f=l.start,h=l.end,p=d?1/0:n.cues[u+1].start,m=c?h:h-f,y=c?0:f-n.cues[u-1].end;o=o+m+y,`${u}`,i.length+1,s&&(r.push(s),o+=s.end-a,s=null),r.push(l);let g=p-h<e&&y<e&&o>e;if(aee(a,e,p,y)){const v=lee(d,h,e,o,a);i.push({duration:v,cues:r}),a+=v,o=0,r=[]}else g=!1;g&&(s=l)}),i}function aee(t,e,n,i){const r=Pk(i,e);return(i<=e||r+t<n)&&n-t>=e}function lee(t,e,n,i,r){let s=n;return i>n&&(s=Pk(i-n,n)),t?s=parseFloat((e-r).toFixed(2)):s=Math.round(s),s}function Pk(t,e){return t+=e-t%e,t}function vye(t){}var kk={segment:oee};const Dk=kk.segment;function uee(t,e,n){typeof n>"u"&&(n="900000");const i=Dk(t,e),r=[];return i.forEach((s,o)=>{const a=`WEBVTT
X-TIMESTAMP-MAP=MPEGTS:${n},LOCAL:00:00:00.000

${hee(s.cues)}
`,l=Ok(o);r.push({filename:l,content:a})}),r}function cee(t,e){const n=Dk(t,e),i=dee(n);return`#EXTM3U
#EXT-X-TARGETDURATION:${Math.round(fee(n))}
#EXT-X-VERSION:3
#EXT-X-MEDIA-SEQUENCE:0
#EXT-X-PLAYLIST-TYPE:VOD
${i}
#EXT-X-ENDLIST
`}function Jh(t,e){return`${"0".repeat(Math.max(0,e-t.toString().length))}${t}`}function Ok(t){return`${t}.vtt`}function dee(t){const e=[];return t.forEach((n,i)=>{e.push(`#EXTINF:${n.duration.toFixed(5)},
${Ok(i)}`)}),e.join(`
`)}function fee(t){let e=0;return t.forEach(n=>{n.duration>e&&(e=n.duration)}),e}function hee(t){const e=[];return t.forEach(n=>{e.push(pee(n))}),e.join(`

`)}function pee(t){const e=[];t.identifier&&e.push(t.identifier);const n=Nk(t.start),i=Nk(t.end),r=t.styles?`${t.styles}`:"";return e.push(`${n} --> ${i} ${r}`),e.push(t.text),e.join(`
`)}function Nk(t){const e=(t%1).toFixed(3);t=Math.round(t-e);const n=Math.floor(t/3600),i=Math.floor((t-n*3600)/60),r=t-n*3600-i*60;return`${`${Jh(n,2)}:`}${Jh(i,2)}:${Jh(r,2)}.${Jh(e*1e3,3)}`}var mee={hlsSegment:uee,hlsSegmentPlaylist:cee};const gee=Rk.parse,yee=ree.compile,vee=kk.segment;var bee={parse:gee,compile:yee,segment:vee,hls:mee};const Eee=()=>{function t(l){return l.map(u=>{const c=u.identifier||Pa();return{...u,identifier:c}})}function e(l){var f;const u=[],c=[],d=t(l);for(const h of d){for(;c.length>0&&c[c.length-1].end<=h.start;)c.pop();c.length>0?(c[c.length-1].children||(c[c.length-1].children=[]),(f=c[c.length-1].children)==null||f.push(h),c.push(h)):(u.push(h),c.push(h))}return u}function n(l,u=[]){return u.some(c=>l.start>=c.start&&l.end<=c.end)}function i(l=[]){return l.sort((u,c)=>u.start-c.start)}function r(l){const u=l.replace(/<(c|v|i|b|u|lang|ruby)(?:\.([^\s>]+))?(?:\s([^>]+))?>/g,(c,d,f,h)=>{const p=document.createElement(d);return f&&(p.className=f.replace(/\./g," ")),(h==null?void 0:h.length)>0&&(p.title=h),p.outerHTML.replace(new RegExp(`</${d}>$`),"")});return console.log("normalizeVttTags",u),u}function s(l){var u;for(const c of l.children)s(c);if(l.localName==="c"||l.localName==="v"){const c=document.createElement("span");for(const d of l.attributes)c.setAttribute(d.name,d.value);c.innerHTML=l.innerHTML,(u=l.parentNode)==null||u.replaceChild(c,l)}}function o(l){const u=r(l),c=document.createElement("div");return c.innerHTML=u,s(c),c.innerHTML}function a(l){return new Promise((u,c)=>{const d=bee.parse(l);d.errors&&d.errors.length&&c(d.errors),u(d.cues.map(f=>({identifier:f.identifier||Pa(),start:f.start,end:f.end,align:f.align,html:o(f.text),text:f.text||""})))})}return{addIdentifiersToParsedCues:t,createNestedCues:e,isChild:n,orderCuesByTime:i,parseVttData:a}};function Vv(t){const[e,n]=Se(void 0);return xn(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const i=new ResizeObserver(r=>{if(!Array.isArray(r)||!r.length)return;const s=r[0];let o,a;if("borderBoxSize"in s){const l=s.borderBoxSize,u=Array.isArray(l)?l[0]:l;o=u.inlineSize,a=u.blockSize}else o=t.offsetWidth,a=t.offsetHeight;n({width:o,height:a})});return i.observe(t,{box:"border-box"}),()=>i.unobserve(t)}else n(void 0)},[t]),e}function Gv(t){const e=Le({value:t,previous:t});return en(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}var jv="Radio",[Tee,Mk]=hr(jv),[See,xee]=Tee(jv),Fk=Re((t,e)=>{const{__scopeRadio:n,name:i,checked:r=!1,required:s,disabled:o,value:a="on",onCheck:l,form:u,...c}=t,[d,f]=Se(null),h=At(e,y=>f(y)),p=Le(!1),m=d?u||!!d.closest("form"):!0;return ue(See,{scope:n,checked:r,disabled:o,children:[ue(ut.button,{type:"button",role:"radio","aria-checked":r,"data-state":$k(r),"data-disabled":o?"":void 0,disabled:o,value:a,...c,ref:h,onClick:st(t.onClick,y=>{r||l==null||l(),m&&(p.current=y.isPropagationStopped(),p.current||y.stopPropagation())})}),m&&ue(Hk,{control:d,bubbles:!p.current,name:i,value:a,checked:r,required:s,disabled:o,form:u,style:{transform:"translateX(-100%)"}})]})});Fk.displayName=jv;var Bk="RadioIndicator",Uk=Re((t,e)=>{const{__scopeRadio:n,forceMount:i,...r}=t,s=xee(Bk,n);return ue(bc,{present:i||s.checked,children:ue(ut.span,{"data-state":$k(s.checked),"data-disabled":s.disabled?"":void 0,...r,ref:e})})});Uk.displayName=Bk;var wee="RadioBubbleInput",Hk=Re(({__scopeRadio:t,control:e,checked:n,bubbles:i=!0,...r},s)=>{const o=Le(null),a=At(o,s),l=Gv(n),u=Vv(e);return me(()=>{const c=o.current;if(!c)return;const d=window.HTMLInputElement.prototype,h=Object.getOwnPropertyDescriptor(d,"checked").set;if(l!==n&&h){const p=new Event("click",{bubbles:i});h.call(c,n),c.dispatchEvent(p)}},[l,n,i]),ue(ut.input,{type:"radio","aria-hidden":!0,defaultChecked:n,...r,tabIndex:-1,ref:a,style:{...r.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Hk.displayName=wee;function $k(t){return t?"checked":"unchecked"}var _ee=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],ep="RadioGroup",[Aee]=hr(ep,[hh,Mk]),zk=hh(),Vk=Mk(),[Cee,Iee]=Aee(ep),Gk=Re((t,e)=>{const{__scopeRadioGroup:n,name:i,defaultValue:r,value:s,required:o=!1,disabled:a=!1,orientation:l,dir:u,loop:c=!0,onValueChange:d,...f}=t,h=zk(n),p=fh(u),[m,y]=Rs({prop:s,defaultProp:r??null,onChange:d,caller:ep});return ue(Cee,{scope:n,name:i,required:o,disabled:a,value:m,onValueChange:y,children:ue(XC,{asChild:!0,...h,orientation:l,dir:p,loop:c,children:ue(ut.div,{role:"radiogroup","aria-required":o,"aria-orientation":l,"data-disabled":a?"":void 0,dir:p,...f,ref:e})})})});Gk.displayName=ep;var jk="RadioGroupItem",Wk=Re((t,e)=>{const{__scopeRadioGroup:n,disabled:i,...r}=t,s=Iee(jk,n),o=s.disabled||i,a=zk(n),l=Vk(n),u=Le(null),c=At(e,u),d=s.value===r.value,f=Le(!1);return me(()=>{const h=m=>{_ee.includes(m.key)&&(f.current=!0)},p=()=>f.current=!1;return document.addEventListener("keydown",h),document.addEventListener("keyup",p),()=>{document.removeEventListener("keydown",h),document.removeEventListener("keyup",p)}},[]),ue(QC,{asChild:!0,...a,focusable:!o,active:d,children:ue(Fk,{disabled:o,required:s.required,checked:d,...l,...r,name:s.name,ref:c,onCheck:()=>s.onValueChange(r.value),onKeyDown:st(h=>{h.key==="Enter"&&h.preventDefault()}),onFocus:st(r.onFocus,()=>{var h;f.current&&((h=u.current)==null||h.click())})})})});Wk.displayName=jk;var Ree="RadioGroupIndicator",Lee=Re((t,e)=>{const{__scopeRadioGroup:n,...i}=t,r=Vk(n);return ue(Uk,{...r,...i,ref:e})});Lee.displayName=Ree;var qk=Gk,Kk=Wk;const Pee=xe(qk,{display:"flex",flexDirection:"column",width:"100%"}),Yk=xe(Kk,{...lI,justifyContent:"space-between",textAlign:"left",flexGrow:1,margin:0,marginLeft:"-1rem",padding:"0.618rem 1rem",width:"calc(100% + 2rem)",fontSize:"1rem",strong:{marginLeft:"1rem"},"&:hover":{color:"$accent"},"&[aria-checked='true']":{background:"#6662"}}),kee=750,Dee=t=>{for(;t&&t!==document.body;){const e=window.getComputedStyle(t).overflowY;if(e!=="visible"&&e!=="hidden"&&t.scrollHeight>t.clientHeight)return t;t=t.parentNode}return null},Oee=({html:t,text:e,start:n,end:i})=>{var m,y;const r=jn(),{activePlayer:s,configOptions:o,isAutoScrollEnabled:a,isUserScrolling:l}=Nt(),u=(y=(m=o==null?void 0:o.informationPanel)==null?void 0:m.vtt)==null?void 0:y.autoScroll,[c,d]=Se(!1),f=Le(null),h=s;return me(()=>(h==null||h.addEventListener("timeupdate",()=>{const{currentTime:g}=h;d(n<=g&&g<i)}),()=>document.removeEventListener("timeupdate",()=>{})),[i,n,h]),me(()=>{var v;const g=b=>{r({type:"updateAutoScrolling",isAutoScrolling:!0}),b(),setTimeout(()=>r({type:"updateAutoScrolling",isAutoScrolling:!1}),kee)};if(a&&c&&f.current&&!l){const b=f.current;if(b&&b instanceof HTMLElement){const T=Dee(b);if(T&&T instanceof HTMLElement){let S;switch((v=u==null?void 0:u.settings)==null?void 0:v.block){case"center":const _=T.getBoundingClientRect();S=b.offsetTop+b.offsetHeight-Math.floor((_.bottom-_.top)/2);break;case"end":S=b.offsetTop+b.offsetHeight-(T.clientHeight-b.clientHeight)+2;break;default:S=b.offsetTop-2;break}g(()=>{var _;return T.scrollTo({top:S,left:0,behavior:(_=u==null?void 0:u.settings)==null?void 0:_.behavior})})}}}},[u,c,l,a,r]),k(Yk,{ref:f,"aria-checked":c,"data-testid":"information-panel-cue",onClick:()=>{h&&(h.pause(),h.currentTime=n,h.play())},value:e},k("div",{className:"webvtt-cue",dangerouslySetInnerHTML:{__html:t}}),k("strong",null,Bw(n)))},Nee=xe("ul",{listStyle:"none",paddingLeft:"1rem",position:"relative","&&:first-child":{paddingLeft:"0"},"& li ul":{[`& ${Yk}`]:{backgroundColor:"unset","&::before":{content:"none"},"&::after":{content:"none"}}},"&:first-child":{margin:"0 0 1.618rem"}}),Xk=({items:t})=>k(Nee,null,t.map(e=>{const{html:n,text:i,start:r,end:s,children:o,identifier:a}=e;return k("li",{key:a},k(Oee,{html:n,text:i,start:r,end:s}),o&&k(Xk,{items:o}))})),Mee=({inlineCues:t,label:e,vttUri:n})=>{const[i,r]=lt.useState(t||[]),{createNestedCues:s,orderCuesByTime:o,parseVttData:a}=Eee(),[l,u]=lt.useState();return me(()=>{!t&&n&&fetch(n,{redirect:"follow",headers:{Accept:"text/vtt, text/plain, */*"}}).then(c=>{if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);return c.text()}).then(c=>{a(c).then(d=>{const f=o(d),h=s(f);r(h)})}).catch(c=>{console.error(n,c.toString()),u(c)})},[n,t]),k(Pee,{"data-testid":"annotation-item-vtt","aria-label":`${p1(e)}`},l&&k("div",{"data-testid":"error-message"},"Network Error: ",l.toString()),k(Xk,{items:i}))},Wv=({annotation:t,targetResource:e,isContentSearch:n,isContentState:i})=>{var V,K,U,j,G,H,Y;const{target:r}=t,s=(V=r==null?void 0:r.selector)==null?void 0:V.type,o=((U=(K=r==null?void 0:r.selector)==null?void 0:K.value)==null?void 0:U.split("=")[1])||"full",[a,l]=o!=="full"?o==null?void 0:o.split(",").slice(2):[100,100],c=`${e}/${o}/!${((D,ee)=>{const N=Math.max(D,ee),le=Math.round(D/N*100),we=Math.round(ee/N*100);return[le,we].join(",")})(a,l)}/0/default.jpg`,d=Nt(),f=jn(),{openSeadragonViewer:h,vault:p,visibleCanvases:m}=d,y=t!=null&&t.body?(j=t==null?void 0:t.body)==null?void 0:j.map(D=>p.get(D.id)):[],{format:g=s==="PointSelector"?"text/vtt":"text/plain",language:v="none",value:b="",chars:T=""}=y[0]?y[0]:{},S=s==="PointSelector"?"text/vtt":g,_=((G=y[0])==null?void 0:G.label)||{none:["t"]},A=b||T||"None",P=v?H8(v).toLocaleLowerCase():"LTR",O=s==="PointSelector"&&((H=r==null?void 0:r.selector)!=null&&H.t)?[{start:(Y=r==null?void 0:r.selector)==null?void 0:Y.t,end:0,html:A,text:A,styles:"",children:[]}]:void 0;function x(){var ee;const D=h==null?void 0:h.getOverlayById(t.id);if(D&&(h!=null&&h.viewport)){D!=null&&D.element&&((ee=D.element)==null||ee.focus());const ne=D==null?void 0:D.getBounds(h.viewport);ne.x-=.2,ne.y-=.2,ne.width+=.5,ne.height+=.5,h.viewport.fitBounds(ne,!1)}}me(()=>{if(!h||!i)return;const D=setInterval(()=>{(h==null?void 0:h.getOverlayById(t.id))&&(x(),h.container.className="clover-iiif-content-state",clearInterval(D))},1e3);return()=>clearInterval(D)},[h,i]);function L(D){var le;D.preventDefault(),D.stopPropagation();const ee=((le=t==null?void 0:t.target)==null?void 0:le.source)||(t==null?void 0:t.target),ne=ee==null?void 0:ee.id;m.map(we=>we.id).includes(ne)?x():f({type:"updateActiveCanvas",canvasId:ne})}function M(){var D,ee,ne;switch(S){case"text/plain":return l(Ak,{value:A,handleClick:L,isContentSearch:n});case"text/html":return l(Z$,{value:A,handleClick:L});case"text/markdown":return l(qJ,{value:A,handleClick:L});case"text/vtt":return l(Mee,{inlineCues:O,label:_,vttUri:((D=y[0])==null?void 0:D.id)||void 0});case((ee=g==null?void 0:g.match(/^image\//))==null?void 0:ee.input):const N=((ne=y.find(le=>{var we;return!((we=le.id)!=null&&we.includes("vault://"))}))==null?void 0:ne.id)||"";return l(J$,{caption:b,handleClick:L,imageUri:N});default:return l(Ak,{value:A,handleClick:L})}}if(g)return l(Q$,{dir:P,"data-format":g,"data-content":A,className:"clover-iiif-annotation-item"},l("span",{style:{backgroundImage:`url(${c})`,backgroundSize:"cover",backgroundPosition:"center"}}),M())};var Qk={},Yc={},qv={},Xc={},Kv={};Object.defineProperty(Kv,"__esModule",{value:!0}),Kv.default=new Uint16Array('<\0\0\0\0\0\0EMabcfglmnoprstu\\bfmsligP&cutereve;iyx}rc;r;ravepha;acr;d;gpon;f;plyFunction;ingcsr;ign;ildemlaceforsucrkslash;;ed;y;crtause;noullis;a;r;pf;eve;cmpeq;HOacdefhilorsucy;PYcpyute;;italDifferentialD;leys;aeioron;dilrc;nint;ot;dnilla;terDot;i;rcleDMPTot;inus;lus;imes;ocskwiseContourIntegral;eCurlyDQoubleQuote;uote;lnpuon;e;gitruent;nt;ourIntegral;fr;oduct;nterClockwiseContourIntegral;oss;cr;p;Cap;DJSZacefios;otrahd;cy;cy;cy;grsger;r;hv;ayron;;l;ta;r;afcmriticalADGTcute;o;bleAcute;rave;ilde;ond;ferentialD;\0\0\0\0f;;DEot;qual;bleCDLRUVontourIntegrao\0\0nArrow;eoftARTrrow;ightArrow;engLReftARrrow;ightArrow;ightArrow;ightATrrow;ee;p\0\0rrow;ownArrow;erticalBar;nABLRTarrow;BUar;pArrow;reve;eft\0\0ightVector;eeVector;ector;Bar;ight\0eeVector;ector;Bar;ee;Arrow;ctr;rok;NTacdfglmopqstuxG;Hcuteaiyron;rc;ot;r;raveement;apcr;ty\0\0mallSquare;erySmallSquare;gpon;f;silon;uail;Tilde;librium;cir;m;a;mlipsts;onentialE;cfiosy;r;lled\0\0mallSquare;erySmallSquare;\0\0\0f;All;riertrf;cJTabcdfgorstcy;>mma;d;reve;eiydil;rc;;ot;r;;pf;eaterEFGLSTqual;Less;ullEqual;reater;ess;lantEqual;ilde;cr;;AacfiosuRDcy;ctek;;irc;r;lbertSpace;\0f;izontalLine;ctrok;mpownHumqual;EJOacdfgmnostucy;lig;cy;cuteiyrc;ot;r;rave;apcgr;inaryI;lie\0;egrral;section;isibleCTomma;imes;gpton;f;a;cr;ilde;\0cy;lcfosuiyrc;;r;pf;\0r;rcy;kcy;HJacfoscy;cy;ppa;eydil;;r;pf;cr;JTaceflmostcy;<cmnprute;bda;g;lacetrf;r;aeyron;dil;;fstACDFRTUVarnrgleBracket;row;BRar;ightArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ightAVrrow;ector;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;ightsEFGLSTqualGreater;ullEqual;reater;ess;lantEqual;ilde;r;;eftarrow;idot;npwgLRlreftARrrow;ightArrow;ightArrow;eftarightightf;erLReftArrow;ightArrow;cht;rok;;acefiosup;y;dliumSpace;lintrf;r;nusPlus;pf;c;Jacefostucy;cute;aeyron;dil;;gswativeMTVediumSpace;hicneryThitedGLreaterGreateessLesLine;r;Bnptreak;BreakingSpace;f;;CDEGHLNPRSTVoungruent;pCap;oubleVerticalBar;lqxement;ual;Tilde;ists;reater;EFGLSTqual;ullEqual;reater;ess;lantEqual;ilde;umpownHump;qual;efstTriangle;BEar;qual;s;EGLSTqual;reater;ess;lantEqual;ilde;estedGLreaterGreater;essLess;recedes;ESqual;lantEqual;eiverseElement;ghtTriangle;BEar;qual;quuareSubpset;Equal;erset;Equal;bcpset;Equal;ceeds;ESTqual;lantEqual;ilde;erset;Equal;ilde;EFTqual;ullEqual;ilde;erticalBar;cr;ilde;Eacdfgmoprstuvlig;cuteiyrc;blac;r;raveaeicr;ga;cron;pf;enCurlyDQoubleQuote;uote;;clr;ashidees;mlerBParr;acek;et;arenthesis;acfhilorsrtialD;y;r;i;;usMinus;ipncareplanf;;eiocedes;ESTqual;lantEqual;ilde;me;dpuct;ortion;al;cir;;UfosOT"r;pf;cr;BEacefhiorsuarr;Gcnrute;g;r;tl;aeyron;dil;;;verseEUlqement;uilibrium;pEquilibrium;ro;ghtACDFTUVanrgleBracket;row;BLar;eftArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;puf;ndImplies;ightarrow;chr;;leDelayed;HOacfhimoqstuCcHcy;y;FTcy;cute;;aeiyron;dil;rc;;r;ortDLRUownArroweftArrowightArrowpArrow;gma;allCircle;pf;\0\0t;are;ISUntersection;ubpset;Equal;erset;Equal;nion;cr;ar;bcmp;set;Equal;cheeds;ESTqual;lantEqual;ilde;Th;;esrset;Equal;etHRSacfhiorsORNADE;Hccy;y;bu;;aeyron;dil;;r;ei\0efore;a;cnkSpace;Space;lde;EFTqual;ullEqual;ilde;pf;ipleDot;ctr;rok;\0\0\0\0\0\0\0cruter;ocir;r\0y;ve;iyrc;blac;r;raveacr;dierBParr;acek;et;arenthesis;on;Plus;gpon;f;ADETadpsrrow;BDar;ownArrow;ownArrow;quilibrium;ee;Arrow;ownerLReftArrow;ightArrow;i;lon;ing;cr;ilde;mlDbcdefosvash;ar;y;ash;l;er;btyar;;icalBLSTar;ine;eparator;ilde;ThinSpace;r;pf;cr;dash;cefosirc;dge;r;pf;cr;fiosr;;pf;cr;AIUacfosucy;cy;cy;cuteiyrc;;r;pf;cr;ml;Hacdefoscy;cute;ayron;;ot;\0oWidta;r;pf;cr;\0\0\0\0\0\0\0cutereve;;Ediuy;;rcte;lig;r;raveepfpsym;ha;apcclr;g;\0\0;adsvnd;;lope;;;elmrsz;esd;a;;;;;;;;t;vb;d;pth;arr;gpon;f;;Eaeiop;cir;;d;s;rox;eingctyr;;mp;eildemlcioninnt;Nabcdefiklnoprsuot;crkcepsong;psilon;rime;im;eq;ee;ed;gerk;tbrk;oy;quo;cmprtaus;eptyv;snoahw;;een;r;gcostuvwaiurc;pdptot;lus;imes;\0\0cup;ar;riangleduown;p;plus;earow;akocnklstozenge;riangle;dlrown;eft;ight;k;\0\0;;4;ck;eo;q=uiv;t;ptwxf;;tomtie;DHUVbdhmptuvLRlr;;;;;DUdu;;;;LRlr;;;;;HLRhlr;;;;;;ox;LRlr;;;;;DUdu;;;;inus;lus;imes;LRlr;;;;;HLRhlr;;;;;;evbarceior;mi;m;el;bh;sub;l;etp;Ee;;q\0\0\0\0\0\0\0\0\0\0cprute;;abcdsnd;rcup;aup;p;ot;;eot;aeiu\0s;on;dilrc;ps;sm;ot;dmnilptyv;t;err;ceiy;ck;mark;r;Ecefms;;elq;e\0\0rrowlreft;ight;RSacd;st;irc;ash;nint;id;cir;ubs;uit\0on;e;q\0\0a;t;;flemxente\0;dot;nfry;o;sr;aorr;ss;cur;bp;e;;e;dot;delprvwarrlr;;\0\0r;c;arr;p;;bcdosrcap;aup;p;ot;r;;alrvrr;m;yevwq\0\0reuee;edge;enearrowlreftightecioninnt;lcty;AHabcdefhijlorstuwzrar;glrsger;eth;h;varow;aayron;;;aogrr;tseq;glmta;ptyv;irsht;;arlraegsvm;osnd;suit;amma;in;;iode;ontimes;ncy;c\0\0rn;op;lptuwlar;f;;empsq;dot;inus;lus;quare;blebarwedgnadhownarrowarpoonlrefighkaro\0\0rn;op;cotry;;l;rok;drot;i;fahraangle;ciy;grarr;DacdefglmnopqrstuxDoocsuteter;aioyron;r;clon;;ot;Drot;;;rsave;dot;;ilsnters;;;dot;apscr;ty;svetp1;;;gs;p;gpon;f;alsr;sl;us;i;lvon;csuviorc\0\0antgltressaeils;st;v;DD;parsl;Daot;rr;cdir;oah;mrlo;cipl;seoctationential\0\0\0\0\0\0\0llingdotsey;male;ilrlig;\0\0g;ig;;lig;lig;fjaltt;ig;ns;of;\0f;ak;v;artint;aocs\0\0;;;;\0;;\0\0;;5;\0;;8;l;wn;cr;Eabcdefgijlnorstv;l;cmpute;ma;d;reve;iyrc;;ot;;lqs;qslan;cdlc;ot;o;l;;es;r;;gmel;cy;;Eaj;;;Eaes;p;prox;q;qim;pf;cir;m;el;;>;cdlqrci;r;ot;Par;uest;adels\0pror;qlqlesienrtneqq;Aabcefkosyrilmrrsfildrcy;;cwir;;ar;irc;alrrts;uitlip;con;r;sewarow;arow;amoprrr;tht;klreftarrow;ightarrow;f;bar;cltr;asrok;bpull;hen\0\0\0\0\0\0cute;iyrc;cxy;clfr;rave;inoinnt;t;fin;ta;lig;aopcgtr;elpinarh;f;ed;;cfotare;in;tie;do;celpal;grerarhk;rod;cgpty;on;f;a;uestcir;n;Edsv;ot;;v;;ilde;\0cy;lcfmosuiyrc;;r;ath;pf;\0r;rcy;kcy;acfghjosppa;v;eydil;;r;reen;cy;cy;pf;cr;ABEHabcdefghjlmnoprstuvartrail;arr;;g;ar;\0\0\0\0\0\0\0\0\0ute;mptyv;rabda;g;dl;;uor;bfhlpst;fs;s;p;l;im;l;;aeil;;s;abrrr;rk;akcek;;es;ldu;;aeuyron;diil;;cqrsa;uo;rduhar;shar;h;;fgqstahlrtrrow;taarpoonduownpeftarrows;ightahsrrow;sarpoonquigarrohreetimes;;qslan;cdgsc;ot;o;r;;es;adegspproot;qgqgtiilrsht;;;E;rdu;l;lk;cy;;achtrorneard;ri;iodot;ust;acheEaes;p;prox;q;qim;abnoptwznrg;r;rglmreftarightapsto;ightparrowlrefight;aflr;;us;imes;st;;efngear;lt;achmtrornear;d;;ri;achiqtquo;r;m;eg;;buo;r;rok;<;cdhilqrci;r;remes;arr;uest;Piar;;efrdushar;har;enrtneqq;DacdefhilnopsuDot;clprret;;ese;sto;dluowefker;oymma;;ash;asuredangler;o;cdnro;acdsir;otus;bd;u;p;dpels;f;ctr;pos;lmtimap;GLRVabcdefghijlmoprstuvwgt;;veltftarrrow;ightarrow;;;vightarrow;Ddash;ash;bcnptlaute;g;;Eiop;d;s;rour;al;s\0pmp;eaeouy\0;on;dil;ng;dot;p;;ash;;Aadqsxrr;rhrk;;oot;uieiar;ist;sr;Eest;qs;qslani;rAaprrr;ar;;sv;d;cy;AEadestr;rr;r;;fqstarrroightarro;qslan;si;ri;eiptf;;inn;Edv;ot;;;i;v;;aorr;astllel;;lint;;ceu;c;eAaitrrr;cw;;ghtarrowri;echimpqu;ceru;ort\0\0arm;e;qsubpbcp;Ees;et;eq;qc;e;Ees;et;eq;qgilrldeianglelreft;eight;e;m;esro;p;DHadgilrsash;arr;p;ash;et;;>nfin;Aetrr;;;r<ie;Atrr;rie;im;Aanrr;rhrk;;oear;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0csuteiyr;c;abioslac;v;old;lig;crir;;\0\0\0n;ave;bmar;acitrirr;oss;n;aeicr;ga;cdnron;;pf;aelr;rp;;adiosvr;efmr;ofgof;r;lope;;cloashl;idees;as;mlbar;\0\0\0\0\0\0\0\0\0r;ast;lle\0\0m;;y;rcimptnt;od;il;enk;r;imo;v;mane;;tvchfork;aunckk;h;s;abcdemstcir;ir;ou;;nim;wo;ipuntint;f;nd;Eaceinosu;p;u;c;acenspprourlyeaespprox;qq;im;ime;sEasdfpalslar;ine;urf;;trel;cir;;ncsp;fiopsur;pf;rime;cr;aeoteirnionnt;st;eABHabcdefhilmnoprstuxartrail;arar;cdenqrteu;te;imptyv;g;del;;uor;abcfhlpstwp;;fs;;s;l;im;l;;aiil;o;nalabrrrk;akcek;;es;ldu;;aeuyron;diil;;clqsa;dhar;uo;rh;acgl;ipsnart;ilrsht;;aordu;l;;v;gnshtahlrstrrow;taarpoonduowpeftahrrowarpoonightarrows;quigarrohreetimes;g;ingdotseahmra;oust;achemid;abptnrg;r;raflr;;us;imes;apr;gt;olint;arachqquo;r;buo;rhirremes;i;efltri;luhar;;\0\0\0\0\0\0\0cute;qu;Eaceinpsy;\0;on;u;dil;rc;Eas;p;im;olint;i;ot;be;Aacmstxrr;rhr;oti;war;minnut;r;oacoyrp;hycy;;rt\0\0iaragmma;fv;;deglnprot;;q;E;;E;e;lus;arr;araeitlslsetmhp;parsl;dle;;e;s;flptcy;;b;ar;f;adres;uitcsuaup;s;p;s;ubp;eset;e;eset;e;afrarcemtr;tmiararr;fanighteppsilohsbcmnp;Edemnprs;ot;;dot;ult;Ee;;lus;arr;eiut;enq;qeq;qm;bp;;c;acenspprourlyeaespproqg;123;Edehlmnps;ost;ub;;dot;soul;b;arr;ult;Ee;;lus;eiut;enq;qeq;qm;bp;;Aanrr;rhr;owar;lig\0\0\0\0\0\0\0\0\0\0\0\0get;;raeyron;dil;;lrec;r;eiko\0e4fa;svym;cnkaspproimsasrnes;bd;ar;;eps;bcfot;ir;;ork;rime;aipdadempstngle;dlqrowneft;e;ight;eot;inus;lus;b;ime;ezium;chtry;;cy;rok;ioxheadlreftarroightarrowAHabcdfghlmoprstuwrar;cruter\0y;ve;iyrc;abhrlac;airsht;;raverlrlk;ct\0\0rn;erop;ri;alcr;gpon;f;adhlsuownarpoonlrefighi;hlonparrows;cit\0\0rn;erop;ng;ri;cr;dirot;lde;i;famrlangle;ABDacdeflnoprszrar;v;asnrgrt;eknprstappothinhirop;hiugmbpsetneq;q;setneq;q;hretianglelreftighty;ashelr;bear;q;lip;btar;trsubppf;rotrcur;bpnEenEeigzag;cefoprsirc;dibgar;e;q;erp;r;pf;;eatcr;\0\0\0\0\0\0\0trr;Aarr;Aarrais;dptfl;imAarrcqr;ptracefiosucuyte;iyrc;;nr;cy;pf;cr;cmy;lacdefhioswcute;ayron;;ot;ettra;r;cy;grarr;pf;cr;jn;j;'.split("").map(function(t){return t.charCodeAt(0)}));var Yv={};Object.defineProperty(Yv,"__esModule",{value:!0}),Yv.default=new Uint16Array("aglq	\x1B\0\0p;os;t;t;uot;".split("").map(function(t){return t.charCodeAt(0)}));var Xv={};(function(t){var e;Object.defineProperty(t,"__esModule",{value:!0}),t.replaceCodePoint=t.fromCodePoint=void 0;var n=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]);t.fromCodePoint=(e=String.fromCodePoint)!==null&&e!==void 0?e:function(s){var o="";return s>65535&&(s-=65536,o+=String.fromCharCode(s>>>10&1023|55296),s=56320|s&1023),o+=String.fromCharCode(s),o};function i(s){var o;return s>=55296&&s<=57343||s>1114111?65533:(o=n.get(s))!==null&&o!==void 0?o:s}t.replaceCodePoint=i;function r(s){return(0,t.fromCodePoint)(i(s))}t.default=r})(Xv),function(t){var e=qe&&qe.__createBinding||(Object.create?function(L,M,V,K){K===void 0&&(K=V);var U=Object.getOwnPropertyDescriptor(M,V);(!U||("get"in U?!M.__esModule:U.writable||U.configurable))&&(U={enumerable:!0,get:function(){return M[V]}}),Object.defineProperty(L,K,U)}:function(L,M,V,K){K===void 0&&(K=V),L[K]=M[V]}),n=qe&&qe.__setModuleDefault||(Object.create?function(L,M){Object.defineProperty(L,"default",{enumerable:!0,value:M})}:function(L,M){L.default=M}),i=qe&&qe.__importStar||function(L){if(L&&L.__esModule)return L;var M={};if(L!=null)for(var V in L)V!=="default"&&Object.prototype.hasOwnProperty.call(L,V)&&e(M,L,V);return n(M,L),M},r=qe&&qe.__importDefault||function(L){return L&&L.__esModule?L:{default:L}};Object.defineProperty(t,"__esModule",{value:!0}),t.decodeXML=t.decodeHTMLStrict=t.decodeHTMLAttribute=t.decodeHTML=t.determineBranch=t.EntityDecoder=t.DecodingMode=t.BinTrieFlags=t.fromCodePoint=t.replaceCodePoint=t.decodeCodePoint=t.xmlDecodeTree=t.htmlDecodeTree=void 0;var s=r(Kv);t.htmlDecodeTree=s.default;var o=r(Yv);t.xmlDecodeTree=o.default;var a=i(Xv);t.decodeCodePoint=a.default;var l=Xv;Object.defineProperty(t,"replaceCodePoint",{enumerable:!0,get:function(){return l.replaceCodePoint}}),Object.defineProperty(t,"fromCodePoint",{enumerable:!0,get:function(){return l.fromCodePoint}});var u;(function(L){L[L.NUM=35]="NUM",L[L.SEMI=59]="SEMI",L[L.EQUALS=61]="EQUALS",L[L.ZERO=48]="ZERO",L[L.NINE=57]="NINE",L[L.LOWER_A=97]="LOWER_A",L[L.LOWER_F=102]="LOWER_F",L[L.LOWER_X=120]="LOWER_X",L[L.LOWER_Z=122]="LOWER_Z",L[L.UPPER_A=65]="UPPER_A",L[L.UPPER_F=70]="UPPER_F",L[L.UPPER_Z=90]="UPPER_Z"})(u||(u={}));var c=32,d;(function(L){L[L.VALUE_LENGTH=49152]="VALUE_LENGTH",L[L.BRANCH_LENGTH=16256]="BRANCH_LENGTH",L[L.JUMP_TABLE=127]="JUMP_TABLE"})(d=t.BinTrieFlags||(t.BinTrieFlags={}));function f(L){return L>=u.ZERO&&L<=u.NINE}function h(L){return L>=u.UPPER_A&&L<=u.UPPER_F||L>=u.LOWER_A&&L<=u.LOWER_F}function p(L){return L>=u.UPPER_A&&L<=u.UPPER_Z||L>=u.LOWER_A&&L<=u.LOWER_Z||f(L)}function m(L){return L===u.EQUALS||p(L)}var y;(function(L){L[L.EntityStart=0]="EntityStart",L[L.NumericStart=1]="NumericStart",L[L.NumericDecimal=2]="NumericDecimal",L[L.NumericHex=3]="NumericHex",L[L.NamedEntity=4]="NamedEntity"})(y||(y={}));var g;(function(L){L[L.Legacy=0]="Legacy",L[L.Strict=1]="Strict",L[L.Attribute=2]="Attribute"})(g=t.DecodingMode||(t.DecodingMode={}));var v=function(){function L(M,V,K){this.decodeTree=M,this.emitCodePoint=V,this.errors=K,this.state=y.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=g.Strict}return L.prototype.startEntity=function(M){this.decodeMode=M,this.state=y.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1},L.prototype.write=function(M,V){switch(this.state){case y.EntityStart:return M.charCodeAt(V)===u.NUM?(this.state=y.NumericStart,this.consumed+=1,this.stateNumericStart(M,V+1)):(this.state=y.NamedEntity,this.stateNamedEntity(M,V));case y.NumericStart:return this.stateNumericStart(M,V);case y.NumericDecimal:return this.stateNumericDecimal(M,V);case y.NumericHex:return this.stateNumericHex(M,V);case y.NamedEntity:return this.stateNamedEntity(M,V)}},L.prototype.stateNumericStart=function(M,V){return V>=M.length?-1:(M.charCodeAt(V)|c)===u.LOWER_X?(this.state=y.NumericHex,this.consumed+=1,this.stateNumericHex(M,V+1)):(this.state=y.NumericDecimal,this.stateNumericDecimal(M,V))},L.prototype.addToNumericResult=function(M,V,K,U){if(V!==K){var j=K-V;this.result=this.result*Math.pow(U,j)+parseInt(M.substr(V,j),U),this.consumed+=j}},L.prototype.stateNumericHex=function(M,V){for(var K=V;V<M.length;){var U=M.charCodeAt(V);if(f(U)||h(U))V+=1;else return this.addToNumericResult(M,K,V,16),this.emitNumericEntity(U,3)}return this.addToNumericResult(M,K,V,16),-1},L.prototype.stateNumericDecimal=function(M,V){for(var K=V;V<M.length;){var U=M.charCodeAt(V);if(f(U))V+=1;else return this.addToNumericResult(M,K,V,10),this.emitNumericEntity(U,2)}return this.addToNumericResult(M,K,V,10),-1},L.prototype.emitNumericEntity=function(M,V){var K;if(this.consumed<=V)return(K=this.errors)===null||K===void 0||K.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(M===u.SEMI)this.consumed+=1;else if(this.decodeMode===g.Strict)return 0;return this.emitCodePoint((0,a.replaceCodePoint)(this.result),this.consumed),this.errors&&(M!==u.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed},L.prototype.stateNamedEntity=function(M,V){for(var K=this.decodeTree,U=K[this.treeIndex],j=(U&d.VALUE_LENGTH)>>14;V<M.length;V++,this.excess++){var G=M.charCodeAt(V);if(this.treeIndex=T(K,U,this.treeIndex+Math.max(1,j),G),this.treeIndex<0)return this.result===0||this.decodeMode===g.Attribute&&(j===0||m(G))?0:this.emitNotTerminatedNamedEntity();if(U=K[this.treeIndex],j=(U&d.VALUE_LENGTH)>>14,j!==0){if(G===u.SEMI)return this.emitNamedEntityData(this.treeIndex,j,this.consumed+this.excess);this.decodeMode!==g.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1},L.prototype.emitNotTerminatedNamedEntity=function(){var M,V=this,K=V.result,U=V.decodeTree,j=(U[K]&d.VALUE_LENGTH)>>14;return this.emitNamedEntityData(K,j,this.consumed),(M=this.errors)===null||M===void 0||M.missingSemicolonAfterCharacterReference(),this.consumed},L.prototype.emitNamedEntityData=function(M,V,K){var U=this.decodeTree;return this.emitCodePoint(V===1?U[M]&~d.VALUE_LENGTH:U[M+1],K),V===3&&this.emitCodePoint(U[M+2],K),K},L.prototype.end=function(){var M;switch(this.state){case y.NamedEntity:return this.result!==0&&(this.decodeMode!==g.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case y.NumericDecimal:return this.emitNumericEntity(0,2);case y.NumericHex:return this.emitNumericEntity(0,3);case y.NumericStart:return(M=this.errors)===null||M===void 0||M.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case y.EntityStart:return 0}},L}();t.EntityDecoder=v;function b(L){var M="",V=new v(L,function(K){return M+=(0,a.fromCodePoint)(K)});return function(U,j){for(var G=0,H=0;(H=U.indexOf("&",H))>=0;){M+=U.slice(G,H),V.startEntity(j);var Y=V.write(U,H+1);if(Y<0){G=H+V.end();break}G=H+Y,H=Y===0?G+1:G}var D=M+U.slice(G);return M="",D}}function T(L,M,V,K){var U=(M&d.BRANCH_LENGTH)>>7,j=M&d.JUMP_TABLE;if(U===0)return j!==0&&K===j?V:-1;if(j){var G=K-j;return G<0||G>=U?-1:L[V+G]-1}for(var H=V,Y=H+U-1;H<=Y;){var D=H+Y>>>1,ee=L[D];if(ee<K)H=D+1;else if(ee>K)Y=D-1;else return L[D+U]}return-1}t.determineBranch=T;var S=b(s.default),_=b(o.default);function A(L,M){return M===void 0&&(M=g.Legacy),S(L,M)}t.decodeHTML=A;function P(L){return S(L,g.Attribute)}t.decodeHTMLAttribute=P;function O(L){return S(L,g.Strict)}t.decodeHTMLStrict=O;function x(L){return _(L,g.Strict)}t.decodeXML=x}(Xc),function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.QuoteType=void 0;var e=Xc,n;(function(f){f[f.Tab=9]="Tab",f[f.NewLine=10]="NewLine",f[f.FormFeed=12]="FormFeed",f[f.CarriageReturn=13]="CarriageReturn",f[f.Space=32]="Space",f[f.ExclamationMark=33]="ExclamationMark",f[f.Number=35]="Number",f[f.Amp=38]="Amp",f[f.SingleQuote=39]="SingleQuote",f[f.DoubleQuote=34]="DoubleQuote",f[f.Dash=45]="Dash",f[f.Slash=47]="Slash",f[f.Zero=48]="Zero",f[f.Nine=57]="Nine",f[f.Semi=59]="Semi",f[f.Lt=60]="Lt",f[f.Eq=61]="Eq",f[f.Gt=62]="Gt",f[f.Questionmark=63]="Questionmark",f[f.UpperA=65]="UpperA",f[f.LowerA=97]="LowerA",f[f.UpperF=70]="UpperF",f[f.LowerF=102]="LowerF",f[f.UpperZ=90]="UpperZ",f[f.LowerZ=122]="LowerZ",f[f.LowerX=120]="LowerX",f[f.OpeningSquareBracket=91]="OpeningSquareBracket"})(n||(n={}));var i;(function(f){f[f.Text=1]="Text",f[f.BeforeTagName=2]="BeforeTagName",f[f.InTagName=3]="InTagName",f[f.InSelfClosingTag=4]="InSelfClosingTag",f[f.BeforeClosingTagName=5]="BeforeClosingTagName",f[f.InClosingTagName=6]="InClosingTagName",f[f.AfterClosingTagName=7]="AfterClosingTagName",f[f.BeforeAttributeName=8]="BeforeAttributeName",f[f.InAttributeName=9]="InAttributeName",f[f.AfterAttributeName=10]="AfterAttributeName",f[f.BeforeAttributeValue=11]="BeforeAttributeValue",f[f.InAttributeValueDq=12]="InAttributeValueDq",f[f.InAttributeValueSq=13]="InAttributeValueSq",f[f.InAttributeValueNq=14]="InAttributeValueNq",f[f.BeforeDeclaration=15]="BeforeDeclaration",f[f.InDeclaration=16]="InDeclaration",f[f.InProcessingInstruction=17]="InProcessingInstruction",f[f.BeforeComment=18]="BeforeComment",f[f.CDATASequence=19]="CDATASequence",f[f.InSpecialComment=20]="InSpecialComment",f[f.InCommentLike=21]="InCommentLike",f[f.BeforeSpecialS=22]="BeforeSpecialS",f[f.SpecialStartSequence=23]="SpecialStartSequence",f[f.InSpecialTag=24]="InSpecialTag",f[f.BeforeEntity=25]="BeforeEntity",f[f.BeforeNumericEntity=26]="BeforeNumericEntity",f[f.InNamedEntity=27]="InNamedEntity",f[f.InNumericEntity=28]="InNumericEntity",f[f.InHexEntity=29]="InHexEntity"})(i||(i={}));function r(f){return f===n.Space||f===n.NewLine||f===n.Tab||f===n.FormFeed||f===n.CarriageReturn}function s(f){return f===n.Slash||f===n.Gt||r(f)}function o(f){return f>=n.Zero&&f<=n.Nine}function a(f){return f>=n.LowerA&&f<=n.LowerZ||f>=n.UpperA&&f<=n.UpperZ}function l(f){return f>=n.UpperA&&f<=n.UpperF||f>=n.LowerA&&f<=n.LowerF}var u;(function(f){f[f.NoValue=0]="NoValue",f[f.Unquoted=1]="Unquoted",f[f.Single=2]="Single",f[f.Double=3]="Double"})(u=t.QuoteType||(t.QuoteType={}));var c={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101])},d=function(){function f(h,p){var m=h.xmlMode,y=m===void 0?!1:m,g=h.decodeEntities,v=g===void 0?!0:g;this.cbs=p,this.state=i.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=i.Text,this.isSpecial=!1,this.running=!0,this.offset=0,this.currentSequence=void 0,this.sequenceIndex=0,this.trieIndex=0,this.trieCurrent=0,this.entityResult=0,this.entityExcess=0,this.xmlMode=y,this.decodeEntities=v,this.entityTrie=y?e.xmlDecodeTree:e.htmlDecodeTree}return f.prototype.reset=function(){this.state=i.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=i.Text,this.currentSequence=void 0,this.running=!0,this.offset=0},f.prototype.write=function(h){this.offset+=this.buffer.length,this.buffer=h,this.parse()},f.prototype.end=function(){this.running&&this.finish()},f.prototype.pause=function(){this.running=!1},f.prototype.resume=function(){this.running=!0,this.index<this.buffer.length+this.offset&&this.parse()},f.prototype.getIndex=function(){return this.index},f.prototype.getSectionStart=function(){return this.sectionStart},f.prototype.stateText=function(h){h===n.Lt||!this.decodeEntities&&this.fastForwardTo(n.Lt)?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=i.BeforeTagName,this.sectionStart=this.index):this.decodeEntities&&h===n.Amp&&(this.state=i.BeforeEntity)},f.prototype.stateSpecialStartSequence=function(h){var p=this.sequenceIndex===this.currentSequence.length,m=p?s(h):(h|32)===this.currentSequence[this.sequenceIndex];if(!m)this.isSpecial=!1;else if(!p){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=i.InTagName,this.stateInTagName(h)},f.prototype.stateInSpecialTag=function(h){if(this.sequenceIndex===this.currentSequence.length){if(h===n.Gt||r(h)){var p=this.index-this.currentSequence.length;if(this.sectionStart<p){var m=this.index;this.index=p,this.cbs.ontext(this.sectionStart,p),this.index=m}this.isSpecial=!1,this.sectionStart=p+2,this.stateInClosingTagName(h);return}this.sequenceIndex=0}(h|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===c.TitleEnd?this.decodeEntities&&h===n.Amp&&(this.state=i.BeforeEntity):this.fastForwardTo(n.Lt)&&(this.sequenceIndex=1):this.sequenceIndex=+(h===n.Lt)},f.prototype.stateCDATASequence=function(h){h===c.Cdata[this.sequenceIndex]?++this.sequenceIndex===c.Cdata.length&&(this.state=i.InCommentLike,this.currentSequence=c.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=i.InDeclaration,this.stateInDeclaration(h))},f.prototype.fastForwardTo=function(h){for(;++this.index<this.buffer.length+this.offset;)if(this.buffer.charCodeAt(this.index-this.offset)===h)return!0;return this.index=this.buffer.length+this.offset-1,!1},f.prototype.stateInCommentLike=function(h){h===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===c.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index,2):this.cbs.oncomment(this.sectionStart,this.index,2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=i.Text):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):h!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)},f.prototype.isTagStartChar=function(h){return this.xmlMode?!s(h):a(h)},f.prototype.startSpecial=function(h,p){this.isSpecial=!0,this.currentSequence=h,this.sequenceIndex=p,this.state=i.SpecialStartSequence},f.prototype.stateBeforeTagName=function(h){if(h===n.ExclamationMark)this.state=i.BeforeDeclaration,this.sectionStart=this.index+1;else if(h===n.Questionmark)this.state=i.InProcessingInstruction,this.sectionStart=this.index+1;else if(this.isTagStartChar(h)){var p=h|32;this.sectionStart=this.index,!this.xmlMode&&p===c.TitleEnd[2]?this.startSpecial(c.TitleEnd,3):this.state=!this.xmlMode&&p===c.ScriptEnd[2]?i.BeforeSpecialS:i.InTagName}else h===n.Slash?this.state=i.BeforeClosingTagName:(this.state=i.Text,this.stateText(h))},f.prototype.stateInTagName=function(h){s(h)&&(this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=i.BeforeAttributeName,this.stateBeforeAttributeName(h))},f.prototype.stateBeforeClosingTagName=function(h){r(h)||(h===n.Gt?this.state=i.Text:(this.state=this.isTagStartChar(h)?i.InClosingTagName:i.InSpecialComment,this.sectionStart=this.index))},f.prototype.stateInClosingTagName=function(h){(h===n.Gt||r(h))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=i.AfterClosingTagName,this.stateAfterClosingTagName(h))},f.prototype.stateAfterClosingTagName=function(h){(h===n.Gt||this.fastForwardTo(n.Gt))&&(this.state=i.Text,this.baseState=i.Text,this.sectionStart=this.index+1)},f.prototype.stateBeforeAttributeName=function(h){h===n.Gt?(this.cbs.onopentagend(this.index),this.isSpecial?(this.state=i.InSpecialTag,this.sequenceIndex=0):this.state=i.Text,this.baseState=this.state,this.sectionStart=this.index+1):h===n.Slash?this.state=i.InSelfClosingTag:r(h)||(this.state=i.InAttributeName,this.sectionStart=this.index)},f.prototype.stateInSelfClosingTag=function(h){h===n.Gt?(this.cbs.onselfclosingtag(this.index),this.state=i.Text,this.baseState=i.Text,this.sectionStart=this.index+1,this.isSpecial=!1):r(h)||(this.state=i.BeforeAttributeName,this.stateBeforeAttributeName(h))},f.prototype.stateInAttributeName=function(h){(h===n.Eq||s(h))&&(this.cbs.onattribname(this.sectionStart,this.index),this.sectionStart=-1,this.state=i.AfterAttributeName,this.stateAfterAttributeName(h))},f.prototype.stateAfterAttributeName=function(h){h===n.Eq?this.state=i.BeforeAttributeValue:h===n.Slash||h===n.Gt?(this.cbs.onattribend(u.NoValue,this.index),this.state=i.BeforeAttributeName,this.stateBeforeAttributeName(h)):r(h)||(this.cbs.onattribend(u.NoValue,this.index),this.state=i.InAttributeName,this.sectionStart=this.index)},f.prototype.stateBeforeAttributeValue=function(h){h===n.DoubleQuote?(this.state=i.InAttributeValueDq,this.sectionStart=this.index+1):h===n.SingleQuote?(this.state=i.InAttributeValueSq,this.sectionStart=this.index+1):r(h)||(this.sectionStart=this.index,this.state=i.InAttributeValueNq,this.stateInAttributeValueNoQuotes(h))},f.prototype.handleInAttributeValue=function(h,p){h===p||!this.decodeEntities&&this.fastForwardTo(p)?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(p===n.DoubleQuote?u.Double:u.Single,this.index),this.state=i.BeforeAttributeName):this.decodeEntities&&h===n.Amp&&(this.baseState=this.state,this.state=i.BeforeEntity)},f.prototype.stateInAttributeValueDoubleQuotes=function(h){this.handleInAttributeValue(h,n.DoubleQuote)},f.prototype.stateInAttributeValueSingleQuotes=function(h){this.handleInAttributeValue(h,n.SingleQuote)},f.prototype.stateInAttributeValueNoQuotes=function(h){r(h)||h===n.Gt?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(u.Unquoted,this.index),this.state=i.BeforeAttributeName,this.stateBeforeAttributeName(h)):this.decodeEntities&&h===n.Amp&&(this.baseState=this.state,this.state=i.BeforeEntity)},f.prototype.stateBeforeDeclaration=function(h){h===n.OpeningSquareBracket?(this.state=i.CDATASequence,this.sequenceIndex=0):this.state=h===n.Dash?i.BeforeComment:i.InDeclaration},f.prototype.stateInDeclaration=function(h){(h===n.Gt||this.fastForwardTo(n.Gt))&&(this.cbs.ondeclaration(this.sectionStart,this.index),this.state=i.Text,this.sectionStart=this.index+1)},f.prototype.stateInProcessingInstruction=function(h){(h===n.Gt||this.fastForwardTo(n.Gt))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=i.Text,this.sectionStart=this.index+1)},f.prototype.stateBeforeComment=function(h){h===n.Dash?(this.state=i.InCommentLike,this.currentSequence=c.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=i.InDeclaration},f.prototype.stateInSpecialComment=function(h){(h===n.Gt||this.fastForwardTo(n.Gt))&&(this.cbs.oncomment(this.sectionStart,this.index,0),this.state=i.Text,this.sectionStart=this.index+1)},f.prototype.stateBeforeSpecialS=function(h){var p=h|32;p===c.ScriptEnd[3]?this.startSpecial(c.ScriptEnd,4):p===c.StyleEnd[3]?this.startSpecial(c.StyleEnd,4):(this.state=i.InTagName,this.stateInTagName(h))},f.prototype.stateBeforeEntity=function(h){this.entityExcess=1,this.entityResult=0,h===n.Number?this.state=i.BeforeNumericEntity:h===n.Amp||(this.trieIndex=0,this.trieCurrent=this.entityTrie[0],this.state=i.InNamedEntity,this.stateInNamedEntity(h))},f.prototype.stateInNamedEntity=function(h){if(this.entityExcess+=1,this.trieIndex=(0,e.determineBranch)(this.entityTrie,this.trieCurrent,this.trieIndex+1,h),this.trieIndex<0){this.emitNamedEntity(),this.index--;return}this.trieCurrent=this.entityTrie[this.trieIndex];var p=this.trieCurrent&e.BinTrieFlags.VALUE_LENGTH;if(p){var m=(p>>14)-1;if(!this.allowLegacyEntity()&&h!==n.Semi)this.trieIndex+=m;else{var y=this.index-this.entityExcess+1;y>this.sectionStart&&this.emitPartial(this.sectionStart,y),this.entityResult=this.trieIndex,this.trieIndex+=m,this.entityExcess=0,this.sectionStart=this.index+1,m===0&&this.emitNamedEntity()}}},f.prototype.emitNamedEntity=function(){if(this.state=this.baseState,this.entityResult!==0){var h=(this.entityTrie[this.entityResult]&e.BinTrieFlags.VALUE_LENGTH)>>14;switch(h){case 1:{this.emitCodePoint(this.entityTrie[this.entityResult]&~e.BinTrieFlags.VALUE_LENGTH);break}case 2:{this.emitCodePoint(this.entityTrie[this.entityResult+1]);break}case 3:this.emitCodePoint(this.entityTrie[this.entityResult+1]),this.emitCodePoint(this.entityTrie[this.entityResult+2])}}},f.prototype.stateBeforeNumericEntity=function(h){(h|32)===n.LowerX?(this.entityExcess++,this.state=i.InHexEntity):(this.state=i.InNumericEntity,this.stateInNumericEntity(h))},f.prototype.emitNumericEntity=function(h){var p=this.index-this.entityExcess-1,m=p+2+ +(this.state===i.InHexEntity);m!==this.index&&(p>this.sectionStart&&this.emitPartial(this.sectionStart,p),this.sectionStart=this.index+Number(h),this.emitCodePoint((0,e.replaceCodePoint)(this.entityResult))),this.state=this.baseState},f.prototype.stateInNumericEntity=function(h){h===n.Semi?this.emitNumericEntity(!0):o(h)?(this.entityResult=this.entityResult*10+(h-n.Zero),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)},f.prototype.stateInHexEntity=function(h){h===n.Semi?this.emitNumericEntity(!0):o(h)?(this.entityResult=this.entityResult*16+(h-n.Zero),this.entityExcess++):l(h)?(this.entityResult=this.entityResult*16+((h|32)-n.LowerA+10),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)},f.prototype.allowLegacyEntity=function(){return!this.xmlMode&&(this.baseState===i.Text||this.baseState===i.InSpecialTag)},f.prototype.cleanup=function(){this.running&&this.sectionStart!==this.index&&(this.state===i.Text||this.state===i.InSpecialTag&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===i.InAttributeValueDq||this.state===i.InAttributeValueSq||this.state===i.InAttributeValueNq)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))},f.prototype.shouldContinue=function(){return this.index<this.buffer.length+this.offset&&this.running},f.prototype.parse=function(){for(;this.shouldContinue();){var h=this.buffer.charCodeAt(this.index-this.offset);switch(this.state){case i.Text:{this.stateText(h);break}case i.SpecialStartSequence:{this.stateSpecialStartSequence(h);break}case i.InSpecialTag:{this.stateInSpecialTag(h);break}case i.CDATASequence:{this.stateCDATASequence(h);break}case i.InAttributeValueDq:{this.stateInAttributeValueDoubleQuotes(h);break}case i.InAttributeName:{this.stateInAttributeName(h);break}case i.InCommentLike:{this.stateInCommentLike(h);break}case i.InSpecialComment:{this.stateInSpecialComment(h);break}case i.BeforeAttributeName:{this.stateBeforeAttributeName(h);break}case i.InTagName:{this.stateInTagName(h);break}case i.InClosingTagName:{this.stateInClosingTagName(h);break}case i.BeforeTagName:{this.stateBeforeTagName(h);break}case i.AfterAttributeName:{this.stateAfterAttributeName(h);break}case i.InAttributeValueSq:{this.stateInAttributeValueSingleQuotes(h);break}case i.BeforeAttributeValue:{this.stateBeforeAttributeValue(h);break}case i.BeforeClosingTagName:{this.stateBeforeClosingTagName(h);break}case i.AfterClosingTagName:{this.stateAfterClosingTagName(h);break}case i.BeforeSpecialS:{this.stateBeforeSpecialS(h);break}case i.InAttributeValueNq:{this.stateInAttributeValueNoQuotes(h);break}case i.InSelfClosingTag:{this.stateInSelfClosingTag(h);break}case i.InDeclaration:{this.stateInDeclaration(h);break}case i.BeforeDeclaration:{this.stateBeforeDeclaration(h);break}case i.BeforeComment:{this.stateBeforeComment(h);break}case i.InProcessingInstruction:{this.stateInProcessingInstruction(h);break}case i.InNamedEntity:{this.stateInNamedEntity(h);break}case i.BeforeEntity:{this.stateBeforeEntity(h);break}case i.InHexEntity:{this.stateInHexEntity(h);break}case i.InNumericEntity:{this.stateInNumericEntity(h);break}default:this.stateBeforeNumericEntity(h)}this.index++}this.cleanup()},f.prototype.finish=function(){this.state===i.InNamedEntity&&this.emitNamedEntity(),this.sectionStart<this.index&&this.handleTrailingData(),this.cbs.onend()},f.prototype.handleTrailingData=function(){var h=this.buffer.length+this.offset;this.state===i.InCommentLike?this.currentSequence===c.CdataEnd?this.cbs.oncdata(this.sectionStart,h,0):this.cbs.oncomment(this.sectionStart,h,0):this.state===i.InNumericEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===i.InHexEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===i.InTagName||this.state===i.BeforeAttributeName||this.state===i.BeforeAttributeValue||this.state===i.AfterAttributeName||this.state===i.InAttributeName||this.state===i.InAttributeValueSq||this.state===i.InAttributeValueDq||this.state===i.InAttributeValueNq||this.state===i.InClosingTagName||this.cbs.ontext(this.sectionStart,h)},f.prototype.emitPartial=function(h,p){this.baseState!==i.Text&&this.baseState!==i.InSpecialTag?this.cbs.onattribdata(h,p):this.cbs.ontext(h,p)},f.prototype.emitCodePoint=function(h){this.baseState!==i.Text&&this.baseState!==i.InSpecialTag?this.cbs.onattribentity(h):this.cbs.ontextentity(h)},f}();t.default=d}(qv);var Fee=qe&&qe.__createBinding||(Object.create?function(t,e,n,i){i===void 0&&(i=n);var r=Object.getOwnPropertyDescriptor(e,n);(!r||("get"in r?!e.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,i,r)}:function(t,e,n,i){i===void 0&&(i=n),t[i]=e[n]}),Bee=qe&&qe.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Uee=qe&&qe.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)n!=="default"&&Object.prototype.hasOwnProperty.call(t,n)&&Fee(e,t,n);return Bee(e,t),e};Object.defineProperty(Yc,"__esModule",{value:!0}),Yc.Parser=void 0;var tp=Uee(qv),Zk=Xc,Pl=new Set(["input","option","optgroup","select","button","datalist","textarea"]),St=new Set(["p"]),Jk=new Set(["thead","tbody"]),e3=new Set(["dd","dt"]),t3=new Set(["rt","rp"]),Hee=new Map([["tr",new Set(["tr","th","td"])],["th",new Set(["th"])],["td",new Set(["thead","th","td"])],["body",new Set(["head","link","script"])],["li",new Set(["li"])],["p",St],["h1",St],["h2",St],["h3",St],["h4",St],["h5",St],["h6",St],["select",Pl],["input",Pl],["output",Pl],["button",Pl],["datalist",Pl],["textarea",Pl],["option",new Set(["option"])],["optgroup",new Set(["optgroup","option"])],["dd",e3],["dt",e3],["address",St],["article",St],["aside",St],["blockquote",St],["details",St],["div",St],["dl",St],["fieldset",St],["figcaption",St],["figure",St],["footer",St],["form",St],["header",St],["hr",St],["main",St],["nav",St],["ol",St],["pre",St],["section",St],["table",St],["ul",St],["rt",t3],["rp",t3],["tbody",Jk],["tfoot",Jk]]),$ee=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),n3=new Set(["math","svg"]),i3=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignobject","desc","title"]),zee=/\s|\//,Vee=function(){function t(e,n){n===void 0&&(n={});var i,r,s,o,a;this.options=n,this.startIndex=0,this.endIndex=0,this.openTagStart=0,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.foreignContext=[],this.buffers=[],this.bufferOffset=0,this.writeIndex=0,this.ended=!1,this.cbs=e??{},this.lowerCaseTagNames=(i=n.lowerCaseTags)!==null&&i!==void 0?i:!n.xmlMode,this.lowerCaseAttributeNames=(r=n.lowerCaseAttributeNames)!==null&&r!==void 0?r:!n.xmlMode,this.tokenizer=new((s=n.Tokenizer)!==null&&s!==void 0?s:tp.default)(this.options,this),(a=(o=this.cbs).onparserinit)===null||a===void 0||a.call(o,this)}return t.prototype.ontext=function(e,n){var i,r,s=this.getSlice(e,n);this.endIndex=n-1,(r=(i=this.cbs).ontext)===null||r===void 0||r.call(i,s),this.startIndex=n},t.prototype.ontextentity=function(e){var n,i,r=this.tokenizer.getSectionStart();this.endIndex=r-1,(i=(n=this.cbs).ontext)===null||i===void 0||i.call(n,(0,Zk.fromCodePoint)(e)),this.startIndex=r},t.prototype.isVoidElement=function(e){return!this.options.xmlMode&&$ee.has(e)},t.prototype.onopentagname=function(e,n){this.endIndex=n;var i=this.getSlice(e,n);this.lowerCaseTagNames&&(i=i.toLowerCase()),this.emitOpenTag(i)},t.prototype.emitOpenTag=function(e){var n,i,r,s;this.openTagStart=this.startIndex,this.tagname=e;var o=!this.options.xmlMode&&Hee.get(e);if(o)for(;this.stack.length>0&&o.has(this.stack[this.stack.length-1]);){var a=this.stack.pop();(i=(n=this.cbs).onclosetag)===null||i===void 0||i.call(n,a,!0)}this.isVoidElement(e)||(this.stack.push(e),n3.has(e)?this.foreignContext.push(!0):i3.has(e)&&this.foreignContext.push(!1)),(s=(r=this.cbs).onopentagname)===null||s===void 0||s.call(r,e),this.cbs.onopentag&&(this.attribs={})},t.prototype.endOpenTag=function(e){var n,i;this.startIndex=this.openTagStart,this.attribs&&((i=(n=this.cbs).onopentag)===null||i===void 0||i.call(n,this.tagname,this.attribs,e),this.attribs=null),this.cbs.onclosetag&&this.isVoidElement(this.tagname)&&this.cbs.onclosetag(this.tagname,!0),this.tagname=""},t.prototype.onopentagend=function(e){this.endIndex=e,this.endOpenTag(!1),this.startIndex=e+1},t.prototype.onclosetag=function(e,n){var i,r,s,o,a,l;this.endIndex=n;var u=this.getSlice(e,n);if(this.lowerCaseTagNames&&(u=u.toLowerCase()),(n3.has(u)||i3.has(u))&&this.foreignContext.pop(),this.isVoidElement(u))!this.options.xmlMode&&u==="br"&&((r=(i=this.cbs).onopentagname)===null||r===void 0||r.call(i,"br"),(o=(s=this.cbs).onopentag)===null||o===void 0||o.call(s,"br",{},!0),(l=(a=this.cbs).onclosetag)===null||l===void 0||l.call(a,"br",!1));else{var c=this.stack.lastIndexOf(u);if(c!==-1)if(this.cbs.onclosetag)for(var d=this.stack.length-c;d--;)this.cbs.onclosetag(this.stack.pop(),d!==0);else this.stack.length=c;else!this.options.xmlMode&&u==="p"&&(this.emitOpenTag("p"),this.closeCurrentTag(!0))}this.startIndex=n+1},t.prototype.onselfclosingtag=function(e){this.endIndex=e,this.options.xmlMode||this.options.recognizeSelfClosing||this.foreignContext[this.foreignContext.length-1]?(this.closeCurrentTag(!1),this.startIndex=e+1):this.onopentagend(e)},t.prototype.closeCurrentTag=function(e){var n,i,r=this.tagname;this.endOpenTag(e),this.stack[this.stack.length-1]===r&&((i=(n=this.cbs).onclosetag)===null||i===void 0||i.call(n,r,!e),this.stack.pop())},t.prototype.onattribname=function(e,n){this.startIndex=e;var i=this.getSlice(e,n);this.attribname=this.lowerCaseAttributeNames?i.toLowerCase():i},t.prototype.onattribdata=function(e,n){this.attribvalue+=this.getSlice(e,n)},t.prototype.onattribentity=function(e){this.attribvalue+=(0,Zk.fromCodePoint)(e)},t.prototype.onattribend=function(e,n){var i,r;this.endIndex=n,(r=(i=this.cbs).onattribute)===null||r===void 0||r.call(i,this.attribname,this.attribvalue,e===tp.QuoteType.Double?'"':e===tp.QuoteType.Single?"'":e===tp.QuoteType.NoValue?void 0:null),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribvalue=""},t.prototype.getInstructionName=function(e){var n=e.search(zee),i=n<0?e:e.substr(0,n);return this.lowerCaseTagNames&&(i=i.toLowerCase()),i},t.prototype.ondeclaration=function(e,n){this.endIndex=n;var i=this.getSlice(e,n);if(this.cbs.onprocessinginstruction){var r=this.getInstructionName(i);this.cbs.onprocessinginstruction("!".concat(r),"!".concat(i))}this.startIndex=n+1},t.prototype.onprocessinginstruction=function(e,n){this.endIndex=n;var i=this.getSlice(e,n);if(this.cbs.onprocessinginstruction){var r=this.getInstructionName(i);this.cbs.onprocessinginstruction("?".concat(r),"?".concat(i))}this.startIndex=n+1},t.prototype.oncomment=function(e,n,i){var r,s,o,a;this.endIndex=n,(s=(r=this.cbs).oncomment)===null||s===void 0||s.call(r,this.getSlice(e,n-i)),(a=(o=this.cbs).oncommentend)===null||a===void 0||a.call(o),this.startIndex=n+1},t.prototype.oncdata=function(e,n,i){var r,s,o,a,l,u,c,d,f,h;this.endIndex=n;var p=this.getSlice(e,n-i);this.options.xmlMode||this.options.recognizeCDATA?((s=(r=this.cbs).oncdatastart)===null||s===void 0||s.call(r),(a=(o=this.cbs).ontext)===null||a===void 0||a.call(o,p),(u=(l=this.cbs).oncdataend)===null||u===void 0||u.call(l)):((d=(c=this.cbs).oncomment)===null||d===void 0||d.call(c,"[CDATA[".concat(p,"]]")),(h=(f=this.cbs).oncommentend)===null||h===void 0||h.call(f)),this.startIndex=n+1},t.prototype.onend=function(){var e,n;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(var i=this.stack.length;i>0;this.cbs.onclosetag(this.stack[--i],!0));}(n=(e=this.cbs).onend)===null||n===void 0||n.call(e)},t.prototype.reset=function(){var e,n,i,r;(n=(e=this.cbs).onreset)===null||n===void 0||n.call(e),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack.length=0,this.startIndex=0,this.endIndex=0,(r=(i=this.cbs).onparserinit)===null||r===void 0||r.call(i,this),this.buffers.length=0,this.bufferOffset=0,this.writeIndex=0,this.ended=!1},t.prototype.parseComplete=function(e){this.reset(),this.end(e)},t.prototype.getSlice=function(e,n){for(;e-this.bufferOffset>=this.buffers[0].length;)this.shiftBuffer();for(var i=this.buffers[0].slice(e-this.bufferOffset,n-this.bufferOffset);n-this.bufferOffset>this.buffers[0].length;)this.shiftBuffer(),i+=this.buffers[0].slice(0,n-this.bufferOffset);return i},t.prototype.shiftBuffer=function(){this.bufferOffset+=this.buffers[0].length,this.writeIndex--,this.buffers.shift()},t.prototype.write=function(e){var n,i;if(this.ended){(i=(n=this.cbs).onerror)===null||i===void 0||i.call(n,new Error(".write() after done!"));return}this.buffers.push(e),this.tokenizer.running&&(this.tokenizer.write(e),this.writeIndex++)},t.prototype.end=function(e){var n,i;if(this.ended){(i=(n=this.cbs).onerror)===null||i===void 0||i.call(n,new Error(".end() after done!"));return}e&&this.write(e),this.ended=!0,this.tokenizer.end()},t.prototype.pause=function(){this.tokenizer.pause()},t.prototype.resume=function(){for(this.tokenizer.resume();this.tokenizer.running&&this.writeIndex<this.buffers.length;)this.tokenizer.write(this.buffers[this.writeIndex++]);this.ended&&this.tokenizer.end()},t.prototype.parseChunk=function(e){this.write(e)},t.prototype.done=function(e){this.end(e)},t}();Yc.Parser=Vee;var ls={},kl={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Doctype=t.CDATA=t.Tag=t.Style=t.Script=t.Comment=t.Directive=t.Text=t.Root=t.isTag=t.ElementType=void 0;var e;(function(i){i.Root="root",i.Text="text",i.Directive="directive",i.Comment="comment",i.Script="script",i.Style="style",i.Tag="tag",i.CDATA="cdata",i.Doctype="doctype"})(e=t.ElementType||(t.ElementType={}));function n(i){return i.type===e.Tag||i.type===e.Script||i.type===e.Style}t.isTag=n,t.Root=e.Root,t.Text=e.Text,t.Directive=e.Directive,t.Comment=e.Comment,t.Script=e.Script,t.Style=e.Style,t.Tag=e.Tag,t.CDATA=e.CDATA,t.Doctype=e.Doctype})(kl);var ft={},io=qe&&qe.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[s]=r[s])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function i(){this.constructor=e}e.prototype=n===null?Object.create(n):(i.prototype=n.prototype,new i)}}(),Qc=qe&&qe.__assign||function(){return Qc=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},Qc.apply(this,arguments)};Object.defineProperty(ft,"__esModule",{value:!0}),ft.cloneNode=ft.hasChildren=ft.isDocument=ft.isDirective=ft.isComment=ft.isText=ft.isCDATA=ft.isTag=ft.Element=ft.Document=ft.CDATA=ft.NodeWithChildren=ft.ProcessingInstruction=ft.Comment=ft.Text=ft.DataNode=ft.Node=void 0;var ri=kl,Qv=function(){function t(){this.parent=null,this.prev=null,this.next=null,this.startIndex=null,this.endIndex=null}return Object.defineProperty(t.prototype,"parentNode",{get:function(){return this.parent},set:function(e){this.parent=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"previousSibling",{get:function(){return this.prev},set:function(e){this.prev=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nextSibling",{get:function(){return this.next},set:function(e){this.next=e},enumerable:!1,configurable:!0}),t.prototype.cloneNode=function(e){return e===void 0&&(e=!1),Zv(this,e)},t}();ft.Node=Qv;var np=function(t){io(e,t);function e(n){var i=t.call(this)||this;return i.data=n,i}return Object.defineProperty(e.prototype,"nodeValue",{get:function(){return this.data},set:function(n){this.data=n},enumerable:!1,configurable:!0}),e}(Qv);ft.DataNode=np;var r3=function(t){io(e,t);function e(){var n=t!==null&&t.apply(this,arguments)||this;return n.type=ri.ElementType.Text,n}return Object.defineProperty(e.prototype,"nodeType",{get:function(){return 3},enumerable:!1,configurable:!0}),e}(np);ft.Text=r3;var s3=function(t){io(e,t);function e(){var n=t!==null&&t.apply(this,arguments)||this;return n.type=ri.ElementType.Comment,n}return Object.defineProperty(e.prototype,"nodeType",{get:function(){return 8},enumerable:!1,configurable:!0}),e}(np);ft.Comment=s3;var o3=function(t){io(e,t);function e(n,i){var r=t.call(this,i)||this;return r.name=n,r.type=ri.ElementType.Directive,r}return Object.defineProperty(e.prototype,"nodeType",{get:function(){return 1},enumerable:!1,configurable:!0}),e}(np);ft.ProcessingInstruction=o3;var ip=function(t){io(e,t);function e(n){var i=t.call(this)||this;return i.children=n,i}return Object.defineProperty(e.prototype,"firstChild",{get:function(){var n;return(n=this.children[0])!==null&&n!==void 0?n:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastChild",{get:function(){return this.children.length>0?this.children[this.children.length-1]:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"childNodes",{get:function(){return this.children},set:function(n){this.children=n},enumerable:!1,configurable:!0}),e}(Qv);ft.NodeWithChildren=ip;var a3=function(t){io(e,t);function e(){var n=t!==null&&t.apply(this,arguments)||this;return n.type=ri.ElementType.CDATA,n}return Object.defineProperty(e.prototype,"nodeType",{get:function(){return 4},enumerable:!1,configurable:!0}),e}(ip);ft.CDATA=a3;var l3=function(t){io(e,t);function e(){var n=t!==null&&t.apply(this,arguments)||this;return n.type=ri.ElementType.Root,n}return Object.defineProperty(e.prototype,"nodeType",{get:function(){return 9},enumerable:!1,configurable:!0}),e}(ip);ft.Document=l3;var u3=function(t){io(e,t);function e(n,i,r,s){r===void 0&&(r=[]),s===void 0&&(s=n==="script"?ri.ElementType.Script:n==="style"?ri.ElementType.Style:ri.ElementType.Tag);var o=t.call(this,r)||this;return o.name=n,o.attribs=i,o.type=s,o}return Object.defineProperty(e.prototype,"nodeType",{get:function(){return 1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tagName",{get:function(){return this.name},set:function(n){this.name=n},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attributes",{get:function(){var n=this;return Object.keys(this.attribs).map(function(i){var r,s;return{name:i,value:n.attribs[i],namespace:(r=n["x-attribsNamespace"])===null||r===void 0?void 0:r[i],prefix:(s=n["x-attribsPrefix"])===null||s===void 0?void 0:s[i]}})},enumerable:!1,configurable:!0}),e}(ip);ft.Element=u3;function c3(t){return(0,ri.isTag)(t)}ft.isTag=c3;function d3(t){return t.type===ri.ElementType.CDATA}ft.isCDATA=d3;function f3(t){return t.type===ri.ElementType.Text}ft.isText=f3;function h3(t){return t.type===ri.ElementType.Comment}ft.isComment=h3;function p3(t){return t.type===ri.ElementType.Directive}ft.isDirective=p3;function m3(t){return t.type===ri.ElementType.Root}ft.isDocument=m3;function Gee(t){return Object.prototype.hasOwnProperty.call(t,"children")}ft.hasChildren=Gee;function Zv(t,e){e===void 0&&(e=!1);var n;if(f3(t))n=new r3(t.data);else if(h3(t))n=new s3(t.data);else if(c3(t)){var i=e?Jv(t.children):[],r=new u3(t.name,Qc({},t.attribs),i);i.forEach(function(l){return l.parent=r}),t.namespace!=null&&(r.namespace=t.namespace),t["x-attribsNamespace"]&&(r["x-attribsNamespace"]=Qc({},t["x-attribsNamespace"])),t["x-attribsPrefix"]&&(r["x-attribsPrefix"]=Qc({},t["x-attribsPrefix"])),n=r}else if(d3(t)){var i=e?Jv(t.children):[],s=new a3(i);i.forEach(function(u){return u.parent=s}),n=s}else if(m3(t)){var i=e?Jv(t.children):[],o=new l3(i);i.forEach(function(u){return u.parent=o}),t["x-mode"]&&(o["x-mode"]=t["x-mode"]),n=o}else if(p3(t)){var a=new o3(t.name,t.data);t["x-name"]!=null&&(a["x-name"]=t["x-name"],a["x-publicId"]=t["x-publicId"],a["x-systemId"]=t["x-systemId"]),n=a}else throw new Error("Not implemented yet: ".concat(t.type));return n.startIndex=t.startIndex,n.endIndex=t.endIndex,t.sourceCodeLocation!=null&&(n.sourceCodeLocation=t.sourceCodeLocation),n}ft.cloneNode=Zv;function Jv(t){for(var e=t.map(function(i){return Zv(i,!0)}),n=1;n<e.length;n++)e[n].prev=e[n-1],e[n-1].next=e[n];return e}(function(t){var e=qe&&qe.__createBinding||(Object.create?function(a,l,u,c){c===void 0&&(c=u);var d=Object.getOwnPropertyDescriptor(l,u);(!d||("get"in d?!l.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return l[u]}}),Object.defineProperty(a,c,d)}:function(a,l,u,c){c===void 0&&(c=u),a[c]=l[u]}),n=qe&&qe.__exportStar||function(a,l){for(var u in a)u!=="default"&&!Object.prototype.hasOwnProperty.call(l,u)&&e(l,a,u)};Object.defineProperty(t,"__esModule",{value:!0}),t.DomHandler=void 0;var i=kl,r=ft;n(ft,t);var s={withStartIndices:!1,withEndIndices:!1,xmlMode:!1},o=function(){function a(l,u,c){this.dom=[],this.root=new r.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null,typeof u=="function"&&(c=u,u=s),typeof l=="object"&&(u=l,l=void 0),this.callback=l??null,this.options=u??s,this.elementCB=c??null}return a.prototype.onparserinit=function(l){this.parser=l},a.prototype.onreset=function(){this.dom=[],this.root=new r.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null},a.prototype.onend=function(){this.done||(this.done=!0,this.parser=null,this.handleCallback(null))},a.prototype.onerror=function(l){this.handleCallback(l)},a.prototype.onclosetag=function(){this.lastNode=null;var l=this.tagStack.pop();this.options.withEndIndices&&(l.endIndex=this.parser.endIndex),this.elementCB&&this.elementCB(l)},a.prototype.onopentag=function(l,u){var c=this.options.xmlMode?i.ElementType.Tag:void 0,d=new r.Element(l,u,void 0,c);this.addNode(d),this.tagStack.push(d)},a.prototype.ontext=function(l){var u=this.lastNode;if(u&&u.type===i.ElementType.Text)u.data+=l,this.options.withEndIndices&&(u.endIndex=this.parser.endIndex);else{var c=new r.Text(l);this.addNode(c),this.lastNode=c}},a.prototype.oncomment=function(l){if(this.lastNode&&this.lastNode.type===i.ElementType.Comment){this.lastNode.data+=l;return}var u=new r.Comment(l);this.addNode(u),this.lastNode=u},a.prototype.oncommentend=function(){this.lastNode=null},a.prototype.oncdatastart=function(){var l=new r.Text(""),u=new r.CDATA([l]);this.addNode(u),l.parent=u,this.lastNode=l},a.prototype.oncdataend=function(){this.lastNode=null},a.prototype.onprocessinginstruction=function(l,u){var c=new r.ProcessingInstruction(l,u);this.addNode(c)},a.prototype.handleCallback=function(l){if(typeof this.callback=="function")this.callback(l,this.dom);else if(l)throw l},a.prototype.addNode=function(l){var u=this.tagStack[this.tagStack.length-1],c=u.children[u.children.length-1];this.options.withStartIndices&&(l.startIndex=this.parser.startIndex),this.options.withEndIndices&&(l.endIndex=this.parser.endIndex),u.children.push(l),c&&(l.prev=c,c.next=l),l.parent=u,this.lastNode=null},a}();t.DomHandler=o,t.default=o})(ls);var rp={},ro={},Zc={},g3={},ra={},eb={};Object.defineProperty(eb,"__esModule",{value:!0});function sp(t){for(var e=1;e<t.length;e++)t[e][0]+=t[e-1][0]+1;return t}eb.default=new Map(sp([[9,"&Tab;"],[0,"&NewLine;"],[22,"&excl;"],[0,"&quot;"],[0,"&num;"],[0,"&dollar;"],[0,"&percnt;"],[0,"&amp;"],[0,"&apos;"],[0,"&lpar;"],[0,"&rpar;"],[0,"&ast;"],[0,"&plus;"],[0,"&comma;"],[1,"&period;"],[0,"&sol;"],[10,"&colon;"],[0,"&semi;"],[0,{v:"&lt;",n:8402,o:"&nvlt;"}],[0,{v:"&equals;",n:8421,o:"&bne;"}],[0,{v:"&gt;",n:8402,o:"&nvgt;"}],[0,"&quest;"],[0,"&commat;"],[26,"&lbrack;"],[0,"&bsol;"],[0,"&rbrack;"],[0,"&Hat;"],[0,"&lowbar;"],[0,"&DiacriticalGrave;"],[5,{n:106,o:"&fjlig;"}],[20,"&lbrace;"],[0,"&verbar;"],[0,"&rbrace;"],[34,"&nbsp;"],[0,"&iexcl;"],[0,"&cent;"],[0,"&pound;"],[0,"&curren;"],[0,"&yen;"],[0,"&brvbar;"],[0,"&sect;"],[0,"&die;"],[0,"&copy;"],[0,"&ordf;"],[0,"&laquo;"],[0,"&not;"],[0,"&shy;"],[0,"&circledR;"],[0,"&macr;"],[0,"&deg;"],[0,"&PlusMinus;"],[0,"&sup2;"],[0,"&sup3;"],[0,"&acute;"],[0,"&micro;"],[0,"&para;"],[0,"&centerdot;"],[0,"&cedil;"],[0,"&sup1;"],[0,"&ordm;"],[0,"&raquo;"],[0,"&frac14;"],[0,"&frac12;"],[0,"&frac34;"],[0,"&iquest;"],[0,"&Agrave;"],[0,"&Aacute;"],[0,"&Acirc;"],[0,"&Atilde;"],[0,"&Auml;"],[0,"&angst;"],[0,"&AElig;"],[0,"&Ccedil;"],[0,"&Egrave;"],[0,"&Eacute;"],[0,"&Ecirc;"],[0,"&Euml;"],[0,"&Igrave;"],[0,"&Iacute;"],[0,"&Icirc;"],[0,"&Iuml;"],[0,"&ETH;"],[0,"&Ntilde;"],[0,"&Ograve;"],[0,"&Oacute;"],[0,"&Ocirc;"],[0,"&Otilde;"],[0,"&Ouml;"],[0,"&times;"],[0,"&Oslash;"],[0,"&Ugrave;"],[0,"&Uacute;"],[0,"&Ucirc;"],[0,"&Uuml;"],[0,"&Yacute;"],[0,"&THORN;"],[0,"&szlig;"],[0,"&agrave;"],[0,"&aacute;"],[0,"&acirc;"],[0,"&atilde;"],[0,"&auml;"],[0,"&aring;"],[0,"&aelig;"],[0,"&ccedil;"],[0,"&egrave;"],[0,"&eacute;"],[0,"&ecirc;"],[0,"&euml;"],[0,"&igrave;"],[0,"&iacute;"],[0,"&icirc;"],[0,"&iuml;"],[0,"&eth;"],[0,"&ntilde;"],[0,"&ograve;"],[0,"&oacute;"],[0,"&ocirc;"],[0,"&otilde;"],[0,"&ouml;"],[0,"&div;"],[0,"&oslash;"],[0,"&ugrave;"],[0,"&uacute;"],[0,"&ucirc;"],[0,"&uuml;"],[0,"&yacute;"],[0,"&thorn;"],[0,"&yuml;"],[0,"&Amacr;"],[0,"&amacr;"],[0,"&Abreve;"],[0,"&abreve;"],[0,"&Aogon;"],[0,"&aogon;"],[0,"&Cacute;"],[0,"&cacute;"],[0,"&Ccirc;"],[0,"&ccirc;"],[0,"&Cdot;"],[0,"&cdot;"],[0,"&Ccaron;"],[0,"&ccaron;"],[0,"&Dcaron;"],[0,"&dcaron;"],[0,"&Dstrok;"],[0,"&dstrok;"],[0,"&Emacr;"],[0,"&emacr;"],[2,"&Edot;"],[0,"&edot;"],[0,"&Eogon;"],[0,"&eogon;"],[0,"&Ecaron;"],[0,"&ecaron;"],[0,"&Gcirc;"],[0,"&gcirc;"],[0,"&Gbreve;"],[0,"&gbreve;"],[0,"&Gdot;"],[0,"&gdot;"],[0,"&Gcedil;"],[1,"&Hcirc;"],[0,"&hcirc;"],[0,"&Hstrok;"],[0,"&hstrok;"],[0,"&Itilde;"],[0,"&itilde;"],[0,"&Imacr;"],[0,"&imacr;"],[2,"&Iogon;"],[0,"&iogon;"],[0,"&Idot;"],[0,"&imath;"],[0,"&IJlig;"],[0,"&ijlig;"],[0,"&Jcirc;"],[0,"&jcirc;"],[0,"&Kcedil;"],[0,"&kcedil;"],[0,"&kgreen;"],[0,"&Lacute;"],[0,"&lacute;"],[0,"&Lcedil;"],[0,"&lcedil;"],[0,"&Lcaron;"],[0,"&lcaron;"],[0,"&Lmidot;"],[0,"&lmidot;"],[0,"&Lstrok;"],[0,"&lstrok;"],[0,"&Nacute;"],[0,"&nacute;"],[0,"&Ncedil;"],[0,"&ncedil;"],[0,"&Ncaron;"],[0,"&ncaron;"],[0,"&napos;"],[0,"&ENG;"],[0,"&eng;"],[0,"&Omacr;"],[0,"&omacr;"],[2,"&Odblac;"],[0,"&odblac;"],[0,"&OElig;"],[0,"&oelig;"],[0,"&Racute;"],[0,"&racute;"],[0,"&Rcedil;"],[0,"&rcedil;"],[0,"&Rcaron;"],[0,"&rcaron;"],[0,"&Sacute;"],[0,"&sacute;"],[0,"&Scirc;"],[0,"&scirc;"],[0,"&Scedil;"],[0,"&scedil;"],[0,"&Scaron;"],[0,"&scaron;"],[0,"&Tcedil;"],[0,"&tcedil;"],[0,"&Tcaron;"],[0,"&tcaron;"],[0,"&Tstrok;"],[0,"&tstrok;"],[0,"&Utilde;"],[0,"&utilde;"],[0,"&Umacr;"],[0,"&umacr;"],[0,"&Ubreve;"],[0,"&ubreve;"],[0,"&Uring;"],[0,"&uring;"],[0,"&Udblac;"],[0,"&udblac;"],[0,"&Uogon;"],[0,"&uogon;"],[0,"&Wcirc;"],[0,"&wcirc;"],[0,"&Ycirc;"],[0,"&ycirc;"],[0,"&Yuml;"],[0,"&Zacute;"],[0,"&zacute;"],[0,"&Zdot;"],[0,"&zdot;"],[0,"&Zcaron;"],[0,"&zcaron;"],[19,"&fnof;"],[34,"&imped;"],[63,"&gacute;"],[65,"&jmath;"],[142,"&circ;"],[0,"&caron;"],[16,"&breve;"],[0,"&DiacriticalDot;"],[0,"&ring;"],[0,"&ogon;"],[0,"&DiacriticalTilde;"],[0,"&dblac;"],[51,"&DownBreve;"],[127,"&Alpha;"],[0,"&Beta;"],[0,"&Gamma;"],[0,"&Delta;"],[0,"&Epsilon;"],[0,"&Zeta;"],[0,"&Eta;"],[0,"&Theta;"],[0,"&Iota;"],[0,"&Kappa;"],[0,"&Lambda;"],[0,"&Mu;"],[0,"&Nu;"],[0,"&Xi;"],[0,"&Omicron;"],[0,"&Pi;"],[0,"&Rho;"],[1,"&Sigma;"],[0,"&Tau;"],[0,"&Upsilon;"],[0,"&Phi;"],[0,"&Chi;"],[0,"&Psi;"],[0,"&ohm;"],[7,"&alpha;"],[0,"&beta;"],[0,"&gamma;"],[0,"&delta;"],[0,"&epsi;"],[0,"&zeta;"],[0,"&eta;"],[0,"&theta;"],[0,"&iota;"],[0,"&kappa;"],[0,"&lambda;"],[0,"&mu;"],[0,"&nu;"],[0,"&xi;"],[0,"&omicron;"],[0,"&pi;"],[0,"&rho;"],[0,"&sigmaf;"],[0,"&sigma;"],[0,"&tau;"],[0,"&upsi;"],[0,"&phi;"],[0,"&chi;"],[0,"&psi;"],[0,"&omega;"],[7,"&thetasym;"],[0,"&Upsi;"],[2,"&phiv;"],[0,"&piv;"],[5,"&Gammad;"],[0,"&digamma;"],[18,"&kappav;"],[0,"&rhov;"],[3,"&epsiv;"],[0,"&backepsilon;"],[10,"&IOcy;"],[0,"&DJcy;"],[0,"&GJcy;"],[0,"&Jukcy;"],[0,"&DScy;"],[0,"&Iukcy;"],[0,"&YIcy;"],[0,"&Jsercy;"],[0,"&LJcy;"],[0,"&NJcy;"],[0,"&TSHcy;"],[0,"&KJcy;"],[1,"&Ubrcy;"],[0,"&DZcy;"],[0,"&Acy;"],[0,"&Bcy;"],[0,"&Vcy;"],[0,"&Gcy;"],[0,"&Dcy;"],[0,"&IEcy;"],[0,"&ZHcy;"],[0,"&Zcy;"],[0,"&Icy;"],[0,"&Jcy;"],[0,"&Kcy;"],[0,"&Lcy;"],[0,"&Mcy;"],[0,"&Ncy;"],[0,"&Ocy;"],[0,"&Pcy;"],[0,"&Rcy;"],[0,"&Scy;"],[0,"&Tcy;"],[0,"&Ucy;"],[0,"&Fcy;"],[0,"&KHcy;"],[0,"&TScy;"],[0,"&CHcy;"],[0,"&SHcy;"],[0,"&SHCHcy;"],[0,"&HARDcy;"],[0,"&Ycy;"],[0,"&SOFTcy;"],[0,"&Ecy;"],[0,"&YUcy;"],[0,"&YAcy;"],[0,"&acy;"],[0,"&bcy;"],[0,"&vcy;"],[0,"&gcy;"],[0,"&dcy;"],[0,"&iecy;"],[0,"&zhcy;"],[0,"&zcy;"],[0,"&icy;"],[0,"&jcy;"],[0,"&kcy;"],[0,"&lcy;"],[0,"&mcy;"],[0,"&ncy;"],[0,"&ocy;"],[0,"&pcy;"],[0,"&rcy;"],[0,"&scy;"],[0,"&tcy;"],[0,"&ucy;"],[0,"&fcy;"],[0,"&khcy;"],[0,"&tscy;"],[0,"&chcy;"],[0,"&shcy;"],[0,"&shchcy;"],[0,"&hardcy;"],[0,"&ycy;"],[0,"&softcy;"],[0,"&ecy;"],[0,"&yucy;"],[0,"&yacy;"],[1,"&iocy;"],[0,"&djcy;"],[0,"&gjcy;"],[0,"&jukcy;"],[0,"&dscy;"],[0,"&iukcy;"],[0,"&yicy;"],[0,"&jsercy;"],[0,"&ljcy;"],[0,"&njcy;"],[0,"&tshcy;"],[0,"&kjcy;"],[1,"&ubrcy;"],[0,"&dzcy;"],[7074,"&ensp;"],[0,"&emsp;"],[0,"&emsp13;"],[0,"&emsp14;"],[1,"&numsp;"],[0,"&puncsp;"],[0,"&ThinSpace;"],[0,"&hairsp;"],[0,"&NegativeMediumSpace;"],[0,"&zwnj;"],[0,"&zwj;"],[0,"&lrm;"],[0,"&rlm;"],[0,"&dash;"],[2,"&ndash;"],[0,"&mdash;"],[0,"&horbar;"],[0,"&Verbar;"],[1,"&lsquo;"],[0,"&CloseCurlyQuote;"],[0,"&lsquor;"],[1,"&ldquo;"],[0,"&CloseCurlyDoubleQuote;"],[0,"&bdquo;"],[1,"&dagger;"],[0,"&Dagger;"],[0,"&bull;"],[2,"&nldr;"],[0,"&hellip;"],[9,"&permil;"],[0,"&pertenk;"],[0,"&prime;"],[0,"&Prime;"],[0,"&tprime;"],[0,"&backprime;"],[3,"&lsaquo;"],[0,"&rsaquo;"],[3,"&oline;"],[2,"&caret;"],[1,"&hybull;"],[0,"&frasl;"],[10,"&bsemi;"],[7,"&qprime;"],[7,{v:"&MediumSpace;",n:8202,o:"&ThickSpace;"}],[0,"&NoBreak;"],[0,"&af;"],[0,"&InvisibleTimes;"],[0,"&ic;"],[72,"&euro;"],[46,"&tdot;"],[0,"&DotDot;"],[37,"&complexes;"],[2,"&incare;"],[4,"&gscr;"],[0,"&hamilt;"],[0,"&Hfr;"],[0,"&Hopf;"],[0,"&planckh;"],[0,"&hbar;"],[0,"&imagline;"],[0,"&Ifr;"],[0,"&lagran;"],[0,"&ell;"],[1,"&naturals;"],[0,"&numero;"],[0,"&copysr;"],[0,"&weierp;"],[0,"&Popf;"],[0,"&Qopf;"],[0,"&realine;"],[0,"&real;"],[0,"&reals;"],[0,"&rx;"],[3,"&trade;"],[1,"&integers;"],[2,"&mho;"],[0,"&zeetrf;"],[0,"&iiota;"],[2,"&bernou;"],[0,"&Cayleys;"],[1,"&escr;"],[0,"&Escr;"],[0,"&Fouriertrf;"],[1,"&Mellintrf;"],[0,"&order;"],[0,"&alefsym;"],[0,"&beth;"],[0,"&gimel;"],[0,"&daleth;"],[12,"&CapitalDifferentialD;"],[0,"&dd;"],[0,"&ee;"],[0,"&ii;"],[10,"&frac13;"],[0,"&frac23;"],[0,"&frac15;"],[0,"&frac25;"],[0,"&frac35;"],[0,"&frac45;"],[0,"&frac16;"],[0,"&frac56;"],[0,"&frac18;"],[0,"&frac38;"],[0,"&frac58;"],[0,"&frac78;"],[49,"&larr;"],[0,"&ShortUpArrow;"],[0,"&rarr;"],[0,"&darr;"],[0,"&harr;"],[0,"&updownarrow;"],[0,"&nwarr;"],[0,"&nearr;"],[0,"&LowerRightArrow;"],[0,"&LowerLeftArrow;"],[0,"&nlarr;"],[0,"&nrarr;"],[1,{v:"&rarrw;",n:824,o:"&nrarrw;"}],[0,"&Larr;"],[0,"&Uarr;"],[0,"&Rarr;"],[0,"&Darr;"],[0,"&larrtl;"],[0,"&rarrtl;"],[0,"&LeftTeeArrow;"],[0,"&mapstoup;"],[0,"&map;"],[0,"&DownTeeArrow;"],[1,"&hookleftarrow;"],[0,"&hookrightarrow;"],[0,"&larrlp;"],[0,"&looparrowright;"],[0,"&harrw;"],[0,"&nharr;"],[1,"&lsh;"],[0,"&rsh;"],[0,"&ldsh;"],[0,"&rdsh;"],[1,"&crarr;"],[0,"&cularr;"],[0,"&curarr;"],[2,"&circlearrowleft;"],[0,"&circlearrowright;"],[0,"&leftharpoonup;"],[0,"&DownLeftVector;"],[0,"&RightUpVector;"],[0,"&LeftUpVector;"],[0,"&rharu;"],[0,"&DownRightVector;"],[0,"&dharr;"],[0,"&dharl;"],[0,"&RightArrowLeftArrow;"],[0,"&udarr;"],[0,"&LeftArrowRightArrow;"],[0,"&leftleftarrows;"],[0,"&upuparrows;"],[0,"&rightrightarrows;"],[0,"&ddarr;"],[0,"&leftrightharpoons;"],[0,"&Equilibrium;"],[0,"&nlArr;"],[0,"&nhArr;"],[0,"&nrArr;"],[0,"&DoubleLeftArrow;"],[0,"&DoubleUpArrow;"],[0,"&DoubleRightArrow;"],[0,"&dArr;"],[0,"&DoubleLeftRightArrow;"],[0,"&DoubleUpDownArrow;"],[0,"&nwArr;"],[0,"&neArr;"],[0,"&seArr;"],[0,"&swArr;"],[0,"&lAarr;"],[0,"&rAarr;"],[1,"&zigrarr;"],[6,"&larrb;"],[0,"&rarrb;"],[15,"&DownArrowUpArrow;"],[7,"&loarr;"],[0,"&roarr;"],[0,"&hoarr;"],[0,"&forall;"],[0,"&comp;"],[0,{v:"&part;",n:824,o:"&npart;"}],[0,"&exist;"],[0,"&nexist;"],[0,"&empty;"],[1,"&Del;"],[0,"&Element;"],[0,"&NotElement;"],[1,"&ni;"],[0,"&notni;"],[2,"&prod;"],[0,"&coprod;"],[0,"&sum;"],[0,"&minus;"],[0,"&MinusPlus;"],[0,"&dotplus;"],[1,"&Backslash;"],[0,"&lowast;"],[0,"&compfn;"],[1,"&radic;"],[2,"&prop;"],[0,"&infin;"],[0,"&angrt;"],[0,{v:"&ang;",n:8402,o:"&nang;"}],[0,"&angmsd;"],[0,"&angsph;"],[0,"&mid;"],[0,"&nmid;"],[0,"&DoubleVerticalBar;"],[0,"&NotDoubleVerticalBar;"],[0,"&and;"],[0,"&or;"],[0,{v:"&cap;",n:65024,o:"&caps;"}],[0,{v:"&cup;",n:65024,o:"&cups;"}],[0,"&int;"],[0,"&Int;"],[0,"&iiint;"],[0,"&conint;"],[0,"&Conint;"],[0,"&Cconint;"],[0,"&cwint;"],[0,"&ClockwiseContourIntegral;"],[0,"&awconint;"],[0,"&there4;"],[0,"&becaus;"],[0,"&ratio;"],[0,"&Colon;"],[0,"&dotminus;"],[1,"&mDDot;"],[0,"&homtht;"],[0,{v:"&sim;",n:8402,o:"&nvsim;"}],[0,{v:"&backsim;",n:817,o:"&race;"}],[0,{v:"&ac;",n:819,o:"&acE;"}],[0,"&acd;"],[0,"&VerticalTilde;"],[0,"&NotTilde;"],[0,{v:"&eqsim;",n:824,o:"&nesim;"}],[0,"&sime;"],[0,"&NotTildeEqual;"],[0,"&cong;"],[0,"&simne;"],[0,"&ncong;"],[0,"&ap;"],[0,"&nap;"],[0,"&ape;"],[0,{v:"&apid;",n:824,o:"&napid;"}],[0,"&backcong;"],[0,{v:"&asympeq;",n:8402,o:"&nvap;"}],[0,{v:"&bump;",n:824,o:"&nbump;"}],[0,{v:"&bumpe;",n:824,o:"&nbumpe;"}],[0,{v:"&doteq;",n:824,o:"&nedot;"}],[0,"&doteqdot;"],[0,"&efDot;"],[0,"&erDot;"],[0,"&Assign;"],[0,"&ecolon;"],[0,"&ecir;"],[0,"&circeq;"],[1,"&wedgeq;"],[0,"&veeeq;"],[1,"&triangleq;"],[2,"&equest;"],[0,"&ne;"],[0,{v:"&Congruent;",n:8421,o:"&bnequiv;"}],[0,"&nequiv;"],[1,{v:"&le;",n:8402,o:"&nvle;"}],[0,{v:"&ge;",n:8402,o:"&nvge;"}],[0,{v:"&lE;",n:824,o:"&nlE;"}],[0,{v:"&gE;",n:824,o:"&ngE;"}],[0,{v:"&lnE;",n:65024,o:"&lvertneqq;"}],[0,{v:"&gnE;",n:65024,o:"&gvertneqq;"}],[0,{v:"&ll;",n:new Map(sp([[824,"&nLtv;"],[7577,"&nLt;"]]))}],[0,{v:"&gg;",n:new Map(sp([[824,"&nGtv;"],[7577,"&nGt;"]]))}],[0,"&between;"],[0,"&NotCupCap;"],[0,"&nless;"],[0,"&ngt;"],[0,"&nle;"],[0,"&nge;"],[0,"&lesssim;"],[0,"&GreaterTilde;"],[0,"&nlsim;"],[0,"&ngsim;"],[0,"&LessGreater;"],[0,"&gl;"],[0,"&NotLessGreater;"],[0,"&NotGreaterLess;"],[0,"&pr;"],[0,"&sc;"],[0,"&prcue;"],[0,"&sccue;"],[0,"&PrecedesTilde;"],[0,{v:"&scsim;",n:824,o:"&NotSucceedsTilde;"}],[0,"&NotPrecedes;"],[0,"&NotSucceeds;"],[0,{v:"&sub;",n:8402,o:"&NotSubset;"}],[0,{v:"&sup;",n:8402,o:"&NotSuperset;"}],[0,"&nsub;"],[0,"&nsup;"],[0,"&sube;"],[0,"&supe;"],[0,"&NotSubsetEqual;"],[0,"&NotSupersetEqual;"],[0,{v:"&subne;",n:65024,o:"&varsubsetneq;"}],[0,{v:"&supne;",n:65024,o:"&varsupsetneq;"}],[1,"&cupdot;"],[0,"&UnionPlus;"],[0,{v:"&sqsub;",n:824,o:"&NotSquareSubset;"}],[0,{v:"&sqsup;",n:824,o:"&NotSquareSuperset;"}],[0,"&sqsube;"],[0,"&sqsupe;"],[0,{v:"&sqcap;",n:65024,o:"&sqcaps;"}],[0,{v:"&sqcup;",n:65024,o:"&sqcups;"}],[0,"&CirclePlus;"],[0,"&CircleMinus;"],[0,"&CircleTimes;"],[0,"&osol;"],[0,"&CircleDot;"],[0,"&circledcirc;"],[0,"&circledast;"],[1,"&circleddash;"],[0,"&boxplus;"],[0,"&boxminus;"],[0,"&boxtimes;"],[0,"&dotsquare;"],[0,"&RightTee;"],[0,"&dashv;"],[0,"&DownTee;"],[0,"&bot;"],[1,"&models;"],[0,"&DoubleRightTee;"],[0,"&Vdash;"],[0,"&Vvdash;"],[0,"&VDash;"],[0,"&nvdash;"],[0,"&nvDash;"],[0,"&nVdash;"],[0,"&nVDash;"],[0,"&prurel;"],[1,"&LeftTriangle;"],[0,"&RightTriangle;"],[0,{v:"&LeftTriangleEqual;",n:8402,o:"&nvltrie;"}],[0,{v:"&RightTriangleEqual;",n:8402,o:"&nvrtrie;"}],[0,"&origof;"],[0,"&imof;"],[0,"&multimap;"],[0,"&hercon;"],[0,"&intcal;"],[0,"&veebar;"],[1,"&barvee;"],[0,"&angrtvb;"],[0,"&lrtri;"],[0,"&bigwedge;"],[0,"&bigvee;"],[0,"&bigcap;"],[0,"&bigcup;"],[0,"&diam;"],[0,"&sdot;"],[0,"&sstarf;"],[0,"&divideontimes;"],[0,"&bowtie;"],[0,"&ltimes;"],[0,"&rtimes;"],[0,"&leftthreetimes;"],[0,"&rightthreetimes;"],[0,"&backsimeq;"],[0,"&curlyvee;"],[0,"&curlywedge;"],[0,"&Sub;"],[0,"&Sup;"],[0,"&Cap;"],[0,"&Cup;"],[0,"&fork;"],[0,"&epar;"],[0,"&lessdot;"],[0,"&gtdot;"],[0,{v:"&Ll;",n:824,o:"&nLl;"}],[0,{v:"&Gg;",n:824,o:"&nGg;"}],[0,{v:"&leg;",n:65024,o:"&lesg;"}],[0,{v:"&gel;",n:65024,o:"&gesl;"}],[2,"&cuepr;"],[0,"&cuesc;"],[0,"&NotPrecedesSlantEqual;"],[0,"&NotSucceedsSlantEqual;"],[0,"&NotSquareSubsetEqual;"],[0,"&NotSquareSupersetEqual;"],[2,"&lnsim;"],[0,"&gnsim;"],[0,"&precnsim;"],[0,"&scnsim;"],[0,"&nltri;"],[0,"&NotRightTriangle;"],[0,"&nltrie;"],[0,"&NotRightTriangleEqual;"],[0,"&vellip;"],[0,"&ctdot;"],[0,"&utdot;"],[0,"&dtdot;"],[0,"&disin;"],[0,"&isinsv;"],[0,"&isins;"],[0,{v:"&isindot;",n:824,o:"&notindot;"}],[0,"&notinvc;"],[0,"&notinvb;"],[1,{v:"&isinE;",n:824,o:"&notinE;"}],[0,"&nisd;"],[0,"&xnis;"],[0,"&nis;"],[0,"&notnivc;"],[0,"&notnivb;"],[6,"&barwed;"],[0,"&Barwed;"],[1,"&lceil;"],[0,"&rceil;"],[0,"&LeftFloor;"],[0,"&rfloor;"],[0,"&drcrop;"],[0,"&dlcrop;"],[0,"&urcrop;"],[0,"&ulcrop;"],[0,"&bnot;"],[1,"&profline;"],[0,"&profsurf;"],[1,"&telrec;"],[0,"&target;"],[5,"&ulcorn;"],[0,"&urcorn;"],[0,"&dlcorn;"],[0,"&drcorn;"],[2,"&frown;"],[0,"&smile;"],[9,"&cylcty;"],[0,"&profalar;"],[7,"&topbot;"],[6,"&ovbar;"],[1,"&solbar;"],[60,"&angzarr;"],[51,"&lmoustache;"],[0,"&rmoustache;"],[2,"&OverBracket;"],[0,"&bbrk;"],[0,"&bbrktbrk;"],[37,"&OverParenthesis;"],[0,"&UnderParenthesis;"],[0,"&OverBrace;"],[0,"&UnderBrace;"],[2,"&trpezium;"],[4,"&elinters;"],[59,"&blank;"],[164,"&circledS;"],[55,"&boxh;"],[1,"&boxv;"],[9,"&boxdr;"],[3,"&boxdl;"],[3,"&boxur;"],[3,"&boxul;"],[3,"&boxvr;"],[7,"&boxvl;"],[7,"&boxhd;"],[7,"&boxhu;"],[7,"&boxvh;"],[19,"&boxH;"],[0,"&boxV;"],[0,"&boxdR;"],[0,"&boxDr;"],[0,"&boxDR;"],[0,"&boxdL;"],[0,"&boxDl;"],[0,"&boxDL;"],[0,"&boxuR;"],[0,"&boxUr;"],[0,"&boxUR;"],[0,"&boxuL;"],[0,"&boxUl;"],[0,"&boxUL;"],[0,"&boxvR;"],[0,"&boxVr;"],[0,"&boxVR;"],[0,"&boxvL;"],[0,"&boxVl;"],[0,"&boxVL;"],[0,"&boxHd;"],[0,"&boxhD;"],[0,"&boxHD;"],[0,"&boxHu;"],[0,"&boxhU;"],[0,"&boxHU;"],[0,"&boxvH;"],[0,"&boxVh;"],[0,"&boxVH;"],[19,"&uhblk;"],[3,"&lhblk;"],[3,"&block;"],[8,"&blk14;"],[0,"&blk12;"],[0,"&blk34;"],[13,"&square;"],[8,"&blacksquare;"],[0,"&EmptyVerySmallSquare;"],[1,"&rect;"],[0,"&marker;"],[2,"&fltns;"],[1,"&bigtriangleup;"],[0,"&blacktriangle;"],[0,"&triangle;"],[2,"&blacktriangleright;"],[0,"&rtri;"],[3,"&bigtriangledown;"],[0,"&blacktriangledown;"],[0,"&dtri;"],[2,"&blacktriangleleft;"],[0,"&ltri;"],[6,"&loz;"],[0,"&cir;"],[32,"&tridot;"],[2,"&bigcirc;"],[8,"&ultri;"],[0,"&urtri;"],[0,"&lltri;"],[0,"&EmptySmallSquare;"],[0,"&FilledSmallSquare;"],[8,"&bigstar;"],[0,"&star;"],[7,"&phone;"],[49,"&female;"],[1,"&male;"],[29,"&spades;"],[2,"&clubs;"],[1,"&hearts;"],[0,"&diamondsuit;"],[3,"&sung;"],[2,"&flat;"],[0,"&natural;"],[0,"&sharp;"],[163,"&check;"],[3,"&cross;"],[8,"&malt;"],[21,"&sext;"],[33,"&VerticalSeparator;"],[25,"&lbbrk;"],[0,"&rbbrk;"],[84,"&bsolhsub;"],[0,"&suphsol;"],[28,"&LeftDoubleBracket;"],[0,"&RightDoubleBracket;"],[0,"&lang;"],[0,"&rang;"],[0,"&Lang;"],[0,"&Rang;"],[0,"&loang;"],[0,"&roang;"],[7,"&longleftarrow;"],[0,"&longrightarrow;"],[0,"&longleftrightarrow;"],[0,"&DoubleLongLeftArrow;"],[0,"&DoubleLongRightArrow;"],[0,"&DoubleLongLeftRightArrow;"],[1,"&longmapsto;"],[2,"&dzigrarr;"],[258,"&nvlArr;"],[0,"&nvrArr;"],[0,"&nvHarr;"],[0,"&Map;"],[6,"&lbarr;"],[0,"&bkarow;"],[0,"&lBarr;"],[0,"&dbkarow;"],[0,"&drbkarow;"],[0,"&DDotrahd;"],[0,"&UpArrowBar;"],[0,"&DownArrowBar;"],[2,"&Rarrtl;"],[2,"&latail;"],[0,"&ratail;"],[0,"&lAtail;"],[0,"&rAtail;"],[0,"&larrfs;"],[0,"&rarrfs;"],[0,"&larrbfs;"],[0,"&rarrbfs;"],[2,"&nwarhk;"],[0,"&nearhk;"],[0,"&hksearow;"],[0,"&hkswarow;"],[0,"&nwnear;"],[0,"&nesear;"],[0,"&seswar;"],[0,"&swnwar;"],[8,{v:"&rarrc;",n:824,o:"&nrarrc;"}],[1,"&cudarrr;"],[0,"&ldca;"],[0,"&rdca;"],[0,"&cudarrl;"],[0,"&larrpl;"],[2,"&curarrm;"],[0,"&cularrp;"],[7,"&rarrpl;"],[2,"&harrcir;"],[0,"&Uarrocir;"],[0,"&lurdshar;"],[0,"&ldrushar;"],[2,"&LeftRightVector;"],[0,"&RightUpDownVector;"],[0,"&DownLeftRightVector;"],[0,"&LeftUpDownVector;"],[0,"&LeftVectorBar;"],[0,"&RightVectorBar;"],[0,"&RightUpVectorBar;"],[0,"&RightDownVectorBar;"],[0,"&DownLeftVectorBar;"],[0,"&DownRightVectorBar;"],[0,"&LeftUpVectorBar;"],[0,"&LeftDownVectorBar;"],[0,"&LeftTeeVector;"],[0,"&RightTeeVector;"],[0,"&RightUpTeeVector;"],[0,"&RightDownTeeVector;"],[0,"&DownLeftTeeVector;"],[0,"&DownRightTeeVector;"],[0,"&LeftUpTeeVector;"],[0,"&LeftDownTeeVector;"],[0,"&lHar;"],[0,"&uHar;"],[0,"&rHar;"],[0,"&dHar;"],[0,"&luruhar;"],[0,"&ldrdhar;"],[0,"&ruluhar;"],[0,"&rdldhar;"],[0,"&lharul;"],[0,"&llhard;"],[0,"&rharul;"],[0,"&lrhard;"],[0,"&udhar;"],[0,"&duhar;"],[0,"&RoundImplies;"],[0,"&erarr;"],[0,"&simrarr;"],[0,"&larrsim;"],[0,"&rarrsim;"],[0,"&rarrap;"],[0,"&ltlarr;"],[1,"&gtrarr;"],[0,"&subrarr;"],[1,"&suplarr;"],[0,"&lfisht;"],[0,"&rfisht;"],[0,"&ufisht;"],[0,"&dfisht;"],[5,"&lopar;"],[0,"&ropar;"],[4,"&lbrke;"],[0,"&rbrke;"],[0,"&lbrkslu;"],[0,"&rbrksld;"],[0,"&lbrksld;"],[0,"&rbrkslu;"],[0,"&langd;"],[0,"&rangd;"],[0,"&lparlt;"],[0,"&rpargt;"],[0,"&gtlPar;"],[0,"&ltrPar;"],[3,"&vzigzag;"],[1,"&vangrt;"],[0,"&angrtvbd;"],[6,"&ange;"],[0,"&range;"],[0,"&dwangle;"],[0,"&uwangle;"],[0,"&angmsdaa;"],[0,"&angmsdab;"],[0,"&angmsdac;"],[0,"&angmsdad;"],[0,"&angmsdae;"],[0,"&angmsdaf;"],[0,"&angmsdag;"],[0,"&angmsdah;"],[0,"&bemptyv;"],[0,"&demptyv;"],[0,"&cemptyv;"],[0,"&raemptyv;"],[0,"&laemptyv;"],[0,"&ohbar;"],[0,"&omid;"],[0,"&opar;"],[1,"&operp;"],[1,"&olcross;"],[0,"&odsold;"],[1,"&olcir;"],[0,"&ofcir;"],[0,"&olt;"],[0,"&ogt;"],[0,"&cirscir;"],[0,"&cirE;"],[0,"&solb;"],[0,"&bsolb;"],[3,"&boxbox;"],[3,"&trisb;"],[0,"&rtriltri;"],[0,{v:"&LeftTriangleBar;",n:824,o:"&NotLeftTriangleBar;"}],[0,{v:"&RightTriangleBar;",n:824,o:"&NotRightTriangleBar;"}],[11,"&iinfin;"],[0,"&infintie;"],[0,"&nvinfin;"],[4,"&eparsl;"],[0,"&smeparsl;"],[0,"&eqvparsl;"],[5,"&blacklozenge;"],[8,"&RuleDelayed;"],[1,"&dsol;"],[9,"&bigodot;"],[0,"&bigoplus;"],[0,"&bigotimes;"],[1,"&biguplus;"],[1,"&bigsqcup;"],[5,"&iiiint;"],[0,"&fpartint;"],[2,"&cirfnint;"],[0,"&awint;"],[0,"&rppolint;"],[0,"&scpolint;"],[0,"&npolint;"],[0,"&pointint;"],[0,"&quatint;"],[0,"&intlarhk;"],[10,"&pluscir;"],[0,"&plusacir;"],[0,"&simplus;"],[0,"&plusdu;"],[0,"&plussim;"],[0,"&plustwo;"],[1,"&mcomma;"],[0,"&minusdu;"],[2,"&loplus;"],[0,"&roplus;"],[0,"&Cross;"],[0,"&timesd;"],[0,"&timesbar;"],[1,"&smashp;"],[0,"&lotimes;"],[0,"&rotimes;"],[0,"&otimesas;"],[0,"&Otimes;"],[0,"&odiv;"],[0,"&triplus;"],[0,"&triminus;"],[0,"&tritime;"],[0,"&intprod;"],[2,"&amalg;"],[0,"&capdot;"],[1,"&ncup;"],[0,"&ncap;"],[0,"&capand;"],[0,"&cupor;"],[0,"&cupcap;"],[0,"&capcup;"],[0,"&cupbrcap;"],[0,"&capbrcup;"],[0,"&cupcup;"],[0,"&capcap;"],[0,"&ccups;"],[0,"&ccaps;"],[2,"&ccupssm;"],[2,"&And;"],[0,"&Or;"],[0,"&andand;"],[0,"&oror;"],[0,"&orslope;"],[0,"&andslope;"],[1,"&andv;"],[0,"&orv;"],[0,"&andd;"],[0,"&ord;"],[1,"&wedbar;"],[6,"&sdote;"],[3,"&simdot;"],[2,{v:"&congdot;",n:824,o:"&ncongdot;"}],[0,"&easter;"],[0,"&apacir;"],[0,{v:"&apE;",n:824,o:"&napE;"}],[0,"&eplus;"],[0,"&pluse;"],[0,"&Esim;"],[0,"&Colone;"],[0,"&Equal;"],[1,"&ddotseq;"],[0,"&equivDD;"],[0,"&ltcir;"],[0,"&gtcir;"],[0,"&ltquest;"],[0,"&gtquest;"],[0,{v:"&leqslant;",n:824,o:"&nleqslant;"}],[0,{v:"&geqslant;",n:824,o:"&ngeqslant;"}],[0,"&lesdot;"],[0,"&gesdot;"],[0,"&lesdoto;"],[0,"&gesdoto;"],[0,"&lesdotor;"],[0,"&gesdotol;"],[0,"&lap;"],[0,"&gap;"],[0,"&lne;"],[0,"&gne;"],[0,"&lnap;"],[0,"&gnap;"],[0,"&lEg;"],[0,"&gEl;"],[0,"&lsime;"],[0,"&gsime;"],[0,"&lsimg;"],[0,"&gsiml;"],[0,"&lgE;"],[0,"&glE;"],[0,"&lesges;"],[0,"&gesles;"],[0,"&els;"],[0,"&egs;"],[0,"&elsdot;"],[0,"&egsdot;"],[0,"&el;"],[0,"&eg;"],[2,"&siml;"],[0,"&simg;"],[0,"&simlE;"],[0,"&simgE;"],[0,{v:"&LessLess;",n:824,o:"&NotNestedLessLess;"}],[0,{v:"&GreaterGreater;",n:824,o:"&NotNestedGreaterGreater;"}],[1,"&glj;"],[0,"&gla;"],[0,"&ltcc;"],[0,"&gtcc;"],[0,"&lescc;"],[0,"&gescc;"],[0,"&smt;"],[0,"&lat;"],[0,{v:"&smte;",n:65024,o:"&smtes;"}],[0,{v:"&late;",n:65024,o:"&lates;"}],[0,"&bumpE;"],[0,{v:"&PrecedesEqual;",n:824,o:"&NotPrecedesEqual;"}],[0,{v:"&sce;",n:824,o:"&NotSucceedsEqual;"}],[2,"&prE;"],[0,"&scE;"],[0,"&precneqq;"],[0,"&scnE;"],[0,"&prap;"],[0,"&scap;"],[0,"&precnapprox;"],[0,"&scnap;"],[0,"&Pr;"],[0,"&Sc;"],[0,"&subdot;"],[0,"&supdot;"],[0,"&subplus;"],[0,"&supplus;"],[0,"&submult;"],[0,"&supmult;"],[0,"&subedot;"],[0,"&supedot;"],[0,{v:"&subE;",n:824,o:"&nsubE;"}],[0,{v:"&supE;",n:824,o:"&nsupE;"}],[0,"&subsim;"],[0,"&supsim;"],[2,{v:"&subnE;",n:65024,o:"&varsubsetneqq;"}],[0,{v:"&supnE;",n:65024,o:"&varsupsetneqq;"}],[2,"&csub;"],[0,"&csup;"],[0,"&csube;"],[0,"&csupe;"],[0,"&subsup;"],[0,"&supsub;"],[0,"&subsub;"],[0,"&supsup;"],[0,"&suphsub;"],[0,"&supdsub;"],[0,"&forkv;"],[0,"&topfork;"],[0,"&mlcp;"],[8,"&Dashv;"],[1,"&Vdashl;"],[0,"&Barv;"],[0,"&vBar;"],[0,"&vBarv;"],[1,"&Vbar;"],[0,"&Not;"],[0,"&bNot;"],[0,"&rnmid;"],[0,"&cirmid;"],[0,"&midcir;"],[0,"&topcir;"],[0,"&nhpar;"],[0,"&parsim;"],[9,{v:"&parsl;",n:8421,o:"&nparsl;"}],[44343,{n:new Map(sp([[56476,"&Ascr;"],[1,"&Cscr;"],[0,"&Dscr;"],[2,"&Gscr;"],[2,"&Jscr;"],[0,"&Kscr;"],[2,"&Nscr;"],[0,"&Oscr;"],[0,"&Pscr;"],[0,"&Qscr;"],[1,"&Sscr;"],[0,"&Tscr;"],[0,"&Uscr;"],[0,"&Vscr;"],[0,"&Wscr;"],[0,"&Xscr;"],[0,"&Yscr;"],[0,"&Zscr;"],[0,"&ascr;"],[0,"&bscr;"],[0,"&cscr;"],[0,"&dscr;"],[1,"&fscr;"],[1,"&hscr;"],[0,"&iscr;"],[0,"&jscr;"],[0,"&kscr;"],[0,"&lscr;"],[0,"&mscr;"],[0,"&nscr;"],[1,"&pscr;"],[0,"&qscr;"],[0,"&rscr;"],[0,"&sscr;"],[0,"&tscr;"],[0,"&uscr;"],[0,"&vscr;"],[0,"&wscr;"],[0,"&xscr;"],[0,"&yscr;"],[0,"&zscr;"],[52,"&Afr;"],[0,"&Bfr;"],[1,"&Dfr;"],[0,"&Efr;"],[0,"&Ffr;"],[0,"&Gfr;"],[2,"&Jfr;"],[0,"&Kfr;"],[0,"&Lfr;"],[0,"&Mfr;"],[0,"&Nfr;"],[0,"&Ofr;"],[0,"&Pfr;"],[0,"&Qfr;"],[1,"&Sfr;"],[0,"&Tfr;"],[0,"&Ufr;"],[0,"&Vfr;"],[0,"&Wfr;"],[0,"&Xfr;"],[0,"&Yfr;"],[1,"&afr;"],[0,"&bfr;"],[0,"&cfr;"],[0,"&dfr;"],[0,"&efr;"],[0,"&ffr;"],[0,"&gfr;"],[0,"&hfr;"],[0,"&ifr;"],[0,"&jfr;"],[0,"&kfr;"],[0,"&lfr;"],[0,"&mfr;"],[0,"&nfr;"],[0,"&ofr;"],[0,"&pfr;"],[0,"&qfr;"],[0,"&rfr;"],[0,"&sfr;"],[0,"&tfr;"],[0,"&ufr;"],[0,"&vfr;"],[0,"&wfr;"],[0,"&xfr;"],[0,"&yfr;"],[0,"&zfr;"],[0,"&Aopf;"],[0,"&Bopf;"],[1,"&Dopf;"],[0,"&Eopf;"],[0,"&Fopf;"],[0,"&Gopf;"],[1,"&Iopf;"],[0,"&Jopf;"],[0,"&Kopf;"],[0,"&Lopf;"],[0,"&Mopf;"],[1,"&Oopf;"],[3,"&Sopf;"],[0,"&Topf;"],[0,"&Uopf;"],[0,"&Vopf;"],[0,"&Wopf;"],[0,"&Xopf;"],[0,"&Yopf;"],[1,"&aopf;"],[0,"&bopf;"],[0,"&copf;"],[0,"&dopf;"],[0,"&eopf;"],[0,"&fopf;"],[0,"&gopf;"],[0,"&hopf;"],[0,"&iopf;"],[0,"&jopf;"],[0,"&kopf;"],[0,"&lopf;"],[0,"&mopf;"],[0,"&nopf;"],[0,"&oopf;"],[0,"&popf;"],[0,"&qopf;"],[0,"&ropf;"],[0,"&sopf;"],[0,"&topf;"],[0,"&uopf;"],[0,"&vopf;"],[0,"&wopf;"],[0,"&xopf;"],[0,"&yopf;"],[0,"&zopf;"]]))}],[8906,"&fflig;"],[0,"&filig;"],[0,"&fllig;"],[0,"&ffilig;"],[0,"&ffllig;"]]));var op={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.escapeText=t.escapeAttribute=t.escapeUTF8=t.escape=t.encodeXML=t.getCodePoint=t.xmlReplacer=void 0,t.xmlReplacer=/["&'<>$\x80-\uFFFF]/g;var e=new Map([[34,"&quot;"],[38,"&amp;"],[39,"&apos;"],[60,"&lt;"],[62,"&gt;"]]);t.getCodePoint=String.prototype.codePointAt!=null?function(r,s){return r.codePointAt(s)}:function(r,s){return(r.charCodeAt(s)&64512)===55296?(r.charCodeAt(s)-55296)*1024+r.charCodeAt(s+1)-56320+65536:r.charCodeAt(s)};function n(r){for(var s="",o=0,a;(a=t.xmlReplacer.exec(r))!==null;){var l=a.index,u=r.charCodeAt(l),c=e.get(u);c!==void 0?(s+=r.substring(o,l)+c,o=l+1):(s+="".concat(r.substring(o,l),"&#x").concat((0,t.getCodePoint)(r,l).toString(16),";"),o=t.xmlReplacer.lastIndex+=+((u&64512)===55296))}return s+r.substr(o)}t.encodeXML=n,t.escape=n;function i(r,s){return function(a){for(var l,u=0,c="";l=r.exec(a);)u!==l.index&&(c+=a.substring(u,l.index)),c+=s.get(l[0].charCodeAt(0)),u=l.index+1;return c+a.substring(u)}}t.escapeUTF8=i(/[&<>'"]/g,e),t.escapeAttribute=i(/["&\u00A0]/g,new Map([[34,"&quot;"],[38,"&amp;"],[160,"&nbsp;"]])),t.escapeText=i(/[&<>\u00A0]/g,new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[160,"&nbsp;"]]))})(op);var jee=qe&&qe.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(ra,"__esModule",{value:!0}),ra.encodeNonAsciiHTML=ra.encodeHTML=void 0;var Wee=jee(eb),y3=op,qee=/[\t\n!-,./:-@[-`\f{-}$\x80-\uFFFF]/g;function Kee(t){return v3(qee,t)}ra.encodeHTML=Kee;function Yee(t){return v3(y3.xmlReplacer,t)}ra.encodeNonAsciiHTML=Yee;function v3(t,e){for(var n="",i=0,r;(r=t.exec(e))!==null;){var s=r.index;n+=e.substring(i,s);var o=e.charCodeAt(s),a=Wee.default.get(o);if(typeof a=="object"){if(s+1<e.length){var l=e.charCodeAt(s+1),u=typeof a.n=="number"?a.n===l?a.o:void 0:a.n.get(l);if(u!==void 0){n+=u,i=t.lastIndex+=1;continue}}a=a.v}if(a!==void 0)n+=a,i=s+1;else{var c=(0,y3.getCodePoint)(e,s);n+="&#x".concat(c.toString(16),";"),i=t.lastIndex+=+(c!==o)}}return n+e.substr(i)}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.decodeXMLStrict=t.decodeHTML5Strict=t.decodeHTML4Strict=t.decodeHTML5=t.decodeHTML4=t.decodeHTMLAttribute=t.decodeHTMLStrict=t.decodeHTML=t.decodeXML=t.DecodingMode=t.EntityDecoder=t.encodeHTML5=t.encodeHTML4=t.encodeNonAsciiHTML=t.encodeHTML=t.escapeText=t.escapeAttribute=t.escapeUTF8=t.escape=t.encodeXML=t.encode=t.decodeStrict=t.decode=t.EncodingMode=t.EntityLevel=void 0;var e=Xc,n=ra,i=op,r;(function(f){f[f.XML=0]="XML",f[f.HTML=1]="HTML"})(r=t.EntityLevel||(t.EntityLevel={}));var s;(function(f){f[f.UTF8=0]="UTF8",f[f.ASCII=1]="ASCII",f[f.Extensive=2]="Extensive",f[f.Attribute=3]="Attribute",f[f.Text=4]="Text"})(s=t.EncodingMode||(t.EncodingMode={}));function o(f,h){h===void 0&&(h=r.XML);var p=typeof h=="number"?h:h.level;if(p===r.HTML){var m=typeof h=="object"?h.mode:void 0;return(0,e.decodeHTML)(f,m)}return(0,e.decodeXML)(f)}t.decode=o;function a(f,h){var p;h===void 0&&(h=r.XML);var m=typeof h=="number"?{level:h}:h;return(p=m.mode)!==null&&p!==void 0||(m.mode=e.DecodingMode.Strict),o(f,m)}t.decodeStrict=a;function l(f,h){h===void 0&&(h=r.XML);var p=typeof h=="number"?{level:h}:h;return p.mode===s.UTF8?(0,i.escapeUTF8)(f):p.mode===s.Attribute?(0,i.escapeAttribute)(f):p.mode===s.Text?(0,i.escapeText)(f):p.level===r.HTML?p.mode===s.ASCII?(0,n.encodeNonAsciiHTML)(f):(0,n.encodeHTML)(f):(0,i.encodeXML)(f)}t.encode=l;var u=op;Object.defineProperty(t,"encodeXML",{enumerable:!0,get:function(){return u.encodeXML}}),Object.defineProperty(t,"escape",{enumerable:!0,get:function(){return u.escape}}),Object.defineProperty(t,"escapeUTF8",{enumerable:!0,get:function(){return u.escapeUTF8}}),Object.defineProperty(t,"escapeAttribute",{enumerable:!0,get:function(){return u.escapeAttribute}}),Object.defineProperty(t,"escapeText",{enumerable:!0,get:function(){return u.escapeText}});var c=ra;Object.defineProperty(t,"encodeHTML",{enumerable:!0,get:function(){return c.encodeHTML}}),Object.defineProperty(t,"encodeNonAsciiHTML",{enumerable:!0,get:function(){return c.encodeNonAsciiHTML}}),Object.defineProperty(t,"encodeHTML4",{enumerable:!0,get:function(){return c.encodeHTML}}),Object.defineProperty(t,"encodeHTML5",{enumerable:!0,get:function(){return c.encodeHTML}});var d=Xc;Object.defineProperty(t,"EntityDecoder",{enumerable:!0,get:function(){return d.EntityDecoder}}),Object.defineProperty(t,"DecodingMode",{enumerable:!0,get:function(){return d.DecodingMode}}),Object.defineProperty(t,"decodeXML",{enumerable:!0,get:function(){return d.decodeXML}}),Object.defineProperty(t,"decodeHTML",{enumerable:!0,get:function(){return d.decodeHTML}}),Object.defineProperty(t,"decodeHTMLStrict",{enumerable:!0,get:function(){return d.decodeHTMLStrict}}),Object.defineProperty(t,"decodeHTMLAttribute",{enumerable:!0,get:function(){return d.decodeHTMLAttribute}}),Object.defineProperty(t,"decodeHTML4",{enumerable:!0,get:function(){return d.decodeHTML}}),Object.defineProperty(t,"decodeHTML5",{enumerable:!0,get:function(){return d.decodeHTML}}),Object.defineProperty(t,"decodeHTML4Strict",{enumerable:!0,get:function(){return d.decodeHTMLStrict}}),Object.defineProperty(t,"decodeHTML5Strict",{enumerable:!0,get:function(){return d.decodeHTMLStrict}}),Object.defineProperty(t,"decodeXMLStrict",{enumerable:!0,get:function(){return d.decodeXML}})})(g3);var Dl={};Object.defineProperty(Dl,"__esModule",{value:!0}),Dl.attributeNames=Dl.elementNames=void 0,Dl.elementNames=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(function(t){return[t.toLowerCase(),t]})),Dl.attributeNames=new Map(["definitionURL","attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(function(t){return[t.toLowerCase(),t]}));var Ol=qe&&qe.__assign||function(){return Ol=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},Ol.apply(this,arguments)},Xee=qe&&qe.__createBinding||(Object.create?function(t,e,n,i){i===void 0&&(i=n);var r=Object.getOwnPropertyDescriptor(e,n);(!r||("get"in r?!e.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,i,r)}:function(t,e,n,i){i===void 0&&(i=n),t[i]=e[n]}),Qee=qe&&qe.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Zee=qe&&qe.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)n!=="default"&&Object.prototype.hasOwnProperty.call(t,n)&&Xee(e,t,n);return Qee(e,t),e};Object.defineProperty(Zc,"__esModule",{value:!0}),Zc.render=void 0;var us=Zee(kl),ap=g3,b3=Dl,Jee=new Set(["style","script","xmp","iframe","noembed","noframes","plaintext","noscript"]);function ete(t){return t.replace(/"/g,"&quot;")}function tte(t,e){var n;if(t){var i=((n=e.encodeEntities)!==null&&n!==void 0?n:e.decodeEntities)===!1?ete:e.xmlMode||e.encodeEntities!=="utf8"?ap.encodeXML:ap.escapeAttribute;return Object.keys(t).map(function(r){var s,o,a=(s=t[r])!==null&&s!==void 0?s:"";return e.xmlMode==="foreign"&&(r=(o=b3.attributeNames.get(r))!==null&&o!==void 0?o:r),!e.emptyAttrs&&!e.xmlMode&&a===""?r:"".concat(r,'="').concat(i(a),'"')}).join(" ")}}var E3=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]);function lp(t,e){e===void 0&&(e={});for(var n=("length"in t)?t:[t],i="",r=0;r<n.length;r++)i+=nte(n[r],e);return i}Zc.render=lp,Zc.default=lp;function nte(t,e){switch(t.type){case us.Root:return lp(t.children,e);case us.Doctype:case us.Directive:return ote(t);case us.Comment:return ute(t);case us.CDATA:return lte(t);case us.Script:case us.Style:case us.Tag:return ste(t,e);case us.Text:return ate(t,e)}}var ite=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),rte=new Set(["svg","math"]);function ste(t,e){var n;e.xmlMode==="foreign"&&(t.name=(n=b3.elementNames.get(t.name))!==null&&n!==void 0?n:t.name,t.parent&&ite.has(t.parent.name)&&(e=Ol(Ol({},e),{xmlMode:!1}))),!e.xmlMode&&rte.has(t.name)&&(e=Ol(Ol({},e),{xmlMode:"foreign"}));var i="<".concat(t.name),r=tte(t.attribs,e);return r&&(i+=" ".concat(r)),t.children.length===0&&(e.xmlMode?e.selfClosingTags!==!1:e.selfClosingTags&&E3.has(t.name))?(e.xmlMode||(i+=" "),i+="/>"):(i+=">",t.children.length>0&&(i+=lp(t.children,e)),(e.xmlMode||!E3.has(t.name))&&(i+="</".concat(t.name,">"))),i}function ote(t){return"<".concat(t.data,">")}function ate(t,e){var n,i=t.data||"";return((n=e.encodeEntities)!==null&&n!==void 0?n:e.decodeEntities)!==!1&&!(!e.xmlMode&&t.parent&&Jee.has(t.parent.name))&&(i=e.xmlMode||e.encodeEntities!=="utf8"?(0,ap.encodeXML)(i):(0,ap.escapeText)(i)),i}function lte(t){return"<![CDATA[".concat(t.children[0].data,"]]>")}function ute(t){return"<!--".concat(t.data,"-->")}var cte=qe&&qe.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(ro,"__esModule",{value:!0}),ro.getOuterHTML=T3,ro.getInnerHTML=hte,ro.getText=up,ro.textContent=tb,ro.innerText=nb;var wr=ls,dte=cte(Zc),fte=kl;function T3(t,e){return(0,dte.default)(t,e)}function hte(t,e){return(0,wr.hasChildren)(t)?t.children.map(function(n){return T3(n,e)}).join(""):""}function up(t){return Array.isArray(t)?t.map(up).join(""):(0,wr.isTag)(t)?t.name==="br"?`
`:up(t.children):(0,wr.isCDATA)(t)?up(t.children):(0,wr.isText)(t)?t.data:""}function tb(t){return Array.isArray(t)?t.map(tb).join(""):(0,wr.hasChildren)(t)&&!(0,wr.isComment)(t)?tb(t.children):(0,wr.isText)(t)?t.data:""}function nb(t){return Array.isArray(t)?t.map(nb).join(""):(0,wr.hasChildren)(t)&&(t.type===fte.ElementType.Tag||(0,wr.isCDATA)(t))?nb(t.children):(0,wr.isText)(t)?t.data:""}var _r={};Object.defineProperty(_r,"__esModule",{value:!0}),_r.getChildren=S3,_r.getParent=x3,_r.getSiblings=pte,_r.getAttributeValue=mte,_r.hasAttrib=gte,_r.getName=yte,_r.nextElementSibling=vte,_r.prevElementSibling=bte;var ib=ls;function S3(t){return(0,ib.hasChildren)(t)?t.children:[]}function x3(t){return t.parent||null}function pte(t){var e,n,i=x3(t);if(i!=null)return S3(i);for(var r=[t],s=t.prev,o=t.next;s!=null;)r.unshift(s),e=s,s=e.prev;for(;o!=null;)r.push(o),n=o,o=n.next;return r}function mte(t,e){var n;return(n=t.attribs)===null||n===void 0?void 0:n[e]}function gte(t,e){return t.attribs!=null&&Object.prototype.hasOwnProperty.call(t.attribs,e)&&t.attribs[e]!=null}function yte(t){return t.name}function vte(t){for(var e,n=t.next;n!==null&&!(0,ib.isTag)(n);)e=n,n=e.next;return n}function bte(t){for(var e,n=t.prev;n!==null&&!(0,ib.isTag)(n);)e=n,n=e.prev;return n}var so={};Object.defineProperty(so,"__esModule",{value:!0}),so.removeElement=Jc,so.replaceElement=Ete,so.appendChild=Tte,so.append=Ste,so.prependChild=xte,so.prepend=wte;function Jc(t){if(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t.parent){var e=t.parent.children,n=e.lastIndexOf(t);n>=0&&e.splice(n,1)}t.next=null,t.prev=null,t.parent=null}function Ete(t,e){var n=e.prev=t.prev;n&&(n.next=e);var i=e.next=t.next;i&&(i.prev=e);var r=e.parent=t.parent;if(r){var s=r.children;s[s.lastIndexOf(t)]=e,t.parent=null}}function Tte(t,e){if(Jc(e),e.next=null,e.parent=t,t.children.push(e)>1){var n=t.children[t.children.length-2];n.next=e,e.prev=n}else e.prev=null}function Ste(t,e){Jc(e);var n=t.parent,i=t.next;if(e.next=i,e.prev=t,t.next=e,e.parent=n,i){if(i.prev=e,n){var r=n.children;r.splice(r.lastIndexOf(i),0,e)}}else n&&n.children.push(e)}function xte(t,e){if(Jc(e),e.parent=t,e.prev=null,t.children.unshift(e)!==1){var n=t.children[1];n.prev=e,e.next=n}else e.next=null}function wte(t,e){Jc(e);var n=t.parent;if(n){var i=n.children;i.splice(i.indexOf(t),0,e)}t.prev&&(t.prev.next=e),e.parent=n,e.prev=t.prev,e.next=t,t.prev=e}var cs={};Object.defineProperty(cs,"__esModule",{value:!0}),cs.filter=_te,cs.find=w3,cs.findOneChild=Ate,cs.findOne=_3,cs.existsOne=A3,cs.findAll=Cte;var sa=ls;function _te(t,e,n,i){return n===void 0&&(n=!0),i===void 0&&(i=1/0),w3(t,Array.isArray(e)?e:[e],n,i)}function w3(t,e,n,i){for(var r=[],s=[Array.isArray(e)?e:[e]],o=[0];;){if(o[0]>=s[0].length){if(o.length===1)return r;s.shift(),o.shift();continue}var a=s[0][o[0]++];if(t(a)&&(r.push(a),--i<=0))return r;n&&(0,sa.hasChildren)(a)&&a.children.length>0&&(o.unshift(0),s.unshift(a.children))}}function Ate(t,e){return e.find(t)}function _3(t,e,n){n===void 0&&(n=!0);for(var i=Array.isArray(e)?e:[e],r=0;r<i.length;r++){var s=i[r];if((0,sa.isTag)(s)&&t(s))return s;if(n&&(0,sa.hasChildren)(s)&&s.children.length>0){var o=_3(t,s.children,!0);if(o)return o}}return null}function A3(t,e){return(Array.isArray(e)?e:[e]).some(function(n){return(0,sa.isTag)(n)&&t(n)||(0,sa.hasChildren)(n)&&A3(t,n.children)})}function Cte(t,e){for(var n=[],i=[Array.isArray(e)?e:[e]],r=[0];;){if(r[0]>=i[0].length){if(i.length===1)return n;i.shift(),r.shift();continue}var s=i[0][r[0]++];(0,sa.isTag)(s)&&t(s)&&n.push(s),(0,sa.hasChildren)(s)&&s.children.length>0&&(r.unshift(0),i.unshift(s.children))}}var ds={};Object.defineProperty(ds,"__esModule",{value:!0}),ds.testElement=Rte,ds.getElements=Lte,ds.getElementById=Pte,ds.getElementsByTagName=kte,ds.getElementsByClassName=Dte,ds.getElementsByTagType=Ote;var oa=ls,ed=cs,cp={tag_name:function(t){return typeof t=="function"?function(e){return(0,oa.isTag)(e)&&t(e.name)}:t==="*"?oa.isTag:function(e){return(0,oa.isTag)(e)&&e.name===t}},tag_type:function(t){return typeof t=="function"?function(e){return t(e.type)}:function(e){return e.type===t}},tag_contains:function(t){return typeof t=="function"?function(e){return(0,oa.isText)(e)&&t(e.data)}:function(e){return(0,oa.isText)(e)&&e.data===t}}};function rb(t,e){return typeof e=="function"?function(n){return(0,oa.isTag)(n)&&e(n.attribs[t])}:function(n){return(0,oa.isTag)(n)&&n.attribs[t]===e}}function Ite(t,e){return function(n){return t(n)||e(n)}}function C3(t){var e=Object.keys(t).map(function(n){var i=t[n];return Object.prototype.hasOwnProperty.call(cp,n)?cp[n](i):rb(n,i)});return e.length===0?null:e.reduce(Ite)}function Rte(t,e){var n=C3(t);return n?n(e):!0}function Lte(t,e,n,i){i===void 0&&(i=1/0);var r=C3(t);return r?(0,ed.filter)(r,e,n,i):[]}function Pte(t,e,n){return n===void 0&&(n=!0),Array.isArray(e)||(e=[e]),(0,ed.findOne)(rb("id",t),e,n)}function kte(t,e,n,i){return n===void 0&&(n=!0),i===void 0&&(i=1/0),(0,ed.filter)(cp.tag_name(t),e,n,i)}function Dte(t,e,n,i){return n===void 0&&(n=!0),i===void 0&&(i=1/0),(0,ed.filter)(rb("class",t),e,n,i)}function Ote(t,e,n,i){return n===void 0&&(n=!0),i===void 0&&(i=1/0),(0,ed.filter)(cp.tag_type(t),e,n,i)}var aa={};Object.defineProperty(aa,"__esModule",{value:!0}),aa.DocumentPosition=void 0,aa.removeSubsets=Nte,aa.compareDocumentPosition=R3,aa.uniqueSort=Mte;var I3=ls;function Nte(t){for(var e=t.length;--e>=0;){var n=t[e];if(e>0&&t.lastIndexOf(n,e-1)>=0){t.splice(e,1);continue}for(var i=n.parent;i;i=i.parent)if(t.includes(i)){t.splice(e,1);break}}return t}var tr;(function(t){t[t.DISCONNECTED=1]="DISCONNECTED",t[t.PRECEDING=2]="PRECEDING",t[t.FOLLOWING=4]="FOLLOWING",t[t.CONTAINS=8]="CONTAINS",t[t.CONTAINED_BY=16]="CONTAINED_BY"})(tr||(aa.DocumentPosition=tr={}));function R3(t,e){var n=[],i=[];if(t===e)return 0;for(var r=(0,I3.hasChildren)(t)?t:t.parent;r;)n.unshift(r),r=r.parent;for(r=(0,I3.hasChildren)(e)?e:e.parent;r;)i.unshift(r),r=r.parent;for(var s=Math.min(n.length,i.length),o=0;o<s&&n[o]===i[o];)o++;if(o===0)return tr.DISCONNECTED;var a=n[o-1],l=a.children,u=n[o],c=i[o];return l.indexOf(u)>l.indexOf(c)?a===e?tr.FOLLOWING|tr.CONTAINED_BY:tr.FOLLOWING:a===t?tr.PRECEDING|tr.CONTAINS:tr.PRECEDING}function Mte(t){return t=t.filter(function(e,n,i){return!i.includes(e,n+1)}),t.sort(function(e,n){var i=R3(e,n);return i&tr.PRECEDING?-1:i&tr.FOLLOWING?1:0}),t}var sb={};Object.defineProperty(sb,"__esModule",{value:!0}),sb.getFeed=Bte;var Fte=ro,td=ds;function Bte(t){var e=dp(Vte,t);return e?e.name==="feed"?Ute(e):Hte(e):null}function Ute(t){var e,n=t.children,i={type:"atom",items:(0,td.getElementsByTagName)("entry",n).map(function(o){var a,l=o.children,u={media:L3(l)};si(u,"id","id",l),si(u,"title","title",l);var c=(a=dp("link",l))===null||a===void 0?void 0:a.attribs.href;c&&(u.link=c);var d=oo("summary",l)||oo("content",l);d&&(u.description=d);var f=oo("updated",l);return f&&(u.pubDate=new Date(f)),u})};si(i,"id","id",n),si(i,"title","title",n);var r=(e=dp("link",n))===null||e===void 0?void 0:e.attribs.href;r&&(i.link=r),si(i,"description","subtitle",n);var s=oo("updated",n);return s&&(i.updated=new Date(s)),si(i,"author","email",n,!0),i}function Hte(t){var e,n,i=(n=(e=dp("channel",t.children))===null||e===void 0?void 0:e.children)!==null&&n!==void 0?n:[],r={type:t.name.substr(0,3),id:"",items:(0,td.getElementsByTagName)("item",t.children).map(function(o){var a=o.children,l={media:L3(a)};si(l,"id","guid",a),si(l,"title","title",a),si(l,"link","link",a),si(l,"description","description",a);var u=oo("pubDate",a)||oo("dc:date",a);return u&&(l.pubDate=new Date(u)),l})};si(r,"title","title",i),si(r,"link","link",i),si(r,"description","description",i);var s=oo("lastBuildDate",i);return s&&(r.updated=new Date(s)),si(r,"author","managingEditor",i,!0),r}var $te=["url","type","lang"],zte=["fileSize","bitrate","framerate","samplingrate","channels","duration","height","width"];function L3(t){return(0,td.getElementsByTagName)("media:content",t).map(function(e){for(var n=e.attribs,i={medium:n.medium,isDefault:!!n.isDefault},r=0,s=$te;r<s.length;r++){var o=s[r];n[o]&&(i[o]=n[o])}for(var a=0,l=zte;a<l.length;a++){var o=l[a];n[o]&&(i[o]=parseInt(n[o],10))}return n.expression&&(i.expression=n.expression),i})}function dp(t,e){return(0,td.getElementsByTagName)(t,e,!0,1)[0]}function oo(t,e,n){return n===void 0&&(n=!1),(0,Fte.textContent)((0,td.getElementsByTagName)(t,e,n,1)).trim()}function si(t,e,n,i,r){r===void 0&&(r=!1);var s=oo(n,i,r);s&&(t[e]=s)}function Vte(t){return t==="rss"||t==="feed"||t==="rdf:RDF"}(function(t){var e=qe&&qe.__createBinding||(Object.create?function(r,s,o,a){a===void 0&&(a=o);var l=Object.getOwnPropertyDescriptor(s,o);(!l||("get"in l?!s.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return s[o]}}),Object.defineProperty(r,a,l)}:function(r,s,o,a){a===void 0&&(a=o),r[a]=s[o]}),n=qe&&qe.__exportStar||function(r,s){for(var o in r)o!=="default"&&!Object.prototype.hasOwnProperty.call(s,o)&&e(s,r,o)};Object.defineProperty(t,"__esModule",{value:!0}),t.hasChildren=t.isDocument=t.isComment=t.isText=t.isCDATA=t.isTag=void 0,n(ro,t),n(_r,t),n(so,t),n(cs,t),n(ds,t),n(aa,t),n(sb,t);var i=ls;Object.defineProperty(t,"isTag",{enumerable:!0,get:function(){return i.isTag}}),Object.defineProperty(t,"isCDATA",{enumerable:!0,get:function(){return i.isCDATA}}),Object.defineProperty(t,"isText",{enumerable:!0,get:function(){return i.isText}}),Object.defineProperty(t,"isComment",{enumerable:!0,get:function(){return i.isComment}}),Object.defineProperty(t,"isDocument",{enumerable:!0,get:function(){return i.isDocument}}),Object.defineProperty(t,"hasChildren",{enumerable:!0,get:function(){return i.hasChildren}})})(rp),function(t){var e=qe&&qe.__createBinding||(Object.create?function(g,v,b,T){T===void 0&&(T=b);var S=Object.getOwnPropertyDescriptor(v,b);(!S||("get"in S?!v.__esModule:S.writable||S.configurable))&&(S={enumerable:!0,get:function(){return v[b]}}),Object.defineProperty(g,T,S)}:function(g,v,b,T){T===void 0&&(T=b),g[T]=v[b]}),n=qe&&qe.__setModuleDefault||(Object.create?function(g,v){Object.defineProperty(g,"default",{enumerable:!0,value:v})}:function(g,v){g.default=v}),i=qe&&qe.__importStar||function(g){if(g&&g.__esModule)return g;var v={};if(g!=null)for(var b in g)b!=="default"&&Object.prototype.hasOwnProperty.call(g,b)&&e(v,g,b);return n(v,g),v},r=qe&&qe.__importDefault||function(g){return g&&g.__esModule?g:{default:g}};Object.defineProperty(t,"__esModule",{value:!0}),t.DomUtils=t.parseFeed=t.getFeed=t.ElementType=t.Tokenizer=t.createDomStream=t.parseDOM=t.parseDocument=t.DefaultHandler=t.DomHandler=t.Parser=void 0;var s=Yc,o=Yc;Object.defineProperty(t,"Parser",{enumerable:!0,get:function(){return o.Parser}});var a=ls,l=ls;Object.defineProperty(t,"DomHandler",{enumerable:!0,get:function(){return l.DomHandler}}),Object.defineProperty(t,"DefaultHandler",{enumerable:!0,get:function(){return l.DomHandler}});function u(g,v){var b=new a.DomHandler(void 0,v);return new s.Parser(b,v).end(g),b.root}t.parseDocument=u;function c(g,v){return u(g,v).children}t.parseDOM=c;function d(g,v,b){var T=new a.DomHandler(g,v,b);return new s.Parser(T,v)}t.createDomStream=d;var f=qv;Object.defineProperty(t,"Tokenizer",{enumerable:!0,get:function(){return r(f).default}}),t.ElementType=i(kl);var h=rp,p=rp;Object.defineProperty(t,"getFeed",{enumerable:!0,get:function(){return p.getFeed}});var m={xmlMode:!0};function y(g,v){return v===void 0&&(v=m),(0,h.getFeed)(c(g,v))}t.parseFeed=y,t.DomUtils=i(rp)}(Qk);var Gte=t=>{if(typeof t!="string")throw new TypeError("Expected a string");return t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")},ob={};Object.defineProperty(ob,"__esModule",{value:!0});/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */function P3(t){return Object.prototype.toString.call(t)==="[object Object]"}function jte(t){var e,n;return P3(t)===!1?!1:(e=t.constructor,e===void 0?!0:(n=e.prototype,!(P3(n)===!1||n.hasOwnProperty("isPrototypeOf")===!1)))}ob.isPlainObject=jte;var Wte=function(e){return qte(e)&&!Kte(e)};function qte(t){return!!t&&typeof t=="object"}function Kte(t){var e=Object.prototype.toString.call(t);return e==="[object RegExp]"||e==="[object Date]"||Qte(t)}var Yte=typeof Symbol=="function"&&Symbol.for,Xte=Yte?Symbol.for("react.element"):60103;function Qte(t){return t.$$typeof===Xte}function Zte(t){return Array.isArray(t)?[]:{}}function nd(t,e){return e.clone!==!1&&e.isMergeableObject(t)?Nl(Zte(t),t,e):t}function Jte(t,e,n){return t.concat(e).map(function(i){return nd(i,n)})}function ene(t,e){if(!e.customMerge)return Nl;var n=e.customMerge(t);return typeof n=="function"?n:Nl}function tne(t){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(t).filter(function(e){return Object.propertyIsEnumerable.call(t,e)}):[]}function k3(t){return Object.keys(t).concat(tne(t))}function D3(t,e){try{return e in t}catch{return!1}}function nne(t,e){return D3(t,e)&&!(Object.hasOwnProperty.call(t,e)&&Object.propertyIsEnumerable.call(t,e))}function ine(t,e,n){var i={};return n.isMergeableObject(t)&&k3(t).forEach(function(r){i[r]=nd(t[r],n)}),k3(e).forEach(function(r){nne(t,r)||(D3(t,r)&&n.isMergeableObject(e[r])?i[r]=ene(r,n)(t[r],e[r],n):i[r]=nd(e[r],n))}),i}function Nl(t,e,n){n=n||{},n.arrayMerge=n.arrayMerge||Jte,n.isMergeableObject=n.isMergeableObject||Wte,n.cloneUnlessOtherwiseSpecified=nd;var i=Array.isArray(e),r=Array.isArray(t),s=i===r;return s?i?n.arrayMerge(t,e,n):ine(t,e,n):nd(e,n)}Nl.all=function(e,n){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(i,r){return Nl(i,r,n)},{})};var rne=Nl,sne=rne,O3={exports:{}};(function(t){(function(e,n){t.exports?t.exports=n():e.parseSrcset=n()})(qe,function(){return function(e){function n(T){return T===" "||T==="	"||T===`
`||T==="\f"||T==="\r"}function i(T){var S,_=T.exec(e.substring(y));if(_)return S=_[0],y+=S.length,S}for(var r=e.length,s=/^[ \t\n\r\u000c]+/,o=/^[, \t\n\r\u000c]+/,a=/^[^ \t\n\r\u000c]+/,l=/[,]+$/,u=/^\d+$/,c=/^-?(?:[0-9]+|[0-9]*\.[0-9]+)(?:[eE][+-]?[0-9]+)?$/,d,f,h,p,m,y=0,g=[];;){if(i(o),y>=r)return g;d=i(a),f=[],d.slice(-1)===","?(d=d.replace(l,""),b()):v()}function v(){for(i(s),h="",p="in descriptor";;){if(m=e.charAt(y),p==="in descriptor")if(n(m))h&&(f.push(h),h="",p="after descriptor");else if(m===","){y+=1,h&&f.push(h),b();return}else if(m==="(")h=h+m,p="in parens";else if(m===""){h&&f.push(h),b();return}else h=h+m;else if(p==="in parens")if(m===")")h=h+m,p="in descriptor";else if(m===""){f.push(h),b();return}else h=h+m;else if(p==="after descriptor"&&!n(m))if(m===""){b();return}else p="in descriptor",y-=1;y+=1}}function b(){var T=!1,S,_,A,P,O={},x,L,M,V,K;for(P=0;P<f.length;P++)x=f[P],L=x[x.length-1],M=x.substring(0,x.length-1),V=parseInt(M,10),K=parseFloat(M),u.test(M)&&L==="w"?((S||_)&&(T=!0),V===0?T=!0:S=V):c.test(M)&&L==="x"?((S||_||A)&&(T=!0),K<0?T=!0:_=K):u.test(M)&&L==="h"?((A||_)&&(T=!0),V===0?T=!0:A=V):T=!0;T?console&&console.log&&console.log("Invalid srcset descriptor found in '"+e+"' at '"+x+"'."):(O.url=d,S&&(O.w=S),_&&(O.d=_),A&&(O.h=A),g.push(O))}}})})(O3);var one=O3.exports,ab={exports:{}},rt=String,N3=function(){return{isColorSupported:!1,reset:rt,bold:rt,dim:rt,italic:rt,underline:rt,inverse:rt,hidden:rt,strikethrough:rt,black:rt,red:rt,green:rt,yellow:rt,blue:rt,magenta:rt,cyan:rt,white:rt,gray:rt,bgBlack:rt,bgRed:rt,bgGreen:rt,bgYellow:rt,bgBlue:rt,bgMagenta:rt,bgCyan:rt,bgWhite:rt,blackBright:rt,redBright:rt,greenBright:rt,yellowBright:rt,blueBright:rt,magentaBright:rt,cyanBright:rt,whiteBright:rt,bgBlackBright:rt,bgRedBright:rt,bgGreenBright:rt,bgYellowBright:rt,bgBlueBright:rt,bgMagentaBright:rt,bgCyanBright:rt,bgWhiteBright:rt}};ab.exports=N3(),ab.exports.createColors=N3;var ane=ab.exports;const nr=MS(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));let M3=ane,F3=nr,lb=class p8 extends Error{constructor(e,n,i,r,s,o){super(e),this.name="CssSyntaxError",this.reason=e,s&&(this.file=s),r&&(this.source=r),o&&(this.plugin=o),typeof n<"u"&&typeof i<"u"&&(typeof n=="number"?(this.line=n,this.column=i):(this.line=n.line,this.column=n.column,this.endLine=i.line,this.endColumn=i.column)),this.setMessage(),Error.captureStackTrace&&Error.captureStackTrace(this,p8)}setMessage(){this.message=this.plugin?this.plugin+": ":"",this.message+=this.file?this.file:"<css input>",typeof this.line<"u"&&(this.message+=":"+this.line+":"+this.column),this.message+=": "+this.reason}showSourceCode(e){if(!this.source)return"";let n=this.source;e==null&&(e=M3.isColorSupported),F3&&e&&(n=F3(n));let i=n.split(/\r?\n/),r=Math.max(this.line-3,0),s=Math.min(this.line+2,i.length),o=String(s).length,a,l;if(e){let{bold:u,gray:c,red:d}=M3.createColors(!0);a=f=>u(d(f)),l=f=>c(f)}else a=l=u=>u;return i.slice(r,s).map((u,c)=>{let d=r+1+c,f=" "+(" "+d).slice(-o)+" | ";if(d===this.line){let h=l(f.replace(/\d/g," "))+u.slice(0,this.column-1).replace(/[^\t]/g," ");return a(">")+l(f)+u+`
 `+h+a("^")}return" "+l(f)+u}).join(`
`)}toString(){let e=this.showSourceCode();return e&&(e=`

`+e+`
`),this.name+": "+this.message+e}};var ub=lb;lb.default=lb;var id={};id.isClean=Symbol("isClean"),id.my=Symbol("my");const B3={after:`
`,beforeClose:`
`,beforeComment:`
`,beforeDecl:`
`,beforeOpen:" ",beforeRule:`
`,colon:": ",commentLeft:" ",commentRight:" ",emptyBody:"",indent:"    ",semicolon:!1};function lne(t){return t[0].toUpperCase()+t.slice(1)}let cb=class{constructor(e){this.builder=e}atrule(e,n){let i="@"+e.name,r=e.params?this.rawValue(e,"params"):"";if(typeof e.raws.afterName<"u"?i+=e.raws.afterName:r&&(i+=" "),e.nodes)this.block(e,i+r);else{let s=(e.raws.between||"")+(n?";":"");this.builder(i+r+s,e)}}beforeAfter(e,n){let i;e.type==="decl"?i=this.raw(e,null,"beforeDecl"):e.type==="comment"?i=this.raw(e,null,"beforeComment"):n==="before"?i=this.raw(e,null,"beforeRule"):i=this.raw(e,null,"beforeClose");let r=e.parent,s=0;for(;r&&r.type!=="root";)s+=1,r=r.parent;if(i.includes(`
`)){let o=this.raw(e,null,"indent");if(o.length)for(let a=0;a<s;a++)i+=o}return i}block(e,n){let i=this.raw(e,"between","beforeOpen");this.builder(n+i+"{",e,"start");let r;e.nodes&&e.nodes.length?(this.body(e),r=this.raw(e,"after")):r=this.raw(e,"after","emptyBody"),r&&this.builder(r),this.builder("}",e,"end")}body(e){let n=e.nodes.length-1;for(;n>0&&e.nodes[n].type==="comment";)n-=1;let i=this.raw(e,"semicolon");for(let r=0;r<e.nodes.length;r++){let s=e.nodes[r],o=this.raw(s,"before");o&&this.builder(o),this.stringify(s,n!==r||i)}}comment(e){let n=this.raw(e,"left","commentLeft"),i=this.raw(e,"right","commentRight");this.builder("/*"+n+e.text+i+"*/",e)}decl(e,n){let i=this.raw(e,"between","colon"),r=e.prop+i+this.rawValue(e,"value");e.important&&(r+=e.raws.important||" !important"),n&&(r+=";"),this.builder(r,e)}document(e){this.body(e)}raw(e,n,i){let r;if(i||(i=n),n&&(r=e.raws[n],typeof r<"u"))return r;let s=e.parent;if(i==="before"&&(!s||s.type==="root"&&s.first===e||s&&s.type==="document"))return"";if(!s)return B3[i];let o=e.root();if(o.rawCache||(o.rawCache={}),typeof o.rawCache[i]<"u")return o.rawCache[i];if(i==="before"||i==="after")return this.beforeAfter(e,i);{let a="raw"+lne(i);this[a]?r=this[a](o,e):o.walk(l=>{if(r=l.raws[n],typeof r<"u")return!1})}return typeof r>"u"&&(r=B3[i]),o.rawCache[i]=r,r}rawBeforeClose(e){let n;return e.walk(i=>{if(i.nodes&&i.nodes.length>0&&typeof i.raws.after<"u")return n=i.raws.after,n.includes(`
`)&&(n=n.replace(/[^\n]+$/,"")),!1}),n&&(n=n.replace(/\S/g,"")),n}rawBeforeComment(e,n){let i;return e.walkComments(r=>{if(typeof r.raws.before<"u")return i=r.raws.before,i.includes(`
`)&&(i=i.replace(/[^\n]+$/,"")),!1}),typeof i>"u"?i=this.raw(n,null,"beforeDecl"):i&&(i=i.replace(/\S/g,"")),i}rawBeforeDecl(e,n){let i;return e.walkDecls(r=>{if(typeof r.raws.before<"u")return i=r.raws.before,i.includes(`
`)&&(i=i.replace(/[^\n]+$/,"")),!1}),typeof i>"u"?i=this.raw(n,null,"beforeRule"):i&&(i=i.replace(/\S/g,"")),i}rawBeforeOpen(e){let n;return e.walk(i=>{if(i.type!=="decl"&&(n=i.raws.between,typeof n<"u"))return!1}),n}rawBeforeRule(e){let n;return e.walk(i=>{if(i.nodes&&(i.parent!==e||e.first!==i)&&typeof i.raws.before<"u")return n=i.raws.before,n.includes(`
`)&&(n=n.replace(/[^\n]+$/,"")),!1}),n&&(n=n.replace(/\S/g,"")),n}rawColon(e){let n;return e.walkDecls(i=>{if(typeof i.raws.between<"u")return n=i.raws.between.replace(/[^\s:]/g,""),!1}),n}rawEmptyBody(e){let n;return e.walk(i=>{if(i.nodes&&i.nodes.length===0&&(n=i.raws.after,typeof n<"u"))return!1}),n}rawIndent(e){if(e.raws.indent)return e.raws.indent;let n;return e.walk(i=>{let r=i.parent;if(r&&r!==e&&r.parent&&r.parent===e&&typeof i.raws.before<"u"){let s=i.raws.before.split(`
`);return n=s[s.length-1],n=n.replace(/\S/g,""),!1}}),n}rawSemicolon(e){let n;return e.walk(i=>{if(i.nodes&&i.nodes.length&&i.last.type==="decl"&&(n=i.raws.semicolon,typeof n<"u"))return!1}),n}rawValue(e,n){let i=e[n],r=e.raws[n];return r&&r.value===i?r.raw:i}root(e){this.body(e),e.raws.after&&this.builder(e.raws.after)}rule(e){this.block(e,this.rawValue(e,"selector")),e.raws.ownSemicolon&&this.builder(e.raws.ownSemicolon,e,"end")}stringify(e,n){if(!this[e.type])throw new Error("Unknown AST node type "+e.type+". Maybe you need to change PostCSS stringifier.");this[e.type](e,n)}};var U3=cb;cb.default=cb;let une=U3;function db(t,e){new une(e).stringify(t)}var fp=db;db.default=db;let{isClean:hp,my:cne}=id,dne=ub,fne=U3,hne=fp;function fb(t,e){let n=new t.constructor;for(let i in t){if(!Object.prototype.hasOwnProperty.call(t,i)||i==="proxyCache")continue;let r=t[i],s=typeof r;i==="parent"&&s==="object"?e&&(n[i]=e):i==="source"?n[i]=r:Array.isArray(r)?n[i]=r.map(o=>fb(o,n)):(s==="object"&&r!==null&&(r=fb(r)),n[i]=r)}return n}let hb=class{constructor(e={}){this.raws={},this[hp]=!1,this[cne]=!0;for(let n in e)if(n==="nodes"){this.nodes=[];for(let i of e[n])typeof i.clone=="function"?this.append(i.clone()):this.append(i)}else this[n]=e[n]}addToError(e){if(e.postcssNode=this,e.stack&&this.source&&/\n\s{4}at /.test(e.stack)){let n=this.source;e.stack=e.stack.replace(/\n\s{4}at /,`$&${n.input.from}:${n.start.line}:${n.start.column}$&`)}return e}after(e){return this.parent.insertAfter(this,e),this}assign(e={}){for(let n in e)this[n]=e[n];return this}before(e){return this.parent.insertBefore(this,e),this}cleanRaws(e){delete this.raws.before,delete this.raws.after,e||delete this.raws.between}clone(e={}){let n=fb(this);for(let i in e)n[i]=e[i];return n}cloneAfter(e={}){let n=this.clone(e);return this.parent.insertAfter(this,n),n}cloneBefore(e={}){let n=this.clone(e);return this.parent.insertBefore(this,n),n}error(e,n={}){if(this.source){let{end:i,start:r}=this.rangeBy(n);return this.source.input.error(e,{column:r.column,line:r.line},{column:i.column,line:i.line},n)}return new dne(e)}getProxyProcessor(){return{get(e,n){return n==="proxyOf"?e:n==="root"?()=>e.root().toProxy():e[n]},set(e,n,i){return e[n]===i||(e[n]=i,(n==="prop"||n==="value"||n==="name"||n==="params"||n==="important"||n==="text")&&e.markDirty()),!0}}}markDirty(){if(this[hp]){this[hp]=!1;let e=this;for(;e=e.parent;)e[hp]=!1}}next(){if(!this.parent)return;let e=this.parent.index(this);return this.parent.nodes[e+1]}positionBy(e,n){let i=this.source.start;if(e.index)i=this.positionInside(e.index,n);else if(e.word){n=this.toString();let r=n.indexOf(e.word);r!==-1&&(i=this.positionInside(r,n))}return i}positionInside(e,n){let i=n||this.toString(),r=this.source.start.column,s=this.source.start.line;for(let o=0;o<e;o++)i[o]===`
`?(r=1,s+=1):r+=1;return{column:r,line:s}}prev(){if(!this.parent)return;let e=this.parent.index(this);return this.parent.nodes[e-1]}rangeBy(e){let n={column:this.source.start.column,line:this.source.start.line},i=this.source.end?{column:this.source.end.column+1,line:this.source.end.line}:{column:n.column+1,line:n.line};if(e.word){let r=this.toString(),s=r.indexOf(e.word);s!==-1&&(n=this.positionInside(s,r),i=this.positionInside(s+e.word.length,r))}else e.start?n={column:e.start.column,line:e.start.line}:e.index&&(n=this.positionInside(e.index)),e.end?i={column:e.end.column,line:e.end.line}:e.endIndex?i=this.positionInside(e.endIndex):e.index&&(i=this.positionInside(e.index+1));return(i.line<n.line||i.line===n.line&&i.column<=n.column)&&(i={column:n.column+1,line:n.line}),{end:i,start:n}}raw(e,n){return new fne().raw(this,e,n)}remove(){return this.parent&&this.parent.removeChild(this),this.parent=void 0,this}replaceWith(...e){if(this.parent){let n=this,i=!1;for(let r of e)r===this?i=!0:i?(this.parent.insertAfter(n,r),n=r):this.parent.insertBefore(n,r);i||this.remove()}return this}root(){let e=this;for(;e.parent&&e.parent.type!=="document";)e=e.parent;return e}toJSON(e,n){let i={},r=n==null;n=n||new Map;let s=0;for(let o in this){if(!Object.prototype.hasOwnProperty.call(this,o)||o==="parent"||o==="proxyCache")continue;let a=this[o];if(Array.isArray(a))i[o]=a.map(l=>typeof l=="object"&&l.toJSON?l.toJSON(null,n):l);else if(typeof a=="object"&&a.toJSON)i[o]=a.toJSON(null,n);else if(o==="source"){let l=n.get(a.input);l==null&&(l=s,n.set(a.input,s),s++),i[o]={end:a.end,inputId:l,start:a.start}}else i[o]=a}return r&&(i.inputs=[...n.keys()].map(o=>o.toJSON())),i}toProxy(){return this.proxyCache||(this.proxyCache=new Proxy(this,this.getProxyProcessor())),this.proxyCache}toString(e=hne){e.stringify&&(e=e.stringify);let n="";return e(this,i=>{n+=i}),n}warn(e,n,i){let r={node:this};for(let s in i)r[s]=i[s];return e.warn(n,r)}get proxyOf(){return this}};var pp=hb;hb.default=hb;let pne=pp,pb=class extends pne{constructor(e){e&&typeof e.value<"u"&&typeof e.value!="string"&&(e={...e,value:String(e.value)}),super(e),this.type="decl"}get variable(){return this.prop.startsWith("--")||this.prop[0]==="$"}};var mp=pb;pb.default=pb;let mne="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";var gne={nanoid:(t=21)=>{let e="",n=t|0;for(;n--;)e+=mne[Math.random()*64|0];return e}};let{SourceMapConsumer:H3,SourceMapGenerator:$3}=nr,{existsSync:yne,readFileSync:vne}=nr,{dirname:mb,join:bne}=nr;function Ene(t){return Buffer?Buffer.from(t,"base64").toString():window.atob(t)}let gb=class{constructor(e,n){if(n.map===!1)return;this.loadAnnotation(e),this.inline=this.startWith(this.annotation,"data:");let i=n.map?n.map.prev:void 0,r=this.loadMap(n.from,i);!this.mapFile&&n.from&&(this.mapFile=n.from),this.mapFile&&(this.root=mb(this.mapFile)),r&&(this.text=r)}consumer(){return this.consumerCache||(this.consumerCache=new H3(this.text)),this.consumerCache}decodeInline(e){let n=/^data:application\/json;charset=utf-?8;base64,/,i=/^data:application\/json;base64,/,r=/^data:application\/json;charset=utf-?8,/,s=/^data:application\/json,/;if(r.test(e)||s.test(e))return decodeURIComponent(e.substr(RegExp.lastMatch.length));if(n.test(e)||i.test(e))return Ene(e.substr(RegExp.lastMatch.length));let o=e.match(/data:application\/json;([^,]+),/)[1];throw new Error("Unsupported source map encoding "+o)}getAnnotationURL(e){return e.replace(/^\/\*\s*# sourceMappingURL=/,"").trim()}isMap(e){return typeof e!="object"?!1:typeof e.mappings=="string"||typeof e._mappings=="string"||Array.isArray(e.sections)}loadAnnotation(e){let n=e.match(/\/\*\s*# sourceMappingURL=/gm);if(!n)return;let i=e.lastIndexOf(n.pop()),r=e.indexOf("*/",i);i>-1&&r>-1&&(this.annotation=this.getAnnotationURL(e.substring(i,r)))}loadFile(e){if(this.root=mb(e),yne(e))return this.mapFile=e,vne(e,"utf-8").toString().trim()}loadMap(e,n){if(n===!1)return!1;if(n){if(typeof n=="string")return n;if(typeof n=="function"){let i=n(e);if(i){let r=this.loadFile(i);if(!r)throw new Error("Unable to load previous source map: "+i.toString());return r}}else{if(n instanceof H3)return $3.fromSourceMap(n).toString();if(n instanceof $3)return n.toString();if(this.isMap(n))return JSON.stringify(n);throw new Error("Unsupported previous source map format: "+n.toString())}}else{if(this.inline)return this.decodeInline(this.annotation);if(this.annotation){let i=this.annotation;return e&&(i=bne(mb(e),i)),this.loadFile(i)}}}startWith(e,n){return e?e.substr(0,n.length)===n:!1}withContent(){return!!(this.consumer().sourcesContent&&this.consumer().sourcesContent.length>0)}};var z3=gb;gb.default=gb;let{SourceMapConsumer:Tne,SourceMapGenerator:Sne}=nr,{fileURLToPath:V3,pathToFileURL:gp}=nr,{isAbsolute:yb,resolve:vb}=nr,{nanoid:xne}=gne,bb=nr,G3=ub,wne=z3,Eb=Symbol("fromOffsetCache"),_ne=!!(Tne&&Sne),j3=!!(vb&&yb),yp=class{constructor(e,n={}){if(e===null||typeof e>"u"||typeof e=="object"&&!e.toString)throw new Error(`PostCSS received ${e} instead of CSS string`);if(this.css=e.toString(),this.css[0]==="\uFEFF"||this.css[0]===""?(this.hasBOM=!0,this.css=this.css.slice(1)):this.hasBOM=!1,n.from&&(!j3||/^\w+:\/\//.test(n.from)||yb(n.from)?this.file=n.from:this.file=vb(n.from)),j3&&_ne){let i=new wne(this.css,n);if(i.text){this.map=i;let r=i.consumer().file;!this.file&&r&&(this.file=this.mapResolve(r))}}this.file||(this.id="<input css "+xne(6)+">"),this.map&&(this.map.file=this.from)}error(e,n,i,r={}){let s,o,a;if(n&&typeof n=="object"){let u=n,c=i;if(typeof u.offset=="number"){let d=this.fromOffset(u.offset);n=d.line,i=d.col}else n=u.line,i=u.column;if(typeof c.offset=="number"){let d=this.fromOffset(c.offset);o=d.line,a=d.col}else o=c.line,a=c.column}else if(!i){let u=this.fromOffset(n);n=u.line,i=u.col}let l=this.origin(n,i,o,a);return l?s=new G3(e,l.endLine===void 0?l.line:{column:l.column,line:l.line},l.endLine===void 0?l.column:{column:l.endColumn,line:l.endLine},l.source,l.file,r.plugin):s=new G3(e,o===void 0?n:{column:i,line:n},o===void 0?i:{column:a,line:o},this.css,this.file,r.plugin),s.input={column:i,endColumn:a,endLine:o,line:n,source:this.css},this.file&&(gp&&(s.input.url=gp(this.file).toString()),s.input.file=this.file),s}fromOffset(e){let n,i;if(this[Eb])i=this[Eb];else{let s=this.css.split(`
`);i=new Array(s.length);let o=0;for(let a=0,l=s.length;a<l;a++)i[a]=o,o+=s[a].length+1;this[Eb]=i}n=i[i.length-1];let r=0;if(e>=n)r=i.length-1;else{let s=i.length-2,o;for(;r<s;)if(o=r+(s-r>>1),e<i[o])s=o-1;else if(e>=i[o+1])r=o+1;else{r=o;break}}return{col:e-i[r]+1,line:r+1}}mapResolve(e){return/^\w+:\/\//.test(e)?e:vb(this.map.consumer().sourceRoot||this.map.root||".",e)}origin(e,n,i,r){if(!this.map)return!1;let s=this.map.consumer(),o=s.originalPositionFor({column:n,line:e});if(!o.source)return!1;let a;typeof i=="number"&&(a=s.originalPositionFor({column:r,line:i}));let l;yb(o.source)?l=gp(o.source):l=new URL(o.source,this.map.consumer().sourceRoot||gp(this.map.mapFile));let u={column:o.column,endColumn:a&&a.column,endLine:a&&a.line,line:o.line,url:l.toString()};if(l.protocol==="file:")if(V3)u.file=V3(l);else throw new Error("file: protocol is not available in this PostCSS build");let c=s.sourceContentFor(o.source);return c&&(u.source=c),u}toJSON(){let e={};for(let n of["hasBOM","css","file","id"])this[n]!=null&&(e[n]=this[n]);return this.map&&(e.map={...this.map},e.map.consumerCache&&(e.map.consumerCache=void 0)),e}get from(){return this.file||this.id}};var vp=yp;yp.default=yp,bb&&bb.registerInput&&bb.registerInput(yp);let{SourceMapConsumer:W3,SourceMapGenerator:bp}=nr,{dirname:Ep,relative:q3,resolve:K3,sep:Y3}=nr,{pathToFileURL:X3}=nr,Ane=vp,Cne=!!(W3&&bp),Ine=!!(Ep&&K3&&q3&&Y3);var Q3=class{constructor(e,n,i,r){this.stringify=e,this.mapOpts=i.map||{},this.root=n,this.opts=i,this.css=r,this.usesFileUrls=!this.mapOpts.from&&this.mapOpts.absolute,this.memoizedFileURLs=new Map,this.memoizedPaths=new Map,this.memoizedURLs=new Map}addAnnotation(){let e;this.isInline()?e="data:application/json;base64,"+this.toBase64(this.map.toString()):typeof this.mapOpts.annotation=="string"?e=this.mapOpts.annotation:typeof this.mapOpts.annotation=="function"?e=this.mapOpts.annotation(this.opts.to,this.root):e=this.outputFile()+".map";let n=`
`;this.css.includes(`\r
`)&&(n=`\r
`),this.css+=n+"/*# sourceMappingURL="+e+" */"}applyPrevMaps(){for(let e of this.previous()){let n=this.toUrl(this.path(e.file)),i=e.root||Ep(e.file),r;this.mapOpts.sourcesContent===!1?(r=new W3(e.text),r.sourcesContent&&(r.sourcesContent=r.sourcesContent.map(()=>null))):r=e.consumer(),this.map.applySourceMap(r,n,this.toUrl(this.path(i)))}}clearAnnotation(){if(this.mapOpts.annotation!==!1)if(this.root){let e;for(let n=this.root.nodes.length-1;n>=0;n--)e=this.root.nodes[n],e.type==="comment"&&e.text.indexOf("# sourceMappingURL=")===0&&this.root.removeChild(n)}else this.css&&(this.css=this.css.replace(/(\n)?\/\*#[\S\s]*?\*\/$/gm,""))}generate(){if(this.clearAnnotation(),Ine&&Cne&&this.isMap())return this.generateMap();{let e="";return this.stringify(this.root,n=>{e+=n}),[e]}}generateMap(){if(this.root)this.generateString();else if(this.previous().length===1){let e=this.previous()[0].consumer();e.file=this.outputFile(),this.map=bp.fromSourceMap(e)}else this.map=new bp({file:this.outputFile()}),this.map.addMapping({generated:{column:0,line:1},original:{column:0,line:1},source:this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>"});return this.isSourcesContent()&&this.setSourcesContent(),this.root&&this.previous().length>0&&this.applyPrevMaps(),this.isAnnotation()&&this.addAnnotation(),this.isInline()?[this.css]:[this.css,this.map]}generateString(){this.css="",this.map=new bp({file:this.outputFile()});let e=1,n=1,i="<no source>",r={generated:{column:0,line:0},original:{column:0,line:0},source:""},s,o;this.stringify(this.root,(a,l,u)=>{if(this.css+=a,l&&u!=="end"&&(r.generated.line=e,r.generated.column=n-1,l.source&&l.source.start?(r.source=this.sourcePath(l),r.original.line=l.source.start.line,r.original.column=l.source.start.column-1,this.map.addMapping(r)):(r.source=i,r.original.line=1,r.original.column=0,this.map.addMapping(r))),s=a.match(/\n/g),s?(e+=s.length,o=a.lastIndexOf(`
`),n=a.length-o):n+=a.length,l&&u!=="start"){let c=l.parent||{raws:{}};(!(l.type==="decl"||l.type==="atrule"&&!l.nodes)||l!==c.last||c.raws.semicolon)&&(l.source&&l.source.end?(r.source=this.sourcePath(l),r.original.line=l.source.end.line,r.original.column=l.source.end.column-1,r.generated.line=e,r.generated.column=n-2,this.map.addMapping(r)):(r.source=i,r.original.line=1,r.original.column=0,r.generated.line=e,r.generated.column=n-1,this.map.addMapping(r)))}})}isAnnotation(){return this.isInline()?!0:typeof this.mapOpts.annotation<"u"?this.mapOpts.annotation:this.previous().length?this.previous().some(e=>e.annotation):!0}isInline(){if(typeof this.mapOpts.inline<"u")return this.mapOpts.inline;let e=this.mapOpts.annotation;return typeof e<"u"&&e!==!0?!1:this.previous().length?this.previous().some(n=>n.inline):!0}isMap(){return typeof this.opts.map<"u"?!!this.opts.map:this.previous().length>0}isSourcesContent(){return typeof this.mapOpts.sourcesContent<"u"?this.mapOpts.sourcesContent:this.previous().length?this.previous().some(e=>e.withContent()):!0}outputFile(){return this.opts.to?this.path(this.opts.to):this.opts.from?this.path(this.opts.from):"to.css"}path(e){if(this.mapOpts.absolute||e.charCodeAt(0)===60||/^\w+:\/\//.test(e))return e;let n=this.memoizedPaths.get(e);if(n)return n;let i=this.opts.to?Ep(this.opts.to):".";typeof this.mapOpts.annotation=="string"&&(i=Ep(K3(i,this.mapOpts.annotation)));let r=q3(i,e);return this.memoizedPaths.set(e,r),r}previous(){if(!this.previousMaps)if(this.previousMaps=[],this.root)this.root.walk(e=>{if(e.source&&e.source.input.map){let n=e.source.input.map;this.previousMaps.includes(n)||this.previousMaps.push(n)}});else{let e=new Ane(this.css,this.opts);e.map&&this.previousMaps.push(e.map)}return this.previousMaps}setSourcesContent(){let e={};if(this.root)this.root.walk(n=>{if(n.source){let i=n.source.input.from;if(i&&!e[i]){e[i]=!0;let r=this.usesFileUrls?this.toFileUrl(i):this.toUrl(this.path(i));this.map.setSourceContent(r,n.source.input.css)}}});else if(this.css){let n=this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>";this.map.setSourceContent(n,this.css)}}sourcePath(e){return this.mapOpts.from?this.toUrl(this.mapOpts.from):this.usesFileUrls?this.toFileUrl(e.source.input.from):this.toUrl(this.path(e.source.input.from))}toBase64(e){return Buffer?Buffer.from(e).toString("base64"):window.btoa(unescape(encodeURIComponent(e)))}toFileUrl(e){let n=this.memoizedFileURLs.get(e);if(n)return n;if(X3){let i=X3(e).toString();return this.memoizedFileURLs.set(e,i),i}else throw new Error("`map.absolute` option is not available in this PostCSS build")}toUrl(e){let n=this.memoizedURLs.get(e);if(n)return n;Y3==="\\"&&(e=e.replace(/\\/g,"/"));let i=encodeURI(e).replace(/[#?]/g,encodeURIComponent);return this.memoizedURLs.set(e,i),i}};let Rne=pp,Tb=class extends Rne{constructor(e){super(e),this.type="comment"}};var Tp=Tb;Tb.default=Tb;let{isClean:Z3,my:J3}=id,eD=mp,tD=Tp,Lne=pp,nD,Sb,xb,iD;function rD(t){return t.map(e=>(e.nodes&&(e.nodes=rD(e.nodes)),delete e.source,e))}function sD(t){if(t[Z3]=!1,t.proxyOf.nodes)for(let e of t.proxyOf.nodes)sD(e)}let fs=class m8 extends Lne{append(...e){for(let n of e){let i=this.normalize(n,this.last);for(let r of i)this.proxyOf.nodes.push(r)}return this.markDirty(),this}cleanRaws(e){if(super.cleanRaws(e),this.nodes)for(let n of this.nodes)n.cleanRaws(e)}each(e){if(!this.proxyOf.nodes)return;let n=this.getIterator(),i,r;for(;this.indexes[n]<this.proxyOf.nodes.length&&(i=this.indexes[n],r=e(this.proxyOf.nodes[i],i),r!==!1);)this.indexes[n]+=1;return delete this.indexes[n],r}every(e){return this.nodes.every(e)}getIterator(){this.lastEach||(this.lastEach=0),this.indexes||(this.indexes={}),this.lastEach+=1;let e=this.lastEach;return this.indexes[e]=0,e}getProxyProcessor(){return{get(e,n){return n==="proxyOf"?e:e[n]?n==="each"||typeof n=="string"&&n.startsWith("walk")?(...i)=>e[n](...i.map(r=>typeof r=="function"?(s,o)=>r(s.toProxy(),o):r)):n==="every"||n==="some"?i=>e[n]((r,...s)=>i(r.toProxy(),...s)):n==="root"?()=>e.root().toProxy():n==="nodes"?e.nodes.map(i=>i.toProxy()):n==="first"||n==="last"?e[n].toProxy():e[n]:e[n]},set(e,n,i){return e[n]===i||(e[n]=i,(n==="name"||n==="params"||n==="selector")&&e.markDirty()),!0}}}index(e){return typeof e=="number"?e:(e.proxyOf&&(e=e.proxyOf),this.proxyOf.nodes.indexOf(e))}insertAfter(e,n){let i=this.index(e),r=this.normalize(n,this.proxyOf.nodes[i]).reverse();i=this.index(e);for(let o of r)this.proxyOf.nodes.splice(i+1,0,o);let s;for(let o in this.indexes)s=this.indexes[o],i<s&&(this.indexes[o]=s+r.length);return this.markDirty(),this}insertBefore(e,n){let i=this.index(e),r=i===0?"prepend":!1,s=this.normalize(n,this.proxyOf.nodes[i],r).reverse();i=this.index(e);for(let a of s)this.proxyOf.nodes.splice(i,0,a);let o;for(let a in this.indexes)o=this.indexes[a],i<=o&&(this.indexes[a]=o+s.length);return this.markDirty(),this}normalize(e,n){if(typeof e=="string")e=rD(nD(e).nodes);else if(Array.isArray(e)){e=e.slice(0);for(let r of e)r.parent&&r.parent.removeChild(r,"ignore")}else if(e.type==="root"&&this.type!=="document"){e=e.nodes.slice(0);for(let r of e)r.parent&&r.parent.removeChild(r,"ignore")}else if(e.type)e=[e];else if(e.prop){if(typeof e.value>"u")throw new Error("Value field is missed in node creation");typeof e.value!="string"&&(e.value=String(e.value)),e=[new eD(e)]}else if(e.selector)e=[new Sb(e)];else if(e.name)e=[new xb(e)];else if(e.text)e=[new tD(e)];else throw new Error("Unknown node type in node creation");return e.map(r=>(r[J3]||m8.rebuild(r),r=r.proxyOf,r.parent&&r.parent.removeChild(r),r[Z3]&&sD(r),typeof r.raws.before>"u"&&n&&typeof n.raws.before<"u"&&(r.raws.before=n.raws.before.replace(/\S/g,"")),r.parent=this.proxyOf,r))}prepend(...e){e=e.reverse();for(let n of e){let i=this.normalize(n,this.first,"prepend").reverse();for(let r of i)this.proxyOf.nodes.unshift(r);for(let r in this.indexes)this.indexes[r]=this.indexes[r]+i.length}return this.markDirty(),this}push(e){return e.parent=this,this.proxyOf.nodes.push(e),this}removeAll(){for(let e of this.proxyOf.nodes)e.parent=void 0;return this.proxyOf.nodes=[],this.markDirty(),this}removeChild(e){e=this.index(e),this.proxyOf.nodes[e].parent=void 0,this.proxyOf.nodes.splice(e,1);let n;for(let i in this.indexes)n=this.indexes[i],n>=e&&(this.indexes[i]=n-1);return this.markDirty(),this}replaceValues(e,n,i){return i||(i=n,n={}),this.walkDecls(r=>{n.props&&!n.props.includes(r.prop)||n.fast&&!r.value.includes(n.fast)||(r.value=r.value.replace(e,i))}),this.markDirty(),this}some(e){return this.nodes.some(e)}walk(e){return this.each((n,i)=>{let r;try{r=e(n,i)}catch(s){throw n.addToError(s)}return r!==!1&&n.walk&&(r=n.walk(e)),r})}walkAtRules(e,n){return n?e instanceof RegExp?this.walk((i,r)=>{if(i.type==="atrule"&&e.test(i.name))return n(i,r)}):this.walk((i,r)=>{if(i.type==="atrule"&&i.name===e)return n(i,r)}):(n=e,this.walk((i,r)=>{if(i.type==="atrule")return n(i,r)}))}walkComments(e){return this.walk((n,i)=>{if(n.type==="comment")return e(n,i)})}walkDecls(e,n){return n?e instanceof RegExp?this.walk((i,r)=>{if(i.type==="decl"&&e.test(i.prop))return n(i,r)}):this.walk((i,r)=>{if(i.type==="decl"&&i.prop===e)return n(i,r)}):(n=e,this.walk((i,r)=>{if(i.type==="decl")return n(i,r)}))}walkRules(e,n){return n?e instanceof RegExp?this.walk((i,r)=>{if(i.type==="rule"&&e.test(i.selector))return n(i,r)}):this.walk((i,r)=>{if(i.type==="rule"&&i.selector===e)return n(i,r)}):(n=e,this.walk((i,r)=>{if(i.type==="rule")return n(i,r)}))}get first(){if(this.proxyOf.nodes)return this.proxyOf.nodes[0]}get last(){if(this.proxyOf.nodes)return this.proxyOf.nodes[this.proxyOf.nodes.length-1]}};fs.registerParse=t=>{nD=t},fs.registerRule=t=>{Sb=t},fs.registerAtRule=t=>{xb=t},fs.registerRoot=t=>{iD=t};var la=fs;fs.default=fs,fs.rebuild=t=>{t.type==="atrule"?Object.setPrototypeOf(t,xb.prototype):t.type==="rule"?Object.setPrototypeOf(t,Sb.prototype):t.type==="decl"?Object.setPrototypeOf(t,eD.prototype):t.type==="comment"?Object.setPrototypeOf(t,tD.prototype):t.type==="root"&&Object.setPrototypeOf(t,iD.prototype),t[J3]=!0,t.nodes&&t.nodes.forEach(e=>{fs.rebuild(e)})};let Pne=la,oD,aD,rd=class extends Pne{constructor(e){super({type:"document",...e}),this.nodes||(this.nodes=[])}toResult(e={}){return new oD(new aD,this,e).stringify()}};rd.registerLazyResult=t=>{oD=t},rd.registerProcessor=t=>{aD=t};var wb=rd;rd.default=rd;let _b=class{constructor(e,n={}){if(this.type="warning",this.text=e,n.node&&n.node.source){let i=n.node.rangeBy(n);this.line=i.start.line,this.column=i.start.column,this.endLine=i.end.line,this.endColumn=i.end.column}for(let i in n)this[i]=n[i]}toString(){return this.node?this.node.error(this.text,{index:this.index,plugin:this.plugin,word:this.word}).message:this.plugin?this.plugin+": "+this.text:this.text}};var lD=_b;_b.default=_b;let kne=lD,Ab=class{constructor(e,n,i){this.processor=e,this.messages=[],this.root=n,this.opts=i,this.css=void 0,this.map=void 0}toString(){return this.css}warn(e,n={}){n.plugin||this.lastPlugin&&this.lastPlugin.postcssPlugin&&(n.plugin=this.lastPlugin.postcssPlugin);let i=new kne(e,n);return this.messages.push(i),i}warnings(){return this.messages.filter(e=>e.type==="warning")}get content(){return this.css}};var Cb=Ab;Ab.default=Ab;const Ib=39,uD=34,Sp=92,cD=47,xp=10,sd=32,wp=12,_p=9,Ap=13,Dne=91,One=93,Nne=40,Mne=41,Fne=123,Bne=125,Une=59,Hne=42,$ne=58,zne=64,Cp=/[\t\n\f\r "#'()/;[\\\]{}]/g,Ip=/[\t\n\f\r !"#'():;@[\\\]{}]|\/(?=\*)/g,Vne=/.[\r\n"'(/\\]/,dD=/[\da-f]/i;var Gne=function(e,n={}){let i=e.css.valueOf(),r=n.ignoreErrors,s,o,a,l,u,c,d,f,h,p,m=i.length,y=0,g=[],v=[];function b(){return y}function T(P){throw e.error("Unclosed "+P,y)}function S(){return v.length===0&&y>=m}function _(P){if(v.length)return v.pop();if(y>=m)return;let O=P?P.ignoreUnclosed:!1;switch(s=i.charCodeAt(y),s){case xp:case sd:case _p:case Ap:case wp:{o=y;do o+=1,s=i.charCodeAt(o);while(s===sd||s===xp||s===_p||s===Ap||s===wp);p=["space",i.slice(y,o)],y=o-1;break}case Dne:case One:case Fne:case Bne:case $ne:case Une:case Mne:{let x=String.fromCharCode(s);p=[x,x,y];break}case Nne:{if(f=g.length?g.pop()[1]:"",h=i.charCodeAt(y+1),f==="url"&&h!==Ib&&h!==uD&&h!==sd&&h!==xp&&h!==_p&&h!==wp&&h!==Ap){o=y;do{if(c=!1,o=i.indexOf(")",o+1),o===-1)if(r||O){o=y;break}else T("bracket");for(d=o;i.charCodeAt(d-1)===Sp;)d-=1,c=!c}while(c);p=["brackets",i.slice(y,o+1),y,o],y=o}else o=i.indexOf(")",y+1),l=i.slice(y,o+1),o===-1||Vne.test(l)?p=["(","(",y]:(p=["brackets",l,y,o],y=o);break}case Ib:case uD:{a=s===Ib?"'":'"',o=y;do{if(c=!1,o=i.indexOf(a,o+1),o===-1)if(r||O){o=y+1;break}else T("string");for(d=o;i.charCodeAt(d-1)===Sp;)d-=1,c=!c}while(c);p=["string",i.slice(y,o+1),y,o],y=o;break}case zne:{Cp.lastIndex=y+1,Cp.test(i),Cp.lastIndex===0?o=i.length-1:o=Cp.lastIndex-2,p=["at-word",i.slice(y,o+1),y,o],y=o;break}case Sp:{for(o=y,u=!0;i.charCodeAt(o+1)===Sp;)o+=1,u=!u;if(s=i.charCodeAt(o+1),u&&s!==cD&&s!==sd&&s!==xp&&s!==_p&&s!==Ap&&s!==wp&&(o+=1,dD.test(i.charAt(o)))){for(;dD.test(i.charAt(o+1));)o+=1;i.charCodeAt(o+1)===sd&&(o+=1)}p=["word",i.slice(y,o+1),y,o],y=o;break}default:{s===cD&&i.charCodeAt(y+1)===Hne?(o=i.indexOf("*/",y+2)+1,o===0&&(r||O?o=i.length:T("comment")),p=["comment",i.slice(y,o+1),y,o],y=o):(Ip.lastIndex=y+1,Ip.test(i),Ip.lastIndex===0?o=i.length-1:o=Ip.lastIndex-2,p=["word",i.slice(y,o+1),y,o],g.push(p),y=o);break}}return y++,p}function A(P){v.push(P)}return{back:A,endOfFile:S,nextToken:_,position:b}};let fD=la,Rp=class extends fD{constructor(e){super(e),this.type="atrule"}append(...e){return this.proxyOf.nodes||(this.nodes=[]),super.append(...e)}prepend(...e){return this.proxyOf.nodes||(this.nodes=[]),super.prepend(...e)}};var Rb=Rp;Rp.default=Rp,fD.registerAtRule(Rp);let hD=la,pD,mD,Ml=class extends hD{constructor(e){super(e),this.type="root",this.nodes||(this.nodes=[])}normalize(e,n,i){let r=super.normalize(e);if(n){if(i==="prepend")this.nodes.length>1?n.raws.before=this.nodes[1].raws.before:delete n.raws.before;else if(this.first!==n)for(let s of r)s.raws.before=n.raws.before}return r}removeChild(e,n){let i=this.index(e);return!n&&i===0&&this.nodes.length>1&&(this.nodes[1].raws.before=this.nodes[i].raws.before),super.removeChild(e)}toResult(e={}){return new pD(new mD,this,e).stringify()}};Ml.registerLazyResult=t=>{pD=t},Ml.registerProcessor=t=>{mD=t};var od=Ml;Ml.default=Ml,hD.registerRoot(Ml);let ad={comma(t){return ad.split(t,[","],!0)},space(t){let e=[" ",`
`,"	"];return ad.split(t,e)},split(t,e,n){let i=[],r="",s=!1,o=0,a=!1,l="",u=!1;for(let c of t)u?u=!1:c==="\\"?u=!0:a?c===l&&(a=!1):c==='"'||c==="'"?(a=!0,l=c):c==="("?o+=1:c===")"?o>0&&(o-=1):o===0&&e.includes(c)&&(s=!0),s?(r!==""&&i.push(r.trim()),r="",s=!1):r+=c;return(n||r!=="")&&i.push(r.trim()),i}};var gD=ad;ad.default=ad;let yD=la,jne=gD,Lp=class extends yD{constructor(e){super(e),this.type="rule",this.nodes||(this.nodes=[])}get selectors(){return jne.comma(this.selector)}set selectors(e){let n=this.selector?this.selector.match(/,\s*/):null,i=n?n[0]:","+this.raw("between","beforeOpen");this.selector=e.join(i)}};var Lb=Lp;Lp.default=Lp,yD.registerRule(Lp);let Wne=mp,qne=Gne,Kne=Tp,Yne=Rb,Xne=od,vD=Lb;const bD={empty:!0,space:!0};function Qne(t){for(let e=t.length-1;e>=0;e--){let n=t[e],i=n[3]||n[2];if(i)return i}}var Zne=class{constructor(e){this.input=e,this.root=new Xne,this.current=this.root,this.spaces="",this.semicolon=!1,this.customProperty=!1,this.createTokenizer(),this.root.source={input:e,start:{column:1,line:1,offset:0}}}atrule(e){let n=new Yne;n.name=e[1].slice(1),n.name===""&&this.unnamedAtrule(n,e),this.init(n,e[2]);let i,r,s,o=!1,a=!1,l=[],u=[];for(;!this.tokenizer.endOfFile();){if(e=this.tokenizer.nextToken(),i=e[0],i==="("||i==="["?u.push(i==="("?")":"]"):i==="{"&&u.length>0?u.push("}"):i===u[u.length-1]&&u.pop(),u.length===0)if(i===";"){n.source.end=this.getPosition(e[2]),n.source.end.offset++,this.semicolon=!0;break}else if(i==="{"){a=!0;break}else if(i==="}"){if(l.length>0){for(s=l.length-1,r=l[s];r&&r[0]==="space";)r=l[--s];r&&(n.source.end=this.getPosition(r[3]||r[2]),n.source.end.offset++)}this.end(e);break}else l.push(e);else l.push(e);if(this.tokenizer.endOfFile()){o=!0;break}}n.raws.between=this.spacesAndCommentsFromEnd(l),l.length?(n.raws.afterName=this.spacesAndCommentsFromStart(l),this.raw(n,"params",l),o&&(e=l[l.length-1],n.source.end=this.getPosition(e[3]||e[2]),n.source.end.offset++,this.spaces=n.raws.between,n.raws.between="")):(n.raws.afterName="",n.params=""),a&&(n.nodes=[],this.current=n)}checkMissedSemicolon(e){let n=this.colon(e);if(n===!1)return;let i=0,r;for(let s=n-1;s>=0&&(r=e[s],!(r[0]!=="space"&&(i+=1,i===2)));s--);throw this.input.error("Missed semicolon",r[0]==="word"?r[3]+1:r[2])}colon(e){let n=0,i,r,s;for(let[o,a]of e.entries()){if(i=a,r=i[0],r==="("&&(n+=1),r===")"&&(n-=1),n===0&&r===":")if(!s)this.doubleColon(i);else{if(s[0]==="word"&&s[1]==="progid")continue;return o}s=i}return!1}comment(e){let n=new Kne;this.init(n,e[2]),n.source.end=this.getPosition(e[3]||e[2]),n.source.end.offset++;let i=e[1].slice(2,-2);if(/^\s*$/.test(i))n.text="",n.raws.left=i,n.raws.right="";else{let r=i.match(/^(\s*)([^]*\S)(\s*)$/);n.text=r[2],n.raws.left=r[1],n.raws.right=r[3]}}createTokenizer(){this.tokenizer=qne(this.input)}decl(e,n){let i=new Wne;this.init(i,e[0][2]);let r=e[e.length-1];for(r[0]===";"&&(this.semicolon=!0,e.pop()),i.source.end=this.getPosition(r[3]||r[2]||Qne(e)),i.source.end.offset++;e[0][0]!=="word";)e.length===1&&this.unknownWord(e),i.raws.before+=e.shift()[1];for(i.source.start=this.getPosition(e[0][2]),i.prop="";e.length;){let u=e[0][0];if(u===":"||u==="space"||u==="comment")break;i.prop+=e.shift()[1]}i.raws.between="";let s;for(;e.length;)if(s=e.shift(),s[0]===":"){i.raws.between+=s[1];break}else s[0]==="word"&&/\w/.test(s[1])&&this.unknownWord([s]),i.raws.between+=s[1];(i.prop[0]==="_"||i.prop[0]==="*")&&(i.raws.before+=i.prop[0],i.prop=i.prop.slice(1));let o=[],a;for(;e.length&&(a=e[0][0],!(a!=="space"&&a!=="comment"));)o.push(e.shift());this.precheckMissedSemicolon(e);for(let u=e.length-1;u>=0;u--){if(s=e[u],s[1].toLowerCase()==="!important"){i.important=!0;let c=this.stringFrom(e,u);c=this.spacesFromEnd(e)+c,c!==" !important"&&(i.raws.important=c);break}else if(s[1].toLowerCase()==="important"){let c=e.slice(0),d="";for(let f=u;f>0;f--){let h=c[f][0];if(d.trim().indexOf("!")===0&&h!=="space")break;d=c.pop()[1]+d}d.trim().indexOf("!")===0&&(i.important=!0,i.raws.important=d,e=c)}if(s[0]!=="space"&&s[0]!=="comment")break}e.some(u=>u[0]!=="space"&&u[0]!=="comment")&&(i.raws.between+=o.map(u=>u[1]).join(""),o=[]),this.raw(i,"value",o.concat(e),n),i.value.includes(":")&&!n&&this.checkMissedSemicolon(e)}doubleColon(e){throw this.input.error("Double colon",{offset:e[2]},{offset:e[2]+e[1].length})}emptyRule(e){let n=new vD;this.init(n,e[2]),n.selector="",n.raws.between="",this.current=n}end(e){this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.semicolon=!1,this.current.raws.after=(this.current.raws.after||"")+this.spaces,this.spaces="",this.current.parent?(this.current.source.end=this.getPosition(e[2]),this.current.source.end.offset++,this.current=this.current.parent):this.unexpectedClose(e)}endFile(){this.current.parent&&this.unclosedBlock(),this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.current.raws.after=(this.current.raws.after||"")+this.spaces,this.root.source.end=this.getPosition(this.tokenizer.position())}freeSemicolon(e){if(this.spaces+=e[1],this.current.nodes){let n=this.current.nodes[this.current.nodes.length-1];n&&n.type==="rule"&&!n.raws.ownSemicolon&&(n.raws.ownSemicolon=this.spaces,this.spaces="")}}getPosition(e){let n=this.input.fromOffset(e);return{column:n.col,line:n.line,offset:e}}init(e,n){this.current.push(e),e.source={input:this.input,start:this.getPosition(n)},e.raws.before=this.spaces,this.spaces="",e.type!=="comment"&&(this.semicolon=!1)}other(e){let n=!1,i=null,r=!1,s=null,o=[],a=e[1].startsWith("--"),l=[],u=e;for(;u;){if(i=u[0],l.push(u),i==="("||i==="[")s||(s=u),o.push(i==="("?")":"]");else if(a&&r&&i==="{")s||(s=u),o.push("}");else if(o.length===0)if(i===";")if(r){this.decl(l,a);return}else break;else if(i==="{"){this.rule(l);return}else if(i==="}"){this.tokenizer.back(l.pop()),n=!0;break}else i===":"&&(r=!0);else i===o[o.length-1]&&(o.pop(),o.length===0&&(s=null));u=this.tokenizer.nextToken()}if(this.tokenizer.endOfFile()&&(n=!0),o.length>0&&this.unclosedBracket(s),n&&r){if(!a)for(;l.length&&(u=l[l.length-1][0],!(u!=="space"&&u!=="comment"));)this.tokenizer.back(l.pop());this.decl(l,a)}else this.unknownWord(l)}parse(){let e;for(;!this.tokenizer.endOfFile();)switch(e=this.tokenizer.nextToken(),e[0]){case"space":this.spaces+=e[1];break;case";":this.freeSemicolon(e);break;case"}":this.end(e);break;case"comment":this.comment(e);break;case"at-word":this.atrule(e);break;case"{":this.emptyRule(e);break;default:this.other(e);break}this.endFile()}precheckMissedSemicolon(){}raw(e,n,i,r){let s,o,a=i.length,l="",u=!0,c,d;for(let f=0;f<a;f+=1)s=i[f],o=s[0],o==="space"&&f===a-1&&!r?u=!1:o==="comment"?(d=i[f-1]?i[f-1][0]:"empty",c=i[f+1]?i[f+1][0]:"empty",!bD[d]&&!bD[c]?l.slice(-1)===","?u=!1:l+=s[1]:u=!1):l+=s[1];if(!u){let f=i.reduce((h,p)=>h+p[1],"");e.raws[n]={raw:f,value:l}}e[n]=l}rule(e){e.pop();let n=new vD;this.init(n,e[0][2]),n.raws.between=this.spacesAndCommentsFromEnd(e),this.raw(n,"selector",e),this.current=n}spacesAndCommentsFromEnd(e){let n,i="";for(;e.length&&(n=e[e.length-1][0],!(n!=="space"&&n!=="comment"));)i=e.pop()[1]+i;return i}spacesAndCommentsFromStart(e){let n,i="";for(;e.length&&(n=e[0][0],!(n!=="space"&&n!=="comment"));)i+=e.shift()[1];return i}spacesFromEnd(e){let n,i="";for(;e.length&&(n=e[e.length-1][0],n==="space");)i=e.pop()[1]+i;return i}stringFrom(e,n){let i="";for(let r=n;r<e.length;r++)i+=e[r][1];return e.splice(n,e.length-n),i}unclosedBlock(){let e=this.current.source.start;throw this.input.error("Unclosed block",e.line,e.column)}unclosedBracket(e){throw this.input.error("Unclosed bracket",{offset:e[2]},{offset:e[2]+1})}unexpectedClose(e){throw this.input.error("Unexpected }",{offset:e[2]},{offset:e[2]+1})}unknownWord(e){throw this.input.error("Unknown word",{offset:e[0][2]},{offset:e[0][2]+e[0][1].length})}unnamedAtrule(e,n){throw this.input.error("At-rule without name",{offset:n[2]},{offset:n[2]+n[1].length})}};let Jne=la,eie=Zne,tie=vp;function Pp(t,e){let n=new tie(t,e),i=new eie(n);try{i.parse()}catch(r){throw r}return i.root}var Pb=Pp;Pp.default=Pp,Jne.registerParse(Pp);let{isClean:Ar,my:nie}=id,iie=Q3,rie=fp,sie=la,oie=wb,ED=Cb,aie=Pb,lie=od;const uie={atrule:"AtRule",comment:"Comment",decl:"Declaration",document:"Document",root:"Root",rule:"Rule"},cie={AtRule:!0,AtRuleExit:!0,Comment:!0,CommentExit:!0,Declaration:!0,DeclarationExit:!0,Document:!0,DocumentExit:!0,Once:!0,OnceExit:!0,postcssPlugin:!0,prepare:!0,Root:!0,RootExit:!0,Rule:!0,RuleExit:!0},die={Once:!0,postcssPlugin:!0,prepare:!0},Fl=0;function ld(t){return typeof t=="object"&&typeof t.then=="function"}function TD(t){let e=!1,n=uie[t.type];return t.type==="decl"?e=t.prop.toLowerCase():t.type==="atrule"&&(e=t.name.toLowerCase()),e&&t.append?[n,n+"-"+e,Fl,n+"Exit",n+"Exit-"+e]:e?[n,n+"-"+e,n+"Exit",n+"Exit-"+e]:t.append?[n,Fl,n+"Exit"]:[n,n+"Exit"]}function SD(t){let e;return t.type==="document"?e=["Document",Fl,"DocumentExit"]:t.type==="root"?e=["Root",Fl,"RootExit"]:e=TD(t),{eventIndex:0,events:e,iterator:0,node:t,visitorIndex:0,visitors:[]}}function kb(t){return t[Ar]=!1,t.nodes&&t.nodes.forEach(e=>kb(e)),t}let Db={},Bl=class g8{constructor(e,n,i){this.stringified=!1,this.processed=!1;let r;if(typeof n=="object"&&n!==null&&(n.type==="root"||n.type==="document"))r=kb(n);else if(n instanceof g8||n instanceof ED)r=kb(n.root),n.map&&(typeof i.map>"u"&&(i.map={}),i.map.inline||(i.map.inline=!1),i.map.prev=n.map);else{let s=aie;i.syntax&&(s=i.syntax.parse),i.parser&&(s=i.parser),s.parse&&(s=s.parse);try{r=s(n,i)}catch(o){this.processed=!0,this.error=o}r&&!r[nie]&&sie.rebuild(r)}this.result=new ED(e,r,i),this.helpers={...Db,postcss:Db,result:this.result},this.plugins=this.processor.plugins.map(s=>typeof s=="object"&&s.prepare?{...s,...s.prepare(this.result)}:s)}async(){return this.error?Promise.reject(this.error):this.processed?Promise.resolve(this.result):(this.processing||(this.processing=this.runAsync()),this.processing)}catch(e){return this.async().catch(e)}finally(e){return this.async().then(e,e)}getAsyncError(){throw new Error("Use process(css).then(cb) to work with async plugins")}handleError(e,n){let i=this.result.lastPlugin;try{n&&n.addToError(e),this.error=e,e.name==="CssSyntaxError"&&!e.plugin?(e.plugin=i.postcssPlugin,e.setMessage()):i.postcssVersion}catch(r){console&&console.error&&console.error(r)}return e}prepareVisitors(){this.listeners={};let e=(n,i,r)=>{this.listeners[i]||(this.listeners[i]=[]),this.listeners[i].push([n,r])};for(let n of this.plugins)if(typeof n=="object")for(let i in n){if(!cie[i]&&/^[A-Z]/.test(i))throw new Error(`Unknown event ${i} in ${n.postcssPlugin}. Try to update PostCSS (${this.processor.version} now).`);if(!die[i])if(typeof n[i]=="object")for(let r in n[i])r==="*"?e(n,i,n[i][r]):e(n,i+"-"+r.toLowerCase(),n[i][r]);else typeof n[i]=="function"&&e(n,i,n[i])}this.hasListener=Object.keys(this.listeners).length>0}async runAsync(){this.plugin=0;for(let e=0;e<this.plugins.length;e++){let n=this.plugins[e],i=this.runOnRoot(n);if(ld(i))try{await i}catch(r){throw this.handleError(r)}}if(this.prepareVisitors(),this.hasListener){let e=this.result.root;for(;!e[Ar];){e[Ar]=!0;let n=[SD(e)];for(;n.length>0;){let i=this.visitTick(n);if(ld(i))try{await i}catch(r){let s=n[n.length-1].node;throw this.handleError(r,s)}}}if(this.listeners.OnceExit)for(let[n,i]of this.listeners.OnceExit){this.result.lastPlugin=n;try{if(e.type==="document"){let r=e.nodes.map(s=>i(s,this.helpers));await Promise.all(r)}else await i(e,this.helpers)}catch(r){throw this.handleError(r)}}}return this.processed=!0,this.stringify()}runOnRoot(e){this.result.lastPlugin=e;try{if(typeof e=="object"&&e.Once){if(this.result.root.type==="document"){let n=this.result.root.nodes.map(i=>e.Once(i,this.helpers));return ld(n[0])?Promise.all(n):n}return e.Once(this.result.root,this.helpers)}else if(typeof e=="function")return e(this.result.root,this.result)}catch(n){throw this.handleError(n)}}stringify(){if(this.error)throw this.error;if(this.stringified)return this.result;this.stringified=!0,this.sync();let e=this.result.opts,n=rie;e.syntax&&(n=e.syntax.stringify),e.stringifier&&(n=e.stringifier),n.stringify&&(n=n.stringify);let r=new iie(n,this.result.root,this.result.opts).generate();return this.result.css=r[0],this.result.map=r[1],this.result}sync(){if(this.error)throw this.error;if(this.processed)return this.result;if(this.processed=!0,this.processing)throw this.getAsyncError();for(let e of this.plugins){let n=this.runOnRoot(e);if(ld(n))throw this.getAsyncError()}if(this.prepareVisitors(),this.hasListener){let e=this.result.root;for(;!e[Ar];)e[Ar]=!0,this.walkSync(e);if(this.listeners.OnceExit)if(e.type==="document")for(let n of e.nodes)this.visitSync(this.listeners.OnceExit,n);else this.visitSync(this.listeners.OnceExit,e)}return this.result}then(e,n){return this.async().then(e,n)}toString(){return this.css}visitSync(e,n){for(let[i,r]of e){this.result.lastPlugin=i;let s;try{s=r(n,this.helpers)}catch(o){throw this.handleError(o,n.proxyOf)}if(n.type!=="root"&&n.type!=="document"&&!n.parent)return!0;if(ld(s))throw this.getAsyncError()}}visitTick(e){let n=e[e.length-1],{node:i,visitors:r}=n;if(i.type!=="root"&&i.type!=="document"&&!i.parent){e.pop();return}if(r.length>0&&n.visitorIndex<r.length){let[o,a]=r[n.visitorIndex];n.visitorIndex+=1,n.visitorIndex===r.length&&(n.visitors=[],n.visitorIndex=0),this.result.lastPlugin=o;try{return a(i.toProxy(),this.helpers)}catch(l){throw this.handleError(l,i)}}if(n.iterator!==0){let o=n.iterator,a;for(;a=i.nodes[i.indexes[o]];)if(i.indexes[o]+=1,!a[Ar]){a[Ar]=!0,e.push(SD(a));return}n.iterator=0,delete i.indexes[o]}let s=n.events;for(;n.eventIndex<s.length;){let o=s[n.eventIndex];if(n.eventIndex+=1,o===Fl){i.nodes&&i.nodes.length&&(i[Ar]=!0,n.iterator=i.getIterator());return}else if(this.listeners[o]){n.visitors=this.listeners[o];return}}e.pop()}walkSync(e){e[Ar]=!0;let n=TD(e);for(let i of n)if(i===Fl)e.nodes&&e.each(r=>{r[Ar]||this.walkSync(r)});else{let r=this.listeners[i];if(r&&this.visitSync(r,e.toProxy()))return}}warnings(){return this.sync().warnings()}get content(){return this.stringify().content}get css(){return this.stringify().css}get map(){return this.stringify().map}get messages(){return this.sync().messages}get opts(){return this.result.opts}get processor(){return this.result.processor}get root(){return this.sync().root}get[Symbol.toStringTag](){return"LazyResult"}};Bl.registerPostcss=t=>{Db=t};var xD=Bl;Bl.default=Bl,lie.registerLazyResult(Bl),oie.registerLazyResult(Bl);let fie=Q3,hie=fp,pie=Pb;const mie=Cb;let Ob=class{constructor(e,n,i){n=n.toString(),this.stringified=!1,this._processor=e,this._css=n,this._opts=i,this._map=void 0;let r,s=hie;this.result=new mie(this._processor,r,this._opts),this.result.css=n;let o=this;Object.defineProperty(this.result,"root",{get(){return o.root}});let a=new fie(s,r,this._opts,n);if(a.isMap()){let[l,u]=a.generate();l&&(this.result.css=l),u&&(this.result.map=u)}}async(){return this.error?Promise.reject(this.error):Promise.resolve(this.result)}catch(e){return this.async().catch(e)}finally(e){return this.async().then(e,e)}sync(){if(this.error)throw this.error;return this.result}then(e,n){return this.async().then(e,n)}toString(){return this._css}warnings(){return[]}get content(){return this.result.css}get css(){return this.result.css}get map(){return this.result.map}get messages(){return[]}get opts(){return this.result.opts}get processor(){return this.result.processor}get root(){if(this._root)return this._root;let e,n=pie;try{e=n(this._css,this._opts)}catch(i){this.error=i}if(this.error)throw this.error;return this._root=e,e}get[Symbol.toStringTag](){return"NoWorkResult"}};var gie=Ob;Ob.default=Ob;let yie=gie,vie=xD,bie=wb,Eie=od,ud=class{constructor(e=[]){this.version="8.4.31",this.plugins=this.normalize(e)}normalize(e){let n=[];for(let i of e)if(i.postcss===!0?i=i():i.postcss&&(i=i.postcss),typeof i=="object"&&Array.isArray(i.plugins))n=n.concat(i.plugins);else if(typeof i=="object"&&i.postcssPlugin)n.push(i);else if(typeof i=="function")n.push(i);else if(!(typeof i=="object"&&(i.parse||i.stringify)))throw new Error(i+" is not a PostCSS plugin");return n}process(e,n={}){return this.plugins.length===0&&typeof n.parser>"u"&&typeof n.stringifier>"u"&&typeof n.syntax>"u"?new yie(this,e,n):new vie(this,e,n)}use(e){return this.plugins=this.plugins.concat(this.normalize([e])),this}};var Tie=ud;ud.default=ud,Eie.registerProcessor(ud),bie.registerProcessor(ud);let Sie=mp,xie=z3,wie=Tp,_ie=Rb,Aie=vp,Cie=od,Iie=Lb;function cd(t,e){if(Array.isArray(t))return t.map(r=>cd(r));let{inputs:n,...i}=t;if(n){e=[];for(let r of n){let s={...r,__proto__:Aie.prototype};s.map&&(s.map={...s.map,__proto__:xie.prototype}),e.push(s)}}if(i.nodes&&(i.nodes=t.nodes.map(r=>cd(r,e))),i.source){let{inputId:r,...s}=i.source;i.source=s,r!=null&&(i.source.input=e[r])}if(i.type==="root")return new Cie(i);if(i.type==="decl")return new Sie(i);if(i.type==="rule")return new Iie(i);if(i.type==="comment")return new wie(i);if(i.type==="atrule")return new _ie(i);throw new Error("Unknown node type: "+t.type)}var Rie=cd;cd.default=cd;let Lie=ub,wD=mp,Pie=xD,kie=la,Nb=Tie,Die=fp,Oie=Rie,_D=wb,Nie=lD,AD=Tp,CD=Rb,Mie=Cb,Fie=vp,Bie=Pb,Uie=gD,ID=Lb,RD=od,Hie=pp;function vt(...t){return t.length===1&&Array.isArray(t[0])&&(t=t[0]),new Nb(t)}vt.plugin=function(e,n){let i=!1;function r(...o){console&&console.warn&&!i&&(i=!0,console.warn(e+`: postcss.plugin was deprecated. Migration guide:
https://evilmartians.com/chronicles/postcss-8-plugin-migration`),process.env.LANG&&process.env.LANG.startsWith("cn")&&console.warn(e+`:  postcss.plugin . :
https://www.w3ctech.com/topic/2226`));let a=n(...o);return a.postcssPlugin=e,a.postcssVersion=new Nb().version,a}let s;return Object.defineProperty(r,"postcss",{get(){return s||(s=r()),s}}),r.process=function(o,a,l){return vt([r(l)]).process(o,a)},r},vt.stringify=Die,vt.parse=Bie,vt.fromJSON=Oie,vt.list=Uie,vt.comment=t=>new AD(t),vt.atRule=t=>new CD(t),vt.decl=t=>new wD(t),vt.rule=t=>new ID(t),vt.root=t=>new RD(t),vt.document=t=>new _D(t),vt.CssSyntaxError=Lie,vt.Declaration=wD,vt.Container=kie,vt.Processor=Nb,vt.Document=_D,vt.Comment=AD,vt.Warning=Nie,vt.AtRule=CD,vt.Result=Mie,vt.Input=Fie,vt.Rule=ID,vt.Root=RD,vt.Node=Hie,Pie.registerPostcss(vt);var $ie=vt;vt.default=vt;const zie=Qk,LD=Gte,{isPlainObject:Vie}=ob,PD=sne,Gie=one,{parse:jie}=$ie,Wie=["img","audio","video","picture","svg","object","map","iframe","embed"],qie=["script","style"];function Ul(t,e){t&&Object.keys(t).forEach(function(n){e(t[n],n)})}function hs(t,e){return{}.hasOwnProperty.call(t,e)}function kD(t,e){const n=[];return Ul(t,function(i){e(i)&&n.push(i)}),n}function Kie(t){for(const e in t)if(hs(t,e))return!1;return!0}function Yie(t){return t.map(function(e){if(!e.url)throw new Error("URL missing");return e.url+(e.w?` ${e.w}w`:"")+(e.h?` ${e.h}h`:"")+(e.d?` ${e.d}x`:"")}).join(", ")}var Xie=dd;const Qie=/^[^\0\t\n\f\r /<=>]+$/;function dd(t,e,n){if(t==null)return"";typeof t=="number"&&(t=t.toString());let i="",r="";function s(U,j){const G=this;this.tag=U,this.attribs=j||{},this.tagPosition=i.length,this.text="",this.openingTagLength=0,this.mediaChildren=[],this.updateParentNodeText=function(){if(y.length){const H=y[y.length-1];H.text+=G.text}},this.updateParentNodeMediaChildren=function(){y.length&&Wie.includes(this.tag)&&y[y.length-1].mediaChildren.push(this.tag)}}e=Object.assign({},dd.defaults,e),e.parser=Object.assign({},Zie,e.parser);const o=function(U){return e.allowedTags===!1||(e.allowedTags||[]).indexOf(U)>-1};qie.forEach(function(U){o(U)&&!e.allowVulnerableTags&&console.warn(`

 Your \`allowedTags\` option includes, \`${U}\`, which is inherently
vulnerable to XSS attacks. Please remove it from \`allowedTags\`.
Or, to disable this warning, add the \`allowVulnerableTags\` option
and ensure you are accounting for this risk.

`)});const a=e.nonTextTags||["script","style","textarea","option"];let l,u;e.allowedAttributes&&(l={},u={},Ul(e.allowedAttributes,function(U,j){l[j]=[];const G=[];U.forEach(function(H){typeof H=="string"&&H.indexOf("*")>=0?G.push(LD(H).replace(/\\\*/g,".*")):l[j].push(H)}),G.length&&(u[j]=new RegExp("^("+G.join("|")+")$"))}));const c={},d={},f={};Ul(e.allowedClasses,function(U,j){if(l&&(hs(l,j)||(l[j]=[]),l[j].push("class")),c[j]=U,Array.isArray(U)){const G=[];c[j]=[],f[j]=[],U.forEach(function(H){typeof H=="string"&&H.indexOf("*")>=0?G.push(LD(H).replace(/\\\*/g,".*")):H instanceof RegExp?f[j].push(H):c[j].push(H)}),G.length&&(d[j]=new RegExp("^("+G.join("|")+")$"))}});const h={};let p;Ul(e.transformTags,function(U,j){let G;typeof U=="function"?G=U:typeof U=="string"&&(G=dd.simpleTransform(U)),j==="*"?p=G:h[j]=G});let m,y,g,v,b,T,S=!1;A();const _=new zie.Parser({onopentag:function(U,j){if(e.onOpenTag&&e.onOpenTag(U,j),e.enforceHtmlBoundary&&U==="html"&&A(),b){T++;return}const G=new s(U,j);y.push(G);let H=!1;const Y=!!G.text;let D;if(hs(h,U)&&(D=h[U](U,j),G.attribs=j=D.attribs,D.text!==void 0&&(G.innerText=D.text),U!==D.tagName&&(G.name=U=D.tagName,v[m]=D.tagName)),p&&(D=p(U,j),G.attribs=j=D.attribs,U!==D.tagName&&(G.name=U=D.tagName,v[m]=D.tagName)),(!o(U)||e.disallowedTagsMode==="recursiveEscape"&&!Kie(g)||e.nestingLimit!=null&&m>=e.nestingLimit)&&(H=!0,g[m]=!0,(e.disallowedTagsMode==="discard"||e.disallowedTagsMode==="completelyDiscard")&&a.indexOf(U)!==-1&&(b=!0,T=1)),m++,H){if(e.disallowedTagsMode==="discard"||e.disallowedTagsMode==="completelyDiscard"){if(G.innerText&&!Y){const N=P(G.innerText);e.textFilter?i+=e.textFilter(N,U):i+=N,S=!0}return}r=i,i=""}i+="<"+U,U==="script"&&(e.allowedScriptHostnames||e.allowedScriptDomains)&&(G.innerText=""),H&&(e.disallowedTagsMode==="escape"||e.disallowedTagsMode==="recursiveEscape")&&e.preserveEscapedAttributes?Ul(j,function(N,le){i+=" "+le+'="'+P(N||"",!0)+'"'}):(!l||hs(l,U)||l["*"])&&Ul(j,function(N,le){if(!Qie.test(le)){delete G.attribs[le];return}if(N===""&&!e.allowedEmptyAttributes.includes(le)&&(e.nonBooleanAttributes.includes(le)||e.nonBooleanAttributes.includes("*"))){delete G.attribs[le];return}let we=!1;if(!l||hs(l,U)&&l[U].indexOf(le)!==-1||l["*"]&&l["*"].indexOf(le)!==-1||hs(u,U)&&u[U].test(le)||u["*"]&&u["*"].test(le))we=!0;else if(l&&l[U]){for(const ce of l[U])if(Vie(ce)&&ce.name&&ce.name===le){we=!0;let re="";if(ce.multiple===!0){const Ae=N.split(" ");for(const $e of Ae)ce.values.indexOf($e)!==-1&&(re===""?re=$e:re+=" "+$e)}else ce.values.indexOf(N)>=0&&(re=N);N=re}}if(we){if(e.allowedSchemesAppliedToAttributes.indexOf(le)!==-1&&O(U,N)){delete G.attribs[le];return}if(U==="script"&&le==="src"){let ce=!0;try{const re=x(N);if(e.allowedScriptHostnames||e.allowedScriptDomains){const Ae=(e.allowedScriptHostnames||[]).find(function(Ie){return Ie===re.url.hostname}),$e=(e.allowedScriptDomains||[]).find(function(Ie){return re.url.hostname===Ie||re.url.hostname.endsWith(`.${Ie}`)});ce=Ae||$e}}catch{ce=!1}if(!ce){delete G.attribs[le];return}}if(U==="iframe"&&le==="src"){let ce=!0;try{const re=x(N);if(re.isRelativeUrl)ce=hs(e,"allowIframeRelativeUrls")?e.allowIframeRelativeUrls:!e.allowedIframeHostnames&&!e.allowedIframeDomains;else if(e.allowedIframeHostnames||e.allowedIframeDomains){const Ae=(e.allowedIframeHostnames||[]).find(function(Ie){return Ie===re.url.hostname}),$e=(e.allowedIframeDomains||[]).find(function(Ie){return re.url.hostname===Ie||re.url.hostname.endsWith(`.${Ie}`)});ce=Ae||$e}}catch{ce=!1}if(!ce){delete G.attribs[le];return}}if(le==="srcset")try{let ce=Gie(N);if(ce.forEach(function(re){O("srcset",re.url)&&(re.evil=!0)}),ce=kD(ce,function(re){return!re.evil}),ce.length)N=Yie(kD(ce,function(re){return!re.evil})),G.attribs[le]=N;else{delete G.attribs[le];return}}catch{delete G.attribs[le];return}if(le==="class"){const ce=c[U],re=c["*"],Ae=d[U],$e=f[U],Ie=f["*"],Me=d["*"],Ne=[Ae,Me].concat($e,Ie).filter(function(at){return at});if(ce&&re?N=K(N,PD(ce,re),Ne):N=K(N,ce||re,Ne),!N.length){delete G.attribs[le];return}}if(le==="style"){if(e.parseStyleAttributes)try{const ce=jie(U+" {"+N+"}",{map:!1}),re=L(ce,e.allowedStyles);if(N=M(re),N.length===0){delete G.attribs[le];return}}catch{typeof window<"u"&&console.warn('Failed to parse "'+U+" {"+N+`}", If you're running this in a browser, we recommend to disable style parsing: options.parseStyleAttributes: false, since this only works in a node environment due to a postcss dependency, More info: https://github.com/apostrophecms/sanitize-html/issues/547`),delete G.attribs[le];return}else if(e.allowedStyles)throw new Error("allowedStyles option cannot be used together with parseStyleAttributes: false.")}i+=" "+le,N&&N.length?i+='="'+P(N,!0)+'"':e.allowedEmptyAttributes.includes(le)&&(i+='=""')}else delete G.attribs[le]}),e.selfClosing.indexOf(U)!==-1?i+=" />":(i+=">",G.innerText&&!Y&&!e.textFilter&&(i+=P(G.innerText),S=!0)),H&&(i=r+P(i),r=""),G.openingTagLength=i.length-G.tagPosition},ontext:function(U){if(b)return;const j=y[y.length-1];let G;if(j&&(G=j.tag,U=j.innerText!==void 0?j.innerText:U),e.disallowedTagsMode==="completelyDiscard"&&!o(G))U="";else if((e.disallowedTagsMode==="discard"||e.disallowedTagsMode==="completelyDiscard")&&(G==="script"||G==="style"))i+=U;else if(!S){const H=P(U,!1);e.textFilter?i+=e.textFilter(H,G):i+=H}if(y.length){const H=y[y.length-1];H.text+=U}},onclosetag:function(U,j){if(e.onCloseTag&&e.onCloseTag(U,j),b)if(T--,!T)b=!1;else return;const G=y.pop();if(!G)return;if(G.tag!==U){y.push(G);return}b=e.enforceHtmlBoundary?U==="html":!1,m--;const H=g[m];if(H){if(delete g[m],e.disallowedTagsMode==="discard"||e.disallowedTagsMode==="completelyDiscard"){G.updateParentNodeText();return}r=i,i=""}if(v[m]&&(U=v[m],delete v[m]),e.exclusiveFilter){const Y=e.exclusiveFilter(G);if(Y==="excludeTag"){H&&(i=r,r=""),i=i.substring(0,G.tagPosition)+i.substring(G.tagPosition+G.openingTagLength);return}else if(Y){i=i.substring(0,G.tagPosition);return}}if(G.updateParentNodeMediaChildren(),G.updateParentNodeText(),e.selfClosing.indexOf(U)!==-1||j&&!o(U)&&["escape","recursiveEscape"].indexOf(e.disallowedTagsMode)>=0){H&&(i=r,r="");return}i+="</"+U+">",H&&(i=r+P(i),r=""),S=!1}},e.parser);return _.write(t),_.end(),i;function A(){i="",m=0,y=[],g={},v={},b=!1,T=0}function P(U,j){return typeof U!="string"&&(U=U+""),e.parser.decodeEntities&&(U=U.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),j&&(U=U.replace(/"/g,"&quot;"))),U=U.replace(/&(?![a-zA-Z0-9#]{1,20};)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),j&&(U=U.replace(/"/g,"&quot;")),U}function O(U,j){for(j=j.replace(/[\x00-\x20]+/g,"");;){const Y=j.indexOf("<!--");if(Y===-1)break;const D=j.indexOf("-->",Y+4);if(D===-1)break;j=j.substring(0,Y)+j.substring(D+3)}const G=j.match(/^([a-zA-Z][a-zA-Z0-9.\-+]*):/);if(!G)return j.match(/^[/\\]{2}/)?!e.allowProtocolRelative:!1;const H=G[1].toLowerCase();return hs(e.allowedSchemesByTag,U)?e.allowedSchemesByTag[U].indexOf(H)===-1:!e.allowedSchemes||e.allowedSchemes.indexOf(H)===-1}function x(U){if(U=U.replace(/^(\w+:)?\s*[\\/]\s*[\\/]/,"$1//"),U.startsWith("relative:"))throw new Error("relative: exploit attempt");let j="relative://relative-site";for(let Y=0;Y<100;Y++)j+=`/${Y}`;const G=new URL(U,j);return{isRelativeUrl:G&&G.hostname==="relative-site"&&G.protocol==="relative:",url:G}}function L(U,j){if(!j)return U;const G=U.nodes[0];let H;return j[G.selector]&&j["*"]?H=PD(j[G.selector],j["*"]):H=j[G.selector]||j["*"],H&&(U.nodes[0].nodes=G.nodes.reduce(V(H),[])),U}function M(U){return U.nodes[0].nodes.reduce(function(j,G){return j.push(`${G.prop}:${G.value}${G.important?" !important":""}`),j},[]).join(";")}function V(U){return function(j,G){return hs(U,G.prop)&&U[G.prop].some(function(Y){return Y.test(G.value)})&&j.push(G),j}}function K(U,j,G){return j?(U=U.split(/\s+/),U.filter(function(H){return j.indexOf(H)!==-1||G.some(function(Y){return Y.test(H)})}).join(" ")):U}}const Zie={decodeEntities:!0};dd.defaults={allowedTags:["address","article","aside","footer","header","h1","h2","h3","h4","h5","h6","hgroup","main","nav","section","blockquote","dd","div","dl","dt","figcaption","figure","hr","li","menu","ol","p","pre","ul","a","abbr","b","bdi","bdo","br","cite","code","data","dfn","em","i","kbd","mark","q","rb","rp","rt","rtc","ruby","s","samp","small","span","strong","sub","sup","time","u","var","wbr","caption","col","colgroup","table","tbody","td","tfoot","th","thead","tr"],nonBooleanAttributes:["abbr","accept","accept-charset","accesskey","action","allow","alt","as","autocapitalize","autocomplete","blocking","charset","cite","class","color","cols","colspan","content","contenteditable","coords","crossorigin","data","datetime","decoding","dir","dirname","download","draggable","enctype","enterkeyhint","fetchpriority","for","form","formaction","formenctype","formmethod","formtarget","headers","height","hidden","high","href","hreflang","http-equiv","id","imagesizes","imagesrcset","inputmode","integrity","is","itemid","itemprop","itemref","itemtype","kind","label","lang","list","loading","low","max","maxlength","media","method","min","minlength","name","nonce","optimum","pattern","ping","placeholder","popover","popovertarget","popovertargetaction","poster","preload","referrerpolicy","rel","rows","rowspan","sandbox","scope","shape","size","sizes","slot","span","spellcheck","src","srcdoc","srclang","srcset","start","step","style","tabindex","target","title","translate","type","usemap","value","width","wrap","onauxclick","onafterprint","onbeforematch","onbeforeprint","onbeforeunload","onbeforetoggle","onblur","oncancel","oncanplay","oncanplaythrough","onchange","onclick","onclose","oncontextlost","oncontextmenu","oncontextrestored","oncopy","oncuechange","oncut","ondblclick","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","ondurationchange","onemptied","onended","onerror","onfocus","onformdata","onhashchange","oninput","oninvalid","onkeydown","onkeypress","onkeyup","onlanguagechange","onload","onloadeddata","onloadedmetadata","onloadstart","onmessage","onmessageerror","onmousedown","onmouseenter","onmouseleave","onmousemove","onmouseout","onmouseover","onmouseup","onoffline","ononline","onpagehide","onpageshow","onpaste","onpause","onplay","onplaying","onpopstate","onprogress","onratechange","onreset","onresize","onrejectionhandled","onscroll","onscrollend","onsecuritypolicyviolation","onseeked","onseeking","onselect","onslotchange","onstalled","onstorage","onsubmit","onsuspend","ontimeupdate","ontoggle","onunhandledrejection","onunload","onvolumechange","onwaiting","onwheel"],disallowedTagsMode:"discard",allowedAttributes:{a:["href","name","target"],img:["src","srcset","alt","title","width","height","loading"]},allowedEmptyAttributes:["alt"],selfClosing:["img","br","hr","area","base","basefont","input","link","meta"],allowedSchemes:["http","https","ftp","mailto","tel"],allowedSchemesByTag:{},allowedSchemesAppliedToAttributes:["href","src","cite"],allowProtocolRelative:!0,enforceHtmlBoundary:!1,parseStyleAttributes:!0,preserveEscapedAttributes:!1},dd.simpleTransform=function(t,e,n){return n=n===void 0?!0:n,e=e||{},function(i,r){let s;if(n)for(s in e)r[s]=e[s];else r=e;return{tagName:t,attribs:r}}};const Jie=Md(Xie);function ere(t){return{__html:tre(t)}}function Cr(t,e){const n=Object.keys(t).filter(r=>e.includes(r)?null:r),i=new Object;return n.forEach(r=>{i[r]=t[r]}),i}function tre(t){return Jie(t,{allowedAttributes:{a:["href"],img:["alt","src","height","width"]},allowedSchemes:["http","https","mailto"],allowedTags:["a","b","br","i","img","p","small","span","sub","sup"]})}const nre=xe("span",{}),ps=t=>{const{as:e,label:n}=t,r=Cr(t,["as","label"]);return k(nre,{as:e,...r},ui(n,r.lang))},Ce=Number.isFinite||function(t){return typeof t=="number"&&isFinite(t)},ire=Number.isSafeInteger||function(t){return typeof t=="number"&&Math.abs(t)<=rre},rre=Number.MAX_SAFE_INTEGER||9007199254740991;let He=function(t){return t.NETWORK_ERROR="networkError",t.MEDIA_ERROR="mediaError",t.KEY_SYSTEM_ERROR="keySystemError",t.MUX_ERROR="muxError",t.OTHER_ERROR="otherError",t}({}),Q=function(t){return t.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",t.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",t.KEY_SYSTEM_NO_SESSION="keySystemNoSession",t.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",t.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",t.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",t.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",t.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",t.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",t.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",t.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",t.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",t.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",t.MANIFEST_LOAD_ERROR="manifestLoadError",t.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",t.MANIFEST_PARSING_ERROR="manifestParsingError",t.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",t.LEVEL_EMPTY_ERROR="levelEmptyError",t.LEVEL_LOAD_ERROR="levelLoadError",t.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",t.LEVEL_PARSING_ERROR="levelParsingError",t.LEVEL_SWITCH_ERROR="levelSwitchError",t.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",t.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",t.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",t.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",t.FRAG_LOAD_ERROR="fragLoadError",t.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",t.FRAG_DECRYPT_ERROR="fragDecryptError",t.FRAG_PARSING_ERROR="fragParsingError",t.FRAG_GAP="fragGap",t.REMUX_ALLOC_ERROR="remuxAllocError",t.KEY_LOAD_ERROR="keyLoadError",t.KEY_LOAD_TIMEOUT="keyLoadTimeOut",t.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",t.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",t.BUFFER_APPEND_ERROR="bufferAppendError",t.BUFFER_APPENDING_ERROR="bufferAppendingError",t.BUFFER_STALLED_ERROR="bufferStalledError",t.BUFFER_FULL_ERROR="bufferFullError",t.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",t.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",t.ASSET_LIST_LOAD_ERROR="assetListLoadError",t.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",t.ASSET_LIST_PARSING_ERROR="assetListParsingError",t.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",t.INTERNAL_EXCEPTION="internalException",t.INTERNAL_ABORTED="aborted",t.ATTACH_MEDIA_ERROR="attachMediaError",t.UNKNOWN="unknown",t}({}),C=function(t){return t.MEDIA_ATTACHING="hlsMediaAttaching",t.MEDIA_ATTACHED="hlsMediaAttached",t.MEDIA_DETACHING="hlsMediaDetaching",t.MEDIA_DETACHED="hlsMediaDetached",t.MEDIA_ENDED="hlsMediaEnded",t.STALL_RESOLVED="hlsStallResolved",t.BUFFER_RESET="hlsBufferReset",t.BUFFER_CODECS="hlsBufferCodecs",t.BUFFER_CREATED="hlsBufferCreated",t.BUFFER_APPENDING="hlsBufferAppending",t.BUFFER_APPENDED="hlsBufferAppended",t.BUFFER_EOS="hlsBufferEos",t.BUFFERED_TO_END="hlsBufferedToEnd",t.BUFFER_FLUSHING="hlsBufferFlushing",t.BUFFER_FLUSHED="hlsBufferFlushed",t.MANIFEST_LOADING="hlsManifestLoading",t.MANIFEST_LOADED="hlsManifestLoaded",t.MANIFEST_PARSED="hlsManifestParsed",t.LEVEL_SWITCHING="hlsLevelSwitching",t.LEVEL_SWITCHED="hlsLevelSwitched",t.LEVEL_LOADING="hlsLevelLoading",t.LEVEL_LOADED="hlsLevelLoaded",t.LEVEL_UPDATED="hlsLevelUpdated",t.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",t.LEVELS_UPDATED="hlsLevelsUpdated",t.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",t.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",t.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",t.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",t.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",t.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",t.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",t.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",t.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",t.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",t.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",t.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",t.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",t.CUES_PARSED="hlsCuesParsed",t.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",t.INIT_PTS_FOUND="hlsInitPtsFound",t.FRAG_LOADING="hlsFragLoading",t.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",t.FRAG_LOADED="hlsFragLoaded",t.FRAG_DECRYPTED="hlsFragDecrypted",t.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",t.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",t.FRAG_PARSING_METADATA="hlsFragParsingMetadata",t.FRAG_PARSED="hlsFragParsed",t.FRAG_BUFFERED="hlsFragBuffered",t.FRAG_CHANGED="hlsFragChanged",t.FPS_DROP="hlsFpsDrop",t.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",t.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",t.ERROR="hlsError",t.DESTROYING="hlsDestroying",t.KEY_LOADING="hlsKeyLoading",t.KEY_LOADED="hlsKeyLoaded",t.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",t.BACK_BUFFER_REACHED="hlsBackBufferReached",t.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",t.ASSET_LIST_LOADING="hlsAssetListLoading",t.ASSET_LIST_LOADED="hlsAssetListLoaded",t.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",t.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",t.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",t.INTERSTITIAL_STARTED="hlsInterstitialStarted",t.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",t.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",t.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",t.INTERSTITIAL_ENDED="hlsInterstitialEnded",t.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",t.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",t.EVENT_CUE_ENTER="hlsEventCueEnter",t}({});var dt={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Pe={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Hl{constructor(e,n=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=n,this.totalWeight_=i}sample(e,n){const i=Math.pow(this.alpha_,e);this.estimate_=n*(1-i)+i*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class sre{constructor(e,n,i,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Hl(e),this.fast_=new Hl(n),this.defaultTTFB_=r,this.ttfb_=new Hl(e)}update(e,n){const{slow_:i,fast_:r,ttfb_:s}=this;i.halfLife!==e&&(this.slow_=new Hl(e,i.getEstimate(),i.getTotalWeight())),r.halfLife!==n&&(this.fast_=new Hl(n,r.getEstimate(),r.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new Hl(e,s.getEstimate(),s.getTotalWeight()))}sample(e,n){e=Math.max(e,this.minDelayMs_);const i=8*n,r=e/1e3,s=i/r;this.fast_.sample(r,s),this.slow_.sample(r,s)}sampleTTFB(e){const n=e/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(n,2)/2);this.ttfb_.sample(i,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function ore(t,e,n){return(e=lre(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function xt(){return xt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)({}).hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},xt.apply(null,arguments)}function DD(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function bt(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?DD(Object(n),!0).forEach(function(i){ore(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):DD(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function are(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function lre(t){var e=are(t,"string");return typeof e=="symbol"?e:e+""}class Hi{constructor(e,n){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const i=`[${e}]:`;this.trace=ao,this.debug=n.debug.bind(null,i),this.log=n.log.bind(null,i),this.warn=n.warn.bind(null,i),this.info=n.info.bind(null,i),this.error=n.error.bind(null,i)}}const ao=function(){},ure={trace:ao,debug:ao,log:ao,warn:ao,info:ao,error:ao};function Mb(){return xt({},ure)}function cre(t,e){const n=self.console[t];return n?n.bind(self.console,`${e?"["+e+"] ":""}[${t}] >`):ao}function OD(t,e,n){return e[t]?e[t].bind(e):cre(t,n)}const Fb=Mb();function dre(t,e,n){const i=Mb();if(typeof console=="object"&&t===!0||typeof t=="object"){const r=["debug","log","info","warn","error"];r.forEach(s=>{i[s]=OD(s,t,n)});try{i.log(`Debug logs enabled for "${e}" in hls.js version 1.6.13`)}catch{return Mb()}r.forEach(s=>{Fb[s]=OD(s,t)})}else xt(Fb,i);return i}const Et=Fb;function lo(t=!0){return typeof self>"u"?void 0:(t||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function fre(t){return typeof self<"u"&&t===self.ManagedMediaSource}function ND(t,e){const n=Object.keys(t),i=Object.keys(e),r=n.length,s=i.length;return!r||!s||r===s&&!n.some(o=>i.indexOf(o)===-1)}function Ei(t,e=!1){if(typeof TextDecoder<"u"){const u=new TextDecoder("utf-8").decode(t);if(e){const c=u.indexOf("\0");return c!==-1?u.substring(0,c):u}return u.replace(/\0/g,"")}const n=t.length;let i,r,s,o="",a=0;for(;a<n;){if(i=t[a++],i===0&&e)return o;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(i);break;case 12:case 13:r=t[a++],o+=String.fromCharCode((i&31)<<6|r&63);break;case 14:r=t[a++],s=t[a++],o+=String.fromCharCode((i&15)<<12|(r&63)<<6|(s&63)<<0);break}}return o}function zn(t){let e="";for(let n=0;n<t.length;n++){let i=t[n].toString(16);i.length<2&&(i="0"+i),e+=i}return e}function MD(t){return Uint8Array.from(t.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function hre(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Bb={exports:{}},FD;function pre(){return FD||(FD=1,function(t,e){(function(n){var i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(l,u,c){if(c=c||{},l=l.trim(),u=u.trim(),!u){if(!c.alwaysNormalize)return l;var d=a.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=a.normalizePath(d.path),a.buildURLFromParts(d)}var f=a.parseURL(u);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return c.alwaysNormalize?(f.path=a.normalizePath(f.path),a.buildURLFromParts(f)):u;var h=a.parseURL(l);if(!h)throw new Error("Error trying to parse base URL.");if(!h.netLoc&&h.path&&h.path[0]!=="/"){var p=r.exec(h.path);h.netLoc=p[1],h.path=p[2]}h.netLoc&&!h.path&&(h.path="/");var m={scheme:h.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(m.netLoc=h.netLoc,f.path[0]!=="/"))if(!f.path)m.path=h.path,f.params||(m.params=h.params,f.query||(m.query=h.query));else{var y=h.path,g=y.substring(0,y.lastIndexOf("/")+1)+f.path;m.path=a.normalizePath(g)}return m.path===null&&(m.path=c.alwaysNormalize?a.normalizePath(f.path):f.path),a.buildURLFromParts(m)},parseURL:function(l){var u=i.exec(l);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(s,"");l.length!==(l=l.replace(o,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};t.exports=a})()}(Bb)),Bb.exports}var Ub=pre();class Hb{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Ct={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class BD{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,gre(this,"stats")}setByteRange(e,n){const i=e.split("@",2);let r;i.length===1?r=(n==null?void 0:n.byteRangeEndOffset)||0:r=parseInt(i[1]),this._byteRange=[r,parseInt(i[0])+r]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Ct.AUDIO]:null,[Ct.VIDEO]:null,[Ct.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Hb),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Ub.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Ct.AUDIO]=null,e[Ct.VIDEO]=null,e[Ct.AUDIOVIDEO]=null}}function un(t){return t.sn!=="initSegment"}class $b extends BD{constructor(e,n){super(n),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],n=this.byteRange[1];if(Ce(e)&&Ce(n))return n-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:n}=this;if(!n||n.NONE)return null;if(n.identity)this._decryptdata||(this._decryptdata=n.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const i=Object.keys(n);if(i.length===1){const r=this._decryptdata=n[i[0]]||null;r&&(this._decryptdata=r.getDecryptData(this.sn,n))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=Ce(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var n;const i=Object.keys(this.levelkeys),r=i.length;if(r>1||r===1&&(n=this.levelkeys[i[0]])!=null&&n.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!Ce(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return un(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const n=this.levelkeys;if(n){var i;const r=n[e];r&&!((i=this._decryptdata)!=null&&i.keyId)&&(this._decryptdata=r.getDecryptData(this.sn,n))}}abortRequests(){var e,n;(e=this.loader)==null||e.abort(),(n=this.keyLoader)==null||n.abort()}setElementaryStreamInfo(e,n,i,r,s,o=!1){const{elementaryStreams:a}=this,l=a[e];if(!l){a[e]={startPTS:n,endPTS:i,startDTS:r,endDTS:s,partial:o};return}l.startPTS=Math.min(l.startPTS,n),l.endPTS=Math.max(l.endPTS,i),l.startDTS=Math.min(l.startDTS,r),l.endDTS=Math.max(l.endDTS,s)}}class mre extends BD{constructor(e,n,i,r,s){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=n,this.index=r;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function UD(t,e){const n=Object.getPrototypeOf(t);if(n){const i=Object.getOwnPropertyDescriptor(n,e);return i||UD(n,e)}}function gre(t,e){const n=UD(t,e);n&&(n.enumerable=!0,Object.defineProperty(t,e,n))}const HD=Math.pow(2,32)-1,yre=[].push,$D={video:1,audio:2,id3:3,text:4};function pn(t){return String.fromCharCode.apply(null,t)}function zD(t,e){const n=t[e]<<8|t[e+1];return n<0?65536+n:n}function Ye(t,e){const n=GD(t,e);return n<0?4294967296+n:n}function VD(t,e){let n=Ye(t,e);return n*=Math.pow(2,32),n+=Ye(t,e+4),n}function GD(t,e){return t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}function vre(t){const e=t.byteLength;for(let n=0;n<e;){const i=Ye(t,n);if(i>8&&t[n+4]===109&&t[n+5]===111&&t[n+6]===111&&t[n+7]===102)return!0;n=i>1?n+i:e}return!1}function ot(t,e){const n=[];if(!e.length)return n;const i=t.byteLength;for(let r=0;r<i;){const s=Ye(t,r),o=pn(t.subarray(r+4,r+8)),a=s>1?r+s:i;if(o===e[0])if(e.length===1)n.push(t.subarray(r+8,a));else{const l=ot(t.subarray(r+8,a),e.slice(1));l.length&&yre.apply(n,l)}r=a}return n}function bre(t){const e=[],n=t[0];let i=8;const r=Ye(t,i);i+=4;let s=0,o=0;n===0?(s=Ye(t,i),o=Ye(t,i+4),i+=8):(s=VD(t,i),o=VD(t,i+8),i+=16),i+=2;let a=t.length+o;const l=zD(t,i);i+=2;for(let u=0;u<l;u++){let c=i;const d=Ye(t,c);c+=4;const f=d&2147483647;if((d&2147483648)>>>31===1)return Et.warn("SIDX has hierarchical references (not supported)"),null;const p=Ye(t,c);c+=4,e.push({referenceSize:f,subsegmentDuration:p,info:{duration:p/r,start:a,end:a+f-1}}),a+=f,c+=4,i=c}return{earliestPresentationTime:s,timescale:r,version:n,referencesCount:l,references:e}}function jD(t){const e=[],n=ot(t,["moov","trak"]);for(let r=0;r<n.length;r++){const s=n[r],o=ot(s,["tkhd"])[0];if(o){let a=o[0];const l=Ye(o,a===0?12:20),u=ot(s,["mdia","mdhd"])[0];if(u){a=u[0];const c=Ye(u,a===0?12:20),d=ot(s,["mdia","hdlr"])[0];if(d){const f=pn(d.subarray(8,12)),h={soun:Ct.AUDIO,vide:Ct.VIDEO}[f],p=ot(s,["mdia","minf","stbl","stsd"])[0],m=Ere(p);h?(e[l]={timescale:c,type:h,stsd:m},e[h]=bt({timescale:c,id:l},m)):e[l]={timescale:c,type:f,stsd:m}}}}}return ot(t,["moov","mvex","trex"]).forEach(r=>{const s=Ye(r,4),o=e[s];o&&(o.default={duration:Ye(r,12),flags:Ye(r,20)})}),e}function Ere(t){const e=t.subarray(8),n=e.subarray(86),i=pn(e.subarray(4,8));let r=i,s;const o=i==="enca"||i==="encv";if(o){const u=ot(e,[i])[0].subarray(i==="enca"?28:78);ot(u,["sinf"]).forEach(d=>{const f=ot(d,["schm"])[0];if(f){const h=pn(f.subarray(4,8));if(h==="cbcs"||h==="cenc"){const p=ot(d,["frma"])[0];p&&(r=pn(p))}}})}const a=r;switch(r){case"avc1":case"avc2":case"avc3":case"avc4":{const l=ot(n,["avcC"])[0];l&&l.length>3&&(r+="."+Dp(l[1])+Dp(l[2])+Dp(l[3]),s=kp(a==="avc1"?"dva1":"dvav",n));break}case"mp4a":{const l=ot(e,[i])[0],u=ot(l.subarray(28),["esds"])[0];if(u&&u.length>7){let c=4;if(u[c++]!==3)break;c=zb(u,c),c+=2;const d=u[c++];if(d&128&&(c+=2),d&64&&(c+=u[c++]),u[c++]!==4)break;c=zb(u,c);const f=u[c++];if(f===64)r+="."+Dp(f);else break;if(c+=12,u[c++]!==5)break;c=zb(u,c);const h=u[c++];let p=(h&248)>>3;p===31&&(p+=1+((h&7)<<3)+((u[c]&224)>>5)),r+="."+p}break}case"hvc1":case"hev1":{const l=ot(n,["hvcC"])[0];if(l&&l.length>12){const u=l[1],c=["","A","B","C"][u>>6],d=u&31,f=Ye(l,2),h=(u&32)>>5?"H":"L",p=l[12],m=l.subarray(6,12);r+="."+c+d,r+="."+Tre(f).toString(16).toUpperCase(),r+="."+h+p;let y="";for(let g=m.length;g--;){const v=m[g];(v||y)&&(y="."+v.toString(16).toUpperCase()+y)}r+=y}s=kp(a=="hev1"?"dvhe":"dvh1",n);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{r=kp(r,n)||r;break}case"vp09":{const l=ot(n,["vpcC"])[0];if(l&&l.length>6){const u=l[4],c=l[5],d=l[6]>>4&15;r+="."+Ir(u)+"."+Ir(c)+"."+Ir(d)}break}case"av01":{const l=ot(n,["av1C"])[0];if(l&&l.length>2){const u=l[1]>>>5,c=l[1]&31,d=l[2]>>>7?"H":"M",f=(l[2]&64)>>6,h=(l[2]&32)>>5,p=u===2&&f?h?12:10:f?10:8,m=(l[2]&16)>>4,y=(l[2]&8)>>3,g=(l[2]&4)>>2,v=l[2]&3;r+="."+u+"."+Ir(c)+d+"."+Ir(p)+"."+m+"."+y+g+v+"."+Ir(1)+"."+Ir(1)+"."+Ir(1)+"."+0,s=kp("dav1",n)}break}}return{codec:r,encrypted:o,supplemental:s}}function kp(t,e){const n=ot(e,["dvvC"]),i=n.length?n[0]:ot(e,["dvcC"])[0];if(i){const r=i[2]>>1&127,s=i[2]<<5&32|i[3]>>3&31;return t+"."+Ir(r)+"."+Ir(s)}}function Tre(t){let e=0;for(let n=0;n<32;n++)e|=(t>>n&1)<<31-n;return e>>>0}function zb(t,e){const n=e+5;for(;t[e++]&128&&e<n;);return e}function Dp(t){return("0"+t.toString(16).toUpperCase()).slice(-2)}function Ir(t){return(t<10?"0":"")+t}function Sre(t,e){if(!t||!e)return;const n=e.keyId;n&&e.isCommonEncryption&&WD(t,(i,r)=>{const s=i.subarray(8,24);s.some(o=>o!==0)||(Et.log(`[eme] Patching keyId in 'enc${r?"a":"v"}>sinf>>tenc' box: ${zn(s)} -> ${zn(n)}`),i.set(n,8))})}function xre(t){const e=[];return WD(t,n=>e.push(n.subarray(8,24))),e}function WD(t,e){ot(t,["moov","trak"]).forEach(i=>{const r=ot(i,["mdia","minf","stbl","stsd"])[0];if(!r)return;const s=r.subarray(8);let o=ot(s,["enca"]);const a=o.length>0;a||(o=ot(s,["encv"])),o.forEach(l=>{const u=a?l.subarray(28):l.subarray(78);ot(u,["sinf"]).forEach(d=>{const f=qD(d);f&&e(f,a)})})})}function qD(t){const e=ot(t,["schm"])[0];if(e){const n=pn(e.subarray(4,8));if(n==="cbcs"||n==="cenc"){const i=ot(t,["schi","tenc"])[0];if(i)return i}}}function wre(t,e,n){const i={},r=ot(t,["moof","traf"]);for(let s=0;s<r.length;s++){const o=r[s],a=ot(o,["tfhd"])[0],l=Ye(a,4),u=e[l];if(!u)continue;i[l]||(i[l]={start:NaN,duration:0,sampleCount:0,timescale:u.timescale,type:u.type});const c=i[l],d=ot(o,["tfdt"])[0];if(d){const b=d[0];let T=Ye(d,4);b===1&&(T===HD?n.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(T*=HD+1,T+=Ye(d,8))),Ce(T)&&(!Ce(c.start)||T<c.start)&&(c.start=T)}const f=u.default,h=Ye(a,0)|(f==null?void 0:f.flags);let p=(f==null?void 0:f.duration)||0;h&8&&(h&2?p=Ye(a,12):p=Ye(a,8));const m=ot(o,["trun"]);let y=c.start||0,g=0,v=p;for(let b=0;b<m.length;b++){const T=m[b],S=Ye(T,4),_=c.sampleCount;c.sampleCount+=S;const A=T[3]&1,P=T[3]&4,O=T[2]&1,x=T[2]&2,L=T[2]&4,M=T[2]&8;let V=8,K=S;for(A&&(V+=4),P&&S&&(!(T[V+1]&1)&&c.keyFrameIndex===void 0&&(c.keyFrameIndex=_),V+=4,O?(v=Ye(T,V),V+=4):v=p,x&&(V+=4),M&&(V+=4),y+=v,g+=v,K--);K--;)O?(v=Ye(T,V),V+=4):v=p,x&&(V+=4),L&&(T[V+1]&1||c.keyFrameIndex===void 0&&(c.keyFrameIndex=c.sampleCount-(K+1),c.keyFrameStart=y),V+=4),M&&(V+=4),y+=v,g+=v;!g&&p&&(g+=p*S)}c.duration+=g}if(!Object.keys(i).some(s=>i[s].duration)){let s=1/0,o=0;const a=ot(t,["sidx"]);for(let l=0;l<a.length;l++){const u=bre(a[l]);if(u!=null&&u.references){s=Math.min(s,u.earliestPresentationTime/u.timescale);const c=u.references.reduce((d,f)=>d+f.info.duration||0,0);o=Math.max(o,c+u.earliestPresentationTime/u.timescale)}}o&&Ce(o)&&Object.keys(i).forEach(l=>{i[l].duration||(i[l].duration=o*i[l].timescale-i[l].start)})}return i}function _re(t){const e={valid:null,remainder:null},n=ot(t,["moof"]);if(n.length<2)return e.remainder=t,e;const i=n[n.length-1];return e.valid=t.slice(0,i.byteOffset-8),e.remainder=t.slice(i.byteOffset-8),e}function $i(t,e){const n=new Uint8Array(t.length+e.length);return n.set(t),n.set(e,t.length),n}function KD(t,e){const n=[],i=e.samples,r=e.timescale,s=e.id;let o=!1;return ot(i,["moof"]).map(l=>{const u=l.byteOffset-8;ot(l,["traf"]).map(d=>{const f=ot(d,["tfdt"]).map(h=>{const p=h[0];let m=Ye(h,4);return p===1&&(m*=Math.pow(2,32),m+=Ye(h,8)),m/r})[0];return f!==void 0&&(t=f),ot(d,["tfhd"]).map(h=>{const p=Ye(h,4),m=Ye(h,0)&16777215,y=(m&1)!==0,g=(m&2)!==0,v=(m&8)!==0;let b=0;const T=(m&16)!==0;let S=0;const _=(m&32)!==0;let A=8;p===s&&(y&&(A+=8),g&&(A+=4),v&&(b=Ye(h,A),A+=4),T&&(S=Ye(h,A),A+=4),_&&(A+=4),e.type==="video"&&(o=Op(e.codec)),ot(d,["trun"]).map(P=>{const O=P[0],x=Ye(P,0)&16777215,L=(x&1)!==0;let M=0;const V=(x&4)!==0,K=(x&256)!==0;let U=0;const j=(x&512)!==0;let G=0;const H=(x&1024)!==0,Y=(x&2048)!==0;let D=0;const ee=Ye(P,4);let ne=8;L&&(M=Ye(P,ne),ne+=4),V&&(ne+=4);let N=M+u;for(let le=0;le<ee;le++){if(K?(U=Ye(P,ne),ne+=4):U=b,j?(G=Ye(P,ne),ne+=4):G=S,H&&(ne+=4),Y&&(O===0?D=Ye(P,ne):D=GD(P,ne),ne+=4),e.type===Ct.VIDEO){let we=0;for(;we<G;){const ce=Ye(i,N);if(N+=4,Are(o,i[N])){const re=i.subarray(N,N+ce);Vb(re,o?2:1,t+D/r,n)}N+=ce,we+=ce+4}}t+=U/r}}))})})}),n}function Op(t){if(!t)return!1;const e=t.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function Are(t,e){if(t){const n=e>>1&63;return n===39||n===40}else return(e&31)===6}function Vb(t,e,n,i){const r=YD(t);let s=0;s+=e;let o=0,a=0,l=0;for(;s<r.length;){o=0;do{if(s>=r.length)break;l=r[s++],o+=l}while(l===255);a=0;do{if(s>=r.length)break;l=r[s++],a+=l}while(l===255);const u=r.length-s;let c=s;if(a<u)s+=a;else if(a>u){Et.error(`Malformed SEI payload. ${a} is too small, only ${u} bytes left to parse.`);break}if(o===4){if(r[c++]===181){const f=zD(r,c);if(c+=2,f===49){const h=Ye(r,c);if(c+=4,h===1195456820){const p=r[c++];if(p===3){const m=r[c++],y=31&m,g=64&m,v=g?2+y*3:0,b=new Uint8Array(v);if(g){b[0]=m;for(let T=1;T<v;T++)b[T]=r[c++]}i.push({type:p,payloadType:o,pts:n,bytes:b})}}}}}else if(o===5&&a>16){const d=[];for(let p=0;p<16;p++){const m=r[c++].toString(16);d.push(m.length==1?"0"+m:m),(p===3||p===5||p===7||p===9)&&d.push("-")}const f=a-16,h=new Uint8Array(f);for(let p=0;p<f;p++)h[p]=r[c++];i.push({payloadType:o,pts:n,uuid:d.join(""),userData:Ei(h),userDataBytes:h})}}}function YD(t){const e=t.byteLength,n=[];let i=1;for(;i<e-2;)t[i]===0&&t[i+1]===0&&t[i+2]===3?(n.push(i+2),i+=2):i++;if(n.length===0)return t;const r=e-n.length,s=new Uint8Array(r);let o=0;for(i=0;i<r;o++,i++)o===n[0]&&(o++,n.shift()),s[i]=t[o];return s}function Cre(t){const e=t[0];let n="",i="",r=0,s=0,o=0,a=0,l=0,u=0;if(e===0){for(;pn(t.subarray(u,u+1))!=="\0";)n+=pn(t.subarray(u,u+1)),u+=1;for(n+=pn(t.subarray(u,u+1)),u+=1;pn(t.subarray(u,u+1))!=="\0";)i+=pn(t.subarray(u,u+1)),u+=1;i+=pn(t.subarray(u,u+1)),u+=1,r=Ye(t,12),s=Ye(t,16),a=Ye(t,20),l=Ye(t,24),u=28}else if(e===1){u+=4,r=Ye(t,u),u+=4;const d=Ye(t,u);u+=4;const f=Ye(t,u);for(u+=4,o=2**32*d+f,ire(o)||(o=Number.MAX_SAFE_INTEGER,Et.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),a=Ye(t,u),u+=4,l=Ye(t,u),u+=4;pn(t.subarray(u,u+1))!=="\0";)n+=pn(t.subarray(u,u+1)),u+=1;for(n+=pn(t.subarray(u,u+1)),u+=1;pn(t.subarray(u,u+1))!=="\0";)i+=pn(t.subarray(u,u+1)),u+=1;i+=pn(t.subarray(u,u+1)),u+=1}const c=t.subarray(u,t.byteLength);return{schemeIdUri:n,value:i,timeScale:r,presentationTime:o,presentationTimeDelta:s,eventDuration:a,id:l,payload:c}}function Ire(t,...e){const n=e.length;let i=8,r=n;for(;r--;)i+=e[r].byteLength;const s=new Uint8Array(i);for(s[0]=i>>24&255,s[1]=i>>16&255,s[2]=i>>8&255,s[3]=i&255,s.set(t,4),r=0,i=8;r<n;r++)s.set(e[r],i),i+=e[r].byteLength;return s}function Rre(t,e,n){if(t.byteLength!==16)throw new RangeError("Invalid system id");let i,r;i=0,r=new Uint8Array;let s;i>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;const o=new Uint8Array(4);return n.byteLength>0&&new DataView(o.buffer).setUint32(0,n.byteLength,!1),Ire([112,115,115,104],new Uint8Array([i,0,0,0]),t,s,r,o,n)}function Lre(t){const e=[];if(t instanceof ArrayBuffer){const n=t.byteLength;let i=0;for(;i+32<n;){const r=new DataView(t,i),s=Pre(r);e.push(s),i+=s.size}}return e}function Pre(t){const e=t.getUint32(0),n=t.byteOffset,i=t.byteLength;if(i<e)return{offset:n,size:i};if(t.getUint32(4)!==1886614376)return{offset:n,size:e};const s=t.getUint32(8)>>>24;if(s!==0&&s!==1)return{offset:n,size:e};const o=t.buffer,a=zn(new Uint8Array(o,n+12,16));let l=null,u=null,c=0;if(s===0)c=28;else{const f=t.getUint32(28);if(!f||i<32+f*16)return{offset:n,size:e};l=[];for(let h=0;h<f;h++)l.push(new Uint8Array(o,n+32+h*16,16));c=32+f*16}if(!c)return{offset:n,size:e};const d=t.getUint32(c);return e-32<d?{offset:n,size:e}:(u=new Uint8Array(o,n+c+4,d),{version:s,systemId:a,kids:l,data:u,offset:n,size:e})}const XD=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),$l={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Gb(t,e){const n=$l[e];return!!n&&!!n[t.slice(0,4)]}function fd(t,e,n=!0){return!t.split(",").some(i=>!jb(i,e,n))}function jb(t,e,n=!0){var i;const r=lo(n);return(i=r==null?void 0:r.isTypeSupported(hd(t,e)))!=null?i:!1}function hd(t,e){return`${e}/mp4;codecs=${t}`}function QD(t){if(t){const e=t.substring(0,4);return $l.video[e]}return 2}function Np(t){const e=XD();return t.split(",").reduce((n,i)=>{const s=e&&Op(i)?9:$l.video[i];return s?(s*2+n)/(n?3:2):($l.audio[i]+n)/(n?2:1)},0)}const Wb={};function kre(t,e=!0){if(Wb[t])return Wb[t];const n={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[t];for(let r=0;r<n.length;r++){var i;if(jb(n[r],"audio",e))return Wb[t]=n[r],n[r];if(n[r]==="mp3"&&(i=lo(e))!=null&&i.isTypeSupported("audio/mpeg"))return""}return t}const Dre=/flac|opus|mp4a\.40\.34/i;function Mp(t,e=!0){return t.replace(Dre,n=>kre(n.toLowerCase(),e))}function Ore(t,e){const n=[];if(t){const i=t.split(",");for(let r=0;r<i.length;r++)Gb(i[r],"video")||n.push(i[r])}return e&&n.push(e),n.join(",")}function Fp(t,e){if(t&&(t.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(t)!==-1)&&(ZD(t,"audio")||ZD(t,"video")))return t;if(e){const n=e.split(",");if(n.length>1){if(t){for(let i=n.length;i--;)if(n[i].substring(0,4)===t.substring(0,4))return n[i]}return n[0]}}return e||t}function ZD(t,e){return Gb(t,e)&&jb(t,e)}function Nre(t){const e=t.split(",");for(let n=0;n<e.length;n++){const i=e[n].split(".");i.length>2&&i[0]==="avc1"&&(e[n]=`avc1.${parseInt(i[1]).toString(16)}${("000"+parseInt(i[2]).toString(16)).slice(-4)}`)}return e.join(",")}function Mre(t){if(t.startsWith("av01.")){const e=t.split("."),n=["0","111","01","01","01","0"];for(let i=e.length;i>4&&i<10;i++)e[i]=n[i-4];return e.join(".")}return t}function JD(t){const e=lo(t)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function qb(t){return t.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const Fre={supported:!0,powerEfficient:!0,smooth:!0},Bre={supported:!1,smooth:!1,powerEfficient:!1},eO={supported:!0,configurations:[],decodingInfoResults:[Fre]};function tO(t,e){return{supported:!1,configurations:e,decodingInfoResults:[Bre],error:t}}function Ure(t,e,n,i,r,s){const o=t.videoCodec,a=t.audioCodec?t.audioGroups:null,l=s==null?void 0:s.audioCodec,u=s==null?void 0:s.channels,c=u?parseInt(u):l?1/0:2;let d=null;if(a!=null&&a.length)try{a.length===1&&a[0]?d=e.groups[a[0]].channels:d=a.reduce((f,h)=>{if(h){const p=e.groups[h];if(!p)throw new Error(`Audio track group ${h} not found`);Object.keys(p.channels).forEach(m=>{f[m]=(f[m]||0)+p.channels[m]})}return f},{2:0})}catch{return!0}return o!==void 0&&(o.split(",").some(f=>Op(f))||t.width>1920&&t.height>1088||t.height>1920&&t.width>1088||t.frameRate>Math.max(i,30)||t.videoRange!=="SDR"&&t.videoRange!==n||t.bitrate>Math.max(r,8e6))||!!d&&Ce(c)&&Object.keys(d).some(f=>parseInt(f)>c)}function nO(t,e,n,i={}){const r=t.videoCodec;if(!r&&!t.audioCodec||!n)return Promise.resolve(eO);const s=[],o=Hre(t),a=o.length,l=$re(t,e,a>0),u=l.length;for(let c=a||1*u||1;c--;){const d={type:"media-source"};if(a&&(d.video=o[c%a]),u){d.audio=l[c%u];const f=d.audio.bitrate;d.video&&f&&(d.video.bitrate-=f)}s.push(d)}if(r){const c=navigator.userAgent;if(r.split(",").some(d=>Op(d))&&XD())return Promise.resolve(tO(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${c})`),s))}return Promise.all(s.map(c=>{const d=Vre(c);return i[d]||(i[d]=n.decodingInfo(c))})).then(c=>({supported:!c.some(d=>!d.supported),configurations:s,decodingInfoResults:c})).catch(c=>({supported:!1,configurations:s,decodingInfoResults:[],error:c}))}function Hre(t){var e;const n=(e=t.videoCodec)==null?void 0:e.split(","),i=iO(t),r=t.width||640,s=t.height||480,o=t.frameRate||30,a=t.videoRange.toLowerCase();return n?n.map(l=>{const u={contentType:hd(Mre(l),"video"),width:r,height:s,bitrate:i,framerate:o};return a!=="sdr"&&(u.transferFunction=a),u}):[]}function $re(t,e,n){var i;const r=(i=t.audioCodec)==null?void 0:i.split(","),s=iO(t);return r&&t.audioGroups?t.audioGroups.reduce((o,a)=>{var l;const u=a?(l=e.groups[a])==null?void 0:l.tracks:null;return u?u.reduce((c,d)=>{if(d.groupId===a){const f=parseFloat(d.channels||"");r.forEach(h=>{const p={contentType:hd(h,"audio"),bitrate:n?zre(h,s):s};f&&(p.channels=""+f),c.push(p)})}return c},o):o},[]):[]}function zre(t,e){if(e<=1)return 1;let n=128e3;return t==="ec-3"?n=768e3:t==="ac-3"&&(n=64e4),Math.min(e/2,n)}function iO(t){return Math.ceil(Math.max(t.bitrate*.9,t.averageBitrate)/1e3)*1e3||1}function Vre(t){let e="";const{audio:n,video:i}=t;if(i){const r=qb(i.contentType);e+=`${r}_r${i.height}x${i.width}f${Math.ceil(i.framerate)}${i.transferFunction||"sd"}_${Math.ceil(i.bitrate/1e5)}`}if(n){const r=qb(n.contentType);e+=`${i?"_":""}${r}_c${n.channels}`}return e}const Kb=["NONE","TYPE-0","TYPE-1",null];function Gre(t){return Kb.indexOf(t)>-1}const Bp=["SDR","PQ","HLG"];function jre(t){return!!t&&Bp.indexOf(t)>-1}var Up={No:"",Yes:"YES",v2:"v2"};function rO(t){const{canSkipUntil:e,canSkipDateRanges:n,age:i}=t,r=i<e/2;return e&&r?n?Up.v2:Up.Yes:Up.No}class sO{constructor(e,n,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=n,this.skip=i}addDirectives(e){const n=new self.URL(e);return this.msn!==void 0&&n.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&n.searchParams.set("_HLS_part",this.part.toString()),this.skip&&n.searchParams.set("_HLS_skip",this.skip),n.href}}class pd{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(i=>!!i).map(i=>i.substring(0,4)).join(","),"supplemental"in e){var n;this.supplemental=e.supplemental;const i=(n=e.supplemental)==null?void 0:n.videoCodec;i&&i!==e.videoCodec&&(this.codecSet+=`,${i.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return oO(this._audioGroups,e)}hasSubtitleGroup(e){return oO(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,n){if(n){if(e==="audio"){let i=this._audioGroups;i||(i=this._audioGroups=[]),i.indexOf(n)===-1&&i.push(n)}else if(e==="text"){let i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),i.indexOf(n)===-1&&i.push(n)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function oO(t,e){return!e||!t?!1:t.indexOf(e)!==-1}function Wre(){if(typeof matchMedia=="function"){const t=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(t.media!==e.media)return t.matches===!0}return!1}function qre(t,e){let n=!1,i=[];if(t&&(n=t!=="SDR",i=[t]),e){i=e.allowedVideoRanges||Bp.slice(0);const r=i.join("")!=="SDR"&&!e.videoCodec;n=e.preferHDR!==void 0?e.preferHDR:r&&Wre(),n||(i=["SDR"])}return{preferHDR:n,allowedVideoRanges:i}}const Kre=t=>{const e=new WeakSet;return(n,i)=>{if(t&&(i=t(n,i)),typeof i=="object"&&i!==null){if(e.has(i))return;e.add(i)}return i}},It=(t,e)=>JSON.stringify(t,Kre(e));function Yre(t,e,n,i,r){const s=Object.keys(t),o=i==null?void 0:i.channels,a=i==null?void 0:i.audioCodec,l=r==null?void 0:r.videoCodec,u=o&&parseInt(o)===2;let c=!1,d=!1,f=1/0,h=1/0,p=1/0,m=1/0,y=0,g=[];const{preferHDR:v,allowedVideoRanges:b}=qre(e,r);for(let P=s.length;P--;){const O=t[s[P]];c||(c=O.channels[2]>0),f=Math.min(f,O.minHeight),h=Math.min(h,O.minFramerate),p=Math.min(p,O.minBitrate),b.filter(L=>O.videoRanges[L]>0).length>0&&(d=!0)}f=Ce(f)?f:0,h=Ce(h)?h:0;const T=Math.max(1080,f),S=Math.max(30,h);p=Ce(p)?p:n,n=Math.max(p,n),d||(e=void 0);const _=s.length>1;return{codecSet:s.reduce((P,O)=>{const x=t[O];if(O===P)return P;if(g=d?b.filter(L=>x.videoRanges[L]>0):[],_){if(x.minBitrate>n)return Rr(O,`min bitrate of ${x.minBitrate} > current estimate of ${n}`),P;if(!x.hasDefaultAudio)return Rr(O,"no renditions with default or auto-select sound found"),P;if(a&&O.indexOf(a.substring(0,4))%5!==0)return Rr(O,`audio codec preference "${a}" not found`),P;if(o&&!u){if(!x.channels[o])return Rr(O,`no renditions with ${o} channel sound found (channels options: ${Object.keys(x.channels)})`),P}else if((!a||u)&&c&&x.channels[2]===0)return Rr(O,"no renditions with stereo sound found"),P;if(x.minHeight>T)return Rr(O,`min resolution of ${x.minHeight} > maximum of ${T}`),P;if(x.minFramerate>S)return Rr(O,`min framerate of ${x.minFramerate} > maximum of ${S}`),P;if(!g.some(L=>x.videoRanges[L]>0))return Rr(O,`no variants with VIDEO-RANGE of ${It(g)} found`),P;if(l&&O.indexOf(l.substring(0,4))%5!==0)return Rr(O,`video codec preference "${l}" not found`),P;if(x.maxScore<y)return Rr(O,`max score of ${x.maxScore} < selected max of ${y}`),P}return P&&(Np(O)>=Np(P)||x.fragmentError>t[P].fragmentError)?P:(m=x.minIndex,y=x.maxScore,O)},void 0),videoRanges:g,preferHDR:v,minFramerate:h,minBitrate:p,minIndex:m}}function Rr(t,e){Et.log(`[abr] start candidates with "${t}" ignored because ${e}`)}function aO(t){return t.reduce((e,n)=>{let i=e.groups[n.groupId];i||(i=e.groups[n.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),i.tracks.push(n);const r=n.channels||"2";return i.channels[r]=(i.channels[r]||0)+1,i.hasDefault=i.hasDefault||n.default,i.hasAutoSelect=i.hasAutoSelect||n.autoselect,i.hasDefault&&(e.hasDefaultAudio=!0),i.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function Xre(t,e,n,i){return t.slice(n,i+1).reduce((r,s,o)=>{if(!s.codecSet)return r;const a=s.audioGroups;let l=r[s.codecSet];l||(r[s.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!a,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,s.bitrate);const u=Math.min(s.height,s.width);return l.minHeight=Math.min(l.minHeight,u),l.minFramerate=Math.min(l.minFramerate,s.frameRate),l.minIndex=Math.min(l.minIndex,o),l.maxScore=Math.max(l.maxScore,s.score),l.fragmentError+=s.fragmentError,l.videoRanges[s.videoRange]=(l.videoRanges[s.videoRange]||0)+1,a&&a.forEach(c=>{if(!c)return;const d=e.groups[c];d&&(l.hasDefaultAudio=l.hasDefaultAudio||e.hasDefaultAudio?d.hasDefault:d.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(d.channels).forEach(f=>{l.channels[f]=(l.channels[f]||0)+d.channels[f]}))}),r},{})}function lO(t){if(!t)return t;const{lang:e,assocLang:n,characteristics:i,channels:r,audioCodec:s}=t;return{lang:e,assocLang:n,characteristics:i,channels:r,audioCodec:s}}function Lr(t,e,n){if("attrs"in t){const i=e.indexOf(t);if(i!==-1)return i}for(let i=0;i<e.length;i++){const r=e[i];if(ua(t,r,n))return i}return-1}function ua(t,e,n){const{groupId:i,name:r,lang:s,assocLang:o,default:a}=t,l=t.forced;return(i===void 0||e.groupId===i)&&(r===void 0||e.name===r)&&(s===void 0||Qre(s,e.lang))&&(s===void 0||e.assocLang===o)&&(a===void 0||e.default===a)&&(l===void 0||e.forced===l)&&(!("characteristics"in t)||Zre(t.characteristics||"",e.characteristics))&&(n===void 0||n(t,e))}function Qre(t,e="--"){return t.length===e.length?t===e:t.startsWith(e)||e.startsWith(t)}function Zre(t,e=""){const n=t.split(","),i=e.split(",");return n.length===i.length&&!n.some(r=>i.indexOf(r)===-1)}function ca(t,e){const{audioCodec:n,channels:i}=t;return(n===void 0||(e.audioCodec||"").substring(0,4)===n.substring(0,4))&&(i===void 0||i===(e.channels||"2"))}function Jre(t,e,n,i,r){const s=e[i],a=e.reduce((f,h,p)=>{const m=h.uri;return(f[m]||(f[m]=[])).push(p),f},{})[s.uri];a.length>1&&(i=Math.max.apply(Math,a));const l=s.videoRange,u=s.frameRate,c=s.codecSet.substring(0,4),d=uO(e,i,f=>{if(f.videoRange!==l||f.frameRate!==u||f.codecSet.substring(0,4)!==c)return!1;const h=f.audioGroups,p=n.filter(m=>!h||h.indexOf(m.groupId)!==-1);return Lr(t,p,r)>-1});return d>-1?d:uO(e,i,f=>{const h=f.audioGroups,p=n.filter(m=>!h||h.indexOf(m.groupId)!==-1);return Lr(t,p,r)>-1})}function uO(t,e,n){for(let i=e;i>-1;i--)if(n(t[i]))return i;for(let i=e+1;i<t.length;i++)if(n(t[i]))return i;return-1}function Hp(t,e){var n;return!!t&&t!==((n=e.loadLevelObj)==null?void 0:n.uri)}class ese extends Hi{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=n=>{var i;const{fragCurrent:r,partCurrent:s,hls:o}=this,{autoLevelEnabled:a,media:l}=o;if(!r||!l)return;const u=performance.now(),c=s?s.stats:r.stats,d=s?s.duration:r.duration,f=u-c.loading.start,h=o.minAutoLevel,p=r.level,m=this._nextAutoLevel;if(c.aborted||c.loaded&&c.loaded===c.total||p<=h){this.clearTimer(),this._nextAutoLevel=-1;return}if(!a)return;const y=m>-1&&m!==p,g=!!n||y;if(!g&&(l.paused||!l.playbackRate||!l.readyState))return;const v=o.mainForwardBufferInfo;if(!g&&v===null)return;const b=this.bwEstimator.getEstimateTTFB(),T=Math.abs(l.playbackRate);if(f<=Math.max(b,1e3*(d/(T*2))))return;const S=v?v.len/T:0,_=c.loading.first?c.loading.first-c.loading.start:-1,A=c.loaded&&_>-1,P=this.getBwEstimate(),O=o.levels,x=O[p],L=Math.max(c.loaded,Math.round(d*(r.bitrate||x.averageBitrate)/8));let M=A?f-_:f;M<1&&A&&(M=Math.min(f,c.loaded*8/P));const V=A?c.loaded*1e3/M:0,K=b/1e3,U=V?(L-c.loaded)/V:L*8/P+K;if(U<=S)return;const j=V?V*8:P,G=((i=(n==null?void 0:n.details)||this.hls.latestLevelDetails)==null?void 0:i.live)===!0,H=this.hls.config.abrBandWidthUpFactor;let Y=Number.POSITIVE_INFINITY,D;for(D=p-1;D>h;D--){const le=O[D].maxBitrate,we=!O[D].details||G;if(Y=this.getTimeToLoadFrag(K,j,d*le,we),Y<Math.min(S,d+K))break}if(Y>=U||Y>d*10)return;A?this.bwEstimator.sample(f-Math.min(b,_),c.loaded):this.bwEstimator.sampleTTFB(f);const ee=O[D].maxBitrate;this.getBwEstimate()*H>ee&&this.resetEstimator(ee);const ne=this.findBestLevel(ee,h,D,0,S,1,1);ne>-1&&(D=ne),this.warn(`Fragment ${r.sn}${s?" part "+s.index:""} of level ${p} is loading too slowly;
      Fragment duration: ${r.duration.toFixed(3)}
      Time to underbuffer: ${S.toFixed(3)} s
      Estimated load time for current fragment: ${U.toFixed(3)} s
      Estimated load time for down switch fragment: ${Y.toFixed(3)} s
      TTFB estimate: ${_|0} ms
      Current BW estimate: ${Ce(P)?P|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${D} @ ${ee|0} bps`),o.nextLoadLevel=o.nextAutoLevel=D,this.clearTimer();const N=()=>{if(this.clearTimer(),this.fragCurrent===r&&this.hls.loadLevel===D&&D>0){const le=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${D>0?"and switching down":""}
      Fragment duration: ${r.duration.toFixed(3)} s
      Time to underbuffer: ${le.toFixed(3)} s`),r.abortRequests(),this.fragCurrent=this.partCurrent=null,D>h){let we=this.findBestLevel(this.hls.levels[h].bitrate,h,D,0,le,1,1);we===-1&&(we=h),this.hls.nextLoadLevel=this.hls.nextAutoLevel=we,this.resetEstimator(this.hls.levels[we].bitrate)}}};y||U>Y*2?N():this.timer=self.setInterval(N,Y*1e3),o.trigger(C.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:s,stats:c})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new sre(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(C.MANIFEST_LOADING,this.onManifestLoading,this),e.on(C.FRAG_LOADING,this.onFragLoading,this),e.on(C.FRAG_LOADED,this.onFragLoaded,this),e.on(C.FRAG_BUFFERED,this.onFragBuffered,this),e.on(C.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(C.LEVEL_LOADED,this.onLevelLoaded,this),e.on(C.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(C.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(C.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(C.MANIFEST_LOADING,this.onManifestLoading,this),e.off(C.FRAG_LOADING,this.onFragLoading,this),e.off(C.FRAG_LOADED,this.onFragLoaded,this),e.off(C.FRAG_BUFFERED,this.onFragBuffered,this),e.off(C.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(C.LEVEL_LOADED,this.onLevelLoaded,this),e.off(C.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(C.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(C.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,n){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,n){const i=n.frag;if(!this.ignoreFragment(i)){if(!i.bitrateTest){var r;this.fragCurrent=i,this.partCurrent=(r=n.part)!=null?r:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,n){this.clearTimer()}onError(e,n){if(!n.fatal)switch(n.details){case Q.BUFFER_ADD_CODEC_ERROR:case Q.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case Q.FRAG_LOAD_TIMEOUT:{const i=n.frag,{fragCurrent:r,partCurrent:s}=this;if(i&&r&&i.sn===r.sn&&i.level===r.level){const o=performance.now(),a=s?s.stats:i.stats,l=o-a.loading.start,u=a.loading.first?a.loading.first-a.loading.start:-1;if(a.loaded&&u>-1){const d=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(d,u),a.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,n,i,r){const s=e+i/n,o=r?e+this.lastLevelLoadSec:0;return s+o}onLevelLoaded(e,n){const i=this.hls.config,{loading:r}=n.stats,s=r.end-r.first;Ce(s)&&(this.lastLevelLoadSec=s/1e3),n.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(n.levelInfo)}onFragLoaded(e,{frag:n,part:i}){const r=i?i.stats:n.stats;if(n.type===Pe.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(n)){if(this.clearTimer(),n.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const s=i?i.duration:n.duration,o=this.hls.levels[n.level],a=(o.loaded?o.loaded.bytes:0)+r.loaded,l=(o.loaded?o.loaded.duration:0)+s;o.loaded={bytes:a,duration:l},o.realBitrate=Math.round(8*a/l)}if(n.bitrateTest){const s={stats:r,frag:n,part:i,id:n.type};this.onFragBuffered(C.FRAG_BUFFERED,s),n.bitrateTest=!1}else this.lastLoadedFragLevel=n.level}}onFragBuffered(e,n){const{frag:i,part:r}=n,s=r!=null&&r.stats.loaded?r.stats:i.stats;if(s.aborted||this.ignoreFragment(i))return;const o=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,s.loaded),s.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Pe.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:n}=this.hls,i=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,s=this.findBestLevel(i,n,e,0,r,1,1);if(s>-1)return s;const o=this.hls.firstLevel,a=Math.min(Math.max(o,n),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${a}`),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,i=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(e!==-1&&(!i||!r||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const s=i&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,s)&&o[e].loadError<=o[s].loadError)return e}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:n,hls:i}=this;if(i.levels.length<=1)return i.loadLevel;const{maxAutoLevel:r,config:s,minAutoLevel:o}=i,a=n?n.duration:e?e.duration:0,l=this.getBwEstimate(),u=this.getStarvationDelay();let c=s.abrBandWidthFactor,d=s.abrBandWidthUpFactor;if(u){const y=this.findBestLevel(l,o,r,u,0,c,d);if(y>=0)return this.rebufferNotice=-1,y}let f=a?Math.min(a,s.maxStarvationDelay):s.maxStarvationDelay;if(!u){const y=this.bitrateTestDelay;y&&(f=(a?Math.min(a,s.maxLoadingDelay):s.maxLoadingDelay)-y,this.info(`bitrate test took ${Math.round(1e3*y)}ms, set first fragment max fetchDuration to ${Math.round(1e3*f)} ms`),c=d=1)}const h=this.findBestLevel(l,o,r,u,f,c,d);if(this.rebufferNotice!==h&&(this.rebufferNotice=h,this.info(`${u?"rebuffering expected":"buffer is empty"}, optimal quality level ${h}`)),h>-1)return h;const p=i.levels[o],m=i.loadLevelObj;return m&&(p==null?void 0:p.bitrate)<m.bitrate?o:i.loadLevel}getStarvationDelay(){const e=this.hls,n=e.media;if(!n)return 1/0;const i=n&&n.playbackRate!==0?Math.abs(n.playbackRate):1,r=e.mainForwardBufferInfo;return(r?r.len:0)/i}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,n,i,r,s,o,a){var l;const u=r+s,c=this.lastLoadedFragLevel,d=c===-1?this.hls.firstLevel:c,{fragCurrent:f,partCurrent:h}=this,{levels:p,allAudioTracks:m,loadLevel:y,config:g}=this.hls;if(p.length===1)return 0;const v=p[d],b=!!((l=this.hls.latestLevelDetails)!=null&&l.live),T=y===-1||c===-1;let S,_="SDR",A=(v==null?void 0:v.frameRate)||0;const{audioPreference:P,videoPreference:O}=g,x=this.audioTracksByGroup||(this.audioTracksByGroup=aO(m));let L=-1;if(T){if(this.firstSelection!==-1)return this.firstSelection;const j=this.codecTiers||(this.codecTiers=Xre(p,x,n,i)),G=Yre(j,_,e,P,O),{codecSet:H,videoRanges:Y,minFramerate:D,minBitrate:ee,minIndex:ne,preferHDR:N}=G;L=ne,S=H,_=N?Y[Y.length-1]:Y[0],A=D,e=Math.max(e,ee),this.log(`picked start tier ${It(G)}`)}else S=v==null?void 0:v.codecSet,_=v==null?void 0:v.videoRange;const M=h?h.duration:f?f.duration:0,V=this.bwEstimator.getEstimateTTFB()/1e3,K=[];for(let j=i;j>=n;j--){var U;const G=p[j],H=j>d;if(!G)continue;if(g.useMediaCapabilities&&!G.supportedResult&&!G.supportedPromise){const we=navigator.mediaCapabilities;typeof(we==null?void 0:we.decodingInfo)=="function"&&Ure(G,x,_,A,e,P)?(G.supportedPromise=nO(G,x,we,this.supportedCache),G.supportedPromise.then(ce=>{if(!this.hls)return;G.supportedResult=ce;const re=this.hls.levels,Ae=re.indexOf(G);ce.error?this.warn(`MediaCapabilities decodingInfo error: "${ce.error}" for level ${Ae} ${It(ce)}`):ce.supported?ce.decodingInfoResults.some($e=>$e.smooth===!1||$e.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${Ae} not smooth or powerEfficient: ${It(ce)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Ae} ${It(ce)}`),Ae>-1&&re.length>1&&(this.log(`Removing unsupported level ${Ae}`),this.hls.removeLevel(Ae),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(ce=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${ce}`)})):G.supportedResult=eO}if((S&&G.codecSet!==S||_&&G.videoRange!==_||H&&A>G.frameRate||!H&&A>0&&A<G.frameRate||(U=G.supportedResult)!=null&&(U=U.decodingInfoResults)!=null&&U.some(we=>we.smooth===!1))&&(!T||j!==L)){K.push(j);continue}const Y=G.details,D=(h?Y==null?void 0:Y.partTarget:Y==null?void 0:Y.averagetargetduration)||M;let ee;H?ee=a*e:ee=o*e;const ne=M&&r>=M*2&&s===0?G.averageBitrate:G.maxBitrate,N=this.getTimeToLoadFrag(V,ee,ne*D,Y===void 0);if(ee>=ne&&(j===c||G.loadError===0&&G.fragmentError===0)&&(N<=V||!Ce(N)||b&&!this.bitrateTestDelay||N<u)){const we=this.forcedAutoLevel;return j!==y&&(we===-1||we!==y)&&(K.length&&this.trace(`Skipped level(s) ${K.join(",")} of ${i} max with CODECS and VIDEO-RANGE:"${p[K[0]].codecs}" ${p[K[0]].videoRange}; not compatible with "${S}" ${_}`),this.info(`switch candidate:${d}->${j} adjustedbw(${Math.round(ee)})-bitrate=${Math.round(ee-ne)} ttfb:${V.toFixed(1)} avgDuration:${D.toFixed(1)} maxFetchDuration:${u.toFixed(1)} fetchDuration:${N.toFixed(1)} firstSelection:${T} codecSet:${G.codecSet} videoRange:${G.videoRange} hls.loadLevel:${y}`)),T&&(this.firstSelection=j),j}}return-1}set nextAutoLevel(e){const n=this.deriveNextAutoLevel(e);this._nextAutoLevel!==n&&(this.nextAutoLevelKey="",this._nextAutoLevel=n)}deriveNextAutoLevel(e){const{maxAutoLevel:n,minAutoLevel:i}=this.hls;return Math.min(Math.max(e,i),n)}}const cO={search:function(t,e){let n=0,i=t.length-1,r=null,s=null;for(;n<=i;){r=(n+i)/2|0,s=t[r];const o=e(s);if(o>0)n=r+1;else if(o<0)i=r-1;else return s}return null}};function tse(t,e,n){if(e===null||!Array.isArray(t)||!t.length||!Ce(e))return null;const i=t[0].programDateTime;if(e<(i||0))return null;const r=t[t.length-1].endProgramDateTime;if(e>=(r||0))return null;for(let s=0;s<t.length;++s){const o=t[s];if(ise(e,n,o))return o}return null}function da(t,e,n=0,i=0,r=.005){let s=null;if(t){s=e[1+t.sn-e[0].sn]||null;const a=t.endDTS-n;a>0&&a<15e-7&&(n+=15e-7),s&&t.level!==s.level&&s.end<=t.end&&(s=e[2+t.sn-e[0].sn]||null)}else n===0&&e[0].start===0&&(s=e[0]);if(s&&((!t||t.level===s.level)&&dO(n,i,s)===0||nse(s,t,Math.min(r,i))))return s;const o=cO.search(e,dO.bind(null,n,i));return o&&(o!==t||!s)?o:s}function nse(t,e,n){if(e&&e.start===0&&e.level<t.level&&(e.endPTS||0)>0){const i=e.tagList.reduce((r,s)=>(s[0]==="INF"&&(r+=parseFloat(s[1])),r),n);return t.start<=i}return!1}function dO(t=0,e=0,n){if(n.start<=t&&n.start+n.duration>t)return 0;const i=Math.min(e,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-i<=t?1:n.start-i>t&&n.start?-1:0}function ise(t,e,n){const i=Math.min(e,n.duration+(n.deltaPTS?n.deltaPTS:0))*1e3;return(n.endProgramDateTime||0)-i>t}function fO(t,e,n){if(t&&t.startCC<=e&&t.endCC>=e){let i=t.fragments;const{fragmentHint:r}=t;r&&(i=i.concat(r));let s;return cO.search(i,o=>o.cc<e?1:o.cc>e?-1:(s=o,o.end<=n?1:o.start>n?-1:0)),s||null}return null}function $p(t){switch(t.details){case Q.FRAG_LOAD_TIMEOUT:case Q.KEY_LOAD_TIMEOUT:case Q.LEVEL_LOAD_TIMEOUT:case Q.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function hO(t){return t.details.startsWith("key")}function pO(t){return hO(t)&&!!t.frag&&!t.frag.decryptdata}function mO(t,e){const n=$p(e);return t.default[`${n?"timeout":"error"}Retry`]}function Yb(t,e){const n=t.backoff==="linear"?1:Math.pow(2,e);return Math.min(n*t.retryDelayMs,t.maxRetryDelayMs)}function gO(t){return bt(bt({},t),{errorRetry:null,timeoutRetry:null})}function zp(t,e,n,i){if(!t)return!1;const r=i==null?void 0:i.code,s=e<t.maxNumRetry&&(rse(r)||!!n);return t.shouldRetry?t.shouldRetry(t,e,n,i,s):s}function rse(t){return Xb(t)||!!t&&(t<400||t>499)}function Xb(t){return t===0&&navigator.onLine===!1}var Cn={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},Ti={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class sse extends Hi{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(C.ERROR,this.onError,this),e.on(C.MANIFEST_LOADING,this.onManifestLoading,this),e.on(C.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(C.ERROR,this.onError,this),e.off(C.ERROR,this.onErrorOut,this),e.off(C.MANIFEST_LOADING,this.onManifestLoading,this),e.off(C.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===Pe.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const n=this.hls,i=n.currentLevel;return(e=n.loadLevelObj)!=null&&e.details||i===-1?n.loadLevel:i}variantHasKey(e,n){if(e){var i;if((i=e.details)!=null&&i.hasKey(n))return!0;const r=e.audioGroups;if(r)return this.hls.allAudioTracks.filter(o=>r.indexOf(o.groupId)>=0).some(o=>{var a;return(a=o.details)==null?void 0:a.hasKey(n)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,n){var i;if(n.fatal)return;const r=this.hls,s=n.context;switch(n.details){case Q.FRAG_LOAD_ERROR:case Q.FRAG_LOAD_TIMEOUT:case Q.KEY_LOAD_ERROR:case Q.KEY_LOAD_TIMEOUT:n.errorAction=this.getFragRetryOrSwitchAction(n);return;case Q.FRAG_PARSING_ERROR:if((i=n.frag)!=null&&i.gap){n.errorAction=zl();return}case Q.FRAG_GAP:case Q.FRAG_DECRYPT_ERROR:{n.errorAction=this.getFragRetryOrSwitchAction(n),n.errorAction.action=Cn.SendAlternateToPenaltyBox;return}case Q.LEVEL_EMPTY_ERROR:case Q.LEVEL_PARSING_ERROR:{var o;const l=n.parent===Pe.MAIN?n.level:r.loadLevel;n.details===Q.LEVEL_EMPTY_ERROR&&((o=n.context)!=null&&(o=o.levelDetails)!=null&&o.live)?n.errorAction=this.getPlaylistRetryOrSwitchAction(n,l):(n.levelRetry=!1,n.errorAction=this.getLevelSwitchAction(n,l))}return;case Q.LEVEL_LOAD_ERROR:case Q.LEVEL_LOAD_TIMEOUT:typeof(s==null?void 0:s.level)=="number"&&(n.errorAction=this.getPlaylistRetryOrSwitchAction(n,s.level));return;case Q.AUDIO_TRACK_LOAD_ERROR:case Q.AUDIO_TRACK_LOAD_TIMEOUT:case Q.SUBTITLE_LOAD_ERROR:case Q.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){const l=r.loadLevelObj;if(l&&(s.type===dt.AUDIO_TRACK&&l.hasAudioGroup(s.groupId)||s.type===dt.SUBTITLE_TRACK&&l.hasSubtitleGroup(s.groupId))){n.errorAction=this.getPlaylistRetryOrSwitchAction(n,r.loadLevel),n.errorAction.action=Cn.SendAlternateToPenaltyBox,n.errorAction.flags=Ti.MoveAllAlternatesMatchingHost;return}}return;case Q.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:n.errorAction={action:Cn.SendAlternateToPenaltyBox,flags:Ti.MoveAllAlternatesMatchingHDCP};return;case Q.KEY_SYSTEM_SESSION_UPDATE_FAILED:case Q.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case Q.KEY_SYSTEM_NO_SESSION:n.errorAction={action:Cn.SendAlternateToPenaltyBox,flags:Ti.MoveAllAlternatesMatchingKey};return;case Q.BUFFER_ADD_CODEC_ERROR:case Q.REMUX_ALLOC_ERROR:case Q.BUFFER_APPEND_ERROR:if(!n.errorAction){var a;n.errorAction=this.getLevelSwitchAction(n,(a=n.level)!=null?a:r.loadLevel)}return;case Q.INTERNAL_EXCEPTION:case Q.BUFFER_APPENDING_ERROR:case Q.BUFFER_FULL_ERROR:case Q.LEVEL_SWITCH_ERROR:case Q.BUFFER_STALLED_ERROR:case Q.BUFFER_SEEK_OVER_HOLE:case Q.BUFFER_NUDGE_ON_STALL:n.errorAction=zl();return}n.type===He.KEY_SYSTEM_ERROR&&(n.levelRetry=!1,n.errorAction=zl())}getPlaylistRetryOrSwitchAction(e,n){const i=this.hls,r=mO(i.config.playlistLoadPolicy,e),s=this.playlistError++;if(zp(r,s,$p(e),e.response))return{action:Cn.RetryRequest,flags:Ti.None,retryConfig:r,retryCount:s};const a=this.getLevelSwitchAction(e,n);return r&&(a.retryConfig=r,a.retryCount=s),a}getFragRetryOrSwitchAction(e){const n=this.hls,i=this.getVariantLevelIndex(e.frag),r=n.levels[i],{fragLoadPolicy:s,keyLoadPolicy:o}=n.config,a=mO(hO(e)?o:s,e),l=n.levels.reduce((c,d)=>c+d.fragmentError,0);if(r&&(e.details!==Q.FRAG_GAP&&r.fragmentError++,!pO(e)&&zp(a,l,$p(e),e.response)))return{action:Cn.RetryRequest,flags:Ti.None,retryConfig:a,retryCount:l};const u=this.getLevelSwitchAction(e,i);return a&&(u.retryConfig=a,u.retryCount=l),u}getLevelSwitchAction(e,n){const i=this.hls;n==null&&(n=i.loadLevel);const r=this.hls.levels[n];if(r){var s,o;const u=e.details;r.loadError++,u===Q.BUFFER_APPEND_ERROR&&r.fragmentError++;let c=-1;const{levels:d,loadLevel:f,minAutoLevel:h,maxAutoLevel:p}=i;!i.autoLevelEnabled&&!i.config.preserveManualLevelOnError&&(i.loadLevel=-1);const m=(s=e.frag)==null?void 0:s.type,g=(m===Pe.AUDIO&&u===Q.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(u===Q.BUFFER_ADD_CODEC_ERROR||u===Q.BUFFER_APPEND_ERROR))&&d.some(({audioCodec:_})=>r.audioCodec!==_),b=e.sourceBufferName==="video"&&(u===Q.BUFFER_ADD_CODEC_ERROR||u===Q.BUFFER_APPEND_ERROR)&&d.some(({codecSet:_,audioCodec:A})=>r.codecSet!==_&&r.audioCodec===A),{type:T,groupId:S}=(o=e.context)!=null?o:{};for(let _=d.length;_--;){const A=(_+f)%d.length;if(A!==f&&A>=h&&A<=p&&d[A].loadError===0){var a,l;const P=d[A];if(u===Q.FRAG_GAP&&m===Pe.MAIN&&e.frag){const O=d[A].details;if(O){const x=da(e.frag,O.fragments,e.frag.start);if(x!=null&&x.gap)continue}}else{if(T===dt.AUDIO_TRACK&&P.hasAudioGroup(S)||T===dt.SUBTITLE_TRACK&&P.hasSubtitleGroup(S))continue;if(m===Pe.AUDIO&&(a=r.audioGroups)!=null&&a.some(O=>P.hasAudioGroup(O))||m===Pe.SUBTITLE&&(l=r.subtitleGroups)!=null&&l.some(O=>P.hasSubtitleGroup(O))||g&&r.audioCodec===P.audioCodec||b&&r.codecSet===P.codecSet||!g&&r.codecSet!==P.codecSet)continue}c=A;break}}if(c>-1&&i.loadLevel!==c)return e.levelRetry=!0,this.playlistError=0,{action:Cn.SendAlternateToPenaltyBox,flags:Ti.None,nextAutoLevel:c}}return{action:Cn.SendAlternateToPenaltyBox,flags:Ti.MoveAllAlternatesMatchingHost}}onErrorOut(e,n){var i;switch((i=n.errorAction)==null?void 0:i.action){case Cn.DoNothing:break;case Cn.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(n),!n.errorAction.resolved&&n.details!==Q.FRAG_GAP?n.fatal=!0:/MediaSource readyState: ended/.test(n.error.message)&&(this.warn(`MediaSource ended after "${n.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(n.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const n=this.hls,i=e.errorAction;if(!i)return;const{flags:r}=i,s=i.nextAutoLevel;switch(r){case Ti.None:this.switchLevel(e,s);break;case Ti.MoveAllAlternatesMatchingHDCP:{const l=this.getVariantLevelIndex(e.frag),u=n.levels[l],c=u==null?void 0:u.attrs["HDCP-LEVEL"];if(i.hdcpLevel=c,c==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(c){n.maxHdcpLevel=Kb[Kb.indexOf(c)-1],i.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${n.maxHdcpLevel}" or lower`);break}}case Ti.MoveAllAlternatesMatchingKey:{const l=e.decryptdata;if(l){const u=this.hls.levels,c=u.length;for(let f=c;f--;)if(this.variantHasKey(u[f],l)){var o,a;this.log(`Banned key found in level ${f} (${u[f].bitrate}bps) or audio group "${(o=u[f].audioGroups)==null?void 0:o.join(",")}" (${(a=e.frag)==null?void 0:a.type} fragment) ${zn(l.keyId||[])}`),u[f].fragmentError++,u[f].loadError++,this.log(`Removing level ${f} with key error (${e.error})`),this.hls.removeLevel(f)}const d=e.frag;if(this.hls.levels.length<c)i.resolved=!0;else if(d&&d.type!==Pe.MAIN){const f=d.decryptdata;f&&!l.matches(f)&&(i.resolved=!0)}}break}}i.resolved||this.switchLevel(e,s)}switchLevel(e,n){if(n!==void 0&&e.errorAction&&(this.warn(`switching to level ${n} after ${e.details}`),this.hls.nextAutoLevel=n,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===Q.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const i=qb(e.mimeType),r=this.hls.levels;for(let s=r.length;s--;)r[s][`${e.sourceBufferName}Codec`]===i&&(this.log(`Removing level ${s} for ${e.details} ("${i}" not supported)`),this.hls.removeLevel(s))}}}function zl(t){const e={action:Cn.DoNothing,flags:Ti.None};return t&&(e.resolved=!0),e}var mn={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class ose{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(C.MANIFEST_LOADING,this.onManifestLoading,this),e.on(C.BUFFER_APPENDED,this.onBufferAppended,this),e.on(C.FRAG_BUFFERED,this.onFragBuffered,this),e.on(C.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(C.MANIFEST_LOADING,this.onManifestLoading,this),e.off(C.BUFFER_APPENDED,this.onBufferAppended,this),e.off(C.FRAG_BUFFERED,this.onFragBuffered,this),e.off(C.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,n){const i=this.activePartLists[n];if(i)for(let r=i.length;r--;){const s=i[r];if(!s)break;if(s.start<=e&&e<=s.end&&s.loaded)return s}return this.getBufferedFrag(e,n)}getBufferedFrag(e,n){return this.getFragAtPos(e,n,!0)}getFragAtPos(e,n,i){const{fragments:r}=this,s=Object.keys(r);for(let o=s.length;o--;){const a=r[s[o]];if((a==null?void 0:a.body.type)===n&&(!i||a.buffered)){const l=a.body;if(l.start<=e&&e<=l.end)return l}}return null}detectEvictedFragments(e,n,i,r,s){this.timeRanges&&(this.timeRanges[e]=n);const o=(r==null?void 0:r.fragment.sn)||-1;Object.keys(this.fragments).forEach(a=>{const l=this.fragments[a];if(!l||o>=l.body.sn)return;if(!l.buffered&&(!l.loaded||s)){l.body.type===i&&this.removeFragment(l.body);return}const u=l.range[e];if(u){if(u.time.length===0){this.removeFragment(l.body);return}u.time.some(c=>{const d=!this.isTimeBuffered(c.startPTS,c.endPTS,n);return d&&this.removeFragment(l.body),d})}})}detectPartialFragments(e){const n=this.timeRanges;if(!n||e.frag.sn==="initSegment")return;const i=e.frag,r=Vl(i),s=this.fragments[r];if(!s||s.buffered&&i.gap)return;const o=!i.relurl;Object.keys(n).forEach(a=>{const l=i.elementaryStreams[a];if(!l)return;const u=n[a],c=o||l.partial===!0;s.range[a]=this.getBufferedTimes(i,e.part,c,u)}),s.loaded=null,Object.keys(s.range).length?(s.buffered=!0,(s.body.endList=i.endList||s.body.endList)&&(this.endListFragments[s.body.type]=s),Vp(s)||this.removeParts(i.sn-1,i.type)):this.removeFragment(s.body)}removeParts(e,n){const i=this.activePartLists[n];i&&(this.activePartLists[n]=yO(i,r=>r.fragment.sn>=e))}fragBuffered(e,n){const i=Vl(e);let r=this.fragments[i];!r&&n&&(r=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,r.buffered=!0)}getBufferedTimes(e,n,i,r){const s={time:[],partial:i},o=e.start,a=e.end,l=e.minEndPTS||a,u=e.maxStartPTS||o;for(let c=0;c<r.length;c++){const d=r.start(c)-this.bufferPadding,f=r.end(c)+this.bufferPadding;if(u>=d&&l<=f){s.time.push({startPTS:Math.max(o,r.start(c)),endPTS:Math.min(a,r.end(c))});break}else if(o<f&&a>d){const h=Math.max(o,r.start(c)),p=Math.min(a,r.end(c));p>h&&(s.partial=!0,s.time.push({startPTS:h,endPTS:p}))}else if(a<=d)break}return s}getPartialFragment(e){let n=null,i,r,s,o=0;const{bufferPadding:a,fragments:l}=this;return Object.keys(l).forEach(u=>{const c=l[u];c&&Vp(c)&&(r=c.body.start-a,s=c.body.end+a,e>=r&&e<=s&&(i=Math.min(e-r,s-e),o<=i&&(n=c.body,o=i)))}),n}isEndListAppended(e){const n=this.endListFragments[e];return n!==void 0&&(n.buffered||Vp(n))}getState(e){const n=Vl(e),i=this.fragments[n];return i?i.buffered?Vp(i)?mn.PARTIAL:mn.OK:mn.APPENDING:mn.NOT_LOADED}isTimeBuffered(e,n,i){let r,s;for(let o=0;o<i.length;o++){if(r=i.start(o)-this.bufferPadding,s=i.end(o)+this.bufferPadding,e>=r&&n<=s)return!0;if(n<=r)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,n){if(n.frag.sn==="initSegment"||n.frag.bitrateTest)return;const i=n.frag,r=n.part?null:n,s=Vl(i);this.fragments[s]={body:i,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(e,n){const{frag:i,part:r,timeRanges:s,type:o}=n;if(i.sn==="initSegment")return;const a=i.type;if(r){let u=this.activePartLists[a];u||(this.activePartLists[a]=u=[]),u.push(r)}this.timeRanges=s;const l=s[o];this.detectEvictedFragments(o,l,a,r)}onFragBuffered(e,n){this.detectPartialFragments(n)}hasFragment(e){const n=Vl(e);return!!this.fragments[n]}hasFragments(e){const{fragments:n}=this,i=Object.keys(n);if(!e)return i.length>0;for(let r=i.length;r--;){const s=n[i[r]];if((s==null?void 0:s.body.type)===e)return!0}return!1}hasParts(e){var n;return!!((n=this.activePartLists[e])!=null&&n.length)}removeFragmentsInRange(e,n,i,r,s){r&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const a=this.fragments[o];if(!a)return;const l=a.body;l.type!==i||r&&!l.gap||l.start<n&&l.end>e&&(a.buffered||s)&&this.removeFragment(l)})}removeFragment(e){const n=Vl(e);e.clearElementaryStreamInfo();const i=this.activePartLists[e.type];if(i){const r=e.sn;this.activePartLists[e.type]=yO(i,s=>s.fragment.sn!==r)}delete this.fragments[n],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const n=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;n&&n.forEach(i=>i.clearElementaryStreamInfo())}}function Vp(t){var e,n,i;return t.buffered&&!!(t.body.gap||(e=t.range.video)!=null&&e.partial||(n=t.range.audio)!=null&&n.partial||(i=t.range.audiovideo)!=null&&i.partial)}function Vl(t){return`${t.type}_${t.level}_${t.sn}`}function yO(t,e){return t.filter(n=>{const i=e(n);return i||n.clearElementaryStreamInfo(),i})}var uo={cbc:0,ctr:1};class ase{constructor(e,n,i){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=n,this.aesMode=i}decrypt(e,n){switch(this.aesMode){case uo.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},n,e);case uo.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},n,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function lse(t){const e=t.byteLength,n=e&&new DataView(t.buffer).getUint8(e-1);return n?t.slice(0,e-n):t}class use{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const n=new DataView(e),i=new Uint32Array(4);for(let r=0;r<4;r++)i[r]=n.getUint32(r*4);return i}initTable(){const e=this.sBox,n=this.invSBox,i=this.subMix,r=i[0],s=i[1],o=i[2],a=i[3],l=this.invSubMix,u=l[0],c=l[1],d=l[2],f=l[3],h=new Uint32Array(256);let p=0,m=0,y=0;for(y=0;y<256;y++)y<128?h[y]=y<<1:h[y]=y<<1^283;for(y=0;y<256;y++){let g=m^m<<1^m<<2^m<<3^m<<4;g=g>>>8^g&255^99,e[p]=g,n[g]=p;const v=h[p],b=h[v],T=h[b];let S=h[g]*257^g*16843008;r[p]=S<<24|S>>>8,s[p]=S<<16|S>>>16,o[p]=S<<8|S>>>24,a[p]=S,S=T*16843009^b*65537^v*257^p*16843008,u[g]=S<<24|S>>>8,c[g]=S<<16|S>>>16,d[g]=S<<8|S>>>24,f[g]=S,p?(p=v^h[h[h[T^v]]],m^=h[h[m]]):p=m=1}}expandKey(e){const n=this.uint8ArrayToUint32Array_(e);let i=!0,r=0;for(;r<n.length&&i;)i=n[r]===this.key[r],r++;if(i)return;this.key=n;const s=this.keySize=n.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);const o=this.ksRows=(s+6+1)*4;let a,l;const u=this.keySchedule=new Uint32Array(o),c=this.invKeySchedule=new Uint32Array(o),d=this.sBox,f=this.rcon,h=this.invSubMix,p=h[0],m=h[1],y=h[2],g=h[3];let v,b;for(a=0;a<o;a++){if(a<s){v=u[a]=n[a];continue}b=v,a%s===0?(b=b<<8|b>>>24,b=d[b>>>24]<<24|d[b>>>16&255]<<16|d[b>>>8&255]<<8|d[b&255],b^=f[a/s|0]<<24):s>6&&a%s===4&&(b=d[b>>>24]<<24|d[b>>>16&255]<<16|d[b>>>8&255]<<8|d[b&255]),u[a]=v=(u[a-s]^b)>>>0}for(l=0;l<o;l++)a=o-l,l&3?b=u[a]:b=u[a-4],l<4||a<=4?c[l]=b:c[l]=p[d[b>>>24]]^m[d[b>>>16&255]]^y[d[b>>>8&255]]^g[d[b&255]],c[l]=c[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,n,i){const r=this.keySize+6,s=this.invKeySchedule,o=this.invSBox,a=this.invSubMix,l=a[0],u=a[1],c=a[2],d=a[3],f=this.uint8ArrayToUint32Array_(i);let h=f[0],p=f[1],m=f[2],y=f[3];const g=new Int32Array(e),v=new Int32Array(g.length);let b,T,S,_,A,P,O,x,L,M,V,K,U,j;const G=this.networkToHostOrderSwap;for(;n<g.length;){for(L=G(g[n]),M=G(g[n+1]),V=G(g[n+2]),K=G(g[n+3]),A=L^s[0],P=K^s[1],O=V^s[2],x=M^s[3],U=4,j=1;j<r;j++)b=l[A>>>24]^u[P>>16&255]^c[O>>8&255]^d[x&255]^s[U],T=l[P>>>24]^u[O>>16&255]^c[x>>8&255]^d[A&255]^s[U+1],S=l[O>>>24]^u[x>>16&255]^c[A>>8&255]^d[P&255]^s[U+2],_=l[x>>>24]^u[A>>16&255]^c[P>>8&255]^d[O&255]^s[U+3],A=b,P=T,O=S,x=_,U=U+4;b=o[A>>>24]<<24^o[P>>16&255]<<16^o[O>>8&255]<<8^o[x&255]^s[U],T=o[P>>>24]<<24^o[O>>16&255]<<16^o[x>>8&255]<<8^o[A&255]^s[U+1],S=o[O>>>24]<<24^o[x>>16&255]<<16^o[A>>8&255]<<8^o[P&255]^s[U+2],_=o[x>>>24]<<24^o[A>>16&255]<<16^o[P>>8&255]<<8^o[O&255]^s[U+3],v[n]=G(b^h),v[n+1]=G(_^p),v[n+2]=G(S^m),v[n+3]=G(T^y),h=L,p=M,m=V,y=K,n=n+4}return v.buffer}}class cse{constructor(e,n,i){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=n,this.aesMode=i}expandKey(){const e=dse(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function dse(t){switch(t){case uo.cbc:return"AES-CBC";case uo.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${t}`)}}const fse=16;class Qb{constructor(e,{removePKCS7Padding:n=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=n,n)try{const i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:n}=this;if(!e||n)return this.reset(),null;const i=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?lse(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,n,i,r){return this.useSoftware?new Promise((s,o)=>{const a=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(a,n,i,r);const l=this.flush();l?s(l.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),n,i,r)}softwareDecrypt(e,n,i,r){const{currentIV:s,currentResult:o,remainderData:a}=this;if(r!==uo.cbc||n.byteLength!==16)return Et.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),a&&(e=$i(a,e),this.remainderData=null);const l=this.getValidChunk(e);if(!l.length)return null;s&&(i=s);let u=this.softwareDecrypter;u||(u=this.softwareDecrypter=new use),u.expandKey(n);const c=o;return this.currentResult=u.decrypt(l.buffer,0,i),this.currentIV=l.slice(-16).buffer,c||null}webCryptoDecrypt(e,n,i,r){if(this.key!==n||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,n,i,r));this.key=n,this.fastAesKey=new cse(this.subtle,n,r)}return this.fastAesKey.expandKey().then(s=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new ase(this.subtle,new Uint8Array(i),r).decrypt(e.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(Et.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,n,i,r)))}onWebCryptoError(e,n,i,r){const s=this.enableSoftwareAES;if(s){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,n,i,r);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(s?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let n=e;const i=e.length-e.length%fse;return i!==e.length&&(n=e.slice(0,i),this.remainderData=e.slice(i)),n}logOnce(e){this.logEnabled&&(Et.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const vO=Math.pow(2,17);class hse{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,n){const i=e.url;if(!i)return Promise.reject(new ms({type:He.NETWORK_ERROR,details:Q.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${i?"part list":"url"}`),networkDetails:null}));this.abort();const r=this.config,s=r.fLoader,o=r.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(p=>p[0]==="GAP")){l(EO(e));return}else e.gap=!1;const u=this.loader=s?new s(r):new o(r),c=bO(e);e.loader=u;const d=gO(r.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:vO};e.stats=u.stats;const h={onSuccess:(p,m,y,g)=>{this.resetLoader(e,u);let v=p.data;y.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(v.slice(0,16)),v=v.slice(16)),a({frag:e,part:null,payload:v,networkDetails:g})},onError:(p,m,y,g)=>{this.resetLoader(e,u),l(new ms({type:He.NETWORK_ERROR,details:Q.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:bt({url:i,data:void 0},p),error:new Error(`HTTP Error ${p.code} ${p.text}`),networkDetails:y,stats:g}))},onAbort:(p,m,y)=>{this.resetLoader(e,u),l(new ms({type:He.NETWORK_ERROR,details:Q.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:y,stats:p}))},onTimeout:(p,m,y)=>{this.resetLoader(e,u),l(new ms({type:He.NETWORK_ERROR,details:Q.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:y,stats:p}))}};n&&(h.onProgress=(p,m,y,g)=>n({frag:e,part:null,payload:y,networkDetails:g})),u.load(c,f,h)})}loadPart(e,n,i){this.abort();const r=this.config,s=r.fLoader,o=r.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap||n.gap){l(EO(e,n));return}const u=this.loader=s?new s(r):new o(r),c=bO(e,n);e.loader=u;const d=gO(r.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:vO};n.stats=u.stats,u.load(c,f,{onSuccess:(h,p,m,y)=>{this.resetLoader(e,u),this.updateStatsFromPart(e,n);const g={frag:e,part:n,payload:h.data,networkDetails:y};i(g),a(g)},onError:(h,p,m,y)=>{this.resetLoader(e,u),l(new ms({type:He.NETWORK_ERROR,details:Q.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:n,response:bt({url:c.url,data:void 0},h),error:new Error(`HTTP Error ${h.code} ${h.text}`),networkDetails:m,stats:y}))},onAbort:(h,p,m)=>{e.stats.aborted=n.stats.aborted,this.resetLoader(e,u),l(new ms({type:He.NETWORK_ERROR,details:Q.INTERNAL_ABORTED,fatal:!1,frag:e,part:n,error:new Error("Aborted"),networkDetails:m,stats:h}))},onTimeout:(h,p,m)=>{this.resetLoader(e,u),l(new ms({type:He.NETWORK_ERROR,details:Q.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:n,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:m,stats:h}))}})})}updateStatsFromPart(e,n){const i=e.stats,r=n.stats,s=r.total;if(i.loaded+=r.loaded,s){const l=Math.round(e.duration/n.duration),u=Math.min(Math.round(i.loaded/s),l),d=(l-u)*Math.round(i.loaded/u);i.total=i.loaded+d}else i.total=Math.max(i.loaded,i.total);const o=i.loading,a=r.loading;o.start?o.first+=a.first-a.start:(o.start=a.start,o.first=a.first),o.end=a.end}resetLoader(e,n){e.loader=null,this.loader===n&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),n.destroy()}}function bO(t,e=null){const n=e||t,i={frag:t,part:e,responseType:"arraybuffer",url:n.url,headers:{},rangeStart:0,rangeEnd:0},r=n.byteRangeStartOffset,s=n.byteRangeEndOffset;if(Ce(r)&&Ce(s)){var o;let a=r,l=s;if(t.sn==="initSegment"&&pse((o=t.decryptdata)==null?void 0:o.method)){const u=s-r;u%16&&(l=s+(16-u%16)),r!==0&&(i.resetIV=!0,a=r-16)}i.rangeStart=a,i.rangeEnd=l}return i}function EO(t,e){const n=new Error(`GAP ${t.gap?"tag":"attribute"} found`),i={type:He.MEDIA_ERROR,details:Q.FRAG_GAP,fatal:!1,frag:t,error:n,networkDetails:null};return e&&(i.part=e),(e||t).stats.aborted=!0,new ms(i)}function pse(t){return t==="AES-128"||t==="AES-256"}class ms extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class TO extends Hi{constructor(e,n){super(e,n),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Zb{constructor(e,n,i,r=0,s=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Gp(),this.buffering={audio:Gp(),video:Gp(),audiovideo:Gp()},this.level=e,this.sn=n,this.id=i,this.size=r,this.part=s,this.partial=o}}function Gp(){return{start:0,executeStart:0,executeEnd:0,end:0}}const SO={length:0,start:()=>0,end:()=>0};class Qe{static isBuffered(e,n){if(e){const i=Qe.getBuffered(e);for(let r=i.length;r--;)if(n>=i.start(r)&&n<=i.end(r))return!0}return!1}static bufferedRanges(e){if(e){const n=Qe.getBuffered(e);return Qe.timeRangesToArray(n)}return[]}static timeRangesToArray(e){const n=[];for(let i=0;i<e.length;i++)n.push({start:e.start(i),end:e.end(i)});return n}static bufferInfo(e,n,i){if(e){const r=Qe.bufferedRanges(e);if(r.length)return Qe.bufferedInfo(r,n,i)}return{len:0,start:n,end:n,bufferedIndex:-1}}static bufferedInfo(e,n,i){n=Math.max(0,n),e.length>1&&e.sort((c,d)=>c.start-d.start||d.end-c.end);let r=-1,s=[];if(i)for(let c=0;c<e.length;c++){n>=e[c].start&&n<=e[c].end&&(r=c);const d=s.length;if(d){const f=s[d-1].end;e[c].start-f<i?e[c].end>f&&(s[d-1].end=e[c].end):s.push(e[c])}else s.push(e[c])}else s=e;let o=0,a,l=n,u=n;for(let c=0;c<s.length;c++){const d=s[c].start,f=s[c].end;if(r===-1&&n>=d&&n<=f&&(r=c),n+i>=d&&n<f)l=d,u=f,o=u-n;else if(n+i<d){a=d;break}}return{len:o,start:l||0,end:u||0,nextStart:a,buffered:e,bufferedIndex:r}}static getBuffered(e){try{return e.buffered||SO}catch(n){return Et.log("failed to get media.buffered",n),SO}}}const xO=/\{\$([a-zA-Z0-9-_]+)\}/g;function wO(t){return xO.test(t)}function Jb(t,e){if(t.variableList!==null||t.hasVariableRefs){const n=t.variableList;return e.replace(xO,i=>{const r=i.substring(2,i.length-1),s=n==null?void 0:n[r];return s===void 0?(t.playlistParsingError||(t.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),i):s})}return e}function _O(t,e,n){let i=t.variableList;i||(t.variableList=i={});let r,s;if("QUERYPARAM"in e){r=e.QUERYPARAM;try{const o=new self.URL(n).searchParams;if(o.has(r))s=o.get(r);else throw new Error(`"${r}" does not match any query parameter in URI: "${n}"`)}catch(o){t.playlistParsingError||(t.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else r=e.NAME,s=e.VALUE;r in i?t.playlistParsingError||(t.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):i[r]=s||""}function mse(t,e,n){const i=e.IMPORT;if(n&&i in n){let r=t.variableList;r||(t.variableList=r={}),r[i]=n[i]}else t.playlistParsingError||(t.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}const gse=/^(\d+)x(\d+)$/,AO=/(.+?)=(".*?"|.*?)(?:,|$)/g;class qt{constructor(e,n){typeof e=="string"&&(e=qt.parseAttrList(e,n)),xt(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const n=parseInt(this[e],10);return n>Number.MAX_SAFE_INTEGER?1/0:n}hexadecimalInteger(e){if(this[e]){let n=(this[e]||"0x").slice(2);n=(n.length&1?"0":"")+n;const i=new Uint8Array(n.length/2);for(let r=0;r<n.length/2;r++)i[r]=parseInt(n.slice(r*2,r*2+2),16);return i}return null}hexadecimalIntegerAsNumber(e){const n=parseInt(this[e],16);return n>Number.MAX_SAFE_INTEGER?1/0:n}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,n){const i=this[e];return i?parseFloat(i):n}enumeratedString(e){return this[e]}enumeratedStringList(e,n){const i=this[e];return(i?i.split(/[ ,]+/):[]).reduce((r,s)=>(r[s.toLowerCase()]=!0,r),n)}bool(e){return this[e]==="YES"}decimalResolution(e){const n=gse.exec(this[e]);if(n!==null)return{width:parseInt(n[1],10),height:parseInt(n[2],10)}}static parseAttrList(e,n){let i;const r={},s='"';for(AO.lastIndex=0;(i=AO.exec(e))!==null;){const o=i[1].trim();let a=i[2];const l=a.indexOf(s)===0&&a.lastIndexOf(s)===a.length-1;let u=!1;if(l)a=a.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":u=!0}if(n&&(l||u))a=Jb(n,a);else if(!u&&!l)switch(o){case"CLOSED-CAPTIONS":if(a==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Et.warn(`${e}: attribute ${o} is missing quotes`)}r[o]=a}return r}}const yse="com.apple.hls.interstitial";function vse(t){return t!=="ID"&&t!=="CLASS"&&t!=="CUE"&&t!=="START-DATE"&&t!=="DURATION"&&t!=="END-DATE"&&t!=="END-ON-NEXT"}function bse(t){return t==="SCTE35-OUT"||t==="SCTE35-IN"||t==="SCTE35-CMD"}class CO{constructor(e,n,i=0){var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(n==null?void 0:n.tagAnchor)||null,this.tagOrder=(r=n==null?void 0:n.tagOrder)!=null?r:i,n){const s=n.attr;for(const o in s)if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!==s[o]){Et.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=o;break}e=xt(new qt({}),s,e)}if(this.attr=e,n?(this._startDate=n._startDate,this._cue=n._cue,this._endDate=n._endDate,this._dateAtEnd=n._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const s=(n==null?void 0:n.endDate)||new Date(this.attr["END-DATE"]);Ce(s.getTime())&&(this._endDate=s)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Et.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const n=this.duration;return n!==null?this._dateAtEnd=new Date(this._startDate.getTime()+n*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(Ce(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===yse}get isValid(){return!!this.id&&!this._badValueForSameId&&Ce(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const Ese=10;class Tse{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const n=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!n||!this.live,this.advanced=this.endSN>e.endSN||n>0||n===0&&i>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(n=>{let i=n.decryptdata;return i||(n.setKeyFormat(e.keyFormat),i=n.decryptdata),!!i&&e.matches(i)})}get hasProgramDateTime(){return this.fragments.length?Ce(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||Ese}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const n=this.lastPartIndex;if(n!==-1){for(let i=e.length;i--;)if(e[i].index>n)return e[i].index;return n}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function jp(t,e){return t.length===e.length?!t.some((n,i)=>n!==e[i]):!1}function IO(t,e){return!t&&!e?!0:!t||!e?!1:jp(t,e)}function Gl(t){return t==="AES-128"||t==="AES-256"||t==="AES-256-CTR"}function eE(t){switch(t){case"AES-128":case"AES-256":return uo.cbc;case"AES-256-CTR":return uo.ctr;default:throw new Error(`invalid full segment method ${t}`)}}function tE(t){return Uint8Array.from(atob(t),e=>e.charCodeAt(0))}function nE(t){return Uint8Array.from(unescape(encodeURIComponent(t)),e=>e.charCodeAt(0))}function Sse(t){const e=nE(t).subarray(0,16),n=new Uint8Array(16);return n.set(e,16-e.length),n}function RO(t){const e=function(i,r,s){const o=i[r];i[r]=i[s],i[s]=o};e(t,0,3),e(t,1,2),e(t,4,5),e(t,6,7)}function LO(t){const e=t.split(":");let n=null;if(e[0]==="data"&&e.length===2){const i=e[1].split(";"),r=i[i.length-1].split(",");if(r.length===2){const s=r[0]==="base64",o=r[1];s?(i.splice(-1,1),n=tE(o)):n=Sse(o)}}return n}const Wp=typeof self<"u"?self:void 0;var Kt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},In={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function qp(t){switch(t){case In.FAIRPLAY:return Kt.FAIRPLAY;case In.PLAYREADY:return Kt.PLAYREADY;case In.WIDEVINE:return Kt.WIDEVINE;case In.CLEARKEY:return Kt.CLEARKEY}}function iE(t){switch(t){case Kt.FAIRPLAY:return In.FAIRPLAY;case Kt.PLAYREADY:return In.PLAYREADY;case Kt.WIDEVINE:return In.WIDEVINE;case Kt.CLEARKEY:return In.CLEARKEY}}function md(t){const{drmSystems:e,widevineLicenseUrl:n}=t,i=e?[Kt.FAIRPLAY,Kt.WIDEVINE,Kt.PLAYREADY,Kt.CLEARKEY].filter(r=>!!e[r]):[];return!i[Kt.WIDEVINE]&&n&&i.push(Kt.WIDEVINE),i}const PO=function(t){return Wp!=null&&(t=Wp.navigator)!=null&&t.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function xse(t,e,n,i){let r;switch(t){case Kt.FAIRPLAY:r=["cenc","sinf"];break;case Kt.WIDEVINE:case Kt.PLAYREADY:r=["cenc"];break;case Kt.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${t}`)}return wse(r,e,n,i)}function wse(t,e,n,i){return[{initDataTypes:t,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs=${s}`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:n.map(s=>({contentType:`video/mp4; codecs=${s}`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}function _se(t){var e;return!!t&&(t.sessionType==="persistent-license"||!!((e=t.sessionTypes)!=null&&e.some(n=>n==="persistent-license")))}function kO(t){const e=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2),n=String.fromCharCode.apply(null,Array.from(e)),i=n.substring(n.indexOf("<"),n.length),o=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(o){const a=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(a){const l=tE(a).subarray(0,16);return RO(l),l}}return null}let Kp={};class fa{static clearKeyUriToKeyIdMap(){Kp={}}static setKeyIdForUri(e,n){Kp[e]=n}constructor(e,n,i,r=[1],s=null,o){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=n,this.keyFormat=i,this.keyFormatVersions=r,this.iv=s,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!Gl(e),o!=null&&o.startsWith("0x")&&(this.keyId=new Uint8Array(MD(o)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&jp(e.keyFormatVersions,this.keyFormatVersions)&&IO(e.iv,this.iv)&&IO(e.keyId,this.keyId)}isSupported(){if(this.method){if(Gl(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case In.FAIRPLAY:case In.WIDEVINE:case In.PLAYREADY:case In.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,n){if(!this.encrypted||!this.uri)return null;if(Gl(this.method)){let s=this.iv;return s||(typeof e!="number"&&(Et.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),s=Cse(e)),new fa(this.method,this.uri,"identity",this.keyFormatVersions,s)}if(this.keyId){const s=Kp[this.uri];if(s&&!jp(this.keyId,s)&&fa.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const i=LO(this.uri);if(i)switch(this.keyFormat){case In.WIDEVINE:if(this.pssh=i,!this.keyId){const s=Lre(i.buffer);if(s.length){var r;const o=s[0];this.keyId=(r=o.kids)!=null&&r.length?o.kids[0]:null}}this.keyId||(this.keyId=DO(n));break;case In.PLAYREADY:{const s=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=Rre(s,null,i),this.keyId=kO(i);break}default:{let s=i.subarray(0,16);if(s.length!==16){const o=new Uint8Array(16);o.set(s,16-s.length),s=o}this.keyId=s;break}}if(!this.keyId||this.keyId.byteLength!==16){let s;s=Ase(n),s||(s=DO(n),s||(s=Kp[this.uri])),s&&(this.keyId=s,fa.setKeyIdForUri(this.uri,s))}return this}}function Ase(t){const e=t==null?void 0:t[In.WIDEVINE];return e?e.keyId:null}function DO(t){const e=t==null?void 0:t[In.PLAYREADY];if(e){const n=LO(e.uri);if(n)return kO(n)}return null}function Cse(t){const e=new Uint8Array(16);for(let n=12;n<16;n++)e[n]=t>>8*(15-n)&255;return e}const OO=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,NO=/#EXT-X-MEDIA:(.*)/g,Ise=/^#EXT(?:INF|-X-TARGETDURATION):/m,rE=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),Rse=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Pr{static findGroup(e,n){for(let i=0;i<e.length;i++){const r=e[i];if(r.id===n)return r}}static resolve(e,n){return Ub.buildAbsoluteURL(n,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return Ise.test(e)}static parseMasterPlaylist(e,n){const i=wO(e),r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:i},s=[];if(OO.lastIndex=0,!e.startsWith("#EXTM3U"))return r.playlistParsingError=new Error("no EXTM3U delimiter"),r;let o;for(;(o=OO.exec(e))!=null;)if(o[1]){var a;const u=new qt(o[1],r),c=Jb(r,o[2]),d={attrs:u,bitrate:u.decimalInteger("BANDWIDTH")||u.decimalInteger("AVERAGE-BANDWIDTH"),name:u.NAME,url:Pr.resolve(c,n)},f=u.decimalResolution("RESOLUTION");f&&(d.width=f.width,d.height=f.height),UO(u.CODECS,d);const h=u["SUPPLEMENTAL-CODECS"];h&&(d.supplemental={},UO(h,d.supplemental)),(a=d.unknownCodecs)!=null&&a.length||s.push(d),r.levels.push(d)}else if(o[3]){const u=o[3],c=o[4];switch(u){case"SESSION-DATA":{const d=new qt(c,r),f=d["DATA-ID"];f&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[f]=d);break}case"SESSION-KEY":{const d=FO(c,n,r);d.encrypted&&d.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(d)):Et.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${c}"`);break}case"DEFINE":{{const d=new qt(c,r);_O(r,d,n)}break}case"CONTENT-STEERING":{const d=new qt(c,r);r.contentSteering={uri:Pr.resolve(d["SERVER-URI"],n),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":{r.startTimeOffset=BO(c);break}}}const l=s.length>0&&s.length<r.levels.length;return r.levels=l?s:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(e,n,i){let r;const s={},o=i.levels,a={AUDIO:o.map(u=>({id:u.attrs.AUDIO,audioCodec:u.audioCodec})),SUBTITLES:o.map(u=>({id:u.attrs.SUBTITLES,textCodec:u.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(NO.lastIndex=0;(r=NO.exec(e))!==null;){const u=new qt(r[1],i),c=u.TYPE;if(c){const d=a[c],f=s[c]||[];s[c]=f;const h=u.LANGUAGE,p=u["ASSOC-LANGUAGE"],m=u.CHANNELS,y=u.CHARACTERISTICS,g=u["INSTREAM-ID"],v={attrs:u,bitrate:0,id:l++,groupId:u["GROUP-ID"]||"",name:u.NAME||h||"",type:c,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:h,url:u.URI?Pr.resolve(u.URI,n):""};if(p&&(v.assocLang=p),m&&(v.channels=m),y&&(v.characteristics=y),g&&(v.instreamId=g),d!=null&&d.length){const b=Pr.findGroup(d,v.groupId)||d[0];HO(v,b,"audioCodec"),HO(v,b,"textCodec")}f.push(v)}}return s}static parseLevelPlaylist(e,n,i,r,s,o){var a;const l={url:n},u=new Tse(n),c=u.fragments,d=[];let f=null,h=0,p=0,m=0,y=0,g=0,v=null,b=new $b(r,l),T,S,_,A=-1,P=!1,O=null,x;if(rE.lastIndex=0,u.m3u8=e,u.hasVariableRefs=wO(e),((a=rE.exec(e))==null?void 0:a[0])!=="#EXTM3U")return u.playlistParsingError=new Error("Missing format identifier #EXTM3U"),u;for(;(T=rE.exec(e))!==null;){P&&(P=!1,b=new $b(r,l),b.playlistOffset=m,b.setStart(m),b.sn=h,b.cc=y,g&&(b.bitrate=g),b.level=i,f&&(b.initSegment=f,f.rawProgramDateTime&&(b.rawProgramDateTime=f.rawProgramDateTime,f.rawProgramDateTime=null),O&&(b.setByteRange(O),O=null)));const K=T[1];if(K){b.duration=parseFloat(K);const U=(" "+T[2]).slice(1);b.title=U||null,b.tagList.push(U?["INF",K,U]:["INF",K])}else if(T[3]){if(Ce(b.duration)){b.playlistOffset=m,b.setStart(m),_&&zO(b,_,u),b.sn=h,b.level=i,b.cc=y,c.push(b);const U=(" "+T[3]).slice(1);b.relurl=Jb(u,U),sE(b,v,d),v=b,m+=b.duration,h++,p=0,P=!0}}else{if(T=T[0].match(Rse),!T){Et.warn("No matches on slow regex match for level playlist!");continue}for(S=1;S<T.length&&T[S]===void 0;S++);const U=(" "+T[S]).slice(1),j=(" "+T[S+1]).slice(1),G=T[S+2]?(" "+T[S+2]).slice(1):null;switch(U){case"BYTERANGE":v?b.setByteRange(j,v):b.setByteRange(j);break;case"PROGRAM-DATE-TIME":b.rawProgramDateTime=j,b.tagList.push(["PROGRAM-DATE-TIME",j]),A===-1&&(A=c.length);break;case"PLAYLIST-TYPE":u.type&&gs(u,U,T),u.type=j.toUpperCase();break;case"MEDIA-SEQUENCE":u.startSN!==0?gs(u,U,T):c.length>0&&VO(u,U,T),h=u.startSN=parseInt(j);break;case"SKIP":{u.skippedSegments&&gs(u,U,T);const H=new qt(j,u),Y=H.decimalInteger("SKIPPED-SEGMENTS");if(Ce(Y)){u.skippedSegments+=Y;for(let ee=Y;ee--;)c.push(null);h+=Y}const D=H.enumeratedString("RECENTLY-REMOVED-DATERANGES");D&&(u.recentlyRemovedDateranges=(u.recentlyRemovedDateranges||[]).concat(D.split("	")));break}case"TARGETDURATION":u.targetduration!==0&&gs(u,U,T),u.targetduration=Math.max(parseInt(j),1);break;case"VERSION":u.version!==null&&gs(u,U,T),u.version=parseInt(j);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":u.live||gs(u,U,T),u.live=!1;break;case"#":(j||G)&&b.tagList.push(G?[j,G]:[j]);break;case"DISCONTINUITY":y++,b.tagList.push(["DIS"]);break;case"GAP":b.gap=!0,b.tagList.push([U]);break;case"BITRATE":b.tagList.push([U,j]),g=parseInt(j)*1e3,Ce(g)?b.bitrate=g:g=0;break;case"DATERANGE":{const H=new qt(j,u),Y=new CO(H,u.dateRanges[H.ID],u.dateRangeTagCount);u.dateRangeTagCount++,Y.isValid||u.skippedSegments?u.dateRanges[Y.id]=Y:Et.warn(`Ignoring invalid DATERANGE tag: "${j}"`),b.tagList.push(["EXT-X-DATERANGE",j]);break}case"DEFINE":{{const H=new qt(j,u);"IMPORT"in H?mse(u,H,o):_O(u,H,n)}break}case"DISCONTINUITY-SEQUENCE":u.startCC!==0?gs(u,U,T):c.length>0&&VO(u,U,T),u.startCC=y=parseInt(j);break;case"KEY":{const H=FO(j,n,u);if(H.isSupported()){if(H.method==="NONE"){_=void 0;break}_||(_={});const Y=_[H.keyFormat];Y!=null&&Y.matches(H)||(Y&&(_=xt({},_)),_[H.keyFormat]=H)}else Et.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${j}"`);break}case"START":u.startTimeOffset=BO(j);break;case"MAP":{const H=new qt(j,u);if(b.duration){const Y=new $b(r,l);$O(Y,H,i,_),f=Y,b.initSegment=f,f.rawProgramDateTime&&!b.rawProgramDateTime&&(b.rawProgramDateTime=f.rawProgramDateTime)}else{const Y=b.byteRangeEndOffset;if(Y){const D=b.byteRangeStartOffset;O=`${Y-D}@${D}`}else O=null;$O(b,H,i,_),f=b,P=!0}f.cc=y;break}case"SERVER-CONTROL":{x&&gs(u,U,T),x=new qt(j),u.canBlockReload=x.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=x.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=u.canSkipUntil>0&&x.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=x.optionalFloat("PART-HOLD-BACK",0),u.holdBack=x.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{u.partTarget&&gs(u,U,T);const H=new qt(j);u.partTarget=H.decimalFloatingPoint("PART-TARGET");break}case"PART":{let H=u.partList;H||(H=u.partList=[]);const Y=p>0?H[H.length-1]:void 0,D=p++,ee=new qt(j,u),ne=new mre(ee,b,l,D,Y);H.push(ne),b.duration+=ne.duration;break}case"PRELOAD-HINT":{const H=new qt(j,u);u.preloadHint=H;break}case"RENDITION-REPORT":{const H=new qt(j,u);u.renditionReports=u.renditionReports||[],u.renditionReports.push(H);break}default:Et.warn(`line parsed but not handled: ${T}`);break}}}v&&!v.relurl?(c.pop(),m-=v.duration,u.partList&&(u.fragmentHint=v)):u.partList&&(sE(b,v,d),b.cc=y,u.fragmentHint=b,_&&zO(b,_,u)),u.targetduration||(u.playlistParsingError=new Error("Missing Target Duration"));const L=c.length,M=c[0],V=c[L-1];if(m+=u.skippedSegments*u.targetduration,m>0&&L&&V){u.averagetargetduration=m/L;const K=V.sn;u.endSN=K!=="initSegment"?K:0,u.live||(V.endList=!0),A>0&&(Pse(c,A),M&&d.unshift(M))}return u.fragmentHint&&(m+=u.fragmentHint.duration),u.totalduration=m,d.length&&u.dateRangeTagCount&&M&&MO(d,u),u.endCC=y,u}}function MO(t,e){let n=t.length;if(!n)if(e.hasProgramDateTime){const a=e.fragments[e.fragments.length-1];t.push(a),n++}else return;const i=t[n-1],r=e.live?1/0:e.totalduration,s=Object.keys(e.dateRanges);for(let a=s.length;a--;){const l=e.dateRanges[s[a]],u=l.startDate.getTime();l.tagAnchor=i.ref;for(let c=n;c--;){var o;if(((o=t[c])==null?void 0:o.sn)<e.startSN)break;const d=Lse(e,u,t,c,r);if(d!==-1){l.tagAnchor=e.fragments[d].ref;break}}}}function Lse(t,e,n,i,r){const s=n[i];if(s){const a=s.programDateTime;if(e>=a||i===0){var o;const l=(((o=n[i+1])==null?void 0:o.start)||r)-s.start;if(e<=a+l*1e3){const u=n[i].sn-t.startSN;if(u<0)return-1;const c=t.fragments;if(c.length>n.length){const f=(n[i+1]||c[c.length-1]).sn-t.startSN;for(let h=f;h>u;h--){const p=c[h].programDateTime;if(e>=p&&e<p+c[h].duration*1e3)return h}}return u}}}return-1}function FO(t,e,n){var i,r;const s=new qt(t,n),o=(i=s.METHOD)!=null?i:"",a=s.URI,l=s.hexadecimalInteger("IV"),u=s.KEYFORMATVERSIONS,c=(r=s.KEYFORMAT)!=null?r:"identity";a&&s.IV&&!l&&Et.error(`Invalid IV: ${s.IV}`);const d=a?Pr.resolve(a,e):"",f=(u||"1").split("/").map(Number).filter(Number.isFinite);return new fa(o,d,c,f,l,s.KEYID)}function BO(t){const n=new qt(t).decimalFloatingPoint("TIME-OFFSET");return Ce(n)?n:null}function UO(t,e){let n=(t||"").split(/[ ,]+/).filter(i=>i);["video","audio","text"].forEach(i=>{const r=n.filter(s=>Gb(s,i));r.length&&(e[`${i}Codec`]=r.map(s=>s.split("/")[0]).join(","),n=n.filter(s=>r.indexOf(s)===-1))}),e.unknownCodecs=n}function HO(t,e,n){const i=e[n];i&&(t[n]=i)}function Pse(t,e){let n=t[e];for(let i=e;i--;){const r=t[i];if(!r)return;r.programDateTime=n.programDateTime-r.duration*1e3,n=r}}function sE(t,e,n){t.rawProgramDateTime?n.push(t):e!=null&&e.programDateTime&&(t.programDateTime=e.endProgramDateTime)}function $O(t,e,n,i){t.relurl=e.URI,e.BYTERANGE&&t.setByteRange(e.BYTERANGE),t.level=n,t.sn="initSegment",i&&(t.levelkeys=i),t.initSegment=null}function zO(t,e,n){t.levelkeys=e;const{encryptedFragments:i}=n;(!i.length||i[i.length-1].levelkeys!==e)&&Object.keys(e).some(r=>e[r].isCommonEncryption)&&i.push(t)}function gs(t,e,n){t.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${n[0]})`)}function VO(t,e,n){t.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${n[0]})`)}function oE(t,e){const n=e.startPTS;if(Ce(n)){let i=0,r;e.sn>t.sn?(i=n-t.start,r=t):(i=t.start-n,r=e),r.duration!==i&&r.setDuration(i)}else e.sn>t.sn?t.cc===e.cc&&t.minEndPTS?e.setStart(t.start+(t.minEndPTS-t.start)):e.setStart(t.start+t.duration):e.setStart(Math.max(t.start-e.duration,0))}function GO(t,e,n,i,r,s,o){i-n<=0&&(o.warn("Fragment should have a positive duration",e),i=n+e.duration,s=r+e.duration);let l=n,u=i;const c=e.startPTS,d=e.endPTS;if(Ce(c)){const g=Math.abs(c-n);t&&g>t.totalduration?o.warn(`media timestamps and playlist times differ by ${g}s for level ${e.level} ${t.url}`):Ce(e.deltaPTS)?e.deltaPTS=Math.max(g,e.deltaPTS):e.deltaPTS=g,l=Math.max(n,c),n=Math.min(n,c),r=e.startDTS!==void 0?Math.min(r,e.startDTS):r,u=Math.min(i,d),i=Math.max(i,d),s=e.endDTS!==void 0?Math.max(s,e.endDTS):s}const f=n-e.start;e.start!==0&&e.setStart(n),e.setDuration(i-e.start),e.startPTS=n,e.maxStartPTS=l,e.startDTS=r,e.endPTS=i,e.minEndPTS=u,e.endDTS=s;const h=e.sn;if(!t||h<t.startSN||h>t.endSN)return 0;let p;const m=h-t.startSN,y=t.fragments;for(y[m]=e,p=m;p>0;p--)oE(y[p],y[p-1]);for(p=m;p<y.length-1;p++)oE(y[p],y[p+1]);return t.fragmentHint&&oE(y[y.length-1],t.fragmentHint),t.PTSKnown=t.alignedSliding=!0,f}function kse(t,e,n){if(t===e)return;let i=null;const r=t.fragments;for(let c=r.length-1;c>=0;c--){const d=r[c].initSegment;if(d){i=d;break}}t.fragmentHint&&delete t.fragmentHint.endPTS;let s;Nse(t,e,(c,d,f,h)=>{if((!e.startCC||e.skippedSegments)&&d.cc!==c.cc){const p=c.cc-d.cc;for(let m=f;m<h.length;m++)h[m].cc+=p;e.endCC=h[h.length-1].cc}Ce(c.startPTS)&&Ce(c.endPTS)&&(d.setStart(d.startPTS=c.startPTS),d.startDTS=c.startDTS,d.maxStartPTS=c.maxStartPTS,d.endPTS=c.endPTS,d.endDTS=c.endDTS,d.minEndPTS=c.minEndPTS,d.setDuration(c.endPTS-c.startPTS),d.duration&&(s=d),e.PTSKnown=e.alignedSliding=!0),c.hasStreams&&(d.elementaryStreams=c.elementaryStreams),d.loader=c.loader,c.hasStats&&(d.stats=c.stats),c.initSegment&&(d.initSegment=c.initSegment,i=c.initSegment)});const o=e.fragments,a=e.fragmentHint?o.concat(e.fragmentHint):o;if(i&&a.forEach(c=>{var d;c&&(!c.initSegment||c.initSegment.relurl===((d=i)==null?void 0:d.relurl))&&(c.initSegment=i)}),e.skippedSegments){if(e.deltaUpdateFailed=o.some(c=>!c),e.deltaUpdateFailed){n.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let c=e.skippedSegments;c--;)o.shift();e.startSN=o[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=Dse(t.dateRanges,e,n));const c=t.fragments.filter(d=>d.rawProgramDateTime);if(t.hasProgramDateTime&&!e.hasProgramDateTime)for(let d=1;d<a.length;d++)a[d].programDateTime===null&&sE(a[d],a[d-1],c);MO(c,e)}e.endCC=o[o.length-1].cc}if(!e.startCC){var l;const c=KO(t,e.startSN-1);e.startCC=(l=c==null?void 0:c.cc)!=null?l:o[0].cc}Ose(t.partList,e.partList,(c,d)=>{d.elementaryStreams=c.elementaryStreams,d.stats=c.stats}),s?GO(e,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS,n):WO(t,e),o.length&&(e.totalduration=e.edge-o[0].start),e.driftStartTime=t.driftStartTime,e.driftStart=t.driftStart;const u=e.advancedDateTime;if(e.advanced&&u){const c=e.edge;e.driftStart||(e.driftStartTime=u,e.driftStart=c),e.driftEndTime=u,e.driftEnd=c}else e.driftEndTime=t.driftEndTime,e.driftEnd=t.driftEnd,e.advancedDateTime=t.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=t.requestScheduled)}function Dse(t,e,n){const{dateRanges:i,recentlyRemovedDateranges:r}=e,s=xt({},t);r&&r.forEach(l=>{delete s[l]});const a=Object.keys(s).length;return a?(Object.keys(i).forEach(l=>{const u=s[l],c=new CO(i[l].attr,u);c.isValid?(s[l]=c,u||(c.tagOrder+=a)):n.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${It(i[l].attr)}"`)}),s):i}function Ose(t,e,n){if(t&&e){let i=0;for(let r=0,s=t.length;r<=s;r++){const o=t[r],a=e[r+i];o&&a&&o.index===a.index&&o.fragment.sn===a.fragment.sn?n(o,a):i--}}}function Nse(t,e,n){const i=e.skippedSegments,r=Math.max(t.startSN,e.startSN)-e.startSN,s=(t.fragmentHint?1:0)+(i?e.endSN:Math.min(t.endSN,e.endSN))-e.startSN,o=e.startSN-t.startSN,a=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments;for(let u=r;u<=s;u++){const c=l[o+u];let d=a[u];if(i&&!d&&c&&(d=e.fragments[u]=c),c&&d){n(c,d,u,a);const f=c.relurl,h=d.relurl;if(f&&Mse(f,h)){e.playlistParsingError=jO(`media sequence mismatch ${d.sn}:`,t,e,c,d);return}else if(c.cc!==d.cc){e.playlistParsingError=jO(`discontinuity sequence mismatch (${c.cc}!=${d.cc})`,t,e,c,d);return}}}}function jO(t,e,n,i,r){return new Error(`${t} ${r.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${n.startSN}
${n.m3u8}`)}function WO(t,e,n=!0){const i=e.startSN+e.skippedSegments-t.startSN,r=t.fragments,s=i>=0;let o=0;if(s&&i<r.length)o=r[i].start;else if(s&&e.startSN===t.endSN+1)o=t.fragmentEnd;else if(s&&n)o=t.fragmentStart+i*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)o=t.fragmentStart;else return;aE(e,o)}function aE(t,e){if(e){const n=t.fragments;for(let i=t.skippedSegments;i<n.length;i++)n[i].addStart(e);t.fragmentHint&&t.fragmentHint.addStart(e)}}function qO(t,e=1/0){let n=1e3*t.targetduration;if(t.updated){const i=t.fragments;if(i.length&&n*4>e){const s=i[i.length-1].duration*1e3;s<n&&(n=s)}}else n/=2;return Math.round(n)}function KO(t,e,n){if(!t)return null;let i=t.fragments[e-t.startSN];return i||(i=t.fragmentHint,i&&i.sn===e)?i:e<t.startSN&&n&&n.sn===e?n:null}function YO(t,e,n){return t?XO(t.partList,e,n):null}function XO(t,e,n){if(t)for(let i=t.length;i--;){const r=t[i];if(r.index===n&&r.fragment.sn===e)return r}return null}function QO(t){t.forEach((e,n)=>{var i;(i=e.details)==null||i.fragments.forEach(r=>{r.level=n,r.initSegment&&(r.initSegment.level=n)})})}function Mse(t,e){return t!==e&&e?ZO(t)!==ZO(e):!1}function ZO(t){return t.replace(/\?[^?]*$/,"")}function gd(t,e){for(let i=0,r=t.length;i<r;i++){var n;if(((n=t[i])==null?void 0:n.cc)===e)return t[i]}return null}function Fse(t,e){return!!(t&&e.startCC<t.endCC&&e.endCC>t.startCC)}function JO(t,e){const n=t.start+e;t.startPTS=n,t.setStart(n),t.endPTS=n+t.duration}function eN(t,e){const n=e.fragments;for(let i=0,r=n.length;i<r;i++)JO(n[i],t);e.fragmentHint&&JO(e.fragmentHint,t),e.alignedSliding=!0}function Bse(t,e){t&&(tN(e,t),e.alignedSliding||Yp(e,t),!e.alignedSliding&&!e.skippedSegments&&WO(t,e,!1))}function tN(t,e){if(!Fse(e,t))return;const n=Math.min(e.endCC,t.endCC),i=gd(e.fragments,n),r=gd(t.fragments,n);if(!i||!r)return;Et.log(`Aligning playlist at start of dicontinuity sequence ${n}`);const s=i.start-r.start;eN(s,t)}function Yp(t,e){if(!t.hasProgramDateTime||!e.hasProgramDateTime)return;const n=t.fragments,i=e.fragments;if(!n.length||!i.length)return;let r,s;const o=Math.min(e.endCC,t.endCC);e.startCC<o&&t.startCC<o&&(r=gd(i,o),s=gd(n,o)),(!r||!s)&&(r=i[Math.floor(i.length/2)],s=gd(n,r.cc)||n[Math.floor(n.length/2)]);const a=r.programDateTime,l=s.programDateTime;if(!a||!l)return;const u=(l-a)/1e3-(s.start-r.start);eN(u,t)}function Vn(t,e,n){oi(t,e,n),t.addEventListener(e,n)}function oi(t,e,n){t.removeEventListener(e,n)}const Use={toString:function(t){let e="";const n=t.length;for(let i=0;i<n;i++)e+=`[${t.start(i).toFixed(3)}-${t.end(i).toFixed(3)}]`;return e}},ae={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class lE extends TO{constructor(e,n,i,r,s){super(r,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=ae.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:a,media:l,mediaBuffer:u,state:c}=this,d=l?l.currentTime:0,f=Qe.bufferInfo(u||l,d,o.maxBufferHole),h=!f.len;if(this.log(`Media seeking to ${Ce(d)?d.toFixed(3):d}, state: ${c}, ${h?"out of":"in"} buffer`),this.state===ae.ENDED)this.resetLoadingState();else if(a){const p=o.maxFragLookUpTolerance,m=a.start-p,y=a.start+a.duration+p;if(h||y<f.start||m>f.end){const g=d>y;(d<m||g)&&(g&&a.loader&&(this.log(`Cancelling fragment load for seek (sn: ${a.sn})`),a.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(l){this.fragmentTracker.removeFragmentsInRange(d,1/0,this.playlistType,!0);const p=this.lastCurrentTime;if(d>p&&(this.lastCurrentTime=d),!this.loadingParts){const m=Math.max(f.end,d),y=this.shouldLoadParts(this.getLevelDetails(),m);y&&(this.log(`LL-Part loading ON after seeking to ${d.toFixed(2)} with buffer @${m.toFixed(2)}`),this.loadingParts=y)}}this.hls.hasEnoughToStart||(this.log(`Setting ${h?"startPosition":"nextLoadPosition"} to ${d} for seek without enough to start`),this.nextLoadPosition=d,h&&(this.startPosition=d)),h&&this.state===ae.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=s,this.hls=e,this.fragmentLoader=new hse(e.config),this.keyLoader=i,this.fragmentTracker=n,this.config=e.config,this.decrypter=new Qb(e.config)}registerListeners(){const{hls:e}=this;e.on(C.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(C.MANIFEST_LOADING,this.onManifestLoading,this),e.on(C.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(C.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(C.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(C.MANIFEST_LOADING,this.onManifestLoading,this),e.off(C.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(C.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===ae.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=ae.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:n}=this;return n===-1&&e?e:n}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,n){if(n.live||!this.media)return!1;const i=e.end||0,r=this.config.timelineOffset||0;if(i<=r)return!1;const s=e.buffered;this.config.maxBufferHole&&s&&s.length>1&&(e=Qe.bufferedInfo(s,e.start,0));const o=e.nextStart;if(o&&o>r&&o<n.edge||this.media.currentTime<e.start)return!1;const l=n.partList;if(l!=null&&l.length){const c=l[l.length-1];return Qe.isBuffered(this.media,c.start+c.duration/2)}const u=n.fragments[n.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(u)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var n;return((n=this.getLevelDetails())==null?void 0:n.appliedTimelineOffset)||e}return 0}onMediaAttached(e,n){const i=this.media=this.mediaBuffer=n.media;Vn(i,"seeking",this.onMediaSeeking),Vn(i,"ended",this.onMediaEnded);const r=this.config;this.levels&&r.autoStartLoad&&this.state===ae.STOPPED&&this.startLoad(r.startPosition)}onMediaDetaching(e,n){const i=!!n.transferMedia,r=this.media;if(r!==null){if(r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),oi(r,"seeking",this.onMediaSeeking),oi(r,"ended",this.onMediaEnded),this.keyLoader&&!i&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,i){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,n){}onManifestLoaded(e,n){this.startTimeOffset=n.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=ae.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,n,i){this.startFragRequested=!0,this._loadFragForPlayback(e,n,i)}_loadFragForPlayback(e,n,i){const r=s=>{const o=s.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${s.part?" part: "+s.part.index:""} of ${this.fragInfo(o,!1,s.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(e,n,i,r).then(s=>{if(!s)return;const o=this.state,a=s.frag;if(this.fragContextChanged(a)){(o===ae.FRAG_LOADING||!this.fragCurrent&&o===ae.PARSING)&&(this.fragmentTracker.removeFragment(a),this.state=ae.IDLE);return}"payload"in s&&(this.log(`Loaded ${a.type} sn: ${a.sn} of ${this.playlistLabel()} ${a.level}`),this.hls.trigger(C.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===ae.STOPPED||this.state===ae.ERROR||(this.warn(`Frag error: ${(s==null?void 0:s.message)||s}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var n;const{fragmentTracker:i}=this;if(i.getState(e)===mn.APPENDING){const s=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,s),a=Math.max(e.duration,o?o.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(a,e.duration))&&i.removeFragment(e)}else((n=this.mediaBuffer)==null?void 0:n.buffered.length)===0?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===mn.PARTIAL&&i.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const n=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:n,part:null,stats:n.stats,id:n.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const n=e.details;return(n==null?void 0:n.live)&&n.type!=="EVENT"&&(this.levelLastLoaded!==e||n.expired)}flushMainBuffer(e,n,i=null){if(!(e-n))return;const r={startOffset:e,endOffset:n,type:i};this.hls.trigger(C.BUFFER_FLUSHING,r)}_loadInitSegment(e,n){this._doFragLoad(e,n).then(i=>{const r=i==null?void 0:i.frag;if(!r||this.fragContextChanged(r)||!this.levels)throw new Error("init load aborted");return i}).then(i=>{const{hls:r}=this,{frag:s,payload:o}=i,a=s.decryptdata;if(o&&o.byteLength>0&&a!=null&&a.key&&a.iv&&Gl(a.method)){const l=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),a.key.buffer,a.iv.buffer,eE(a.method)).catch(u=>{throw r.trigger(C.ERROR,{type:He.MEDIA_ERROR,details:Q.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:s}),u}).then(u=>{const c=self.performance.now();return r.trigger(C.FRAG_DECRYPTED,{frag:s,payload:u,stats:{tstart:l,tdecrypt:c}}),i.payload=u,this.completeInitSegmentLoad(i)})}return this.completeInitSegmentLoad(i)}).catch(i=>{this.state===ae.STOPPED||this.state===ae.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:n}=this;if(!n)throw new Error("init load aborted, missing levels");const i=e.frag.stats;this.state!==ae.STOPPED&&(this.state=ae.IDLE),e.frag.data=new Uint8Array(e.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,n){var i,r;const s=e.tracks;if(s&&!n.encrypted&&((i=s.audio)!=null&&i.encrypted||(r=s.video)!=null&&r.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const o=this.media,a=new Error(`Encrypted track with no key in ${this.fragInfo(n)} (media ${o?"attached mediaKeys: "+o.mediaKeys:"detached"})`);return this.warn(a.message),!o||o.mediaKeys?!1:(this.hls.trigger(C.ERROR,{type:He.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_NO_KEYS,fatal:!1,error:a,frag:n}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:n}=this;return!e||!n||e.sn!==n.sn||e.level!==n.level}fragBufferedComplete(e,n){const i=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${n?" part: "+n.index:""} of ${this.fragInfo(e,!1,n)} > buffer:${i?Use.toString(Qe.getBuffered(i)):"(detached)"})`),un(e)){var r;if(e.type!==Pe.SUBTITLE){const o=e.elementaryStreams;if(!Object.keys(o).some(a=>!!o[a])){this.state=ae.IDLE;return}}const s=(r=this.levels)==null?void 0:r[e.level];s!=null&&s.fragmentError&&(this.log(`Resetting level fragment error count of ${s.fragmentError} on frag buffered`),s.fragmentError=0)}this.state=ae.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:n}=this;if(!n)return;const{frag:i,part:r,partsLoaded:s}=e,o=!s||s.length===0||s.some(l=>!l),a=new Zb(i.level,i.sn,i.stats.chunkCount+1,0,r?r.index:-1,!o);n.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,n,i=null,r){var s;this.fragCurrent=e;const o=n.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let a=null;if(e.encrypted&&!((s=e.decryptdata)!=null&&s.key)){if(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=ae.KEY_LOADING,this.fragCurrent=e,a=this.keyLoader.load(e).then(f=>{if(!this.fragContextChanged(f.frag))return this.hls.trigger(C.KEY_LOADED,f),this.state===ae.KEY_LOADING&&(this.state=ae.IDLE),f}),this.hls.trigger(C.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(a=this.keyLoader.loadClear(e,o.encryptedFragments,this.startFragRequested),a&&this.log("[eme] blocking frag load until media-keys acquired"));const l=this.fragPrevious;if(un(e)&&(!l||e.sn!==l.sn)){const f=this.shouldLoadParts(n.details,e.end);f!==this.loadingParts&&(this.log(`LL-Part loading ${f?"ON":"OFF"} loading sn ${l==null?void 0:l.sn}->${e.sn}`),this.loadingParts=f)}if(i=Math.max(e.start,i||0),this.loadingParts&&un(e)){const f=o.partList;if(f&&r){i>o.fragmentEnd&&o.fragmentHint&&(e=o.fragmentHint);const h=this.getNextPart(f,e,i);if(h>-1){const p=f[h];e=this.fragCurrent=p.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${p.index} (${h}/${f.length-1}) of ${this.fragInfo(e,!1,p)}) cc: ${e.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=p.start+p.duration,this.state=ae.FRAG_LOADING;let m;return a?m=a.then(y=>!y||this.fragContextChanged(y.frag)?null:this.doFragPartsLoad(e,p,n,r)).catch(y=>this.handleFragLoadError(y)):m=this.doFragPartsLoad(e,p,n,r).catch(y=>this.handleFragLoadError(y)),this.hls.trigger(C.FRAG_LOADING,{frag:e,part:p,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):m}else if(!e.url||this.loadedEndOfParts(f,i))return Promise.resolve(null)}}if(un(e)&&this.loadingParts){var u;this.log(`LL-Part loading OFF after next part miss @${i.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(u=o.partList)==null?void 0:u.filter(f=>f.loaded).map(f=>`[${f.start}-${f.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+o.startSN+"-"+o.endSN+"]"}, target: ${parseFloat(i.toFixed(3))}`),Ce(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=ae.FRAG_LOADING;const c=this.config.progressive;let d;return c&&a?d=a.then(f=>!f||this.fragContextChanged(f.frag)?null:this.fragmentLoader.load(e,r)).catch(f=>this.handleFragLoadError(f)):d=Promise.all([this.fragmentLoader.load(e,c?r:void 0),a]).then(([f])=>(!c&&r&&r(f),f)).catch(f=>this.handleFragLoadError(f)),this.hls.trigger(C.FRAG_LOADING,{frag:e,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):d}doFragPartsLoad(e,n,i,r){return new Promise((s,o)=>{var a;const l=[],u=(a=i.details)==null?void 0:a.partList,c=d=>{this.fragmentLoader.loadPart(e,d,r).then(f=>{l[d.index]=f;const h=f.part;this.hls.trigger(C.FRAG_LOADED,f);const p=YO(i.details,e.sn,d.index+1)||XO(u,e.sn,d.index+1);if(p)c(p);else return s({frag:e,part:h,partsLoaded:l})}).catch(o)};c(n)})}handleFragLoadError(e){if("data"in e){const n=e.data;n.frag&&n.details===Q.INTERNAL_ABORTED?this.handleFragLoadAborted(n.frag,n.part):n.frag&&n.type===He.KEY_SYSTEM_ERROR?(n.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(n.frag)):this.hls.trigger(C.ERROR,n)}else this.hls.trigger(C.ERROR,{type:He.OTHER_ERROR,details:Q.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const n=this.getCurrentContext(e);if(!n||this.state!==ae.PARSING){!this.fragCurrent&&this.state!==ae.STOPPED&&this.state!==ae.ERROR&&(this.state=ae.IDLE);return}const{frag:i,part:r,level:s}=n,o=self.performance.now();i.stats.parsing.end=o,r&&(r.stats.parsing.end=o);const a=this.getLevelDetails(),u=a&&i.sn>a.endSN||this.shouldLoadParts(a,i.end);u!==this.loadingParts&&(this.log(`LL-Part loading ${u?"ON":"OFF"} after parsing segment ending @${i.end.toFixed(2)}`),this.loadingParts=u),this.updateLevelTiming(i,r,s,e.partial)}shouldLoadParts(e,n){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var i;const s=e.partList[0];if(s.fragment.type===Pe.SUBTITLE)return!1;const o=s.end+(((i=e.fragmentHint)==null?void 0:i.duration)||0);if(n>=o){var r;if((this.hls.hasEnoughToStart?((r=this.media)==null?void 0:r.currentTime)||this.lastCurrentTime:this.getLoadPosition())>s.start-s.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:n,fragCurrent:i}=this,{level:r,sn:s,part:o}=e;if(!(n!=null&&n[r]))return this.warn(`Levels object was unset while buffering fragment ${s} of ${this.playlistLabel()} ${r}. The current chunk will not be buffered.`),null;const a=n[r],l=a.details,u=o>-1?YO(l,s,o):null,c=u?u.fragment:KO(l,s,i);return c?(i&&i!==c&&(c.stats=i.stats),{frag:c,part:u,level:a}):null}bufferFragmentData(e,n,i,r,s){if(this.state!==ae.PARSING)return;const{data1:o,data2:a}=e;let l=o;if(a&&(l=$i(o,a)),!l.length)return;const u=this.initPTS[n.cc],c=u?-u.baseTime/u.timescale:void 0,d={type:e.type,frag:n,part:i,chunkMeta:r,offset:c,parent:n.type,data:l};if(this.hls.trigger(C.BUFFER_APPENDING,d),e.dropped&&e.independent&&!i){if(s)return;this.flushBufferGap(n)}}flushBufferGap(e){const n=this.media;if(!n)return;if(!Qe.isBuffered(n,n.currentTime)){this.flushMainBuffer(0,e.start);return}const i=n.currentTime,r=Qe.bufferInfo(n,i,0),s=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),a=Math.max(Math.min(e.start-o,r.end-o),i+o);e.start-a>o&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,n){var i;const r=this.getLoadPosition();if(!Ce(r))return null;const o=this.lastCurrentTime>r||(i=this.media)!=null&&i.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,r,n,o)}getFwdBufferInfoAtPos(e,n,i,r){const s=Qe.bufferInfo(e,n,r);if(s.len===0&&s.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(n,i);if(o&&(s.nextStart<=o.end||o.gap)){const a=Math.max(Math.min(s.nextStart,o.end)-n,r);return Qe.bufferInfo(e,n,a)}}return s}getMaxBufferLength(e){const{config:n}=this;let i;return e?i=Math.max(8*n.maxBufferSize/e,n.maxBufferLength):i=n.maxBufferLength,Math.min(i,n.maxMaxBufferLength)}reduceMaxBufferLength(e,n){const i=this.config,r=Math.max(Math.min(e-n,i.maxBufferLength),n),s=Math.max(e-n*3,i.maxMaxBufferLength/2,r);return s>=r?(i.maxMaxBufferLength=s,this.warn(`Reduce max buffer length to ${s}s`),!0):!1}getAppendedFrag(e,n=Pe.MAIN){const i=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,n):null;return i&&"fragment"in i?i.fragment:i}getNextFragment(e,n){const i=n.fragments,r=i.length;if(!r)return null;const{config:s}=this,o=i[0].start,a=s.lowLatencyMode&&!!n.partList;let l=null;if(n.live){const d=s.initialLiveManifestSize;if(r<d)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${d})`),null;if(!n.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o){var u;a&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),l=this.getInitialLiveFragment(n);const f=this.hls.startPosition,h=this.hls.liveSyncPosition,p=l?(f!==-1&&f>=o?f:h)||l.start:e;this.log(`Setting startPosition to ${p} to match start frag at live edge. mainStart: ${f} liveSyncPosition: ${h} frag.start: ${(u=l)==null?void 0:u.start}`),this.startPosition=this.nextLoadPosition=p}}else e<=o&&(l=i[0]);if(!l){const d=this.loadingParts?n.partEnd:n.fragmentEnd;l=this.getFragmentAtPosition(e,d,n)}let c=this.filterReplacedPrimary(l,n);if(!c&&l){const d=l.sn-n.startSN;c=this.filterReplacedPrimary(i[d+1]||null,n)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(e,n){const i=this.fragmentTracker.getState(e);return(i===mn.OK||i===mn.PARTIAL&&!!e.gap)&&this.nextLoadPosition>n}getNextFragmentLoopLoading(e,n,i,r,s){let o=null;if(e.gap&&(o=this.getNextFragment(this.nextLoadPosition,n),o&&!o.gap&&i.nextStart)){const a=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,r,0);if(a!==null&&i.len+a.len>=s){const l=o.sn;return this.loopSn!==l&&(this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${l}`),this.loopSn=l),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(nN(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,n){if(!e)return e;if(nN(this.config)&&e.type!==Pe.SUBTITLE){const i=this.hls.interstitialsManager,r=i==null?void 0:i.bufferingItem;if(r){const o=r.event;if(o){if(o.appendInPlace||Math.abs(e.start-r.start)>1||r.start===0)return null}else if(e.end<=r.start&&(n==null?void 0:n.live)===!1||e.start>r.end&&r.nextEvent&&(r.nextEvent.appendInPlace||e.start-r.end>1))return null}const s=i==null?void 0:i.playerQueue;if(s)for(let o=s.length;o--;){const a=s[o].interstitial;if(a.appendInPlace&&e.start>=a.startTime&&e.end<=a.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,n,i){let r=-1,s=!1,o=!0;for(let a=0,l=e.length;a<l;a++){const u=e[a];if(o=o&&!u.independent,r>-1&&i<u.start)break;const c=u.loaded;c?r=-1:(s||(u.independent||o)&&u.fragment===n)&&(u.fragment!==n&&this.warn(`Need buffer at ${i} but next unloaded part starts at ${u.start}`),r=a),s=c}return r}loadedEndOfParts(e,n){let i;for(let r=e.length;r--;){if(i=e[r],!i.loaded)return!1;if(n>i.start)return!0}return!1}getInitialLiveFragment(e){const n=e.fragments,i=this.fragPrevious;let r=null;if(i){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),r=tse(n,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const s=i.sn+1;if(s>=e.startSN&&s<=e.endSN){const o=n[s-e.startSN];i.cc===o.cc&&(r=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=fO(e,i.cc,i.end),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const s=this.hls.liveSyncPosition;s!==null&&(r=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,n,i){const{config:r}=this;let{fragPrevious:s}=this,{fragments:o,endSN:a}=i;const{fragmentHint:l}=i,{maxFragLookUpTolerance:u}=r,c=i.partList,d=!!(this.loadingParts&&c!=null&&c.length&&l);d&&!this.bitrateTest&&c[c.length-1].fragment.sn===l.sn&&(o=o.concat(l),a=l.sn);let f;if(e<n){var h;const m=e<this.lastCurrentTime||e>n-u||(h=this.media)!=null&&h.paused||!this.startFragRequested?0:u;f=da(s,o,e,m)}else f=o[o.length-1];if(f){const p=f.sn-i.startSN,m=this.fragmentTracker.getState(f);if((m===mn.OK||m===mn.PARTIAL&&f.gap)&&(s=f),s&&f.sn===s.sn&&(!d||c[0].fragment.sn>f.sn||!i.live)&&f.level===s.level){const g=o[p+1];f.sn<a&&this.fragmentTracker.getState(g)!==mn.OK?f=g:f=null}}return f}alignPlaylists(e,n,i){const r=e.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;const s=e.fragmentStart,o=!n,a=e.alignedSliding&&Ce(s);if(o||!a&&!s){Bse(i,e);const l=e.fragmentStart;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${n?n.startSN:"na"}->${e.startSN} fragments: ${r}`),l}return s}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,n){let i=this.startPosition;i<n&&(i=-1);const r=this.timelineOffset;if(i===-1){const s=this.startTimeOffset!==null,o=s?this.startTimeOffset:e.startTimeOffset;o!==null&&Ce(o)?(i=n+o,o<0&&(i+=e.edge),i=Math.min(Math.max(n,i),n+e.totalduration),this.log(`Setting startPosition to ${i} for start time offset ${o} found in ${s?"multivariant":"media"} playlist`),this.startPosition=i):e.live?(i=this.hls.liveSyncPosition||n,this.log(`Setting startPosition to -1 to start at live edge ${i}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=i=0),this.lastCurrentTime=i+r}this.nextLoadPosition=i+r}getLoadPosition(){var e;const{media:n}=this;let i=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&n?i=n.currentTime:this.nextLoadPosition>=0&&(i=this.nextLoadPosition),i}handleFragLoadAborted(e,n){this.transmuxer&&e.type===this.playlistType&&un(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${n?" part "+n.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==ae.FRAG_LOADING_WAITING_RETRY)&&(this.state=ae.IDLE)}onFragmentOrKeyLoadError(e,n){var i;if(n.chunkMeta&&!n.frag){const g=this.getCurrentContext(n.chunkMeta);g&&(n.frag=g.frag)}const r=n.frag;if(!r||r.type!==e||!this.levels)return;if(this.fragContextChanged(r)){var s;this.warn(`Frag load error must match current frag to retry ${r.url} > ${(s=this.fragCurrent)==null?void 0:s.url}`);return}const o=n.details===Q.FRAG_GAP;o&&this.fragmentTracker.fragBuffered(r,!0);const a=n.errorAction;if(!a){this.state=ae.ERROR;return}const{action:l,flags:u,retryCount:c=0,retryConfig:d}=a,f=!!d,h=f&&l===Cn.RetryRequest,p=f&&!a.resolved&&u===Ti.MoveAllAlternatesMatchingHost,m=(i=this.hls.latestLevelDetails)==null?void 0:i.live;if(!h&&p&&un(r)&&!r.endList&&m&&!pO(n))this.resetFragmentErrors(e),this.treatAsGap(r),a.resolved=!0;else if((h||p)&&c<d.maxNumRetry){var y;const g=Xb((y=n.response)==null?void 0:y.code),v=Yb(d,c);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+v,this.state=ae.FRAG_LOADING_WAITING_RETRY,a.resolved=!0,g){this.log("Waiting for connection (offline)"),this.retryDate=1/0,n.reason="offline";return}this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${n.details}, retrying loading ${c+1}/${d.maxNumRetry} in ${v}ms`)}else if(d)if(this.resetFragmentErrors(e),c<d.maxNumRetry)!o&&l!==Cn.RemoveAlternatePermanently&&(a.resolved=!0);else{this.warn(`${n.details} reached or exceeded max retry (${c})`);return}else l===Cn.SendAlternateToPenaltyBox?this.state=ae.WAITING_LEVEL:this.state=ae.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),n=this.retryDate,i=n===1/0;(!n||e>=n||i&&!Xb(0))&&(i&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=ae.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===ae.PARSING||this.state===ae.PARSED){const n=e.frag,i=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,i),s=r&&r.len>.5;s&&this.reduceMaxBufferLength(r.len,(n==null?void 0:n.duration)||10);const o=!s;return o&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${i} buffer`),n&&(this.fragmentTracker.removeFragment(n),this.nextLoadPosition=n.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===Pe.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==ae.STOPPED&&(this.state=ae.IDLE)}afterBufferFlushed(e,n,i){if(!e)return;const r=Qe.getBuffered(e);this.fragmentTracker.detectEvictedFragments(n,r,i),this.state===ae.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==ae.STOPPED&&(this.state=ae.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,n=e?e.details:null;n!=null&&n.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(n,n.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,n,i,r){const s=i.details;if(!s){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,u)=>{const c=e.elementaryStreams[u];if(c){const d=c.endPTS-c.startPTS;if(d<=0)return this.warn(`Could not parse fragment ${e.sn} ${u} duration reliably (${d})`),l||!1;const f=r?0:GO(s,e,c.startPTS,c.endPTS,c.startDTS,c.endDTS,this);return this.hls.trigger(C.LEVEL_PTS_UPDATED,{details:s,level:i,drift:f,type:u,frag:e,start:c.startPTS,end:c.endPTS}),!0}return l},!1)){var a;if(i.fragmentError===0&&this.treatAsGap(e,i),((a=this.transmuxer)==null?void 0:a.error)===null){const l=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(l.message),this.hls.trigger(C.ERROR,{type:He.MEDIA_ERROR,details:Q.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=ae.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${n?" part: "+n.index:""} of ${this.fragInfo(e,!1,n)})`),this.hls.trigger(C.FRAG_PARSED,{frag:e,part:n})}playlistLabel(){return this.playlistType===Pe.MAIN?"level":"track"}fragInfo(e,n=!0,i){var r,s;return`${this.playlistLabel()} ${e.level} (${i?"part":"frag"}:[${((r=n&&!i?e.startPTS:(i||e).start)!=null?r:NaN).toFixed(3)}-${((s=n&&!i?e.endPTS:(i||e).end)!=null?s:NaN).toFixed(3)}]${i&&e.type==="main"?"INDEPENDENT="+(i.independent?"YES":"NO"):""}`}treatAsGap(e,n){n&&n.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const n=this._state;n!==e&&(this._state=e,this.log(`${n}->${e}`))}get state(){return this._state}}function nN(t){return!!t.interstitialsController&&t.enableInterstitialPlayback!==!1}class iN{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:n}=this;let i;if(e.length)e.length===1?i=e[0]:i=Hse(e,n);else return new Uint8Array(0);return this.reset(),i}reset(){this.chunks.length=0,this.dataLength=0}}function Hse(t,e){const n=new Uint8Array(e);let i=0;for(let r=0;r<t.length;r++){const s=t[r];n.set(s,i),i+=s.length}return n}var uE={exports:{}},rN;function $se(){return rN||(rN=1,function(t){var e=Object.prototype.hasOwnProperty,n="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(n=!1));function r(l,u,c){this.fn=l,this.context=u,this.once=c||!1}function s(l,u,c,d,f){if(typeof c!="function")throw new TypeError("The listener must be a function");var h=new r(c,d||l,f),p=n?n+u:u;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],h]:l._events[p].push(h):(l._events[p]=h,l._eventsCount++),l}function o(l,u){--l._eventsCount===0?l._events=new i:delete l._events[u]}function a(){this._events=new i,this._eventsCount=0}a.prototype.eventNames=function(){var u=[],c,d;if(this._eventsCount===0)return u;for(d in c=this._events)e.call(c,d)&&u.push(n?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},a.prototype.listeners=function(u){var c=n?n+u:u,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,h=d.length,p=new Array(h);f<h;f++)p[f]=d[f].fn;return p},a.prototype.listenerCount=function(u){var c=n?n+u:u,d=this._events[c];return d?d.fn?1:d.length:0},a.prototype.emit=function(u,c,d,f,h,p){var m=n?n+u:u;if(!this._events[m])return!1;var y=this._events[m],g=arguments.length,v,b;if(y.fn){switch(y.once&&this.removeListener(u,y.fn,void 0,!0),g){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,c),!0;case 3:return y.fn.call(y.context,c,d),!0;case 4:return y.fn.call(y.context,c,d,f),!0;case 5:return y.fn.call(y.context,c,d,f,h),!0;case 6:return y.fn.call(y.context,c,d,f,h,p),!0}for(b=1,v=new Array(g-1);b<g;b++)v[b-1]=arguments[b];y.fn.apply(y.context,v)}else{var T=y.length,S;for(b=0;b<T;b++)switch(y[b].once&&this.removeListener(u,y[b].fn,void 0,!0),g){case 1:y[b].fn.call(y[b].context);break;case 2:y[b].fn.call(y[b].context,c);break;case 3:y[b].fn.call(y[b].context,c,d);break;case 4:y[b].fn.call(y[b].context,c,d,f);break;default:if(!v)for(S=1,v=new Array(g-1);S<g;S++)v[S-1]=arguments[S];y[b].fn.apply(y[b].context,v)}}return!0},a.prototype.on=function(u,c,d){return s(this,u,c,d,!1)},a.prototype.once=function(u,c,d){return s(this,u,c,d,!0)},a.prototype.removeListener=function(u,c,d,f){var h=n?n+u:u;if(!this._events[h])return this;if(!c)return o(this,h),this;var p=this._events[h];if(p.fn)p.fn===c&&(!f||p.once)&&(!d||p.context===d)&&o(this,h);else{for(var m=0,y=[],g=p.length;m<g;m++)(p[m].fn!==c||f&&!p[m].once||d&&p[m].context!==d)&&y.push(p[m]);y.length?this._events[h]=y.length===1?y[0]:y:o(this,h)}return this},a.prototype.removeAllListeners=function(u){var c;return u?(c=n?n+u:u,this._events[c]&&o(this,c)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,t.exports=a}(uE)),uE.exports}var zse=$se(),cE=hre(zse);const yd="1.6.13",jl={};function Vse(){return typeof __HLS_WORKER_BUNDLE__=="function"}function Gse(){const t=jl[yd];if(t)return t.clientCount++,t;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),n=self.URL.createObjectURL(e),r={worker:new self.Worker(n),objectURL:n,clientCount:1};return jl[yd]=r,r}function jse(t){const e=jl[t];if(e)return e.clientCount++,e;const n=new self.URL(t,self.location.href).href,r={worker:new self.Worker(n),scriptURL:n,clientCount:1};return jl[t]=r,r}function Wse(t){const e=jl[t||yd];if(e&&e.clientCount--===1){const{worker:i,objectURL:r}=e;delete jl[t||yd],r&&self.URL.revokeObjectURL(r),i.terminate()}}function sN(t,e){return e+10<=t.length&&t[e]===51&&t[e+1]===68&&t[e+2]===73&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128}function dE(t,e){return e+10<=t.length&&t[e]===73&&t[e+1]===68&&t[e+2]===51&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128}function Xp(t,e){let n=0;return n=(t[e]&127)<<21,n|=(t[e+1]&127)<<14,n|=(t[e+2]&127)<<7,n|=t[e+3]&127,n}function vd(t,e){const n=e;let i=0;for(;dE(t,e);){i+=10;const r=Xp(t,e+6);i+=r,sN(t,e+10)&&(i+=10),e+=i}if(i>0)return t.subarray(n,n+i)}function qse(t,e,n,i){const r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],s=e[n+2],o=s>>2&15;if(o>12){const h=new Error(`invalid ADTS sampling index:${o}`);t.emit(C.ERROR,C.ERROR,{type:He.MEDIA_ERROR,details:Q.FRAG_PARSING_ERROR,fatal:!0,error:h,reason:h.message});return}const a=(s>>6&3)+1,l=e[n+3]>>6&3|(s&1)<<2,u="mp4a.40."+a,c=r[o];let d=o;(a===5||a===29)&&(d-=3);const f=[a<<3|(d&14)>>1,(d&1)<<7|l<<3];return Et.log(`manifest codec:${i}, parsed codec:${u}, channels:${l}, rate:${c} (ADTS object type:${a} sampling index:${o})`),{config:f,samplerate:c,channelCount:l,codec:u,parsedCodec:u,manifestCodec:i}}function oN(t,e){return t[e]===255&&(t[e+1]&246)===240}function aN(t,e){return t[e+1]&1?7:9}function fE(t,e){return(t[e+3]&3)<<11|t[e+4]<<3|(t[e+5]&224)>>>5}function Kse(t,e){return e+5<t.length}function Qp(t,e){return e+1<t.length&&oN(t,e)}function Yse(t,e){return Kse(t,e)&&oN(t,e)&&fE(t,e)<=t.length-e}function Xse(t,e){if(Qp(t,e)){const n=aN(t,e);if(e+n>=t.length)return!1;const i=fE(t,e);if(i<=n)return!1;const r=e+i;return r===t.length||Qp(t,r)}return!1}function lN(t,e,n,i,r){if(!t.samplerate){const s=qse(e,n,i,r);if(!s)return;xt(t,s)}}function uN(t){return 1024*9e4/t}function Qse(t,e){const n=aN(t,e);if(e+n<=t.length){const i=fE(t,e)-n;if(i>0)return{headerLength:n,frameLength:i}}}function cN(t,e,n,i,r){const s=uN(t.samplerate),o=i+r*s,a=Qse(e,n);let l;if(a){const{frameLength:d,headerLength:f}=a,h=f+d,p=Math.max(0,n+h-e.length);p?(l=new Uint8Array(h-f),l.set(e.subarray(n+f,e.length),0)):l=e.subarray(n+f,n+h);const m={unit:l,pts:o};return p||t.samples.push(m),{sample:m,length:h,missing:p}}const u=e.length-n;return l=new Uint8Array(u),l.set(e.subarray(n,e.length),0),{sample:{unit:l,pts:o},length:u,missing:-1}}function Zse(t,e){return dE(t,e)&&Xp(t,e+6)+10<=t.length-e}function Jse(t){return t instanceof ArrayBuffer?t:t.byteOffset==0&&t.byteLength==t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer}function hE(t,e=0,n=1/0){return eoe(t,e,n,Uint8Array)}function eoe(t,e,n,i){const r=toe(t);let s=1;"BYTES_PER_ELEMENT"in i&&(s=i.BYTES_PER_ELEMENT);const o=noe(t)?t.byteOffset:0,a=(o+t.byteLength)/s,l=(o+e)/s,u=Math.floor(Math.max(0,Math.min(l,a))),c=Math.floor(Math.min(u+Math.max(n,0),a));return new i(r,u,c-u)}function toe(t){return t instanceof ArrayBuffer?t:t.buffer}function noe(t){return t&&t.buffer instanceof ArrayBuffer&&t.byteLength!==void 0&&t.byteOffset!==void 0}function ioe(t){const e={key:t.type,description:"",data:"",mimeType:null,pictureType:null},n=3;if(t.size<2)return;if(t.data[0]!==n){console.log("Ignore frame with unrecognized character encoding");return}const i=t.data.subarray(1).indexOf(0);if(i===-1)return;const r=Ei(hE(t.data,1,i)),s=t.data[2+i],o=t.data.subarray(3+i).indexOf(0);if(o===-1)return;const a=Ei(hE(t.data,3+i,o));let l;return r==="-->"?l=Ei(hE(t.data,4+i+o)):l=Jse(t.data.subarray(4+i+o)),e.mimeType=r,e.pictureType=s,e.description=a,e.data=l,e}function roe(t){if(t.size<2)return;const e=Ei(t.data,!0),n=new Uint8Array(t.data.subarray(e.length+1));return{key:t.type,info:e,data:n.buffer}}function soe(t){if(t.size<2)return;if(t.type==="TXXX"){let n=1;const i=Ei(t.data.subarray(n),!0);n+=i.length+1;const r=Ei(t.data.subarray(n));return{key:t.type,info:i,data:r}}const e=Ei(t.data.subarray(1));return{key:t.type,info:"",data:e}}function ooe(t){if(t.type==="WXXX"){if(t.size<2)return;let n=1;const i=Ei(t.data.subarray(n),!0);n+=i.length+1;const r=Ei(t.data.subarray(n));return{key:t.type,info:i,data:r}}const e=Ei(t.data);return{key:t.type,info:"",data:e}}function aoe(t){return t.type==="PRIV"?roe(t):t.type[0]==="W"?ooe(t):t.type==="APIC"?ioe(t):soe(t)}function loe(t){const e=String.fromCharCode(t[0],t[1],t[2],t[3]),n=Xp(t,4),i=10;return{type:e,size:n,data:t.subarray(i,i+n)}}const Zp=10,uoe=10;function dN(t){let e=0;const n=[];for(;dE(t,e);){const i=Xp(t,e+6);t[e+5]>>6&1&&(e+=Zp),e+=Zp;const r=e+i;for(;e+uoe<r;){const s=loe(t.subarray(e)),o=aoe(s);o&&n.push(o),e+=s.size+Zp}sN(t,e)&&(e+=Zp)}return n}function fN(t){return t&&t.key==="PRIV"&&t.info==="com.apple.streaming.transportStreamTimestamp"}function coe(t){if(t.data.byteLength===8){const e=new Uint8Array(t.data),n=e[3]&1;let i=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return i/=45,n&&(i+=4772185884e-2),Math.round(i)}}function pE(t){const e=dN(t);for(let n=0;n<e.length;n++){const i=e[n];if(fN(i))return coe(i)}}let Si=function(t){return t.audioId3="org.id3",t.dateRange="com.apple.quicktime.HLS",t.emsg="https://aomedia.org/emsg/ID3",t.misbklv="urn:misb:KLV:bin:1910.1",t}({});function kr(t="",e=9e4){return{type:t,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class mE{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,n,i,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,n){return!1}appendFrame(e,n,i){}demux(e,n){this.cachedData&&(e=$i(this.cachedData,e),this.cachedData=null);let i=vd(e,0),r=i?i.length:0,s;const o=this._audioTrack,a=this._id3Track,l=i?pE(i):void 0,u=e.length;for((this.basePTS===null||this.frameIndex===0&&Ce(l))&&(this.basePTS=doe(l,n,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Si.audioId3,duration:Number.POSITIVE_INFINITY});r<u;){if(this.canParse(e,r)){const c=this.appendFrame(o,e,r);c?(this.frameIndex++,this.lastPTS=c.sample.pts,r+=c.length,s=r):r=u}else Zse(e,r)?(i=vd(e,r),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Si.audioId3,duration:Number.POSITIVE_INFINITY}),r+=i.length,s=r):r++;if(r===u&&s!==u){const c=e.slice(s);this.cachedData?this.cachedData=$i(this.cachedData,c):this.cachedData=c}}return{audioTrack:o,videoTrack:kr(),id3Track:a,textTrack:kr()}}demuxSampleAes(e,n,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const n=this.cachedData;return n&&(this.cachedData=null,this.demux(n,0)),{audioTrack:this._audioTrack,videoTrack:kr(),id3Track:this._id3Track,textTrack:kr()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const doe=(t,e,n)=>{if(Ce(t))return t*90;const i=n?n.baseTime*9e4/n.timescale:0;return e*9e4+i};let Jp=null;const foe=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],hoe=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],poe=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],moe=[0,1,1,4];function hN(t,e,n,i,r){if(n+24>e.length)return;const s=pN(e,n);if(s&&n+s.frameLength<=e.length){const o=s.samplesPerFrame*9e4/s.sampleRate,a=i+r*o,l={unit:e.subarray(n,n+s.frameLength),pts:a,dts:a};return t.config=[],t.channelCount=s.channelCount,t.samplerate=s.sampleRate,t.samples.push(l),{sample:l,length:s.frameLength,missing:0}}}function pN(t,e){const n=t[e+1]>>3&3,i=t[e+1]>>1&3,r=t[e+2]>>4&15,s=t[e+2]>>2&3;if(n!==1&&r!==0&&r!==15&&s!==3){const o=t[e+2]>>1&1,a=t[e+3]>>6,l=n===3?3-i:i===3?3:4,u=foe[l*14+r-1]*1e3,d=hoe[(n===3?0:n===2?1:2)*3+s],f=a===3?1:2,h=poe[n][i],p=moe[i],m=h*8*p,y=Math.floor(h*u/d+o)*p;if(Jp===null){const b=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Jp=b?parseInt(b[1]):0}return!!Jp&&Jp<=87&&i===2&&u>=224e3&&a===0&&(t[e+3]=t[e+3]|128),{sampleRate:d,channelCount:f,frameLength:y,samplesPerFrame:m}}}function gE(t,e){return t[e]===255&&(t[e+1]&224)===224&&(t[e+1]&6)!==0}function mN(t,e){return e+1<t.length&&gE(t,e)}function goe(t,e){return gE(t,e)&&4<=t.length-e}function gN(t,e){if(e+1<t.length&&gE(t,e)){const i=pN(t,e);let r=4;i!=null&&i.frameLength&&(r=i.frameLength);const s=e+r;return s===t.length||mN(t,s)}return!1}class yoe extends mE{constructor(e,n){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=n}resetInitSegment(e,n,i,r){super.resetInitSegment(e,n,i,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:n,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e,n){if(!e)return!1;const i=vd(e,0);let r=(i==null?void 0:i.length)||0;if(gN(e,r))return!1;for(let s=e.length;r<s;r++)if(Xse(e,r))return n.log("ADTS sync word found !"),!0;return!1}canParse(e,n){return Yse(e,n)}appendFrame(e,n,i){lN(e,this.observer,n,i,e.manifestCodec);const r=cN(e,n,i,this.basePTS,this.frameIndex);if(r&&r.missing===0)return r}}const yN=(t,e)=>{let n=0,i=5;e+=i;const r=new Uint32Array(1),s=new Uint32Array(1),o=new Uint8Array(1);for(;i>0;){o[0]=t[e];const a=Math.min(i,8),l=8-a;s[0]=4278190080>>>24+l<<l,r[0]=(o[0]&s[0])>>l,n=n?n<<a|r[0]:r[0],e+=1,i-=a}return n};class voe extends mE{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,n,i,r){super.resetInitSegment(e,n,i,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:n,duration:r,inputTimeScale:9e4,dropped:0}}canParse(e,n){return n+64<e.length}appendFrame(e,n,i){const r=vN(e,n,i,this.basePTS,this.frameIndex);if(r!==-1)return{sample:e.samples[e.samples.length-1],length:r,missing:0}}static probe(e){if(!e)return!1;const n=vd(e,0);if(!n)return!1;const i=n.length;return e[i]===11&&e[i+1]===119&&pE(n)!==void 0&&yN(e,i)<16}}function vN(t,e,n,i,r){if(n+8>e.length||e[n]!==11||e[n+1]!==119)return-1;const s=e[n+4]>>6;if(s>=3)return-1;const a=[48e3,44100,32e3][s],l=e[n+4]&63,c=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+s]*2;if(n+c>e.length)return-1;const d=e[n+6]>>5;let f=0;d===2?f+=2:(d&1&&d!==1&&(f+=2),d&4&&(f+=2));const h=(e[n+6]<<8|e[n+7])>>12-f&1,m=[2,1,2,3,3,4,4,5][d]+h,y=e[n+5]>>3,g=e[n+5]&7,v=new Uint8Array([s<<6|y<<1|g>>2,(g&3)<<6|d<<3|h<<2|l>>4,l<<4&224]),b=1536/a*9e4,T=i+r*b,S=e.subarray(n,n+c);return t.config=v,t.channelCount=m,t.samplerate=a,t.samples.push({unit:S,pts:T}),c}class boe extends mE{resetInitSegment(e,n,i,r){super.resetInitSegment(e,n,i,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:n,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const n=vd(e,0);let i=(n==null?void 0:n.length)||0;if(n&&e[i]===11&&e[i+1]===119&&pE(n)!==void 0&&yN(e,i)<=16)return!1;for(let r=e.length;i<r;i++)if(gN(e,i))return Et.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,n){return goe(e,n)}appendFrame(e,n,i){if(this.basePTS!==null)return hN(e,n,i,this.basePTS,this.frameIndex)}}const Eoe=/\/emsg[-/]ID3/i;class Toe{constructor(e,n){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=n}resetTimeStamp(){}resetInitSegment(e,n,i,r){const s=this.videoTrack=kr("video",1),o=this.audioTrack=kr("audio",1),a=this.txtTrack=kr("text",1);if(this.id3Track=kr("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=jD(e);if(l.video){const{id:u,timescale:c,codec:d,supplemental:f}=l.video;s.id=u,s.timescale=a.timescale=c,s.codec=d,s.supplemental=f}if(l.audio){const{id:u,timescale:c,codec:d}=l.audio;o.id=u,o.timescale=c,o.codec=d}a.id=$D.text,s.sampleDuration=0,s.duration=o.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return vre(e)}demux(e,n){this.timeOffset=n;let i=e;const r=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=$i(this.remainderData,e));const a=_re(i);this.remainderData=a.remainder,r.samples=a.valid||new Uint8Array}else r.samples=i;const o=this.extractID3Track(r,n);return s.samples=KD(n,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,n=this.videoTrack,i=this.txtTrack;n.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(n,this.timeOffset);return i.samples=KD(e,n),{videoTrack:n,audioTrack:kr(),id3Track:r,textTrack:kr()}}extractID3Track(e,n){const i=this.id3Track;if(e.samples.length){const r=ot(e.samples,["emsg"]);r&&r.forEach(s=>{const o=Cre(s);if(Eoe.test(o.schemeIdUri)){const a=bN(o,n);let l=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const u=o.payload;i.samples.push({data:u,len:u.byteLength,dts:a,pts:a,type:Si.emsg,duration:l})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const a=bN(o,n);i.samples.push({data:o.payload,len:o.payload.byteLength,dts:a,pts:a,type:Si.misbklv,duration:Number.POSITIVE_INFINITY})}})}return i}demuxSampleAes(e,n,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function bN(t,e){return Ce(t.presentationTime)?t.presentationTime/t.timeScale:e+t.presentationTimeDelta/t.timeScale}class Soe{constructor(e,n,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new Qb(n,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,uo.cbc)}decryptAacSample(e,n,i){const r=e[n].unit;if(r.length<=16)return;const s=r.subarray(16,r.length-r.length%16),o=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(o).then(a=>{const l=new Uint8Array(a);r.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,n+1,i)}).catch(i)}decryptAacSamples(e,n,i){for(;;n++){if(n>=e.length){i();return}if(!(e[n].unit.length<32)&&(this.decryptAacSample(e,n,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const n=Math.floor((e.length-48)/160)*16+16,i=new Int8Array(n);let r=0;for(let s=32;s<e.length-16;s+=160,r+=16)i.set(e.subarray(s,s+16),r);return i}getAvcDecryptedUnit(e,n){const i=new Uint8Array(n);let r=0;for(let s=32;s<e.length-16;s+=160,r+=16)e.set(i.subarray(r,r+16),s);return e}decryptAvcSample(e,n,i,r,s){const o=YD(s.data),a=this.getAvcEncryptedData(o);this.decryptBuffer(a.buffer).then(l=>{s.data=this.getAvcDecryptedUnit(o,l),this.decrypter.isSync()||this.decryptAvcSamples(e,n,i+1,r)}).catch(r)}decryptAvcSamples(e,n,i,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;n++,i=0){if(n>=e.length){r();return}const s=e[n].units;for(;!(i>=s.length);i++){const o=s[i];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,n,i,r,o),!this.decrypter.isSync()))return}}}}class EN{constructor(){this.VideoSample=null}createVideoSample(e,n,i){return{key:e,frame:!1,pts:n,dts:i,units:[],length:0}}getLastNalUnit(e){var n;let i=this.VideoSample,r;if((!i||i.units.length===0)&&(i=e[e.length-1]),(n=i)!=null&&n.units){const s=i.units;r=s[s.length-1]}return r}pushAccessUnit(e,n){if(e.units.length&&e.frame){if(e.pts===void 0){const i=n.samples,r=i.length;if(r){const s=i[r-1];e.pts=s.pts,e.dts=s.dts}else{n.dropped++;return}}n.samples.push(e)}}parseNALu(e,n,i){const r=n.byteLength;let s=e.naluState||0;const o=s,a=[];let l=0,u,c,d,f=-1,h=0;for(s===-1&&(f=0,h=this.getNALuType(n,0),s=0,l=1);l<r;){if(u=n[l++],!s){s=u?0:1;continue}if(s===1){s=u?0:2;continue}if(!u)s=3;else if(u===1){if(c=l-s-1,f>=0){const p={data:n.subarray(f,c),type:h};a.push(p)}else{const p=this.getLastNalUnit(e.samples);p&&(o&&l<=4-o&&p.state&&(p.data=p.data.subarray(0,p.data.byteLength-o)),c>0&&(p.data=$i(p.data,n.subarray(0,c)),p.state=0))}l<r?(d=this.getNALuType(n,l),f=l,h=d,s=0):s=-1}else s=0}if(f>=0&&s>=0){const p={data:n.subarray(f,r),type:h,state:s};a.push(p)}if(a.length===0){const p=this.getLastNalUnit(e.samples);p&&(p.data=$i(p.data,n))}return e.naluState=s,a}}class bd{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,n=this.bytesAvailable,i=e.byteLength-n,r=new Uint8Array(4),s=Math.min(4,n);if(s===0)throw new Error("no bytes available");r.set(e.subarray(i,i+s)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(e){let n;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,n=e>>3,e-=n<<3,this.bytesAvailable-=n,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let n=Math.min(this.bitsAvailable,e);const i=this.word>>>32-n;if(e>32&&Et.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=n,this.bitsAvailable>0)this.word<<=n;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return n=e-n,n>0&&this.bitsAvailable?i<<n|this.readBits(n):i}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class xoe extends EN{parsePES(e,n,i,r){const s=this.parseNALu(e,i.data,r);let o=this.VideoSample,a,l=!1;i.data=null,o&&s.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),s.forEach(u=>{var c,d;switch(u.type){case 1:{let m=!1;a=!0;const y=u.data;if(l&&y.length>4){const g=this.readSliceType(y);(g===2||g===4||g===7||g===9)&&(m=!0)}if(m){var f;(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.frame=!0,o.key=m;break}case 5:a=!0,(c=o)!=null&&c.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 6:{a=!0,Vb(u.data,1,i.pts,n.samples);break}case 7:{var h,p;a=!0,l=!0;const m=u.data,y=this.readSPS(m);if(!e.sps||e.width!==y.width||e.height!==y.height||((h=e.pixelRatio)==null?void 0:h[0])!==y.pixelRatio[0]||((p=e.pixelRatio)==null?void 0:p[1])!==y.pixelRatio[1]){e.width=y.width,e.height=y.height,e.pixelRatio=y.pixelRatio,e.sps=[m];const g=m.subarray(1,4);let v="avc1.";for(let b=0;b<3;b++){let T=g[b].toString(16);T.length<2&&(T="0"+T),v+=T}e.codec=v}break}case 8:a=!0,e.pps=[u.data];break;case 9:a=!0,e.audFound=!0,(d=o)!=null&&d.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;case 12:a=!0;break;default:a=!1;break}o&&a&&o.units.push(u)}),r&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}getNALuType(e,n){return e[n]&31}readSliceType(e){const n=new bd(e);return n.readUByte(),n.readUEG(),n.readUEG()}skipScalingList(e,n){let i=8,r=8,s;for(let o=0;o<e;o++)r!==0&&(s=n.readEG(),r=(i+s+256)%256),i=r===0?i:r}readSPS(e){const n=new bd(e);let i=0,r=0,s=0,o=0,a,l,u;const c=n.readUByte.bind(n),d=n.readBits.bind(n),f=n.readUEG.bind(n),h=n.readBoolean.bind(n),p=n.skipBits.bind(n),m=n.skipEG.bind(n),y=n.skipUEG.bind(n),g=this.skipScalingList.bind(this);c();const v=c();if(d(5),p(3),c(),y(),v===100||v===110||v===122||v===244||v===44||v===83||v===86||v===118||v===128){const P=f();if(P===3&&p(1),y(),y(),p(1),h())for(l=P!==3?8:12,u=0;u<l;u++)h()&&(u<6?g(16,n):g(64,n))}y();const b=f();if(b===0)f();else if(b===1)for(p(1),m(),m(),a=f(),u=0;u<a;u++)m();y(),p(1);const T=f(),S=f(),_=d(1);_===0&&p(1),p(1),h()&&(i=f(),r=f(),s=f(),o=f());let A=[1,1];if(h()&&h())switch(c()){case 1:A=[1,1];break;case 2:A=[12,11];break;case 3:A=[10,11];break;case 4:A=[16,11];break;case 5:A=[40,33];break;case 6:A=[24,11];break;case 7:A=[20,11];break;case 8:A=[32,11];break;case 9:A=[80,33];break;case 10:A=[18,11];break;case 11:A=[15,11];break;case 12:A=[64,33];break;case 13:A=[160,99];break;case 14:A=[4,3];break;case 15:A=[3,2];break;case 16:A=[2,1];break;case 255:{A=[c()<<8|c(),c()<<8|c()];break}}return{width:Math.ceil((T+1)*16-i*2-r*2),height:(2-_)*(S+1)*16-(_?2:4)*(s+o),pixelRatio:A}}}class woe extends EN{constructor(...e){super(...e),this.initVPS=null}parsePES(e,n,i,r){const s=this.parseNALu(e,i.data,r);let o=this.VideoSample,a,l=!1;i.data=null,o&&s.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),s.forEach(u=>{var c,d;switch(u.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),o.frame=!0,a=!0;break;case 16:case 17:case 18:case 21:if(a=!0,l){var f;(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:a=!0,(c=o)!=null&&c.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 39:a=!0,Vb(u.data,2,i.pts,n.samples);break;case 32:a=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=xt(e.params,this.readVPS(u.data)),this.initVPS=u.data),e.vps=[u.data];break;case 33:if(a=!0,l=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],u.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const h=this.readSPS(u.data);e.width=h.width,e.height=h.height,e.pixelRatio=h.pixelRatio,e.codec=h.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const p in h.params)e.params[p]=h.params[p]}this.pushParameterSet(e.sps,u.data,e.vps),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0;break;case 34:if(a=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const h=this.readPPS(u.data);for(const p in h)e.params[p]=h[p]}this.pushParameterSet(e.pps,u.data,e.vps)}break;case 35:a=!0,e.audFound=!0,(d=o)!=null&&d.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;default:a=!1;break}o&&a&&o.units.push(u)}),r&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}pushParameterSet(e,n,i){(i&&i[0]===this.initVPS||!i&&!e.length)&&e.push(n)}getNALuType(e,n){return(e[n]&126)>>>1}ebsp2rbsp(e){const n=new Uint8Array(e.byteLength);let i=0;for(let r=0;r<e.byteLength;r++)r>=2&&e[r]===3&&e[r-1]===0&&e[r-2]===0||(n[i]=e[r],i++);return new Uint8Array(n.buffer,0,i)}pushAccessUnit(e,n){super.pushAccessUnit(e,n),this.initVPS&&(this.initVPS=null)}readVPS(e){const n=new bd(e);n.readUByte(),n.readUByte(),n.readBits(4),n.skipBits(2),n.readBits(6);const i=n.readBits(3),r=n.readBoolean();return{numTemporalLayers:i+1,temporalIdNested:r}}readSPS(e){const n=new bd(this.ebsp2rbsp(e));n.readUByte(),n.readUByte(),n.readBits(4);const i=n.readBits(3);n.readBoolean();const r=n.readBits(2),s=n.readBoolean(),o=n.readBits(5),a=n.readUByte(),l=n.readUByte(),u=n.readUByte(),c=n.readUByte(),d=n.readUByte(),f=n.readUByte(),h=n.readUByte(),p=n.readUByte(),m=n.readUByte(),y=n.readUByte(),g=n.readUByte(),v=[],b=[];for(let We=0;We<i;We++)v.push(n.readBoolean()),b.push(n.readBoolean());if(i>0)for(let We=i;We<8;We++)n.readBits(2);for(let We=0;We<i;We++)v[We]&&(n.readUByte(),n.readUByte(),n.readUByte(),n.readUByte(),n.readUByte(),n.readUByte(),n.readUByte(),n.readUByte(),n.readUByte(),n.readUByte(),n.readUByte()),b[We]&&n.readUByte();n.readUEG();const T=n.readUEG();T==3&&n.skipBits(1);const S=n.readUEG(),_=n.readUEG(),A=n.readBoolean();let P=0,O=0,x=0,L=0;A&&(P+=n.readUEG(),O+=n.readUEG(),x+=n.readUEG(),L+=n.readUEG());const M=n.readUEG(),V=n.readUEG(),K=n.readUEG(),U=n.readBoolean();for(let We=U?0:i;We<=i;We++)n.skipUEG(),n.skipUEG(),n.skipUEG();if(n.skipUEG(),n.skipUEG(),n.skipUEG(),n.skipUEG(),n.skipUEG(),n.skipUEG(),n.readBoolean()&&n.readBoolean())for(let w=0;w<4;w++)for(let B=0;B<(w===3?2:6);B++)if(!n.readBoolean())n.readUEG();else{const fe=Math.min(64,1<<4+(w<<1));w>1&&n.readEG();for(let de=0;de<fe;de++)n.readEG()}n.readBoolean(),n.readBoolean(),n.readBoolean()&&(n.readUByte(),n.skipUEG(),n.skipUEG(),n.readBoolean());const H=n.readUEG();let Y=0;for(let We=0;We<H;We++){let w=!1;if(We!==0&&(w=n.readBoolean()),w){We===H&&n.readUEG(),n.readBoolean(),n.readUEG();let B=0;for(let Z=0;Z<=Y;Z++){const fe=n.readBoolean();let de=!1;fe||(de=n.readBoolean()),(fe||de)&&B++}Y=B}else{const B=n.readUEG(),Z=n.readUEG();Y=B+Z;for(let fe=0;fe<B;fe++)n.readUEG(),n.readBoolean();for(let fe=0;fe<Z;fe++)n.readUEG(),n.readBoolean()}}if(n.readBoolean()){const We=n.readUEG();for(let w=0;w<We;w++){for(let B=0;B<K+4;B++)n.readBits(1);n.readBits(1)}}let ee=0,ne=1,N=1,le=!0,we=1,ce=0;n.readBoolean(),n.readBoolean();let re=!1;if(n.readBoolean()){if(n.readBoolean()){const Fe=n.readUByte(),_e=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],ht=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Fe>0&&Fe<16?(ne=_e[Fe-1],N=ht[Fe-1]):Fe===255&&(ne=n.readBits(16),N=n.readBits(16))}if(n.readBoolean()&&n.readBoolean(),n.readBoolean()&&(n.readBits(3),n.readBoolean(),n.readBoolean()&&(n.readUByte(),n.readUByte(),n.readUByte())),n.readBoolean()&&(n.readUEG(),n.readUEG()),n.readBoolean(),n.readBoolean(),n.readBoolean(),re=n.readBoolean(),re&&(n.skipUEG(),n.skipUEG(),n.skipUEG(),n.skipUEG()),n.readBoolean()&&(we=n.readBits(32),ce=n.readBits(32),n.readBoolean()&&n.readUEG(),n.readBoolean())){const ht=n.readBoolean(),mt=n.readBoolean();let te=!1;(ht||mt)&&(te=n.readBoolean(),te&&(n.readUByte(),n.readBits(5),n.readBoolean(),n.readBits(5)),n.readBits(4),n.readBits(4),te&&n.readBits(4),n.readBits(5),n.readBits(5),n.readBits(5));for(let oe=0;oe<=i;oe++){le=n.readBoolean();const ke=le||n.readBoolean();let R=!1;ke?n.readEG():R=n.readBoolean();const I=R?1:n.readUEG()+1;if(ht)for(let F=0;F<I;F++)n.readUEG(),n.readUEG(),te&&(n.readUEG(),n.readUEG()),n.skipBits(1);if(mt)for(let F=0;F<I;F++)n.readUEG(),n.readUEG(),te&&(n.readUEG(),n.readUEG()),n.skipBits(1)}}n.readBoolean()&&(n.readBoolean(),n.readBoolean(),n.readBoolean(),ee=n.readUEG())}let $e=S,Ie=_;if(A){let We=1,w=1;T===1?We=w=2:T==2&&(We=2),$e=S-We*O-We*P,Ie=_-w*L-w*x}const Me=r?["A","B","C"][r]:"",Ne=a<<24|l<<16|u<<8|c;let at=0;for(let We=0;We<32;We++)at=(at|(Ne>>We&1)<<31-We)>>>0;let wt=at.toString(16);return o===1&&wt==="2"&&(wt="6"),{codecString:`hvc1.${Me}${o}.${wt}.${s?"H":"L"}${g}.B0`,params:{general_tier_flag:s,general_profile_idc:o,general_profile_space:r,general_profile_compatibility_flags:[a,l,u,c],general_constraint_indicator_flags:[d,f,h,p,m,y],general_level_idc:g,bit_depth:M+8,bit_depth_luma_minus8:M,bit_depth_chroma_minus8:V,min_spatial_segmentation_idc:ee,chroma_format_idc:T,frame_rate:{fixed:le,fps:ce/we}},width:$e,height:Ie,pixelRatio:[ne,N]}}readPPS(e){const n=new bd(this.ebsp2rbsp(e));n.readUByte(),n.readUByte(),n.skipUEG(),n.skipUEG(),n.skipBits(2),n.skipBits(3),n.skipBits(2),n.skipUEG(),n.skipUEG(),n.skipEG(),n.skipBits(2),n.readBoolean()&&n.skipUEG(),n.skipEG(),n.skipEG(),n.skipBits(4);const r=n.readBoolean(),s=n.readBoolean();let o=1;return s&&r?o=0:s?o=3:r&&(o=2),{parallelismType:o}}matchSPS(e,n){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,n).substr(3)}}const En=188;class co{constructor(e,n,i,r){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=n,this.typeSupported=i,this.logger=r,this.videoParser=null}static probe(e,n){const i=co.syncOffset(e);return i>0&&n.warn(`MPEG2-TS detected but first sync word found @ offset ${i}`),i!==-1}static syncOffset(e){const n=e.length;let i=Math.min(En*5,n-En)+1,r=0;for(;r<i;){let s=!1,o=-1,a=0;for(let l=r;l<n;l+=En)if(e[l]===71&&(n-l===En||e[l+En]===71)){if(a++,o===-1&&(o=l,o!==0&&(i=Math.min(o+En*99,e.length-En)+1)),s||(s=yE(e,l)===0),s&&a>1&&(o===0&&a>2||l+En>i))return o}else{if(a)return-1;break}r++}return-1}static createTrack(e,n){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:$D[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?n:void 0}}resetInitSegment(e,n,i,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=co.createTrack("video"),this._videoTrack.duration=r,this._audioTrack=co.createTrack("audio",r),this._id3Track=co.createTrack("id3"),this._txtTrack=co.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=n,this.videoCodec=i}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:n,_id3Track:i}=this;e&&(e.pesData=null),n&&(n.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,n,i=!1,r=!1){i||(this.sampleAes=null);let s;const o=this._videoTrack,a=this._audioTrack,l=this._id3Track,u=this._txtTrack;let c=o.pid,d=o.pesData,f=a.pid,h=l.pid,p=a.pesData,m=l.pesData,y=null,g=this.pmtParsed,v=this._pmtId,b=e.length;if(this.remainderData&&(e=$i(this.remainderData,e),b=e.length,this.remainderData=null),b<En&&!r)return this.remainderData=e,{audioTrack:a,videoTrack:o,id3Track:l,textTrack:u};const T=Math.max(0,co.syncOffset(e));b-=(b-T)%En,b<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,b,e.buffer.byteLength-b));let S=0;for(let A=T;A<b;A+=En)if(e[A]===71){const P=!!(e[A+1]&64),O=yE(e,A),x=(e[A+3]&48)>>4;let L;if(x>1){if(L=A+5+e[A+4],L===A+En)continue}else L=A+4;switch(O){case c:P&&(d&&(s=Wl(d,this.logger))&&(this.readyVideoParser(o.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(o,u,s,!1)),d={data:[],size:0}),d&&(d.data.push(e.subarray(L,A+En)),d.size+=A+En-L);break;case f:if(P){if(p&&(s=Wl(p,this.logger)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,s);break;case"mp3":this.parseMPEGPES(a,s);break;case"ac3":this.parseAC3PES(a,s);break}p={data:[],size:0}}p&&(p.data.push(e.subarray(L,A+En)),p.size+=A+En-L);break;case h:P&&(m&&(s=Wl(m,this.logger))&&this.parseID3PES(l,s),m={data:[],size:0}),m&&(m.data.push(e.subarray(L,A+En)),m.size+=A+En-L);break;case 0:P&&(L+=e[L]+1),v=this._pmtId=_oe(e,L);break;case v:{P&&(L+=e[L]+1);const M=Aoe(e,L,this.typeSupported,i,this.observer,this.logger);c=M.videoPid,c>0&&(o.pid=c,o.segmentCodec=M.segmentVideoCodec),f=M.audioPid,f>0&&(a.pid=f,a.segmentCodec=M.segmentAudioCodec),h=M.id3Pid,h>0&&(l.pid=h),y!==null&&!g&&(this.logger.warn(`MPEG-TS PMT found at ${A} after unknown PID '${y}'. Backtracking to sync byte @${T} to parse all TS packets.`),y=null,A=T-188),g=this.pmtParsed=!0;break}case 17:case 8191:break;default:y=O;break}}else S++;S>0&&vE(this.observer,new Error(`Found ${S} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=d,a.pesData=p,l.pesData=m;const _={audioTrack:a,videoTrack:o,id3Track:l,textTrack:u};return r&&this.extractRemainingSamples(_),_}flush(){const{remainderData:e}=this;this.remainderData=null;let n;return e?n=this.demux(e,-1,!1,!0):n={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(n),this.sampleAes?this.decrypt(n,this.sampleAes):n}extractRemainingSamples(e){const{audioTrack:n,videoTrack:i,id3Track:r,textTrack:s}=e,o=i.pesData,a=n.pesData,l=r.pesData;let u;if(o&&(u=Wl(o,this.logger))?(this.readyVideoParser(i.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(i,s,u,!0),i.pesData=null)):i.pesData=o,a&&(u=Wl(a,this.logger))){switch(n.segmentCodec){case"aac":this.parseAACPES(n,u);break;case"mp3":this.parseMPEGPES(n,u);break;case"ac3":this.parseAC3PES(n,u);break}n.pesData=null}else a!=null&&a.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),n.pesData=a;l&&(u=Wl(l,this.logger))?(this.parseID3PES(r,u),r.pesData=null):r.pesData=l}demuxSampleAes(e,n,i){const r=this.demux(e,i,!0,!this.config.progressive),s=this.sampleAes=new Soe(this.observer,this.config,n);return this.decrypt(r,s)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new xoe:e==="hevc"&&(this.videoParser=new woe))}decrypt(e,n){return new Promise(i=>{const{audioTrack:r,videoTrack:s}=e;r.samples&&r.segmentCodec==="aac"?n.decryptAacSamples(r.samples,0,()=>{s.samples?n.decryptAvcSamples(s.samples,0,0,()=>{i(e)}):i(e)}):s.samples&&n.decryptAvcSamples(s.samples,0,0,()=>{i(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,n){let i=0;const r=this.aacOverFlow;let s=n.data;if(r){this.aacOverFlow=null;const d=r.missing,f=r.sample.unit.byteLength;if(d===-1)s=$i(r.sample.unit,s);else{const h=f-d;r.sample.unit.set(s.subarray(0,d),h),e.samples.push(r.sample),i=r.missing}}let o,a;for(o=i,a=s.length;o<a-1&&!Qp(s,o);o++);if(o!==i){let d;const f=o<a-1;if(f?d=`AAC PES did not start with ADTS header,offset:${o}`:d="No ADTS header found in AAC PES",vE(this.observer,new Error(d),f,this.logger),!f)return}lN(e,this.observer,s,o,this.audioCodec);let l;if(n.pts!==void 0)l=n.pts;else if(r){const d=uN(e.samplerate);l=r.sample.pts+d}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let u=0,c;for(;o<a;)if(c=cN(e,s,o,l,u),o+=c.length,c.missing){this.aacOverFlow=c;break}else for(u++;o<a-1&&!Qp(s,o);o++);}parseMPEGPES(e,n){const i=n.data,r=i.length;let s=0,o=0;const a=n.pts;if(a===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<r;)if(mN(i,o)){const l=hN(e,i,o,a,s);if(l)o+=l.length,s++;else break}else o++}parseAC3PES(e,n){{const i=n.data,r=n.pts;if(r===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const s=i.length;let o=0,a=0,l;for(;a<s&&(l=vN(e,i,a,r,o++))>0;)a+=l}}parseID3PES(e,n){if(n.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const i=xt({},n,{type:this._videoTrack?Si.emsg:Si.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(i)}}function yE(t,e){return((t[e+1]&31)<<8)+t[e+2]}function _oe(t,e){return(t[e+10]&31)<<8|t[e+11]}function Aoe(t,e,n,i,r,s){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},a=(t[e+1]&15)<<8|t[e+2],l=e+3+a-4,u=(t[e+10]&15)<<8|t[e+11];for(e+=12+u;e<l;){const c=yE(t,e),d=(t[e+3]&15)<<8|t[e+4];switch(t[e]){case 207:if(!i){bE("ADTS AAC",s);break}case 15:o.audioPid===-1&&(o.audioPid=c);break;case 21:o.id3Pid===-1&&(o.id3Pid=c);break;case 219:if(!i){bE("H.264",s);break}case 27:o.videoPid===-1&&(o.videoPid=c);break;case 3:case 4:!n.mpeg&&!n.mp3?s.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=c,o.segmentAudioCodec="mp3");break;case 193:if(!i){bE("AC-3",s);break}case 129:n.ac3?o.audioPid===-1&&(o.audioPid=c,o.segmentAudioCodec="ac3"):s.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&d>0){let f=e+5,h=d;for(;h>2;){switch(t[f]){case 106:n.ac3!==!0?s.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=c,o.segmentAudioCodec="ac3");break}const m=t[f+1]+2;f+=m,h-=m}}break;case 194:case 135:return vE(r,new Error("Unsupported EC-3 in M2TS found"),void 0,s),o;case 36:o.videoPid===-1&&(o.videoPid=c,o.segmentVideoCodec="hevc",s.log("HEVC in M2TS found"));break}e+=d+5}return o}function vE(t,e,n,i){i.warn(`parsing error: ${e.message}`),t.emit(C.ERROR,C.ERROR,{type:He.MEDIA_ERROR,details:Q.FRAG_PARSING_ERROR,fatal:!1,levelRetry:n,error:e,reason:e.message})}function bE(t,e){e.log(`${t} with AES-128-CBC encryption found in unencrypted stream`)}function Wl(t,e){let n=0,i,r,s,o,a;const l=t.data;if(!t||t.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=$i(l[0],l[1]),l.splice(1,1);if(i=l[0],(i[0]<<16)+(i[1]<<8)+i[2]===1){if(r=(i[4]<<8)+i[5],r&&r>t.size-6)return null;const c=i[7];c&192&&(o=(i[9]&14)*536870912+(i[10]&255)*4194304+(i[11]&254)*16384+(i[12]&255)*128+(i[13]&254)/2,c&64?(a=(i[14]&14)*536870912+(i[15]&255)*4194304+(i[16]&254)*16384+(i[17]&255)*128+(i[18]&254)/2,o-a>60*9e4&&(e.warn(`${Math.round((o-a)/9e4)}s delta between PTS and DTS, align them`),o=a)):a=o),s=i[8];let d=s+9;if(t.size<=d)return null;t.size-=d;const f=new Uint8Array(t.size);for(let h=0,p=l.length;h<p;h++){i=l[h];let m=i.byteLength;if(d)if(d>m){d-=m;continue}else i=i.subarray(d),m-=d,d=0;f.set(i,n),n+=m}return r&&(r-=s+3),{data:f,pts:o,dts:a,len:r}}return null}class Coe{static getSilentFrame(e,n){switch(e){case"mp4a.40.2":if(n===1)return new Uint8Array([0,200,0,128,35,128]);if(n===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(n===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(n===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(n===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(n===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(n===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(n===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(n===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const fo=Math.pow(2,32)-1;class X{static init(){X.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in X.types)X.types.hasOwnProperty(e)&&(X.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);X.HDLR_TYPES={video:n,audio:i};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);X.STTS=X.STSC=X.STCO=s,X.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),X.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),X.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),X.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);X.FTYP=X.box(X.types.ftyp,o,l,o,a),X.DINF=X.box(X.types.dinf,X.box(X.types.dref,r))}static box(e,...n){let i=8,r=n.length;const s=r;for(;r--;)i+=n[r].byteLength;const o=new Uint8Array(i);for(o[0]=i>>24&255,o[1]=i>>16&255,o[2]=i>>8&255,o[3]=i&255,o.set(e,4),r=0,i=8;r<s;r++)o.set(n[r],i),i+=n[r].byteLength;return o}static hdlr(e){return X.box(X.types.hdlr,X.HDLR_TYPES[e])}static mdat(e){return X.box(X.types.mdat,e)}static mdhd(e,n){n*=e;const i=Math.floor(n/(fo+1)),r=Math.floor(n%(fo+1));return X.box(X.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,r>>24,r>>16&255,r>>8&255,r&255,85,196,0,0]))}static mdia(e){return X.box(X.types.mdia,X.mdhd(e.timescale||0,e.duration||0),X.hdlr(e.type),X.minf(e))}static mfhd(e){return X.box(X.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?X.box(X.types.minf,X.box(X.types.smhd,X.SMHD),X.DINF,X.stbl(e)):X.box(X.types.minf,X.box(X.types.vmhd,X.VMHD),X.DINF,X.stbl(e))}static moof(e,n,i){return X.box(X.types.moof,X.mfhd(e),X.traf(i,n))}static moov(e){let n=e.length;const i=[];for(;n--;)i[n]=X.trak(e[n]);return X.box.apply(null,[X.types.moov,X.mvhd(e[0].timescale||0,e[0].duration||0)].concat(i).concat(X.mvex(e)))}static mvex(e){let n=e.length;const i=[];for(;n--;)i[n]=X.trex(e[n]);return X.box.apply(null,[X.types.mvex,...i])}static mvhd(e,n){n*=e;const i=Math.floor(n/(fo+1)),r=Math.floor(n%(fo+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,r>>24,r>>16&255,r>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return X.box(X.types.mvhd,s)}static sdtp(e){const n=e.samples||[],i=new Uint8Array(4+n.length);let r,s;for(r=0;r<n.length;r++)s=n[r].flags,i[r+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return X.box(X.types.sdtp,i)}static stbl(e){return X.box(X.types.stbl,X.stsd(e),X.box(X.types.stts,X.STTS),X.box(X.types.stsc,X.STSC),X.box(X.types.stsz,X.STSZ),X.box(X.types.stco,X.STCO))}static avc1(e){let n=[],i=[],r,s,o;for(r=0;r<e.sps.length;r++)s=e.sps[r],o=s.byteLength,n.push(o>>>8&255),n.push(o&255),n=n.concat(Array.prototype.slice.call(s));for(r=0;r<e.pps.length;r++)s=e.pps[r],o=s.byteLength,i.push(o>>>8&255),i.push(o&255),i=i.concat(Array.prototype.slice.call(s));const a=X.box(X.types.avcC,new Uint8Array([1,n[3],n[4],n[5],255,224|e.sps.length].concat(n).concat([e.pps.length]).concat(i))),l=e.width,u=e.height,c=e.pixelRatio[0],d=e.pixelRatio[1];return X.box(X.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,X.box(X.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),X.box(X.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,c&255,d>>24,d>>16&255,d>>8&255,d&255])))}static esds(e){const n=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...n,6,1,2])}static audioStsd(e){const n=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,n>>8&255,n&255,0,0])}static mp4a(e){return X.box(X.types.mp4a,X.audioStsd(e),X.box(X.types.esds,X.esds(e)))}static mp3(e){return X.box(X.types[".mp3"],X.audioStsd(e))}static ac3(e){return X.box(X.types["ac-3"],X.audioStsd(e),X.box(X.types.dac3,e.config))}static stsd(e){const{segmentCodec:n}=e;if(e.type==="audio"){if(n==="aac")return X.box(X.types.stsd,X.STSD,X.mp4a(e));if(n==="ac3"&&e.config)return X.box(X.types.stsd,X.STSD,X.ac3(e));if(n==="mp3"&&e.codec==="mp3")return X.box(X.types.stsd,X.STSD,X.mp3(e))}else if(e.pps&&e.sps){if(n==="avc")return X.box(X.types.stsd,X.STSD,X.avc1(e));if(n==="hevc"&&e.vps)return X.box(X.types.stsd,X.STSD,X.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${n}/${e.codec})`)}static tkhd(e){const n=e.id,i=(e.duration||0)*(e.timescale||0),r=e.width||0,s=e.height||0,o=Math.floor(i/(fo+1)),a=Math.floor(i%(fo+1));return X.box(X.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,n&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,a>>24,a>>16&255,a>>8&255,a&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,r&255,0,0,s>>8&255,s&255,0,0]))}static traf(e,n){const i=X.sdtp(e),r=e.id,s=Math.floor(n/(fo+1)),o=Math.floor(n%(fo+1));return X.box(X.types.traf,X.box(X.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255])),X.box(X.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,o>>24,o>>16&255,o>>8&255,o&255])),X.trun(e,i.length+16+20+8+16+8+8),i)}static trak(e){return e.duration=e.duration||4294967295,X.box(X.types.trak,X.tkhd(e),X.mdia(e))}static trex(e){const n=e.id;return X.box(X.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,n){const i=e.samples||[],r=i.length,s=12+16*r,o=new Uint8Array(s);let a,l,u,c,d,f;for(n+=8+s,o.set([e.type==="video"?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,r&255,n>>>24&255,n>>>16&255,n>>>8&255,n&255],0),a=0;a<r;a++)l=i[a],u=l.duration,c=l.size,d=l.flags,f=l.cts,o.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&61440,d.degradPrio&15,f>>>24&255,f>>>16&255,f>>>8&255,f&255],12+16*a);return X.box(X.types.trun,o)}static initSegment(e){X.types||X.init();const n=X.moov(e);return $i(X.FTYP,n)}static hvc1(e){const n=e.params,i=[e.vps,e.sps,e.pps],r=4,s=new Uint8Array([1,n.general_profile_space<<6|(n.general_tier_flag?32:0)|n.general_profile_idc,n.general_profile_compatibility_flags[0],n.general_profile_compatibility_flags[1],n.general_profile_compatibility_flags[2],n.general_profile_compatibility_flags[3],n.general_constraint_indicator_flags[0],n.general_constraint_indicator_flags[1],n.general_constraint_indicator_flags[2],n.general_constraint_indicator_flags[3],n.general_constraint_indicator_flags[4],n.general_constraint_indicator_flags[5],n.general_level_idc,240|n.min_spatial_segmentation_idc>>8,255&n.min_spatial_segmentation_idc,252|n.parallelismType,252|n.chroma_format_idc,248|n.bit_depth_luma_minus8,248|n.bit_depth_chroma_minus8,0,parseInt(n.frame_rate.fps),r-1|n.temporal_id_nested<<2|n.num_temporal_layers<<3|(n.frame_rate.fixed?64:0),i.length]);let o=s.length;for(let p=0;p<i.length;p+=1){o+=3;for(let m=0;m<i[p].length;m+=1)o+=2+i[p][m].length}const a=new Uint8Array(o);a.set(s,0),o=s.length;const l=i.length-1;for(let p=0;p<i.length;p+=1){a.set(new Uint8Array([32+p|(p===l?128:0),0,i[p].length]),o),o+=3;for(let m=0;m<i[p].length;m+=1)a.set(new Uint8Array([i[p][m].length>>8,i[p][m].length&255]),o),o+=2,a.set(i[p][m],o),o+=i[p][m].length}const u=X.box(X.types.hvcC,a),c=e.width,d=e.height,f=e.pixelRatio[0],h=e.pixelRatio[1];return X.box(X.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,c&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,X.box(X.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),X.box(X.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,h>>24,h>>16&255,h>>8&255,h&255])))}}X.types=void 0,X.HDLR_TYPES=void 0,X.STTS=void 0,X.STSC=void 0,X.STCO=void 0,X.STSZ=void 0,X.VMHD=void 0,X.SMHD=void 0,X.STSD=void 0,X.FTYP=void 0,X.DINF=void 0;const TN=9e4;function EE(t,e,n=1,i=!1){const r=t*e*n;return i?Math.round(r):r}function Ioe(t,e,n=1,i=!1){return EE(t,e,1/n,i)}function Ed(t,e=!1){return EE(t,1e3,1/TN,e)}function Roe(t,e=1){return EE(t,TN,1/e)}function SN(t){const{baseTime:e,timescale:n,trackId:i}=t;return`${e/n} (${e}/${n}) trackId: ${i}`}const Loe=10*1e3,Poe=1024,koe=1152,Doe=1536;let ql=null,TE=null;function xN(t,e,n,i){return{duration:e,size:n,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:t?2:1,isNonSync:t?0:1}}}class e0 extends Hi{constructor(e,n,i,r){if(super("mp4-remuxer",r),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=n,this.typeSupported=i,this.ISGenerated=!1,ql===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);ql=o?parseInt(o[1]):0}if(TE===null){const s=navigator.userAgent.match(/Safari\/(\d+)/i);TE=s?parseInt(s[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const n=this._initPTS;(!n||!e||e.trackId!==n.trackId||e.baseTime!==n.baseTime||e.timescale!==n.timescale)&&this.log(`Reset initPTS: ${n&&SN(n)} > ${e&&SN(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let n=!1;const i=e[0].pts,r=e.reduce((s,o)=>{let a=o.pts,l=a-s;return l<-4294967296&&(n=!0,a=xi(a,i),l=a-s),l>0?s:a},i);return n&&this.debug("PTS rollover detected"),r}remux(e,n,i,r,s,o,a,l){let u,c,d,f,h,p,m=s,y=s;const g=e.pid>-1,v=n.pid>-1,b=n.samples.length,T=e.samples.length>0,S=a&&b>0||b>1;if((!g||T)&&(!v||S)||this.ISGenerated||a){if(this.ISGenerated){var A,P,O,x;const K=this.videoTrackConfig;(K&&(n.width!==K.width||n.height!==K.height||((A=n.pixelRatio)==null?void 0:A[0])!==((P=K.pixelRatio)==null?void 0:P[0])||((O=n.pixelRatio)==null?void 0:O[1])!==((x=K.pixelRatio)==null?void 0:x[1]))||!K&&S||this.nextAudioTs===null&&T)&&this.resetInitSegment()}this.ISGenerated||(d=this.generateIS(e,n,s,o));const L=this.isVideoContiguous;let M=-1,V;if(S&&(M=Ooe(n.samples),!L&&this.config.forceKeyFrameOnDiscontinuity))if(p=!0,M>0){this.warn(`Dropped ${M} out of ${b} video samples due to a missing keyframe`);const K=this.getVideoStartPts(n.samples);n.samples=n.samples.slice(M),n.dropped+=M,y+=(n.samples[0].pts-K)/n.inputTimeScale,V=y}else M===-1&&(this.warn(`No keyframe found out of ${b} video samples`),p=!1);if(this.ISGenerated){if(T&&S){const K=this.getVideoStartPts(n.samples),j=(xi(e.samples[0].pts,K)-K)/n.inputTimeScale;m+=Math.max(0,j),y+=Math.max(0,-j)}if(T){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),d=this.generateIS(e,n,s,o)),c=this.remuxAudio(e,m,this.isAudioContiguous,o,v||S||l===Pe.AUDIO?y:void 0),S){const K=c?c.endPTS-c.startPTS:0;n.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),d=this.generateIS(e,n,s,o)),u=this.remuxVideo(n,y,L,K)}}else S&&(u=this.remuxVideo(n,y,L,0));u&&(u.firstKeyFrame=M,u.independent=M!==-1,u.firstKeyFramePTS=V)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(h=wN(i,s,this._initPTS,this._initDTS)),r.samples.length&&(f=_N(r,s,this._initPTS))),{audio:c,video:u,initSegment:d,independent:p,text:f,id3:h}}computeInitPts(e,n,i,r){const s=Math.round(i*n);let o=xi(e,s);if(o<s+n)for(this.log(`Adjusting PTS for rollover in timeline near ${(s-o)/n} ${r}`);o<s+n;)o+=8589934592;return o-s}generateIS(e,n,i,r){const s=e.samples,o=n.samples,a=this.typeSupported,l={},u=this._initPTS;let c=!u||r,d="audio/mp4",f,h,p,m=-1;if(c&&(f=h=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(d="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:d,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&a.mpeg?new Uint8Array(0):X.initSegment([e]),metadata:{channelCount:e.channelCount}},c&&(m=e.id,p=e.inputTimeScale,!u||p!==u.timescale?f=h=this.computeInitPts(s[0].pts,p,i,"audio"):c=!1)}if(n.sps&&n.pps&&o.length){if(n.timescale=n.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:n.codec,initSegment:X.initSegment([n]),metadata:{width:n.width,height:n.height}},c)if(m=n.id,p=n.inputTimeScale,!u||p!==u.timescale){const y=this.getVideoStartPts(o),g=xi(o[0].dts,y),v=this.computeInitPts(g,p,i,"video"),b=this.computeInitPts(y,p,i,"video");h=Math.min(h,v),f=Math.min(f,b)}else c=!1;this.videoTrackConfig={width:n.width,height:n.height,pixelRatio:n.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,c?(u&&this.warn(`Timestamps at playlist time: ${r?"":"~"}${i} ${f/p} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${f/p} (${f}/${p}) trackId: ${m}`),this._initPTS={baseTime:f,timescale:p,trackId:m},this._initDTS={baseTime:h,timescale:p,trackId:m}):f=p=void 0,{tracks:l,initPTS:f,timescale:p,trackId:m}}remuxVideo(e,n,i,r){const s=e.inputTimeScale,o=e.samples,a=[],l=o.length,u=this._initPTS,c=u.baseTime*s/u.timescale;let d=this.nextVideoTs,f=8,h=this.videoSampleDuration,p,m,y=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,v=!1;if(!i||d===null){const ee=c+n*s,ne=o[0].pts-xi(o[0].dts,o[0].pts);ql&&d!==null&&Math.abs(ee-ne-(d+c))<15e3?i=!0:d=ee-ne-c}const b=d+c;for(let ee=0;ee<l;ee++){const ne=o[ee];ne.pts=xi(ne.pts,b),ne.dts=xi(ne.dts,b),ne.dts<o[ee>0?ee-1:ee].dts&&(v=!0)}v&&o.sort(function(ee,ne){const N=ee.dts-ne.dts,le=ee.pts-ne.pts;return N||le}),p=o[0].dts,m=o[o.length-1].dts;const T=m-p,S=T?Math.round(T/(l-1)):h||e.inputTimeScale/30;if(i){const ee=p-b,ne=ee>S,N=ee<-1;if((ne||N)&&(ne?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Ed(ee,!0)} ms (${ee}dts) hole between fragments detected at ${n.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Ed(-ee,!0)} ms (${ee}dts) overlapping between fragments detected at ${n.toFixed(3)}`),!N||b>=o[0].pts||ql)){p=b;const le=o[0].pts-ee;if(ne)o[0].dts=p,o[0].pts=le;else{let we=!0;for(let ce=0;ce<o.length&&!(o[ce].dts>le&&we);ce++){const re=o[ce].pts;if(o[ce].dts-=ee,o[ce].pts-=ee,ce<o.length-1){const Ae=o[ce+1].pts,$e=o[ce].pts,Ie=Ae<=$e,Me=Ae<=re;we=Ie==Me}}}this.log(`Video: Initial PTS/DTS adjusted: ${Ed(le,!0)}/${Ed(p,!0)}, delta: ${Ed(ee,!0)} ms`)}}p=Math.max(0,p);let _=0,A=0,P=p;for(let ee=0;ee<l;ee++){const ne=o[ee],N=ne.units,le=N.length;let we=0;for(let ce=0;ce<le;ce++)we+=N[ce].data.length;A+=we,_+=le,ne.length=we,ne.dts<P?(ne.dts=P,P+=S/4|0||1):P=ne.dts,y=Math.min(ne.pts,y),g=Math.max(ne.pts,g)}m=o[l-1].dts;const O=A+4*_+8;let x;try{x=new Uint8Array(O)}catch(ee){this.observer.emit(C.ERROR,C.ERROR,{type:He.MUX_ERROR,details:Q.REMUX_ALLOC_ERROR,fatal:!1,error:ee,bytes:O,reason:`fail allocating video mdat ${O}`});return}const L=new DataView(x.buffer);L.setUint32(0,O),x.set(X.types.mdat,4);let M=!1,V=Number.POSITIVE_INFINITY,K=Number.POSITIVE_INFINITY,U=Number.NEGATIVE_INFINITY,j=Number.NEGATIVE_INFINITY;for(let ee=0;ee<l;ee++){const ne=o[ee],N=ne.units;let le=0;for(let re=0,Ae=N.length;re<Ae;re++){const $e=N[re],Ie=$e.data,Me=$e.data.byteLength;L.setUint32(f,Me),f+=4,x.set(Ie,f),f+=Me,le+=4+Me}let we;if(ee<l-1)h=o[ee+1].dts-ne.dts,we=o[ee+1].pts-ne.pts;else{const re=this.config,Ae=ee>0?ne.dts-o[ee-1].dts:S;if(we=ee>0?ne.pts-o[ee-1].pts:S,re.stretchShortVideoTrack&&this.nextAudioTs!==null){const $e=Math.floor(re.maxBufferHole*s),Ie=(r?y+r*s:this.nextAudioTs+c)-ne.pts;Ie>$e?(h=Ie-Ae,h<0?h=Ae:M=!0,this.log(`It is approximately ${Ie/90} ms to the next segment; using duration ${h/90} ms for the last video frame.`)):h=Ae}else h=Ae}const ce=Math.round(ne.pts-ne.dts);V=Math.min(V,h),U=Math.max(U,h),K=Math.min(K,we),j=Math.max(j,we),a.push(xN(ne.key,h,le,ce))}if(a.length){if(ql){if(ql<70){const ee=a[0].flags;ee.dependsOn=2,ee.isNonSync=0}}else if(TE&&j-K<U-V&&S/U<.025&&a[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let ee=p;for(let ne=0,N=a.length;ne<N;ne++){const le=ee+a[ne].duration,we=ee+a[ne].cts;if(ne<N-1){const ce=le+a[ne+1].cts;a[ne].duration=ce-we}else a[ne].duration=ne?a[ne-1].duration:S;a[ne].cts=0,ee=le}}}h=M||!h?S:h;const G=m+h;this.nextVideoTs=d=G-c,this.videoSampleDuration=h,this.isVideoContiguous=!0;const D={data1:X.moof(e.sequenceNumber++,p,xt(e,{samples:a})),data2:x,startPTS:(y-c)/s,endPTS:(g+h-c)/s,startDTS:(p-c)/s,endDTS:d/s,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,D}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return koe;case"ac3":return Doe;default:return Poe}}remuxAudio(e,n,i,r,s){const o=e.inputTimeScale,a=e.samplerate?e.samplerate:o,l=o/a,u=this.getSamplesPerFrame(e),c=u*l,d=this._initPTS,f=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,h=[],p=s!==void 0;let m=e.samples,y=f?0:8,g=this.nextAudioTs||-1;const v=d.baseTime*o/d.timescale,b=v+n*o;if(this.isAudioContiguous=i=i||m.length&&g>0&&(r&&Math.abs(b-(g+v))<9e3||Math.abs(xi(m[0].pts,b)-(g+v))<20*c),m.forEach(function(j){j.pts=xi(j.pts,b)}),!i||g<0){const j=m.length;if(m=m.filter(G=>G.pts>=0),j!==m.length&&this.warn(`Removed ${m.length-j} of ${j} samples (initPTS ${v} / ${o})`),!m.length)return;s===0?g=0:r&&!p?g=Math.max(0,b-v):g=m[0].pts-v}if(e.segmentCodec==="aac"){const j=this.config.maxAudioFramesDrift;for(let G=0,H=g+v;G<m.length;G++){const Y=m[G],D=Y.pts,ee=D-H,ne=Math.abs(1e3*ee/o);if(ee<=-j*c&&p)G===0&&(this.warn(`Audio frame @ ${(D/o).toFixed(3)}s overlaps marker by ${Math.round(1e3*ee/o)} ms.`),this.nextAudioTs=g=D-v,H=D);else if(ee>=j*c&&ne<Loe&&p){let N=Math.round(ee/c);for(H=D-N*c;H<0&&N&&c;)N--,H+=c;G===0&&(this.nextAudioTs=g=H-v),this.warn(`Injecting ${N} audio frames @ ${((H-v)/o).toFixed(3)}s due to ${Math.round(1e3*ee/o)} ms gap.`);for(let le=0;le<N;le++){let we=Coe.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);we||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),we=Y.unit.subarray()),m.splice(G,0,{unit:we,pts:H}),H+=c,G++}}Y.pts=H,H+=c}}let T=null,S=null,_,A=0,P=m.length;for(;P--;)A+=m[P].unit.byteLength;for(let j=0,G=m.length;j<G;j++){const H=m[j],Y=H.unit;let D=H.pts;if(S!==null){const ne=h[j-1];ne.duration=Math.round((D-S)/l)}else if(i&&e.segmentCodec==="aac"&&(D=g+v),T=D,A>0){A+=y;try{_=new Uint8Array(A)}catch(ne){this.observer.emit(C.ERROR,C.ERROR,{type:He.MUX_ERROR,details:Q.REMUX_ALLOC_ERROR,fatal:!1,error:ne,bytes:A,reason:`fail allocating audio mdat ${A}`});return}f||(new DataView(_.buffer).setUint32(0,A),_.set(X.types.mdat,4))}else return;_.set(Y,y);const ee=Y.byteLength;y+=ee,h.push(xN(!0,u,ee,0)),S=D}const O=h.length;if(!O)return;const x=h[h.length-1];g=S-v,this.nextAudioTs=g+l*x.duration;const L=f?new Uint8Array(0):X.moof(e.sequenceNumber++,T/l,xt({},e,{samples:h}));e.samples=[];const M=(T-v)/o,V=g/o,U={data1:L,data2:_,startPTS:M,endPTS:V,startDTS:M,endDTS:V,type:"audio",hasAudio:!0,hasVideo:!1,nb:O};return this.isAudioContiguous=!0,U}}function xi(t,e){let n;if(e===null)return t;for(e<t?n=-8589934592:n=8589934592;Math.abs(t-e)>4294967296;)t+=n;return t}function Ooe(t){for(let e=0;e<t.length;e++)if(t[e].key)return e;return-1}function wN(t,e,n,i){const r=t.samples.length;if(!r)return;const s=t.inputTimeScale;for(let a=0;a<r;a++){const l=t.samples[a];l.pts=xi(l.pts-n.baseTime*s/n.timescale,e*s)/s,l.dts=xi(l.dts-i.baseTime*s/i.timescale,e*s)/s}const o=t.samples;return t.samples=[],{samples:o}}function _N(t,e,n){const i=t.samples.length;if(!i)return;const r=t.inputTimeScale;for(let o=0;o<i;o++){const a=t.samples[o];a.pts=xi(a.pts-n.baseTime*r/n.timescale,e*r)/r}t.samples.sort((o,a)=>o.pts-a.pts);const s=t.samples;return t.samples=[],{samples:s}}class Noe extends Hi{constructor(e,n,i,r){super("passthrough-remuxer",r),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const n=this.initPTS;n&&e&&n.baseTime===e.baseTime&&n.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,n,i,r){this.audioCodec=n,this.videoCodec=i,this.generateInitSegment(e,r),this.emitInitSegment=!0}generateInitSegment(e,n){let{audioCodec:i,videoCodec:r}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:s,video:o}=this.initData=jD(e);if(n)Sre(e,n);else{const l=s||o;l!=null&&l.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${l.codec}")!`)}s&&(i=AN(s,Ct.AUDIO,this)),o&&(r=AN(o,Ct.VIDEO,this));const a={};s&&o?a.audiovideo={container:"video/mp4",codec:i+","+r,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:s?a.audio={container:"audio/mp4",codec:i,encrypted:s.encrypted,initSegment:e,id:"audio"}:o?a.video={container:"video/mp4",codec:r,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=a}remux(e,n,i,r,s,o){var a,l;let{initPTS:u,lastEndTime:c}=this;const d={audio:void 0,video:void 0,text:r,id3:i,initSegment:void 0};Ce(c)||(c=this.lastEndTime=s||0);const f=n.samples;if(!f.length)return d;const h={initPTS:void 0,timescale:void 0,trackId:void 0};let p=this.initData;if((a=p)!=null&&a.length||(this.generateInitSegment(f),p=this.initData),!((l=p)!=null&&l.length))return this.warn("Failed to generate initSegment."),d;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1);const m=wre(f,p,this),y=p.audio?m[p.audio.id]:null,g=p.video?m[p.video.id]:null,v=t0(g,1/0),b=t0(y,1/0),T=t0(g,0,!0),S=t0(y,0,!0);let _=s,A=0;const P=y&&(!g||!u&&b<v||u&&u.trackId===p.audio.id),O=P?y:g;if(O){const H=O.timescale,Y=O.start-s*H,D=P?p.audio.id:p.video.id;_=O.start/H,A=P?S-b:T-v,(o||!u)&&(Moe(u,_,s,A)||H!==u.timescale)&&(u&&this.warn(`Timestamps at playlist time: ${o?"":"~"}${s} ${Y/H} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${_-s} (${Y}/${H}) trackId: ${D}`),u=null,h.initPTS=Y,h.timescale=H,h.trackId=D)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${s}`);u?(h.initPTS=u.baseTime,h.timescale=u.timescale,h.trackId=u.trackId):((!h.timescale||h.trackId===void 0||h.initPTS===void 0)&&(this.warn("Could not set initPTS"),h.initPTS=_,h.timescale=1,h.trackId=-1),this.initPTS=u={baseTime:h.initPTS,timescale:h.timescale,trackId:h.trackId});const x=_-u.baseTime/u.timescale,L=x+A;A>0?this.lastEndTime=L:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const M=!!p.audio,V=!!p.video;let K="";M&&(K+="audio"),V&&(K+="video");const U=(p.audio?p.audio.encrypted:!1)||(p.video?p.video.encrypted:!1),j={data1:f,startPTS:x,startDTS:x,endPTS:L,endDTS:L,type:K,hasAudio:M,hasVideo:V,nb:1,dropped:0,encrypted:U};d.audio=M&&!V?j:void 0,d.video=V?j:void 0;const G=g==null?void 0:g.sampleCount;if(G){const H=g.keyFrameIndex,Y=H!==-1;j.nb=G,j.dropped=H===0||this.isVideoContiguous?0:Y?H:G,j.independent=Y,j.firstKeyFrame=H,Y&&g.keyFrameStart&&(j.firstKeyFramePTS=(g.keyFrameStart-u.baseTime)/u.timescale),this.isVideoContiguous||(d.independent=Y),this.isVideoContiguous||(this.isVideoContiguous=Y),j.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${H}/${G} dropped: ${j.dropped} start: ${j.firstKeyFramePTS||"NA"}`)}return d.initSegment=h,d.id3=wN(i,s,u,u),r.samples.length&&(d.text=_N(r,s,u)),d}}function t0(t,e,n=!1){return(t==null?void 0:t.start)!==void 0?(t.start+(n?t.duration:0))/t.timescale:e}function Moe(t,e,n,i){if(t===null)return!0;const r=Math.max(i,1),s=e-t.baseTime/t.timescale;return Math.abs(s-n)>r}function AN(t,e,n){const i=t.codec;return i&&i.length>4?i:e===Ct.AUDIO?i==="ec-3"||i==="ac-3"||i==="alac"?i:i==="fLaC"||i==="Opus"?Mp(i,!1):(n.warn(`Unhandled audio codec "${i}" in mp4 MAP`),i||"mp4a"):(n.warn(`Unhandled video codec "${i}" in mp4 MAP`),i||"avc1")}let ys;try{ys=self.performance.now.bind(self.performance)}catch{ys=Date.now}const n0=[{demux:Toe,remux:Noe},{demux:co,remux:e0},{demux:yoe,remux:e0},{demux:boe,remux:e0}];n0.splice(2,0,{demux:voe,remux:e0});class CN{constructor(e,n,i,r,s,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=n,this.config=i,this.id=s,this.logger=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,n,i,r){const s=i.transmuxing;s.executeStart=ys();let o=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:l}=this;r&&(this.currentTransmuxState=r);const{contiguous:u,discontinuity:c,trackSwitch:d,accurateTimeOffset:f,timeOffset:h,initSegmentChange:p}=r||a,{audioCodec:m,videoCodec:y,defaultInitPts:g,duration:v,initSegmentData:b}=l,T=Foe(o,n);if(T&&Gl(T.method)){const P=this.getDecrypter(),O=eE(T.method);if(P.isSync()){let x=P.softwareDecrypt(o,T.key.buffer,T.iv.buffer,O);if(i.part>-1){const M=P.flush();x=M&&M.buffer}if(!x)return s.executeEnd=ys(),SE(i);o=new Uint8Array(x)}else return this.asyncResult=!0,this.decryptionPromise=P.webCryptoDecrypt(o,T.key.buffer,T.iv.buffer,O).then(x=>{const L=this.push(x,null,i);return this.decryptionPromise=null,L}),this.decryptionPromise}const S=this.needsProbing(c,d);if(S){const P=this.configureTransmuxer(o);if(P)return this.logger.warn(`[transmuxer] ${P.message}`),this.observer.emit(C.ERROR,C.ERROR,{type:He.MEDIA_ERROR,details:Q.FRAG_PARSING_ERROR,fatal:!1,error:P,reason:P.message}),s.executeEnd=ys(),SE(i)}(c||d||p||S)&&this.resetInitSegment(b,m,y,v,n),(c||p||S)&&this.resetInitialTimestamp(g),u||this.resetContiguity();const _=this.transmux(o,T,h,f,i);this.asyncResult=Td(_);const A=this.currentTransmuxState;return A.contiguous=!0,A.discontinuity=!1,A.trackSwitch=!1,s.executeEnd=ys(),_}flush(e){const n=e.transmuxing;n.executeStart=ys();const{decrypter:i,currentTransmuxState:r,decryptionPromise:s}=this;if(s)return this.asyncResult=!0,s.then(()=>this.flush(e));const o=[],{timeOffset:a}=r;if(i){const d=i.flush();d&&o.push(this.push(d.buffer,null,e))}const{demuxer:l,remuxer:u}=this;if(!l||!u){n.executeEnd=ys();const d=[SE(e)];return this.asyncResult?Promise.resolve(d):d}const c=l.flush(a);return Td(c)?(this.asyncResult=!0,c.then(d=>(this.flushRemux(o,d,e),o))):(this.flushRemux(o,c,e),this.asyncResult?Promise.resolve(o):o)}flushRemux(e,n,i){const{audioTrack:r,videoTrack:s,id3Track:o,textTrack:a}=n,{accurateTimeOffset:l,timeOffset:u}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${i.sn}${i.part>-1?" part: "+i.part:""} of ${this.id===Pe.MAIN?"level":"track"} ${i.level}`);const c=this.remuxer.remux(r,s,o,a,u,l,!0,this.id);e.push({remuxResult:c,chunkMeta:i}),i.transmuxing.executeEnd=ys()}resetInitialTimestamp(e){const{demuxer:n,remuxer:i}=this;!n||!i||(n.resetTimeStamp(e),i.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:n}=this;!e||!n||(e.resetContiguity(),n.resetNextTimestamp())}resetInitSegment(e,n,i,r,s){const{demuxer:o,remuxer:a}=this;!o||!a||(o.resetInitSegment(e,n,i,r),a.resetInitSegment(e,n,i,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,n,i,r,s){let o;return n&&n.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,n,i,r,s):o=this.transmuxUnencrypted(e,i,r,s),o}transmuxUnencrypted(e,n,i,r){const{audioTrack:s,videoTrack:o,id3Track:a,textTrack:l}=this.demuxer.demux(e,n,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,o,a,l,n,i,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,n,i,r,s){return this.demuxer.demuxSampleAes(e,n,i).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,i,r,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){const{config:n,observer:i,typeSupported:r}=this;let s;for(let d=0,f=n0.length;d<f;d++){var o;if((o=n0[d].demux)!=null&&o.probe(e,this.logger)){s=n0[d];break}}if(!s)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,l=this.remuxer,u=s.remux,c=s.demux;(!l||!(l instanceof u))&&(this.remuxer=new u(i,n,r,this.logger)),(!a||!(a instanceof c))&&(this.demuxer=new c(i,n,r,this.logger),this.probe=c.probe)}needsProbing(e,n){return!this.demuxer||!this.remuxer||e||n}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Qb(this.config)),e}}function Foe(t,e){let n=null;return t.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(n=e),n}const SE=t=>({remuxResult:{},chunkMeta:t});function Td(t){return"then"in t&&t.then instanceof Function}class Boe{constructor(e,n,i,r,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=n,this.initSegmentData=i,this.duration=r,this.defaultInitPts=s||null}}class Uoe{constructor(e,n,i,r,s,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=n,this.accurateTimeOffset=i,this.trackSwitch=r,this.timeOffset=s,this.initSegmentChange=o}}let IN=0;class RN{constructor(e,n,i,r){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=IN++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=l=>{const u=l.data,c=this.hls;if(!(!c||!(u!=null&&u.event)||u.instanceNo!==this.instanceNo))switch(u.event){case"init":{var d;const f=(d=this.workerContext)==null?void 0:d.objectURL;f&&self.URL.revokeObjectURL(f);break}case"transmuxComplete":{this.handleTransmuxComplete(u.data);break}case"flush":{this.onFlush(u.data);break}case"workerLog":{c.logger[u.data.logType]&&c.logger[u.data.logType](u.data.message);break}default:{u.data=u.data||{},u.data.frag=this.frag,u.data.part=this.part,u.data.id=this.id,c.trigger(u.event,u.data);break}}},this.onWorkerError=l=>{if(!this.hls)return;const u=new Error(`${l.message}  (${l.filename}:${l.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(C.ERROR,{type:He.OTHER_ERROR,details:Q.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:u})};const s=e.config;this.hls=e,this.id=n,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=i,this.onFlush=r;const o=(l,u)=>{u=u||{},u.frag=this.frag||void 0,l===C.ERROR&&(u=u,u.parent=this.id,u.part=this.part,this.error=u.error),this.hls.trigger(l,u)};this.observer=new cE,this.observer.on(C.FRAG_DECRYPTED,o),this.observer.on(C.ERROR,o);const a=JD(s.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const l=this.hls.logger;if(s.workerPath||Vse()){try{s.workerPath?(l.log(`loading Web Worker ${s.workerPath} for "${n}"`),this.workerContext=jse(s.workerPath)):(l.log(`injecting Web Worker for "${n}"`),this.workerContext=Gse());const{worker:c}=this.workerContext;c.addEventListener("message",this.onWorkerMessage),c.addEventListener("error",this.onWorkerError),c.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:a,id:n,config:It(s)})}catch(c){l.warn(`Error setting up "${n}" Web Worker, fallback to inline`,c),this.terminateWorker(),this.error=null,this.transmuxer=new CN(this.observer,a,s,"",n,e.logger)}return}}this.transmuxer=new CN(this.observer,a,s,"",n,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=IN++;const n=this.hls.config,i=JD(n.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:i,id:this.id,config:It(n)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),Wse(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const n=this.transmuxer;n&&(n.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,n,i,r,s,o,a,l,u,c){var d,f;u.transmuxing.start=self.performance.now();const{instanceNo:h,transmuxer:p}=this,m=o?o.start:s.start,y=s.decryptdata,g=this.frag,v=!(g&&s.cc===g.cc),b=!(g&&u.level===g.level),T=g?u.sn-g.sn:-1,S=this.part?u.part-this.part.index:-1,_=T===0&&u.id>1&&u.id===(g==null?void 0:g.stats.chunkCount),A=!b&&(T===1||T===0&&(S===1||_&&S<=0)),P=self.performance.now();(b||T||s.stats.parsing.start===0)&&(s.stats.parsing.start=P),o&&(S||!A)&&(o.stats.parsing.start=P);const O=!(g&&((d=s.initSegment)==null?void 0:d.url)===((f=g.initSegment)==null?void 0:f.url)),x=new Uoe(v,A,l,b,m,O);if(!A||v||O){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${s.type} sn: ${u.sn}${u.part>-1?" part: "+u.part:""} ${this.id===Pe.MAIN?"level":"track"}: ${u.level} id: ${u.id}
        discontinuity: ${v}
        trackSwitch: ${b}
        contiguous: ${A}
        accurateTimeOffset: ${l}
        timeOffset: ${m}
        initSegmentChange: ${O}`);const L=new Boe(i,r,n,a,c);this.configureTransmuxer(L)}if(this.frag=s,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:h,cmd:"demux",data:e,decryptdata:y,chunkMeta:u,state:x},e instanceof ArrayBuffer?[e]:[]);else if(p){const L=p.push(e,y,u,x);Td(L)?L.then(M=>{this.handleTransmuxComplete(M)}).catch(M=>{this.transmuxerError(M,u,"transmuxer-interface push error")}):this.handleTransmuxComplete(L)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:n,transmuxer:i}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:n,cmd:"flush",chunkMeta:e});else if(i){const r=i.flush(e);Td(r)?r.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")}):this.handleFlushResult(r,e)}}transmuxerError(e,n,i){this.hls&&(this.error=e,this.hls.trigger(C.ERROR,{type:He.MEDIA_ERROR,details:Q.FRAG_PARSING_ERROR,chunkMeta:n,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:i}))}handleFlushResult(e,n){e.forEach(i=>{this.handleTransmuxComplete(i)}),this.onFlush(n)}configureTransmuxer(e){const{instanceNo:n,transmuxer:i}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:n,cmd:"configure",config:e}):i&&i.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const LN=100;class Hoe extends lE{constructor(e,n,i){super(e,n,i,"audio-stream-controller",Pe.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(C.LEVEL_LOADED,this.onLevelLoaded,this),e.on(C.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(C.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(C.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(C.BUFFER_RESET,this.onBufferReset,this),e.on(C.BUFFER_CREATED,this.onBufferCreated,this),e.on(C.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(C.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(C.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(C.FRAG_LOADING,this.onFragLoading,this),e.on(C.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(C.LEVEL_LOADED,this.onLevelLoaded,this),e.off(C.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(C.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(C.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(C.BUFFER_RESET,this.onBufferReset,this),e.off(C.BUFFER_CREATED,this.onBufferCreated,this),e.off(C.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(C.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(C.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(C.FRAG_LOADING,this.onFragLoading,this),e.off(C.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:n,id:i,initPTS:r,timescale:s,trackId:o}){if(i===Pe.MAIN){const a=n.cc,l=this.fragCurrent;if(this.initPTS[a]={baseTime:r,timescale:s,trackId:o},this.log(`InitPTS for cc: ${a} found from main: ${r/s} (${r}/${s}) trackId: ${o}`),this.mainAnchor=n,this.state===ae.WAITING_INIT_PTS){const u=this.waitingData;(!u&&!this.loadingParts||u&&u.frag.cc!==a)&&this.syncWithAnchor(n,u==null?void 0:u.frag)}else!this.hls.hasEnoughToStart&&l&&l.cc!==a?(l.abortRequests(),this.syncWithAnchor(n,l)):this.state===ae.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,n){var i;const r=((i=this.mainFragLoading)==null?void 0:i.frag)||null;if(n&&(r==null?void 0:r.cc)===n.cc)return;const s=(r||e).cc,o=this.getLevelDetails(),a=this.getLoadPosition(),l=fO(o,s,a);l&&(this.log(`Syncing with main frag at ${l.start} cc ${l.cc}`),this.startFragRequested=!1,this.nextLoadPosition=l.start,this.resetLoadingState(),this.state===ae.IDLE&&this.doTickIdle())}startLoad(e,n){if(!this.levels){this.startPosition=e,this.state=ae.STOPPED;return}const i=this.lastCurrentTime;this.stopLoad(),this.setInterval(LN),i>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i,this.state=ae.IDLE):this.state=ae.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=n?-1:e,this.tick()}doTick(){switch(this.state){case ae.IDLE:this.doTickIdle();break;case ae.WAITING_TRACK:{const{levels:e,trackId:n}=this,i=e==null?void 0:e[n],r=i==null?void 0:i.details;if(r&&!this.waitForLive(i)){if(this.waitForCdnTuneIn(r))break;this.state=ae.WAITING_INIT_PTS}break}case ae.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case ae.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:n,part:i,cache:r,complete:s}=e,o=this.mainAnchor;if(this.initPTS[n.cc]!==void 0){this.waitingData=null,this.state=ae.FRAG_LOADING;const a=r.flush().buffer,l={frag:n,part:i,payload:a,networkDetails:null};this._handleFragmentLoadProgress(l),s&&super._handleFragmentLoadComplete(l)}else o&&o.cc!==e.frag.cc&&this.syncWithAnchor(o,e.frag)}else this.state=ae.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:n,levels:i,media:r,trackId:s}=this,o=n.config;if(!this.buffering||!r&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(i!=null&&i[s]))return;const a=i[s],l=a.details;if(!l||this.waitForLive(a)||this.waitForCdnTuneIn(l)){this.state=ae.WAITING_TRACK,this.startFragRequested=!1;return}const u=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&u&&(this.bufferFlushed=!1,this.afterBufferFlushed(u,Ct.AUDIO,Pe.AUDIO));const c=this.getFwdBufferInfo(u,Pe.AUDIO);if(c===null)return;if(!this.switchingTrack&&this._streamEnded(c,l)){n.trigger(C.BUFFER_EOS,{type:"audio"}),this.state=ae.ENDED;return}const d=c.len,f=n.maxBufferLength,h=l.fragments,p=h[0].start,m=this.getLoadPosition(),y=this.flushing?m:c.end;if(this.switchingTrack&&r){const b=m;l.PTSKnown&&b<p&&(c.end>p||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=p+.05)}if(d>=f&&!this.switchingTrack&&y<h[h.length-1].start)return;let g=this.getNextFragment(y,l);if(g&&this.isLoopLoading(g,y)&&(g=this.getNextFragmentLoopLoading(g,l,c,Pe.MAIN,f)),!g){this.bufferFlushed=!0;return}let v=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&v&&un(g)&&!g.endList&&(!l.live||!this.loadingParts&&y<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(v)===mn.OK&&(this.mainFragLoading=v=null),v&&un(v))){if(g.start>v.end){const T=this.fragmentTracker.getFragAtPos(y,Pe.MAIN);T&&T.end>v.end&&(v=T,this.mainFragLoading={frag:T,targetBufferTime:null})}if(g.start>v.end)return}this.loadFragment(g,a,y)}onMediaDetaching(e,n){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,n)}onAudioTracksUpdated(e,{audioTracks:n}){this.resetTransmuxer(),this.levels=n.map(i=>new pd(i))}onAudioTrackSwitching(e,n){const i=!!n.url;this.trackId=n.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),i?(this.switchingTrack=n,this.flushAudioIfNeeded(n),this.state!==ae.STOPPED&&(this.setInterval(LN),this.state=ae.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=n,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,n){this.mainDetails=n.details;const i=this.cachedTrackLoadedData;i&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(C.AUDIO_TRACK_LOADED,i))}onAudioTrackLoaded(e,n){var i;const{levels:r}=this,{details:s,id:o,groupId:a,track:l}=n;if(!r){this.warn(`Audio tracks reset while loading track ${o} "${l.name}" of "${a}"`);return}const u=this.mainDetails;if(!u||s.endCC>u.endCC||u.expired){this.cachedTrackLoadedData=n,this.state!==ae.STOPPED&&(this.state=ae.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${l.name}" of "${a}" loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const c=r[o];let d=0;if(s.live||(i=c.details)!=null&&i.live){if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;if(c.details){var f;d=this.alignPlaylists(s,c.details,(f=this.levelLastLoaded)==null?void 0:f.details)}s.alignedSliding||(tN(s,u),s.alignedSliding||Yp(s,u),d=s.fragmentStart)}c.details=s,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(u,d),this.hls.trigger(C.AUDIO_TRACK_UPDATED,{details:s,id:o,groupId:n.groupId}),this.state===ae.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=ae.IDLE),this.tick()}_handleFragmentLoadProgress(e){var n;const i=e.frag,{part:r,payload:s}=e,{config:o,trackId:a,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const u=l[a];if(!u){this.warn("Audio track is undefined on fragment load progress");return}const c=u.details;if(!c){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}const d=o.defaultAudioCodec||u.audioCodec||"mp4a.40.2";let f=this.transmuxer;f||(f=this.transmuxer=new RN(this.hls,Pe.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const h=this.initPTS[i.cc],p=(n=i.initSegment)==null?void 0:n.data;if(h!==void 0){const y=r?r.index:-1,g=y!==-1,v=new Zb(i.level,i.sn,i.stats.chunkCount,s.byteLength,y,g);f.push(s,p,d,"",i,r,c.totalduration,!1,v,h)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${c.startSN} ,${c.endSN}],track ${a}`);const{cache:m}=this.waitingData=this.waitingData||{frag:i,part:r,cache:new iN,complete:!1};m.push(new Uint8Array(s)),this.state!==ae.STOPPED&&(this.state=ae.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,n){this.bufferFlushed=this.flushing=!1;const i=n.tracks.audio;i&&(this.mediaBuffer=i.buffer||null)}onFragLoading(e,n){!this.audioOnly&&n.frag.type===Pe.MAIN&&un(n.frag)&&(this.mainFragLoading=n,this.state===ae.IDLE&&this.tick())}onFragBuffered(e,n){const{frag:i,part:r}=n;if(i.type!==Pe.AUDIO){!this.audioOnly&&i.type===Pe.MAIN&&!i.elementaryStreams.video&&!i.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(un(i)){this.fragPrevious=i;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(C.AUDIO_TRACK_SWITCHED,bt({},s)))}this.fragBufferedComplete(i,r),this.media&&this.tick()}onError(e,n){var i;if(n.fatal){this.state=ae.ERROR;return}switch(n.details){case Q.FRAG_GAP:case Q.FRAG_PARSING_ERROR:case Q.FRAG_DECRYPT_ERROR:case Q.FRAG_LOAD_ERROR:case Q.FRAG_LOAD_TIMEOUT:case Q.KEY_LOAD_ERROR:case Q.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Pe.AUDIO,n);break;case Q.AUDIO_TRACK_LOAD_ERROR:case Q.AUDIO_TRACK_LOAD_TIMEOUT:case Q.LEVEL_PARSING_ERROR:!n.levelRetry&&this.state===ae.WAITING_TRACK&&((i=n.context)==null?void 0:i.type)===dt.AUDIO_TRACK&&(this.state=ae.IDLE);break;case Q.BUFFER_ADD_CODEC_ERROR:case Q.BUFFER_APPEND_ERROR:if(n.parent!=="audio")return;this.reduceLengthAndFlushBuffer(n)||this.resetLoadingState();break;case Q.BUFFER_FULL_ERROR:if(n.parent!=="audio")return;this.reduceLengthAndFlushBuffer(n)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case Q.INTERNAL_EXCEPTION:this.recoverWorkerError(n);break}}onBufferFlushing(e,{type:n}){n!==Ct.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:n}){if(n!==Ct.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===ae.ENDED&&(this.state=ae.IDLE);const i=this.mediaBuffer||this.media;i&&(this.afterBufferFlushed(i,n,Pe.AUDIO),this.tick())}}_handleTransmuxComplete(e){var n;const i="audio",{hls:r}=this,{remuxResult:s,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a){this.resetWhenMissingContext(o);return}const{frag:l,part:u,level:c}=a,{details:d}=c,{audio:f,text:h,id3:p,initSegment:m}=s;if(this.fragContextChanged(l)||!d){this.fragmentTracker.removeFragment(l);return}if(this.state=ae.PARSING,this.switchingTrack&&f&&this.completeAudioSwitch(this.switchingTrack),m!=null&&m.tracks){const y=l.initSegment||l;if(this.unhandledEncryptionError(m,l))return;this._bufferInitSegment(c,m.tracks,y,o),r.trigger(C.FRAG_PARSING_INIT_SEGMENT,{frag:y,id:i,tracks:m.tracks})}if(f){const{startPTS:y,endPTS:g,startDTS:v,endDTS:b}=f;u&&(u.elementaryStreams[Ct.AUDIO]={startPTS:y,endPTS:g,startDTS:v,endDTS:b}),l.setElementaryStreamInfo(Ct.AUDIO,y,g,v,b),this.bufferFragmentData(f,l,u,o)}if(p!=null&&(n=p.samples)!=null&&n.length){const y=xt({id:i,frag:l,details:d},p);r.trigger(C.FRAG_PARSING_METADATA,y)}if(h){const y=xt({id:i,frag:l,details:d},h);r.trigger(C.FRAG_PARSING_USERDATA,y)}}_bufferInitSegment(e,n,i,r){if(this.state!==ae.PARSING||(n.video&&delete n.video,n.audiovideo&&delete n.audiovideo,!n.audio))return;const s=n.audio;s.id=Pe.AUDIO;const o=e.audioCodec;this.log(`Init audio buffer, container:${s.container}, codecs[level/parsed]=[${o}/${s.codec}]`),o&&o.split(",").length===1&&(s.levelCodec=o),this.hls.trigger(C.BUFFER_CODECS,n);const a=s.initSegment;if(a!=null&&a.byteLength){const l={type:"audio",frag:i,part:null,chunkMeta:r,parent:i.type,data:a};this.hls.trigger(C.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,n,i){const r=this.fragmentTracker.getState(e);if(this.switchingTrack||r===mn.NOT_LOADED||r===mn.PARTIAL){var s;if(!un(e))this._loadInitSegment(e,n);else if((s=n.details)!=null&&s.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=ae.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragmentStart!==n.details.fragmentStart&&Yp(n.details,o)}else super.loadFragment(e,n,i)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:n,lang:i,assocLang:r,characteristics:s,audioCodec:o,channels:a}=this.bufferedTrack;ua({name:n,lang:i,assocLang:r,characteristics:s,audioCodec:o,channels:a},e,ca)||(Hp(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:n}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,n.trigger(C.AUDIO_TRACK_SWITCHED,bt({},e))}}class xE extends Hi{constructor(e,n){super(n,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,n,i){const r=n==null?void 0:n.renditionReports;if(r){let s=-1;for(let o=0;o<r.length;o++){const a=r[o];let l;try{l=new self.URL(a.URI,n.url).href}catch(u){this.warn(`Could not construct new URL for Rendition Report: ${u}`),l=a.URI||""}if(l===e){s=o;break}else l===e.substring(0,l.length)&&(s=o)}if(s!==-1){const o=r[s],a=parseInt(o["LAST-MSN"])||n.lastPartSn;let l=parseInt(o["LAST-PART"])||n.lastPartIndex;if(this.hls.config.lowLatencyMode){const c=Math.min(n.age-n.partTarget,n.targetduration);l>=0&&c>n.partTarget&&(l+=1)}const u=i&&rO(i);return new sO(a,l>=0?l:void 0,u)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,n){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,n){if(n)try{return n.addDirectives(e)}catch(i){this.warn(`Could not construct new URL with HLS Delivery Directives: ${i}`)}return e}playlistLoaded(e,n,i){const{details:r,stats:s}=n,o=self.performance.now(),a=s.loading.first?Math.max(0,o-s.loading.first):0;r.advancedDateTime=Date.now()-a;const l=this.hls.config.timelineOffset;if(l!==r.appliedTimelineOffset){const c=Math.max(l||0,0);r.appliedTimelineOffset=c,r.fragments.forEach(d=>{d.setStart(d.playlistOffset+c)})}if(r.live||i!=null&&i.live){const c="levelInfo"in n?n.levelInfo:n.track;if(r.reloaded(i),i&&r.fragments.length>0){kse(i,r,this);const v=r.playlistParsingError;if(v){this.warn(v);const b=this.hls;if(!b.config.ignorePlaylistParsingErrors){var u;const{networkDetails:T}=n;b.trigger(C.ERROR,{type:He.NETWORK_ERROR,details:Q.LEVEL_PARSING_ERROR,fatal:!1,url:r.url,error:v,reason:v.message,level:n.level||void 0,parent:(u=r.fragments[0])==null?void 0:u.type,networkDetails:T,stats:s});return}r.playlistParsingError=null}}r.requestScheduled===-1&&(r.requestScheduled=s.loading.start);const d=this.hls.mainForwardBufferInfo,f=d?d.end-d.len:0,h=(r.edge-f)*1e3,p=qO(r,h);if(r.requestScheduled+p<o?r.requestScheduled=o:r.requestScheduled+=p,this.log(`live playlist ${e} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),!this.canLoad||!r.live)return;let m,y,g;if(r.canBlockReload&&r.endSN&&r.advanced){const v=this.hls.config.lowLatencyMode,b=r.lastPartSn,T=r.endSN,S=r.lastPartIndex,_=S!==-1,A=b===T;_?A?(y=T+1,g=v?0:S):(y=b,g=v?S+1:r.maxPartIndex):y=T+1;const P=r.age,O=P+r.ageHeader;let x=Math.min(O-r.partTarget,r.targetduration*1.5);if(x>0){if(O>r.targetduration*3)this.log(`Playlist last advanced ${P.toFixed(2)}s ago. Omitting segment and part directives.`),y=void 0,g=void 0;else if(i!=null&&i.tuneInGoal&&O-r.partTarget>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${x} with playlist age: ${r.age}`),x=0;else{const L=Math.floor(x/r.targetduration);if(y+=L,g!==void 0){const M=Math.round(x%r.targetduration/r.partTarget);g+=M}this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${P.toFixed(2)}s goal: ${x} skip sn ${L} to part ${g}`)}r.tuneInGoal=x}if(m=this.getDeliveryDirectives(r,n.deliveryDirectives,y,g),v||!A){r.requestScheduled=o,this.loadingPlaylist(c,m);return}}else(r.canBlockReload||r.canSkipUntil)&&(m=this.getDeliveryDirectives(r,n.deliveryDirectives,y,g));m&&y!==void 0&&r.canBlockReload&&(r.requestScheduled=s.loading.first+Math.max(p-a*2,p/2)),this.scheduleLoading(c,m,r)}else this.clearTimer()}scheduleLoading(e,n,i){const r=i||e.details;if(!r){this.loadingPlaylist(e,n);return}const s=self.performance.now(),o=r.requestScheduled;if(s>=o){this.loadingPlaylist(e,n);return}const a=o-s;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(a)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,n),a)}getDeliveryDirectives(e,n,i,r){let s=rO(e);return n!=null&&n.skip&&e.deltaUpdateFailed&&(i=n.msn,r=n.part,s=Up.No),new sO(i,r,s)}checkRetry(e){const n=e.details,i=$p(e),r=e.errorAction,{action:s,retryCount:o=0,retryConfig:a}=r||{},l=!!r&&!!a&&(s===Cn.RetryRequest||!r.resolved&&s===Cn.SendAlternateToPenaltyBox);if(l){var u;if(o>=a.maxNumRetry)return!1;if(i&&(u=e.context)!=null&&u.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${n}" without delivery-directives`),this.loadPlaylist();else{const c=Yb(a,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),c),this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${n}" in ${c}ms`)}e.levelRetry=!0,r.resolved=!0}return l}}function PN(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Sd(t[n].attrs,e[n].attrs))return!1;return!0}function Sd(t,e,n){const i=t["STABLE-RENDITION-ID"];return i&&!n?i===e["STABLE-RENDITION-ID"]:!(n||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(r=>t[r]!==e[r])}function wE(t,e){return e.label.toLowerCase()===t.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(t.lang||"").toLowerCase())}class $oe extends xE{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(C.MANIFEST_LOADING,this.onManifestLoading,this),e.on(C.MANIFEST_PARSED,this.onManifestParsed,this),e.on(C.LEVEL_LOADING,this.onLevelLoading,this),e.on(C.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(C.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(C.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(C.MANIFEST_LOADING,this.onManifestLoading,this),e.off(C.MANIFEST_PARSED,this.onManifestParsed,this),e.off(C.LEVEL_LOADING,this.onLevelLoading,this),e.off(C.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(C.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(C.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,n){this.tracks=n.audioTracks||[]}onAudioTrackLoaded(e,n){const{id:i,groupId:r,details:s}=n,o=this.tracksInGroup[i];if(!o||o.groupId!==r){this.warn(`Audio track with id:${i} and group:${r} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=n.details,this.log(`Audio track ${i} "${o.name}" lang:${o.lang} group:${r} loaded [${s.startSN}-${s.endSN}]`),i===this.trackId&&this.playlistLoaded(i,n,a)}onLevelLoading(e,n){this.switchLevel(n.level)}onLevelSwitching(e,n){this.switchLevel(n.level)}switchLevel(e){const n=this.hls.levels[e];if(!n)return;const i=n.audioGroups||null,r=this.groupIds;let s=this.currentTrack;if(!i||(r==null?void 0:r.length)!==(i==null?void 0:i.length)||i!=null&&i.some(a=>(r==null?void 0:r.indexOf(a))===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(f=>!i||i.indexOf(f.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(f=>f.default)&&(this.selectDefaultTrack=!1),a.forEach((f,h)=>{f.id=h});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const l=this.hls.config.audioPreference;if(!s&&l){const f=Lr(l,a,ca);if(f>-1)s=a[f];else{const h=Lr(l,this.tracks);s=this.tracks[h]}}let u=this.findTrackId(s);u===-1&&s&&(u=this.findTrackId(null));const c={audioTracks:a};this.log(`Updating audio tracks, ${a.length} track(s) found in group(s): ${i==null?void 0:i.join(",")}`),this.hls.trigger(C.AUDIO_TRACKS_UPDATED,c);const d=this.trackId;if(u!==-1&&d===-1)this.setAudioTrack(u);else if(a.length&&d===-1){var o;const f=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${a.length}`);this.warn(f.message),this.hls.trigger(C.ERROR,{type:He.MEDIA_ERROR,details:Q.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:f})}}}onError(e,n){n.fatal||!n.context||n.context.type===dt.AUDIO_TRACK&&n.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(n.context.groupId)!==-1)&&this.checkRetry(n)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const n=this.hls;if(n.config.audioPreference=e,e){const i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){const r=this.currentTrack;if(r&&ua(e,r,ca))return r;const s=Lr(e,this.tracksInGroup,ca);if(s>-1){const o=this.tracksInGroup[s];return this.setAudioTrack(s),o}else if(r){let o=n.loadLevel;o===-1&&(o=n.firstAutoLevel);const a=Jre(e,n.levels,i,o,ca);if(a===-1)return null;n.nextLoadLevel=a}if(e.channels||e.audioCodec){const o=Lr(e,i);if(o>-1)return i[o]}}}return null}setAudioTrack(e){const n=this.tracksInGroup;if(e<0||e>=n.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,r=n[e],s=r.details&&!r.details.live;if(e===this.trackId&&r===i&&s||(this.log(`Switching to audio-track ${e} "${r.name}" lang:${r.lang} group:${r.groupId} channels:${r.channels}`),this.trackId=e,this.currentTrack=r,this.hls.trigger(C.AUDIO_TRACK_SWITCHING,bt({},r)),s))return;const o=this.switchParams(r.url,i==null?void 0:i.details,r.details);this.loadPlaylist(o)}findTrackId(e){const n=this.tracksInGroup;for(let i=0;i<n.length;i++){const r=n[i];if(!(this.selectDefaultTrack&&!r.default)&&(!e||ua(e,r,ca)))return i}if(e){const{name:i,lang:r,assocLang:s,characteristics:o,audioCodec:a,channels:l}=e;for(let u=0;u<n.length;u++){const c=n[u];if(ua({name:i,lang:r,assocLang:s,characteristics:o,audioCodec:a,channels:l},c,ca))return u}for(let u=0;u<n.length;u++){const c=n[u];if(Sd(e.attrs,c.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return u}for(let u=0;u<n.length;u++){const c=n[u];if(Sd(e.attrs,c.attrs,["LANGUAGE"]))return u}}return-1}loadPlaylist(e){super.loadPlaylist();const n=this.currentTrack;this.shouldLoadPlaylist(n)&&Hp(n.url,this.hls)&&this.scheduleLoading(n,e)}loadingPlaylist(e,n){super.loadingPlaylist(e,n);const i=e.id,r=e.groupId,s=this.getUrlWithDirectives(e.url,n),o=e.details,a=o==null?void 0:o.age;this.log(`Loading audio-track ${i} "${e.name}" lang:${e.lang} group:${r}${(n==null?void 0:n.msn)!==void 0?" at sn "+n.msn+" part "+n.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${s}`),this.hls.trigger(C.AUDIO_TRACK_LOADING,{url:s,id:i,groupId:r,deliveryDirectives:n||null,track:e})}}class zoe{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,n,i){if(this.queues===null||this.tracks===null)return;const r=this.queues[n];r.push(e),r.length===1&&!i&&this.executeNext(n)}appendBlocker(e){return new Promise(n=>{const i={label:"async-blocker",execute:n,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(i,e)})}prependBlocker(e){return new Promise(n=>{if(this.queues){const i={label:"async-blocker-prepend",execute:n,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(i)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var n;const i=(n=e[0])==null?void 0:n.label;(i==="async-blocker"||i==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const n=this.queues[e];if(n.length){const r=n[0];try{r.execute()}catch(s){var i;if(r.onError(s),this.queues===null||this.tracks===null)return;const o=(i=this.tracks[e])==null?void 0:i.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var n;return((n=this.queues)==null?void 0:n[e][0])||null}toString(){const{queues:e,tracks:n}=this;return e===null||n===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var n,i;return(n=this.queues)!=null&&n[e]||(i=this.tracks)!=null&&i[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var n;const i=(n=this.tracks)==null?void 0:n[e],r=i==null?void 0:i.buffer;return r?`SourceBuffer${r.updating?" updating":""}${i.ended?" ended":""}${i.ending?" ending":""}`:"none"}listOps(e){var n;return((n=this.queues)==null?void 0:n[e].map(i=>i.label).join(", "))||""}}const kN=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,DN="HlsJsTrackRemovedError";class Voe extends Error{constructor(e){super(e),this.name=DN}}class Goe extends Hi{constructor(e,n){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=i=>{var r;this.hls&&((r=this.mediaSource)==null?void 0:r.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=i=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=i=>{const{media:r,mediaSource:s}=this;i&&this.log("Media source opened"),!(!r||!s)&&(s.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(C.MEDIA_ATTACHED,{media:r,mediaSource:s}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:i,_objectUrl:r}=this;i!==r&&this.error(`Media element src was set while attaching MediaSource (${r} > ${i})`)},this.hls=e,this.fragmentTracker=n,this.appendSource=fre(lo(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(C.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(C.MANIFEST_LOADING,this.onManifestLoading,this),e.on(C.MANIFEST_PARSED,this.onManifestParsed,this),e.on(C.BUFFER_RESET,this.onBufferReset,this),e.on(C.BUFFER_APPENDING,this.onBufferAppending,this),e.on(C.BUFFER_CODECS,this.onBufferCodecs,this),e.on(C.BUFFER_EOS,this.onBufferEos,this),e.on(C.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(C.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(C.FRAG_PARSED,this.onFragParsed,this),e.on(C.FRAG_CHANGED,this.onFragChanged,this),e.on(C.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(C.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(C.MANIFEST_LOADING,this.onManifestLoading,this),e.off(C.MANIFEST_PARSED,this.onManifestParsed,this),e.off(C.BUFFER_RESET,this.onBufferReset,this),e.off(C.BUFFER_APPENDING,this.onBufferAppending,this),e.off(C.BUFFER_CODECS,this.onBufferCodecs,this),e.off(C.BUFFER_EOS,this.onBufferEos,this),e.off(C.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(C.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(C.FRAG_PARSED,this.onFragParsed,this),e.off(C.FRAG_CHANGED,this.onFragChanged,this),e.off(C.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:n}=this;if(!e)return null;const i={};if(this.operationQueue){const s=this.isUpdating();s||this.operationQueue.removeBlockers();const o=this.isQueued();(s||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${s?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const r=this.transferData;return!this.sourceBufferCount&&r&&r.mediaSource===n?xt(i,r.tracks):this.sourceBuffers.forEach(s=>{const[o]=s;o&&(i[o]=xt({},this.tracks[o]),this.removeBuffer(o)),s[0]=s[1]=null}),{media:e,mediaSource:n,tracks:i}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,n){var i;let r=2;(n.audio&&!n.video||!n.altAudio)&&(r=1),this.bufferCodecEventsTotal=r,this.log(`${r} bufferCodec event(s) expected.`),(i=this.transferData)!=null&&i.mediaSource&&this.sourceBufferCount&&r&&this.bufferCreated()}onMediaAttaching(e,n){const i=this.media=n.media;this.transferData=this.overrides=void 0;const r=lo(this.appendSource);if(r){const s=!!n.mediaSource;(s||n.overrides)&&(this.transferData=n,this.overrides=n.overrides);const o=this.mediaSource=n.mediaSource||new r;if(this.assignMediaSource(o),s)this._objectUrl=i.src,this.attachTransferred();else{const a=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{i.removeAttribute("src");const l=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||l&&o instanceof l,ON(i),joe(i,a),i.load()}catch{i.src=a}else i.src=a}i.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var n,i;this.log(`${((n=this.transferData)==null?void 0:n.mediaSource)===e?"transferred":"created"} media source: ${(i=e.constructor)==null?void 0:i.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,n=this.transferData;if(!n||!e)return;const i=this.tracks,r=n.tracks,s=r?Object.keys(r):null,o=s?s.length:0,a=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(r&&s&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${It(i,(l,u)=>l==="initSegment"?void 0:u)};
transfer tracks: ${It(r,(l,u)=>l==="initSegment"?void 0:u)}}`),!ND(r,i)){n.mediaSource=null,n.tracks=void 0;const l=e.currentTime,u=this.details,c=Math.max(l,(u==null?void 0:u.fragments[0].start)||0);if(c-l>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${l} -> ${c}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(r)}"->"${Object.keys(i)}") start time: ${c} currentTime: ${l}`),this.onMediaDetaching(C.MEDIA_DETACHING,{}),this.onMediaAttaching(C.MEDIA_ATTACHING,n),e.currentTime=c;return}this.transferData=void 0,s.forEach(l=>{const u=l,c=r[u];if(c){const d=c.buffer;if(d){const f=this.fragmentTracker,h=c.id;if(f.hasFragments(h)||f.hasParts(h)){const y=Qe.getBuffered(d);f.detectEvictedFragments(u,y,h,null,!0)}const p=_E(u),m=[u,d];this.sourceBuffers[p]=m,d.updating&&this.operationQueue&&this.operationQueue.prependBlocker(u),this.trackSourceBuffer(u,c)}}}),a(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),a()}get mediaSourceOpenOrEnded(){var e;const n=(e=this.mediaSource)==null?void 0:e.readyState;return n==="open"||n==="ended"}onMediaDetaching(e,n){const i=!!n.transferMedia;this.transferData=this.overrides=void 0;const{media:r,mediaSource:s,_objectUrl:o}=this;if(s){if(this.log(`media source ${i?"transferring":"detaching"}`),i)this.sourceBuffers.forEach(([a])=>{a&&this.removeBuffer(a)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const a=s.readyState==="open";try{const l=s.sourceBuffers;for(let u=l.length;u--;)a&&l[u].abort(),s.removeSourceBuffer(l[u]);a&&s.endOfStream()}catch(l){this.warn(`onMediaDetaching: ${l.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(s.removeEventListener("startstreaming",this._onStartStreaming),s.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}r&&(r.removeEventListener("emptied",this._onMediaEmptied),i||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(r.removeAttribute("src"),this.appendSource&&ON(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(C.MEDIA_DETACHED,n)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var n;const i=(n=this.tracks[e])==null?void 0:n.buffer;if(this.removeBuffer(e),i)try{var r;(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(i)}catch(s){this.warn(`onBufferReset ${e}`,s)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[_E(e)]=[null,null];const n=this.tracks[e];n&&(n.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new zoe(this.tracks)}onBufferCodecs(e,n){var i;const r=this.tracks,s=Object.keys(n);this.log(`BUFFER_CODECS: "${s}" (current SB count ${this.sourceBufferCount})`);const o="audiovideo"in n&&(r.audio||r.video)||r.audiovideo&&("audio"in n||"video"in n),a=!o&&this.sourceBufferCount&&this.media&&s.some(l=>!r[l]);if(o||a){this.warn(`Unsupported transition between "${Object.keys(r)}" and "${s}" SourceBuffers`);return}s.forEach(l=>{var u,c;const d=n[l],{id:f,codec:h,levelCodec:p,container:m,metadata:y,supplemental:g}=d;let v=r[l];const b=(u=this.transferData)==null||(u=u.tracks)==null?void 0:u[l],T=b!=null&&b.buffer?b:v,S=(T==null?void 0:T.pendingCodec)||(T==null?void 0:T.codec),_=T==null?void 0:T.levelCodec;v||(v=r[l]={buffer:void 0,listeners:[],codec:h,supplemental:g,container:m,levelCodec:p,metadata:y,id:f});const A=Fp(S,_),P=A==null?void 0:A.replace(kN,"$1");let O=Fp(h,p);const x=(c=O)==null?void 0:c.replace(kN,"$1");O&&A&&P!==x&&(l.slice(0,5)==="audio"&&(O=Mp(O,this.appendSource)),this.log(`switching codec ${S} to ${O}`),O!==(v.pendingCodec||v.codec)&&(v.pendingCodec=O),v.container=m,this.appendChangeType(l,m,O))}),(this.tracksReady||this.sourceBufferCount)&&(n.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!n.video&&((i=n.audio)==null?void 0:i.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,n)=>{const i=this.tracks[n];return e[n]={id:i.id,container:i.container,codec:i.codec,levelCodec:i.levelCodec},e},{})}appendChangeType(e,n,i){const r=`${n};codecs=${i}`,s={label:`change-type=${r}`,execute:()=>{const o=this.tracks[e];if(o){const a=o.buffer;a!=null&&a.changeType&&(this.log(`changing ${e} sourceBuffer type to ${r}`),a.changeType(r),o.codec=i,o.container=n)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};this.append(s,e,this.isPending(this.tracks[e]))}blockAudio(e){var n;const i=e.start,r=i+e.duration*.05;if(((n=this.fragmentTracker.getAppendedFrag(i,Pe.MAIN))==null?void 0:n.gap)===!0)return;const o={label:"block-audio",execute:()=>{var a;const l=this.tracks.video;(this.lastVideoAppendEnd>r||l!=null&&l.buffer&&Qe.isBuffered(l.buffer,r)||((a=this.fragmentTracker.getAppendedFrag(r,Pe.MAIN))==null?void 0:a.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn("Error executing block-audio operation",a)}};this.blockedAudioAppend={op:o,frag:e},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:n}=this;e&&n&&(this.blockedAudioAppend=null,n.unblockAudio(e.op))}onBufferAppending(e,n){const{tracks:i}=this,{data:r,type:s,parent:o,frag:a,part:l,chunkMeta:u,offset:c}=n,d=u.buffering[s],{sn:f,cc:h}=a,p=self.performance.now();d.start=p;const m=a.stats.buffering,y=l?l.stats.buffering:null;m.start===0&&(m.start=p),y&&y.start===0&&(y.start=p);const g=i.audio;let v=!1;s==="audio"&&(g==null?void 0:g.container)==="audio/mpeg"&&(v=!this.lastMpegAudioChunk||u.id===1||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);const b=i.video,T=b==null?void 0:b.buffer;if(T&&f!=="initSegment"){const A=l||a,P=this.blockedAudioAppend;if(s==="audio"&&o!=="main"&&!this.blockedAudioAppend&&!(b.ending||b.ended)){const x=A.start+A.duration*.05,L=T.buffered,M=this.currentOp("video");!L.length&&!M?this.blockAudio(A):!M&&!Qe.isBuffered(T,x)&&this.lastVideoAppendEnd<x&&this.blockAudio(A)}else if(s==="video"){const O=A.end;if(P){const x=P.frag.start;(O>x||O<this.lastVideoAppendEnd||Qe.isBuffered(T,x))&&this.unblockAudio()}this.lastVideoAppendEnd=O}}const S=(l||a).start,_={label:`append-${s}`,execute:()=>{var A;d.executeStart=self.performance.now();const P=(A=this.tracks[s])==null?void 0:A.buffer;P&&(v?this.updateTimestampOffset(P,S,.1,s,f,h):c!==void 0&&Ce(c)&&this.updateTimestampOffset(P,c,1e-6,s,f,h)),this.appendExecutor(r,s)},onStart:()=>{},onComplete:()=>{const A=self.performance.now();d.executeEnd=d.end=A,m.first===0&&(m.first=A),y&&y.first===0&&(y.first=A);const P={};this.sourceBuffers.forEach(([O,x])=>{O&&(P[O]=Qe.getBuffered(x))}),this.appendErrors[s]=0,s==="audio"||s==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(C.BUFFER_APPENDED,{type:s,frag:a,part:l,chunkMeta:u,parent:a.type,timeRanges:P})},onError:A=>{var P;const O={type:He.MEDIA_ERROR,parent:a.type,details:Q.BUFFER_APPEND_ERROR,sourceBufferName:s,frag:a,part:l,chunkMeta:u,error:A,err:A,fatal:!1},x=(P=this.media)==null?void 0:P.error;if(A.code===DOMException.QUOTA_EXCEEDED_ERR||A.name=="QuotaExceededError"||"quota"in A)O.details=Q.BUFFER_FULL_ERROR;else if(A.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!x)O.errorAction=zl(!0);else if(A.name===DN&&this.sourceBufferCount===0)O.errorAction=zl(!0);else{const L=++this.appendErrors[s];this.warn(`Failed ${L}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${s}" sourceBuffer (${x||"no media error"})`),(L>=this.hls.config.appendErrorMaxRetry||x)&&(O.fatal=!0)}this.hls.trigger(C.ERROR,O)}};this.log(`queuing "${s}" append sn: ${f}${l?" p: "+l.index:""} of ${a.type===Pe.MAIN?"level":"track"} ${a.level} cc: ${h}`),this.append(_,s,this.isPending(this.tracks[s]))}getFlushOp(e,n,i){return this.log(`queuing "${e}" remove ${n}-${i}`),{label:"remove",execute:()=>{this.removeExecutor(e,n,i)},onStart:()=>{},onComplete:()=>{this.hls.trigger(C.BUFFER_FLUSHED,{type:e})},onError:r=>{this.warn(`Failed to remove ${n}-${i} from "${e}" SourceBuffer`,r)}}}onBufferFlushing(e,n){const{type:i,startOffset:r,endOffset:s}=n;i?this.append(this.getFlushOp(i,r,s),i):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,r,s),o)})}onFragParsed(e,n){const{frag:i,part:r}=n,s=[],o=r?r.elementaryStreams:i.elementaryStreams;o[Ct.AUDIOVIDEO]?s.push("audiovideo"):(o[Ct.AUDIO]&&s.push("audio"),o[Ct.VIDEO]&&s.push("video"));const a=()=>{const l=self.performance.now();i.stats.buffering.end=l,r&&(r.stats.buffering.end=l);const u=r?r.stats:i.stats;this.hls.trigger(C.FRAG_BUFFERED,{frag:i,part:r,stats:u,id:i.type})};s.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(a,s).catch(l=>{this.warn(`Fragment buffered callback ${l}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,n){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const n=this.tracks[e];if(n)return!n.ended||n.ending}return!1})}onBufferEos(e,n){var i;this.sourceBuffers.forEach(([o])=>{if(o){const a=this.tracks[o];(!n.type||n.type===o)&&(a.ending=!0,a.ended||(a.ended=!0,this.log(`${o} buffer reached EOS`)))}});const r=((i=this.overrides)==null?void 0:i.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var a;return o&&!((a=this.tracks[o])!=null&&a.ended)})?r?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(C.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(C.BUFFERED_TO_END,void 0)):n.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const n=this.tracks[e];n&&(n.ending=!1)}})}onLevelUpdated(e,{details:n}){n.fragments.length&&(this.details=n,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,n){if(n.details===Q.BUFFER_APPEND_ERROR&&n.frag){var i;const r=(i=n.errorAction)==null?void 0:i.nextAutoLevel;Ce(r)&&r!==n.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:n,media:i}=this;if(!i||n===null||!this.sourceBufferCount)return;const r=e.config,s=i.currentTime,o=n.levelTargetDuration,a=n.live&&r.liveBackBufferLength!==null?r.liveBackBufferLength:r.backBufferLength;if(Ce(a)&&a>=0){const u=Math.max(a,o),c=Math.floor(s/o)*o-u;this.flushBackBuffer(s,o,c)}const l=r.frontBufferFlushThreshold;if(Ce(l)&&l>0){const u=Math.max(r.maxBufferLength,l),c=Math.max(u,o),d=Math.floor(s/o)*o+c;this.flushFrontBuffer(s,o,d)}}flushBackBuffer(e,n,i){this.sourceBuffers.forEach(([r,s])=>{if(s){const a=Qe.getBuffered(s);if(a.length>0&&i>a.start(0)){var o;this.hls.trigger(C.BACK_BUFFER_REACHED,{bufferEnd:i});const l=this.tracks[r];if((o=this.details)!=null&&o.live)this.hls.trigger(C.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(l!=null&&l.ended){this.log(`Cannot flush ${r} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(C.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:r})}}})}flushFrontBuffer(e,n,i){this.sourceBuffers.forEach(([r,s])=>{if(s){const o=Qe.getBuffered(s),a=o.length;if(a<2)return;const l=o.start(a-1),u=o.end(a-1);if(i>l||e>=l&&e<=u)return;this.hls.trigger(C.BUFFER_FLUSHING,{startOffset:l,endOffset:1/0,type:r})}})}getDurationAndRange(){var e;const{details:n,mediaSource:i}=this;if(!n||!this.media||(i==null?void 0:i.readyState)!=="open")return null;const r=n.edge;if(n.live&&this.hls.config.liveDurationInfinity){if(n.fragments.length&&i.setLiveSeekableRange){const u=Math.max(0,n.fragmentStart),c=Math.max(u,r);return{duration:1/0,start:u,end:c}}return{duration:1/0}}const s=(e=this.overrides)==null?void 0:e.duration;if(s)return Ce(s)?{duration:s}:null;const o=this.media.duration,a=Ce(i.duration)?i.duration:0;return r>a&&r>o||!Ce(o)?{duration:r}:null}updateMediaSource({duration:e,start:n,end:i}){const r=this.mediaSource;!this.media||!r||r.readyState!=="open"||(r.duration!==e&&(Ce(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),r.duration=e),n!==void 0&&i!==void 0&&(this.log(`MediaSource duration is set to ${r.duration}. Setting seekable range to ${n}-${i}.`),r.setLiveSeekableRange(n,i)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:n,tracks:i}=this;if(this.log(`checkPendingTracks (pending: ${n} codec events expected: ${e}) ${It(i)}`),this.tracksReady){var r;const s=(r=this.transferData)==null?void 0:r.tracks;s&&Object.keys(s).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([n,i])=>{if(n){const r=this.tracks[n];e[n]={buffer:i,container:r.container,codec:r.codec,supplemental:r.supplemental,levelCodec:r.levelCodec,id:r.id,metadata:r.metadata}}}),this.hls.trigger(C.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([n])=>{this.executeNext(n)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(C.ERROR,{type:He.MEDIA_ERROR,details:Q.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:n,mediaSource:i}=this;if(!i)throw new Error("createSourceBuffers called when mediaSource was null");for(const s in e){const o=s,a=e[o];if(this.isPending(a)){const l=this.getTrackCodec(a,o),u=`${a.container};codecs=${l}`;a.codec=l,this.log(`creating sourceBuffer(${u})${this.currentOp(o)?" Queued":""} ${It(a)}`);try{const c=i.addSourceBuffer(u),d=_E(o),f=[o,c];n[d]=f,a.buffer=c}catch(c){var r;this.error(`error while trying to add sourceBuffer: ${c.message}`),this.shiftAndExecuteNext(o),(r=this.operationQueue)==null||r.removeBlockers(),delete this.tracks[o],this.hls.trigger(C.ERROR,{type:He.MEDIA_ERROR,details:Q.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:c,sourceBufferName:o,mimeType:u,parent:a.id});return}this.trackSourceBuffer(o,a)}}this.bufferCreated()}getTrackCodec(e,n){const i=e.supplemental;let r=e.codec;i&&(n==="video"||n==="audiovideo")&&fd(i,"video")&&(r=Ore(r,i));const s=Fp(r,e.levelCodec);return s?n.slice(0,5)==="audio"?Mp(s,this.appendSource):s:""}trackSourceBuffer(e,n){const i=n.buffer;if(!i)return;const r=this.getTrackCodec(n,e);this.tracks[e]={buffer:i,codec:r,container:n.container,levelCodec:n.levelCodec,supplemental:n.supplemental,metadata:n.metadata,id:n.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(s,o)=>{const a=o.removedRanges;a!=null&&a.length&&this.hls.trigger(C.BUFFER_FLUSHED,{type:s})})}get mediaSrc(){var e,n;const i=((e=this.media)==null||(n=e.querySelector)==null?void 0:n.call(e,"source"))||this.media;return i==null?void 0:i.src}onSBUpdateStart(e){const n=this.currentOp(e);n&&n.onStart()}onSBUpdateEnd(e){var n;if(((n=this.mediaSource)==null?void 0:n.readyState)==="closed"){this.resetBuffer(e);return}const i=this.currentOp(e);i&&(i.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,n){var i;const r=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(i=this.mediaSource)==null?void 0:i.readyState}`);this.error(`${r}`,n),this.hls.trigger(C.ERROR,{type:He.MEDIA_ERROR,details:Q.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:r,fatal:!1});const s=this.currentOp(e);s&&s.onError(r)}updateTimestampOffset(e,n,i,r,s,o){const a=n-e.timestampOffset;Math.abs(a)>=i&&(this.log(`Updating ${r} SourceBuffer timestampOffset to ${n} (sn: ${s} cc: ${o})`),e.timestampOffset=n)}removeExecutor(e,n,i){const{media:r,mediaSource:s}=this,o=this.tracks[e],a=o==null?void 0:o.buffer;if(!r||!s||!a){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const l=Ce(r.duration)?r.duration:1/0,u=Ce(s.duration)?s.duration:1/0,c=Math.max(0,n),d=Math.min(i,l,u);d>c&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${c},${d}] from the ${e} SourceBuffer`),a.remove(c,d)):this.shiftAndExecuteNext(e)}appendExecutor(e,n){const i=this.tracks[n],r=i==null?void 0:i.buffer;if(!r)throw new Voe(`Attempting to append to the ${n} SourceBuffer, but it does not exist`);i.ending=!1,i.ended=!1,r.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(n=>{this.warn(`SourceBuffer blocked callback ${n}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(n){this.warn(`Callback run without blocking ${this.operationQueue} ${n}`)}}isUpdating(){return this.sourceBuffers.some(([e,n])=>e&&n.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,n=this.sourceBufferTypes){if(!n.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:i}=this,r=n.map(o=>this.appendBlocker(o));return n.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(r).then(o=>{i===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(n=>{var i;const r=(i=this.tracks[n])==null?void 0:i.buffer;!r||r.updating||this.shiftAndExecuteNext(n)})}append(e,n,i){this.operationQueue&&this.operationQueue.append(e,n,i)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,n)=>e+(this.isPending(this.tracks[n])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[n])=>e+(n?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,n,i){const r=this.tracks[e];if(!r)return;const s=r.buffer;if(!s)return;const o=i.bind(this,e);r.listeners.push({event:n,listener:o}),s.addEventListener(n,o)}removeBufferListeners(e){const n=this.tracks[e];if(!n)return;const i=n.buffer;i&&(n.listeners.forEach(r=>{i.removeEventListener(r.event,r.listener)}),n.listeners.length=0)}}function ON(t){const e=t.querySelectorAll("source");[].slice.call(e).forEach(n=>{t.removeChild(n)})}function joe(t,e){const n=self.document.createElement("source");n.type="video/mp4",n.src=e,t.appendChild(n)}function _E(t){return t==="audio"?1:0}class AE{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(C.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(C.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(C.MANIFEST_PARSED,this.onManifestParsed,this),e.on(C.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(C.BUFFER_CODECS,this.onBufferCodecs,this),e.on(C.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(C.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(C.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(C.MANIFEST_PARSED,this.onManifestParsed,this),e.off(C.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(C.BUFFER_CODECS,this.onBufferCodecs,this),e.off(C.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,n){const i=this.hls.levels[n.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(e,n){this.media=n.media instanceof HTMLVideoElement?n.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,n){const i=this.hls;this.restrictedLevels=[],this.firstLevel=n.firstLevel,i.config.capLevelToPlayerSize&&n.video&&this.startCapping()}onLevelsUpdated(e,n){this.timer&&Ce(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,n){this.hls.config.capLevelToPlayerSize&&n.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const n=this.hls,i=this.getMaxLevel(e.length-1);i!==this.autoLevelCapping&&n.logger.log(`Setting autoLevelCapping to ${i}: ${e[i].height}p@${e[i].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),n.autoLevelCapping=i,n.autoLevelEnabled&&n.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=n.autoLevelCapping}}}getMaxLevel(e){const n=this.hls.levels;if(!n.length)return-1;const i=n.filter((r,s)=>this.isLevelAllowed(r)&&s<=e);return this.clientRect=null,AE.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,n={width:0,height:0};if(e){const i=e.getBoundingClientRect();n.width=i.width,n.height=i.height,!n.width&&!n.height&&(n.width=i.right-i.left||e.width||0,n.height=i.bottom-i.top||e.height||0)}return this.clientRect=n,n}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(i=>e.bitrate===i.bitrate&&e.width===i.width&&e.height===i.height)}static getMaxLevelByMediaSize(e,n,i){if(!(e!=null&&e.length))return-1;const r=(a,l)=>l?a.width!==l.width||a.height!==l.height:!0;let s=e.length-1;const o=Math.max(n,i);for(let a=0;a<e.length;a+=1){const l=e[a];if((l.width>=o||l.height>=o)&&r(l,e[a+1])){s=a;break}}return s}}const ai={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Woe={HLS:"h"};class Dr{constructor(e,n){Array.isArray(e)&&(e=e.map(i=>i instanceof Dr?i:new Dr(i))),this.value=e,this.params=n}}const qoe="Dict";function Koe(t){return Array.isArray(t)?JSON.stringify(t):t instanceof Map?"Map{}":t instanceof Set?"Set{}":typeof t=="object"?JSON.stringify(t):String(t)}function Yoe(t,e,n,i){return new Error(`failed to ${t} "${Koe(e)}" as ${n}`,{cause:i})}function Or(t,e,n){return Yoe("serialize",t,e,n)}class NN{constructor(e){this.description=e}}const MN="Bare Item",Xoe="Boolean";function Qoe(t){if(typeof t!="boolean")throw Or(t,Xoe);return t?"?1":"?0"}function Zoe(t){return btoa(String.fromCharCode(...t))}const Joe="Byte Sequence";function eae(t){if(ArrayBuffer.isView(t)===!1)throw Or(t,Joe);return`:${Zoe(t)}:`}const tae="Integer";function nae(t){return t<-999999999999999||999999999999999<t}function FN(t){if(nae(t))throw Or(t,tae);return t.toString()}function iae(t){return`@${FN(t.getTime()/1e3)}`}function BN(t,e){if(t<0)return-BN(-t,e);const n=Math.pow(10,e);if(Math.abs(t*n%1-.5)<Number.EPSILON){const r=Math.floor(t*n);return(r%2===0?r:r+1)/n}else return Math.round(t*n)/n}const rae="Decimal";function sae(t){const e=BN(t,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Or(t,rae);const n=e.toString();return n.includes(".")?n:`${n}.0`}const oae="String",aae=/[\x00-\x1f\x7f]+/;function lae(t){if(aae.test(t))throw Or(t,oae);return`"${t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function uae(t){return t.description||t.toString().slice(7,-1)}const cae="Token";function UN(t){const e=uae(t);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Or(e,cae);return e}function CE(t){switch(typeof t){case"number":if(!Ce(t))throw Or(t,MN);return Number.isInteger(t)?FN(t):sae(t);case"string":return lae(t);case"symbol":return UN(t);case"boolean":return Qoe(t);case"object":if(t instanceof Date)return iae(t);if(t instanceof Uint8Array)return eae(t);if(t instanceof NN)return UN(t);default:throw Or(t,MN)}}const dae="Key";function IE(t){if(/^[a-z*][a-z0-9\-_.*]*$/.test(t)===!1)throw Or(t,dae);return t}function RE(t){return t==null?"":Object.entries(t).map(([e,n])=>n===!0?`;${IE(e)}`:`;${IE(e)}=${CE(n)}`).join("")}function HN(t){return t instanceof Dr?`${CE(t.value)}${RE(t.params)}`:CE(t)}function fae(t){return`(${t.value.map(HN).join(" ")})${RE(t.params)}`}function hae(t,e={whitespace:!0}){if(typeof t!="object"||t==null)throw Or(t,qoe);const n=t instanceof Map?t.entries():Object.entries(t),i=e!=null&&e.whitespace?" ":"";return Array.from(n).map(([r,s])=>{s instanceof Dr||(s=new Dr(s));let o=IE(r);return s.value===!0?o+=RE(s.params):(o+="=",Array.isArray(s.value)?o+=fae(s):o+=HN(s)),o}).join(`,${i}`)}function $N(t,e){return hae(t,e)}const Nr="CMCD-Object",Qt="CMCD-Request",ha="CMCD-Session",ho="CMCD-Status",pae={br:Nr,ab:Nr,d:Nr,ot:Nr,tb:Nr,tpb:Nr,lb:Nr,tab:Nr,lab:Nr,url:Nr,pb:Qt,bl:Qt,tbl:Qt,dl:Qt,ltc:Qt,mtp:Qt,nor:Qt,nrr:Qt,rc:Qt,sn:Qt,sta:Qt,su:Qt,ttfb:Qt,ttfbb:Qt,ttlb:Qt,cmsdd:Qt,cmsds:Qt,smrt:Qt,df:Qt,cs:Qt,ts:Qt,cid:ha,pr:ha,sf:ha,sid:ha,st:ha,v:ha,msd:ha,bs:ho,bsd:ho,cdn:ho,rtp:ho,bg:ho,pt:ho,ec:ho,e:ho},mae={REQUEST:Qt};function gae(t){return Object.keys(t).reduce((e,n)=>{var i;return(i=t[n])===null||i===void 0||i.forEach(r=>e[r]=n),e},{})}function yae(t,e){const n={};if(!t)return n;const i=Object.keys(t),r=e?gae(e):{};return i.reduce((s,o)=>{var a;const l=pae[o]||r[o]||mae.REQUEST,u=(a=s[l])!==null&&a!==void 0?a:s[l]={};return u[o]=t[o],s},n)}function vae(t){return["ot","sf","st","e","sta"].includes(t)}function bae(t){return typeof t=="number"?Ce(t):t!=null&&t!==""&&t!==!1}const zN="event";function Eae(t,e){const n=new URL(t),i=new URL(e);if(n.origin!==i.origin)return t;const r=n.pathname.split("/").slice(1),s=i.pathname.split("/").slice(1,-1);for(;r[0]===s[0];)r.shift(),s.shift();for(;s.length;)s.shift(),r.unshift("..");return r.join("/")+n.search+n.hash}const i0=t=>Math.round(t),LE=(t,e)=>Array.isArray(t)?t.map(n=>LE(n,e)):t instanceof Dr&&typeof t.value=="string"?new Dr(LE(t.value,e),t.params):(e.baseUrl&&(t=Eae(t,e.baseUrl)),e.version===1?encodeURIComponent(t):t),r0=t=>i0(t/100)*100,Tae={br:i0,d:i0,bl:r0,dl:r0,mtp:r0,nor:(t,e)=>{let n=t;return e.version>=2&&(t instanceof Dr&&typeof t.value=="string"?n=new Dr([t]):typeof t=="string"&&(n=[t])),LE(n,e)},rtp:r0,tb:i0},VN="request",GN="response",PE=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],Sae=["e"],xae=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function s0(t){return xae.test(t)}function wae(t){return PE.includes(t)||Sae.includes(t)||s0(t)}const jN=["d","dl","nor","ot","rtp","su"];function _ae(t){return PE.includes(t)||jN.includes(t)||s0(t)}const Aae=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function Cae(t){return PE.includes(t)||jN.includes(t)||Aae.includes(t)||s0(t)}const Iae=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function Rae(t){return Iae.includes(t)||s0(t)}const Lae={[GN]:Cae,[zN]:wae,[VN]:_ae};function WN(t,e={}){const n={};if(t==null||typeof t!="object")return n;const i=e.version||t.v||1,r=e.reportingMode||VN,s=i===1?Rae:Lae[r];let o=Object.keys(t).filter(s);const a=e.filter;typeof a=="function"&&(o=o.filter(a));const l=r===GN||r===zN;l&&!o.includes("ts")&&o.push("ts"),i>1&&!o.includes("v")&&o.push("v");const u=xt({},Tae,e.formatters),c={version:i,reportingMode:r,baseUrl:e.baseUrl};return o.sort().forEach(d=>{let f=t[d];const h=u[d];if(typeof h=="function"&&(f=h(f,c)),d==="v"){if(i===1)return;f=i}d=="pr"&&f===1||(l&&d==="ts"&&!Ce(f)&&(f=Date.now()),bae(f)&&(vae(d)&&typeof f=="string"&&(f=new NN(f)),n[d]=f))}),n}function Pae(t,e={}){const n={};if(!t)return n;const i=WN(t,e),r=yae(i,e==null?void 0:e.customHeaderMap);return Object.entries(r).reduce((s,[o,a])=>{const l=$N(a,{whitespace:!1});return l&&(s[o]=l),s},n)}function kae(t,e,n){return xt(t,Pae(e,n))}const Dae="CMCD";function Oae(t,e={}){return t?$N(WN(t,e),{whitespace:!1}):""}function Nae(t,e={}){if(!t)return"";const n=Oae(t,e);return encodeURIComponent(n)}function Mae(t,e={}){if(!t)return"";const n=Nae(t,e);return`${Dae}=${n}`}const qN=/CMCD=[^&#]+/;function Fae(t,e,n){const i=Mae(e,n);if(!i)return t;if(qN.test(t))return t.replace(qN,i);const r=t.includes("?")?"&":"?";return`${t}${r}${i}`}class Bae{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=r=>{try{this.apply(r,{ot:ai.MANIFEST,su:!this.initialized})}catch(s){this.hls.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=r=>{try{const{frag:s,part:o}=r,a=this.hls.levels[s.level],l=this.getObjectType(s),u={d:(o||s).duration*1e3,ot:l};(l===ai.VIDEO||l===ai.AUDIO||l==ai.MUXED)&&(u.br=a.bitrate/1e3,u.tb=this.getTopBandwidth(l)/1e3,u.bl=this.getBufferLength(l));const c=o?this.getNextPart(o):this.getNextFrag(s);c!=null&&c.url&&c.url!==s.url&&(u.nor=c.url),this.apply(r,u)}catch(s){this.hls.logger.warn("Could not generate segment CMCD data.",s)}},this.hls=e;const n=this.config=e.config,{cmcd:i}=n;i!=null&&(n.pLoader=this.createPlaylistLoader(),n.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||e.sessionId,this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.includeKeys=i.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(C.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(C.MEDIA_DETACHED,this.onMediaDetached,this),e.on(C.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(C.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(C.MEDIA_DETACHED,this.onMediaDetached,this),e.off(C.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,n){this.media=n.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,n){var i,r;this.audioBuffer=(i=n.tracks.audio)==null?void 0:i.buffer,this.videoBuffer=(r=n.tracks.video)==null?void 0:r.buffer}createData(){var e;return{v:1,sf:Woe.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,n={}){xt(n,this.createData());const i=n.ot===ai.INIT||n.ot===ai.VIDEO||n.ot===ai.MUXED;this.starved&&i&&(n.bs=!0,n.su=!0,this.starved=!1),n.su==null&&(n.su=this.buffering);const{includeKeys:r}=this;r&&(n=Object.keys(n).reduce((o,a)=>(r.includes(a)&&(o[a]=n[a]),o),{}));const s={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),kae(e.headers,n,s)):e.url=Fae(e.url,n,s)}getNextFrag(e){var n;const i=(n=this.hls.levels[e.level])==null?void 0:n.details;if(i){const r=e.sn-i.startSN;return i.fragments[r+1]}}getNextPart(e){var n;const{index:i,fragment:r}=e,s=(n=this.hls.levels[r.level])==null||(n=n.details)==null?void 0:n.partList;if(s){const{sn:o}=r;for(let a=s.length-1;a>=0;a--){const l=s[a];if(l.index===i&&l.fragment.sn===o)return s[a+1]}}}getObjectType(e){const{type:n}=e;if(n==="subtitle")return ai.TIMED_TEXT;if(e.sn==="initSegment")return ai.INIT;if(n==="audio")return ai.AUDIO;if(n==="main")return this.hls.audioTracks.length?ai.VIDEO:ai.MUXED}getTopBandwidth(e){let n=0,i;const r=this.hls;if(e===ai.AUDIO)i=r.audioTracks;else{const s=r.maxAutoLevel,o=s>-1?s+1:r.levels.length;i=r.levels.slice(0,o)}return i.forEach(s=>{s.bitrate>n&&(n=s.bitrate)}),n>0?n:NaN}getBufferLength(e){const n=this.media,i=e===ai.AUDIO?this.audioBuffer:this.videoBuffer;return!i||!n?NaN:Qe.bufferInfo(i,n.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,n=this.applyPlaylistData,i=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new i(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,o,a){n(s),this.loader.load(s,o,a)}}}createFragmentLoader(){const{fLoader:e}=this.config,n=this.applyFragmentData,i=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new i(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,o,a){n(s),this.loader.load(s,o,a)}}}}const Uae=3e5;class Hae extends Hi{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(C.MANIFEST_LOADING,this.onManifestLoading,this),e.on(C.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(C.MANIFEST_PARSED,this.onManifestParsed,this),e.on(C.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(C.MANIFEST_LOADING,this.onManifestLoading,this),e.off(C.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(C.MANIFEST_PARSED,this.onManifestParsed,this),e.off(C.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,n)=>(e.indexOf(n.pathwayId)===-1&&e.push(n.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const n=this.levels;n&&(this.levels=n.filter(i=>i!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,n){const{contentSteering:i}=n;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(e,n){this.audioTracks=n.audioTracks,this.subtitleTracks=n.subtitleTracks}onError(e,n){const{errorAction:i}=n;if((i==null?void 0:i.action)===Cn.SendAlternateToPenaltyBox&&i.flags===Ti.MoveAllAlternatesMatchingHost){const r=this.levels;let s=this._pathwayPriority,o=this.pathwayId;if(n.context){const{groupId:a,pathwayId:l,type:u}=n.context;a&&r?o=this.getPathwayForGroupId(a,u,o):l&&(o=l)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!s&&r&&(s=this.pathways()),s&&s.length>1&&(this.updatePathwayPriority(s),i.resolved=this.pathwayId!==o),n.details===Q.BUFFER_APPEND_ERROR&&!n.fatal?i.resolved=!0:i.resolved||this.warn(`Could not resolve ${n.details} ("${n.error.message}") with content-steering for Pathway: ${o} levels: ${r&&r.length} priorities: ${It(s)} penalized: ${It(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let n=this.getLevelsForPathway(this.pathwayId);if(n.length===0){const i=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),n=this.getLevelsForPathway(i),this.pathwayId=i}return n.length!==e.length&&this.log(`Found ${n.length}/${e.length} levels in Pathway "${this.pathwayId}"`),n}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(n=>e===n.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let n;const i=this.penalizedPathways,r=performance.now();Object.keys(i).forEach(s=>{r-i[s]>Uae&&delete i[s]});for(let s=0;s<e.length;s++){const o=e[s];if(o in i)continue;if(o===this.pathwayId)return;const a=this.hls.nextLoadLevel,l=this.hls.levels[a];if(n=this.getLevelsForPathway(o),n.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,QO(n),this.hls.trigger(C.LEVELS_UPDATED,{levels:n});const u=this.hls.levels[a];l&&u&&this.levels&&(u.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&u.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${u.bitrate}`),this.hls.nextLoadLevel=a);break}}}getPathwayForGroupId(e,n,i){const r=this.getLevelsForPathway(i).concat(this.levels||[]);for(let s=0;s<r.length;s++)if(n===dt.AUDIO_TRACK&&r[s].hasAudioGroup(e)||n===dt.SUBTITLE_TRACK&&r[s].hasSubtitleGroup(e))return r[s].pathwayId;return i}clonePathways(e){const n=this.levels;if(!n)return;const i={},r={};e.forEach(s=>{const{ID:o,"BASE-ID":a,"URI-REPLACEMENT":l}=s;if(n.some(c=>c.pathwayId===o))return;const u=this.getLevelsForPathway(a).map(c=>{const d=new qt(c.attrs);d["PATHWAY-ID"]=o;const f=d.AUDIO&&`${d.AUDIO}_clone_${o}`,h=d.SUBTITLES&&`${d.SUBTITLES}_clone_${o}`;f&&(i[d.AUDIO]=f,d.AUDIO=f),h&&(r[d.SUBTITLES]=h,d.SUBTITLES=h);const p=YN(c.uri,d["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),m=new pd({attrs:d,audioCodec:c.audioCodec,bitrate:c.bitrate,height:c.height,name:c.name,url:p,videoCodec:c.videoCodec,width:c.width});if(c.audioGroups)for(let y=1;y<c.audioGroups.length;y++)m.addGroupId("audio",`${c.audioGroups[y]}_clone_${o}`);if(c.subtitleGroups)for(let y=1;y<c.subtitleGroups.length;y++)m.addGroupId("text",`${c.subtitleGroups[y]}_clone_${o}`);return m});n.push(...u),KN(this.audioTracks,i,l,o),KN(this.subtitleTracks,r,l,o)})}loadSteeringManifest(e){const n=this.hls.config,i=n.loader;this.loader&&this.loader.destroy(),this.loader=new i(n);let r;try{r=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(r.protocol!=="data:"){const c=(this.hls.bandwidthEstimate||n.abrEwmaDefaultEstimate)|0;r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+c)}const s={responseType:"json",url:r.href},o=n.steeringManifestLoadPolicy.default,a=o.errorRetry||o.timeoutRetry||{},l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},u={onSuccess:(c,d,f,h)=>{this.log(`Loaded steering manifest: "${r}"`);const p=c.data;if((p==null?void 0:p.VERSION)!==1){this.log(`Steering VERSION ${p.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=p.TTL;const{"RELOAD-URI":m,"PATHWAY-CLONES":y,"PATHWAY-PRIORITY":g}=p;if(m)try{this.uri=new self.URL(m,r).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${m}`);return}this.scheduleRefresh(this.uri||f.url),y&&this.clonePathways(y);const v={steeringManifest:p,url:r.toString()};this.hls.trigger(C.STEERING_MANIFEST_LOADED,v),g&&this.updatePathwayPriority(g)},onError:(c,d,f,h)=>{if(this.log(`Error loading steering manifest: ${c.code} ${c.text} (${d.url})`),this.stopLoad(),c.code===410){this.enabled=!1,this.log(`Steering manifest ${d.url} no longer available`);return}let p=this.timeToLoad*1e3;if(c.code===429){const m=this.loader;if(typeof(m==null?void 0:m.getResponseHeader)=="function"){const y=m.getResponseHeader("Retry-After");y&&(p=parseFloat(y)*1e3)}this.log(`Steering manifest ${d.url} rate limited`);return}this.scheduleRefresh(this.uri||d.url,p)},onTimeout:(c,d,f)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(s,l,u)}scheduleRefresh(e,n=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var i;const r=(i=this.hls)==null?void 0:i.media;if(r&&!r.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},n)}}function KN(t,e,n,i){t&&Object.keys(e).forEach(r=>{const s=t.filter(o=>o.groupId===r).map(o=>{const a=xt({},o);return a.details=void 0,a.attrs=new qt(a.attrs),a.url=a.attrs.URI=YN(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",n),a.groupId=a.attrs["GROUP-ID"]=e[r],a.attrs["PATHWAY-ID"]=i,a});t.push(...s)})}function YN(t,e,n,i){const{HOST:r,PARAMS:s,[n]:o}=i;let a;e&&(a=o==null?void 0:o[e],a&&(t=a));const l=new self.URL(t);return r&&!a&&(l.host=r),s&&Object.keys(s).sort().forEach(u=>{u&&l.searchParams.set(u,s[u])}),l.href}class Kl extends Hi{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Kl.CDMCleanupPromise?[Kl.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=n=>{const{initDataType:i,initData:r}=n,s=`"${n.type}" event: init data type: "${i}"`;if(this.debug(s),r!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=md(this.config));const a=o.map(iE).filter(l=>!!l);this.keyFormatPromise=this.getKeyFormatPromise(a)}this.keyFormatPromise.then(o=>{const a=qp(o);if(i!=="sinf"||a!==Kt.FAIRPLAY){this.log(`Ignoring "${n.type}" event with init data type: "${i}" for selected key-system ${a}`);return}let l;try{const h=pn(new Uint8Array(r)),p=tE(JSON.parse(h).sinf),m=qD(p);if(!m)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");l=new Uint8Array(m.subarray(8,24))}catch(h){this.warn(`${s} Failed to parse sinf: ${h}`);return}const u=zn(l),{keyIdToKeySessionPromise:c,mediaKeySessions:d}=this;let f=c[u];for(let h=0;h<d.length;h++){const p=d[h],m=p.decryptdata;if(!m.keyId)continue;const y=zn(m.keyId);if(jp(l,m.keyId)||m.uri.replace(/-/g,"").indexOf(u)!==-1){if(f=c[y],!f)continue;if(m.pssh)break;delete c[y],m.pssh=new Uint8Array(r),m.keyId=l,f=c[u]=f.then(()=>this.generateRequestWithPreferredKeySession(p,i,r,"encrypted-event-key-match")),f.catch(g=>this.handleError(g));break}}f||this.handleError(new Error(`Key ID ${u} not encountered in playlist. Key-system sessions ${d.length}.`))}).catch(o=>this.handleError(o))}},this.onWaitingForKey=n=>{this.log(`"${n.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(C.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(C.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(C.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(C.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(C.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(C.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(C.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(C.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(C.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(C.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:n,widevineLicenseUrl:i}=this.config,r=n==null?void 0:n[e];if(r)return r.licenseUrl;if(e===Kt.WIDEVINE&&i)return i}getLicenseServerUrlOrThrow(e){const n=this.getLicenseServerUrl(e);if(n===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return n}getServerCertificateUrl(e){const{drmSystems:n}=this.config,i=n==null?void 0:n[e];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const n=this.hls.levels,i=(o,a,l)=>!!o&&l.indexOf(o)===a,r=n.map(o=>o.audioCodec).filter(i),s=n.map(o=>o.videoCodec).filter(i);return r.length+s.length===0&&s.push("avc1.42e01e"),new Promise((o,a)=>{const l=u=>{const c=u.shift();this.getMediaKeysPromise(c,r,s).then(d=>o({keySystem:c,mediaKeys:d})).catch(d=>{u.length?l(u):d instanceof wi?a(d):a(new wi({type:He.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_NO_ACCESS,error:d,fatal:!0},d.message))})};l(e)})}requestMediaKeySystemAccess(e,n){const{requestMediaKeySystemAccessFunc:i}=this.config;if(typeof i!="function"){let r=`Configured requestMediaKeySystemAccess is not a function ${i}`;return PO===null&&self.location.protocol==="http:"&&(r=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(r))}return i(e,n)}getMediaKeysPromise(e,n,i){var r;const s=xse(e,n,i,this.config.drmSystemOptions||{});let o=this.keySystemAccessPromises[e],a=(r=o)==null?void 0:r.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${e}" key-system access with config: ${It(s)}`),a=this.requestMediaKeySystemAccess(e,s);const l=o=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(u=>{this.log(`Failed to obtain access to key-system "${e}": ${u}`)}),a.then(u=>{this.log(`Access for key-system "${u.keySystem}" obtained`);const c=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const d=l.mediaKeys=u.createMediaKeys().then(f=>(this.log(`Media-keys created for "${e}"`),l.hasMediaKeys=!0,c.then(h=>h?this.setMediaKeysServerCertificate(f,e,h):f)));return d.catch(f=>{this.error(`Failed to create media-keys for "${e}"}: ${f}`)}),d})}return a.then(()=>o.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:n,mediaKeys:i}){this.log(`Creating key-system session "${n}" keyId: ${zn(e.keyId||[])} keyUri: ${e.uri}`);const r=i.createSession(),s={decryptdata:e,keySystem:n,mediaKeys:i,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(e){const n=e.decryptdata;if(n.pssh){const i=this.createMediaKeySessionContext(e),r=o0(n),s="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(i,s,n.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,n){const i=e.mediaKeysSession;return this.log(`Updating key-session "${i.sessionId}" for keyId ${zn(e.decryptdata.keyId||[])}
      } (data length: ${n.byteLength})`),i.update(n)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>iE(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:n,mediaKeys:i})=>this.attemptSetMediaKeys(n,i))}selectKeySystem(e){return new Promise((n,i)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:r})=>{const s=iE(r);s?n(s):i(new Error(`Unable to find format for key-system "${r}"`))}).catch(i)})}selectKeySystemFormat(e){const n=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${n.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(n)),this.keyFormatPromise}getKeyFormatPromise(e){const n=md(this.config),i=e.map(qp).filter(r=>!!r&&n.indexOf(r)!==-1);return this.selectKeySystem(i)}getKeyStatus(e){const{mediaKeySessions:n}=this;for(let i=0;i<n.length;i++){const r=$ae(e,n[i]);if(r)return r}}loadKey(e){const n=e.keyInfo.decryptdata,i=o0(n),r=this.bannedKeyIds[i];if(r||this.getKeyStatus(n)==="internal-error"){const a=XN(r||"internal-error",n);return this.handleError(a,e.frag),Promise.reject(a)}const s=`(keyId: ${i} format: "${n.keyFormat}" method: ${n.method} uri: ${n.uri})`;this.log(`Starting session for key ${s}`);const o=this.keyIdToKeySessionPromise[i];if(!o){const a=this.getKeySystemForKeyPromise(n).then(({keySystem:l,mediaKeys:u})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${s}`),this.attemptSetMediaKeys(l,u).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:l,mediaKeys:u,decryptdata:n}))))).then(l=>{const u="cenc",c=n.pssh?n.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(l,u,c,"playlist-key")});return a.catch(l=>this.handleError(l,e.frag)),this.keyIdToKeySessionPromise[i]=a,a}return o.catch(a=>{if(a instanceof wi){const l=bt({},a.data);this.getKeyStatus(n)==="internal-error"&&(l.decryptdata=n);const u=new wi(l,a.message);this.handleError(u,e.frag)}}),o}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,n){if(this.hls)if(e instanceof wi){n&&(e.data.frag=n);const i=e.data.decryptdata;this.error(`${e.message}${i?` (${zn(i.keyId||[])})`:""}`),this.hls.trigger(C.ERROR,e.data)}else this.error(e.message),this.hls.trigger(C.ERROR,{type:He.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const n=o0(e),i=this.keyIdToKeySessionPromise[n];if(!i){const r=qp(e.keyFormat),s=r?[r]:md(this.config);return this.attemptKeySystemAccess(s)}return i}getKeySystemSelectionPromise(e){if(e.length||(e=md(this.config)),e.length===0)throw new wi({type:He.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${It({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,n){if(this.mediaKeys===n)return Promise.resolve();const i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const r=Promise.all(i).then(()=>{if(!this.media)throw this.mediaKeys=null,new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(n)});return this.mediaKeys=n,this.setMediaKeysQueue.push(r),r.then(()=>{this.log(`Media-keys set for "${e}"`),i.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(s=>i.indexOf(s)===-1)})}generateRequestWithPreferredKeySession(e,n,i,r){var s;const o=(s=this.config.drmSystems)==null||(s=s[e.keySystem])==null?void 0:s.generateRequest;if(o)try{const p=o.call(this.hls,n,i,e);if(!p)throw new Error("Invalid response from configured generateRequest filter");n=p.initDataType,i=p.initData?p.initData:null,e.decryptdata.pssh=i?new Uint8Array(i):null}catch(p){if(this.warn(p.message),this.hls&&this.hls.config.debug)throw p}if(i===null)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(e);const a=o0(e.decryptdata),l=e.decryptdata.uri;this.log(`Generating key-session request for "${r}" keyId: ${a} URI: ${l} (init data type: ${n} length: ${i.byteLength})`);const u=new cE,c=e._onmessage=p=>{const m=e.mediaKeysSession;if(!m){u.emit("error",new Error("invalid state"));return}const{messageType:y,message:g}=p;this.log(`"${y}" message event for session "${m.sessionId}" message size: ${g.byteLength}`),y==="license-request"||y==="license-renewal"?this.renewLicense(e,g).catch(v=>{u.eventNames().length?u.emit("error",v):this.handleError(v)}):y==="license-release"?e.keySystem===Kt.FAIRPLAY&&this.updateKeySession(e,nE("acknowledged")).then(()=>this.removeSession(e)).catch(v=>this.handleError(v)):this.warn(`unhandled media key message type "${y}"`)},d=(p,m)=>{m.keyStatus=p;let y;p.startsWith("usable")?u.emit("resolved"):p==="internal-error"||p==="output-restricted"||p==="output-downscaled"?y=XN(p,m.decryptdata):p==="expired"?y=new Error(`key expired (keyId: ${a})`):p==="released"?y=new Error("key released"):p==="status-pending"||this.warn(`unhandled key status change "${p}" (keyId: ${a})`),y&&(u.eventNames().length?u.emit("error",y):this.handleError(y))},f=e._onkeystatuseschange=p=>{if(!e.mediaKeysSession){u.emit("error",new Error("invalid state"));return}const y=this.getKeyStatuses(e);if(!Object.keys(y).some(T=>y[T]!=="status-pending"))return;if(y[a]==="expired"){this.log(`Expired key ${It(y)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let v=y[a];if(v)d(v,e);else{var b;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(b=e.keyStatusTimeouts)[a]||(b[a]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const S=this.getKeyStatus(e.decryptdata);if(S&&S!=="status-pending")return this.log(`No status for keyId ${a} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${S} from other session.`),d(S,e);this.log(`key status for ${a} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),v="internal-error",d(v,e)},1e3)),this.log(`No status for keyId ${a} (${It(y)}).`)}};Vn(e.mediaKeysSession,"message",c),Vn(e.mediaKeysSession,"keystatuseschange",f);const h=new Promise((p,m)=>{u.on("error",m),u.on("resolved",p)});return e.mediaKeysSession.generateRequest(n,i).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${a} URI: ${l}`)}).catch(p=>{throw new wi({type:He.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_NO_SESSION,error:p,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${p}`)}).then(()=>h).catch(p=>(u.removeAllListeners(),this.removeSession(e).then(()=>{throw p}))).then(()=>(u.removeAllListeners(),e))}getKeyStatuses(e){const n={};return e.mediaKeysSession.keyStatuses.forEach((i,r)=>{if(typeof r=="string"&&typeof i=="object"){const a=r;r=i,i=a}const s="buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r);e.keySystem===Kt.PLAYREADY&&s.length===16&&RO(s);const o=zn(s);i==="internal-error"&&(this.bannedKeyIds[o]=i),this.log(`key status change "${i}" for keyStatuses keyId: ${o} key-session "${e.mediaKeysSession.sessionId}"`),n[o]=i}),n}fetchServerCertificate(e){const n=this.config,i=n.loader,r=new i(n),s=this.getServerCertificateUrl(e);return s?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,a)=>{const l={responseType:"arraybuffer",url:s},u=n.certLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,h,p,m)=>{o(f.data)},onError:(f,h,p,m)=>{a(new wi({type:He.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:p,response:bt({url:l.url,data:void 0},f)},`"${e}" certificate request failed (${s}). Status: ${f.code} (${f.text})`))},onTimeout:(f,h,p)=>{a(new wi({type:He.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:p,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${s})`))},onAbort:(f,h,p)=>{a(new Error("aborted"))}};r.load(l,c,d)})):Promise.resolve()}setMediaKeysServerCertificate(e,n,i){return new Promise((r,s)=>{e.setServerCertificate(i).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${i.byteLength}) on "${n}"`),r(e)}).catch(o=>{s(new wi({type:He.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,n){return this.requestLicense(e,new Uint8Array(n)).then(i=>this.updateKeySession(e,new Uint8Array(i)).catch(r=>{throw new wi({type:He.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:r,fatal:!1},r.message)}))}unpackPlayReadyKeyMessage(e,n){const i=String.fromCharCode.apply(null,new Uint16Array(n.buffer));if(!i.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),n;const r=new DOMParser().parseFromString(i,"application/xml"),s=r.querySelectorAll("HttpHeader");if(s.length>0){let c;for(let d=0,f=s.length;d<f;d++){var o,a;c=s[d];const h=(o=c.querySelector("name"))==null?void 0:o.textContent,p=(a=c.querySelector("value"))==null?void 0:a.textContent;h&&p&&e.setRequestHeader(h,p)}}const l=r.querySelector("Challenge"),u=l==null?void 0:l.textContent;if(!u)throw new Error("Cannot find <Challenge> in key message");return nE(atob(u))}setupLicenseXHR(e,n,i,r){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!i.decryptdata)throw new Error("Key removed");return s.call(this.hls,e,n,i,r)}).catch(o=>{if(!i.decryptdata)throw o;return e.open("POST",n,!0),s.call(this.hls,e,n,i,r)}).then(o=>(e.readyState||e.open("POST",n,!0),{xhr:e,licenseChallenge:o||r})):(e.open("POST",n,!0),Promise.resolve({xhr:e,licenseChallenge:r}))}requestLicense(e,n){const i=this.config.keyLoadPolicy.default;return new Promise((r,s)=>{const o=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${o}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(a.readyState===4)if(a.status===200){this._requestLicenseFailureCount=0;let l=a.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const u=this.config.licenseResponseCallback;if(u)try{l=u.call(this.hls,a,o,e)}catch(c){this.error(c)}r(l)}else{const l=i.errorRetry,u=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u||a.status>=400&&a.status<500)s(new wi({type:He.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:a,response:{url:o,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${o}). Status: ${a.status} (${a.statusText})`));else{const c=u-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${c} attempts left`),this.requestLicense(e,n).then(r,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,o,e,n).then(({xhr:l,licenseChallenge:u})=>{e.keySystem==Kt.PLAYREADY&&(u=this.unpackPlayReadyKeyMessage(l,u)),l.send(u)}).catch(s)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,n){if(!this.config.emeEnabled)return;const i=n.media;this.media=i,Vn(i,"encrypted",this.onMediaEncrypted),Vn(i,"waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(oi(e,"encrypted",this.onMediaEncrypted),oi(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={},!this.mediaKeys&&!this.mediaKeySessions.length)return;const n=this.media,i=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,fa.clearKeyUriToKeyIdMap();const r=i.length;Kl.CDMCleanupPromise=Promise.all(i.map(s=>this.removeSession(s)).concat((n==null||(e=n.setMediaKeys(null))==null?void 0:e.catch(s=>{this.log(`Could not clear media keys: ${s}`),this.hls&&this.hls.trigger(C.ERROR,{type:He.OTHER_ERROR,details:Q.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${s}`)})}))||Promise.resolve())).catch(s=>{this.log(`Could not close sessions and clear media keys: ${s}`),this.hls&&this.hls.trigger(C.ERROR,{type:He.OTHER_ERROR,details:Q.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${s}`)})}).then(()=>{r&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this.keyFormatPromise=null,this.bannedKeyIds={}}onManifestLoaded(e,{sessionKeys:n}){if(!(!n||!this.config.emeEnabled)&&!this.keyFormatPromise){const i=n.reduce((r,s)=>(r.indexOf(s.keyFormat)===-1&&r.push(s.keyFormat),r),[]);this.log(`Selecting key-system from session-keys ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)}}removeSession(e){const{mediaKeysSession:n,licenseXhr:i,decryptdata:r}=e;if(n){this.log(`Remove licenses and keys and close session "${n.sessionId}" keyId: ${zn((r==null?void 0:r.keyId)||[])}`),e._onmessage&&(n.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(n.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const s=this.mediaKeySessions.indexOf(e);s>-1&&this.mediaKeySessions.splice(s,1);const{keyStatusTimeouts:o}=e;o&&Object.keys(o).forEach(u=>self.clearTimeout(o[u]));const{drmSystemOptions:a}=this.config;return(_se(a)?new Promise((u,c)=>{self.setTimeout(()=>c(new Error("MediaKeySession.remove() timeout")),8e3),n.remove().then(u).catch(c)}):Promise.resolve()).catch(u=>{this.log(`Could not remove session: ${u}`),this.hls&&this.hls.trigger(C.ERROR,{type:He.OTHER_ERROR,details:Q.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${u}`)})}).then(()=>n.close()).catch(u=>{this.log(`Could not close session: ${u}`),this.hls&&this.hls.trigger(C.ERROR,{type:He.OTHER_ERROR,details:Q.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${u}`)})})}return Promise.resolve()}}Kl.CDMCleanupPromise=void 0;function o0(t){if(!t)throw new Error("Could not read keyId of undefined decryptdata");if(t.keyId===null)throw new Error("keyId is null");return zn(t.keyId)}function $ae(t,e){if(t.keyId&&e.mediaKeysSession.keyStatuses.has(t.keyId))return e.mediaKeysSession.keyStatuses.get(t.keyId);if(t.matches(e.decryptdata))return e.keyStatus}class wi extends Error{constructor(e,n){super(n),this.data=void 0,e.error||(e.error=new Error(n)),this.data=e,e.err=e.error}}function XN(t,e){const n=t==="output-restricted",i=n?Q.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:Q.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new wi({type:He.KEY_SYSTEM_ERROR,details:i,fatal:!1,decryptdata:e},n?"HDCP level output restricted":`key status changed to "${t}"`)}class zae{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(C.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(C.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(C.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(C.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,n){const i=this.hls.config;if(i.capLevelOnFPSDrop){const r=n.media instanceof self.HTMLVideoElement?n.media:null;this.media=r,r&&typeof r.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,n,i){const r=performance.now();if(n){if(this.lastTime){const s=r-this.lastTime,o=i-this.lastDroppedFrames,a=n-this.lastDecodedFrames,l=1e3*o/s,u=this.hls;if(u.trigger(C.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:i}),l>0&&o>u.config.fpsDroppedMonitoringThreshold*a){let c=u.currentLevel;u.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=c)&&(c=c-1,u.trigger(C.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:u.currentLevel}),u.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=i,this.lastDecodedFrames=n}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const n=e.getVideoPlaybackQuality();this.checkFPS(e,n.totalVideoFrames,n.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function QN(t,e){let n;try{n=new Event("addtrack")}catch{n=document.createEvent("Event"),n.initEvent("addtrack",!1,!1)}n.track=t,e.dispatchEvent(n)}function ZN(t,e){const n=t.mode;if(n==="disabled"&&(t.mode="hidden"),t.cues&&!t.cues.getCueById(e.id))try{if(t.addCue(e),!t.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(i){Et.debug(`[texttrack-utils]: ${i}`);try{const r=new self.TextTrackCue(e.startTime,e.endTime,e.text);r.id=e.id,t.addCue(r)}catch(r){Et.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${r}`)}}n==="disabled"&&(t.mode=n)}function Yl(t,e){const n=t.mode;if(n==="disabled"&&(t.mode="hidden"),t.cues)for(let i=t.cues.length;i--;)e&&t.cues[i].removeEventListener("enter",e),t.removeCue(t.cues[i]);n==="disabled"&&(t.mode=n)}function kE(t,e,n,i){const r=t.mode;if(r==="disabled"&&(t.mode="hidden"),t.cues&&t.cues.length>0){const s=Gae(t.cues,e,n);for(let o=0;o<s.length;o++)(!i||i(s[o]))&&t.removeCue(s[o])}r==="disabled"&&(t.mode=r)}function Vae(t,e){if(e<=t[0].startTime)return 0;const n=t.length-1;if(e>t[n].endTime)return-1;let i=0,r=n,s;for(;i<=r;)if(s=Math.floor((r+i)/2),e<t[s].startTime)r=s-1;else if(e>t[s].startTime&&i<n)i=s+1;else return s;return t[i].startTime-e<e-t[r].startTime?i:r}function Gae(t,e,n){const i=[],r=Vae(t,e);if(r>-1)for(let s=r,o=t.length;s<o;s++){const a=t[s];if(a.startTime>=e&&a.endTime<=n)i.push(a);else if(a.startTime>n)return i}return i}function a0(t){const e=[];for(let n=0;n<t.length;n++){const i=t[n];(i.kind==="subtitles"||i.kind==="captions")&&i.label&&e.push(t[n])}return e}class jae extends xE{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let n=null;const i=a0(this.media.textTracks);for(let s=0;s<i.length;s++)if(i[s].mode==="hidden")n=i[s];else if(i[s].mode==="showing"){n=i[s];break}const r=this.findTrackForTextTrack(n);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(C.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(C.MANIFEST_LOADING,this.onManifestLoading,this),e.on(C.MANIFEST_PARSED,this.onManifestParsed,this),e.on(C.LEVEL_LOADING,this.onLevelLoading,this),e.on(C.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(C.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(C.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(C.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(C.MANIFEST_LOADING,this.onManifestLoading,this),e.off(C.MANIFEST_PARSED,this.onManifestParsed,this),e.off(C.LEVEL_LOADING,this.onLevelLoading,this),e.off(C.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(C.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(C.ERROR,this.onError,this)}onMediaAttached(e,n){this.media=n.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,n){const i=this.media;if(!i)return;const r=!!n.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||i.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,r)return;a0(i.textTracks).forEach(o=>{Yl(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,n){this.tracks=n.subtitleTracks}onSubtitleTrackLoaded(e,n){const{id:i,groupId:r,details:s}=n,o=this.tracksInGroup[i];if(!o||o.groupId!==r){this.warn(`Subtitle track with id:${i} and group:${r} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=n.details,this.log(`Subtitle track ${i} "${o.name}" lang:${o.lang} group:${r} loaded [${s.startSN}-${s.endSN}]`),i===this.trackId&&this.playlistLoaded(i,n,a)}onLevelLoading(e,n){this.switchLevel(n.level)}onLevelSwitching(e,n){this.switchLevel(n.level)}switchLevel(e){const n=this.hls.levels[e];if(!n)return;const i=n.subtitleGroups||null,r=this.groupIds;let s=this.currentTrack;if(!i||(r==null?void 0:r.length)!==(i==null?void 0:i.length)||i!=null&&i.some(o=>(r==null?void 0:r.indexOf(o))===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(c=>!i||i.indexOf(c.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(c=>c.default)&&(this.selectDefaultTrack=!1),o.forEach((c,d)=>{c.id=d});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const a=this.hls.config.subtitlePreference;if(!s&&a){this.selectDefaultTrack=!1;const c=Lr(a,o);if(c>-1)s=o[c];else{const d=Lr(a,this.tracks);s=this.tracks[d]}}let l=this.findTrackId(s);l===-1&&s&&(l=this.findTrackId(null));const u={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${i==null?void 0:i.join(",")}" group-id`),this.hls.trigger(C.SUBTITLE_TRACKS_UPDATED,u),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}}findTrackId(e){const n=this.tracksInGroup,i=this.selectDefaultTrack;for(let r=0;r<n.length;r++){const s=n[r];if(!(i&&!s.default||!i&&!e)&&(!e||ua(s,e)))return r}if(e){for(let r=0;r<n.length;r++){const s=n[r];if(Sd(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<n.length;r++){const s=n[r];if(Sd(e.attrs,s.attrs,["LANGUAGE"]))return r}}return-1}findTrackForTextTrack(e){if(e){const n=this.tracksInGroup;for(let i=0;i<n.length;i++){const r=n[i];if(wE(r,e))return i}}return-1}onError(e,n){n.fatal||!n.context||n.context.type===dt.SUBTITLE_TRACK&&n.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(n.context.groupId)!==-1)&&this.checkRetry(n)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const n=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,n.length){const i=this.currentTrack;if(i&&ua(e,i))return i;const r=Lr(e,this.tracksInGroup);if(r>-1){const s=this.tracksInGroup[r];return this.setSubtitleTrack(r),s}else{if(i)return null;{const s=Lr(e,n);if(s>-1)return n[s]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,n){super.loadingPlaylist(e,n);const i=e.id,r=e.groupId,s=this.getUrlWithDirectives(e.url,n),o=e.details,a=o==null?void 0:o.age;this.log(`Loading subtitle ${i} "${e.name}" lang:${e.lang} group:${r}${(n==null?void 0:n.msn)!==void 0?" at sn "+n.msn+" part "+n.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${s}`),this.hls.trigger(C.SUBTITLE_TRACK_LOADING,{url:s,id:i,groupId:r,deliveryDirectives:n||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const n=a0(e.textTracks),i=this.currentTrack;let r;if(i&&(r=n.filter(s=>wE(i,s))[0],r||this.warn(`Unable to find subtitle TextTrack with name "${i.name}" and language "${i.lang}"`)),[].slice.call(n).forEach(s=>{s.mode!=="disabled"&&s!==r&&(s.mode="disabled")}),r){const s=this.subtitleDisplay?"showing":"hidden";r.mode!==s&&(r.mode=s)}}setSubtitleTrack(e){const n=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=n.length||!Ce(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,r=n[e]||null;if(this.trackId=e,this.currentTrack=r,this.toggleTrackModes(),!r){this.hls.trigger(C.SUBTITLE_TRACK_SWITCH,{id:e});return}const s=!!r.details&&!r.details.live;if(e===this.trackId&&r===i&&s)return;this.log(`Switching to subtitle-track ${e}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:""));const{id:o,groupId:a="",name:l,type:u,url:c}=r;this.hls.trigger(C.SUBTITLE_TRACK_SWITCH,{id:o,groupId:a,name:l,type:u,url:c});const d=this.switchParams(r.url,i==null?void 0:i.details,r.details);this.loadPlaylist(d)}}function Wae(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),n=e.toString();return URL.revokeObjectURL(e),n.slice(n.lastIndexOf("/")+1)}catch{let n=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const s=(n+Math.random()*16)%16|0;return n=Math.floor(n/16),(r=="x"?s:s&3|8).toString(16)})}}}function xd(t){let e=5381,n=t.length;for(;n;)e=e*33^t.charCodeAt(--n);return(e>>>0).toString()}const Xl=.025;let l0=function(t){return t[t.Point=0]="Point",t[t.Range=1]="Range",t}({});function qae(t,e,n){return`${t.identifier}-${n+1}-${xd(e)}`}class Kae{constructor(e,n){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=n,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var n;if(e>0&&e>=this.assetList.length)return!0;const i=this.playoutLimit;return e<=0||isNaN(i)?!1:i===0?!0:(((n=this.assetList[e])==null?void 0:n.startOffset)||0)>i}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const n=this.dateRange.tagAnchor;if(n)return DE(e,n)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const n=this.dateRange.startTime,i=DE(n,e);return n-i<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,n=Ce(e)?e:this.duration;return this.cumulativeDuration+n}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const n=this.resumeAnchor;if(n)return DE(e,n)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Xl))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let n;return this._duration!==null?n=this._duration:this.dateRange.duration?n=this.dateRange.duration:n=this.dateRange.plannedDuration||0,!isNaN(e)&&e<n&&(n=e),n}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?l0.Range:l0.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return Yae(this)}}function DE(t,e){return t-e.start<e.duration/2&&!(Math.abs(t-(e.start+e.duration))<Xl)?e.start:e.start+e.duration}function JN(t,e,n){const i=new self.URL(t,n);return i.protocol!=="data:"&&i.searchParams.set("_HLS_primary_id",e),i}function OE(t,e){for(;(n=t.assetList[++e])!=null&&n.error;)var n;return e}function Yae(t){return`["${t.identifier}" ${t.cue.pre?"<pre>":t.cue.post?"<post>":""}${t.timelineStart.toFixed(2)}-${t.resumeTime.toFixed(2)}]`}function Ql(t){const e=t.timelineStart,n=t.duration||0;return`["${t.identifier}" ${e.toFixed(2)}-${(e+n).toFixed(2)}]`}class Xae{constructor(e,n,i,r){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(C.PLAYOUT_LIMIT_REACHED,{})};const s=this.hls=new e(n);this.interstitial=i,this.assetItem=r;const o=()=>{this.hasDetails=!0};s.once(C.LEVEL_LOADED,o),s.once(C.AUDIO_TRACK_LOADED,o),s.once(C.SUBTITLE_TRACK_LOADED,o),s.on(C.MEDIA_ATTACHING,(a,{media:l})=>{this.removeMediaListeners(),this.mediaAttached=l,this.interstitial.playoutLimit&&(l.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&s.on(C.BUFFER_APPENDED,()=>{const c=this.bufferedEnd;this.reachedPlayout(c)&&(this._bufferedEosTime=c,s.trigger(C.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let n=this.assetItem.uri;try{n=JN(n,e.config.primarySessionId||"").href}catch{}e.loadSource(n)}}bufferedInPlaceToEnd(e){var n;if(!this.appendInPlace)return!1;if((n=this.hls)!=null&&n.bufferedToEnd)return!0;if(!e)return!1;const i=Math.min(this._bufferedEosTime||1/0,this.duration),r=this.timelineOffset,s=Qe.bufferInfo(e,r,0);return this.getAssetTime(s.end)>=i-.02}reachedPlayout(e){const i=this.interstitial.playoutLimit;return this.startOffset+e>=i}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const n=Qe.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(n.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const n=this.interstitial.playoutLimit;if(n){const i=n-this.startOffset;if(i>0&&i<e)return i}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const n=this.timelineOffset;if(e!==n){const i=e-n;if(Math.abs(i)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const n=this.timelineOffset,i=this.duration;return Math.min(Math.max(0,e-n),i)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var n;this.loadSource(),(n=this.hls)==null||n.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const n=i=>delete i.details;e.levels.forEach(n),e.allAudioTracks.forEach(n),e.allSubtitleTracks.forEach(n),this.hasDetails=!1}}on(e,n,i){var r;(r=this.hls)==null||r.on(e,n)}once(e,n,i){var r;(r=this.hls)==null||r.once(e,n)}off(e,n,i){var r;(r=this.hls)==null||r.off(e,n)}toString(){var e;return`HlsAssetPlayer: ${Ql(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const e6=.033;class Qae extends Hi{constructor(e,n){super("interstitials-sched",n),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,n){return this.events?this.events.reduce((i,r)=>e<=r.startOffset&&n>r.startOffset?(delete r.error,i+1):i,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,n){if(e.event)return this.findEventIndex(e.event.identifier);let i=-1;e.nextEvent?i=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(i=this.findEventIndex(e.previousEvent.identifier)+1);const r=this.items;if(r)for(r[i]||(n===void 0&&(n=e.start),i=this.findItemIndexAtTime(n));i>=0&&(s=r[i])!=null&&s.event;){var s;i--}return i}findItemIndexAtTime(e,n){const i=this.items;if(i)for(let r=0;r<i.length;r++){let s=i[r];if(n&&n!=="primary"&&(s=s[n]),e===s.start||e>s.start&&e<s.end)return r}return-1}findJumpRestrictedIndex(e,n){const i=this.items;if(i)for(let r=e;r<=n&&i[r];r++){const s=i[r].event;if(s!=null&&s.restrictions.jump&&!s.appendInPlace)return r}return-1}findEventIndex(e){const n=this.items;if(n)for(let r=n.length;r--;){var i;if(((i=n[r].event)==null?void 0:i.identifier)===e)return r}return-1}findAssetIndex(e,n){const i=e.assetList,r=i.length;if(r>1)for(let s=0;s<r;s++){const o=i[s];if(!o.error){const a=o.timelineStart;if(n===a||n>a&&(n<a+(o.duration||0)||s===r-1))return s}}return 0}get assetIdAtEnd(){var e;const n=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(n){const i=n.assetList,r=i[i.length-1];if(r)return r.identifier}return null}parseInterstitialDateRanges(e,n){const i=e.main.details,{dateRanges:r}=i,s=this.events,o=this.parseDateRanges(r,{url:i.url},n),a=Object.keys(r),l=s?s.filter(u=>!a.includes(u.identifier)):[];o.length&&o.sort((u,c)=>{const d=u.cue.pre,f=u.cue.post,h=c.cue.pre,p=c.cue.post;if(d&&!h)return-1;if(h&&!d||f&&!p)return 1;if(p&&!f)return-1;if(!d&&!h&&!f&&!p){const m=u.startTime,y=c.startTime;if(m!==y)return m-y}return u.dateRange.tagOrder-c.dateRange.tagOrder}),this.events=o,l.forEach(u=>{this.removeEvent(u)}),this.updateSchedule(e,l)}updateSchedule(e,n=[],i=!1){const r=this.events||[];if(r.length||n.length||this.length<2){const s=this.items,o=this.parseSchedule(r,e);(i||n.length||(s==null?void 0:s.length)!==o.length||o.some((l,u)=>Math.abs(l.playout.start-s[u].playout.start)>.005||Math.abs(l.playout.end-s[u].playout.end)>.005))&&(this.items=o,this.onScheduleUpdate(n,s))}}parseDateRanges(e,n,i){const r=[],s=Object.keys(e);for(let o=0;o<s.length;o++){const a=s[o],l=e[a];if(l.isInterstitial){let u=this.eventMap[a];u?u.setDateRange(l):(u=new Kae(l,n),this.eventMap[a]=u,i===!1&&(u.appendInPlace=i)),r.push(u)}}return r}parseSchedule(e,n){const i=[],r=n.main.details,s=r.live?1/0:r.edge;let o=0;if(e=e.filter(l=>!l.error&&!(l.cue.once&&l.hasPlayed)),e.length){this.resolveOffsets(e,n);let l=0,u=0;if(e.forEach((c,d)=>{const f=c.cue.pre,h=c.cue.post,p=e[d-1]||null,m=c.appendInPlace,y=h?s:c.startOffset,g=c.duration,v=c.timelineOccupancy===l0.Range?g:0,b=c.resumptionOffset,T=(p==null?void 0:p.startTime)===y,S=y+c.cumulativeDuration;let _=m?S+g:y+b;if(f||!h&&y<=0){const P=u;u+=v,c.timelineStart=S;const O=o;o+=g,i.push({event:c,start:S,end:_,playout:{start:O,end:o},integrated:{start:P,end:u}})}else if(y<=s){if(!T){const x=y-l;if(x>e6){const L=l,M=u;u+=x;const V=o;o+=x;const K={previousEvent:e[d-1]||null,nextEvent:c,start:L,end:L+x,playout:{start:V,end:o},integrated:{start:M,end:u}};i.push(K)}else x>0&&p&&(p.cumulativeDuration+=x,i[i.length-1].end=y)}h&&(_=S),c.timelineStart=S;const P=u;u+=v;const O=o;o+=g,i.push({event:c,start:S,end:_,playout:{start:O,end:o},integrated:{start:P,end:u}})}else return;const A=c.resumeTime;h||A>s?l=s:l=A}),l<s){var a;const c=l,d=u,f=s-l;u+=f;const h=o;o+=f,i.push({previousEvent:((a=i[i.length-1])==null?void 0:a.event)||null,nextEvent:null,start:l,end:c+f,playout:{start:h,end:o},integrated:{start:d,end:u}})}this.setDurations(s,o,u)}else i.push({previousEvent:null,nextEvent:null,start:0,end:s,playout:{start:0,end:s},integrated:{start:0,end:s}}),this.setDurations(s,s,s);return i}setDurations(e,n,i){this.durations={primary:e,playout:n,integrated:i}}resolveOffsets(e,n){const i=n.main.details,r=i.live?1/0:i.edge;let s=0,o=-1;e.forEach((a,l)=>{const u=a.cue.pre,c=a.cue.post,d=u?0:c?r:a.startTime;this.updateAssetDurations(a),o===d?a.cumulativeDuration=s:(s=0,o=d),!c&&a.snapOptions.in&&(a.resumeAnchor=da(null,i.fragments,a.startOffset+a.resumptionOffset,0,0)||void 0),a.appendInPlace&&!a.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(a,n)||(a.appendInPlace=!1)),!a.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<e6&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${a}`));const h=Ce(a.resumeOffset)?a.resumeOffset:a.duration;s+=h})}primaryCanResumeInPlaceAt(e,n){const i=e.resumeTime,r=e.startTime+e.resumptionOffset;return Math.abs(i-r)>Xl?(this.log(`"${e.identifier}" resumption ${i} not aligned with estimated timeline end ${r}`),!1):!Object.keys(n).some(o=>{const a=n[o].details,l=a.edge;if(i>=l)return this.log(`"${e.identifier}" resumption ${i} past ${o} playlist end ${l}`),!1;const u=da(null,a.fragments,i);if(!u)return this.log(`"${e.identifier}" resumption ${i} does not align with any fragments in ${o} playlist (${a.fragStart}-${a.fragmentEnd})`),!0;const c=o==="audio"?.175:0;return Math.abs(u.start-i)<Xl+c||Math.abs(u.end-i)<Xl+c?!1:(this.log(`"${e.identifier}" resumption ${i} not aligned with ${o} fragment bounds (${u.start}-${u.end} sn: ${u.sn} cc: ${u.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const n=e.timelineStart;let i=0,r=!1,s=!1;for(let o=0;o<e.assetList.length;o++){const a=e.assetList[o],l=n+i;a.startOffset=i,a.timelineStart=l,r||(r=a.duration===null),s||(s=!!a.error);const u=a.error?0:a.duration||0;i+=u}r&&!s?e.duration=Math.max(i,e.duration):e.duration=i}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function ir(t){return`[${t.event?'"'+t.event.identifier+'"':"primary"}: ${t.start.toFixed(2)}-${t.end.toFixed(2)}]`}class Zae{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,n){const i=e.assetListUrl;let r;try{r=JN(i,this.hls.sessionId,e.baseUrl)}catch(f){const h=this.assignAssetListError(e,Q.ASSET_LIST_LOAD_ERROR,f,i);this.hls.trigger(C.ERROR,h);return}n&&r.protocol!=="data:"&&r.searchParams.set("_HLS_start_offset",""+n);const s=this.hls.config,o=s.loader,a=new o(s),l={responseType:"json",url:r.href},u=s.interstitialAssetListLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,h,p,m)=>{const y=f.data,g=y==null?void 0:y.ASSETS;if(!Array.isArray(g)){const v=this.assignAssetListError(e,Q.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),p.url,h,m);this.hls.trigger(C.ERROR,v);return}e.assetListResponse=y,this.hls.trigger(C.ASSET_LIST_LOADED,{event:e,assetListResponse:y,networkDetails:m})},onError:(f,h,p,m)=>{const y=this.assignAssetListError(e,Q.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${f.code} ${f.text} (${h.url})`),h.url,m,p);this.hls.trigger(C.ERROR,y)},onTimeout:(f,h,p)=>{const m=this.assignAssetListError(e,Q.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${h.url})`),h.url,f,p);this.hls.trigger(C.ERROR,m)}};return a.load(l,c,d),this.hls.trigger(C.ASSET_LIST_LOADING,{event:e}),a}assignAssetListError(e,n,i,r,s,o){return e.error=i,{type:He.NETWORK_ERROR,details:n,fatal:!1,interstitial:e,url:r,error:i,networkDetails:o,stats:s}}}function t6(t){t==null||t.play().catch(()=>{})}function u0(t,e){return`[${t}] Advancing timeline position to ${e}`}class Jae extends Hi{constructor(e,n){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled||!this.schedule)return;const r=i-this.timelinePos;if(Math.abs(r)<1/7056e5)return;const o=r<=-.01;this.timelinePos=i,this.bufferedPos=i;const a=this.playingItem;if(!a){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(i,i-r)&&this.updateSchedule(!0),this.checkBuffer(),o&&i<a.start||i>=a.end){var l;const h=this.findItemIndex(a);let p=this.schedule.findItemIndexAtTime(i);if(p===-1&&(p=h+(o?-1:1),this.log(`seeked ${o?"back ":""}to position not covered by schedule ${i} (resolving from ${h} to ${p})`)),!this.isInterstitial(a)&&(l=this.media)!=null&&l.paused&&(this.shouldPlay=!1),!o&&p>h){const m=this.schedule.findJumpRestrictedIndex(h+1,p);if(m>h){this.setSchedulePosition(m);return}}this.setSchedulePosition(p);return}const u=this.playingAsset;if(!u){if(this.playingLastItem&&this.isInterstitial(a)){const h=a.event.assetList[0];h&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(i,h))}return}const c=u.timelineStart,d=u.duration||0;if(o&&i<c||i>=c+d){var f;(f=a.event)!=null&&f.appendInPlace&&(this.clearInterstitial(a.event,a),this.flushFrontBuffer(i)),this.setScheduleToAssetAtTime(i,u)}},this.onTimeupdate=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled)return;if(i>this.timelinePos)this.timelinePos=i,i>this.bufferedPos&&this.checkBuffer();else return;const r=this.playingItem;if(!r||this.playingLastItem)return;if(i>=r.end){this.timelinePos=r.end;const a=this.findItemIndex(r);this.setSchedulePosition(a+1)}const s=this.playingAsset;if(!s)return;const o=s.timelineStart+(s.duration||0);i>=o&&this.setScheduleToAssetAtTime(i,s)},this.onScheduleUpdate=(i,r)=>{const s=this.schedule;if(!s)return;const o=this.playingItem,a=s.events||[],l=s.items||[],u=s.durations,c=i.map(m=>m.identifier),d=!!(a.length||c.length);(d||r)&&this.log(`INTERSTITIALS_UPDATED (${a.length}): ${a}
Schedule: ${l.map(m=>ir(m))} pos: ${this.timelinePos}`),c.length&&this.log(`Removed events ${c}`);let f=null,h=null;o&&(f=this.updateItem(o,this.timelinePos),this.itemsMatch(o,f)?this.playingItem=f:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const p=this.bufferingItem;if(p&&(h=this.updateItem(p,this.bufferedPos),this.itemsMatch(p,h)?this.bufferingItem=h:p.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(p.event,null))),i.forEach(m=>{m.assetList.forEach(y=>{this.clearAssetPlayer(y.identifier,null)})}),this.playerQueue.forEach(m=>{if(m.interstitial.appendInPlace){const y=m.assetItem.timelineStart,g=m.timelineOffset-y;if(g)try{m.timelineOffset=y}catch(v){Math.abs(g)>Xl&&this.warn(`${v} ("${m.assetId}" ${m.timelineOffset}->${y})`)}}}),d||r){if(this.hls.trigger(C.INTERSTITIALS_UPDATED,{events:a.slice(0),schedule:l.slice(0),durations:u,removedIds:c}),this.isInterstitial(o)&&c.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}o&&this.trimInPlace(f,o),p&&h!==f&&this.trimInPlace(h,p),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=n,this.assetListLoader=new Zae(e),this.schedule=new Qae(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(C.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(C.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(C.MANIFEST_LOADING,this.onManifestLoading,this),e.on(C.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(C.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(C.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(C.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(C.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(C.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(C.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(C.BUFFER_APPENDED,this.onBufferAppended,this),e.on(C.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(C.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(C.MEDIA_ENDED,this.onMediaEnded,this),e.on(C.ERROR,this.onError,this),e.on(C.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(C.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(C.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(C.MANIFEST_LOADING,this.onManifestLoading,this),e.off(C.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(C.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(C.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(C.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(C.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(C.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(C.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(C.BUFFER_CODECS,this.onBufferCodecs,this),e.off(C.BUFFER_APPENDED,this.onBufferAppended,this),e.off(C.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(C.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(C.MEDIA_ENDED,this.onMediaEnded,this),e.off(C.ERROR,this.onError,this),e.off(C.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){oi(e,"play",this.onPlay),oi(e,"pause",this.onPause),oi(e,"seeking",this.onSeeking),oi(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,n){const i=this.media=n.media;Vn(i,"seeking",this.onSeeking),Vn(i,"timeupdate",this.onTimeupdate),Vn(i,"play",this.onPlay),Vn(i,"pause",this.onPause)}onMediaAttached(e,n){const i=this.effectivePlayingItem,r=this.detachedData;if(this.detachedData=null,i===null)this.checkStart();else if(!r){this.clearScheduleState();const s=this.findItemIndex(i);this.setSchedulePosition(s)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,n){const i=!!n.transferMedia,r=this.media;if(this.media=null,!i&&(r&&this.removeMediaListeners(r),this.detachedData)){const s=this.getBufferingPlayer();s&&(this.log(`Removing schedule state for detachedData and ${s}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,s.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,n=()=>e.bufferingItem||e.waitingItem,i=d=>d&&e.getAssetPlayer(d.identifier),r=(d,f,h,p,m)=>{if(d){let y=d[f].start;const g=d.event;if(g){if(f==="playout"||g.timelineOccupancy!==l0.Point){const v=i(h);(v==null?void 0:v.interstitial)===g&&(y+=v.assetItem.startOffset+v[m])}}else{const v=p==="bufferedPos"?o():e[p];y+=v-d.start}return y}return 0},s=(d,f)=>{var h;if(d!==0&&f!=="primary"&&(h=e.schedule)!=null&&h.length){var p;const m=e.schedule.findItemIndexAtTime(d),y=(p=e.schedule.items)==null?void 0:p[m];if(y){const g=y[f].start-y.start;return d+g}}return d},o=()=>{const d=e.bufferedPos;return d===Number.MAX_VALUE?a("primary"):Math.max(d,0)},a=d=>{var f,h;return(f=e.primaryDetails)!=null&&f.live?e.primaryDetails.edge:((h=e.schedule)==null?void 0:h.durations[d])||0},l=(d,f)=>{var h,p;const m=e.effectivePlayingItem;if(m!=null&&(h=m.event)!=null&&h.restrictions.skip||!e.schedule)return;e.log(`seek to ${d} "${f}"`);const y=e.effectivePlayingItem,g=e.schedule.findItemIndexAtTime(d,f),v=(p=e.schedule.items)==null?void 0:p[g],b=e.getBufferingPlayer(),T=b==null?void 0:b.interstitial,S=T==null?void 0:T.appendInPlace,_=y&&e.itemsMatch(y,v);if(y&&(S||_)){const A=i(e.playingAsset),P=(A==null?void 0:A.media)||e.primaryMedia;if(P){const O=f==="primary"?P.currentTime:r(y,f,e.playingAsset,"timelinePos","currentTime"),x=d-O,L=(S?O:P.currentTime)+x;if(L>=0&&(!A||S||L<=A.duration)){P.currentTime=L;return}}}if(v){let A=d;if(f!=="primary"){const O=v[f].start,x=d-O;A=v.start+x}const P=!e.isInterstitial(v);if((!e.isInterstitial(y)||y.event.appendInPlace)&&(P||v.event.appendInPlace)){const O=e.media||(S?b==null?void 0:b.media:null);O&&(O.currentTime=A)}else if(y){const O=e.findItemIndex(y);if(g>O){const L=e.schedule.findJumpRestrictedIndex(O+1,g);if(L>O){e.setSchedulePosition(L);return}}let x=0;if(P)e.timelinePos=A,e.checkBuffer();else{const L=v.event.assetList,M=d-(v[f]||v).start;for(let V=L.length;V--;){const K=L[V];if(K.duration&&M>=K.startOffset&&M<K.startOffset+K.duration){x=V;break}}}e.setSchedulePosition(g,x)}}},u=()=>{const d=e.effectivePlayingItem;if(e.isInterstitial(d))return d;const f=n();return e.isInterstitial(f)?f:null},c={get bufferedEnd(){const d=n(),f=e.bufferingItem;if(f&&f===d){var h;return r(f,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-f.playout.start||((h=e.bufferingAsset)==null?void 0:h.startOffset)||0}return 0},get currentTime(){const d=u(),f=e.effectivePlayingItem;return f&&f===d?r(f,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-f.playout.start:0},set currentTime(d){const f=u(),h=e.effectivePlayingItem;h&&h===f&&l(d+h.playout.start,"playout")},get duration(){const d=u();return d?d.playout.end-d.playout.start:0},get assetPlayers(){var d;const f=(d=u())==null?void 0:d.event.assetList;return f?f.map(h=>e.getAssetPlayer(h.identifier)):[]},get playingIndex(){var d;const f=(d=u())==null?void 0:d.event;return f&&e.effectivePlayingAsset?f.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return u()}};return this.manager={get events(){var d;return((d=e.schedule)==null||(d=d.events)==null?void 0:d.slice(0))||[]},get schedule(){var d;return((d=e.schedule)==null||(d=d.items)==null?void 0:d.slice(0))||[]},get interstitialPlayer(){return u()?c:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return n()},get bufferingIndex(){const d=n();return e.findItemIndex(d)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const d=e.effectivePlayingItem;return e.findItemIndex(d)},primary:{get bufferedEnd(){return o()},get currentTime(){const d=e.timelinePos;return d>0?d:0},set currentTime(d){l(d,"primary")},get duration(){return a("primary")},get seekableStart(){var d;return((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0}},integrated:{get bufferedEnd(){return r(n(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return r(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(d){l(d,"integrated")},get duration(){return a("integrated")},get seekableStart(){var d;return s(((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0,"integrated")}},skip:()=>{const d=e.effectivePlayingItem,f=d==null?void 0:d.event;if(f&&!f.restrictions.skip){const h=e.findItemIndex(d);if(f.appendInPlace){const p=d.playout.start+d.event.duration;l(p+.001,"playout")}else e.advanceAfterAssetEnded(f,h,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const n=this.playingItem,i=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!n||!i?!1:this.findItemIndex(n)===i.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,n;if(this.mediaSelection===null)return;const i=this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&!i.event.appendInPlace)return;let r=this.media;!r&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(r=this.primaryMedia);const s=(n=r)==null?void 0:n.currentTime;if(!(s===void 0||!Ce(s)))return s}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,n){const i=this.getAssetPlayer(e);i&&this.transferMediaFromPlayer(i,n)}transferMediaFromPlayer(e,n){const i=e.interstitial.appendInPlace,r=e.media;if(i&&r===this.primaryMedia){if(this.bufferingAsset=null,(!n||this.isInterstitial(n)&&!n.event.appendInPlace)&&n&&r){this.detachedData={media:r};return}const s=e.transferMedia();this.log(`transfer MediaSource from ${e} ${It(s)}`),this.detachedData=s}else n&&r&&(this.shouldPlay||(this.shouldPlay=!r.paused))}transferMediaTo(e,n){var i,r;if(e.media===n)return;let s=null;const o=this.hls,a=e!==o,l=a&&e.interstitial.appendInPlace,u=(i=this.detachedData)==null?void 0:i.mediaSource;let c;if(o.media)l&&(s=o.transferMedia(),this.detachedData=s),c="Primary";else if(u){const p=this.getBufferingPlayer();p?(s=p.transferMedia(),c=`${p}`):c="detached MediaSource"}else c="detached media";if(!s){if(u)s=this.detachedData,this.log(`using detachedData: MediaSource ${It(s)}`);else if(!this.detachedData||o.media===n){const p=this.playerQueue;p.length>1&&p.forEach(m=>{if(a&&m.interstitial.appendInPlace!==l){const y=m.interstitial;this.clearInterstitial(m.interstitial,null),y.appendInPlace=!1,y.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${y}`)}}),this.hls.detachMedia(),this.detachedData={media:n}}}const d=s&&"mediaSource"in s&&((r=s.mediaSource)==null?void 0:r.readyState)!=="closed",f=d&&s?s:n;this.log(`${d?"transfering MediaSource":"attaching media"} to ${a?e:"Primary"} from ${c} (media.currentTime: ${n.currentTime})`);const h=this.schedule;if(f===s&&h){const p=a&&e.assetId===h.assetIdAtEnd;f.overrides={duration:h.duration,endOfStream:!a||p,cueRemoval:!a}}e.attachMedia(f)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,n=e==null?void 0:e.events;if(!n||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const i=this.timelinePos,r=this.effectivePlayingItem;if(i===-1){const s=this.hls.startPosition;if(this.log(u0("checkStart",s)),this.timelinePos=s,n.length&&n[0].cue.pre){const o=e.findEventIndex(n[0].identifier);this.setSchedulePosition(o)}else if(s>=0||!this.primaryLive){const o=this.timelinePos=s>0?s:0,a=e.findItemIndexAtTime(o);this.setSchedulePosition(a)}}else if(r&&!this.playingItem){const s=e.findItemIndex(r);this.setSchedulePosition(s)}}advanceAssetBuffering(e,n){const i=e.event,r=i.findAssetIndex(n),s=OE(i,r);if(!i.isAssetPastPlayoutLimit(s))this.bufferedToEvent(e,s);else if(this.schedule){var o;const a=(o=this.schedule.items)==null?void 0:o[this.findItemIndex(e)+1];a&&this.bufferedToItem(a)}}advanceAfterAssetEnded(e,n,i){const r=OE(e,i);if(e.isAssetPastPlayoutLimit(r)){if(this.schedule){const s=this.schedule.items;if(s){const o=n+1,a=s.length;if(o>=a){this.setSchedulePosition(-1);return}const l=e.resumeTime;this.timelinePos<l&&(this.log(u0("advanceAfterAssetEnded",l)),this.timelinePos=l,e.appendInPlace&&this.advanceInPlace(l),this.checkBuffer(this.bufferedPos<l)),this.setSchedulePosition(o)}}}else{if(e.appendInPlace){const s=e.assetList[r];s&&this.advanceInPlace(s.timelineStart)}this.setSchedulePosition(n,r)}}setScheduleToAssetAtTime(e,n){const i=this.schedule;if(!i)return;const r=n.parentIdentifier,s=i.getEvent(r);if(s){const o=i.findEventIndex(r),a=i.findAssetIndex(s,e);this.advanceAfterAssetEnded(s,o,a-1)}}setSchedulePosition(e,n){var i;const r=(i=this.schedule)==null?void 0:i.items;if(!r||this.playbackDisabled)return;const s=e>=0?r[e]:null;this.log(`setSchedulePosition ${e}, ${n} (${s&&ir(s)}) pos: ${this.timelinePos}`);const o=this.waitingItem||this.playingItem,a=this.playingLastItem;if(this.isInterstitial(o)){const c=o.event,d=this.playingAsset,f=d==null?void 0:d.identifier,h=f?this.getAssetPlayer(f):null;if(h&&f&&(!this.eventItemsMatch(o,s)||n!==void 0&&f!==c.assetList[n].identifier)){var l;const p=c.findAssetIndex(d);if(this.log(`INTERSTITIAL_ASSET_ENDED ${p+1}/${c.assetList.length} ${Ql(d)}`),this.endedAsset=d,this.playingAsset=null,this.hls.trigger(C.INTERSTITIAL_ASSET_ENDED,{asset:d,assetListIndex:p,event:c,schedule:r.slice(0),scheduleIndex:e,player:h}),o!==this.playingItem){this.itemsMatch(o,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(c,this.findItemIndex(this.playingItem),p);return}this.retreiveMediaSource(f,s),h.media&&!((l=this.detachedData)!=null&&l.mediaSource)&&h.detachMedia()}if(!this.eventItemsMatch(o,s)&&(this.endedItem=o,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${c} ${ir(o)}`),c.hasPlayed=!0,this.hls.trigger(C.INTERSTITIAL_ENDED,{event:c,schedule:r.slice(0),scheduleIndex:e}),c.cue.once)){var u;this.updateSchedule();const p=(u=this.schedule)==null?void 0:u.items;if(s&&p){const m=this.findItemIndex(s);this.advanceSchedule(m,p,n,o,a)}return}}this.advanceSchedule(e,r,n,o,a)}advanceSchedule(e,n,i,r,s){const o=this.schedule;if(!o)return;const a=n[e]||null,l=this.primaryMedia,u=this.playerQueue;if(u.length&&u.forEach(c=>{const d=c.interstitial,f=o.findEventIndex(d.identifier);(f<e||f>e+1)&&this.clearInterstitial(d,a)}),this.isInterstitial(a)){this.timelinePos=Math.min(Math.max(this.timelinePos,a.start),a.end);const c=a.event;if(i===void 0){i=o.findAssetIndex(c,this.timelinePos);const p=OE(c,i-1);if(c.isAssetPastPlayoutLimit(p)||c.appendInPlace&&this.timelinePos===a.end){this.advanceAfterAssetEnded(c,e,i);return}i=p}const d=this.waitingItem;this.assetsBuffered(a,l)||this.setBufferingItem(a);let f=this.preloadAssets(c,i);if(this.eventItemsMatch(a,d||r)||(this.waitingItem=a,this.log(`INTERSTITIAL_STARTED ${ir(a)} ${c.appendInPlace?"append in place":""}`),this.hls.trigger(C.INTERSTITIAL_STARTED,{event:c,schedule:n.slice(0),scheduleIndex:e})),!c.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${c}`);return}if(c.assetListLoader&&(c.assetListLoader.destroy(),c.assetListLoader=void 0),!l){this.log(`Waiting for attachMedia to start Interstitial ${c}`);return}this.waitingItem=this.endedItem=null,this.playingItem=a;const h=c.assetList[i];if(!h){this.advanceAfterAssetEnded(c,e,i||0);return}if(f||(f=this.getAssetPlayer(h.identifier)),f===null||f.destroyed){const p=c.assetList.length;this.warn(`asset ${i+1}/${p} player destroyed ${c}`),f=this.createAssetPlayer(c,h,i),f.loadSource()}if(!this.eventItemsMatch(a,this.bufferingItem)&&c.appendInPlace&&this.isAssetBuffered(h))return;this.startAssetPlayer(f,i,n,e,l),this.shouldPlay&&t6(f.media)}else a?(this.resumePrimary(a,e,r),this.shouldPlay&&t6(this.hls.media)):s&&this.isInterstitial(r)&&(this.endedItem=null,this.playingItem=r,r.event.appendInPlace||this.attachPrimary(o.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,n,i){var r,s;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${ir(e)}`),!((r=this.detachedData)!=null&&r.mediaSource)){let a=this.timelinePos;(a<e.start||a>=e.end)&&(a=this.getPrimaryResumption(e,n),this.log(u0("resumePrimary",a)),this.timelinePos=a),this.attachPrimary(a,e)}if(!i)return;const o=(s=this.schedule)==null?void 0:s.items;o&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${ir(e)}`),this.hls.trigger(C.INTERSTITIALS_PRIMARY_RESUMED,{schedule:o.slice(0),scheduleIndex:n}),this.checkBuffer())}getPrimaryResumption(e,n){const i=e.start;if(this.primaryLive){const r=this.primaryDetails;if(n===0)return this.hls.startPosition;if(r&&(i<r.fragmentStart||i>r.edge))return this.hls.liveSyncPosition||-1}return i}isAssetBuffered(e){const n=this.getAssetPlayer(e.identifier);return n!=null&&n.hls?n.hls.bufferedToEnd:Qe.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,n,i){n?this.setBufferingItem(n):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const r=this.primaryMedia;if(!r)return;const s=this.hls;s.media?this.checkBuffer():(this.transferMediaTo(s,r),i&&this.startLoadingPrimaryAt(e,i)),i||(this.log(u0("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,i))}startLoadingPrimaryAt(e,n){var i;const r=this.hls;!r.loadingEnabled||!r.media||Math.abs((((i=r.mainForwardBufferInfo)==null?void 0:i.start)||r.media.currentTime)-e)>.5?r.startLoad(e,n):r.bufferingEnabled||r.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(C.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(C.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,n){if(n.level===-1||!this.schedule)return;const i=this.hls.levels[n.level];if(!i.details)return;const r=bt(bt({},this.mediaSelection||this.altSelection),{},{main:i});this.mediaSelection=r,this.schedule.parseInterstitialDateRanges(r,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,n){const i=this.hls.audioTracks[n.id],r=this.mediaSelection;if(!r){this.altSelection=bt(bt({},this.altSelection),{},{audio:i});return}const s=bt(bt({},r),{},{audio:i});this.mediaSelection=s}onSubtitleTrackUpdated(e,n){const i=this.hls.subtitleTracks[n.id],r=this.mediaSelection;if(!r){this.altSelection=bt(bt({},this.altSelection),{},{subtitles:i});return}const s=bt(bt({},r),{},{subtitles:i});this.mediaSelection=s}onAudioTrackSwitching(e,n){const i=lO(n);this.playerQueue.forEach(({hls:r})=>r&&(r.setAudioOption(n)||r.setAudioOption(i)))}onSubtitleTrackSwitch(e,n){const i=lO(n);this.playerQueue.forEach(({hls:r})=>r&&(r.setSubtitleOption(n)||n.id!==-1&&r.setSubtitleOption(i)))}onBufferCodecs(e,n){const i=n.tracks;i&&(this.requiredTracks=i)}onBufferAppended(e,n){this.checkBuffer()}onBufferFlushed(e,n){const i=this.playingItem;if(i&&!this.itemsMatch(i,this.bufferingItem)&&!this.isInterstitial(i)){const r=this.timelinePos;this.bufferedPos=r,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const n=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&n){for(let r=0;r<n.length;r++){const s=n[r];if(s.cue.post){var i;const o=this.schedule.findEventIndex(s.identifier),a=(i=this.schedule.items)==null?void 0:i[o];this.isInterstitial(a)&&this.eventItemsMatch(a,this.bufferingItem)&&this.bufferedToItem(a,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const n=this.playingItem;if(!this.playingLastItem&&n){const i=this.findItemIndex(n);this.setSchedulePosition(i+1)}else this.shouldPlay=!1}updateItem(e,n){var i;const r=(i=this.schedule)==null?void 0:i.items;if(e&&r){const s=this.findItemIndex(e,n);return r[s]||null}return null}trimInPlace(e,n){if(this.isInterstitial(e)&&e.event.appendInPlace&&n.end-e.end>.25){e.event.assetList.forEach((s,o)=>{e.event.isAssetPastPlayoutLimit(o)&&this.clearAssetPlayer(s.identifier,null)});const i=e.end+.25,r=Qe.bufferInfo(this.primaryMedia,i,0);(r.end>i||(r.nextStart||0)>i)&&(this.log(`trim buffered interstitial ${ir(e)} (was ${ir(n)})`),this.attachPrimary(i,null,!0),this.flushFrontBuffer(i))}}itemsMatch(e,n){return!!n&&(e===n||e.event&&n.event&&this.eventItemsMatch(e,n)||!e.event&&!n.event&&this.findItemIndex(e)===this.findItemIndex(n))}eventItemsMatch(e,n){var i;return!!n&&(e===n||e.event.identifier===((i=n.event)==null?void 0:i.identifier))}findItemIndex(e,n){return e&&this.schedule?this.schedule.findItemIndex(e,n):-1}updateSchedule(e=!1){var n;const i=this.mediaSelection;i&&((n=this.schedule)==null||n.updateSchedule(i,[],e))}checkBuffer(e){var n;const i=(n=this.schedule)==null?void 0:n.items;if(!i)return;const r=Qe.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=r.len<1),this.updateBufferedPos(r.end,i,e)}updateBufferedPos(e,n,i){const r=this.schedule,s=this.bufferingItem;if(this.bufferedPos>e||!r)return;if(n.length===1&&this.itemsMatch(n[0],s)){this.bufferedPos=e;return}const o=this.playingItem,a=this.findItemIndex(o);let l=r.findItemIndexAtTime(e);if(this.bufferedPos<e){var u;const c=this.findItemIndex(s),d=Math.min(c+1,n.length-1),f=n[d];if((l===-1&&s&&e>=s.end||(u=f.event)!=null&&u.appendInPlace&&e+.01>=f.start)&&(l=d),this.isInterstitial(s)){const h=s.event;if(d-a>1&&h.appendInPlace===!1||h.assetList.length===0&&h.assetListLoader)return}if(this.bufferedPos=e,l>c&&l>a)this.bufferedToItem(f);else{const h=this.primaryDetails;this.primaryLive&&h&&e>h.edge-h.targetduration&&f.start<h.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(f)&&this.preloadAssets(f.event,0)}}else i&&o&&!this.itemsMatch(o,s)&&(l===a?this.bufferedToItem(o):l===a+1&&this.bufferedToItem(n[l]))}assetsBuffered(e,n){return e.event.assetList.length===0?!1:!e.event.assetList.some(r=>{const s=this.getAssetPlayer(r.identifier);return!(s!=null&&s.bufferedInPlaceToEnd(n))})}setBufferingItem(e){const n=this.bufferingItem,i=this.schedule;if(!this.itemsMatch(e,n)&&i){const{items:r,events:s}=i;if(!r||!s)return n;const o=this.isInterstitial(e),a=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const l=a?a.remaining:n?n.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${ir(e)}`+(n?` (${l.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(o){const u=i.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((c,d)=>{const f=this.getAssetPlayer(c.identifier);f&&(d===u&&f.loadSource(),f.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(u=>u.pauseBuffering());this.hls.trigger(C.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:s.slice(0),schedule:r.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return n}bufferedToItem(e,n=0){const i=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,n);else if(i!==null){this.bufferingAsset=null;const r=this.detachedData;r?r.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const n=this.findItemIndex(e),i=this.getPrimaryResumption(e,n);this.startLoadingPrimaryAt(i)}bufferedToEvent(e,n){const i=e.event,r=i.assetList.length===0&&!i.assetListLoader,s=i.cue.once;if(r||!s){const o=this.preloadAssets(i,n);if(o!=null&&o.interstitial.appendInPlace){const a=this.primaryMedia;a&&this.bufferAssetPlayer(o,a)}}}preloadAssets(e,n){const i=e.assetUrl,r=e.assetList.length,s=r===0&&!e.assetListLoader,o=e.cue.once;if(s){const l=e.timelineStart;if(e.appendInPlace){var a;const f=this.playingItem;!this.isInterstitial(f)&&(f==null||(a=f.nextEvent)==null?void 0:a.identifier)===e.identifier&&this.flushFrontBuffer(l+.25)}let u,c=0;if(!this.playingItem&&this.primaryLive&&(c=this.hls.startPosition,c===-1&&(c=this.hls.liveSyncPosition||0)),c&&!(e.cue.pre||e.cue.post)){const f=c-l;f>0&&(u=Math.round(f*1e3)/1e3)}if(this.log(`Load interstitial asset ${n+1}/${i?1:r} ${e}${u?` live-start: ${c} start-offset: ${u}`:""}`),i)return this.createAsset(e,0,0,l,e.duration,i);const d=this.assetListLoader.loadAssetList(e,u);d&&(e.assetListLoader=d)}else if(!o&&r){for(let u=n;u<r;u++){const c=e.assetList[u],d=this.getAssetPlayerQueueIndex(c.identifier);(d===-1||this.playerQueue[d].destroyed)&&!c.error&&this.createAssetPlayer(e,c,u)}const l=e.assetList[n];if(l){const u=this.getAssetPlayer(l.identifier);return u&&u.loadSource(),u}}return null}flushFrontBuffer(e){const n=this.requiredTracks;if(!n)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(n).forEach(r=>{this.hls.trigger(C.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:r})})}getAssetPlayerQueueIndex(e){const n=this.playerQueue;for(let i=0;i<n.length;i++)if(e===n[i].assetId)return i;return-1}getAssetPlayer(e){const n=this.getAssetPlayerQueueIndex(e);return this.playerQueue[n]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:n}=this;if(n){for(let i=0;i<e.length;i++)if(e[i].media===n)return e[i]}return null}createAsset(e,n,i,r,s,o){const a={parentIdentifier:e.identifier,identifier:qae(e,o,n),duration:s,startOffset:i,timelineStart:r,uri:o};return this.createAssetPlayer(e,a,n)}createAssetPlayer(e,n,i){const r=this.hls,s=r.userConfig;let o=s.videoPreference;const a=r.loadLevelObj||r.levels[r.currentLevel];(o||a)&&(o=xt({},o),a.videoCodec&&(o.videoCodec=a.videoCodec),a.videoRange&&(o.allowedVideoRanges=[a.videoRange]));const l=r.audioTracks[r.audioTrack],u=r.subtitleTracks[r.subtitleTrack];let c=0;if(this.primaryLive||e.appendInPlace){const T=this.timelinePos-n.timelineStart;if(T>1){const S=n.duration;S&&T<S&&(c=T)}}const d=n.identifier,f=bt(bt({},s),{},{maxMaxBufferLength:Math.min(180,r.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:r.sessionId,assetPlayerId:d,abrEwmaDefaultEstimate:r.bandwidthEstimate,interstitialsController:void 0,startPosition:c,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:l||s.audioPreference,subtitlePreference:u||s.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,n.timelineStart&&(f.timelineOffset=n.timelineStart));const h=f.cmcd;h!=null&&h.sessionId&&h.contentId&&(f.cmcd=xt({},h,{contentId:xd(n.uri)})),this.getAssetPlayer(d)&&this.warn(`Duplicate date range identifier ${e} and asset ${d}`);const p=new Xae(this.HlsPlayerClass,f,e,n);this.playerQueue.push(p),e.assetList[i]=n;let m=!0;const y=T=>{if(T.live){var S;const P=new Error(`Interstitials MUST be VOD assets ${e}`),O={fatal:!0,type:He.OTHER_ERROR,details:Q.INTERSTITIAL_ASSET_ITEM_ERROR,error:P},x=((S=this.schedule)==null?void 0:S.findEventIndex(e.identifier))||-1;this.handleAssetItemError(O,e,x,i,P.message);return}const _=T.edge-T.fragmentStart,A=n.duration;(m||A===null||_>A)&&(m=!1,this.log(`Interstitial asset "${d}" duration change ${A} > ${_}`),n.duration=_,this.updateSchedule())};p.on(C.LEVEL_UPDATED,(T,{details:S})=>y(S)),p.on(C.LEVEL_PTS_UPDATED,(T,{details:S})=>y(S)),p.on(C.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const g=(T,S)=>{const _=this.getAssetPlayer(d);if(_&&S.tracks){_.off(C.BUFFER_CODECS,g),_.tracks=S.tracks;const A=this.primaryMedia;this.bufferingAsset===_.assetItem&&A&&!_.media&&this.bufferAssetPlayer(_,A)}};p.on(C.BUFFER_CODECS,g);const v=()=>{var T;const S=this.getAssetPlayer(d);if(this.log(`buffered to end of asset ${S}`),!S||!this.schedule)return;const _=this.schedule.findEventIndex(e.identifier),A=(T=this.schedule.items)==null?void 0:T[_];this.isInterstitial(A)&&this.advanceAssetBuffering(A,n)};p.on(C.BUFFERED_TO_END,v);const b=T=>()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;this.shouldPlay=!0;const _=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,_,T)};return p.once(C.MEDIA_ENDED,b(i)),p.once(C.PLAYOUT_LIMIT_REACHED,b(1/0)),p.on(C.ERROR,(T,S)=>{if(!this.schedule)return;const _=this.getAssetPlayer(d);if(S.details===Q.BUFFER_STALLED_ERROR){if(_!=null&&_.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(S,e,this.schedule.findEventIndex(e.identifier),i,`Asset player error ${S.error} ${e}`)}),p.on(C.DESTROYING,()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;const S=new Error(`Asset player destroyed unexpectedly ${d}`),_={fatal:!0,type:He.OTHER_ERROR,details:Q.INTERSTITIAL_ASSET_ITEM_ERROR,error:S};this.handleAssetItemError(_,e,this.schedule.findEventIndex(e.identifier),i,S.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${Ql(n)}`),this.hls.trigger(C.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:n,assetListIndex:i,event:e,player:p}),p}clearInterstitial(e,n){e.assetList.forEach(i=>{this.clearAssetPlayer(i.identifier,n)}),e.reset()}resetAssetPlayer(e){const n=this.getAssetPlayerQueueIndex(e);if(n!==-1){this.log(`reset asset player "${e}" after error`);const i=this.playerQueue[n];this.transferMediaFromPlayer(i,null),i.resetDetails()}}clearAssetPlayer(e,n){const i=this.getAssetPlayerQueueIndex(e);if(i!==-1){const r=this.playerQueue[i];this.log(`clear ${r} toSegment: ${n&&ir(n)}`),this.transferMediaFromPlayer(r,n),this.playerQueue.splice(i,1),r.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,n,i,r,s){const{interstitial:o,assetItem:a,assetId:l}=e,u=o.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=a,(!c||c.identifier!==l)&&(c&&(this.clearAssetPlayer(c.identifier,i[r]),delete c.error),this.log(`INTERSTITIAL_ASSET_STARTED ${n+1}/${u} ${Ql(a)}`),this.hls.trigger(C.INTERSTITIAL_ASSET_STARTED,{asset:a,assetListIndex:n,event:o,schedule:i.slice(0),scheduleIndex:r,player:e})),this.bufferAssetPlayer(e,s)}bufferAssetPlayer(e,n){var i,r;if(!this.schedule)return;const{interstitial:s,assetItem:o}=e,a=this.schedule.findEventIndex(s.identifier),l=(i=this.schedule.items)==null?void 0:i[a];if(!l)return;e.loadSource(),this.setBufferingItem(l),this.bufferingAsset=o;const u=this.getBufferingPlayer();if(u===e)return;const c=s.appendInPlace;if(c&&(u==null?void 0:u.interstitial.appendInPlace)===!1)return;const d=(u==null?void 0:u.tracks)||((r=this.detachedData)==null?void 0:r.tracks)||this.requiredTracks;if(c&&o!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(d&&!ND(d,e.tracks)){const f=new Error(`Asset ${Ql(o)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(d)}')`),h={fatal:!0,type:He.OTHER_ERROR,details:Q.INTERSTITIAL_ASSET_ITEM_ERROR,error:f},p=s.findAssetIndex(o);this.handleAssetItemError(h,s,a,p,f.message);return}}this.transferMediaTo(e,n)}handleInPlaceStall(e){const n=this.schedule,i=this.primaryMedia;if(!n||!i)return;const r=i.currentTime,s=n.findAssetIndex(e,r),o=e.assetList[s];if(o){const a=this.getAssetPlayer(o.identifier);if(a){const l=a.currentTime||r-o.timelineStart,u=a.duration-l;if(this.warn(`Stalled at ${l} of ${l+u} in ${a} ${e} (media.currentTime: ${r})`),l&&(u/i.playbackRate<.5||a.bufferedInPlaceToEnd(i))&&a.hls){const c=n.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,c,s)}}}}advanceInPlace(e){const n=this.primaryMedia;n&&n.currentTime<e&&(n.currentTime=e)}handleAssetItemError(e,n,i,r,s){if(e.details===Q.BUFFER_STALLED_ERROR)return;const o=n.assetList[r]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${o&&Ql(o)} ${e.error}`),!this.schedule)return;const a=(o==null?void 0:o.identifier)||"",l=this.getAssetPlayerQueueIndex(a),u=this.playerQueue[l]||null,c=this.schedule.items,d=xt({},e,{fatal:!1,errorAction:zl(!0),asset:o,assetListIndex:r,event:n,schedule:c,scheduleIndex:i,player:u});if(this.hls.trigger(C.INTERSTITIAL_ASSET_ERROR,d),!e.fatal)return;const f=this.playingAsset,h=this.bufferingAsset,p=new Error(s);if(o&&(this.clearAssetPlayer(a,null),o.error=p),!n.assetList.some(m=>!m.error))n.error=p;else for(let m=r;m<n.assetList.length;m++)this.resetAssetPlayer(n.assetList[m].identifier);this.updateSchedule(!0),n.error?this.primaryFallback(n):f&&f.identifier===a?this.advanceAfterAssetEnded(n,i,r):h&&h.identifier===a&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,h)}primaryFallback(e){const n=e.timelineStart,i=this.effectivePlayingItem;if(i){this.log(`Fallback to primary from event "${e.identifier}" start: ${n} pos: ${this.timelinePos} playing: ${ir(i)} error: ${e.error}`);let r=this.timelinePos;r===-1&&(r=this.hls.startPosition);const s=this.updateItem(i,r);if(this.itemsMatch(i,s)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(n,null),this.flushFrontBuffer(n)),!this.schedule)return;const o=this.schedule.findItemIndexAtTime(r);this.setSchedulePosition(o)}else this.checkStart()}onAssetListLoaded(e,n){var i,r;const s=n.event,o=s.identifier,a=n.assetListResponse.ASSETS;if(!((i=this.schedule)!=null&&i.hasEvent(o)))return;const l=s.timelineStart,u=s.duration;let c=0;a.forEach((m,y)=>{const g=parseFloat(m.DURATION);this.createAsset(s,y,c,l+c,g,m.URI),c+=g}),s.duration=c,this.log(`Loaded asset-list with duration: ${c} (was: ${u}) ${s}`);const d=this.waitingItem,f=(d==null?void 0:d.event.identifier)===o;this.updateSchedule();const h=(r=this.bufferingItem)==null?void 0:r.event;if(f){var p;const m=this.schedule.findEventIndex(o),y=(p=this.schedule.items)==null?void 0:p[m];if(y){if(!this.playingItem&&this.timelinePos>y.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==m){s.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${s}`),this.updateSchedule(!0),this.primaryFallback(s);return}this.setBufferingItem(y)}this.setSchedulePosition(m)}else if((h==null?void 0:h.identifier)===o){const m=s.assetList[0];if(m){const y=this.getAssetPlayer(m.identifier);if(h.appendInPlace){const g=this.primaryMedia;y&&g&&this.bufferAssetPlayer(y,g)}else y&&y.loadSource()}}}onError(e,n){if(this.schedule)switch(n.details){case Q.ASSET_LIST_PARSING_ERROR:case Q.ASSET_LIST_LOAD_ERROR:case Q.ASSET_LIST_LOAD_TIMEOUT:{const i=n.interstitial;i&&(this.updateSchedule(!0),this.primaryFallback(i));break}case Q.BUFFER_STALLED_ERROR:{const i=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&i.event.appendInPlace){this.handleInPlaceStall(i.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const n6=500;class ele extends lE{constructor(e,n,i){super(e,n,i,"subtitle-stream-controller",Pe.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(C.LEVEL_LOADED,this.onLevelLoaded,this),e.on(C.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(C.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(C.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(C.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(C.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(C.LEVEL_LOADED,this.onLevelLoaded,this),e.off(C.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(C.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(C.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(C.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(C.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,n){this.stopLoad(),this.state=ae.IDLE,this.setInterval(n6),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=n?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,n){this.tracksBuffered=[],super.onMediaDetaching(e,n)}onLevelLoaded(e,n){this.mainDetails=n.details}onSubtitleFragProcessed(e,n){const{frag:i,success:r}=n;if(this.fragContextChanged(i)||(un(i)&&(this.fragPrevious=i),this.state=ae.IDLE),!r)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let o;const a=i.start;for(let u=0;u<s.length;u++)if(a>=s[u].start&&a<=s[u].end){o=s[u];break}const l=i.start+i.duration;o?o.end=l:(o={start:a,end:l},s.push(o)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null),this.media&&this.tick()}onBufferFlushing(e,n){const{startOffset:i,endOffset:r}=n;if(i===0&&r!==Number.POSITIVE_INFINITY){const s=r-1;if(s<=0)return;n.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(o=>{for(let a=0;a<o.length;){if(o[a].end<=s){o.shift();continue}else if(o[a].start<s)o[a].start=s;else break;a++}}),this.fragmentTracker.removeFragmentsInRange(i,s,Pe.SUBTITLE)}}onError(e,n){const i=n.frag;(i==null?void 0:i.type)===Pe.SUBTITLE&&(n.details===Q.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==ae.STOPPED&&(this.state=ae.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:n}){if(this.levels&&PN(this.levels,n)){this.levels=n.map(i=>new pd(i));return}this.tracksBuffered=[],this.levels=n.map(i=>{const r=new pd(i);return this.tracksBuffered[r.id]=[],r}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Pe.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,n){var i;if(this.currentTrackId=n.id,!((i=this.levels)!=null&&i.length)||this.currentTrackId===-1){this.clearInterval();return}const r=this.levels[this.currentTrackId];r!=null&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.state!==ae.STOPPED&&this.setInterval(n6)}onSubtitleTrackLoaded(e,n){var i;const{currentTrackId:r,levels:s}=this,{details:o,id:a}=n;if(!s){this.warn(`Subtitle tracks were reset while loading level ${a}`);return}const l=s[a];if(a>=s.length||!l)return;this.log(`Subtitle track ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let u=0;if(o.live||(i=l.details)!=null&&i.live){if(o.deltaUpdateFailed)return;const d=this.mainDetails;if(!d){this.startFragRequested=!1;return}const f=d.fragments[0];if(!l.details)o.hasProgramDateTime&&d.hasProgramDateTime?(Yp(o,d),u=o.fragmentStart):f&&(u=f.start,aE(o,u));else{var c;u=this.alignPlaylists(o,l.details,(c=this.levelLastLoaded)==null?void 0:c.details),u===0&&f&&(u=f.start,aE(o,u))}d&&!this.startFragRequested&&this.setStartPosition(d,u)}l.details=o,this.levelLastLoaded=l,a===r&&(this.hls.trigger(C.SUBTITLE_TRACK_UPDATED,{details:o,id:a,groupId:n.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===ae.IDLE&&(da(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:n,payload:i}=e,r=n.decryptdata,s=this.hls;if(!this.fragContextChanged(n)&&i&&i.byteLength>0&&r!=null&&r.key&&r.iv&&Gl(r.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(i),r.key.buffer,r.iv.buffer,eE(r.method)).catch(a=>{throw s.trigger(C.ERROR,{type:He.MEDIA_ERROR,details:Q.FRAG_DECRYPT_ERROR,fatal:!1,error:a,reason:a.message,frag:n}),a}).then(a=>{const l=performance.now();s.trigger(C.FRAG_DECRYPTED,{frag:n,payload:a,stats:{tstart:o,tdecrypt:l}})}).catch(a=>{this.warn(`${a.name}: ${a.message}`),this.state=ae.IDLE})}}doTick(){if(!this.media){this.state=ae.IDLE;return}if(this.state===ae.IDLE){const{currentTrackId:e,levels:n}=this,i=n==null?void 0:n[e];if(!i||!n.length||!i.details||this.waitForLive(i))return;const{config:r}=this,s=this.getLoadPosition(),o=Qe.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,r.maxBufferHole),{end:a,len:l}=o,u=i.details,c=this.hls.maxBufferLength+u.levelTargetDuration;if(l>c)return;const d=u.fragments,f=d.length,h=u.edge;let p=null;const m=this.fragPrevious;if(a<h){const v=r.maxFragLookUpTolerance,b=a>h-v?0:v;p=da(m,d,Math.max(d[0].start,a),b),!p&&m&&m.start<d[0].start&&(p=d[0])}else p=d[f-1];if(p=this.filterReplacedPrimary(p,i.details),!p)return;const y=p.sn-u.startSN,g=d[y-1];if(g&&g.cc===p.cc&&this.fragmentTracker.getState(g)===mn.NOT_LOADED&&(p=g),this.fragmentTracker.getState(p)===mn.NOT_LOADED){const v=this.mapToInitFragWhenRequired(p);v&&this.loadFragment(v,i,a)}}}loadFragment(e,n,i){un(e)?super.loadFragment(e,n,i):this._loadInitSegment(e,n)}get mediaBufferTimeRanges(){return new tle(this.tracksBuffered[this.currentTrackId]||[])}}class tle{constructor(e){this.buffered=void 0;const n=(i,r,s)=>{if(r=r>>>0,r>s-1)throw new DOMException(`Failed to execute '${i}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${s})`);return e[r][i]};this.buffered={get length(){return e.length},end(i){return n("end",i,e.length)},start(i){return n("start",i,e.length)}}}}const nle={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},i6=t=>String.fromCharCode(nle[t]||t),rr=15,vs=100,ile={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},rle={17:2,18:4,21:6,22:8,23:10,19:13,20:15},sle={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},ole={25:2,26:4,29:6,30:8,31:10,27:13,28:15},ale=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class lle{constructor(){this.time=null,this.verboseLevel=0}log(e,n){if(this.verboseLevel>=e){const i=typeof n=="function"?n():n;Et.log(`${this.time} [${e}] ${i}`)}}}const pa=function(e){const n=[];for(let i=0;i<e.length;i++)n.push(e[i].toString(16));return n};class r6{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const n=["foreground","underline","italics","background","flash"];for(let i=0;i<n.length;i++){const r=n[i];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class ule{constructor(){this.uchar=" ",this.penState=new r6}reset(){this.uchar=" ",this.penState.reset()}setChar(e,n){this.uchar=e,this.penState.copy(n)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class cle{constructor(e){this.chars=[],this.pos=0,this.currPenState=new r6,this.cueStartTime=null,this.logger=void 0;for(let n=0;n<vs;n++)this.chars.push(new ule);this.logger=e}equals(e){for(let n=0;n<vs;n++)if(!this.chars[n].equals(e.chars[n]))return!1;return!0}copy(e){for(let n=0;n<vs;n++)this.chars[n].copy(e.chars[n])}isEmpty(){let e=!0;for(let n=0;n<vs;n++)if(!this.chars[n].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>vs&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=vs)}moveCursor(e){const n=this.pos+e;if(e>1)for(let i=this.pos+1;i<n+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(n)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const n=i6(e);if(this.pos>=vs){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+n+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(n,this.currPenState),this.moveCursor(1)}clearFromPos(e){let n;for(n=e;n<vs;n++)this.chars[n].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let n=!0;for(let i=0;i<vs;i++){const r=this.chars[i].uchar;r!==" "&&(n=!1),e.push(r)}return n?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class NE{constructor(e){this.rows=[],this.currRow=rr-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let n=0;n<rr;n++)this.rows.push(new cle(e));this.logger=e}reset(){for(let e=0;e<rr;e++)this.rows[e].clear();this.currRow=rr-1}equals(e){let n=!0;for(let i=0;i<rr;i++)if(!this.rows[i].equals(e.rows[i])){n=!1;break}return n}copy(e){for(let n=0;n<rr;n++)this.rows[n].copy(e.rows[n])}isEmpty(){let e=!0;for(let n=0;n<rr;n++)if(!this.rows[n].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+It(e));let n=e.row-1;if(this.nrRollUpRows&&n<this.nrRollUpRows-1&&(n=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==n){for(let a=0;a<rr;a++)this.rows[a].clear();const s=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const a=o.rows[s].cueStartTime,l=this.logger.time;if(a!==null&&l!==null&&a<l)for(let u=0;u<this.nrRollUpRows;u++)this.rows[n-this.nrRollUpRows+u+1].copy(o.rows[s+u])}}this.currRow=n;const i=this.rows[this.currRow];if(e.indent!==null){const s=e.indent,o=Math.max(s-1,0);i.setCursor(e.indent),e.color=i.chars[o].penState.foreground}const r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+It(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,n=this.rows.splice(e,1)[0];n.clear(),this.rows.splice(this.currRow,0,n),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const n=[];let i="",r=-1;for(let s=0;s<rr;s++){const o=this.rows[s].getTextString();o&&(r=s+1,e?n.push("Row "+r+": '"+o+"'"):n.push(o.trim()))}return n.length>0&&(e?i="["+n.join(" | ")+"]":i=n.join(`
`)),i}getTextAndFormat(){return this.rows}}class s6{constructor(e,n,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=n,this.mode=null,this.verbose=0,this.displayedMemory=new NE(i),this.nonDisplayedMemory=new NE(i),this.lastOutputScreen=new NE(i),this.currRollUpRow=this.displayedMemory.rows[rr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[rr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let i=0;i<e.length;i++)this.writeScreen.insertChar(e[i]);const n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>n+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const n={flash:!1};if(n.underline=e%2===1,n.italics=e>=46,n.italics)n.foreground="white";else{const i=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];n.foreground=r[i]}this.logger.log(2,"MIDROW: "+It(n)),this.writeScreen.setPen(n)}outputDataUpdate(e=!1){const n=this.logger.time;n!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=n:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,n,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:n),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class o6{constructor(e,n,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=fle(),this.logger=void 0;const r=this.logger=new lle;this.channels=[null,new s6(e,n,r),new s6(e+1,i,r)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,n){this.channels[e].setHandler(n)}addData(e,n){this.logger.time=e;for(let i=0;i<n.length;i+=2){const r=n[i]&127,s=n[i+1]&127;let o=!1,a=null;if(r===0&&s===0)continue;this.logger.log(3,()=>"["+pa([n[i],n[i+1]])+"] -> ("+pa([r,s])+")");const l=this.cmdHistory;if(r>=16&&r<=31){if(dle(r,s,l)){c0(null,null,l),this.logger.log(3,()=>"Repeated command ("+pa([r,s])+") is dropped");continue}c0(r,s,this.cmdHistory),o=this.parseCmd(r,s),o||(o=this.parseMidrow(r,s)),o||(o=this.parsePAC(r,s)),o||(o=this.parseBackgroundAttributes(r,s))}else c0(null,null,l);if(!o&&(a=this.parseChars(r,s),a)){const c=this.currentChannel;c&&c>0?this.channels[c].insertChars(a):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!a&&this.logger.log(2,()=>"Couldn't parse cleaned data "+pa([r,s])+" orig: "+pa([n[i],n[i+1]]))}}parseCmd(e,n){const i=(e===20||e===28||e===21||e===29)&&n>=32&&n<=47,r=(e===23||e===31)&&n>=33&&n<=35;if(!(i||r))return!1;const s=e===20||e===21||e===23?1:2,o=this.channels[s];return e===20||e===21||e===28||e===29?n===32?o.ccRCL():n===33?o.ccBS():n===34?o.ccAOF():n===35?o.ccAON():n===36?o.ccDER():n===37?o.ccRU(2):n===38?o.ccRU(3):n===39?o.ccRU(4):n===40?o.ccFON():n===41?o.ccRDC():n===42?o.ccTR():n===43?o.ccRTD():n===44?o.ccEDM():n===45?o.ccCR():n===46?o.ccENM():n===47&&o.ccEOC():o.ccTO(n-32),this.currentChannel=s,!0}parseMidrow(e,n){let i=0;if((e===17||e===25)&&n>=32&&n<=47){if(e===17?i=1:i=2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[i];return r?(r.ccMIDROW(n),this.logger.log(3,()=>"MIDROW ("+pa([e,n])+")"),!0):!1}return!1}parsePAC(e,n){let i;const r=(e>=17&&e<=23||e>=25&&e<=31)&&n>=64&&n<=127,s=(e===16||e===24)&&n>=64&&n<=95;if(!(r||s))return!1;const o=e<=23?1:2;n>=64&&n<=95?i=o===1?ile[e]:sle[e]:i=o===1?rle[e]:ole[e];const a=this.channels[o];return a?(a.setPAC(this.interpretPAC(i,n)),this.currentChannel=o,!0):!1}interpretPAC(e,n){let i;const r={color:null,italics:!1,indent:null,underline:!1,row:e};return n>95?i=n-96:i=n-64,r.underline=(i&1)===1,i<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(r.italics=!0,r.color="white"):r.indent=Math.floor((i-16)/2)*4,r}parseChars(e,n){let i,r=null,s=null;if(e>=25?(i=2,s=e-8):(i=1,s=e),s>=17&&s<=19){let o;s===17?o=n+80:s===18?o=n+112:o=n+144,this.logger.log(2,()=>"Special char '"+i6(o)+"' in channel "+i),r=[o]}else e>=32&&e<=127&&(r=n===0?[e]:[e,n]);return r&&this.logger.log(3,()=>"Char codes =  "+pa(r).join(",")),r}parseBackgroundAttributes(e,n){const i=(e===16||e===24)&&n>=32&&n<=47,r=(e===23||e===31)&&n>=45&&n<=47;if(!(i||r))return!1;let s;const o={};e===16||e===24?(s=Math.floor((n-32)/2),o.background=ale[s],n%2===1&&(o.background=o.background+"_semi")):n===45?o.background="transparent":(o.foreground="black",n===47&&(o.underline=!0));const a=e<=23?1:2;return this.channels[a].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const n=this.channels[e];n&&n.reset()}c0(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let n=0;n<this.channels.length;n++){const i=this.channels[n];i&&i.cueSplitAtTime(e)}}}function c0(t,e,n){n.a=t,n.b=e}function dle(t,e,n){return n.a===t&&n.b===e}function fle(){return{a:null,b:null}}var ME=function(){if(Wp!=null&&Wp.VTTCue)return self.VTTCue;const t=["","lr","rl"],e=["start","middle","end","left","right"];function n(a,l){if(typeof l!="string"||!Array.isArray(a))return!1;const u=l.toLowerCase();return~a.indexOf(u)?u:!1}function i(a){return n(t,a)}function r(a){return n(e,a)}function s(a,...l){let u=1;for(;u<arguments.length;u++){const c=arguments[u];for(const d in c)a[d]=c[d]}return a}function o(a,l,u){const c=this,d={enumerable:!0};c.hasBeenReset=!1;let f="",h=!1,p=a,m=l,y=u,g=null,v="",b=!0,T="auto",S="start",_=50,A="middle",P=50,O="middle";Object.defineProperty(c,"id",s({},d,{get:function(){return f},set:function(x){f=""+x}})),Object.defineProperty(c,"pauseOnExit",s({},d,{get:function(){return h},set:function(x){h=!!x}})),Object.defineProperty(c,"startTime",s({},d,{get:function(){return p},set:function(x){if(typeof x!="number")throw new TypeError("Start time must be set to a number.");p=x,this.hasBeenReset=!0}})),Object.defineProperty(c,"endTime",s({},d,{get:function(){return m},set:function(x){if(typeof x!="number")throw new TypeError("End time must be set to a number.");m=x,this.hasBeenReset=!0}})),Object.defineProperty(c,"text",s({},d,{get:function(){return y},set:function(x){y=""+x,this.hasBeenReset=!0}})),Object.defineProperty(c,"region",s({},d,{get:function(){return g},set:function(x){g=x,this.hasBeenReset=!0}})),Object.defineProperty(c,"vertical",s({},d,{get:function(){return v},set:function(x){const L=i(x);if(L===!1)throw new SyntaxError("An invalid or illegal string was specified.");v=L,this.hasBeenReset=!0}})),Object.defineProperty(c,"snapToLines",s({},d,{get:function(){return b},set:function(x){b=!!x,this.hasBeenReset=!0}})),Object.defineProperty(c,"line",s({},d,{get:function(){return T},set:function(x){if(typeof x!="number"&&x!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");T=x,this.hasBeenReset=!0}})),Object.defineProperty(c,"lineAlign",s({},d,{get:function(){return S},set:function(x){const L=r(x);if(!L)throw new SyntaxError("An invalid or illegal string was specified.");S=L,this.hasBeenReset=!0}})),Object.defineProperty(c,"position",s({},d,{get:function(){return _},set:function(x){if(x<0||x>100)throw new Error("Position must be between 0 and 100.");_=x,this.hasBeenReset=!0}})),Object.defineProperty(c,"positionAlign",s({},d,{get:function(){return A},set:function(x){const L=r(x);if(!L)throw new SyntaxError("An invalid or illegal string was specified.");A=L,this.hasBeenReset=!0}})),Object.defineProperty(c,"size",s({},d,{get:function(){return P},set:function(x){if(x<0||x>100)throw new Error("Size must be between 0 and 100.");P=x,this.hasBeenReset=!0}})),Object.defineProperty(c,"align",s({},d,{get:function(){return O},set:function(x){const L=r(x);if(!L)throw new SyntaxError("An invalid or illegal string was specified.");O=L,this.hasBeenReset=!0}})),c.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o}();class hle{decode(e,n){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function a6(t){function e(i,r,s,o){return(i|0)*3600+(r|0)*60+(s|0)+parseFloat(o||0)}const n=t.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return n?parseFloat(n[2])>59?e(n[2],n[3],0,n[4]):e(n[1],n[2],n[3],n[4]):null}class ple{constructor(){this.values=Object.create(null)}set(e,n){!this.get(e)&&n!==""&&(this.values[e]=n)}get(e,n,i){return i?this.has(e)?this.values[e]:n[i]:this.has(e)?this.values[e]:n}has(e){return e in this.values}alt(e,n,i){for(let r=0;r<i.length;++r)if(n===i[r]){this.set(e,n);break}}integer(e,n){/^-?\d+$/.test(n)&&this.set(e,parseInt(n,10))}percent(e,n){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(n)){const i=parseFloat(n);if(i>=0&&i<=100)return this.set(e,i),!0}return!1}}function l6(t,e,n,i){const r=i?t.split(i):[t];for(const s in r){if(typeof r[s]!="string")continue;const o=r[s].split(n);if(o.length!==2)continue;const a=o[0],l=o[1];e(a,l)}}const FE=new ME(0,0,""),d0=FE.align==="middle"?"middle":"center";function mle(t,e,n){const i=t;function r(){const a=a6(t);if(a===null)throw new Error("Malformed timestamp: "+i);return t=t.replace(/^[^\sa-zA-Z-]+/,""),a}function s(a,l){const u=new ple;l6(a,function(f,h){let p;switch(f){case"region":for(let m=n.length-1;m>=0;m--)if(n[m].id===h){u.set(f,n[m].region);break}break;case"vertical":u.alt(f,h,["rl","lr"]);break;case"line":p=h.split(","),u.integer(f,p[0]),u.percent(f,p[0])&&u.set("snapToLines",!1),u.alt(f,p[0],["auto"]),p.length===2&&u.alt("lineAlign",p[1],["start",d0,"end"]);break;case"position":p=h.split(","),u.percent(f,p[0]),p.length===2&&u.alt("positionAlign",p[1],["start",d0,"end","line-left","line-right","auto"]);break;case"size":u.percent(f,h);break;case"align":u.alt(f,h,["start",d0,"end","left","right"]);break}},/:/,/\s/),l.region=u.get("region",null),l.vertical=u.get("vertical","");let c=u.get("line","auto");c==="auto"&&FE.line===-1&&(c=-1),l.line=c,l.lineAlign=u.get("lineAlign","start"),l.snapToLines=u.get("snapToLines",!0),l.size=u.get("size",100),l.align=u.get("align",d0);let d=u.get("position","auto");d==="auto"&&FE.position===50&&(d=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=d}function o(){t=t.replace(/^\s+/,"")}if(o(),e.startTime=r(),o(),t.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);t=t.slice(3),o(),e.endTime=r(),o(),s(t,e)}function u6(t){return t.replace(/<br(?: \/)?>/gi,`
`)}class gle{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new hle,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const n=this;e&&(n.buffer+=n.decoder.decode(e,{stream:!0}));function i(){let s=n.buffer,o=0;for(s=u6(s);o<s.length&&s[o]!=="\r"&&s[o]!==`
`;)++o;const a=s.slice(0,o);return s[o]==="\r"&&++o,s[o]===`
`&&++o,n.buffer=s.slice(o),a}function r(s){l6(s,function(o,a){},/:/)}try{let s="";if(n.state==="INITIAL"){if(!/\r\n|\n/.test(n.buffer))return this;s=i();const a=s.match(/^()?WEBVTT([ \t].*)?$/);if(!(a!=null&&a[0]))throw new Error("Malformed WebVTT signature.");n.state="HEADER"}let o=!1;for(;n.buffer;){if(!/\r\n|\n/.test(n.buffer))return this;switch(o?o=!1:s=i(),n.state){case"HEADER":/:/.test(s)?r(s):s||(n.state="ID");continue;case"NOTE":s||(n.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){n.state="NOTE";break}if(!s)continue;if(n.cue=new ME(0,0,""),n.state="CUE",s.indexOf("-->")===-1){n.cue.id=s;continue}case"CUE":if(!n.cue){n.state="BADCUE";continue}try{mle(s,n.cue,n.regionList)}catch{n.cue=null,n.state="BADCUE";continue}n.state="CUETEXT";continue;case"CUETEXT":{const a=s.indexOf("-->")!==-1;if(!s||a&&(o=!0)){n.oncue&&n.cue&&n.oncue(n.cue),n.cue=null,n.state="ID";continue}if(n.cue===null)continue;n.cue.text&&(n.cue.text+=`
`),n.cue.text+=s}continue;case"BADCUE":s||(n.state="ID")}}}catch{n.state==="CUETEXT"&&n.cue&&n.oncue&&n.oncue(n.cue),n.cue=null,n.state=n.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(n){e.onparsingerror&&e.onparsingerror(n)}return e.onflush&&e.onflush(),this}}const yle=/\r\n|\n\r|\n|\r/g,BE=function(e,n,i=0){return e.slice(i,i+n.length)===n},vle=function(e){let n=parseInt(e.slice(-3));const i=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!Ce(n)||!Ce(i)||!Ce(r)||!Ce(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return n+=1e3*i,n+=60*1e3*r,n+=60*60*1e3*s,n};function UE(t,e,n){return xd(t.toString())+xd(e.toString())+xd(n)}const ble=function(e,n,i){let r=e[n],s=e[r.prevCC];if(!s||!s.new&&r.new){e.ccOffset=e.presentationOffset=r.start,r.new=!1;return}for(;(o=s)!=null&&o.new;){var o;e.ccOffset+=r.start-s.start,r.new=!1,r=s,s=e[r.prevCC]}e.presentationOffset=i};function Ele(t,e,n,i,r,s,o){const a=new gle,l=Ei(new Uint8Array(t)).trim().replace(yle,`
`).split(`
`),u=[],c=e?Roe(e.baseTime,e.timescale):0;let d="00:00.000",f=0,h=0,p,m=!0;a.oncue=function(y){const g=n[i];let v=n.ccOffset;const b=(f-c)/9e4;if(g!=null&&g.new&&(h!==void 0?v=n.ccOffset=g.start:ble(n,i,b)),b){if(!e){p=new Error("Missing initPTS for VTT MPEGTS");return}v=b-n.presentationOffset}const T=y.endTime-y.startTime,S=xi((y.startTime+v-h)*9e4,r*9e4)/9e4;y.startTime=Math.max(S,0),y.endTime=Math.max(S+T,0);const _=y.text.trim();y.text=decodeURIComponent(encodeURIComponent(_)),y.id||(y.id=UE(y.startTime,y.endTime,_)),y.endTime>0&&u.push(y)},a.onparsingerror=function(y){p=y},a.onflush=function(){if(p){o(p);return}s(u)},l.forEach(y=>{if(m)if(BE(y,"X-TIMESTAMP-MAP=")){m=!1,y.slice(16).split(",").forEach(g=>{BE(g,"LOCAL:")?d=g.slice(6):BE(g,"MPEGTS:")&&(f=parseInt(g.slice(7)))});try{h=vle(d)/1e3}catch(g){p=g}return}else y===""&&(m=!1);a.parse(y+`
`)}),a.flush()}const HE="stpp.ttml.im1t",c6=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,d6=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Tle={left:"start",center:"center",right:"end",start:"start",end:"end"};function f6(t,e,n,i){const r=ot(new Uint8Array(t),["mdat"]);if(r.length===0){i(new Error("Could not parse IMSC1 mdat"));return}const s=r.map(a=>Ei(a)),o=Ioe(e.baseTime,1,e.timescale);try{s.forEach(a=>n(Sle(a,o)))}catch(a){i(a)}}function Sle(t,e){const r=new DOMParser().parseFromString(t,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(s).reduce((d,f)=>(d[f]=r.getAttribute(`ttp:${f}`)||s[f],d),{}),a=r.getAttribute("xml:space")!=="preserve",l=h6($E(r,"styling","style")),u=h6($E(r,"layout","region")),c=$E(r,"body","[begin]");return[].map.call(c,d=>{const f=p6(d,a);if(!f||!d.hasAttribute("begin"))return null;const h=VE(d.getAttribute("begin"),o),p=VE(d.getAttribute("dur"),o);let m=VE(d.getAttribute("end"),o);if(h===null)throw m6(d);if(m===null){if(p===null)throw m6(d);m=h+p}const y=new ME(h-e,m-e,f);y.id=UE(y.startTime,y.endTime,y.text);const g=u[d.getAttribute("region")],v=l[d.getAttribute("style")],b=xle(g,v,l),{textAlign:T}=b;if(T){const S=Tle[T];S&&(y.lineAlign=S),y.align=T}return xt(y,b),y}).filter(d=>d!==null)}function $E(t,e,n){const i=t.getElementsByTagName(e)[0];return i?[].slice.call(i.querySelectorAll(n)):[]}function h6(t){return t.reduce((e,n)=>{const i=n.getAttribute("xml:id");return i&&(e[i]=n),e},{})}function p6(t,e){return[].slice.call(t.childNodes).reduce((n,i,r)=>{var s;return i.nodeName==="br"&&r?n+`
`:(s=i.childNodes)!=null&&s.length?p6(i,e):e?n+i.textContent.trim().replace(/\s+/g," "):n+i.textContent},"")}function xle(t,e,n){const i="http://www.w3.org/ns/ttml#styling";let r=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=t!=null&&t.hasAttribute("style")?t.getAttribute("style"):null;return o&&n.hasOwnProperty(o)&&(r=n[o]),s.reduce((a,l)=>{const u=zE(e,i,l)||zE(t,i,l)||zE(r,i,l);return u&&(a[l]=u),a},{})}function zE(t,e,n){return t&&t.hasAttributeNS(e,n)?t.getAttributeNS(e,n):null}function m6(t){return new Error(`Could not parse ttml timestamp ${t}`)}function VE(t,e){if(!t)return null;let n=a6(t);return n===null&&(c6.test(t)?n=wle(t,e):d6.test(t)&&(n=_le(t,e))),n}function wle(t,e){const n=c6.exec(t),i=(n[4]|0)+(n[5]|0)/e.subFrameRate;return(n[1]|0)*3600+(n[2]|0)*60+(n[3]|0)+i/e.frameRate}function _le(t,e){const n=d6.exec(t),i=Number(n[1]);switch(n[2]){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/e.frameRate;case"t":return i/e.tickRate}return i}class f0{constructor(e,n){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=n}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,n,i){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=n,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class Ale{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=v6(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(C.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(C.MANIFEST_LOADING,this.onManifestLoading,this),e.on(C.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(C.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(C.FRAG_LOADING,this.onFragLoading,this),e.on(C.FRAG_LOADED,this.onFragLoaded,this),e.on(C.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(C.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(C.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(C.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(C.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(C.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(C.MANIFEST_LOADING,this.onManifestLoading,this),e.off(C.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(C.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(C.FRAG_LOADING,this.onFragLoading,this),e.off(C.FRAG_LOADED,this.onFragLoaded,this),e.off(C.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(C.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(C.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(C.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(C.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new f0(this,"textTrack1"),n=new f0(this,"textTrack2"),i=new f0(this,"textTrack3"),r=new f0(this,"textTrack4");this.cea608Parser1=new o6(1,e,n),this.cea608Parser2=new o6(3,i,r)}addCues(e,n,i,r,s){let o=!1;for(let a=s.length;a--;){const l=s[a],u=Cle(l[0],l[1],n,i);if(u>=0&&(l[0]=Math.min(l[0],n),l[1]=Math.max(l[1],i),o=!0,u/(i-n)>.5))return}if(o||s.push([n,i]),this.config.renderTextTracksNatively){const a=this.captionsTracks[e];this.Cues.newCue(a,n,i,r)}else{const a=this.Cues.newCue(null,n,i,r);this.hls.trigger(C.CUES_PARSED,{type:"captions",cues:a,track:e})}}onInitPtsFound(e,{frag:n,id:i,initPTS:r,timescale:s,trackId:o}){const{unparsedVttFrags:a}=this;i===Pe.MAIN&&(this.initPTS[n.cc]={baseTime:r,timescale:s,trackId:o}),a.length&&(this.unparsedVttFrags=[],a.forEach(l=>{this.initPTS[l.frag.cc]?this.onFragLoaded(C.FRAG_LOADED,l):this.hls.trigger(C.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,n){const{media:i}=this;if(i)for(let r=0;r<i.textTracks.length;r++){const s=i.textTracks[r];if(y6(s,{name:e,lang:n,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:n,captionsTracks:i,media:r}=this,{label:s,languageCode:o}=n[e],a=this.getExistingTrack(s,o);if(a)i[e]=a,Yl(i[e]),QN(i[e],r);else{const l=this.createTextTrack("captions",s,o);l&&(l[e]=!0,i[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const n=this.captionsProperties[e];if(!n)return;const i=n.label,r={_id:e,label:i,kind:"captions",default:n.media?!!n.media.default:!1,closedCaptions:n.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(C.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(e,n,i){const r=this.media;if(r)return r.addTextTrack(e,n,i)}onMediaAttaching(e,n){this.media=n.media,n.mediaSource||this._cleanTracks()}onMediaDetaching(e,n){const i=!!n.transferMedia;if(this.media=null,i)return;const{captionsTracks:r}=this;Object.keys(r).forEach(s=>{Yl(r[s]),delete r[s]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=v6(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const n=e.textTracks;if(n)for(let i=0;i<n.length;i++)Yl(n[i])}onSubtitleTracksUpdated(e,n){const i=n.subtitleTracks||[],r=i.some(s=>s.textCodec===HE);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(PN(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){const o=this.media,a=o?a0(o.textTracks):null;if(this.tracks.forEach((l,u)=>{let c;if(a){let d=null;for(let f=0;f<a.length;f++)if(a[f]&&y6(a[f],l)){d=a[f],a[f]=null;break}d&&(c=d)}if(c)Yl(c);else{const d=g6(l);c=this.createTextTrack(d,l.name,l.lang),c&&(c.mode="disabled")}c&&this.textTracks.push(c)}),a!=null&&a.length){const l=a.filter(u=>u!==null).map(u=>u.label);l.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(a=>({label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}));this.hls.trigger(C.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,n){this.config.enableCEA708Captions&&n.captions&&n.captions.forEach(i=>{const r=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!r)return;const s=`textTrack${r[1]}`,o=this.captionsProperties[s];o&&(o.label=i.name,i.lang&&(o.languageCode=i.lang),o.media=i)})}closedCaptionsForLevel(e){const n=this.hls.levels[e.level];return n==null?void 0:n.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,n){if(this.enabled&&n.frag.type===Pe.MAIN){var i,r;const{cea608Parser1:s,cea608Parser2:o,lastSn:a}=this,{cc:l,sn:u}=n.frag,c=(i=(r=n.part)==null?void 0:r.index)!=null?i:-1;s&&o&&(u!==a+1||u===a&&c!==this.lastPartIndex+1||l!==this.lastCc)&&(s.reset(),o.reset()),this.lastCc=l,this.lastSn=u,this.lastPartIndex=c}}onFragLoaded(e,n){const{frag:i,payload:r}=n;if(i.type===Pe.SUBTITLE)if(r.byteLength){const s=i.decryptdata,o="stats"in n;if(s==null||!s.encrypted||o){const a=this.tracks[i.level],l=this.vttCCs;l[i.cc]||(l[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),a&&a.textCodec===HE?this._parseIMSC1(i,r):this._parseVTTs(n)}}else this.hls.trigger(C.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,n){const i=this.hls;f6(n,this.initPTS[e.cc],r=>{this._appendCues(r,e.level),i.trigger(C.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},r=>{i.logger.log(`Failed to parse IMSC1: ${r}`),i.trigger(C.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:r})})}_parseVTTs(e){var n;const{frag:i,payload:r}=e,{initPTS:s,unparsedVttFrags:o}=this,a=s.length-1;if(!s[i.cc]&&a===-1){o.push(e);return}const l=this.hls,u=(n=i.initSegment)!=null&&n.data?$i(i.initSegment.data,new Uint8Array(r)).buffer:r;Ele(u,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,c=>{this._appendCues(c,i.level),l.trigger(C.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},c=>{const d=c.message==="Missing initPTS for VTT MPEGTS";d?o.push(e):this._fallbackToIMSC1(i,r),l.logger.log(`Failed to parse VTT cue: ${c}`),!(d&&a>i.cc)&&l.trigger(C.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:c})})}_fallbackToIMSC1(e,n){const i=this.tracks[e.level];i.textCodec||f6(n,this.initPTS[e.cc],()=>{i.textCodec=HE,this._parseIMSC1(e,n)},()=>{i.textCodec="wvtt"})}_appendCues(e,n){const i=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[n];if(!r||r.mode==="disabled")return;e.forEach(s=>ZN(r,s))}else{const r=this.tracks[n];if(!r)return;const s=r.default?"default":"subtitles"+n;i.trigger(C.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,n){const{frag:i}=n;i.type===Pe.SUBTITLE&&this.onFragLoaded(C.FRAG_LOADED,n)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,n){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:i,samples:r}=n;if(!(i.type===Pe.MAIN&&this.closedCaptionsForLevel(i)==="NONE"))for(let s=0;s<r.length;s++){const o=r[s].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const a=this.extractCea608Data(o);this.cea608Parser1.addData(r[s].pts,a[0]),this.cea608Parser2.addData(r[s].pts,a[1])}}}onBufferFlushing(e,{startOffset:n,endOffset:i,endOffsetSubtitles:r,type:s}){const{media:o}=this;if(!(!o||o.currentTime<i)){if(!s||s==="video"){const{captionsTracks:a}=this;Object.keys(a).forEach(l=>kE(a[l],n,i))}if(this.config.renderTextTracksNatively&&n===0&&r!==void 0){const{textTracks:a}=this;Object.keys(a).forEach(l=>kE(a[l],n,r))}}}extractCea608Data(e){const n=[[],[]],i=e[0]&31;let r=2;for(let s=0;s<i;s++){const o=e[r++],a=127&e[r++],l=127&e[r++];if(a===0&&l===0)continue;if((4&o)!==0){const c=3&o;(c===0||c===1)&&(n[c].push(a),n[c].push(l))}}return n}}function g6(t){return t.characteristics&&/transcribes-spoken-dialog/gi.test(t.characteristics)&&/describes-music-and-sound/gi.test(t.characteristics)?"captions":"subtitles"}function y6(t,e){return!!t&&t.kind===g6(e)&&wE(e,t)}function Cle(t,e,n,i){return Math.min(e,i)-Math.max(t,n)}function v6(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const Ile=/\s/,Rle={newCue(t,e,n,i){const r=[];let s,o,a,l,u;const c=self.VTTCue||self.TextTrackCue;for(let f=0;f<i.rows.length;f++)if(s=i.rows[f],a=!0,l=0,u="",!s.isEmpty()){var d;for(let m=0;m<s.chars.length;m++)Ile.test(s.chars[m].uchar)&&a?l++:(u+=s.chars[m].uchar,a=!1);s.cueStartTime=e,e===n&&(n+=1e-4),l>=16?l--:l++;const h=u6(u.trim()),p=UE(e,n,h);t!=null&&(d=t.cues)!=null&&d.getCueById(p)||(o=new c(e,n,h),o.id=p,o.line=f+1,o.align="left",o.position=10+Math.min(80,Math.floor(l*8/32)*10),r.push(o))}return t&&r.length&&(r.sort((f,h)=>f.line==="auto"||h.line==="auto"?0:f.line>8&&h.line>8?h.line-f.line:f.line-h.line),r.forEach(f=>ZN(t,f))),r}};function Lle(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const Ple=/(\d+)-(\d+)\/(\d+)/;class b6{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||Nle,this.controller=new self.AbortController,this.stats=new Hb}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,n,i){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const s=kle(e,this.controller.signal),o=e.responseType==="arraybuffer",a=o?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:u}=n.loadPolicy;this.context=e,this.config=n,this.callbacks=i,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),n.timeout=l&&Ce(l)?l:u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},n.timeout),(Td(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(d=>{var f;this.response=this.loader=d;const h=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),n.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},u-(h-r.loading.start)),!d.ok){const{status:m,statusText:y}=d;throw new Mle(y||"fetch, bad network response",m,d)}r.loading.first=h,r.total=Ole(d.headers)||r.total;const p=(f=this.callbacks)==null?void 0:f.onProgress;return p&&Ce(n.highWaterMark)?this.loadProgressively(d,r,e,n.highWaterMark,p):o?d.arrayBuffer():e.responseType==="json"?d.json():d.text()}).then(d=>{var f,h;const p=this.response;if(!p)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const m=d[a];m&&(r.loaded=r.total=m);const y={url:p.url,data:d,code:p.status},g=(f=this.callbacks)==null?void 0:f.onProgress;g&&!Ce(n.highWaterMark)&&g(r,e,d,p),(h=this.callbacks)==null||h.onSuccess(y,r,e,p)}).catch(d=>{var f;if(self.clearTimeout(this.requestTimeout),r.aborted)return;const h=d&&d.code||0,p=d?d.message:null;(f=this.callbacks)==null||f.onError({code:h,text:p},e,d?d.details:null,r)})}getCacheAge(){let e=null;if(this.response){const n=this.response.headers.get("age");e=n?parseFloat(n):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,n,i,r=0,s){const o=new iN,a=e.body.getReader(),l=()=>a.read().then(u=>{if(u.done)return o.dataLength&&s(n,i,o.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const c=u.value,d=c.length;return n.loaded+=d,d<r||o.dataLength?(o.push(c),o.dataLength>=r&&s(n,i,o.flush().buffer,e)):s(n,i,c.buffer,e),l()}).catch(()=>Promise.reject());return l()}}function kle(t,e){const n={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(xt({},t.headers))};return t.rangeEnd&&n.headers.set("Range","bytes="+t.rangeStart+"-"+String(t.rangeEnd-1)),n}function Dle(t){const e=Ple.exec(t);if(e)return parseInt(e[2])-parseInt(e[1])+1}function Ole(t){const e=t.get("Content-Range");if(e){const i=Dle(e);if(Ce(i))return i}const n=t.get("Content-Length");if(n)return parseInt(n)}function Nle(t,e){return new self.Request(t.url,e)}class Mle extends Error{constructor(e,n,i){super(e),this.code=void 0,this.details=void 0,this.code=n,this.details=i}}const Fle=/^age:\s*[\d.]+\s*$/im;class E6{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Hb,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,n,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=n,this.callbacks=i,this.loadInternal()}loadInternal(){const{config:e,context:n}=this;if(!e||!n)return;const i=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!(this.loader!==i||this.stats.aborted))return s(i,n.url)}).catch(o=>{if(!(this.loader!==i||this.stats.aborted))return i.open("GET",n.url,!0),s(i,n.url)}).then(()=>{this.loader!==i||this.stats.aborted||this.openAndSendXhr(i,n,e)}).catch(o=>{var a;(a=this.callbacks)==null||a.onError({code:i.status,text:o.message},n,i,r)}):this.openAndSendXhr(i,n,e)}openAndSendXhr(e,n,i){e.readyState||e.open("GET",n.url,!0);const r=n.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:o}=i.loadPolicy;if(r)for(const a in r)e.setRequestHeader(a,r[a]);n.rangeEnd&&e.setRequestHeader("Range","bytes="+n.rangeStart+"-"+(n.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=n.responseType,self.clearTimeout(this.requestTimeout),i.timeout=s&&Ce(s)?s:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()}readystatechange(){const{context:e,loader:n,stats:i}=this;if(!e||!n)return;const r=n.readyState,s=this.config;if(!i.aborted&&r>=2&&(i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),r===4)){self.clearTimeout(this.requestTimeout),n.onreadystatechange=null,n.onprogress=null;const u=n.status,c=n.responseType==="text"?n.responseText:null;if(u>=200&&u<300){const p=c??n.response;if(p!=null){var o,a;i.loading.end=Math.max(self.performance.now(),i.loading.first);const m=n.responseType==="arraybuffer"?p.byteLength:p.length;i.loaded=i.total=m,i.bwEstimate=i.total*8e3/(i.loading.end-i.loading.first);const y=(o=this.callbacks)==null?void 0:o.onProgress;y&&y(i,e,p,n);const g={url:n.responseURL,data:p,code:u};(a=this.callbacks)==null||a.onSuccess(g,i,e,n);return}}const d=s.loadPolicy.errorRetry,f=i.retry,h={url:e.url,data:void 0,code:u};if(zp(d,f,!1,h))this.retry(d);else{var l;Et.error(`${u} while loading ${e.url}`),(l=this.callbacks)==null||l.onError({code:u,text:n.statusText},e,n,i)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,n=this.stats.retry;if(zp(e,n,!0))this.retry(e);else{var i;Et.warn(`timeout while loading ${(i=this.context)==null?void 0:i.url}`);const r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:n,stats:i}=this;this.retryDelay=Yb(e,i.retry),i.retry++,Et.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${n==null?void 0:n.url}, retrying ${i.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const n=this.stats;n.loaded=e.loaded,e.lengthComputable&&(n.total=e.total)}getCacheAge(){let e=null;if(this.loader&&Fle.test(this.loader.getAllResponseHeaders())){const n=this.loader.getResponseHeader("age");e=n?parseFloat(n):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const Ble={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},Ule=bt(bt({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:E6,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:ese,bufferController:Goe,capLevelController:AE,errorController:sse,fpsController:zae,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:PO,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:Ble},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},Hle()),{},{subtitleStreamController:ele,subtitleTrackController:jae,timelineController:Ale,audioStreamController:Hoe,audioTrackController:$oe,emeController:Kl,cmcdController:Bae,contentSteeringController:Hae,interstitialsController:Jae});function Hle(){return{cueHandler:Rle,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function $le(t,e,n){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=GE(t),r=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach(o=>{const a=`${o==="level"?"playlist":o}LoadPolicy`,l=e[a]===void 0,u=[];s.forEach(c=>{const d=`${o}Loading${c}`,f=e[d];if(f!==void 0&&l){u.push(d);const h=i[a].default;switch(e[a]={default:h},c){case"TimeOut":h.maxLoadTimeMs=f,h.maxTimeToFirstByteMs=f;break;case"MaxRetry":h.errorRetry.maxNumRetry=f,h.timeoutRetry.maxNumRetry=f;break;case"RetryDelay":h.errorRetry.retryDelayMs=f,h.timeoutRetry.retryDelayMs=f;break;case"MaxRetryTimeout":h.errorRetry.maxRetryDelayMs=f,h.timeoutRetry.maxRetryDelayMs=f;break}}}),u.length&&n.warn(`hls.js config: "${u.join('", "')}" setting(s) are deprecated, use "${a}": ${It(e[a])}`)}),bt(bt({},i),e)}function GE(t){return t&&typeof t=="object"?Array.isArray(t)?t.map(GE):Object.keys(t).reduce((e,n)=>(e[n]=GE(t[n]),e),{}):t}function zle(t,e){const n=t.loader;n!==b6&&n!==E6?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),t.progressive=!1):Lle()&&(t.loader=b6,t.progressive=!0,t.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const h0=2,Vle=.1,Gle=.05,jle=100;class Wle extends TO{constructor(e,n){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var i;(i=this.media)!=null&&i.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var i;this.ended=((i=this.media)==null?void 0:i.currentTime)||1,this.hls.trigger(C.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=n,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(C.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(C.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(C.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(C.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,n){this.setInterval(jle),this.mediaSource=n.mediaSource;const i=this.media=n.media;Vn(i,"playing",this.onMediaPlaying),Vn(i,"waiting",this.onMediaWaiting),Vn(i,"ended",this.onMediaEnded)}onMediaDetaching(e,n){this.clearInterval();const{media:i}=this;i&&(oi(i,"playing",this.onMediaPlaying),oi(i,"waiting",this.onMediaWaiting),oi(i,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,n){this.buffered=n.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const n=this.media.currentTime;this.poll(n,this.lastCurrentTime),this.lastCurrentTime=n}poll(e,n){var i,r;const s=(i=this.hls)==null?void 0:i.config;if(!s)return;const o=this.media;if(!o)return;const{seeking:a}=o,l=this.seeking&&!a,u=!this.seeking&&a,c=o.paused&&!a||o.ended||o.playbackRate===0;if(this.seeking=a,e!==n){n&&(this.ended=0),this.moved=!0,a||(this.nudgeRetry=0,s.nudgeOnVideoHole&&!c&&e>n&&this.nudgeOnVideoHole(e,n)),this.waiting===0&&this.stallResolved(e);return}if(u||l){l&&this.stallResolved(e);return}if(c){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&o.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(C.MEDIA_ENDED,{stalled:!1}));return}if(!Qe.getBuffered(o).length){this.nudgeRetry=0;return}const d=Qe.bufferInfo(o,e,0),f=d.nextStart||0,h=this.fragmentTracker;if(a&&h&&this.hls){const _=T6(this.hls.inFlightFragments,e),A=d.len>h0,P=!f||_||f-e>h0&&!h.getPartialFragment(e);if(A||P)return;this.moved=!1}const p=(r=this.hls)==null?void 0:r.latestLevelDetails;if(!this.moved&&this.stalled!==null&&h){if(!(d.len>0)&&!f)return;const A=Math.max(f,d.start||0)-e,O=!!(p!=null&&p.live)?p.targetduration*2:h0,x=p0(e,h);if(A>0&&(A<=O||x)){o.paused||this._trySkipBufferHole(x);return}}const m=s.detectStallWithCurrentTimeMs,y=self.performance.now(),g=this.waiting;let v=this.stalled;if(v===null)if(g>0&&y-g<m)v=this.stalled=g;else{this.stalled=y;return}const b=y-v;if(!a&&(b>=m||g)&&this.hls){var T;if(((T=this.mediaSource)==null?void 0:T.readyState)==="ended"&&!(p!=null&&p.live)&&Math.abs(e-((p==null?void 0:p.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(C.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(d),!this.media||!this.hls)return}const S=Qe.bufferInfo(o,e,s.maxBufferHole);this._tryFixBufferStall(S,b,e)}stallResolved(e){const n=this.stalled;if(n&&this.hls&&(this.stalled=null,this.stallReported)){const i=self.performance.now()-n;this.log(`playback not stuck anymore @${e}, after ${Math.round(i)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(C.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,n){var i;const r=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(i=this.buffered.audio)!=null&&i.length&&r&&r.length>1&&e>r.end(0)){const s=Qe.bufferedInfo(Qe.timeRangesToArray(this.buffered.audio),e,0);if(s.len>1&&n>=s.start){const o=Qe.timeRangesToArray(r),a=Qe.bufferedInfo(o,n,0).bufferedIndex;if(a>-1&&a<o.length-1){const l=Qe.bufferedInfo(o,e,0).bufferedIndex,u=o[a].end,c=o[a+1].start;if((l===-1||l>a)&&c-u<1&&e-u<2){const d=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${u} -> ${c} buffered index: ${l}`);this.warn(d.message),this.media.currentTime+=1e-6;let f=p0(e,this.fragmentTracker);f&&"fragment"in f?f=f.fragment:f||(f=void 0);const h=Qe.bufferInfo(this.media,e,0);this.hls.trigger(C.ERROR,{type:He.MEDIA_ERROR,details:Q.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:d,reason:d.message,frag:f,buffer:h.len,bufferInfo:h})}}}}}_tryFixBufferStall(e,n,i){var r,s;const{fragmentTracker:o,media:a}=this,l=(r=this.hls)==null?void 0:r.config;if(!a||!o||!l)return;const u=(s=this.hls)==null?void 0:s.latestLevelDetails,c=p0(i,o);if((c||u!=null&&u.live&&i<u.fragmentStart)&&(this._trySkipBufferHole(c)||!this.media))return;const d=e.buffered,f=this.adjacentTraversal(e,i);(d&&d.length>1&&e.len>l.maxBufferHole||e.nextStart&&(e.nextStart-i<l.maxBufferHole||f))&&(n>l.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,n){const i=this.fragmentTracker,r=e.nextStart;if(i&&r){const s=i.getFragAtPos(n,Pe.MAIN),o=i.getFragAtPos(r,Pe.MAIN);if(s&&o)return o.sn-s.sn<2}return!1}_reportStall(e){const{hls:n,media:i,stallReported:r,stalled:s}=this;if(!r&&s!==null&&i&&n){this.stallReported=!0;const o=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${It(e)})`);this.warn(o.message),n.trigger(C.ERROR,{type:He.MEDIA_ERROR,details:Q.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len,bufferInfo:e,stalled:{start:s}})}}_trySkipBufferHole(e){var n;const{fragmentTracker:i,media:r}=this,s=(n=this.hls)==null?void 0:n.config;if(!r||!i||!s)return 0;const o=r.currentTime,a=Qe.bufferInfo(r,o,0),l=o<a.start?a.start:a.nextStart;if(l&&this.hls){const c=a.len<=s.maxBufferHole,d=a.len>0&&a.len<1&&r.readyState<3,f=l-o;if(f>0&&(c||d)){if(f>s.maxBufferHole){let p=!1;if(o===0){const m=i.getAppendedFrag(0,Pe.MAIN);m&&l<m.end&&(p=!0)}if(!p&&e){var u;if(!((u=this.hls.loadLevelObj)!=null&&u.details)||T6(this.hls.inFlightFragments,l))return 0;let y=!1,g=e.end;for(;g<l;){const v=p0(g,i);if(v)g+=v.duration;else{y=!0;break}}if(y)return 0}}const h=Math.max(l+Gle,o+Vle);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${h}`),this.moved=!0,r.currentTime=h,!(e!=null&&e.gap)){const p=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${h}`),m={type:He.MEDIA_ERROR,details:Q.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:p,reason:p.message,buffer:a.len,bufferInfo:a};e&&("fragment"in e?m.part=e:m.frag=e),this.hls.trigger(C.ERROR,m)}return h}}return 0}_tryNudgeBuffer(e){const{hls:n,media:i,nudgeRetry:r}=this,s=n==null?void 0:n.config;if(!i||!s)return 0;const o=i.currentTime;if(this.nudgeRetry++,r<s.nudgeMaxRetry){const a=o+(r+1)*s.nudgeOffset,l=new Error(`Nudging 'currentTime' from ${o} to ${a}`);this.warn(l.message),i.currentTime=a,n.trigger(C.ERROR,{type:He.MEDIA_ERROR,details:Q.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1,buffer:e.len,bufferInfo:e})}else{const a=new Error(`Playhead still not moving while enough data buffered @${o} after ${s.nudgeMaxRetry} nudges`);this.error(a.message),n.trigger(C.ERROR,{type:He.MEDIA_ERROR,details:Q.BUFFER_STALLED_ERROR,error:a,fatal:!0,buffer:e.len,bufferInfo:e})}}}function T6(t,e){const n=S6(t.main);if(n&&n.start<=e)return n;const i=S6(t.audio);return i&&i.start<=e?i:null}function S6(t){if(!t)return null;switch(t.state){case ae.IDLE:case ae.STOPPED:case ae.ENDED:case ae.ERROR:return null}return t.frag}function p0(t,e){return e.getAppendedFrag(t,Pe.MAIN)||e.getPartialFragment(t)}const qle=.25;function jE(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function WE(t,e,n,i,r){let s=new t(e,n,"");try{s.value=i,r&&(s.type=r)}catch{s=new t(e,n,It(r?bt({type:r},i):i))}return s}const m0=(()=>{const t=jE();try{t&&new t(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class Kle{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(C.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(C.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(C.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(C.MANIFEST_LOADING,this.onManifestLoading,this),e.on(C.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(C.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(C.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(C.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(C.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(C.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(C.MANIFEST_LOADING,this.onManifestLoading,this),e.off(C.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(C.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(C.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(C.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,n){var i;this.media=n.media,((i=n.overrides)==null?void 0:i.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const n=(e=this.hls)==null?void 0:e.latestLevelDetails;n&&this.updateDateRangeCues(n)}onMediaDetaching(e,n){this.media=null,!n.transferMedia&&(this.id3Track&&(this.removeCues&&Yl(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const n=this.getID3Track(e.textTracks);return n.mode="hidden",n}getID3Track(e){if(this.media){for(let n=0;n<e.length;n++){const i=e[n];if(i.kind==="metadata"&&i.label==="id3")return QN(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,n){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:i,enableID3MetadataCues:r}=this.hls.config;if(!i&&!r)return;const{samples:s}=n;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=jE();if(o)for(let a=0;a<s.length;a++){const l=s[a].type;if(l===Si.emsg&&!i||!r)continue;const u=dN(s[a].data),c=s[a].pts;let d=c+s[a].duration;d>m0&&(d=m0),d-c<=0&&(d=c+qle);for(let h=0;h<u.length;h++){const p=u[h];if(!fN(p)){this.updateId3CueEnds(c,l);const m=WE(o,c,d,p,l);m&&this.id3Track.addCue(m)}}}}updateId3CueEnds(e,n){var i;const r=(i=this.id3Track)==null?void 0:i.cues;if(r)for(let s=r.length;s--;){const o=r[s];o.type===n&&o.startTime<e&&o.endTime===m0&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:n,endOffset:i,type:r}){const{id3Track:s,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:l}}=o;if(s&&(a||l)){let u;r==="audio"?u=c=>c.type===Si.audioId3&&l:r==="video"?u=c=>c.type===Si.emsg&&a:u=c=>c.type===Si.audioId3&&l||c.type===Si.emsg&&a,kE(s,n,i,u)}}onLevelUpdated(e,{details:n}){this.updateDateRangeCues(n,!0)}onLevelPtsUpdated(e,n){Math.abs(n.drift)>.01&&this.updateDateRangeCues(n.details)}updateDateRangeCues(e,n){if(!this.hls||!this.media)return;const{assetPlayerId:i,timelineOffset:r,enableDateRangeMetadataCues:s,interstitialsController:o}=this.hls.config;if(!s)return;const a=jE();if(i&&r&&!o){const{fragmentStart:m,fragmentEnd:y}=e;let g=this.assetCue;g?(g.startTime=m,g.endTime=y):a&&(g=this.assetCue=WE(a,m,y,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),g&&(g.id=i,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(g),g.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:l}=this,{dateRanges:u}=e,c=Object.keys(u);let d=this.dateRangeCuesAppended;if(l&&n){var f;if((f=l.cues)!=null&&f.length){const m=Object.keys(d).filter(y=>!c.includes(y));for(let y=m.length;y--;){var h;const g=m[y],v=(h=d[g])==null?void 0:h.cues;delete d[g],v&&Object.keys(v).forEach(b=>{const T=v[b];if(T){T.removeEventListener("enter",this.onEventCueEnter);try{l.removeCue(T)}catch{}}})}}else d=this.dateRangeCuesAppended={}}const p=e.fragments[e.fragments.length-1];if(!(c.length===0||!Ce(p==null?void 0:p.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let m=0;m<c.length;m++){const y=c[m],g=u[y],v=g.startTime,b=d[y],T=(b==null?void 0:b.cues)||{};let S=(b==null?void 0:b.durationKnown)||!1,_=m0;const{duration:A,endDate:P}=g;if(P&&A!==null)_=v+A,S=!0;else if(g.endOnNext&&!S){const x=c.reduce((L,M)=>{if(M!==g.id){const V=u[M];if(V.class===g.class&&V.startDate>g.startDate&&(!L||g.startDate<L.startDate))return V}return L},null);x&&(_=x.startTime,S=!0)}const O=Object.keys(g.attr);for(let x=0;x<O.length;x++){const L=O[x];if(!vse(L))continue;const M=T[L];if(M)S&&!(b!=null&&b.durationKnown)?M.endTime=_:Math.abs(M.startTime-v)>.01&&(M.startTime=v,M.endTime=_);else if(a){let V=g.attr[L];bse(L)&&(V=MD(V));const U=WE(a,v,_,{key:L,data:V},Si.dateRange);U&&(U.id=y,this.id3Track.addCue(U),T[L]=U,o&&(L==="X-ASSET-LIST"||L==="X-ASSET-URL")&&U.addEventListener("enter",this.onEventCueEnter))}}d[y]={cues:T,dateRange:g,durationKnown:S}}}}}class Yle{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:n}=this,i=this.levelDetails;if(!n||!i)return;this.currentTime=n.currentTime;const r=this.computeLatency();if(r===null)return;this._latency=r;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:o}=this.config;if(!s||o===1||!i.live)return;const a=this.targetLatency;if(a===null)return;const l=r-a,u=Math.min(this.maxLatency,a+i.targetduration);if(l<u&&l>.05&&this.forwardBufferLength>1){const d=Math.min(2,Math.max(1,o)),f=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20,h=Math.min(d,Math.max(1,f));this.changeMediaPlaybackRate(n,h)}else n.playbackRate!==1&&n.playbackRate!==0&&this.changeMediaPlaybackRate(n,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const n=this.levelDetails;return n?e.liveMaxLatencyDurationCount*n.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:n,partHoldBack:i,targetduration:r}=e,{liveSyncDuration:s,liveSyncDurationCount:o,lowLatencyMode:a}=this.config,l=this.hls.userConfig;let u=a&&i||n;(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||u===0)&&(u=s!==void 0?s:o*r);const c=r;return u+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,c)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),n=this.targetLatency;if(e===null||n===null)return null;const i=this.levelDetails;if(i===null)return null;const r=i.edge,s=e-n-this.edgeStalled,o=r-i.totalduration,a=r-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(o,s),a)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const n=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-n,0)}get forwardBufferLength(){const{media:e}=this,n=this.levelDetails;if(!e||!n)return 0;const i=e.buffered.length;return(i?e.buffered.end(i-1):n.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(C.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(C.MANIFEST_LOADING,this.onManifestLoading,this),e.on(C.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(C.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(C.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(C.MANIFEST_LOADING,this.onManifestLoading,this),e.off(C.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(C.ERROR,this.onError,this))}onMediaAttached(e,n){this.media=n.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:n}){n.advanced&&this.onTimeupdate(),!n.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,n){var i;n.details===Q.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(i=this.levelDetails)!=null&&i.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,n){var i,r;e.playbackRate!==n&&((i=this.hls)==null||i.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(r=this.targetLatency)==null?void 0:r.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${n}`),e.playbackRate=n)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class Xle extends xE{constructor(e,n){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=n,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(C.MANIFEST_LOADING,this.onManifestLoading,this),e.on(C.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(C.LEVEL_LOADED,this.onLevelLoaded,this),e.on(C.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(C.FRAG_BUFFERED,this.onFragBuffered,this),e.on(C.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(C.MANIFEST_LOADING,this.onManifestLoading,this),e.off(C.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(C.LEVEL_LOADED,this.onLevelLoaded,this),e.off(C.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(C.FRAG_BUFFERED,this.onFragBuffered,this),e.off(C.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(n=>{n.loadError=0,n.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,n){this.resetLevels()}onManifestLoaded(e,n){const i=this.hls.config.preferManagedMediaSource,r=[],s={},o={};let a=!1,l=!1,u=!1;n.levels.forEach(c=>{const d=c.attrs;let{audioCodec:f,videoCodec:h}=c;f&&(c.audioCodec=f=Mp(f,i)||void 0),h&&(h=c.videoCodec=Nre(h));const{width:p,height:m,unknownCodecs:y}=c,g=(y==null?void 0:y.length)||0;if(a||(a=!!(p&&m)),l||(l=!!h),u||(u=!!f),g||f&&!this.isAudioSupported(f)||h&&!this.isVideoSupported(h)){this.log(`Some or all CODECS not supported "${d.CODECS}"`);return}const{CODECS:v,"FRAME-RATE":b,"HDCP-LEVEL":T,"PATHWAY-ID":S,RESOLUTION:_,"VIDEO-RANGE":A}=d,O=`${`${S||"."}-`}${c.bitrate}-${_}-${b}-${v}-${A}-${T}`;if(s[O])if(s[O].uri!==c.url&&!c.attrs["PATHWAY-ID"]){const x=o[O]+=1;c.attrs["PATHWAY-ID"]=new Array(x+1).join(".");const L=this.createLevel(c);s[O]=L,r.push(L)}else s[O].addGroupId("audio",d.AUDIO),s[O].addGroupId("text",d.SUBTITLES);else{const x=this.createLevel(c);s[O]=x,o[O]=1,r.push(x)}}),this.filterAndSortMediaOptions(r,n,a,l,u)}createLevel(e){const n=new pd(e),i=e.supplemental;if(i!=null&&i.videoCodec&&!this.isVideoSupported(i.videoCodec)){const r=new Error(`SUPPLEMENTAL-CODECS not supported "${i.videoCodec}"`);this.log(r.message),n.supportedResult=tO(r,[])}return n}isAudioSupported(e){return fd(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return fd(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,n,i,r,s){var o;let a=[],l=[],u=e;const c=((o=n.stats)==null?void 0:o.parsing)||{};if((i||r)&&s&&(u=u.filter(({videoCodec:v,videoRange:b,width:T,height:S})=>(!!v||!!(T&&S))&&jre(b))),u.length===0){Promise.resolve().then(()=>{if(this.hls){let v="no level with compatible codecs found in manifest",b=v;n.levels.length&&(b=`one or more CODECS in variant not supported: ${It(n.levels.map(S=>S.attrs.CODECS).filter((S,_,A)=>A.indexOf(S)===_))}`,this.warn(b),v+=` (${b})`);const T=new Error(v);this.hls.trigger(C.ERROR,{type:He.MEDIA_ERROR,details:Q.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:n.url,error:T,reason:b})}}),c.end=performance.now();return}n.audioTracks&&(a=n.audioTracks.filter(v=>!v.audioCodec||this.isAudioSupported(v.audioCodec)),x6(a)),n.subtitles&&(l=n.subtitles,x6(l));const d=u.slice(0);u.sort((v,b)=>{if(v.attrs["HDCP-LEVEL"]!==b.attrs["HDCP-LEVEL"])return(v.attrs["HDCP-LEVEL"]||"")>(b.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&v.height!==b.height)return v.height-b.height;if(v.frameRate!==b.frameRate)return v.frameRate-b.frameRate;if(v.videoRange!==b.videoRange)return Bp.indexOf(v.videoRange)-Bp.indexOf(b.videoRange);if(v.videoCodec!==b.videoCodec){const T=QD(v.videoCodec),S=QD(b.videoCodec);if(T!==S)return S-T}if(v.uri===b.uri&&v.codecSet!==b.codecSet){const T=Np(v.codecSet),S=Np(b.codecSet);if(T!==S)return S-T}return v.averageBitrate!==b.averageBitrate?v.averageBitrate-b.averageBitrate:0});let f=d[0];if(this.steering&&(u=this.steering.filterParsedLevels(u),u.length!==d.length)){for(let v=0;v<d.length;v++)if(d[v].pathwayId===u[0].pathwayId){f=d[v];break}}this._levels=u;for(let v=0;v<u.length;v++)if(u[v]===f){var h;this._firstLevel=v;const b=f.bitrate,T=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${u.length} level(s) found, first bitrate: ${b}`),((h=this.hls.userConfig)==null?void 0:h.abrEwmaDefaultEstimate)===void 0){const S=Math.min(b,this.hls.config.abrEwmaDefaultEstimateMax);S>T&&T===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=S)}break}const p=s&&!r,m=this.hls.config,y=!!(m.audioStreamController&&m.audioTrackController),g={levels:u,audioTracks:a,subtitleTracks:l,sessionData:n.sessionData,sessionKeys:n.sessionKeys,firstLevel:this._firstLevel,stats:n.stats,audio:s,video:r,altAudio:y&&!p&&a.some(v=>!!v.url)};c.end=performance.now(),this.hls.trigger(C.MANIFEST_PARSED,g)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const n=this._levels;if(n.length===0)return;if(e<0||e>=n.length){const c=new Error("invalid level idx"),d=e<0;if(this.hls.trigger(C.ERROR,{type:He.OTHER_ERROR,details:Q.LEVEL_SWITCH_ERROR,level:e,fatal:d,error:c,reason:c.message}),d)return;e=Math.min(e,n.length-1)}const i=this.currentLevelIndex,r=this.currentLevel,s=r?r.attrs["PATHWAY-ID"]:void 0,o=n[e],a=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,i===e&&r&&s===a)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${a?" with Pathway "+a:""} from level ${i}${s?" with Pathway "+s:""}`);const l={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(C.LEVEL_SWITCHING,l);const u=o.details;if(!u||u.live){const c=this.switchParams(o.uri,r==null?void 0:r.details,u);this.loadPlaylist(c)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const n=this.steering.pathways(),i=e.filter(r=>n.indexOf(r)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${n}`);return}this.steering.pathwayPriority=i}}onError(e,n){n.fatal||!n.context||n.context.type===dt.LEVEL&&n.context.level===this.level&&this.checkRetry(n)}onFragBuffered(e,{frag:n}){if(n!==void 0&&n.type===Pe.MAIN){const i=n.elementaryStreams;if(!Object.keys(i).some(s=>!!i[s]))return;const r=this._levels[n.level];r!=null&&r.loadError&&(this.log(`Resetting level error count of ${r.loadError} on frag buffered`),r.loadError=0)}}onLevelLoaded(e,n){var i;const{level:r,details:s}=n,o=n.levelInfo;if(!o){var a;this.warn(`Invalid level index ${r}`),(a=n.deliveryDirectives)!=null&&a.skip&&(s.deltaUpdateFailed=!0);return}if(o===this.currentLevel||n.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let l=o.details;l===n.details&&l.advanced&&(l=void 0),this.playlistLoaded(r,n,l)}else(i=n.deliveryDirectives)!=null&&i.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,n){super.loadingPlaylist(e,n);const i=this.getUrlWithDirectives(e.uri,n),r=this.currentLevelIndex,s=e.attrs["PATHWAY-ID"],o=e.details,a=o==null?void 0:o.age;this.log(`Loading level index ${r}${(n==null?void 0:n.msn)!==void 0?" at sn "+n.msn+" part "+n.part:""}${s?" Pathway "+s:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(C.LEVEL_LOADING,{url:i,level:r,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:n||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var n;if(this._levels.length===1)return;const i=this._levels.filter((s,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(s),s===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,s.details&&s.details.fragments.forEach(a=>a.level=-1)),!1));QO(i),this._levels=i,this.currentLevelIndex>-1&&(n=this.currentLevel)!=null&&n.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const r=i.length-1;this._firstLevel=Math.min(this._firstLevel,r),this._startLevel&&(this._startLevel=Math.min(this._startLevel,r)),this.hls.trigger(C.LEVELS_UPDATED,{levels:i})}onLevelsUpdated(e,{levels:n}){this._levels=n}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:n,maxHdcpLevel:i}=this.hls;this._maxAutoLevel!==n&&(this._maxAutoLevel=n,this.hls.trigger(C.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:n,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:i}))}}function x6(t){const e={};t.forEach(n=>{const i=n.groupId||"";n.id=e[i]=e[i]||0,e[i]++})}function w6(){return self.SourceBuffer||self.WebKitSourceBuffer}function _6(){if(!lo())return!1;const e=w6();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function Qle(){if(!_6())return!1;const t=lo();return typeof(t==null?void 0:t.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>t.isTypeSupported(hd(e,"video")))||["mp4a.40.2","fLaC"].some(e=>t.isTypeSupported(hd(e,"audio"))))}function Zle(){var t;const e=w6();return typeof(e==null||(t=e.prototype)==null?void 0:t.changeType)=="function"}const Jle=100;class eue extends lE{constructor(e,n,i){super(e,n,i,"stream-controller",Pe.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const r=this.media,s=r?r.currentTime:null;if(s===null||!Ce(s)||(this.log(`Media seeked to ${s.toFixed(3)}`),!this.getBufferedFrag(s)))return;const o=this.getFwdBufferInfoAtPos(r,s,Pe.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${s} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(C.MANIFEST_PARSED,this.onManifestParsed,this),e.on(C.LEVEL_LOADING,this.onLevelLoading,this),e.on(C.LEVEL_LOADED,this.onLevelLoaded,this),e.on(C.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(C.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(C.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(C.BUFFER_CREATED,this.onBufferCreated,this),e.on(C.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(C.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(C.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(C.MANIFEST_PARSED,this.onManifestParsed,this),e.off(C.LEVEL_LOADED,this.onLevelLoaded,this),e.off(C.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(C.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(C.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(C.BUFFER_CREATED,this.onBufferCreated,this),e.off(C.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(C.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(C.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,n){if(this.levels){const{lastCurrentTime:i,hls:r}=this;if(this.stopLoad(),this.setInterval(Jle),this.level=-1,!this.startFragRequested){let s=r.startLevel;s===-1&&(r.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=r.firstAutoLevel),r.nextLoadLevel=s,this.level=r.loadLevel,this._hasEnoughToStart=!!n}i>0&&e===-1&&!n&&(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i),this.state=ae.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=n?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=ae.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case ae.WAITING_LEVEL:{const{levels:e,level:n}=this,i=e==null?void 0:e[n],r=i==null?void 0:i.details;if(r&&(!r.live||this.levelLastLoaded===i&&!this.waitForLive(i))){if(this.waitForCdnTuneIn(r))break;this.state=ae.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=ae.IDLE;break}break}case ae.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===ae.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:n,levels:i,media:r}=this;if(n===null||!r&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const s=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(i!=null&&i[s]))return;const o=i[s],a=this.getMainFwdBufferInfo();if(a===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(a,l)){const m={};this.altAudio===2&&(m.type="video"),this.hls.trigger(C.BUFFER_EOS,m),this.state=ae.ENDED;return}if(!this.buffering)return;e.loadLevel!==s&&e.manualLevel===-1&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=e.nextLoadLevel=s;const u=o.details;if(!u||this.state===ae.WAITING_LEVEL||this.waitForLive(o)){this.level=s,this.state=ae.WAITING_LEVEL,this.startFragRequested=!1;return}const c=a.len,d=this.getMaxBufferLength(o.maxBitrate);if(c>=d)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const f=this.backtrackFragment?this.backtrackFragment.start:a.end;let h=this.getNextFragment(f,u);if(this.couldBacktrack&&!this.fragPrevious&&h&&un(h)&&this.fragmentTracker.getState(h)!==mn.OK){var p;const y=((p=this.backtrackFragment)!=null?p:h).sn-u.startSN,g=u.fragments[y-1];g&&h.cc===g.cc&&(h=g,this.fragmentTracker.removeFragment(g))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(h&&this.isLoopLoading(h,f)){if(!h.gap){const y=this.audioOnly&&!this.altAudio?Ct.AUDIO:Ct.VIDEO,g=(y===Ct.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;g&&this.afterBufferFlushed(g,y,Pe.MAIN)}h=this.getNextFragmentLoopLoading(h,u,a,Pe.MAIN,d)}h&&(h.initSegment&&!h.initSegment.data&&!this.bitrateTest&&(h=h.initSegment),this.loadFragment(h,o,f))}loadFragment(e,n,i){const r=this.fragmentTracker.getState(e);r===mn.NOT_LOADED||r===mn.PARTIAL?un(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,n)):super.loadFragment(e,n,i):this._loadInitSegment(e,n):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Pe.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:n}=this;if(n!=null&&n.readyState){let i;const r=this.getAppendedFrag(n.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const s=this.getLevelDetails();if(s!=null&&s.live){const a=this.getMainFwdBufferInfo();if(!a||a.len<s.targetduration*2)return}if(!n.paused&&e){const a=this.hls.nextLoadLevel,l=e[a],u=this.fragLastKbps;u&&this.fragCurrent?i=this.fragCurrent.duration*l.maxBitrate/(1e3*u)+1:i=0}else i=0;const o=this.getBufferedFrag(n.currentTime+i);if(o){const a=this.followingBufferedFrag(o);if(a){this.abortCurrentFrag();const l=a.maxStartPTS?a.maxStartPTS:a.start,u=a.duration,c=Math.max(o.end,l+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,u*(this.couldBacktrack?.5:.125)),u*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(c,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case ae.KEY_LOADING:case ae.FRAG_LOADING:case ae.FRAG_LOADING_WAITING_RETRY:case ae.PARSING:case ae.PARSED:this.state=ae.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,n){super.flushMainBuffer(e,n,this.altAudio===2?"video":null)}onMediaAttached(e,n){super.onMediaAttached(e,n);const i=n.media;Vn(i,"playing",this.onMediaPlaying),Vn(i,"seeked",this.onMediaSeeked)}onMediaDetaching(e,n){const{media:i}=this;i&&(oi(i,"playing",this.onMediaPlaying),oi(i,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,n),!n.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(C.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,n){let i=!1,r=!1;for(let s=0;s<n.levels.length;s++){const o=n.levels[s].audioCodec;o&&(i=i||o.indexOf("mp4a.40.2")!==-1,r=r||o.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=i&&r&&!Zle(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=n.levels,this.startFragRequested=!1}onLevelLoading(e,n){const{levels:i}=this;if(!i||this.state!==ae.IDLE)return;const r=n.levelInfo;(!r.details||r.details.live&&(this.levelLastLoaded!==r||r.details.expired)||this.waitForCdnTuneIn(r.details))&&(this.state=ae.WAITING_LEVEL)}onLevelLoaded(e,n){var i;const{levels:r,startFragRequested:s}=this,o=n.level,a=n.details,l=a.totalduration;if(!r){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${l}`);const u=n.levelInfo,c=this.fragCurrent;c&&(this.state===ae.FRAG_LOADING||this.state===ae.FRAG_LOADING_WAITING_RETRY)&&c.level!==n.level&&c.loader&&this.abortCurrentFrag();let d=0;if(a.live||(i=u.details)!=null&&i.live){var f;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;d=this.alignPlaylists(a,u.details,(f=this.levelLastLoaded)==null?void 0:f.details)}if(u.details=a,this.levelLastLoaded=u,s||this.setStartPosition(a,d),this.hls.trigger(C.LEVEL_UPDATED,{details:a,level:o}),this.state===ae.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=ae.IDLE}s&&a.live&&this.synchronizeToLiveEdge(a),this.tick()}synchronizeToLiveEdge(e){const{config:n,media:i}=this;if(!i)return;const r=this.hls.liveSyncPosition,s=this.getLoadPosition(),o=e.fragmentStart,a=e.edge,l=s>=o-n.maxFragLookUpTolerance&&s<=a;if(r!==null&&i.duration>r&&(s<r||!l)){const c=n.liveMaxLatencyDuration!==void 0?n.liveMaxLatencyDuration:n.liveMaxLatencyDurationCount*e.targetduration;if((!l&&i.readyState<4||s<a-c)&&(this._hasEnoughToStart||(this.nextLoadPosition=r),i.readyState))if(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${r.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var u;const d=Qe.bufferInfo(i,r,0);if(!((u=d.buffered)!=null&&u.length)){i.currentTime=r;return}if(d.start<=s){i.currentTime=r;return}const{nextStart:h}=Qe.bufferedInfo(d.buffered,s,0);h&&(i.currentTime=h)}else i.currentTime=r}}_handleFragmentLoadProgress(e){var n;const i=e.frag,{part:r,payload:s}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const a=o[i.level];if(!a){this.warn(`Level ${i.level} not found on progress`);return}const l=a.details;if(!l){this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),this.fragmentTracker.removeFragment(i);return}const u=a.videoCodec,c=l.PTSKnown||!l.live,d=(n=i.initSegment)==null?void 0:n.data,f=this._getAudioCodec(a),h=this.transmuxer=this.transmuxer||new RN(this.hls,Pe.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),p=r?r.index:-1,m=p!==-1,y=new Zb(i.level,i.sn,i.stats.chunkCount,s.byteLength,p,m),g=this.initPTS[i.cc];h.push(s,d,f,u,i,r,l.totalduration,c,y,g)}onAudioTrackSwitching(e,n){const i=this.hls,r=this.altAudio===2;if(Hp(n.url,i))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(r){this.fragmentTracker.removeAllFragments(),i.once(C.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(C.AUDIO_TRACK_SWITCHED,n)}),i.trigger(C.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}i.trigger(C.AUDIO_TRACK_SWITCHED,n)}}onAudioTrackSwitched(e,n){const i=Hp(n.url,this.hls);if(i){const r=this.videoBuffer;r&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=i?2:0,this.tick()}onBufferCreated(e,n){const i=n.tracks;let r,s,o=!1;for(const a in i){const l=i[a];if(l.id==="main"){if(s=a,r=l,a==="video"){const u=i[a];u&&(this.videoBuffer=u.buffer)}}else o=!0}o&&r?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(e,n){const{frag:i,part:r}=n,s=i.type===Pe.MAIN;if(s){if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),this.state===ae.PARSED&&(this.state=ae.IDLE);return}const a=r?r.stats:i.stats;this.fragLastKbps=Math.round(8*a.total/(a.buffering.end-a.loading.first)),un(i)&&(this.fragPrevious=i),this.fragBufferedComplete(i,r)}const o=this.media;o&&(!this._hasEnoughToStart&&Qe.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),s&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,n){var i;if(n.fatal){this.state=ae.ERROR;return}switch(n.details){case Q.FRAG_GAP:case Q.FRAG_PARSING_ERROR:case Q.FRAG_DECRYPT_ERROR:case Q.FRAG_LOAD_ERROR:case Q.FRAG_LOAD_TIMEOUT:case Q.KEY_LOAD_ERROR:case Q.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Pe.MAIN,n);break;case Q.LEVEL_LOAD_ERROR:case Q.LEVEL_LOAD_TIMEOUT:case Q.LEVEL_PARSING_ERROR:!n.levelRetry&&this.state===ae.WAITING_LEVEL&&((i=n.context)==null?void 0:i.type)===dt.LEVEL&&(this.state=ae.IDLE);break;case Q.BUFFER_ADD_CODEC_ERROR:case Q.BUFFER_APPEND_ERROR:if(n.parent!=="main")return;this.reduceLengthAndFlushBuffer(n)&&this.resetLoadingState();break;case Q.BUFFER_FULL_ERROR:if(n.parent!=="main")return;this.reduceLengthAndFlushBuffer(n)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case Q.INTERNAL_EXCEPTION:this.recoverWorkerError(n);break}}onFragLoadEmergencyAborted(){this.state=ae.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:n}){if(n!==Ct.AUDIO||!this.altAudio){const i=(n===Ct.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;i&&(this.afterBufferFlushed(i,n,Pe.MAIN),this.tick())}}onLevelsUpdated(e,n){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=n.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const n=e.currentTime;let i=this.startPosition;if(i>=0&&n<i){if(e.seeking){this.log(`could not seek to ${i}, already seeking at ${n}`);return}const r=this.timelineOffset;r&&i&&(i+=r);const s=this.getLevelDetails(),o=Qe.getBuffered(e),a=o.length?o.start(0):0,l=a-i,u=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||l>0&&(l<u||this.loadingParts&&l<2*((s==null?void 0:s.partTarget)||0)))&&(this.log(`adjusting start position by ${l} to match buffer start`),i+=l,this.startPosition=i),n<i&&(this.log(`seek to target start position ${i} from current time ${n} buffer start ${a}`),e.currentTime=i)}}_getAudioCodec(e){let n=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&n&&(this.log("Swapping audio codec"),n.indexOf("mp4a.40.5")!==-1?n="mp4a.40.2":n="mp4a.40.5"),n}_loadBitrateTestFrag(e,n){e.bitrateTest=!0,this._doFragLoad(e,n).then(i=>{const{hls:r}=this,s=i==null?void 0:i.frag;if(!s||this.fragContextChanged(s))return;n.fragmentError=0,this.state=ae.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=s.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),r.trigger(C.FRAG_LOADED,i),s.bitrateTest=!1}).catch(i=>{this.state===ae.STOPPED||this.state===ae.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const n=this.playlistType,{hls:i}=this,{remuxResult:r,chunkMeta:s}=e,o=this.getCurrentContext(s);if(!o){this.resetWhenMissingContext(s);return}const{frag:a,part:l,level:u}=o,{video:c,text:d,id3:f,initSegment:h}=r,{details:p}=u,m=this.altAudio?void 0:r.audio;if(this.fragContextChanged(a)){this.fragmentTracker.removeFragment(a);return}if(this.state=ae.PARSING,h){const y=h.tracks;if(y){const T=a.initSegment||a;if(this.unhandledEncryptionError(h,a))return;this._bufferInitSegment(u,y,T,s),i.trigger(C.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:n,tracks:y})}const g=h.initPTS,v=h.timescale,b=this.initPTS[a.cc];if(Ce(g)&&(!b||b.baseTime!==g||b.timescale!==v)){const T=h.trackId;this.initPTS[a.cc]={baseTime:g,timescale:v,trackId:T},i.trigger(C.INIT_PTS_FOUND,{frag:a,id:n,initPTS:g,timescale:v,trackId:T})}}if(c&&p){m&&c.type==="audiovideo"&&this.logMuxedErr(a);const y=p.fragments[a.sn-1-p.startSN],g=a.sn===p.startSN,v=!y||a.cc>y.cc;if(r.independent!==!1){const{startPTS:b,endPTS:T,startDTS:S,endDTS:_}=c;if(l)l.elementaryStreams[c.type]={startPTS:b,endPTS:T,startDTS:S,endDTS:_};else if(c.firstKeyFrame&&c.independent&&s.id===1&&!v&&(this.couldBacktrack=!0),c.dropped&&c.independent){const A=this.getMainFwdBufferInfo(),P=(A?A.end:this.getLoadPosition())+this.config.maxBufferHole,O=c.firstKeyFramePTS?c.firstKeyFramePTS:b;if(!g&&P<O-this.config.maxBufferHole&&!v){this.backtrack(a);return}else v&&(a.gap=!0);a.setElementaryStreamInfo(c.type,a.start,T,a.start,_,!0)}else g&&b-(p.appliedTimelineOffset||0)>h0&&(a.gap=!0);a.setElementaryStreamInfo(c.type,b,T,S,_),this.backtrackFragment&&(this.backtrackFragment=a),this.bufferFragmentData(c,a,l,s,g||v)}else if(g||v)a.gap=!0;else{this.backtrack(a);return}}if(m){const{startPTS:y,endPTS:g,startDTS:v,endDTS:b}=m;l&&(l.elementaryStreams[Ct.AUDIO]={startPTS:y,endPTS:g,startDTS:v,endDTS:b}),a.setElementaryStreamInfo(Ct.AUDIO,y,g,v,b),this.bufferFragmentData(m,a,l,s)}if(p&&f!=null&&f.samples.length){const y={id:n,frag:a,details:p,samples:f.samples};i.trigger(C.FRAG_PARSING_METADATA,y)}if(p&&d){const y={id:n,frag:a,details:p,samples:d.samples};i.trigger(C.FRAG_PARSING_USERDATA,y)}}logMuxedErr(e){this.warn(`${un(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,n,i,r){if(this.state!==ae.PARSING)return;this.audioOnly=!!n.audio&&!n.video,this.altAudio&&!this.audioOnly&&(delete n.audio,n.audiovideo&&this.logMuxedErr(i));const{audio:s,video:o,audiovideo:a}=n;if(s){const u=e.audioCodec;let c=Fp(s.codec,u);c==="mp4a"&&(c="mp4a.40.5");const d=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){c&&(c.indexOf("mp4a.40.5")!==-1?c="mp4a.40.2":c="mp4a.40.5");const f=s.metadata;f&&"channelCount"in f&&(f.channelCount||1)!==1&&d.indexOf("firefox")===-1&&(c="mp4a.40.5")}c&&c.indexOf("mp4a.40.5")!==-1&&d.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(c="mp4a.40.2",this.log(`Android: force audio codec to ${c}`)),u&&u!==c&&this.log(`Swapping manifest audio codec "${u}" for "${c}"`),s.levelCodec=c,s.id=Pe.MAIN,this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${c||""}/${u||""}/${s.codec}]`),delete n.audiovideo}if(o){o.levelCodec=e.videoCodec,o.id=Pe.MAIN;const u=o.codec;if((u==null?void 0:u.length)===4)switch(u){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${u}]${o.codec!==u?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete n.audiovideo}a&&(this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.codecs}/${a.codec}]`),delete n.video,delete n.audio);const l=Object.keys(n);if(l.length){if(this.hls.trigger(C.BUFFER_CODECS,n),!this.hls)return;l.forEach(u=>{const d=n[u].initSegment;d!=null&&d.byteLength&&this.hls.trigger(C.BUFFER_APPENDING,{type:u,data:d,frag:i,part:null,chunkMeta:r,parent:i.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,Pe.MAIN)}get maxBufferLength(){const{levels:e,level:n}=this,i=e==null?void 0:e[n];return i?this.getMaxBufferLength(i.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=ae.IDLE}checkFragmentChanged(){const e=this.media;let n=null;if(e&&e.readyState>1&&e.seeking===!1){const i=e.currentTime;if(Qe.isBuffered(e,i)?n=this.getAppendedFrag(i):Qe.isBuffered(e,i+.1)&&(n=this.getAppendedFrag(i+.1)),n){this.backtrackFragment=null;const r=this.fragPlaying,s=n.level;(!r||n.sn!==r.sn||r.level!==s)&&(this.fragPlaying=n,this.hls.trigger(C.FRAG_CHANGED,{frag:n}),(!r||r.level!==s)&&this.hls.trigger(C.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const n=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return Ce(n)?this.getAppendedFrag(n):null}get currentProgramDateTime(){var e;const n=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(Ce(n)){const i=this.getLevelDetails(),r=this.currentFrag||(i?da(null,i.fragments,n):null);if(r){const s=r.programDateTime;if(s!==null){const o=s+(n-r.start)*1e3;return new Date(o)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class tue extends Hi{constructor(e,n){super("key-loader",n),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const i in this.keyIdToKeyInfo){const r=this.keyIdToKeyInfo[i].loader;if(r){var n;if(e&&e!==((n=r.context)==null?void 0:n.frag.type))return;r.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const n=this.keyIdToKeyInfo[e];(n.mediaKeySessionContext||n.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const n=this.keyIdToKeyInfo[e].loader;n&&n.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,n=Q.KEY_LOAD_ERROR,i,r,s){return new ms({type:He.NETWORK_ERROR,details:n,fatal:!1,frag:e,response:s,error:i,networkDetails:r})}loadClear(e,n,i){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(n.length)for(let r=0,s=n.length;r<s;r++){const o=n[r];if(e.cc<=o.cc&&(!un(e)||!un(o)||e.sn<o.sn)||!i&&r==s-1)return this.emeController.selectKeySystemFormat(o).then(a=>{if(!this.emeController)return;o.setKeyFormat(a);const l=qp(a);if(l)return this.emeController.getKeySystemAccess([l])})}if(this.config.requireKeySystemAccessOnStart){const r=md(this.config);if(r.length)return this.emeController.getKeySystemAccess(r)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(n=>this.loadInternal(e,n)):this.loadInternal(e)}loadInternal(e,n){var i,r;n&&e.setKeyFormat(n);const s=e.decryptdata;if(!s){const u=new Error(n?`Expected frag.decryptdata to be defined after setting format ${n}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,Q.KEY_LOAD_ERROR,u))}const o=s.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,Q.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));const a=qE(s);let l=this.keyIdToKeyInfo[a];if((i=l)!=null&&i.decryptdata.key)return s.key=l.decryptdata.key,Promise.resolve({frag:e,keyInfo:l});if(this.emeController&&(r=l)!=null&&r.keyLoadPromise)switch(this.emeController.getKeyStatus(l.decryptdata)){case"usable":case"usable-in-future":return l.keyLoadPromise.then(c=>{const{keyInfo:d}=c;return s.key=d.decryptdata.key,{frag:e,keyInfo:d}})}switch(this.log(`${this.keyIdToKeyInfo[a]?"Rel":"L"}oading${s.keyId?" keyId: "+zn(s.keyId):""} URI: ${s.uri} from ${e.type} ${e.level}`),l=this.keyIdToKeyInfo[a]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(l,e):this.loadKeyEME(l,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(l,e);default:return Promise.reject(this.createKeyLoadError(e,Q.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,n){const i={frag:n,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var r;if(!e.decryptdata.keyId&&(r=n.initSegment)!=null&&r.data){const o=xre(n.initSegment.data);if(o.length){const a=o[0];a.some(l=>l!==0)&&(this.log(`Using keyId found in init segment ${zn(a)}`),e.decryptdata.keyId=a,fa.setKeyIdForUri(e.decryptdata.uri,a))}}const s=this.emeController.loadKey(i);return(e.keyLoadPromise=s.then(o=>(e.mediaKeySessionContext=o,i))).catch(o=>{throw e.keyLoadPromise=null,"data"in o&&(o.data.frag=n),o})}return Promise.resolve(i)}loadKeyHTTP(e,n){const i=this.config,r=i.loader,s=new r(i);return n.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((o,a)=>{const l={keyInfo:e,frag:n,responseType:"arraybuffer",url:e.decryptdata.uri},u=i.keyLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,h,p,m)=>{const{frag:y,keyInfo:g}=p,v=qE(g.decryptdata);if(!y.decryptdata||g!==this.keyIdToKeyInfo[v])return a(this.createKeyLoadError(y,Q.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),m));g.decryptdata.key=y.decryptdata.key=new Uint8Array(f.data),y.keyLoader=null,g.loader=null,o({frag:y,keyInfo:g})},onError:(f,h,p,m)=>{this.resetLoader(h),a(this.createKeyLoadError(n,Q.KEY_LOAD_ERROR,new Error(`HTTP Error ${f.code} loading key ${f.text}`),p,bt({url:l.url,data:void 0},f)))},onTimeout:(f,h,p)=>{this.resetLoader(h),a(this.createKeyLoadError(n,Q.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),p))},onAbort:(f,h,p)=>{this.resetLoader(h),a(this.createKeyLoadError(n,Q.INTERNAL_ABORTED,new Error("key loading aborted"),p))}};s.load(l,c,d)})}resetLoader(e){const{frag:n,keyInfo:i,url:r}=e,s=i.loader;n.keyLoader===s&&(n.keyLoader=null,i.loader=null);const o=qE(i.decryptdata)||r;delete this.keyIdToKeyInfo[o],s&&s.destroy()}}function qE(t){if(t.keyFormat!==In.FAIRPLAY){const e=t.keyId;if(e)return zn(e)}return t.uri}function A6(t){const{type:e}=t;switch(e){case dt.AUDIO_TRACK:return Pe.AUDIO;case dt.SUBTITLE_TRACK:return Pe.SUBTITLE;default:return Pe.MAIN}}function KE(t,e){let n=t.url;return(n===void 0||n.indexOf("data:")===0)&&(n=e.url),n}class nue{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(C.MANIFEST_LOADING,this.onManifestLoading,this),e.on(C.LEVEL_LOADING,this.onLevelLoading,this),e.on(C.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(C.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(C.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(C.MANIFEST_LOADING,this.onManifestLoading,this),e.off(C.LEVEL_LOADING,this.onLevelLoading,this),e.off(C.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(C.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(C.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const n=this.hls.config,i=n.pLoader,r=n.loader,s=i||r,o=new s(n);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const n=this.loaders[e];n&&n.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,n){const{url:i}=n;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:dt.MANIFEST,url:i,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,n){const{id:i,level:r,pathwayId:s,url:o,deliveryDirectives:a,levelInfo:l}=n;this.load({id:i,level:r,pathwayId:s,responseType:"text",type:dt.LEVEL,url:o,deliveryDirectives:a,levelOrTrack:l})}onAudioTrackLoading(e,n){const{id:i,groupId:r,url:s,deliveryDirectives:o,track:a}=n;this.load({id:i,groupId:r,level:null,responseType:"text",type:dt.AUDIO_TRACK,url:s,deliveryDirectives:o,levelOrTrack:a})}onSubtitleTrackLoading(e,n){const{id:i,groupId:r,url:s,deliveryDirectives:o,track:a}=n;this.load({id:i,groupId:r,level:null,responseType:"text",type:dt.SUBTITLE_TRACK,url:s,deliveryDirectives:o,levelOrTrack:a})}onLevelsUpdated(e,n){const i=this.loaders[dt.LEVEL];if(i){const r=i.context;r&&!n.levels.some(s=>s===r.levelOrTrack)&&(i.abort(),delete this.loaders[dt.LEVEL])}}load(e){var n;const i=this.hls.config;let r=this.getInternalLoader(e);if(r){const u=this.hls.logger,c=r.context;if(c&&c.levelOrTrack===e.levelOrTrack&&(c.url===e.url||c.deliveryDirectives&&!e.deliveryDirectives)){c.url===e.url?u.log(`[playlist-loader]: ignore ${e.url} ongoing request`):u.log(`[playlist-loader]: ignore ${e.url} in favor of ${c.url}`);return}u.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),r.abort()}let s;if(e.type===dt.MANIFEST?s=i.manifestLoadPolicy.default:s=xt({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),Ce((n=e.deliveryDirectives)==null?void 0:n.part)){let u;if(e.type===dt.LEVEL&&e.level!==null?u=this.hls.levels[e.level].details:e.type===dt.AUDIO_TRACK&&e.id!==null?u=this.hls.audioTracks[e.id].details:e.type===dt.SUBTITLE_TRACK&&e.id!==null&&(u=this.hls.subtitleTracks[e.id].details),u){const c=u.partTarget,d=u.targetduration;if(c&&d){const f=Math.max(c*3,d*.8)*1e3;s=xt({},s,{maxTimeToFirstByteMs:Math.min(f,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(f,s.maxTimeToFirstByteMs)})}}}const o=s.errorRetry||s.timeoutRetry||{},a={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},l={onSuccess:(u,c,d,f)=>{const h=this.getInternalLoader(d);this.resetInternalLoader(d.type);const p=u.data;c.parsing.start=performance.now(),Pr.isMediaPlaylist(p)||d.type!==dt.MANIFEST?this.handleTrackOrLevelPlaylist(u,c,d,f||null,h):this.handleMasterPlaylist(u,c,d,f)},onError:(u,c,d,f)=>{this.handleNetworkError(c,d,!1,u,f)},onTimeout:(u,c,d)=>{this.handleNetworkError(c,d,!0,void 0,u)}};r.load(e,a,l)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:n},forceStartLoad:i}=this.hls;(e||i)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${n}`),this.hls.startLoad(n))}handleMasterPlaylist(e,n,i,r){const s=this.hls,o=e.data,a=KE(e,i),l=Pr.parseMasterPlaylist(o,a);if(l.playlistParsingError){n.parsing.end=performance.now(),this.handleManifestParsingError(e,i,l.playlistParsingError,r,n);return}const{contentSteering:u,levels:c,sessionData:d,sessionKeys:f,startTimeOffset:h,variableList:p}=l;this.variableList=p,c.forEach(v=>{const{unknownCodecs:b}=v;if(b){const{preferManagedMediaSource:T}=this.hls.config;let{audioCodec:S,videoCodec:_}=v;for(let A=b.length;A--;){const P=b[A];fd(P,"audio",T)?(v.audioCodec=S=S?`${S},${P}`:P,$l.audio[S.substring(0,4)]=2,b.splice(A,1)):fd(P,"video",T)&&(v.videoCodec=_=_?`${_},${P}`:P,$l.video[_.substring(0,4)]=2,b.splice(A,1))}}});const{AUDIO:m=[],SUBTITLES:y,"CLOSED-CAPTIONS":g}=Pr.parseMasterPlaylistMedia(o,a,l);m.length&&!m.some(b=>!b.url)&&c[0].audioCodec&&!c[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),m.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new qt({}),bitrate:0,url:""})),s.trigger(C.MANIFEST_LOADED,{levels:c,audioTracks:m,subtitles:y,captions:g,contentSteering:u,url:a,stats:n,networkDetails:r,sessionData:d,sessionKeys:f,startTimeOffset:h,variableList:p})}handleTrackOrLevelPlaylist(e,n,i,r,s){const o=this.hls,{id:a,level:l,type:u}=i,c=KE(e,i),d=Ce(l)?l:Ce(a)?a:0,f=A6(i),h=Pr.parseLevelPlaylist(e.data,c,d,f,0,this.variableList);if(u===dt.MANIFEST){const p={attrs:new qt({}),bitrate:0,details:h,name:"",url:c};h.requestScheduled=n.loading.start+qO(h,0),o.trigger(C.MANIFEST_LOADED,{levels:[p],audioTracks:[],url:c,stats:n,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}n.parsing.end=performance.now(),i.levelDetails=h,this.handlePlaylistLoaded(h,e,n,i,r,s)}handleManifestParsingError(e,n,i,r,s){this.hls.trigger(C.ERROR,{type:He.NETWORK_ERROR,details:Q.MANIFEST_PARSING_ERROR,fatal:n.type===dt.MANIFEST,url:e.url,err:i,error:i,reason:i.message,response:e,context:n,networkDetails:r,stats:s})}handleNetworkError(e,n,i=!1,r,s){let o=`A network ${i?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${e.type}`;e.type===dt.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===dt.AUDIO_TRACK||e.type===dt.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const a=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let l=Q.UNKNOWN,u=!1;const c=this.getInternalLoader(e);switch(e.type){case dt.MANIFEST:l=i?Q.MANIFEST_LOAD_TIMEOUT:Q.MANIFEST_LOAD_ERROR,u=!0;break;case dt.LEVEL:l=i?Q.LEVEL_LOAD_TIMEOUT:Q.LEVEL_LOAD_ERROR,u=!1;break;case dt.AUDIO_TRACK:l=i?Q.AUDIO_TRACK_LOAD_TIMEOUT:Q.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case dt.SUBTITLE_TRACK:l=i?Q.SUBTITLE_TRACK_LOAD_TIMEOUT:Q.SUBTITLE_LOAD_ERROR,u=!1;break}c&&this.resetInternalLoader(e.type);const d={type:He.NETWORK_ERROR,details:l,fatal:u,url:e.url,loader:c,context:e,error:a,networkDetails:n,stats:s};if(r){const f=(n==null?void 0:n.url)||e.url;d.response=bt({url:f,data:void 0},r)}this.hls.trigger(C.ERROR,d)}handlePlaylistLoaded(e,n,i,r,s,o){const a=this.hls,{type:l,level:u,levelOrTrack:c,id:d,groupId:f,deliveryDirectives:h}=r,p=KE(n,r),m=A6(r);let y=typeof r.level=="number"&&m===Pe.MAIN?u:void 0;const g=e.playlistParsingError;if(g){if(this.hls.logger.warn(`${g} ${e.url}`),!a.config.ignorePlaylistParsingErrors){a.trigger(C.ERROR,{type:He.NETWORK_ERROR,details:Q.LEVEL_PARSING_ERROR,fatal:!1,url:p,error:g,reason:g.message,response:n,context:r,level:y,parent:m,networkDetails:s,stats:i});return}e.playlistParsingError=null}if(!e.fragments.length){const v=e.playlistParsingError=new Error("No Segments found in Playlist");a.trigger(C.ERROR,{type:He.NETWORK_ERROR,details:Q.LEVEL_EMPTY_ERROR,fatal:!1,url:p,error:v,reason:v.message,response:n,context:r,level:y,parent:m,networkDetails:s,stats:i});return}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case dt.MANIFEST:case dt.LEVEL:if(y){if(!c)y=0;else if(c!==a.levels[y]){const v=a.levels.indexOf(c);v>-1&&(y=v)}}a.trigger(C.LEVEL_LOADED,{details:e,levelInfo:c||a.levels[0],level:y||0,id:d||0,stats:i,networkDetails:s,deliveryDirectives:h,withoutMultiVariant:l===dt.MANIFEST});break;case dt.AUDIO_TRACK:a.trigger(C.AUDIO_TRACK_LOADED,{details:e,track:c,id:d||0,groupId:f||"",stats:i,networkDetails:s,deliveryDirectives:h});break;case dt.SUBTITLE_TRACK:a.trigger(C.SUBTITLE_TRACK_LOADED,{details:e,track:c,id:d||0,groupId:f||"",stats:i,networkDetails:s,deliveryDirectives:h});break}}}class Rn{static get version(){return yd}static isMSESupported(){return _6()}static isSupported(){return Qle()}static getMediaSource(){return lo()}static get Events(){return C}static get MetadataSchema(){return Si}static get ErrorTypes(){return He}static get ErrorDetails(){return Q}static get DefaultConfig(){return Rn.defaultConfig?Rn.defaultConfig:Ule}static set DefaultConfig(e){Rn.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new cE,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const n=this.logger=dre(e.debug||!1,"Hls instance",e.assetPlayerId),i=this.config=$le(Rn.DefaultConfig,e,n);this.userConfig=e,i.progressive&&zle(i,n);const{abrController:r,bufferController:s,capLevelController:o,errorController:a,fpsController:l}=i,u=new a(this),c=this.abrController=new r(this),d=new ose(this),f=i.interstitialsController,h=f?this.interstitialsController=new f(this,Rn):null,p=this.bufferController=new s(this,d),m=this.capLevelController=new o(this),y=new l(this),g=new nue(this),v=i.contentSteeringController,b=v?new v(this):null,T=this.levelController=new Xle(this,b),S=new Kle(this),_=new tue(this.config,this.logger),A=this.streamController=new eue(this,d,_),P=this.gapController=new Wle(this,d);m.setStreamController(A),y.setStreamController(A);const O=[g,T,A];h&&O.splice(1,0,h),b&&O.splice(1,0,b),this.networkControllers=O;const x=[c,p,P,m,y,S,d];this.audioTrackController=this.createController(i.audioTrackController,O);const L=i.audioStreamController;L&&O.push(this.audioStreamController=new L(this,d,_)),this.subtitleTrackController=this.createController(i.subtitleTrackController,O);const M=i.subtitleStreamController;M&&O.push(this.subtititleStreamController=new M(this,d,_)),this.createController(i.timelineController,x),_.emeController=this.emeController=this.createController(i.emeController,x),this.cmcdController=this.createController(i.cmcdController,x),this.latencyController=this.createController(Yle,x),this.coreComponents=x,O.push(u);const V=u.onErrorOut;typeof V=="function"&&this.on(C.ERROR,V,u),this.on(C.MANIFEST_LOADED,g.onManifestLoaded,g)}createController(e,n){if(e){const i=new e(this);return n&&n.push(i),i}return null}on(e,n,i=this){this._emitter.on(e,n,i)}once(e,n,i=this){this._emitter.once(e,n,i)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,n,i=this,r){this._emitter.off(e,n,i,r)}listeners(e){return this._emitter.listeners(e)}emit(e,n,i){return this._emitter.emit(e,n,i)}trigger(e,n){if(this.config.debug)return this.emit(e,e,n);try{return this.emit(e,e,n)}catch(i){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+i.message+'". Here is a stacktrace:',i),!this.triggeringException){this.triggeringException=!0;const r=e===C.ERROR;this.trigger(C.ERROR,{type:He.OTHER_ERROR,details:Q.INTERNAL_EXCEPTION,fatal:r,event:e,error:i}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(C.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(n=>n.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(n=>n.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const s=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(C.ERROR,{type:He.OTHER_ERROR,details:Q.ATTACH_MEDIA_ERROR,fatal:!0,error:s});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const n="media"in e,i=n?e.media:e,r=n?e:{media:i};this._media=i,this.trigger(C.MEDIA_ATTACHING,r)}detachMedia(){this.logger.log("detachMedia"),this.trigger(C.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(C.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const n=this.media,i=this._url,r=this._url=Ub.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${r}`),n&&i&&(i!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(n)),this.trigger(C.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,n){this.logger.log(`startLoad(${e+(n?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let i=0;i<this.networkControllers.length&&(this.networkControllers[i].startLoad(e,n),!(!this.started||!this.networkControllers));i++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[Pe.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[Pe.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[Pe.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,n=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),n&&this.startLoad(n))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=Wae()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const n=!!e;n!==this.config.capLevelToPlayerSize&&(n?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=n)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){Gre(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:n}}=this;if(!e)return 0;const i=e.length;for(let r=0;r<i;r++)if(e[r].maxBitrate>=n)return r;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:n,maxHdcpLevel:i}=this;let r;if(n===-1&&e!=null&&e.length?r=e.length-1:r=n,i)for(let s=r;s--;){const o=e[s].attrs["HDCP-LEVEL"];if(o&&o<=i)return s}return r}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var n;return((n=this.audioTrackController)==null?void 0:n.setAudioOption(e))||null}setSubtitleOption(e){var n;return((n=this.subtitleTrackController)==null?void 0:n.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const n=this.audioTrackController;n&&(n.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const n=this.subtitleTrackController;n&&(n.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const n=this.subtitleTrackController;n&&(n.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,n=this.allAudioTracks){const i=aO(n);return nO(e,i,navigator.mediaCapabilities)}}Rn.defaultConfig=void 0;const iue=(t,e="200,",n="full")=>{Array.isArray(t)&&(t=t[0]);const{id:i,service:r}=t;let s;if(!r)return i;if(Array.isArray(t.service)&&t.service.length>0&&(s=r[0]),s){if(s["@id"])return`${s["@id"]}/${n}/${e}/0/default.jpg`;if(s.id)return`${s.id}/${n}/${e}/0/default.jpg`}},C6=xe("img",{objectFit:"cover"}),rue=t=>{const e=Le(null),{contentResource:n,altAsLabel:i,region:r="full"}=t;let s;i&&(s=ui(i));const a=Cr(t,["contentResource","altAsLabel"]),{type:l,id:u,width:c=200,height:d=200,duration:f}=n;me(()=>{if(!u&&!e.current||["Image"].includes(l)||!u.includes("m3u8"))return;const m=new Rn;return e.current&&(m.attachMedia(e.current),m.on(Rn.Events.MEDIA_ATTACHED,function(){m.loadSource(u)})),m.on(Rn.Events.ERROR,function(y,g){if(g.fatal)switch(g.type){case Rn.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${y} network error encountered, try to recover`),m.startLoad();break;case Rn.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${y} media error encountered, try to recover`),m.recoverMediaError();break;default:m.destroy();break}}),()=>{m&&(m.detachMedia(),m.destroy())}},[u,l]);const h=Ge(()=>{if(!e.current)return;let m=0,y=30;if(f&&(y=f),!u.split("#t=")&&f&&(m=f*.1),u.split("#t=").pop()){const v=u.split("#t=").pop();v&&(m=parseInt(v.split(",")[0]))}const g=e.current;g.autoplay=!0,g.currentTime=m,setTimeout(()=>h(),y*1e3)},[f,u]);me(()=>h(),[h]);const p=iue(n,`${c},${d}`,r);switch(l){case"Image":return k(C6,{as:"img",alt:s,css:{width:c,height:d},key:u,src:p,...a});case"Video":return k(C6,{as:"video",css:{width:c,height:d},disablePictureInPicture:!0,key:u,loop:!0,muted:!0,onPause:h,ref:e,src:u});default:return console.warn(`Resource type: ${l} is not valid or not yet supported in Primitives.`),k(Be,null)}},sue=xe("a",{}),oue=t=>{const{children:e,homepage:n}=t,r=Cr(t,["children","homepage"]);return k(Be,null,n&&n.map(s=>{const o=ui(s.label,r.lang);return k(sue,{"aria-label":e?o:void 0,href:s.id,key:s.id,...r},e||o)}))},aue={delimiter:", "},YE=zi(void 0),I6=()=>{const t=ur(YE);if(t===void 0)throw new Error("usePrimitivesContext must be used with a PrimitivesProvider");return t},XE=({children:t,initialState:e=aue})=>{const n=lue(e,"delimiter");return k(YE.Provider,{value:{delimiter:n}},t)},lue=(t,e)=>Object.hasOwn(t,e)?t[e].toString():void 0,uue=xe("span",{}),R6=t=>{const{as:e,markup:n}=t,{delimiter:i}=I6();if(!n)return k(Be,null);const s=Cr(t,["as","markup"]),o=ere(ui(n,s.lang,i));return k(uue,{as:e,...s,dangerouslySetInnerHTML:o})},L6=t=>lt.useContext(YE)?k(R6,{...t}):k(XE,null,k(R6,{...t})),cue=({as:t="dd",lang:e,value:n})=>k(L6,{markup:n,as:t,lang:e}),due=xe("span",{}),fue=({as:t="dd",customValueContent:e,lang:n,value:i})=>{var o;const{delimiter:r}=I6(),s=(o=__(i,n))==null?void 0:o.map(a=>Vr(e,{value:a}));return k(due,{as:t,lang:n},s==null?void 0:s.map((a,l)=>[l>0&&`${r}`,k(Be,{key:l},a)]))},P6=t=>{var a;const{item:e,lang:n,customValueContent:i}=t,{label:r,value:s}=e,o=(a=ui(r))==null?void 0:a.replace(" ","-").toLowerCase();return k("div",{role:"group","data-label":o},k(ps,{as:"dt",label:r,lang:n}),i?k(fue,{as:"dd",customValueContent:i,value:s,lang:n}):k(cue,{as:"dd",value:s,lang:n}))};function hue(t,e){const n=e.filter(i=>{const{matchingLabel:r}=i,s=Object.keys(i.matchingLabel)[0],o=ui(r,s);if(ui(t,s)===o)return!0}).map(i=>i.Content);if(Array.isArray(n))return n[0]}const pue=xe("dl",{}),mue=t=>{const{as:e,customValueContent:n,metadata:i}=t;if(!Array.isArray(i))return k(Be,null);const r=$w(t,"customValueDelimiter"),o=Cr(t,["as","customValueContent","customValueDelimiter","metadata"]);return k(XE,{...typeof r=="string"?{initialState:{delimiter:r}}:void 0},i.length>0&&k(pue,{as:e,...o},i.map((a,l)=>{const u=n?hue(a.label,n):void 0;return k(P6,{customValueContent:u,item:a,key:l,lang:o==null?void 0:o.lang})})))};xe("li",{}),xe("ul",{});const gue=xe("li",{}),yue=xe("ul",{}),vue=t=>{const{as:e,rendering:n}=t,r=Cr(t,["as","rendering"]);return k(yue,{as:e},n&&n.map(s=>{const o=ui(s.label,r.lang);return k(gue,{key:s.id},k("a",{href:s.id,...r,target:"_blank"},o||s.id))}))},bue=xe("dl",{}),Eue=t=>{const{as:e,requiredStatement:n}=t;if(!n)return k(Be,null);const i=$w(t,"customValueDelimiter"),s=Cr(t,["as","customValueDelimiter","requiredStatement"]);return k(XE,{...typeof i=="string"?{initialState:{delimiter:i}}:void 0},k(bue,{as:e,...s},k(P6,{item:n,lang:s.lang})))},Tue=xe("li",{}),Sue=xe("ul",{}),xue=t=>{const{as:e,seeAlso:n}=t,r=Cr(t,["as","seeAlso"]);return k(Sue,{as:e},n&&n.map(s=>{const o=ui(s.label,r.lang);return k(Tue,{key:s.id},k("a",{href:s.id,...r},o||s.id))}))},wue=t=>{const{as:e,summary:n}=t,r=Cr(t,["as","customValueDelimiter","summary"]);return k(L6,{as:e,markup:n,...r})},k6=t=>{const{thumbnail:e,region:n}=t,r=Cr(t,["thumbnail"]);return k(Be,null,e&&e.map(s=>k(rue,{contentResource:s,key:s.id,region:n,...r})))},_ue=({annotationPage:t})=>{var l,u,c,d,f,h;const e=Nt(),{vault:n}=e;if(!t||!t.items||((l=t.items)==null?void 0:l.length)===0)return k(Be,null);const i=t.items.map(p=>n.get(p.id));if(!i)return k(Be,null);const r=i.reduce((p,m)=>(p.canvas=m.target.source.id,p.annotations=[],p.annotations.push(m==null?void 0:m.id),p),{}),s=n.get(r.canvas),o=Xs(n,s.id),a=(u=o==null?void 0:o[0])!=null&&u.service?((d=(c=o==null?void 0:o[0])==null?void 0:c.service[0])==null?void 0:d.id)||((h=(f=o==null?void 0:o[0])==null?void 0:f.service[0])==null?void 0:h["@id"]):void 0;return k(v1,{"data-testid":"annotation-page"},s&&k("header",null,k(ps,{label:s.label})),k("div",{"data-testid":"annotation-page-items"},i==null?void 0:i.map(p=>k(Wv,{annotation:p,targetResource:a,key:p.id}))))};function bs(){return bs=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)({}).hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},bs.apply(null,arguments)}function wd(t,e,{checkForDefaultPrevented:n=!0}={}){return function(r){if(t==null||t(r),n===!1||!r.defaultPrevented)return e==null?void 0:e(r)}}function Aue(t,e){typeof t=="function"?t(e):t!=null&&(t.current=e)}function D6(...t){return e=>t.forEach(n=>Aue(n,e))}function O6(...t){return Ge(D6(...t),t)}function Cue(t,e=[]){let n=[];function i(s,o){const a=zi(o),l=n.length;n=[...n,o];function u(d){const{scope:f,children:h,...p}=d,m=(f==null?void 0:f[t][l])||a,y=en(()=>p,Object.values(p));return k(m.Provider,{value:y},h)}function c(d,f){const h=(f==null?void 0:f[t][l])||a,p=ur(h);if(p)return p;if(o!==void 0)return o;throw new Error(`\`${d}\` must be used within \`${s}\``)}return u.displayName=s+"Provider",[u,c]}const r=()=>{const s=n.map(o=>zi(o));return function(a){const l=(a==null?void 0:a[t])||s;return en(()=>({[`__scope${t}`]:{...a,[t]:l}}),[a,l])}};return r.scopeName=t,[i,Iue(r,...e)]}function Iue(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const i=t.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(s){const o=i.reduce((a,{useScope:l,scopeName:u})=>{const d=l(s)[`__scope${u}`];return{...a,...d}},{});return en(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return n.scopeName=e.scopeName,n}const Rue=globalThis!=null&&globalThis.document?Ii:()=>{},Lue=Nd.useId||(()=>{});let Pue=0;function kue(t){const[e,n]=Se(Lue());return Rue(()=>{n(i=>i??String(Pue++))},[t]),e?`radix-${e}`:""}const N6=Re((t,e)=>{const{children:n,...i}=t,r=Gn.toArray(n),s=r.find(Oue);if(s){const o=s.props.children,a=r.map(l=>l===s?Gn.count(o)>1?Gn.only(null):li(o)?o.props.children:null:l);return k(QE,bs({},i,{ref:e}),li(o)?Vr(o,void 0,a):null)}return k(QE,bs({},i,{ref:e}),n)});N6.displayName="Slot";const QE=Re((t,e)=>{const{children:n,...i}=t;return li(n)?Vr(n,{...Nue(i,n.props),ref:e?D6(e,n.ref):n.ref}):Gn.count(n)>1?Gn.only(null):null});QE.displayName="SlotClone";const Due=({children:t})=>k(Be,null,t);function Oue(t){return li(t)&&t.type===Due}function Nue(t,e){const n={...e};for(const i in e){const r=t[i],s=e[i];/^on[A-Z]/.test(i)?r&&s?n[i]=(...a)=>{s(...a),r(...a)}:r&&(n[i]=r):i==="style"?n[i]={...r,...s}:i==="className"&&(n[i]=[r,s].filter(Boolean).join(" "))}return{...t,...n}}const g0=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"].reduce((t,e)=>{const n=Re((i,r)=>{const{asChild:s,...o}=i,a=s?N6:e;return me(()=>{window[Symbol.for("radix-ui")]=!0},[]),k(a,bs({},o,{ref:r}))});return n.displayName=`Primitive.${e}`,{...t,[e]:n}},{}),[ZE]=Cue("Form"),M6="Form",[Mue,F6]=ZE(M6),[Fue,Bue]=ZE(M6),Uue=Re((t,e)=>{const{__scopeForm:n,onClearServerErrors:i=()=>{},...r}=t,s=Le(null),o=O6(e,s),[a,l]=Se({}),u=Ge(x=>a[x],[a]),c=Ge((x,L)=>l(M=>{var V;return{...M,[x]:{...(V=M[x])!==null&&V!==void 0?V:{},...L}}}),[]),d=Ge(x=>{l(L=>({...L,[x]:void 0})),v(L=>({...L,[x]:{}}))},[]),[f,h]=Se({}),p=Ge(x=>{var L;return(L=f[x])!==null&&L!==void 0?L:[]},[f]),m=Ge((x,L)=>{h(M=>{var V;return{...M,[x]:[...(V=M[x])!==null&&V!==void 0?V:[],L]}})},[]),y=Ge((x,L)=>{h(M=>{var V;return{...M,[x]:((V=M[x])!==null&&V!==void 0?V:[]).filter(K=>K.id!==L)}})},[]),[g,v]=Se({}),b=Ge(x=>{var L;return(L=g[x])!==null&&L!==void 0?L:{}},[g]),T=Ge((x,L)=>{v(M=>{var V;return{...M,[x]:{...(V=M[x])!==null&&V!==void 0?V:{},...L}}})},[]),[S,_]=Se({}),A=Ge((x,L)=>{_(M=>{const V=new Set(M[x]).add(L);return{...M,[x]:V}})},[]),P=Ge((x,L)=>{_(M=>{const V=new Set(M[x]);return V.delete(L),{...M,[x]:V}})},[]),O=Ge(x=>{var L;return Array.from((L=S[x])!==null&&L!==void 0?L:[]).join(" ")||void 0},[S]);return k(Mue,{scope:n,getFieldValidity:u,onFieldValidityChange:c,getFieldCustomMatcherEntries:p,onFieldCustomMatcherEntryAdd:m,onFieldCustomMatcherEntryRemove:y,getFieldCustomErrors:b,onFieldCustomErrorsChange:T,onFieldValiditionClear:d},k(Fue,{scope:n,onFieldMessageIdAdd:A,onFieldMessageIdRemove:P,getFieldDescription:O},k(g0.form,bs({},r,{ref:o,onInvalid:wd(t.onInvalid,x=>{const L=H6(x.currentTarget);L===x.target&&L.focus(),x.preventDefault()}),onSubmit:wd(t.onSubmit,i,{checkForDefaultPrevented:!1}),onReset:wd(t.onReset,i)}))))}),B6="FormField",[Hue,$ue]=ZE(B6),zue=Re((t,e)=>{const{__scopeForm:n,name:i,serverInvalid:r=!1,...s}=t,a=F6(B6,n).getFieldValidity(i),l=kue();return k(Hue,{scope:n,id:l,name:i,serverInvalid:r},k(g0.div,bs({"data-valid":$6(a,r),"data-invalid":z6(a,r)},s,{ref:e})))}),JE="FormControl",Vue=Re((t,e)=>{const{__scopeForm:n,...i}=t,r=F6(JE,n),s=$ue(JE,n),o=Bue(JE,n),a=Le(null),l=O6(e,a),u=i.name||s.name,c=i.id||s.id,d=r.getFieldCustomMatcherEntries(u),{onFieldValidityChange:f,onFieldCustomErrorsChange:h,onFieldValiditionClear:p}=r,m=Ge(async v=>{if(Que(v.validity)){const M=eT(v.validity);f(u,M);return}const b=v.form?new FormData(v.form):new FormData,T=[v.value,b],S=[],_=[];d.forEach(M=>{Kue(M,T)?_.push(M):Yue(M)&&S.push(M)});const A=S.map(({id:M,match:V})=>[M,V(...T)]),P=Object.fromEntries(A),O=Object.values(P).some(Boolean),x=O;v.setCustomValidity(x?U6:"");const L=eT(v.validity);if(f(u,L),h(u,P),!O&&_.length>0){const M=_.map(({id:H,match:Y})=>Y(...T).then(D=>[H,D])),V=await Promise.all(M),K=Object.fromEntries(V),j=Object.values(K).some(Boolean);v.setCustomValidity(j?U6:"");const G=eT(v.validity);f(u,G),h(u,K)}},[d,u,h,f]);me(()=>{const v=a.current;if(v){const b=()=>m(v);return v.addEventListener("change",b),()=>v.removeEventListener("change",b)}},[m]);const y=Ge(()=>{const v=a.current;v&&(v.setCustomValidity(""),p(u))},[u,p]);me(()=>{var v;const b=(v=a.current)===null||v===void 0?void 0:v.form;if(b)return b.addEventListener("reset",y),()=>b.removeEventListener("reset",y)},[y]),me(()=>{const v=a.current,b=v==null?void 0:v.closest("form");if(b&&s.serverInvalid){const T=H6(b);T===v&&T.focus()}},[s.serverInvalid]);const g=r.getFieldValidity(u);return k(g0.input,bs({"data-valid":$6(g,s.serverInvalid),"data-invalid":z6(g,s.serverInvalid),"aria-invalid":s.serverInvalid?!0:void 0,"aria-describedby":o.getFieldDescription(u),title:""},i,{ref:l,id:c,name:u,onInvalid:wd(t.onInvalid,v=>{const b=v.currentTarget;m(b)}),onChange:wd(t.onChange,v=>{y()})}))}),U6="This value is not valid",Gue=Re((t,e)=>{const{__scopeForm:n,...i}=t;return k(g0.button,bs({type:"submit"},i,{ref:e}))});function eT(t){const e={};for(const n in t)e[n]=t[n];return e}function jue(t){return t instanceof HTMLElement}function Wue(t){return"validity"in t}function que(t){return Wue(t)&&(t.validity.valid===!1||t.getAttribute("aria-invalid")==="true")}function H6(t){const e=t.elements,[n]=Array.from(e).filter(jue).filter(que);return n}function Kue(t,e){return t.match.constructor.name==="AsyncFunction"||Xue(t.match,e)}function Yue(t){return t.match.constructor.name==="Function"}function Xue(t,e){return t(...e)instanceof Promise}function Que(t){let e=!1;for(const n in t){const i=n;if(i!=="valid"&&i!=="customError"&&t[i]){e=!0;break}}return e}function $6(t,e){if((t==null?void 0:t.valid)===!0&&!e)return!0}function z6(t,e){if((t==null?void 0:t.valid)===!1||e)return!0}const Zue=Uue,Jue=zue,ece=Vue,tce=Gue,nce=xe("div",{form:{display:"flex",alignItems:"center",width:"100%",height:"100%",gap:"1rem",padding:"0 1.618rem 1.618rem",".content-search-input":{flexGrow:"1",input:{width:"100%",border:"none",backgroundColor:"$secondaryMuted",color:"$primary",marginRight:"1rem",height:"2rem",padding:"0 1rem",borderRadius:"1rem",fontFamily:"inherit",fontSize:"1rem",lineHeight:"1rem",boxShadow:"inset 1px 1px 2px #0001","&::placeholder":{color:"#0006"}}}}}),ice=xe("button",{display:"flex",background:"none",border:"none",width:"2rem",height:"2rem",padding:"0",margin:"0",fontWeight:"700",borderRadius:"2rem",backgroundColor:"$accent",color:"$secondary",cursor:"pointer",boxSizing:"content-box",transition:"$all",svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",opacity:"1",filter:"drop-shadow(5px 5px 5px #000D)",boxSizing:"inherit",transition:"$all"},"&:disabled":{backgroundColor:"transparent",boxShadow:"none",svg:{opacity:"0.25"}}}),rce=({searchServiceUrl:t,setContentSearchResource:e,setLoading:n})=>{const{t:i}=fr(),[r,s]=Se(),o=Nt(),{openSeadragonViewer:a,vault:l}=o;async function u(f){if(f.preventDefault(),!!a&&t){if(!r||r.trim()===""){e({});return}n(!0),HC(l,t,{q:r}).then(h=>{e(h),n(!1)})}}const c=f=>{f.preventDefault(),s(f.target.value)},d=i("contentSearchPlaceholder");return k(nce,null,k(Zue,{onSubmit:u,className:"content-search-form"},k(Jue,{className:"content-search-input",name:"searchTerms",onChange:c},k(ece,{placeholder:d})),k(tce,{asChild:!0},k(ice,{type:"submit"},k("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},k("title",null,i("informationPanelTabsSearch")),k("path",{d:"M456.69 421.39L362.6 327.3a173.81 173.81 0 0034.84-104.58C397.44 126.38 319.06 48 222.72 48S48 126.38 48 222.72s78.38 174.72 174.72 174.72A173.81 173.81 0 00327.3 362.6l94.09 94.09a25 25 0 0035.3-35.3zM97.92 222.72a124.8 124.8 0 11124.8 124.8 124.95 124.95 0 01-124.8-124.8z"}))))))},sce=({searchServiceUrl:t,setContentSearchResource:e,activeCanvas:n,annotationPage:i})=>{const r=Nt(),{vault:s}=r,{t:o}=fr(),[a,l]=Se(!1),[u,c]=Se({});me(()=>{var p;if(!(i!=null&&i.items))return;const h=((p=i==null?void 0:i.items)==null?void 0:p.map(m=>s.get(m.id))).reduce((m,y)=>{const g=y.target.source.id;return m[g]||(m[g]=[]),m[g].push(y.id),m},{});c(h)},[i]);let d;return k(Be,null,k(rce,{searchServiceUrl:t,setContentSearchResource:e,activeCanvas:n,setLoading:l}),a?k("span",null,o("contentSearchLoading")):u&&Object.keys(u).length>0&&Object.keys(u).map(f=>(d=s.get(f),k(v1,{key:f,"data-testid":"annotation-page"},d&&k("header",null,k(ps,{label:d.label})),u[f].map(h=>{var g,v,b,T,S;const p=s.get(h),m=Xs(s,d.id),y=(g=m==null?void 0:m[0])!=null&&g.service?((b=(v=m==null?void 0:m[0])==null?void 0:v.service[0])==null?void 0:b.id)||((S=(T=m==null?void 0:m[0])==null?void 0:T.service[0])==null?void 0:S["@id"]):void 0;return k(Wv,{annotation:p,targetResource:y,key:p.id,isContentSearch:!0})})))))},oce=xe("div",{width:"100%",padding:" 0 1.618rem 2rem",display:"flex",flexDirection:"column",overflow:"auto",position:"absolute",fontWeight:"400",fontSize:"1rem",zIndex:"0",img:{maxWidth:"100px",maxHeight:"100px",objectFit:"contain",color:"transparent",margin:"0 0 1rem",borderRadius:"3px",backgroundColor:"$secondaryMuted"},video:{display:"none"},"a, a:visited":{color:"$accent"},p:{fontSize:"1rem",lineHeight:"1.47em",margin:"0"},dl:{margin:"0",dt:{fontWeight:"700",margin:"1rem 0 0.25rem"},dd:{margin:"0"}},".manifest-property-title":{fontWeight:"700",margin:"1rem 0 0.25rem"},"ul, ol":{padding:"0",margin:"0",li:{fontSize:"1rem",lineHeight:"1.45em",listStyle:"none",margin:"0.25rem 0 0.25rem"}}}),ace=xe("div",{position:"relative",width:"100%",height:"100%",zIndex:"0"}),lce=({homepage:t})=>(t==null?void 0:t.length)===0?k(Be,null):k(Be,null,k("span",{className:"manifest-property-title"},"Homepage"),k(oue,{homepage:t})),uce=({id:t,htmlLabel:e,parent:n="manifest"})=>k(Be,null,k("span",{className:"manifest-property-title"},e),k("a",{href:t,target:"_blank",id:`iiif-${n}-id`},t)),cce=({metadata:t,parent:e="manifest"})=>t?k(Be,null,k(mue,{metadata:t,id:`iiif-${e}-metadata`})):k(Be,null),dce=({rendering:t})=>(t==null?void 0:t.length)===0?k(Be,null):k(Be,null,k("span",{className:"manifest-property-title"},"Alternate formats"),k(vue,{rendering:t})),fce=({requiredStatement:t,parent:e="manifest"})=>t?k(Be,null,k(Eue,{requiredStatement:t,id:`iiif-${e}-required-statement`})):k(Be,null),hce=({rights:t})=>t?k(Be,null,k("span",{className:"manifest-property-title"},"Rights"),k("a",{href:t,target:"_blank"},t)):k(Be,null),pce=({seeAlso:t})=>(t==null?void 0:t.length)===0?k(Be,null):k(Be,null,k("span",{className:"manifest-property-title"},"See Also"),k(xue,{seeAlso:t})),mce=({summary:t,parent:e="manifest"})=>t?k(Be,null,k(wue,{summary:t,as:"p",id:`iiif-${e}-summary`})):k(Be,null),gce=({label:t,thumbnail:e})=>(e==null?void 0:e.length)===0?k(Be,null):k(Be,null,k(k6,{altAsLabel:t||{none:["resource"]},thumbnail:e,style:{backgroundColor:"#6663",objectFit:"cover"}})),yce=()=>{const t=Nt(),{activeManifest:e,vault:n}=t,[i,r]=Se(),[s,o]=Se([]),[a,l]=Se([]),[u,c]=Se([]),[d,f]=Se([]);return me(()=>{var p,m,y,g;const h=n.get(e);h&&(r(h),((p=h.homepage)==null?void 0:p.length)>0&&o(n.get(h.homepage)),((m=h.seeAlso)==null?void 0:m.length)>0&&l(n.get(h.seeAlso)),((y=h.rendering)==null?void 0:y.length)>0&&c(n.get(h.rendering)),((g=h.thumbnail)==null?void 0:g.length)>0&&f(n.get(h.thumbnail)))},[e,n]),i?k(ace,null,k(oce,null,k(gce,{thumbnail:d,label:i.label}),k(mce,{summary:i.summary}),k(cce,{metadata:i.metadata}),k(fce,{requiredStatement:i.requiredStatement}),k(hce,{rights:i.rights}),k(lce,{homepage:s}),k(pce,{seeAlso:a}),k(dce,{rendering:u}),k(uce,{id:i.id,htmlLabel:"IIIF Manifest"}))):k(Be,null)};function vce(t){const e=[];return t.forEach(n=>{var i;(i=n.informationPanel)!=null&&i.component&&e.push(n)}),{pluginsWithInfoPanel:e}}const bce=({contentStateAnnotation:t})=>{var a,l,u,c,d,f;const e=Nt(),{vault:n}=e;if(!t)return k(Be,null);const i=((a=t==null?void 0:t.target)==null?void 0:a.source)||(t==null?void 0:t.target),r=n.get(i==null?void 0:i.id),s=Xs(n,r.id),o=(l=s==null?void 0:s[0])!=null&&l.service?((c=(u=s==null?void 0:s[0])==null?void 0:u.service[0])==null?void 0:c.id)||((f=(d=s==null?void 0:s[0])==null?void 0:d.service[0])==null?void 0:f["@id"]):void 0;return k(v1,{"data-testid":"annotation-page"},r&&k("header",null,k(ps,{label:r.label})," ",k("em",null,"(Shared)")),k("div",{"data-testid":"annotation-page-items"},k(Wv,{annotation:t,targetResource:o,key:t.id,isContentState:!0})))},Ece=1500,Tce=({activeCanvas:t,annotationResources:e,searchServiceUrl:n,setContentSearchResource:i,contentSearchResource:r})=>{var U,j;const{t:s}=fr(),o=jn(),a=Nt(),{contentStateAnnotation:l,informationPanelResource:u,isAutoScrolling:c,isUserScrolling:d,vault:f,configOptions:h,plugins:p}=a,{informationPanel:m}=h,y=m==null?void 0:m.renderAbout,g=m==null?void 0:m.renderAnnotation,v=f.get({id:t,type:"Canvas"}),b=m==null?void 0:m.renderContentSearch,T=m==null?void 0:m.renderToggle,S=(U=h==null?void 0:h.annotations)==null?void 0:U.motivations,_=((j=l==null?void 0:l.target)==null?void 0:j.source)||(l==null?void 0:l.target),A=!!l&&_.id===t,P=en(()=>e?S?e.map(G=>{var Y;if(!((Y=G==null?void 0:G.items)!=null&&Y.length))return null;const H=G.items.filter(D=>{const ee=f.get(D.id);return V8(ee,S)});return H.length?{...G,items:H}:null}).filter(Boolean):e:[],[e,S,f]),O=!!(P!=null&&P.length)||A,{pluginsWithInfoPanel:x}=vce(p);function L(G,H){var D,ee;const Y=(D=G==null?void 0:G.informationPanel)==null?void 0:D.component;return Y===void 0?k(Be,null):k(mh,{key:H,value:G.id},k($m,{FallbackComponent:Wm},k(Y,{...(ee=G==null?void 0:G.informationPanel)==null?void 0:ee.componentProps,canvas:v,useViewerDispatch:jn,useViewerState:Nt})))}const M=()=>{o({type:"updateInformationOpen",isInformationOpen:!1})};me(()=>{["manifest-about","manifest-annotations","manifest-content-search"].includes(String(m==null?void 0:m.defaultTab))?o({type:"updateInformationPanelResource",informationPanelResource:m==null?void 0:m.defaultTab}):o(A?{type:"updateInformationPanelResource",informationPanelResource:"manifest-annotations"}:{type:"updateInformationPanelResource",informationPanelResource:"manifest-about"})},[]),me(()=>{O||o({type:"updateInformationPanelResource",informationPanelResource:"manifest-about"})},[O]);function V(){if(!c){clearTimeout(d);const G=setTimeout(()=>{o({type:"updateUserScrolling",isUserScrolling:void 0})},Ece);o({type:"updateUserScrolling",isUserScrolling:G})}}return k(K$,{"data-testid":"information-panel",defaultValue:u,onValueChange:G=>{o({type:"updateInformationPanelResource",informationPanelResource:G})},orientation:"horizontal",value:u,className:"clover-viewer-information-panel"},k(Y$,{"aria-label":s("informationPanelTabs"),"data-testid":"information-panel-list"},T&&k(Tc,{value:"manifest-back","data-value":"manifest-back",onClick:M,as:"button"},s("informationPanelTabsClose")),y&&k(Tc,{value:"manifest-about"},s("informationPanelTabsAbout")),b&&r&&k(Tc,{value:"manifest-content-search"},s("informationPanelTabsSearch")),g&&O&&k(Tc,{value:"manifest-annotations"},(m==null?void 0:m.annotationTabLabel)||s("informationPanelTabsAnnotations")),x&&x.map((G,H)=>{var Y;return k(Tc,{key:H,value:G.id},k(ps,{label:(Y=G.informationPanel)==null?void 0:Y.label}))})),k(X$,{handleScroll:V},y&&k(mh,{value:"manifest-about"},k(yce,null)),b&&r&&k(mh,{value:"manifest-content-search"},k(sce,{searchServiceUrl:n,setContentSearchResource:i,activeCanvas:t,annotationPage:r})),g&&O&&P&&k(mh,{value:"manifest-annotations"},l&&A&&k(bce,{contentStateAnnotation:l}),P.map(G=>k(_ue,{key:G.id,annotationPage:G}))),x&&x.map((G,H)=>L(G,H))))},Sce=()=>k("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M256 112v288M400 256H112"}),xce=()=>k(Be,null,k("path",{d:"M232 416a23.88 23.88 0 01-14.2-4.68 8.27 8.27 0 01-.66-.51L125.76 336H56a24 24 0 01-24-24V200a24 24 0 0124-24h69.75l91.37-74.81a8.27 8.27 0 01.66-.51A24 24 0 01256 120v272a24 24 0 01-24 24zm-106.18-80zm-.27-159.86zM320 336a16 16 0 01-14.29-23.19c9.49-18.87 14.3-38 14.3-56.81 0-19.38-4.66-37.94-14.25-56.73a16 16 0 0128.5-14.54C346.19 208.12 352 231.44 352 256c0 23.86-6 47.81-17.7 71.19A16 16 0 01320 336z"}),k("path",{d:"M368 384a16 16 0 01-13.86-24C373.05 327.09 384 299.51 384 256c0-44.17-10.93-71.56-29.82-103.94a16 16 0 0127.64-16.12C402.92 172.11 416 204.81 416 256c0 50.43-13.06 83.29-34.13 120a16 16 0 01-13.87 8z"}),k("path",{d:"M416 432a16 16 0 01-13.39-24.74C429.85 365.47 448 323.76 448 256c0-66.5-18.18-108.62-45.49-151.39a16 16 0 1127-17.22C459.81 134.89 480 181.74 480 256c0 64.75-14.66 113.63-50.6 168.74A16 16 0 01416 432z"})),wce=()=>k("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"}),_ce=()=>k(Be,null,k("path",{d:"M336 176h40a40 40 0 0140 40v208a40 40 0 01-40 40H136a40 40 0 01-40-40V216a40 40 0 0140-40h40",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32"}),k("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M176 272l80 80 80-80M256 48v288"})),Ace=()=>k("path",{d:"M416 64H96a64.07 64.07 0 00-64 64v256a64.07 64.07 0 0064 64h320a64.07 64.07 0 0064-64V128a64.07 64.07 0 00-64-64zm-80 64a48 48 0 11-48 48 48.05 48.05 0 0148-48zM96 416a32 32 0 01-32-32v-67.63l94.84-84.3a48.06 48.06 0 0165.8 1.9l64.95 64.81L172.37 416zm352-32a32 32 0 01-32 32H217.63l121.42-121.42a47.72 47.72 0 0161.64-.16L448 333.84z"}),Cce=()=>k("path",{d:"M464 384.39a32 32 0 01-13-2.77 15.77 15.77 0 01-2.71-1.54l-82.71-58.22A32 32 0 01352 295.7v-79.4a32 32 0 0113.58-26.16l82.71-58.22a15.77 15.77 0 012.71-1.54 32 32 0 0145 29.24v192.76a32 32 0 01-32 32zM268 400H84a68.07 68.07 0 01-68-68V180a68.07 68.07 0 0168-68h184.48A67.6 67.6 0 01336 179.52V332a68.07 68.07 0 01-68 68z"}),V6=xe("svg",{display:"inline-flex",variants:{isLarge:{true:{height:"4rem",width:"4rem"}},isMedium:{true:{height:"2rem",width:"2rem"}},isSmall:{true:{height:"1rem",width:"1rem"}}}}),Ice=({children:t})=>k("title",null,t),Nn=t=>k(V6,{...t,"data-testid":"icon-svg",role:"img",viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg"},t.children);Nn.Title=Ice,Nn.Add=Sce,Nn.Audio=xce,Nn.Close=wce,Nn.Download=_ce,Nn.Image=Ace,Nn.Video=Cce;function Rce(t,e=globalThis==null?void 0:globalThis.document){const n=Qs(t);me(()=>{const i=r=>{r.key==="Escape"&&n(r)};return e.addEventListener("keydown",i,{capture:!0}),()=>e.removeEventListener("keydown",i,{capture:!0})},[n,e])}var Lce="DismissableLayer",tT="dismissableLayer.update",Pce="dismissableLayer.pointerDownOutside",kce="dismissableLayer.focusOutside",G6,j6=zi({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),nT=Re((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:i,onPointerDownOutside:r,onFocusOutside:s,onInteractOutside:o,onDismiss:a,...l}=t,u=ur(j6),[c,d]=Se(null),f=(c==null?void 0:c.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,h]=Se({}),p=At(e,A=>d(A)),m=Array.from(u.layers),[y]=[...u.layersWithOutsidePointerEventsDisabled].slice(-1),g=m.indexOf(y),v=c?m.indexOf(c):-1,b=u.layersWithOutsidePointerEventsDisabled.size>0,T=v>=g,S=Nce(A=>{const P=A.target,O=[...u.branches].some(x=>x.contains(P));!T||O||(r==null||r(A),o==null||o(A),A.defaultPrevented||a==null||a())},f),_=Mce(A=>{const P=A.target;[...u.branches].some(x=>x.contains(P))||(s==null||s(A),o==null||o(A),A.defaultPrevented||a==null||a())},f);return Rce(A=>{v===u.layers.size-1&&(i==null||i(A),!A.defaultPrevented&&a&&(A.preventDefault(),a()))},f),me(()=>{if(c)return n&&(u.layersWithOutsidePointerEventsDisabled.size===0&&(G6=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),u.layersWithOutsidePointerEventsDisabled.add(c)),u.layers.add(c),W6(),()=>{n&&u.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=G6)}},[c,f,n,u]),me(()=>()=>{c&&(u.layers.delete(c),u.layersWithOutsidePointerEventsDisabled.delete(c),W6())},[c,u]),me(()=>{const A=()=>h({});return document.addEventListener(tT,A),()=>document.removeEventListener(tT,A)},[]),ue(ut.div,{...l,ref:p,style:{pointerEvents:b?T?"auto":"none":void 0,...t.style},onFocusCapture:st(t.onFocusCapture,_.onFocusCapture),onBlurCapture:st(t.onBlurCapture,_.onBlurCapture),onPointerDownCapture:st(t.onPointerDownCapture,S.onPointerDownCapture)})});nT.displayName=Lce;var Dce="DismissableLayerBranch",Oce=Re((t,e)=>{const n=ur(j6),i=Le(null),r=At(e,i);return me(()=>{const s=i.current;if(s)return n.branches.add(s),()=>{n.branches.delete(s)}},[n.branches]),ue(ut.div,{...t,ref:r})});Oce.displayName=Dce;function Nce(t,e=globalThis==null?void 0:globalThis.document){const n=Qs(t),i=Le(!1),r=Le(()=>{});return me(()=>{const s=a=>{if(a.target&&!i.current){let l=function(){q6(Pce,n,u,{discrete:!0})};const u={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",r.current),r.current=l,e.addEventListener("click",r.current,{once:!0})):l()}else e.removeEventListener("click",r.current);i.current=!1},o=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(o),e.removeEventListener("pointerdown",s),e.removeEventListener("click",r.current)}},[e,n]),{onPointerDownCapture:()=>i.current=!0}}function Mce(t,e=globalThis==null?void 0:globalThis.document){const n=Qs(t),i=Le(!1);return me(()=>{const r=s=>{s.target&&!i.current&&q6(kce,n,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",r),()=>e.removeEventListener("focusin",r)},[e,n]),{onFocusCapture:()=>i.current=!0,onBlurCapture:()=>i.current=!1}}function W6(){const t=new CustomEvent(tT);document.dispatchEvent(t)}function q6(t,e,n,{discrete:i}){const r=n.originalEvent.target,s=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&r.addEventListener(t,e,{once:!0}),i?m$(r,s):r.dispatchEvent(s)}var iT=0;function K6(){me(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??Y6()),document.body.insertAdjacentElement("beforeend",t[1]??Y6()),iT++,()=>{iT===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),iT--}},[])}function Y6(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var rT="focusScope.autoFocusOnMount",sT="focusScope.autoFocusOnUnmount",X6={bubbles:!1,cancelable:!0},Fce="FocusScope",oT=Re((t,e)=>{const{loop:n=!1,trapped:i=!1,onMountAutoFocus:r,onUnmountAutoFocus:s,...o}=t,[a,l]=Se(null),u=Qs(r),c=Qs(s),d=Le(null),f=At(e,m=>l(m)),h=Le({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;me(()=>{if(i){let m=function(b){if(h.paused||!a)return;const T=b.target;a.contains(T)?d.current=T:po(d.current,{select:!0})},y=function(b){if(h.paused||!a)return;const T=b.relatedTarget;T!==null&&(a.contains(T)||po(d.current,{select:!0}))},g=function(b){if(document.activeElement===document.body)for(const S of b)S.removedNodes.length>0&&po(a)};document.addEventListener("focusin",m),document.addEventListener("focusout",y);const v=new MutationObserver(g);return a&&v.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",m),document.removeEventListener("focusout",y),v.disconnect()}}},[i,a,h.paused]),me(()=>{if(a){J6.add(h);const m=document.activeElement;if(!a.contains(m)){const g=new CustomEvent(rT,X6);a.addEventListener(rT,u),a.dispatchEvent(g),g.defaultPrevented||(Bce(Vce(Q6(a)),{select:!0}),document.activeElement===m&&po(a))}return()=>{a.removeEventListener(rT,u),setTimeout(()=>{const g=new CustomEvent(sT,X6);a.addEventListener(sT,c),a.dispatchEvent(g),g.defaultPrevented||po(m??document.body,{select:!0}),a.removeEventListener(sT,c),J6.remove(h)},0)}}},[a,u,c,h]);const p=Ge(m=>{if(!n&&!i||h.paused)return;const y=m.key==="Tab"&&!m.altKey&&!m.ctrlKey&&!m.metaKey,g=document.activeElement;if(y&&g){const v=m.currentTarget,[b,T]=Uce(v);b&&T?!m.shiftKey&&g===T?(m.preventDefault(),n&&po(b,{select:!0})):m.shiftKey&&g===b&&(m.preventDefault(),n&&po(T,{select:!0})):g===v&&m.preventDefault()}},[n,i,h.paused]);return ue(ut.div,{tabIndex:-1,...o,ref:f,onKeyDown:p})});oT.displayName=Fce;function Bce(t,{select:e=!1}={}){const n=document.activeElement;for(const i of t)if(po(i,{select:e}),document.activeElement!==n)return}function Uce(t){const e=Q6(t),n=Z6(e,t),i=Z6(e.reverse(),t);return[n,i]}function Q6(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:i=>{const r=i.tagName==="INPUT"&&i.type==="hidden";return i.disabled||i.hidden||r?NodeFilter.FILTER_SKIP:i.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function Z6(t,e){for(const n of t)if(!Hce(n,{upTo:e}))return n}function Hce(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function $ce(t){return t instanceof HTMLInputElement&&"select"in t}function po(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&$ce(t)&&e&&t.select()}}var J6=zce();function zce(){let t=[];return{add(e){const n=t[0];e!==n&&(n==null||n.pause()),t=e4(t,e),t.unshift(e)},remove(e){var n;t=e4(t,e),(n=t[0])==null||n.resume()}}}function e4(t,e){const n=[...t],i=n.indexOf(e);return i!==-1&&n.splice(i,1),n}function Vce(t){return t.filter(e=>e.tagName!=="A")}const Gce=["top","right","bottom","left"],mo=Math.min,_i=Math.max,y0=Math.round,v0=Math.floor,Mr=t=>({x:t,y:t}),jce={left:"right",right:"left",bottom:"top",top:"bottom"},Wce={start:"end",end:"start"};function aT(t,e,n){return _i(t,mo(e,n))}function Es(t,e){return typeof t=="function"?t(e):t}function Ts(t){return t.split("-")[0]}function Zl(t){return t.split("-")[1]}function lT(t){return t==="x"?"y":"x"}function uT(t){return t==="y"?"height":"width"}const qce=new Set(["top","bottom"]);function Fr(t){return qce.has(Ts(t))?"y":"x"}function cT(t){return lT(Fr(t))}function Kce(t,e,n){n===void 0&&(n=!1);const i=Zl(t),r=cT(t),s=uT(r);let o=r==="x"?i===(n?"end":"start")?"right":"left":i==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(o=b0(o)),[o,b0(o)]}function Yce(t){const e=b0(t);return[dT(t),e,dT(e)]}function dT(t){return t.replace(/start|end/g,e=>Wce[e])}const t4=["left","right"],n4=["right","left"],Xce=["top","bottom"],Qce=["bottom","top"];function Zce(t,e,n){switch(t){case"top":case"bottom":return n?e?n4:t4:e?t4:n4;case"left":case"right":return e?Xce:Qce;default:return[]}}function Jce(t,e,n,i){const r=Zl(t);let s=Zce(Ts(t),n==="start",i);return r&&(s=s.map(o=>o+"-"+r),e&&(s=s.concat(s.map(dT)))),s}function b0(t){return t.replace(/left|right|bottom|top/g,e=>jce[e])}function ede(t){return{top:0,right:0,bottom:0,left:0,...t}}function i4(t){return typeof t!="number"?ede(t):{top:t,right:t,bottom:t,left:t}}function E0(t){const{x:e,y:n,width:i,height:r}=t;return{width:i,height:r,top:n,left:e,right:e+i,bottom:n+r,x:e,y:n}}function r4(t,e,n){let{reference:i,floating:r}=t;const s=Fr(e),o=cT(e),a=uT(o),l=Ts(e),u=s==="y",c=i.x+i.width/2-r.width/2,d=i.y+i.height/2-r.height/2,f=i[a]/2-r[a]/2;let h;switch(l){case"top":h={x:c,y:i.y-r.height};break;case"bottom":h={x:c,y:i.y+i.height};break;case"right":h={x:i.x+i.width,y:d};break;case"left":h={x:i.x-r.width,y:d};break;default:h={x:i.x,y:i.y}}switch(Zl(e)){case"start":h[o]-=f*(n&&u?-1:1);break;case"end":h[o]+=f*(n&&u?-1:1);break}return h}const tde=async(t,e,n)=>{const{placement:i="bottom",strategy:r="absolute",middleware:s=[],platform:o}=n,a=s.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(e));let u=await o.getElementRects({reference:t,floating:e,strategy:r}),{x:c,y:d}=r4(u,i,l),f=i,h={},p=0;for(let m=0;m<a.length;m++){const{name:y,fn:g}=a[m],{x:v,y:b,data:T,reset:S}=await g({x:c,y:d,initialPlacement:i,placement:f,strategy:r,middlewareData:h,rects:u,platform:o,elements:{reference:t,floating:e}});c=v??c,d=b??d,h={...h,[y]:{...h[y],...T}},S&&p<=50&&(p++,typeof S=="object"&&(S.placement&&(f=S.placement),S.rects&&(u=S.rects===!0?await o.getElementRects({reference:t,floating:e,strategy:r}):S.rects),{x:c,y:d}=r4(u,f,l)),m=-1)}return{x:c,y:d,placement:f,strategy:r,middlewareData:h}};async function _d(t,e){var n;e===void 0&&(e={});const{x:i,y:r,platform:s,rects:o,elements:a,strategy:l}=t,{boundary:u="clippingAncestors",rootBoundary:c="viewport",elementContext:d="floating",altBoundary:f=!1,padding:h=0}=Es(e,t),p=i4(h),y=a[f?d==="floating"?"reference":"floating":d],g=E0(await s.getClippingRect({element:(n=await(s.isElement==null?void 0:s.isElement(y)))==null||n?y:y.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:u,rootBoundary:c,strategy:l})),v=d==="floating"?{x:i,y:r,width:o.floating.width,height:o.floating.height}:o.reference,b=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),T=await(s.isElement==null?void 0:s.isElement(b))?await(s.getScale==null?void 0:s.getScale(b))||{x:1,y:1}:{x:1,y:1},S=E0(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:v,offsetParent:b,strategy:l}):v);return{top:(g.top-S.top+p.top)/T.y,bottom:(S.bottom-g.bottom+p.bottom)/T.y,left:(g.left-S.left+p.left)/T.x,right:(S.right-g.right+p.right)/T.x}}const nde=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:i,placement:r,rects:s,platform:o,elements:a,middlewareData:l}=e,{element:u,padding:c=0}=Es(t,e)||{};if(u==null)return{};const d=i4(c),f={x:n,y:i},h=cT(r),p=uT(h),m=await o.getDimensions(u),y=h==="y",g=y?"top":"left",v=y?"bottom":"right",b=y?"clientHeight":"clientWidth",T=s.reference[p]+s.reference[h]-f[h]-s.floating[p],S=f[h]-s.reference[h],_=await(o.getOffsetParent==null?void 0:o.getOffsetParent(u));let A=_?_[b]:0;(!A||!await(o.isElement==null?void 0:o.isElement(_)))&&(A=a.floating[b]||s.floating[p]);const P=T/2-S/2,O=A/2-m[p]/2-1,x=mo(d[g],O),L=mo(d[v],O),M=x,V=A-m[p]-L,K=A/2-m[p]/2+P,U=aT(M,K,V),j=!l.arrow&&Zl(r)!=null&&K!==U&&s.reference[p]/2-(K<M?x:L)-m[p]/2<0,G=j?K<M?K-M:K-V:0;return{[h]:f[h]+G,data:{[h]:U,centerOffset:K-U-G,...j&&{alignmentOffset:G}},reset:j}}}),ide=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,i;const{placement:r,middlewareData:s,rects:o,initialPlacement:a,platform:l,elements:u}=e,{mainAxis:c=!0,crossAxis:d=!0,fallbackPlacements:f,fallbackStrategy:h="bestFit",fallbackAxisSideDirection:p="none",flipAlignment:m=!0,...y}=Es(t,e);if((n=s.arrow)!=null&&n.alignmentOffset)return{};const g=Ts(r),v=Fr(a),b=Ts(a)===a,T=await(l.isRTL==null?void 0:l.isRTL(u.floating)),S=f||(b||!m?[b0(a)]:Yce(a)),_=p!=="none";!f&&_&&S.push(...Jce(a,m,p,T));const A=[a,...S],P=await _d(e,y),O=[];let x=((i=s.flip)==null?void 0:i.overflows)||[];if(c&&O.push(P[g]),d){const K=Kce(r,o,T);O.push(P[K[0]],P[K[1]])}if(x=[...x,{placement:r,overflows:O}],!O.every(K=>K<=0)){var L,M;const K=(((L=s.flip)==null?void 0:L.index)||0)+1,U=A[K];if(U&&(!(d==="alignment"?v!==Fr(U):!1)||x.every(H=>Fr(H.placement)===v?H.overflows[0]>0:!0)))return{data:{index:K,overflows:x},reset:{placement:U}};let j=(M=x.filter(G=>G.overflows[0]<=0).sort((G,H)=>G.overflows[1]-H.overflows[1])[0])==null?void 0:M.placement;if(!j)switch(h){case"bestFit":{var V;const G=(V=x.filter(H=>{if(_){const Y=Fr(H.placement);return Y===v||Y==="y"}return!0}).map(H=>[H.placement,H.overflows.filter(Y=>Y>0).reduce((Y,D)=>Y+D,0)]).sort((H,Y)=>H[1]-Y[1])[0])==null?void 0:V[0];G&&(j=G);break}case"initialPlacement":j=a;break}if(r!==j)return{reset:{placement:j}}}return{}}}};function s4(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function o4(t){return Gce.some(e=>t[e]>=0)}const rde=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:n}=e,{strategy:i="referenceHidden",...r}=Es(t,e);switch(i){case"referenceHidden":{const s=await _d(e,{...r,elementContext:"reference"}),o=s4(s,n.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:o4(o)}}}case"escaped":{const s=await _d(e,{...r,altBoundary:!0}),o=s4(s,n.floating);return{data:{escapedOffsets:o,escaped:o4(o)}}}default:return{}}}}},a4=new Set(["left","top"]);async function sde(t,e){const{placement:n,platform:i,elements:r}=t,s=await(i.isRTL==null?void 0:i.isRTL(r.floating)),o=Ts(n),a=Zl(n),l=Fr(n)==="y",u=a4.has(o)?-1:1,c=s&&l?-1:1,d=Es(e,t);let{mainAxis:f,crossAxis:h,alignmentAxis:p}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof p=="number"&&(h=a==="end"?p*-1:p),l?{x:h*c,y:f*u}:{x:f*u,y:h*c}}const ode=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,i;const{x:r,y:s,placement:o,middlewareData:a}=e,l=await sde(e,t);return o===((n=a.offset)==null?void 0:n.placement)&&(i=a.arrow)!=null&&i.alignmentOffset?{}:{x:r+l.x,y:s+l.y,data:{...l,placement:o}}}}},ade=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:i,placement:r}=e,{mainAxis:s=!0,crossAxis:o=!1,limiter:a={fn:y=>{let{x:g,y:v}=y;return{x:g,y:v}}},...l}=Es(t,e),u={x:n,y:i},c=await _d(e,l),d=Fr(Ts(r)),f=lT(d);let h=u[f],p=u[d];if(s){const y=f==="y"?"top":"left",g=f==="y"?"bottom":"right",v=h+c[y],b=h-c[g];h=aT(v,h,b)}if(o){const y=d==="y"?"top":"left",g=d==="y"?"bottom":"right",v=p+c[y],b=p-c[g];p=aT(v,p,b)}const m=a.fn({...e,[f]:h,[d]:p});return{...m,data:{x:m.x-n,y:m.y-i,enabled:{[f]:s,[d]:o}}}}}},lde=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:n,y:i,placement:r,rects:s,middlewareData:o}=e,{offset:a=0,mainAxis:l=!0,crossAxis:u=!0}=Es(t,e),c={x:n,y:i},d=Fr(r),f=lT(d);let h=c[f],p=c[d];const m=Es(a,e),y=typeof m=="number"?{mainAxis:m,crossAxis:0}:{mainAxis:0,crossAxis:0,...m};if(l){const b=f==="y"?"height":"width",T=s.reference[f]-s.floating[b]+y.mainAxis,S=s.reference[f]+s.reference[b]-y.mainAxis;h<T?h=T:h>S&&(h=S)}if(u){var g,v;const b=f==="y"?"width":"height",T=a4.has(Ts(r)),S=s.reference[d]-s.floating[b]+(T&&((g=o.offset)==null?void 0:g[d])||0)+(T?0:y.crossAxis),_=s.reference[d]+s.reference[b]+(T?0:((v=o.offset)==null?void 0:v[d])||0)-(T?y.crossAxis:0);p<S?p=S:p>_&&(p=_)}return{[f]:h,[d]:p}}}},ude=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var n,i;const{placement:r,rects:s,platform:o,elements:a}=e,{apply:l=()=>{},...u}=Es(t,e),c=await _d(e,u),d=Ts(r),f=Zl(r),h=Fr(r)==="y",{width:p,height:m}=s.floating;let y,g;d==="top"||d==="bottom"?(y=d,g=f===(await(o.isRTL==null?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(g=d,y=f==="end"?"top":"bottom");const v=m-c.top-c.bottom,b=p-c.left-c.right,T=mo(m-c[y],v),S=mo(p-c[g],b),_=!e.middlewareData.shift;let A=T,P=S;if((n=e.middlewareData.shift)!=null&&n.enabled.x&&(P=b),(i=e.middlewareData.shift)!=null&&i.enabled.y&&(A=v),_&&!f){const x=_i(c.left,0),L=_i(c.right,0),M=_i(c.top,0),V=_i(c.bottom,0);h?P=p-2*(x!==0||L!==0?x+L:_i(c.left,c.right)):A=m-2*(M!==0||V!==0?M+V:_i(c.top,c.bottom))}await l({...e,availableWidth:P,availableHeight:A});const O=await o.getDimensions(a.floating);return p!==O.width||m!==O.height?{reset:{rects:!0}}:{}}}};function T0(){return typeof window<"u"}function Jl(t){return l4(t)?(t.nodeName||"").toLowerCase():"#document"}function Ai(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function Br(t){var e;return(e=(l4(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function l4(t){return T0()?t instanceof Node||t instanceof Ai(t).Node:!1}function sr(t){return T0()?t instanceof Element||t instanceof Ai(t).Element:!1}function Ur(t){return T0()?t instanceof HTMLElement||t instanceof Ai(t).HTMLElement:!1}function u4(t){return!T0()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof Ai(t).ShadowRoot}const cde=new Set(["inline","contents"]);function Ad(t){const{overflow:e,overflowX:n,overflowY:i,display:r}=or(t);return/auto|scroll|overlay|hidden|clip/.test(e+i+n)&&!cde.has(r)}const dde=new Set(["table","td","th"]);function fde(t){return dde.has(Jl(t))}const hde=[":popover-open",":modal"];function S0(t){return hde.some(e=>{try{return t.matches(e)}catch{return!1}})}const pde=["transform","translate","scale","rotate","perspective"],mde=["transform","translate","scale","rotate","perspective","filter"],gde=["paint","layout","strict","content"];function fT(t){const e=hT(),n=sr(t)?or(t):t;return pde.some(i=>n[i]?n[i]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||mde.some(i=>(n.willChange||"").includes(i))||gde.some(i=>(n.contain||"").includes(i))}function yde(t){let e=go(t);for(;Ur(e)&&!eu(e);){if(fT(e))return e;if(S0(e))return null;e=go(e)}return null}function hT(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const vde=new Set(["html","body","#document"]);function eu(t){return vde.has(Jl(t))}function or(t){return Ai(t).getComputedStyle(t)}function x0(t){return sr(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function go(t){if(Jl(t)==="html")return t;const e=t.assignedSlot||t.parentNode||u4(t)&&t.host||Br(t);return u4(e)?e.host:e}function c4(t){const e=go(t);return eu(e)?t.ownerDocument?t.ownerDocument.body:t.body:Ur(e)&&Ad(e)?e:c4(e)}function Cd(t,e,n){var i;e===void 0&&(e=[]),n===void 0&&(n=!0);const r=c4(t),s=r===((i=t.ownerDocument)==null?void 0:i.body),o=Ai(r);if(s){const a=pT(o);return e.concat(o,o.visualViewport||[],Ad(r)?r:[],a&&n?Cd(a):[])}return e.concat(r,Cd(r,[],n))}function pT(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function d4(t){const e=or(t);let n=parseFloat(e.width)||0,i=parseFloat(e.height)||0;const r=Ur(t),s=r?t.offsetWidth:n,o=r?t.offsetHeight:i,a=y0(n)!==s||y0(i)!==o;return a&&(n=s,i=o),{width:n,height:i,$:a}}function mT(t){return sr(t)?t:t.contextElement}function tu(t){const e=mT(t);if(!Ur(e))return Mr(1);const n=e.getBoundingClientRect(),{width:i,height:r,$:s}=d4(e);let o=(s?y0(n.width):n.width)/i,a=(s?y0(n.height):n.height)/r;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const bde=Mr(0);function f4(t){const e=Ai(t);return!hT()||!e.visualViewport?bde:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function Ede(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==Ai(t)?!1:e}function ma(t,e,n,i){e===void 0&&(e=!1),n===void 0&&(n=!1);const r=t.getBoundingClientRect(),s=mT(t);let o=Mr(1);e&&(i?sr(i)&&(o=tu(i)):o=tu(t));const a=Ede(s,n,i)?f4(s):Mr(0);let l=(r.left+a.x)/o.x,u=(r.top+a.y)/o.y,c=r.width/o.x,d=r.height/o.y;if(s){const f=Ai(s),h=i&&sr(i)?Ai(i):i;let p=f,m=pT(p);for(;m&&i&&h!==p;){const y=tu(m),g=m.getBoundingClientRect(),v=or(m),b=g.left+(m.clientLeft+parseFloat(v.paddingLeft))*y.x,T=g.top+(m.clientTop+parseFloat(v.paddingTop))*y.y;l*=y.x,u*=y.y,c*=y.x,d*=y.y,l+=b,u+=T,p=Ai(m),m=pT(p)}}return E0({width:c,height:d,x:l,y:u})}function w0(t,e){const n=x0(t).scrollLeft;return e?e.left+n:ma(Br(t)).left+n}function h4(t,e){const n=t.getBoundingClientRect(),i=n.left+e.scrollLeft-w0(t,n),r=n.top+e.scrollTop;return{x:i,y:r}}function Tde(t){let{elements:e,rect:n,offsetParent:i,strategy:r}=t;const s=r==="fixed",o=Br(i),a=e?S0(e.floating):!1;if(i===o||a&&s)return n;let l={scrollLeft:0,scrollTop:0},u=Mr(1);const c=Mr(0),d=Ur(i);if((d||!d&&!s)&&((Jl(i)!=="body"||Ad(o))&&(l=x0(i)),Ur(i))){const h=ma(i);u=tu(i),c.x=h.x+i.clientLeft,c.y=h.y+i.clientTop}const f=o&&!d&&!s?h4(o,l):Mr(0);return{width:n.width*u.x,height:n.height*u.y,x:n.x*u.x-l.scrollLeft*u.x+c.x+f.x,y:n.y*u.y-l.scrollTop*u.y+c.y+f.y}}function Sde(t){return Array.from(t.getClientRects())}function xde(t){const e=Br(t),n=x0(t),i=t.ownerDocument.body,r=_i(e.scrollWidth,e.clientWidth,i.scrollWidth,i.clientWidth),s=_i(e.scrollHeight,e.clientHeight,i.scrollHeight,i.clientHeight);let o=-n.scrollLeft+w0(t);const a=-n.scrollTop;return or(i).direction==="rtl"&&(o+=_i(e.clientWidth,i.clientWidth)-r),{width:r,height:s,x:o,y:a}}const p4=25;function wde(t,e){const n=Ai(t),i=Br(t),r=n.visualViewport;let s=i.clientWidth,o=i.clientHeight,a=0,l=0;if(r){s=r.width,o=r.height;const c=hT();(!c||c&&e==="fixed")&&(a=r.offsetLeft,l=r.offsetTop)}const u=w0(i);if(u<=0){const c=i.ownerDocument,d=c.body,f=getComputedStyle(d),h=c.compatMode==="CSS1Compat"&&parseFloat(f.marginLeft)+parseFloat(f.marginRight)||0,p=Math.abs(i.clientWidth-d.clientWidth-h);p<=p4&&(s-=p)}else u<=p4&&(s+=u);return{width:s,height:o,x:a,y:l}}const _de=new Set(["absolute","fixed"]);function Ade(t,e){const n=ma(t,!0,e==="fixed"),i=n.top+t.clientTop,r=n.left+t.clientLeft,s=Ur(t)?tu(t):Mr(1),o=t.clientWidth*s.x,a=t.clientHeight*s.y,l=r*s.x,u=i*s.y;return{width:o,height:a,x:l,y:u}}function m4(t,e,n){let i;if(e==="viewport")i=wde(t,n);else if(e==="document")i=xde(Br(t));else if(sr(e))i=Ade(e,n);else{const r=f4(t);i={x:e.x-r.x,y:e.y-r.y,width:e.width,height:e.height}}return E0(i)}function g4(t,e){const n=go(t);return n===e||!sr(n)||eu(n)?!1:or(n).position==="fixed"||g4(n,e)}function Cde(t,e){const n=e.get(t);if(n)return n;let i=Cd(t,[],!1).filter(a=>sr(a)&&Jl(a)!=="body"),r=null;const s=or(t).position==="fixed";let o=s?go(t):t;for(;sr(o)&&!eu(o);){const a=or(o),l=fT(o);!l&&a.position==="fixed"&&(r=null),(s?!l&&!r:!l&&a.position==="static"&&!!r&&_de.has(r.position)||Ad(o)&&!l&&g4(t,o))?i=i.filter(c=>c!==o):r=a,o=go(o)}return e.set(t,i),i}function Ide(t){let{element:e,boundary:n,rootBoundary:i,strategy:r}=t;const o=[...n==="clippingAncestors"?S0(e)?[]:Cde(e,this._c):[].concat(n),i],a=o[0],l=o.reduce((u,c)=>{const d=m4(e,c,r);return u.top=_i(d.top,u.top),u.right=mo(d.right,u.right),u.bottom=mo(d.bottom,u.bottom),u.left=_i(d.left,u.left),u},m4(e,a,r));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function Rde(t){const{width:e,height:n}=d4(t);return{width:e,height:n}}function Lde(t,e,n){const i=Ur(e),r=Br(e),s=n==="fixed",o=ma(t,!0,s,e);let a={scrollLeft:0,scrollTop:0};const l=Mr(0);function u(){l.x=w0(r)}if(i||!i&&!s)if((Jl(e)!=="body"||Ad(r))&&(a=x0(e)),i){const h=ma(e,!0,s,e);l.x=h.x+e.clientLeft,l.y=h.y+e.clientTop}else r&&u();s&&!i&&r&&u();const c=r&&!i&&!s?h4(r,a):Mr(0),d=o.left+a.scrollLeft-l.x-c.x,f=o.top+a.scrollTop-l.y-c.y;return{x:d,y:f,width:o.width,height:o.height}}function gT(t){return or(t).position==="static"}function y4(t,e){if(!Ur(t)||or(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return Br(t)===n&&(n=n.ownerDocument.body),n}function v4(t,e){const n=Ai(t);if(S0(t))return n;if(!Ur(t)){let r=go(t);for(;r&&!eu(r);){if(sr(r)&&!gT(r))return r;r=go(r)}return n}let i=y4(t,e);for(;i&&fde(i)&&gT(i);)i=y4(i,e);return i&&eu(i)&&gT(i)&&!fT(i)?n:i||yde(t)||n}const Pde=async function(t){const e=this.getOffsetParent||v4,n=this.getDimensions,i=await n(t.floating);return{reference:Lde(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:i.width,height:i.height}}};function kde(t){return or(t).direction==="rtl"}const Dde={convertOffsetParentRelativeRectToViewportRelativeRect:Tde,getDocumentElement:Br,getClippingRect:Ide,getOffsetParent:v4,getElementRects:Pde,getClientRects:Sde,getDimensions:Rde,getScale:tu,isElement:sr,isRTL:kde};function b4(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function Ode(t,e){let n=null,i;const r=Br(t);function s(){var a;clearTimeout(i),(a=n)==null||a.disconnect(),n=null}function o(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),s();const u=t.getBoundingClientRect(),{left:c,top:d,width:f,height:h}=u;if(a||e(),!f||!h)return;const p=v0(d),m=v0(r.clientWidth-(c+f)),y=v0(r.clientHeight-(d+h)),g=v0(c),b={rootMargin:-p+"px "+-m+"px "+-y+"px "+-g+"px",threshold:_i(0,mo(1,l))||1};let T=!0;function S(_){const A=_[0].intersectionRatio;if(A!==l){if(!T)return o();A?o(!1,A):i=setTimeout(()=>{o(!1,1e-7)},1e3)}A===1&&!b4(u,t.getBoundingClientRect())&&o(),T=!1}try{n=new IntersectionObserver(S,{...b,root:r.ownerDocument})}catch{n=new IntersectionObserver(S,b)}n.observe(t)}return o(!0),s}function Nde(t,e,n,i){i===void 0&&(i={});const{ancestorScroll:r=!0,ancestorResize:s=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=i,u=mT(t),c=r||s?[...u?Cd(u):[],...Cd(e)]:[];c.forEach(g=>{r&&g.addEventListener("scroll",n,{passive:!0}),s&&g.addEventListener("resize",n)});const d=u&&a?Ode(u,n):null;let f=-1,h=null;o&&(h=new ResizeObserver(g=>{let[v]=g;v&&v.target===u&&h&&(h.unobserve(e),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var b;(b=h)==null||b.observe(e)})),n()}),u&&!l&&h.observe(u),h.observe(e));let p,m=l?ma(t):null;l&&y();function y(){const g=ma(t);m&&!b4(m,g)&&n(),m=g,p=requestAnimationFrame(y)}return n(),()=>{var g;c.forEach(v=>{r&&v.removeEventListener("scroll",n),s&&v.removeEventListener("resize",n)}),d==null||d(),(g=h)==null||g.disconnect(),h=null,l&&cancelAnimationFrame(p)}}const Mde=ode,Fde=ade,Bde=ide,Ude=ude,Hde=rde,E4=nde,$de=lde,zde=(t,e,n)=>{const i=new Map,r={platform:Dde,...n},s={...r.platform,_c:i};return tde(t,e,{...r,platform:s})};var Vde=typeof document<"u",Gde=function(){},_0=Vde?Ii:Gde;function A0(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let n,i,r;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!==e.length)return!1;for(i=n;i--!==0;)if(!A0(t[i],e[i]))return!1;return!0}if(r=Object.keys(t),n=r.length,n!==Object.keys(e).length)return!1;for(i=n;i--!==0;)if(!{}.hasOwnProperty.call(e,r[i]))return!1;for(i=n;i--!==0;){const s=r[i];if(!(s==="_owner"&&t.$$typeof)&&!A0(t[s],e[s]))return!1}return!0}return t!==t&&e!==e}function T4(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function S4(t,e){const n=T4(t);return Math.round(e*n)/n}function yT(t){const e=Le(t);return _0(()=>{e.current=t}),e}function jde(t){t===void 0&&(t={});const{placement:e="bottom",strategy:n="absolute",middleware:i=[],platform:r,elements:{reference:s,floating:o}={},transform:a=!0,whileElementsMounted:l,open:u}=t,[c,d]=Se({x:0,y:0,strategy:n,placement:e,middlewareData:{},isPositioned:!1}),[f,h]=Se(i);A0(f,i)||h(i);const[p,m]=Se(null),[y,g]=Se(null),v=Ge(H=>{H!==_.current&&(_.current=H,m(H))},[]),b=Ge(H=>{H!==A.current&&(A.current=H,g(H))},[]),T=s||p,S=o||y,_=Le(null),A=Le(null),P=Le(c),O=l!=null,x=yT(l),L=yT(r),M=yT(u),V=Ge(()=>{if(!_.current||!A.current)return;const H={placement:e,strategy:n,middleware:f};L.current&&(H.platform=L.current),zde(_.current,A.current,H).then(Y=>{const D={...Y,isPositioned:M.current!==!1};K.current&&!A0(P.current,D)&&(P.current=D,yc.flushSync(()=>{d(D)}))})},[f,e,n,L,M]);_0(()=>{u===!1&&P.current.isPositioned&&(P.current.isPositioned=!1,d(H=>({...H,isPositioned:!1})))},[u]);const K=Le(!1);_0(()=>(K.current=!0,()=>{K.current=!1}),[]),_0(()=>{if(T&&(_.current=T),S&&(A.current=S),T&&S){if(x.current)return x.current(T,S,V);V()}},[T,S,V,x,O]);const U=en(()=>({reference:_,floating:A,setReference:v,setFloating:b}),[v,b]),j=en(()=>({reference:T,floating:S}),[T,S]),G=en(()=>{const H={position:n,left:0,top:0};if(!j.floating)return H;const Y=S4(j.floating,c.x),D=S4(j.floating,c.y);return a?{...H,transform:"translate("+Y+"px, "+D+"px)",...T4(j.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:Y,top:D}},[n,a,j.floating,c.x,c.y]);return en(()=>({...c,update:V,refs:U,elements:j,floatingStyles:G}),[c,V,U,j,G])}const Wde=t=>{function e(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:t,fn(n){const{element:i,padding:r}=typeof t=="function"?t(n):t;return i&&e(i)?i.current!=null?E4({element:i.current,padding:r}).fn(n):{}:i?E4({element:i,padding:r}).fn(n):{}}}},qde=(t,e)=>({...Mde(t),options:[t,e]}),Kde=(t,e)=>({...Fde(t),options:[t,e]}),Yde=(t,e)=>({...$de(t),options:[t,e]}),Xde=(t,e)=>({...Bde(t),options:[t,e]}),Qde=(t,e)=>({...Ude(t),options:[t,e]}),Zde=(t,e)=>({...Hde(t),options:[t,e]}),Jde=(t,e)=>({...Wde(t),options:[t,e]});var efe="Arrow",x4=Re((t,e)=>{const{children:n,width:i=10,height:r=5,...s}=t;return ue(ut.svg,{...s,ref:e,width:i,height:r,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?n:ue("polygon",{points:"0,0 30,0 15,10"})})});x4.displayName=efe;var tfe=x4,vT="Popper",[w4,C0]=hr(vT),[nfe,_4]=w4(vT),A4=t=>{const{__scopePopper:e,children:n}=t,[i,r]=Se(null);return ue(nfe,{scope:e,anchor:i,onAnchorChange:r,children:n})};A4.displayName=vT;var C4="PopperAnchor",I4=Re((t,e)=>{const{__scopePopper:n,virtualRef:i,...r}=t,s=_4(C4,n),o=Le(null),a=At(e,o),l=Le(null);return me(()=>{const u=l.current;l.current=(i==null?void 0:i.current)||o.current,u!==l.current&&s.onAnchorChange(l.current)}),i?null:ue(ut.div,{...r,ref:a})});I4.displayName=C4;var bT="PopperContent",[ife,rfe]=w4(bT),R4=Re((t,e)=>{var re,Ae,$e,Ie,Me,Ne;const{__scopePopper:n,side:i="bottom",sideOffset:r=0,align:s="center",alignOffset:o=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:u=[],collisionPadding:c=0,sticky:d="partial",hideWhenDetached:f=!1,updatePositionStrategy:h="optimized",onPlaced:p,...m}=t,y=_4(bT,n),[g,v]=Se(null),b=At(e,at=>v(at)),[T,S]=Se(null),_=Vv(T),A=(_==null?void 0:_.width)??0,P=(_==null?void 0:_.height)??0,O=i+(s!=="center"?"-"+s:""),x=typeof c=="number"?c:{top:0,right:0,bottom:0,left:0,...c},L=Array.isArray(u)?u:[u],M=L.length>0,V={padding:x,boundary:L.filter(ofe),altBoundary:M},{refs:K,floatingStyles:U,placement:j,isPositioned:G,middlewareData:H}=jde({strategy:"fixed",placement:O,whileElementsMounted:(...at)=>Nde(...at,{animationFrame:h==="always"}),elements:{reference:y.anchor},middleware:[qde({mainAxis:r+P,alignmentAxis:o}),l&&Kde({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?Yde():void 0,...V}),l&&Xde({...V}),Qde({...V,apply:({elements:at,rects:wt,availableWidth:Bt,availableHeight:We})=>{const{width:w,height:B}=wt.reference,Z=at.floating.style;Z.setProperty("--radix-popper-available-width",`${Bt}px`),Z.setProperty("--radix-popper-available-height",`${We}px`),Z.setProperty("--radix-popper-anchor-width",`${w}px`),Z.setProperty("--radix-popper-anchor-height",`${B}px`)}}),T&&Jde({element:T,padding:a}),afe({arrowWidth:A,arrowHeight:P}),f&&Zde({strategy:"referenceHidden",...V})]}),[Y,D]=k4(j),ee=Qs(p);xn(()=>{G&&(ee==null||ee())},[G,ee]);const ne=(re=H.arrow)==null?void 0:re.x,N=(Ae=H.arrow)==null?void 0:Ae.y,le=(($e=H.arrow)==null?void 0:$e.centerOffset)!==0,[we,ce]=Se();return xn(()=>{g&&ce(window.getComputedStyle(g).zIndex)},[g]),ue("div",{ref:K.setFloating,"data-radix-popper-content-wrapper":"",style:{...U,transform:G?U.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:we,"--radix-popper-transform-origin":[(Ie=H.transformOrigin)==null?void 0:Ie.x,(Me=H.transformOrigin)==null?void 0:Me.y].join(" "),...((Ne=H.hide)==null?void 0:Ne.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:ue(ife,{scope:n,placedSide:Y,onArrowChange:S,arrowX:ne,arrowY:N,shouldHideArrow:le,children:ue(ut.div,{"data-side":Y,"data-align":D,...m,ref:b,style:{...m.style,animation:G?void 0:"none"}})})})});R4.displayName=bT;var L4="PopperArrow",sfe={top:"bottom",right:"left",bottom:"top",left:"right"},P4=Re(function(e,n){const{__scopePopper:i,...r}=e,s=rfe(L4,i),o=sfe[s.placedSide];return ue("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:ue(tfe,{...r,ref:n,style:{...r.style,display:"block"}})})});P4.displayName=L4;function ofe(t){return t!==null}var afe=t=>({name:"transformOrigin",options:t,fn(e){var y,g,v;const{placement:n,rects:i,middlewareData:r}=e,o=((y=r.arrow)==null?void 0:y.centerOffset)!==0,a=o?0:t.arrowWidth,l=o?0:t.arrowHeight,[u,c]=k4(n),d={start:"0%",center:"50%",end:"100%"}[c],f=(((g=r.arrow)==null?void 0:g.x)??0)+a/2,h=(((v=r.arrow)==null?void 0:v.y)??0)+l/2;let p="",m="";return u==="bottom"?(p=o?d:`${f}px`,m=`${-l}px`):u==="top"?(p=o?d:`${f}px`,m=`${i.floating.height+l}px`):u==="right"?(p=`${-l}px`,m=o?d:`${h}px`):u==="left"&&(p=`${i.floating.width+l}px`,m=o?d:`${h}px`),{data:{x:p,y:m}}}});function k4(t){const[e,n="center"]=t.split("-");return[e,n]}var D4=A4,ET=I4,O4=R4,N4=P4,lfe="Portal",M4=Re((t,e)=>{var a;const{container:n,...i}=t,[r,s]=Se(!1);xn(()=>s(!0),[]);const o=n||r&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return o?l$.createPortal(ue(ut.div,{...i,ref:e}),o):null});M4.displayName=lfe;var ufe=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},nu=new WeakMap,I0=new WeakMap,R0={},TT=0,F4=function(t){return t&&(t.host||F4(t.parentNode))},cfe=function(t,e){return e.map(function(n){if(t.contains(n))return n;var i=F4(n);return i&&t.contains(i)?i:(console.error("aria-hidden",n,"in not contained inside",t,". Doing nothing"),null)}).filter(function(n){return!!n})},dfe=function(t,e,n,i){var r=cfe(e,Array.isArray(t)?t:[t]);R0[n]||(R0[n]=new WeakMap);var s=R0[n],o=[],a=new Set,l=new Set(r),u=function(d){!d||a.has(d)||(a.add(d),u(d.parentNode))};r.forEach(u);var c=function(d){!d||l.has(d)||Array.prototype.forEach.call(d.children,function(f){if(a.has(f))c(f);else try{var h=f.getAttribute(i),p=h!==null&&h!=="false",m=(nu.get(f)||0)+1,y=(s.get(f)||0)+1;nu.set(f,m),s.set(f,y),o.push(f),m===1&&p&&I0.set(f,!0),y===1&&f.setAttribute(n,"true"),p||f.setAttribute(i,"true")}catch(g){console.error("aria-hidden: cannot operate on ",f,g)}})};return c(e),a.clear(),TT++,function(){o.forEach(function(d){var f=nu.get(d)-1,h=s.get(d)-1;nu.set(d,f),s.set(d,h),f||(I0.has(d)||d.removeAttribute(i),I0.delete(d)),h||d.removeAttribute(n)}),TT--,TT||(nu=new WeakMap,nu=new WeakMap,I0=new WeakMap,R0={})}},B4=function(t,e,n){n===void 0&&(n="data-aria-hidden");var i=Array.from(Array.isArray(t)?t:[t]),r=ufe(t);return r?(i.push.apply(i,Array.from(r.querySelectorAll("[aria-live], script"))),dfe(i,r,n,"aria-hidden")):function(){return null}},Hr=function(){return Hr=Object.assign||function(e){for(var n,i=1,r=arguments.length;i<r;i++){n=arguments[i];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Hr.apply(this,arguments)};function U4(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function ffe(t,e,n){if(n||arguments.length===2)for(var i=0,r=e.length,s;i<r;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))}typeof SuppressedError=="function"&&SuppressedError;var L0="right-scroll-bar-position",P0="width-before-scroll-bar",hfe="with-scroll-bars-hidden",pfe="--removed-body-scroll-bar-size";function ST(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function mfe(t,e){var n=Se(function(){return{value:t,callback:e,facade:{get current(){return n.value},set current(i){var r=n.value;r!==i&&(n.value=i,n.callback(i,r))}}}})[0];return n.callback=e,n.facade}var gfe=typeof window<"u"?Ii:me,H4=new WeakMap;function yfe(t,e){var n=mfe(null,function(i){return t.forEach(function(r){return ST(r,i)})});return gfe(function(){var i=H4.get(n);if(i){var r=new Set(i),s=new Set(t),o=n.current;r.forEach(function(a){s.has(a)||ST(a,null)}),s.forEach(function(a){r.has(a)||ST(a,o)})}H4.set(n,t)},[t]),n}function vfe(t){return t}function bfe(t,e){e===void 0&&(e=vfe);var n=[],i=!1,r={read:function(){if(i)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:t},useMedium:function(s){var o=e(s,i);return n.push(o),function(){n=n.filter(function(a){return a!==o})}},assignSyncMedium:function(s){for(i=!0;n.length;){var o=n;n=[],o.forEach(s)}n={push:function(a){return s(a)},filter:function(){return n}}},assignMedium:function(s){i=!0;var o=[];if(n.length){var a=n;n=[],a.forEach(s),o=n}var l=function(){var c=o;o=[],c.forEach(s)},u=function(){return Promise.resolve().then(l)};u(),n={push:function(c){o.push(c),u()},filter:function(c){return o=o.filter(c),n}}}};return r}function Efe(t){t===void 0&&(t={});var e=bfe(null);return e.options=Hr({async:!0,ssr:!1},t),e}var $4=function(t){var e=t.sideCar,n=U4(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var i=e.read();if(!i)throw new Error("Sidecar medium not found");return k(i,Hr({},n))};$4.isSideCarExport=!0;function Tfe(t,e){return t.useMedium(e),$4}var z4=Efe(),xT=function(){},k0=Re(function(t,e){var n=Le(null),i=Se({onScrollCapture:xT,onWheelCapture:xT,onTouchMoveCapture:xT}),r=i[0],s=i[1],o=t.forwardProps,a=t.children,l=t.className,u=t.removeScrollBar,c=t.enabled,d=t.shards,f=t.sideCar,h=t.noRelative,p=t.noIsolation,m=t.inert,y=t.allowPinchZoom,g=t.as,v=g===void 0?"div":g,b=t.gapMode,T=U4(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),S=f,_=yfe([n,e]),A=Hr(Hr({},T),r);return k(Be,null,c&&k(S,{sideCar:z4,removeScrollBar:u,shards:d,noRelative:h,noIsolation:p,inert:m,setCallbacks:s,allowPinchZoom:!!y,lockRef:n,gapMode:b}),o?Vr(Gn.only(a),Hr(Hr({},A),{ref:_})):k(v,Hr({},A,{className:l,ref:_}),a))});k0.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},k0.classNames={fullWidth:P0,zeroRight:L0};var Sfe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function xfe(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=Sfe();return e&&t.setAttribute("nonce",e),t}function wfe(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function _fe(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var Afe=function(){var t=0,e=null;return{add:function(n){t==0&&(e=xfe())&&(wfe(e,n),_fe(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},Cfe=function(){var t=Afe();return function(e,n){me(function(){return t.add(e),function(){t.remove()}},[e&&n])}},V4=function(){var t=Cfe(),e=function(n){var i=n.styles,r=n.dynamic;return t(i,r),null};return e},Ife={left:0,top:0,right:0,gap:0},wT=function(t){return parseInt(t||"",10)||0},Rfe=function(t){var e=window.getComputedStyle(document.body),n=e[t==="padding"?"paddingLeft":"marginLeft"],i=e[t==="padding"?"paddingTop":"marginTop"],r=e[t==="padding"?"paddingRight":"marginRight"];return[wT(n),wT(i),wT(r)]},Lfe=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return Ife;var e=Rfe(t),n=document.documentElement.clientWidth,i=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,i-n+e[2]-e[0])}},Pfe=V4(),iu="data-scroll-locked",kfe=function(t,e,n,i){var r=t.left,s=t.top,o=t.right,a=t.gap;return n===void 0&&(n="margin"),`
  .`.concat(hfe,` {
   overflow: hidden `).concat(i,`;
   padding-right: `).concat(a,"px ").concat(i,`;
  }
  body[`).concat(iu,`] {
    overflow: hidden `).concat(i,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(i,";"),n==="margin"&&`
    padding-left: `.concat(r,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(o,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(i,`;
    `),n==="padding"&&"padding-right: ".concat(a,"px ").concat(i,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(L0,` {
    right: `).concat(a,"px ").concat(i,`;
  }
  
  .`).concat(P0,` {
    margin-right: `).concat(a,"px ").concat(i,`;
  }
  
  .`).concat(L0," .").concat(L0,` {
    right: 0 `).concat(i,`;
  }
  
  .`).concat(P0," .").concat(P0,` {
    margin-right: 0 `).concat(i,`;
  }
  
  body[`).concat(iu,`] {
    `).concat(pfe,": ").concat(a,`px;
  }
`)},G4=function(){var t=parseInt(document.body.getAttribute(iu)||"0",10);return isFinite(t)?t:0},Dfe=function(){me(function(){return document.body.setAttribute(iu,(G4()+1).toString()),function(){var t=G4()-1;t<=0?document.body.removeAttribute(iu):document.body.setAttribute(iu,t.toString())}},[])},Ofe=function(t){var e=t.noRelative,n=t.noImportant,i=t.gapMode,r=i===void 0?"margin":i;Dfe();var s=en(function(){return Lfe(r)},[r]);return k(Pfe,{styles:kfe(s,!e,r,n?"":"!important")})},_T=!1;if(typeof window<"u")try{var D0=Object.defineProperty({},"passive",{get:function(){return _T=!0,!0}});window.addEventListener("test",D0,D0),window.removeEventListener("test",D0,D0)}catch{_T=!1}var ru=_T?{passive:!1}:!1,Nfe=function(t){return t.tagName==="TEXTAREA"},j4=function(t,e){if(!(t instanceof Element))return!1;var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!Nfe(t)&&n[e]==="visible")},Mfe=function(t){return j4(t,"overflowY")},Ffe=function(t){return j4(t,"overflowX")},W4=function(t,e){var n=e.ownerDocument,i=e;do{typeof ShadowRoot<"u"&&i instanceof ShadowRoot&&(i=i.host);var r=q4(t,i);if(r){var s=K4(t,i),o=s[1],a=s[2];if(o>a)return!0}i=i.parentNode}while(i&&i!==n.body);return!1},Bfe=function(t){var e=t.scrollTop,n=t.scrollHeight,i=t.clientHeight;return[e,n,i]},Ufe=function(t){var e=t.scrollLeft,n=t.scrollWidth,i=t.clientWidth;return[e,n,i]},q4=function(t,e){return t==="v"?Mfe(e):Ffe(e)},K4=function(t,e){return t==="v"?Bfe(e):Ufe(e)},Hfe=function(t,e){return t==="h"&&e==="rtl"?-1:1},$fe=function(t,e,n,i,r){var s=Hfe(t,window.getComputedStyle(e).direction),o=s*i,a=n.target,l=e.contains(a),u=!1,c=o>0,d=0,f=0;do{if(!a)break;var h=K4(t,a),p=h[0],m=h[1],y=h[2],g=m-y-s*p;(p||g)&&q4(t,a)&&(d+=g,f+=p);var v=a.parentNode;a=v&&v.nodeType===Node.DOCUMENT_FRAGMENT_NODE?v.host:v}while(!l&&a!==document.body||l&&(e.contains(a)||e===a));return(c&&Math.abs(d)<1||!c&&Math.abs(f)<1)&&(u=!0),u},O0=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},Y4=function(t){return[t.deltaX,t.deltaY]},X4=function(t){return t&&"current"in t?t.current:t},zfe=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Vfe=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},Gfe=0,su=[];function jfe(t){var e=Le([]),n=Le([0,0]),i=Le(),r=Se(Gfe++)[0],s=Se(V4)[0],o=Le(t);me(function(){o.current=t},[t]),me(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(r));var m=ffe([t.lockRef.current],(t.shards||[]).map(X4),!0).filter(Boolean);return m.forEach(function(y){return y.classList.add("allow-interactivity-".concat(r))}),function(){document.body.classList.remove("block-interactivity-".concat(r)),m.forEach(function(y){return y.classList.remove("allow-interactivity-".concat(r))})}}},[t.inert,t.lockRef.current,t.shards]);var a=Ge(function(m,y){if("touches"in m&&m.touches.length===2||m.type==="wheel"&&m.ctrlKey)return!o.current.allowPinchZoom;var g=O0(m),v=n.current,b="deltaX"in m?m.deltaX:v[0]-g[0],T="deltaY"in m?m.deltaY:v[1]-g[1],S,_=m.target,A=Math.abs(b)>Math.abs(T)?"h":"v";if("touches"in m&&A==="h"&&_.type==="range")return!1;var P=W4(A,_);if(!P)return!0;if(P?S=A:(S=A==="v"?"h":"v",P=W4(A,_)),!P)return!1;if(!i.current&&"changedTouches"in m&&(b||T)&&(i.current=S),!S)return!0;var O=i.current||S;return $fe(O,y,m,O==="h"?b:T)},[]),l=Ge(function(m){var y=m;if(!(!su.length||su[su.length-1]!==s)){var g="deltaY"in y?Y4(y):O0(y),v=e.current.filter(function(S){return S.name===y.type&&(S.target===y.target||y.target===S.shadowParent)&&zfe(S.delta,g)})[0];if(v&&v.should){y.cancelable&&y.preventDefault();return}if(!v){var b=(o.current.shards||[]).map(X4).filter(Boolean).filter(function(S){return S.contains(y.target)}),T=b.length>0?a(y,b[0]):!o.current.noIsolation;T&&y.cancelable&&y.preventDefault()}}},[]),u=Ge(function(m,y,g,v){var b={name:m,delta:y,target:g,should:v,shadowParent:Wfe(g)};e.current.push(b),setTimeout(function(){e.current=e.current.filter(function(T){return T!==b})},1)},[]),c=Ge(function(m){n.current=O0(m),i.current=void 0},[]),d=Ge(function(m){u(m.type,Y4(m),m.target,a(m,t.lockRef.current))},[]),f=Ge(function(m){u(m.type,O0(m),m.target,a(m,t.lockRef.current))},[]);me(function(){return su.push(s),t.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:f}),document.addEventListener("wheel",l,ru),document.addEventListener("touchmove",l,ru),document.addEventListener("touchstart",c,ru),function(){su=su.filter(function(m){return m!==s}),document.removeEventListener("wheel",l,ru),document.removeEventListener("touchmove",l,ru),document.removeEventListener("touchstart",c,ru)}},[]);var h=t.removeScrollBar,p=t.inert;return k(Be,null,p?k(s,{styles:Vfe(r)}):null,h?k(Ofe,{noRelative:t.noRelative,gapMode:t.gapMode}):null)}function Wfe(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const qfe=Tfe(z4,jfe);var AT=Re(function(t,e){return k(k0,Hr({},t,{ref:e,sideCar:qfe}))});AT.classNames=k0.classNames;var N0="Popover",[Q4]=hr(N0,[C0]),Id=C0(),[Kfe,ga]=Q4(N0),Z4=t=>{const{__scopePopover:e,children:n,open:i,defaultOpen:r,onOpenChange:s,modal:o=!1}=t,a=Id(e),l=Le(null),[u,c]=Se(!1),[d,f]=Rs({prop:i,defaultProp:r??!1,onChange:s,caller:N0});return ue(D4,{...a,children:ue(Kfe,{scope:e,contentId:qo(),triggerRef:l,open:d,onOpenChange:f,onOpenToggle:Ge(()=>f(h=>!h),[f]),hasCustomAnchor:u,onCustomAnchorAdd:Ge(()=>c(!0),[]),onCustomAnchorRemove:Ge(()=>c(!1),[]),modal:o,children:n})})};Z4.displayName=N0;var J4="PopoverAnchor",Yfe=Re((t,e)=>{const{__scopePopover:n,...i}=t,r=ga(J4,n),s=Id(n),{onCustomAnchorAdd:o,onCustomAnchorRemove:a}=r;return me(()=>(o(),()=>a()),[o,a]),ue(ET,{...s,...i,ref:e})});Yfe.displayName=J4;var eM="PopoverTrigger",tM=Re((t,e)=>{const{__scopePopover:n,...i}=t,r=ga(eM,n),s=Id(n),o=At(e,r.triggerRef),a=ue(ut.button,{type:"button","aria-haspopup":"dialog","aria-expanded":r.open,"aria-controls":r.contentId,"data-state":aM(r.open),...i,ref:o,onClick:st(t.onClick,r.onOpenToggle)});return r.hasCustomAnchor?a:ue(ET,{asChild:!0,...s,children:a})});tM.displayName=eM;var Xfe="PopoverPortal",[Rye,Qfe]=Q4(Xfe,{forceMount:void 0}),ou="PopoverContent",nM=Re((t,e)=>{const n=Qfe(ou,t.__scopePopover),{forceMount:i=n.forceMount,...r}=t,s=ga(ou,t.__scopePopover);return ue(bc,{present:i||s.open,children:s.modal?ue(Jfe,{...r,ref:e}):ue(ehe,{...r,ref:e})})});nM.displayName=ou;var Zfe=vc("PopoverContent.RemoveScroll"),Jfe=Re((t,e)=>{const n=ga(ou,t.__scopePopover),i=Le(null),r=At(e,i),s=Le(!1);return me(()=>{const o=i.current;if(o)return B4(o)},[]),ue(AT,{as:Zfe,allowPinchZoom:!0,children:ue(iM,{...t,ref:r,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:st(t.onCloseAutoFocus,o=>{var a;o.preventDefault(),s.current||(a=n.triggerRef.current)==null||a.focus()}),onPointerDownOutside:st(t.onPointerDownOutside,o=>{const a=o.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0,u=a.button===2||l;s.current=u},{checkForDefaultPrevented:!1}),onFocusOutside:st(t.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1})})})}),ehe=Re((t,e)=>{const n=ga(ou,t.__scopePopover),i=Le(!1),r=Le(!1);return ue(iM,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{var o,a;(o=t.onCloseAutoFocus)==null||o.call(t,s),s.defaultPrevented||(i.current||(a=n.triggerRef.current)==null||a.focus(),s.preventDefault()),i.current=!1,r.current=!1},onInteractOutside:s=>{var l,u;(l=t.onInteractOutside)==null||l.call(t,s),s.defaultPrevented||(i.current=!0,s.detail.originalEvent.type==="pointerdown"&&(r.current=!0));const o=s.target;((u=n.triggerRef.current)==null?void 0:u.contains(o))&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&r.current&&s.preventDefault()}})}),iM=Re((t,e)=>{const{__scopePopover:n,trapFocus:i,onOpenAutoFocus:r,onCloseAutoFocus:s,disableOutsidePointerEvents:o,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:u,onInteractOutside:c,...d}=t,f=ga(ou,n),h=Id(n);return K6(),ue(oT,{asChild:!0,loop:!0,trapped:i,onMountAutoFocus:r,onUnmountAutoFocus:s,children:ue(nT,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:c,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:u,onDismiss:()=>f.onOpenChange(!1),children:ue(O4,{"data-state":aM(f.open),role:"dialog",id:f.contentId,...h,...d,ref:e,style:{...d.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),rM="PopoverClose",sM=Re((t,e)=>{const{__scopePopover:n,...i}=t,r=ga(rM,n);return ue(ut.button,{type:"button",...i,ref:e,onClick:st(t.onClick,()=>r.onOpenChange(!1))})});sM.displayName=rM;var the="PopoverArrow",oM=Re((t,e)=>{const{__scopePopover:n,...i}=t,r=Id(n);return ue(N4,{...r,...i,ref:e})});oM.displayName=the;function aM(t){return t?"open":"closed"}var nhe=Z4,ihe=tM,rhe=nM,she=sM,ohe=oM;const ahe=Fw({"0%":{opacity:0,transform:"translateY(1rem)"},"100%":{opacity:1,transform:"translateY(0)"}}),lhe=Fw({"0%":{opacity:0,transform:"translateY(1rem)"},"100%":{opacity:1,transform:"translateY(0)"}}),lM=xe(ohe,{fill:"$secondaryAlt"}),uhe=xe(she,{position:"absolute",right:"0",top:"0",padding:"0.5rem",margin:"0",cursor:"pointer",border:"none",background:"none",fill:"inherit","&:hover":{opacity:"0.75"}}),che=xe(rhe,{border:"none",backgroundColor:"white",fill:"inhrerit",padding:"1rem 2rem 1rem 1rem",width:"auto",minWidth:"200px",maxWidth:"350px",borderRadius:"3px",boxShadow:"5px 5px 13px #0002",animationDuration:"0.3s",animationTimingFunction:"cubic-bezier(0.16, 1, 0.3, 1)",'&[data-side="top"]':{animationName:lhe},'&[data-side="bottom"]':{animationName:ahe},'&[data-align="end"]':{[`& ${lM}`]:{margin:"0 0.7rem"}}}),dhe=xe(ihe,{display:"inline-flex",padding:"0.5rem 0",margin:"0 0.5rem 0 0",cursor:"pointer",border:"none",background:"none","> button, > span":{margin:"0"}}),fhe=xe(nhe,{boxSizing:"content-box"}),hhe=t=>k(dhe,{...t},t.children),phe=t=>k(che,{...t,sideOffset:5,collisionPadding:21},k(lM,null),k(uhe,null,k(Nn,{isSmall:!0},k(Nn.Close,null))),t.children),ya=({children:t})=>k(fhe,null,t);ya.Trigger=hhe,ya.Content=phe;const M0=xe("div",{boxSizing:"border-box",display:"inline-flex",alignItems:"center",borderRadius:"2px",padding:"$1",marginBottom:"$2",marginRight:"$2",backgroundColor:"$lightGrey",color:"$richBlack50",textTransform:"uppercase",fontSize:"$2",objectFit:"contain",lineHeight:"1em !important","&:last-child":{marginRight:"0"},[`${V6}`]:{position:"absolute",left:"$1",height:"$3",width:"$3"},variants:{isIcon:{true:{position:"relative",paddingLeft:"$5"}}}}),F0=xe("span",{background:"transparent",opacity:"0",border:"3px solid transparent",position:"absolute",width:"100%",height:"100%",zIndex:"0",left:"0",top:"0",transition:"$all"}),uM=xe("span",{display:"flex"}),mhe=xe("span",{display:"flex",width:"1.2111rem",height:"0.7222rem"}),ghe=xe("span",{display:"inline-flex",marginLeft:"5px",marginBottom:"-1px"}),B0=xe("div",{position:"relative",display:"flex",backgroundColor:"$secondaryAlt",width:"inherit",height:"100px",overflow:"hidden",borderRadius:"3px",".media-thumbnail-lazyload":{width:"100%",height:"100%",borderRadius:"3px"},img:{width:"100%",height:"100%",objectFit:"cover",objectPosition:"top center",filter:"blur(0)",transform:"scale3d(1, 1, 1)",borderRadius:"3px",transition:"$all",color:"transparent"},[`& ${uM}`]:{position:"absolute",right:"0",bottom:"0",[`& ${M0}`]:{display:"none",margin:"0",paddingLeft:"0",fontSize:"0.7222rem",backgroundColor:"#000d",color:"$secondary",fill:"$secondary",borderBottomLeftRadius:"0",borderTopRightRadius:"0"}}}),CT=xe(Kk,{display:"flex",flexShrink:"0",padding:"0",cursor:"pointer",background:"none",border:"none",fontFamily:"inherit",lineHeight:"1.25em",fontSize:"1rem",textAlign:"left",figure:{margin:"0",width:"161.8px",figcaption:{marginTop:"0.5rem",fontWeight:"400",fontSize:"0.8333rem",display:"-webkit-box",overflow:"hidden",MozBoxOrient:"vertical",WebkitBoxOrient:"vertical",WebkitLineClamp:"5","@sm":{fontSize:"0.8333rem"}}}}),yhe=xe(qk,{display:"flex",flexDirection:"row",flexGrow:"1",overflowX:"scroll",position:"relative",zIndex:"0",gap:"1rem",padding:"1.618rem 0"}),vhe=xe("div",{display:"flex",flexDirection:"row","&[data-active='true']":{[`& ${CT}`]:{figcaption:{fontWeight:"700"},[`& ${M0}`]:{backgroundColor:"$accent"},[`& ${F0}`]:{background:"#0003",opacity:"1",borderBottom:"3px solid $accent"},"&:first-of-type":{[`& ${F0}`]:{borderRight:"unset"}},"&:last-of-type":{[`& ${F0}`]:{borderLeft:"unset"}}}},[`& ${CT}`]:{[`& ${B0}`]:{borderRadius:"unset"},"&:first-of-type":{[`& ${B0}`]:{borderTopLeftRadius:"3px",borderBottomLeftRadius:"3px"}},"&:last-of-type":{[`& ${B0}`]:{borderTopRightRadius:"3px",borderBottomRightRadius:"3px"},[`& ${M0}`]:{display:"flex"}}}}),cM=xe("div",{position:"absolute",right:"1rem",top:"1rem",display:"flex",justifyContent:"flex-end",zIndex:"1"}),bhe=xe("input",{flexGrow:"1",border:"none",backgroundColor:"$secondaryMuted",color:"$primary",marginRight:"1rem",height:"2rem",padding:"0 1rem",borderRadius:"2rem",fontFamily:"inherit",fontSize:"1rem",lineHeight:"1rem",boxShadow:"inset 1px 1px 2px #0001","&::placeholder":{color:"$primaryMuted"}}),Rd=xe("button",{display:"flex",background:"none",border:"none",width:"2rem !important",height:"2rem !important",padding:"0",margin:"0",fontWeight:"700",borderRadius:"2rem",backgroundColor:"$accent",color:"$secondary",cursor:"pointer",boxSizing:"content-box !important",transition:"$all",svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",opacity:"1",filter:"drop-shadow(5px 5px 5px #000D)",boxSizing:"inherit",transition:"$all"},"&:disabled":{backgroundColor:"transparent",boxShadow:"none",svg:{opacity:"0.25"}}}),Ehe=xe("div",{display:"flex",marginRight:"0.618rem",backgroundColor:"$accentAlt",borderRadius:"2rem",boxShadow:"5px 5px 5px #0003",color:"$secondary",alignItems:"center","> span":{display:"flex",margin:"0 0.5rem",fontSize:"0.7222rem",fontWeight:"bold",gap:"0.25rem",em:{opacity:"0.25"}}}),The=xe("div",{display:"flex",position:"relative",zIndex:"1",width:"100%",padding:"0",transition:"$all",variants:{isToggle:{true:{paddingTop:"2.618rem",[`& ${cM}`]:{width:"calc(100% - 2rem)","@sm":{width:"calc(100% - 2rem)"}}}}}}),She=(t,e)=>{me(()=>{function n(i){i.key===t&&e()}return window.addEventListener("keyup",n),()=>window.removeEventListener("keyup",n)},[])},dM=({title:t})=>k("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},k("title",null,t),k("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M244 400L100 256l144-144M120 256h292"})),fM=({title:t})=>k("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},k("title",null,t),k("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M268 112l144 144-144 144M392 256H100"})),xhe=({title:t})=>k("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},k("title",null,t),k("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),whe=({title:t})=>k("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},k("title",null,t),k("path",{d:"M456.69 421.39L362.6 327.3a173.81 173.81 0 0034.84-104.58C397.44 126.38 319.06 48 222.72 48S48 126.38 48 222.72s78.38 174.72 174.72 174.72A173.81 173.81 0 00327.3 362.6l94.09 94.09a25 25 0 0035.3-35.3zM97.92 222.72a124.8 124.8 0 11124.8 124.8 124.95 124.95 0 01-124.8-124.8z"})),_he=({handleCanvasToggle:t,handleFilter:e,activeIndex:n,canvasLength:i,isRtlPaged:r=!1})=>{const[s,o]=Se(!1),[a,l]=Se(!1),[u,c]=Se(!1),{t:d}=fr();me(()=>{c(n===0),n===i-1?l(!0):l(!1)},[n,i]),She("Escape",()=>{o(!1),e("")});const f=()=>{o(p=>!p),e("")};return k(The,{isToggle:s,className:"clover-viewer-media-controls"},k(cM,null,s&&k(bhe,{autoFocus:!0,onChange:p=>e(p.target.value),placeholder:d("commonSearchPlaceholder")}),!s&&k(Ehe,{className:"clover-viewer-media-navigation","data-rtl-paged":r},r?k(Be,null,k(Rd,{onClick:()=>t(1),disabled:a,type:"button"},k(dM,{title:d("commonNext")})),k("span",null,n+1," ",k("em",null,"/")," ",i),k(Rd,{onClick:()=>t(-1),disabled:u,type:"button"},k(fM,{title:d("commonPrevious")}))):k(Be,null,k(Rd,{onClick:()=>t(-1),disabled:u,type:"button"},k(dM,{title:d("commonPrevious")})),k("span",null,n+1," ",k("em",null,"/")," ",i),k(Rd,{onClick:()=>t(1),disabled:a,type:"button"},k(fM,{title:d("commonNext")})))),k(Rd,{onClick:f,type:"button",className:"clover-viewer-media-search"},s?k(xhe,{title:d("commonClose")}):k(whe,{title:d("commonSearch")}))))},Ahe=({children:t,rootMargin:e="100px",attributes:n={},isVisibleCallback:i=()=>{}})=>{const r=Le(null),[s,o]=Se(!1);return me(()=>{const a=r.current;if(!a)return;const l=new IntersectionObserver(([u])=>{u.isIntersecting&&(i(!0),o(!0),l.disconnect())},{rootMargin:e});return l.observe(a),()=>l.disconnect()},[r]),k("div",{ref:r,...n},s?t:null)},Che=({type:t})=>{switch(t){case"Sound":return k(Nn.Audio,null);case"Image":return k(Nn.Image,null);case"Video":return k(Nn.Video,null);default:return k(Nn.Image,null)}},Ihe=({canvas:t,canvasIndex:e,isActive:n,type:i,handleChange:r})=>{const[s,o]=Se(!1),[a,l]=Se(),u=Nt(),{vault:c}=u,d=200,f=t!=null&&t.label?ui(t==null?void 0:t.label):String(e+1);me(()=>{s&&(async()=>{var p,m;try{if(((p=t==null?void 0:t.thumbnail)==null?void 0:p.length)!==0)l((m=t==null?void 0:t.thumbnail[0])==null?void 0:m.id);else{const{best:y}=await e5(t,{vault:c,dereference:!0,width:d,height:d});l(y==null?void 0:y.id)}}catch(y){console.error("Error fetching thumbnail",y)}})()},[t,s]);const h=p=>{o(p)};return k(CT,{"aria-checked":n,"data-testid":"media-thumbnail","data-canvas":e,onClick:()=>r(t.id),value:t.id},k("figure",null,k(B0,null,k(Ahe,{isVisibleCallback:h,attributes:{className:"media-thumbnail-lazyload","data-lazyload":String(s),"data-testid":"media-thumbnail-lazyload"}},a&&k("img",{alt:f,"data-testid":"media-thumbnail-image",src:a})),k(F0,null),k(uM,null,k(M0,{isIcon:!0,"data-testid":"thumbnail-tag"},k(mhe,null),k(Nn,{"aria-label":i},k(Che,{type:i})),["Video","Sound"].includes(i)&&k(ghe,null,Bw(t.duration))))),k("figcaption",{"data-testid":"fig-caption"},t.label?k(ps,{label:t.label}):(e+1).toString())))},Rhe=t=>t.body?t.body.type:"Image",Lhe=({items:t})=>{const{t:e}=fr(),n=jn(),i=Nt(),{activeCanvas:r,isPaged:s,vault:o,sequence:a,viewingDirection:l}=i,u=s&&l==="right-to-left",[c,d]=Se(""),[f,h]=Se([]),[p,m]=Se(0),y=lt.useRef(null),g="painting",v=S=>{r!==S&&n({type:"updateActiveCanvas",canvasId:S})};return me(()=>{if(!f.length){const S=["Image","Sound","Video"],_=t.map(A=>$C(o,A,g,S)).filter(A=>A.annotations.length>0);h(_)}},[t,f.length,o]),me(()=>{f.forEach((S,_)=>{S!=null&&S.canvas&&S.canvas.id===r&&m(_)})},[r,f]),me(()=>{const S=document.querySelector(`[data-canvas="${p}"]`);if(S instanceof HTMLElement&&y.current){const _=S.offsetLeft-y.current.offsetWidth/2+S.offsetWidth/2;y.current.scrollTo({left:_,behavior:"smooth"})}},[p]),k(Be,null,k(_he,{handleFilter:S=>d(S),handleCanvasToggle:S=>{const _=a[1].findIndex(x=>x.includes(p)),A=_+S>=0?_+S:a[1].length-1;if(!a[1][A])return;const P=a[1][A][0],O=a[0][P].id;O&&v(O)},activeIndex:p,canvasLength:t.length,isRtlPaged:u}),k(yhe,{"aria-label":e("media.selectItem"),"data-testid":"media","data-active-canvas":t[p].id,"data-canvas-length":t.length,"data-filter":c,"data-rtl-paged":u,ref:y,style:{direction:u?"rtl":"ltr"}},a[1].filter(S=>S.some(_=>{var x;const A=a[0][_].id,P=f.find(L=>{var M;return((M=L==null?void 0:L.canvas)==null?void 0:M.id)===A});if(!P)return!1;const O=ui((x=P==null?void 0:P.canvas)==null?void 0:x.label)||"";return!(c&&!O.toLowerCase().includes(c.toLowerCase()))})).map((S,_)=>{const A=S.map(P=>a[0][P].id).includes(r);return k(vhe,{"data-active":A,key:_},S.map(P=>{var L,M;const O=a[0][P].id,x=f.find(V=>{var K;return((K=V==null?void 0:V.canvas)==null?void 0:K.id)===O});return x?k(Ihe,{canvas:x.canvas,canvasIndex:f.findIndex(V=>V===x),handleChange:v,isActive:r===((L=x==null?void 0:x.canvas)==null?void 0:L.id),key:(M=x==null?void 0:x.canvas)==null?void 0:M.id,type:Rhe(x.annotations[0])}):null}))})))},hM=xe("button",{position:"absolute",background:"none",border:"none",cursor:"zoom-in",margin:"0",padding:"0",width:"100%",height:"100%",transition:"$all",opacity:1,display:"flex",alignItems:"center",justifyContent:"center",img:{width:"100%",height:"100%",objectFit:"contain",color:"transparent",aspectRatio:"auto"},"&[data-paged=true]":{"img:first-child ":{objectPosition:"100% 50%"},"img:last-child":{objectPosition:"0 50%"}},"&[data-active=false]":{opacity:0,objectPosition:"50% 50%"},variants:{isMedia:{true:{cursor:"pointer"}}}}),pM=xe(Kw,{position:"absolute",width:"2rem",top:"1rem",right:"1rem",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",transition:"$all",borderRadius:"50%",backgroundColor:"$accent",cursor:"pointer","&:hover, &:focus":{backgroundColor:"$accent !important"},variants:{isInteractive:{true:{"&:hover":{opacity:"1"}},false:{}},isMedia:{true:{cursor:"pointer !important"}}},compoundVariants:[{isInteractive:!1,isMedia:!0,css:{top:"50%",right:"50%",width:"4rem",height:"4rem",transform:"translate(50%,-50%)"}}]}),Phe=xe("div",{position:"relative",display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"1",gap:"1rem",zIndex:"0",overflow:"hidden","&:hover":{[`${pM}`]:{backgroundColor:"$accent"},[`${hM}`]:{backgroundColor:"#6662"}}}),khe=xe("div",{width:"100%",height:"100%"});function mM(t,[e,n]){return Math.min(n,Math.max(e,t))}var gM=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),Dhe="VisuallyHidden",Ohe=Re((t,e)=>ue(ut.span,{...t,ref:e,style:{...gM,...t.style}}));Ohe.displayName=Dhe;var Nhe=[" ","Enter","ArrowUp","ArrowDown"],Mhe=[" ","Enter"],va="Select",[U0,H0,Fhe]=GC(va),[au]=hr(va,[Fhe,C0]),$0=C0(),[Bhe,yo]=au(va),[Uhe,Hhe]=au(va),yM=t=>{const{__scopeSelect:e,children:n,open:i,defaultOpen:r,onOpenChange:s,value:o,defaultValue:a,onValueChange:l,dir:u,name:c,autoComplete:d,disabled:f,required:h,form:p}=t,m=$0(e),[y,g]=Se(null),[v,b]=Se(null),[T,S]=Se(!1),_=fh(u),[A,P]=Rs({prop:i,defaultProp:r??!1,onChange:s,caller:va}),[O,x]=Rs({prop:o,defaultProp:a,onChange:l,caller:va}),L=Le(null),M=y?p||!!y.closest("form"):!0,[V,K]=Se(new Set),U=Array.from(V).map(j=>j.props.value).join(";");return ue(D4,{...m,children:ue(Bhe,{required:h,scope:e,trigger:y,onTriggerChange:g,valueNode:v,onValueNodeChange:b,valueNodeHasChildren:T,onValueNodeHasChildrenChange:S,contentId:qo(),value:O,onValueChange:x,open:A,onOpenChange:P,dir:_,triggerPointerDownPosRef:L,disabled:f,children:[ue(U0.Provider,{scope:e,children:ue(Uhe,{scope:t.__scopeSelect,onNativeOptionAdd:Ge(j=>{K(G=>new Set(G).add(j))},[]),onNativeOptionRemove:Ge(j=>{K(G=>{const H=new Set(G);return H.delete(j),H})},[]),children:n})}),M?ue($M,{"aria-hidden":!0,required:h,tabIndex:-1,name:c,autoComplete:d,value:O,onChange:j=>x(j.target.value),disabled:f,form:p,children:[O===void 0?ue("option",{value:""}):null,Array.from(V)]},U):null]})})};yM.displayName=va;var vM="SelectTrigger",bM=Re((t,e)=>{const{__scopeSelect:n,disabled:i=!1,...r}=t,s=$0(n),o=yo(vM,n),a=o.disabled||i,l=At(e,o.onTriggerChange),u=H0(n),c=Le("touch"),[d,f,h]=VM(m=>{const y=u().filter(b=>!b.disabled),g=y.find(b=>b.value===o.value),v=GM(y,m,g);v!==void 0&&o.onValueChange(v.value)}),p=m=>{a||(o.onOpenChange(!0),h()),m&&(o.triggerPointerDownPosRef.current={x:Math.round(m.pageX),y:Math.round(m.pageY)})};return ue(ET,{asChild:!0,...s,children:ue(ut.button,{type:"button",role:"combobox","aria-controls":o.contentId,"aria-expanded":o.open,"aria-required":o.required,"aria-autocomplete":"none",dir:o.dir,"data-state":o.open?"open":"closed",disabled:a,"data-disabled":a?"":void 0,"data-placeholder":zM(o.value)?"":void 0,...r,ref:l,onClick:st(r.onClick,m=>{m.currentTarget.focus(),c.current!=="mouse"&&p(m)}),onPointerDown:st(r.onPointerDown,m=>{c.current=m.pointerType;const y=m.target;y.hasPointerCapture(m.pointerId)&&y.releasePointerCapture(m.pointerId),m.button===0&&m.ctrlKey===!1&&m.pointerType==="mouse"&&(p(m),m.preventDefault())}),onKeyDown:st(r.onKeyDown,m=>{const y=d.current!=="";!(m.ctrlKey||m.altKey||m.metaKey)&&m.key.length===1&&f(m.key),!(y&&m.key===" ")&&Nhe.includes(m.key)&&(p(),m.preventDefault())})})})});bM.displayName=vM;var EM="SelectValue",TM=Re((t,e)=>{const{__scopeSelect:n,className:i,style:r,children:s,placeholder:o="",...a}=t,l=yo(EM,n),{onValueNodeHasChildrenChange:u}=l,c=s!==void 0,d=At(e,l.onValueNodeChange);return xn(()=>{u(c)},[u,c]),ue(ut.span,{...a,ref:d,style:{pointerEvents:"none"},children:zM(l.value)?ue(Be,{children:o}):s})});TM.displayName=EM;var $he="SelectIcon",SM=Re((t,e)=>{const{__scopeSelect:n,children:i,...r}=t;return ue(ut.span,{"aria-hidden":!0,...r,ref:e,children:i||""})});SM.displayName=$he;var zhe="SelectPortal",xM=t=>ue(M4,{asChild:!0,...t});xM.displayName=zhe;var ba="SelectContent",wM=Re((t,e)=>{const n=yo(ba,t.__scopeSelect),[i,r]=Se();if(xn(()=>{r(new DocumentFragment)},[]),!n.open){const s=i;return s?yc.createPortal(ue(_M,{scope:t.__scopeSelect,children:ue(U0.Slot,{scope:t.__scopeSelect,children:ue("div",{children:t.children})})}),s):null}return ue(AM,{...t,ref:e})});wM.displayName=ba;var ar=10,[_M,vo]=au(ba),Vhe="SelectContentImpl",Ghe=vc("SelectContent.RemoveScroll"),AM=Re((t,e)=>{const{__scopeSelect:n,position:i="item-aligned",onCloseAutoFocus:r,onEscapeKeyDown:s,onPointerDownOutside:o,side:a,sideOffset:l,align:u,alignOffset:c,arrowPadding:d,collisionBoundary:f,collisionPadding:h,sticky:p,hideWhenDetached:m,avoidCollisions:y,...g}=t,v=yo(ba,n),[b,T]=Se(null),[S,_]=Se(null),A=At(e,re=>T(re)),[P,O]=Se(null),[x,L]=Se(null),M=H0(n),[V,K]=Se(!1),U=Le(!1);me(()=>{if(b)return B4(b)},[b]),K6();const j=Ge(re=>{const[Ae,...$e]=M().map(Ne=>Ne.ref.current),[Ie]=$e.slice(-1),Me=document.activeElement;for(const Ne of re)if(Ne===Me||(Ne==null||Ne.scrollIntoView({block:"nearest"}),Ne===Ae&&S&&(S.scrollTop=0),Ne===Ie&&S&&(S.scrollTop=S.scrollHeight),Ne==null||Ne.focus(),document.activeElement!==Me))return},[M,S]),G=Ge(()=>j([P,b]),[j,P,b]);me(()=>{V&&G()},[V,G]);const{onOpenChange:H,triggerPointerDownPosRef:Y}=v;me(()=>{if(b){let re={x:0,y:0};const Ae=Ie=>{var Me,Ne;re={x:Math.abs(Math.round(Ie.pageX)-(((Me=Y.current)==null?void 0:Me.x)??0)),y:Math.abs(Math.round(Ie.pageY)-(((Ne=Y.current)==null?void 0:Ne.y)??0))}},$e=Ie=>{re.x<=10&&re.y<=10?Ie.preventDefault():b.contains(Ie.target)||H(!1),document.removeEventListener("pointermove",Ae),Y.current=null};return Y.current!==null&&(document.addEventListener("pointermove",Ae),document.addEventListener("pointerup",$e,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Ae),document.removeEventListener("pointerup",$e,{capture:!0})}}},[b,H,Y]),me(()=>{const re=()=>H(!1);return window.addEventListener("blur",re),window.addEventListener("resize",re),()=>{window.removeEventListener("blur",re),window.removeEventListener("resize",re)}},[H]);const[D,ee]=VM(re=>{const Ae=M().filter(Me=>!Me.disabled),$e=Ae.find(Me=>Me.ref.current===document.activeElement),Ie=GM(Ae,re,$e);Ie&&setTimeout(()=>Ie.ref.current.focus())}),ne=Ge((re,Ae,$e)=>{const Ie=!U.current&&!$e;(v.value!==void 0&&v.value===Ae||Ie)&&(O(re),Ie&&(U.current=!0))},[v.value]),N=Ge(()=>b==null?void 0:b.focus(),[b]),le=Ge((re,Ae,$e)=>{const Ie=!U.current&&!$e;(v.value!==void 0&&v.value===Ae||Ie)&&L(re)},[v.value]),we=i==="popper"?IT:CM,ce=we===IT?{side:a,sideOffset:l,align:u,alignOffset:c,arrowPadding:d,collisionBoundary:f,collisionPadding:h,sticky:p,hideWhenDetached:m,avoidCollisions:y}:{};return ue(_M,{scope:n,content:b,viewport:S,onViewportChange:_,itemRefCallback:ne,selectedItem:P,onItemLeave:N,itemTextRefCallback:le,focusSelectedItem:G,selectedItemText:x,position:i,isPositioned:V,searchRef:D,children:ue(AT,{as:Ghe,allowPinchZoom:!0,children:ue(oT,{asChild:!0,trapped:v.open,onMountAutoFocus:re=>{re.preventDefault()},onUnmountAutoFocus:st(r,re=>{var Ae;(Ae=v.trigger)==null||Ae.focus({preventScroll:!0}),re.preventDefault()}),children:ue(nT,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:s,onPointerDownOutside:o,onFocusOutside:re=>re.preventDefault(),onDismiss:()=>v.onOpenChange(!1),children:ue(we,{role:"listbox",id:v.contentId,"data-state":v.open?"open":"closed",dir:v.dir,onContextMenu:re=>re.preventDefault(),...g,...ce,onPlaced:()=>K(!0),ref:A,style:{display:"flex",flexDirection:"column",outline:"none",...g.style},onKeyDown:st(g.onKeyDown,re=>{const Ae=re.ctrlKey||re.altKey||re.metaKey;if(re.key==="Tab"&&re.preventDefault(),!Ae&&re.key.length===1&&ee(re.key),["ArrowUp","ArrowDown","Home","End"].includes(re.key)){let Ie=M().filter(Me=>!Me.disabled).map(Me=>Me.ref.current);if(["ArrowUp","End"].includes(re.key)&&(Ie=Ie.slice().reverse()),["ArrowUp","ArrowDown"].includes(re.key)){const Me=re.target,Ne=Ie.indexOf(Me);Ie=Ie.slice(Ne+1)}setTimeout(()=>j(Ie)),re.preventDefault()}})})})})})})});AM.displayName=Vhe;var jhe="SelectItemAlignedPosition",CM=Re((t,e)=>{const{__scopeSelect:n,onPlaced:i,...r}=t,s=yo(ba,n),o=vo(ba,n),[a,l]=Se(null),[u,c]=Se(null),d=At(e,A=>c(A)),f=H0(n),h=Le(!1),p=Le(!0),{viewport:m,selectedItem:y,selectedItemText:g,focusSelectedItem:v}=o,b=Ge(()=>{if(s.trigger&&s.valueNode&&a&&u&&m&&y&&g){const A=s.trigger.getBoundingClientRect(),P=u.getBoundingClientRect(),O=s.valueNode.getBoundingClientRect(),x=g.getBoundingClientRect();if(s.dir!=="rtl"){const Me=x.left-P.left,Ne=O.left-Me,at=A.left-Ne,wt=A.width+at,Bt=Math.max(wt,P.width),We=window.innerWidth-ar,w=mM(Ne,[ar,Math.max(ar,We-Bt)]);a.style.minWidth=wt+"px",a.style.left=w+"px"}else{const Me=P.right-x.right,Ne=window.innerWidth-O.right-Me,at=window.innerWidth-A.right-Ne,wt=A.width+at,Bt=Math.max(wt,P.width),We=window.innerWidth-ar,w=mM(Ne,[ar,Math.max(ar,We-Bt)]);a.style.minWidth=wt+"px",a.style.right=w+"px"}const L=f(),M=window.innerHeight-ar*2,V=m.scrollHeight,K=window.getComputedStyle(u),U=parseInt(K.borderTopWidth,10),j=parseInt(K.paddingTop,10),G=parseInt(K.borderBottomWidth,10),H=parseInt(K.paddingBottom,10),Y=U+j+V+H+G,D=Math.min(y.offsetHeight*5,Y),ee=window.getComputedStyle(m),ne=parseInt(ee.paddingTop,10),N=parseInt(ee.paddingBottom,10),le=A.top+A.height/2-ar,we=M-le,ce=y.offsetHeight/2,re=y.offsetTop+ce,Ae=U+j+re,$e=Y-Ae;if(Ae<=le){const Me=L.length>0&&y===L[L.length-1].ref.current;a.style.bottom="0px";const Ne=u.clientHeight-m.offsetTop-m.offsetHeight,at=Math.max(we,ce+(Me?N:0)+Ne+G),wt=Ae+at;a.style.height=wt+"px"}else{const Me=L.length>0&&y===L[0].ref.current;a.style.top="0px";const at=Math.max(le,U+m.offsetTop+(Me?ne:0)+ce)+$e;a.style.height=at+"px",m.scrollTop=Ae-le+m.offsetTop}a.style.margin=`${ar}px 0`,a.style.minHeight=D+"px",a.style.maxHeight=M+"px",i==null||i(),requestAnimationFrame(()=>h.current=!0)}},[f,s.trigger,s.valueNode,a,u,m,y,g,s.dir,i]);xn(()=>b(),[b]);const[T,S]=Se();xn(()=>{u&&S(window.getComputedStyle(u).zIndex)},[u]);const _=Ge(A=>{A&&p.current===!0&&(b(),v==null||v(),p.current=!1)},[b,v]);return ue(qhe,{scope:n,contentWrapper:a,shouldExpandOnScrollRef:h,onScrollButtonChange:_,children:ue("div",{ref:l,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:T},children:ue(ut.div,{...r,ref:d,style:{boxSizing:"border-box",maxHeight:"100%",...r.style}})})})});CM.displayName=jhe;var Whe="SelectPopperPosition",IT=Re((t,e)=>{const{__scopeSelect:n,align:i="start",collisionPadding:r=ar,...s}=t,o=$0(n);return ue(O4,{...o,...s,ref:e,align:i,collisionPadding:r,style:{boxSizing:"border-box",...s.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});IT.displayName=Whe;var[qhe,RT]=au(ba,{}),LT="SelectViewport",IM=Re((t,e)=>{const{__scopeSelect:n,nonce:i,...r}=t,s=vo(LT,n),o=RT(LT,n),a=At(e,s.onViewportChange),l=Le(0);return ue(Be,{children:[ue("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:i}),ue(U0.Slot,{scope:n,children:ue(ut.div,{"data-radix-select-viewport":"",role:"presentation",...r,ref:a,style:{position:"relative",flex:1,overflow:"hidden auto",...r.style},onScroll:st(r.onScroll,u=>{const c=u.currentTarget,{contentWrapper:d,shouldExpandOnScrollRef:f}=o;if(f!=null&&f.current&&d){const h=Math.abs(l.current-c.scrollTop);if(h>0){const p=window.innerHeight-ar*2,m=parseFloat(d.style.minHeight),y=parseFloat(d.style.height),g=Math.max(m,y);if(g<p){const v=g+h,b=Math.min(p,v),T=v-b;d.style.height=b+"px",d.style.bottom==="0px"&&(c.scrollTop=T>0?T:0,d.style.justifyContent="flex-end")}}}l.current=c.scrollTop})})})]})});IM.displayName=LT;var RM="SelectGroup",[Khe,Yhe]=au(RM),LM=Re((t,e)=>{const{__scopeSelect:n,...i}=t,r=qo();return ue(Khe,{scope:n,id:r,children:ue(ut.div,{role:"group","aria-labelledby":r,...i,ref:e})})});LM.displayName=RM;var PM="SelectLabel",kM=Re((t,e)=>{const{__scopeSelect:n,...i}=t,r=Yhe(PM,n);return ue(ut.div,{id:r.id,...i,ref:e})});kM.displayName=PM;var z0="SelectItem",[Xhe,DM]=au(z0),OM=Re((t,e)=>{const{__scopeSelect:n,value:i,disabled:r=!1,textValue:s,...o}=t,a=yo(z0,n),l=vo(z0,n),u=a.value===i,[c,d]=Se(s??""),[f,h]=Se(!1),p=At(e,v=>{var b;return(b=l.itemRefCallback)==null?void 0:b.call(l,v,i,r)}),m=qo(),y=Le("touch"),g=()=>{r||(a.onValueChange(i),a.onOpenChange(!1))};if(i==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return ue(Xhe,{scope:n,value:i,disabled:r,textId:m,isSelected:u,onItemTextChange:Ge(v=>{d(b=>b||((v==null?void 0:v.textContent)??"").trim())},[]),children:ue(U0.ItemSlot,{scope:n,value:i,disabled:r,textValue:c,children:ue(ut.div,{role:"option","aria-labelledby":m,"data-highlighted":f?"":void 0,"aria-selected":u&&f,"data-state":u?"checked":"unchecked","aria-disabled":r||void 0,"data-disabled":r?"":void 0,tabIndex:r?void 0:-1,...o,ref:p,onFocus:st(o.onFocus,()=>h(!0)),onBlur:st(o.onBlur,()=>h(!1)),onClick:st(o.onClick,()=>{y.current!=="mouse"&&g()}),onPointerUp:st(o.onPointerUp,()=>{y.current==="mouse"&&g()}),onPointerDown:st(o.onPointerDown,v=>{y.current=v.pointerType}),onPointerMove:st(o.onPointerMove,v=>{var b;y.current=v.pointerType,r?(b=l.onItemLeave)==null||b.call(l):y.current==="mouse"&&v.currentTarget.focus({preventScroll:!0})}),onPointerLeave:st(o.onPointerLeave,v=>{var b;v.currentTarget===document.activeElement&&((b=l.onItemLeave)==null||b.call(l))}),onKeyDown:st(o.onKeyDown,v=>{var T;((T=l.searchRef)==null?void 0:T.current)!==""&&v.key===" "||(Mhe.includes(v.key)&&g(),v.key===" "&&v.preventDefault())})})})})});OM.displayName=z0;var Ld="SelectItemText",NM=Re((t,e)=>{const{__scopeSelect:n,className:i,style:r,...s}=t,o=yo(Ld,n),a=vo(Ld,n),l=DM(Ld,n),u=Hhe(Ld,n),[c,d]=Se(null),f=At(e,g=>d(g),l.onItemTextChange,g=>{var v;return(v=a.itemTextRefCallback)==null?void 0:v.call(a,g,l.value,l.disabled)}),h=c==null?void 0:c.textContent,p=en(()=>ue("option",{value:l.value,disabled:l.disabled,children:h},l.value),[l.disabled,l.value,h]),{onNativeOptionAdd:m,onNativeOptionRemove:y}=u;return xn(()=>(m(p),()=>y(p)),[m,y,p]),ue(Be,{children:[ue(ut.span,{id:l.textId,...s,ref:f}),l.isSelected&&o.valueNode&&!o.valueNodeHasChildren?yc.createPortal(s.children,o.valueNode):null]})});NM.displayName=Ld;var MM="SelectItemIndicator",FM=Re((t,e)=>{const{__scopeSelect:n,...i}=t;return DM(MM,n).isSelected?ue(ut.span,{"aria-hidden":!0,...i,ref:e}):null});FM.displayName=MM;var PT="SelectScrollUpButton",BM=Re((t,e)=>{const n=vo(PT,t.__scopeSelect),i=RT(PT,t.__scopeSelect),[r,s]=Se(!1),o=At(e,i.onScrollButtonChange);return xn(()=>{if(n.viewport&&n.isPositioned){let a=function(){const u=l.scrollTop>0;s(u)};const l=n.viewport;return a(),l.addEventListener("scroll",a),()=>l.removeEventListener("scroll",a)}},[n.viewport,n.isPositioned]),r?ue(HM,{...t,ref:o,onAutoScroll:()=>{const{viewport:a,selectedItem:l}=n;a&&l&&(a.scrollTop=a.scrollTop-l.offsetHeight)}}):null});BM.displayName=PT;var kT="SelectScrollDownButton",UM=Re((t,e)=>{const n=vo(kT,t.__scopeSelect),i=RT(kT,t.__scopeSelect),[r,s]=Se(!1),o=At(e,i.onScrollButtonChange);return xn(()=>{if(n.viewport&&n.isPositioned){let a=function(){const u=l.scrollHeight-l.clientHeight,c=Math.ceil(l.scrollTop)<u;s(c)};const l=n.viewport;return a(),l.addEventListener("scroll",a),()=>l.removeEventListener("scroll",a)}},[n.viewport,n.isPositioned]),r?ue(HM,{...t,ref:o,onAutoScroll:()=>{const{viewport:a,selectedItem:l}=n;a&&l&&(a.scrollTop=a.scrollTop+l.offsetHeight)}}):null});UM.displayName=kT;var HM=Re((t,e)=>{const{__scopeSelect:n,onAutoScroll:i,...r}=t,s=vo("SelectScrollButton",n),o=Le(null),a=H0(n),l=Ge(()=>{o.current!==null&&(window.clearInterval(o.current),o.current=null)},[]);return me(()=>()=>l(),[l]),xn(()=>{var c;const u=a().find(d=>d.ref.current===document.activeElement);(c=u==null?void 0:u.ref.current)==null||c.scrollIntoView({block:"nearest"})},[a]),ue(ut.div,{"aria-hidden":!0,...r,ref:e,style:{flexShrink:0,...r.style},onPointerDown:st(r.onPointerDown,()=>{o.current===null&&(o.current=window.setInterval(i,50))}),onPointerMove:st(r.onPointerMove,()=>{var u;(u=s.onItemLeave)==null||u.call(s),o.current===null&&(o.current=window.setInterval(i,50))}),onPointerLeave:st(r.onPointerLeave,()=>{l()})})}),Qhe="SelectSeparator",Zhe=Re((t,e)=>{const{__scopeSelect:n,...i}=t;return ue(ut.div,{"aria-hidden":!0,...i,ref:e})});Zhe.displayName=Qhe;var DT="SelectArrow",Jhe=Re((t,e)=>{const{__scopeSelect:n,...i}=t,r=$0(n),s=yo(DT,n),o=vo(DT,n);return s.open&&o.position==="popper"?ue(N4,{...r,...i,ref:e}):null});Jhe.displayName=DT;var epe="SelectBubbleInput",$M=Re(({__scopeSelect:t,value:e,...n},i)=>{const r=Le(null),s=At(i,r),o=Gv(e);return me(()=>{const a=r.current;if(!a)return;const l=window.HTMLSelectElement.prototype,c=Object.getOwnPropertyDescriptor(l,"value").set;if(o!==e&&c){const d=new Event("change",{bubbles:!0});c.call(a,e),a.dispatchEvent(d)}},[o,e]),ue(ut.select,{...n,style:{...gM,...n.style},ref:s,defaultValue:e})});$M.displayName=epe;function zM(t){return t===""||t===void 0}function VM(t){const e=Qs(t),n=Le(""),i=Le(0),r=Ge(o=>{const a=n.current+o;e(a),function l(u){n.current=u,window.clearTimeout(i.current),u!==""&&(i.current=window.setTimeout(()=>l(""),1e3))}(a)},[e]),s=Ge(()=>{n.current="",window.clearTimeout(i.current)},[]);return me(()=>()=>window.clearTimeout(i.current),[]),[n,r,s]}function GM(t,e,n){const r=e.length>1&&Array.from(e).every(u=>u===e[0])?e[0]:e,s=n?t.indexOf(n):-1;let o=tpe(t,Math.max(s,0));r.length===1&&(o=o.filter(u=>u!==n));const l=o.find(u=>u.textValue.toLowerCase().startsWith(r.toLowerCase()));return l!==n?l:void 0}function tpe(t,e){return t.map((n,i)=>t[(e+i)%t.length])}var npe=yM,ipe=bM,rpe=wM,spe=kM,ope=OM;const ape=xe("svg",{height:"19px",color:"$accent",fill:"$accent",stroke:"$accent",display:"flex",margin:"0.25rem 0.85rem"}),lpe=xe(ipe,{fontSize:"1.25rem",fontWeight:"400",fontFamily:"inherit",alignSelf:"flex-start",flexGrow:"1",cursor:"pointer",transition:"$all",border:"1px solid #6663",boxShadow:"2px 2px 5px #0001",borderRadius:"3px",display:"flex",alignItems:"center",paddingLeft:"0.5rem",width:"100%","@sm":{fontSize:"1rem"}}),upe=xe(rpe,{borderRadius:"3px",boxShadow:"3px 3px 8px #0003",backgroundColor:"$secondary",marginTop:"2.25rem",marginLeft:"6px",paddingBottom:"0.25rem",maxHeight:"calc(61.8vh - 2.5rem) !important",borderTopLeftRadius:"0",border:"1px solid $secondaryMuted",maxWidth:"90vw"}),cpe=xe(ope,{display:"flex",alignItems:"center",fontFamily:"inherit",padding:"0.25rem 0.5rem",color:"$primary",fontWeight:"400",fontSize:"0.8333rem",cursor:"pointer",backgroundColor:"$secondary",width:"calc(100% - 1rem)","> span":{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},'&[data-state="checked"]':{fontWeight:"700",color:"$primary !important"},"&:hover":{color:"$accent"},img:{width:"31px",height:"31px",marginRight:"0.5rem",borderRadius:"3px"}}),dpe=xe(spe,{color:"$primaryMuted",fontFamily:"inherit",fontSize:"0.85rem",padding:"0.5rem 1rem 0.5rem 0.5rem",display:"flex",alignItems:"center",marginBottom:"0.25rem",borderRadius:"3px",borderTopLeftRadius:"0",borderBottomLeftRadius:"0",borderBottomRightRadius:"0",backgroundColor:"$secondaryMuted"}),jM=xe(npe,{position:"relative",zIndex:"5",width:"100%"}),OT=({direction:t,title:e})=>k(ape,{xmlns:"http://www.w3.org/2000/svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},k("title",null,e),t==="up"&&k(()=>k("path",{d:"M414 321.94L274.22 158.82a24 24 0 00-36.44 0L98 321.94c-13.34 15.57-2.28 39.62 18.22 39.62h279.6c20.5 0 31.56-24.05 18.18-39.62z"}),null),t==="down"&&k(()=>k("path",{d:"M98 190.06l139.78 163.12a24 24 0 0036.44 0L414 190.06c13.34-15.57 2.28-39.62-18.22-39.62h-279.6c-20.5 0-31.56 24.05-18.18 39.62z"}),null)),WM=({children:t,label:e,maxHeight:n,onValueChange:i,value:r})=>k(jM,{onValueChange:i,value:r},k(lpe,{"data-testid":"select-button"},k(TM,{"data-testid":"select-button-value"}),k(SM,null,k(OT,{direction:"down",title:"select"}))),k(xM,null,k(upe,{css:{maxHeight:`${n} !important`},"data-testid":"select-content"},k(BM,null,k(OT,{direction:"up",title:"scroll up for more"})),k(IM,null,k(LM,null,e&&k(dpe,null,k(ps,{"data-testid":"select-label",label:e})),t)),k(UM,null,k(OT,{direction:"down",title:"scroll down for more"}))))),qM=t=>k(cpe,{...t},t.thumbnail&&k(k6,{thumbnail:t.thumbnail}),k(NM,null,k(ps,{label:t.label})),k(FM,null)),fpe=({isActive:t,isMedia:e,items:n,setIsInteractive:i})=>{const{vault:r}=Nt(),[s,o]=Se([]),a=s.length>1;if(me(()=>{o([]);const c=n.map(d=>{const f=Xs(r,d.id);if(!f)return null;const{id:h,width:p,height:m}=f[0];return h?{src:h,width:p||640,height:m||640,alt:d.label?p1(d.label):"placeholder image"}:null}).filter(d=>d!==null);c.length&&o(c)},[n,a]),!t||!s.length)return null;const l=s.map(c=>c.width/c.height*1),u=l.reduce((c,d)=>c+d,0);return k(hM,{onClick:()=>i(!0),isMedia:e,className:"clover-viewer-placeholder","data-active":t,"data-paged":a},s.map((c,d)=>{const f=l[d]/u*100;return k("img",{...c,key:d,alt:c.alt,style:{width:`${f}%`}})}))},hpe=xe("canvas",{position:"absolute",width:"100%",height:"100%",zIndex:"0"}),ppe=lt.forwardRef((t,e)=>{const n=lt.useRef(null),i=Ge(()=>{var h,p;if((h=e.current)!=null&&h.currentTime&&((p=e.current)==null?void 0:p.currentTime)>0)return;const s=e.current;if(!s)return;const o=new AudioContext,a=o.createMediaElementSource(s),l=o.createAnalyser(),u=n.current;if(!u)return;u.width=s.offsetWidth,u.height=s.offsetHeight;const c=u.getContext("2d");a.connect(l),l.connect(o.destination),l.fftSize=256;const d=l.frequencyBinCount,f=new Uint8Array(d);setInterval(function(){r(l,c,d,f,u.width,u.height)},20)},[e]);lt.useEffect(()=>{!e||!e.current||(e.current.onplay=i)},[i,e]);function r(s,o,a,l,u,c){const d=u/a*2.6;let f,h=0;s.getByteFrequencyData(l),o.fillStyle="#000000",o.fillRect(0,0,u,c);for(let p=0;p<a;p++)f=l[p]*2,o.fillStyle="rgba(78, 42, 132, 1)",o.fillRect(h,c-f,d,f),h+=d+6}return k(hpe,{ref:n,role:"presentation"})}),mpe=xe("div",{position:"relative",backgroundColor:"$primaryAlt",display:"flex",flexGrow:"0",flexShrink:"1",height:"100%",zIndex:"1",video:{backgroundColor:"transparent",objectFit:"contain",width:"100%",height:"100%",position:"relative",zIndex:"1"}}),gpe=({resource:t,ignoreCaptionLabels:e})=>{const n=p1(t.label,"en");return Array.isArray(n)&&n.some(r=>e.includes(r))?null:k("track",{key:t.id,src:t.id,label:Array.isArray(n)?n[0]:n,srcLang:"en","data-testid":"player-track"})},ype=["application/vnd.apple.mpegurl","vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"],vpe=({allSources:t,annotationResources:e,painting:n})=>{const[i,r]=lt.useState(0),[s,o]=lt.useState(),a=lt.useRef(null),l=(n==null?void 0:n.type)==="Sound",u=jn(),c=Nt(),{activeCanvas:d,configOptions:f,contentStateAnnotation:h,vault:p}=c;return me(()=>{if(!n.id||!a.current)return;if(a!=null&&a.current){const g=a.current;u({type:"updateActivePlayer",player:g}),g.src=n.id,g.load()}if(n.id.split(".").pop()!=="m3u8"&&n.format&&!ype.includes(n.format))return;const m={xhrSetup:function(g,v){g.withCredentials=!!f.withCredentials}},y=new Rn(m);return y.attachMedia(a.current),y.on(Rn.Events.MEDIA_ATTACHED,function(){y.loadSource(n.id)}),y.on(Rn.Events.ERROR,function(g,v){if(v.fatal)switch(v.type){case Rn.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${g} network error encountered, try to recover`),y.startLoad();break;case Rn.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${g} media error encountered, try to recover`),y.recoverMediaError();break;default:y.destroy();break}}),()=>{if(y&&a.current){const g=a.current;y.detachMedia(),y.destroy(),g.currentTime=0}}},[f.withCredentials,n.id,n.format,u]),me(()=>{var b,T,S,_;const m=p.get(d),y=(b=m.accompanyingCanvas)!=null&&b.id?Xs(p,(T=m.accompanyingCanvas)==null?void 0:T.id):null,g=(S=m.placeholderCanvas)!=null&&S.id?Xs(p,(_=m.placeholderCanvas)==null?void 0:_.id):null;!!(y&&g)?o(i===0?g[0].id:y[0].id):(y&&o(y[0].id),g&&o(g[0].id))},[d,i,p]),me(()=>{const m=a==null?void 0:a.current;if(!m)return;let y=null,g=!1;const v=()=>{g||(g=!0,y=setInterval(()=>{m&&!m.paused&&!m.ended&&(r(m.currentTime),u({type:"updateActiveSelector",selector:{type:"PointSelector",t:Math.round(m.currentTime)}}))},500)),m&&m.paused&&(r(m.currentTime),u({type:"updateActiveSelector",selector:{type:"PointSelector",t:Math.round(m.currentTime)}}))};return m.addEventListener("timeupdate",v),()=>{m==null||m.removeEventListener("timeupdate",v),y&&clearInterval(y)}},[n.id,d]),me(()=>{var m,y;if(h){const g=a==null?void 0:a.current;if(!g)return;const v=(m=h==null?void 0:h.target)==null?void 0:m.selector,{type:b,t:T,value:S}=v||{};if((((y=h==null?void 0:h.target)==null?void 0:y.source)||(h==null?void 0:h.target)).id!==d)return;if(T&&b==="PointSelector"&&(r(T),g.currentTime=T),b==="FragmentSelector"&&S){const A=S.split("=")[1];if(!A)return;const P=A.split(",")[0];r(P),g.currentTime=P}}},[a,h]),k(mpe,{css:{backgroundColor:f.canvasBackgroundColor,maxHeight:f.canvasHeight,position:"relative"},"data-testid":"player-wrapper",className:"clover-viewer-player-wrapper"},k("video",{id:"clover-iiif-video",key:n.id,ref:a,"data-src":n.id,controls:!0,height:n.height,width:n.width,crossOrigin:f.crossOrigin,poster:s,style:{maxHeight:f.canvasHeight,position:"relative",zIndex:"1"}},t.map(m=>k("source",{src:m.id,type:m.format,key:m.id})),(e==null?void 0:e.length)>0&&e.map(m=>{const y=[];return m.items.forEach(g=>{p.get(g.id).body.forEach(b=>{const T=p.get(b.id);y.push(T)})}),y.map(g=>k(gpe,{resource:g,ignoreCaptionLabels:f.ignoreCaptionLabels||[],key:g.id}))}),"Sorry, your browser doesn't support embedded videos."),l&&k(ppe,{ref:a}))},bpe=({label:t})=>k("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"close-svg-title",focusable:"false",viewBox:"0 0 512 512",role:"img"},k("title",{id:"close-svg-title"},t),k("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),Epe=({isMedia:t,label:e})=>k("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"open-svg-title",focusable:"false",viewBox:"0 0 512 512",role:"img"},k("title",{id:"open-svg-title"},e),t?k("path",{d:"M133 440a35.37 35.37 0 01-17.5-4.67c-12-6.8-19.46-20-19.46-34.33V111c0-14.37 7.46-27.53 19.46-34.33a35.13 35.13 0 0135.77.45l247.85 148.36a36 36 0 010 61l-247.89 148.4A35.5 35.5 0 01133 440z"}):k(Be,null,k("path",{d:"m456.69,421.39l-94.09-94.09c22.65-30.16,34.88-66.86,34.84-104.58,0-96.34-78.38-174.72-174.72-174.72S48,126.38,48,222.72s78.38,174.72,174.72,174.72c37.72.04,74.42-12.19,104.58-34.84l94.09,94.09c10.29,9.2,26.1,8.32,35.3-1.98,8.48-9.49,8.48-23.83,0-33.32Zm-233.97-73.87c-68.89-.08-124.72-55.91-124.8-124.8h0c0-68.93,55.87-124.8,124.8-124.8s124.8,55.87,124.8,124.8-55.87,124.8-124.8,124.8Z"}),k("path",{d:"m279.5,197.76h-3.35s-28.47,0-28.47,0v-31.82c-.77-13.79-12.57-24.33-26.36-23.56-12.71.71-22.85,10.86-23.56,23.56v3.35h0v28.47h-31.82c-13.79.77-24.33,12.57-23.56,26.36.71,12.71,10.86,22.85,23.56,23.56h3.35s28.47,0,28.47,0v31.82c.77,13.79,12.57,24.33,26.36,23.56,12.71-.71,22.85-10.86,23.56-23.56v-3.35h0v-28.47h31.82c13.79-.77,24.33-12.57,23.56-26.36-.71-12.71-10.86-22.85-23.56-23.56Z"}))),Tpe=({handleToggle:t,isInteractive:e,isMedia:n})=>{const{t:i}=fr();return k(pM,{onClick:t,isInteractive:e,isMedia:n,"data-testid":"placeholder-toggle"},e?k(bpe,{label:i("commonClose")}):k(Epe,{isMedia:n,label:i("commonOpen")}))},Spe=({activeCanvas:t,annotationResources:e,contentSearchResource:n,isMedia:i,painting:r})=>{var N,le,we,ce;const[s,o]=lt.useState(0),[a,l]=lt.useState(!1),[u,c]=lt.useState([]),[d,f]=lt.useState([]),[h,p]=lt.useState(0),{configOptions:m,customDisplays:y,contentStateAnnotation:g,informationPanelResource:v,isPaged:b,openSeadragonViewer:T,vault:S,viewerId:_,viewingDirection:A,visibleCanvases:P}=Nt(),O=b&&A==="right-to-left",[x,L]=lt.useState([]),M=!!g&&t===((le=(N=g==null?void 0:g.target)==null?void 0:N.source)==null?void 0:le.id),V=jn(),K=S.get(t),U=d.length&&!a&&!i,j=(r==null?void 0:r.length)>1,G=`${_}-${Hw(t+s+JSON.stringify(P)+h)}`,H=()=>{l(!a),p(re=>re+1)},Y=re=>{const Ae=r.findIndex($e=>$e.id===re);o(Ae)},D=y.find(re=>{var Me;let Ae=!1;const{canvasId:$e,paintingFormat:Ie}=re.target;if(Array.isArray($e)&&$e.length>0&&(Ae=$e.includes(t)),Array.isArray(Ie)&&Ie.length>0){const Ne=((Me=r[s])==null?void 0:Me.format)||"";Ae=!!(Ne&&Ie.includes(Ne))}return Ae});me(()=>{M&&U&&h===0&&H()},[M,U]),me(()=>{U&&(V({type:"updateOpenSeadragonViewer",openSeadragonViewer:void 0}),V({type:"updateActiveSelector",selector:void 0}))},[U]),me(()=>{var Ae,$e,Ie;const re=[];if(v==="manifest-annotations"&&(e==null||e.forEach((Me,Ne)=>{var at;(at=Me==null?void 0:Me.items)==null||at.forEach(wt=>{const Bt=S.get(wt.id);Bt&&re.push({annotation:{...Bt,body:Bt.body.map(We=>{const w=S.get(We.id);return w||We})},targetIndex:Ne})})}),g)){const Me=((Ae=g==null?void 0:g.target)==null?void 0:Ae.source)||(g==null?void 0:g.target);re.push({annotation:{...g,body:($e=g==null?void 0:g.body)==null?void 0:$e.map(Ne=>{const at=S.get(Ne.id);return at||Ne})},targetIndex:P.findIndex(Ne=>Ne.id===Me.id)})}v==="manifest-content-search"&&((Ie=n==null?void 0:n.items)==null||Ie.forEach(Me=>{const Ne=S.get(Me.id);if(Ne){const at=P.findIndex(wt=>wt.id===Ne.target.source.id);typeof at=="number"&&re.push({annotation:{...Ne,body:Ne.body.map(wt=>{const Bt=S.get(wt.id);return Bt||wt})},targetIndex:at})}})),L(re)},[e,n,g,v,P]),me(()=>{if(!i){const re=O?[...P].reverse():P,Ae=re.map(Ie=>{const Me=Ie.id,Ne=Xs(S,Me);return Ne?Ne[s]:void 0}).filter(Boolean),$e=re.map(Ie=>{var Bt;const Me=Ie.id,Ne=S.get(Me),at=(Bt=Ne==null?void 0:Ne.placeholderCanvas)==null?void 0:Bt.id;return!!!at||!at?null:{id:at,label:Ne==null?void 0:Ne.label}}).filter(Ie=>Ie!==null);c(Ae),f($e)}},[s,t,O,P,i,K]),me(()=>{o(0)},[P]);const ee=re=>{re&&!U&&(T==null?void 0:T.id)!==`openseadragon-${G}`&&V({type:"updateOpenSeadragonViewer",openSeadragonViewer:re})},ne=(we=D==null?void 0:D.display)==null?void 0:we.component;return k(Phe,{className:"clover-viewer-painting"},k(khe,{style:{backgroundColor:m.canvasBackgroundColor,height:m.canvasHeight==="auto"?"100%":m.canvasHeight}},!!d.length&&!i&&k(Tpe,{handleToggle:H,isInteractive:a,isMedia:i}),!!(d!=null&&d.length)&&!i&&k(fpe,{isActive:!!U,isMedia:i,items:d,setIsInteractive:l}),!U&&!D&&(i?k(vpe,{allSources:r,painting:r[s],annotationResources:e}):r&&k(A_,{_cloverViewerHasPlaceholder:!!(d!=null&&d.length),annotations:x,body:u,instanceId:G,key:G,openSeadragonCallback:ee,openSeadragonConfig:m.openSeadragon})),!U&&ne&&k(ne,{id:t,annotationBody:r[s],hooks:{useViewerDispatch:jn,useViewerState:Nt},...D==null?void 0:D.display.componentProps})),j&&k(WM,{value:(ce=r[s])==null?void 0:ce.id,onValueChange:Y,maxHeight:"200px"},r==null?void 0:r.map(re=>k(qM,{value:re==null?void 0:re.id,key:re==null?void 0:re.id,label:re==null?void 0:re.label}))))},xpe=({activeCanvas:t,annotationResources:e,searchServiceUrl:n,setContentSearchResource:i,contentSearchResource:r,isAudioVideo:s,items:o,painting:a})=>{var b,T;const{contentStateAnnotation:l,isInformationOpen:u,configOptions:c,sequence:d,visibleCanvases:f}=Nt(),{informationPanel:h}=c,p=f.map(S=>S.id),y=(e.length>0||p.includes((T=(b=l==null?void 0:l.target)==null?void 0:b.source)==null?void 0:T.id))&&(h==null?void 0:h.renderAnnotation)&&(h==null?void 0:h.renderToggle)===!1&&u,g=(h==null?void 0:h.renderAbout)&&u||y,v=h==null?void 0:h.renderToggle;return k(zC,{className:"clover-viewer-content","data-testid":"clover-viewer-content"},k(VC,{"data-aside-active":g,"data-aside-toggle":v},k(Spe,{activeCanvas:t,annotationResources:e,contentSearchResource:r,isMedia:s,painting:a}),d[1].length>1&&k(I$,{className:"clover-viewer-media-wrapper"},k(Lhe,{items:o,activeItem:0}))),g&&k(R$,{"data-aside-active":g,"data-aside-toggle":v},k(Tce,{activeCanvas:t,annotationResources:e,searchServiceUrl:n,setContentSearchResource:i,contentSearchResource:r})))},wpe=xe(ya.Trigger,{width:"30px",padding:"5px"}),KM=xe(ya.Content,{display:"flex",flexDirection:"column",fontSize:"0.8333rem",border:"none",boxShadow:"2px 2px 5px #0003",zIndex:"2",button:{display:"flex",textDecoration:"none",marginBottom:"0.5em",color:"$accentAlt",cursor:"pointer",background:"$secondary",border:"none","&:last-child":{marginBottom:"0"}}}),_pe=xe("span",{fontSize:"1.33rem",alignSelf:"flex-start",flexGrow:"0",flexShrink:"1",padding:"1rem","@sm":{fontSize:"1rem"},"&.visually-hidden":{position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",border:"0"}}),Ape=xe("header",{display:"flex",backgroundColor:"transparent !important",justifyContent:"space-between",alignItems:"flex-start",width:"100%",[`> ${jM}`]:{flexGrow:"1",flexShrink:"0"},form:{flexGrow:"0",flexShrink:"1"}}),Cpe=xe("div",{display:"flex",alignItems:"flex-end",justifyContent:"flex-end",padding:"1rem",flexShrink:"0",flexGrow:"1"}),Ipe=()=>{var l;const t=jn(),e=Nt(),{activeManifest:n,collection:i,configOptions:r,vault:s}=e,o=r==null?void 0:r.canvasHeight,a=u=>{t({type:"updateActiveCanvas",canvasId:void 0}),t({type:"updateActiveManifest",manifestId:u}),t({type:"updateViewerId",viewerId:Pa()})};return k("div",{style:{margin:"0.75rem"}},k(WM,{label:i.label,maxHeight:o,value:n,onValueChange:a},(l=i==null?void 0:i.items)==null?void 0:l.map(u=>k(qM,{value:u.id,key:u.id,thumbnail:u!=null&&u.thumbnail?s.get(u==null?void 0:u.thumbnail):void 0,label:u.label}))))},Rpe=(t,e=2500)=>{const{t:n}=fr(),[i,r]=Se(""),s=Ge(()=>{navigator.clipboard.writeText(t).then(()=>r(n("copySuccess")),()=>r(n("copyFailure")))},[n,t]);return me(()=>{if(!i)return;const o=setTimeout(()=>r(""),e);return()=>clearTimeout(o)},[i,e]),[i,s]},Lpe=xe("span",{display:"flex",alignContent:"center",alignItems:"center",padding:"0.125rem 0.25rem 0",marginTop:"-0.125rem",marginLeft:"0.5rem",backgroundColor:"$accent",color:"$secondary",borderRadius:"3px",lineHeight:"1em"}),Ppe=({status:t})=>t?k(Lpe,{"data-copy-status":t},t):null,YM=({textPrompt:t,textToCopy:e})=>{const[n,i]=Rpe(e);return k("button",{onClick:i},t," ",k(Ppe,{status:n}))},kpe=({title:t})=>{const e="#ed1d33",n="#2873ab";return k("svg",{viewBox:"0 0 493.35999 441.33334",id:"iiif-logo",version:"1.1"},k("title",null,t),k("g",{transform:"matrix(1.3333333,0,0,-1.3333333,0,441.33333)"},k("g",{transform:"scale(0.1)"},k("path",{style:{fill:n},d:"M 65.2422,2178.75 775.242,1915 773.992,15 65.2422,276.25 v 1902.5"}),k("path",{style:{fill:n},d:"m 804.145,2640.09 c 81.441,-240.91 -26.473,-436.2 -241.04,-436.2 -214.558,0 -454.511,195.29 -535.9527,436.2 -81.4335,240.89 26.4805,436.18 241.0387,436.18 214.567,0 454.512,-195.29 535.954,-436.18"}),k("path",{style:{fill:e},d:"M 1678.58,2178.75 968.578,1915 969.828,15 1678.58,276.25 v 1902.5"}),k("path",{style:{fill:e},d:"m 935.082,2640.09 c -81.437,-240.91 26.477,-436.2 241.038,-436.2 214.56,0 454.51,195.29 535.96,436.2 81.43,240.89 -26.48,436.18 -241.04,436.18 -214.57,0 -454.52,-195.29 -535.958,-436.18"}),k("path",{style:{fill:n},d:"m 1860.24,2178.75 710,-263.75 -1.25,-1900 -708.75,261.25 v 1902.5"}),k("path",{style:{fill:n},d:"m 2603.74,2640.09 c 81.45,-240.91 -26.47,-436.2 -241.03,-436.2 -214.58,0 -454.52,195.29 -535.96,436.2 -81.44,240.89 26.48,436.18 241.03,436.18 214.57,0 454.51,-195.29 535.96,-436.18"}),k("path",{style:{fill:e},d:"m 3700.24,3310 v -652.5 c 0,0 -230,90 -257.5,-142.5 -2.5,-247.5 0,-336.25 0,-336.25 l 257.5,83.75 V 1690 l -258.61,-92.5 V 262.5 L 2735.24,0 v 2360 c 0,0 -15,850 965,950"}))))};var V0="Switch",[Dpe]=hr(V0),[Ope,Npe]=Dpe(V0),XM=Re((t,e)=>{const{__scopeSwitch:n,name:i,checked:r,defaultChecked:s,required:o,disabled:a,value:l="on",onCheckedChange:u,form:c,...d}=t,[f,h]=Se(null),p=At(e,b=>h(b)),m=Le(!1),y=f?c||!!f.closest("form"):!0,[g,v]=Rs({prop:r,defaultProp:s??!1,onChange:u,caller:V0});return ue(Ope,{scope:n,checked:g,disabled:a,children:[ue(ut.button,{type:"button",role:"switch","aria-checked":g,"aria-required":o,"data-state":e8(g),"data-disabled":a?"":void 0,disabled:a,value:l,...d,ref:p,onClick:st(t.onClick,b=>{v(T=>!T),y&&(m.current=b.isPropagationStopped(),m.current||b.stopPropagation())})}),y&&ue(JM,{control:f,bubbles:!m.current,name:i,value:l,checked:g,required:o,disabled:a,form:c,style:{transform:"translateX(-100%)"}})]})});XM.displayName=V0;var QM="SwitchThumb",ZM=Re((t,e)=>{const{__scopeSwitch:n,...i}=t,r=Npe(QM,n);return ue(ut.span,{"data-state":e8(r.checked),"data-disabled":r.disabled?"":void 0,...i,ref:e})});ZM.displayName=QM;var Mpe="SwitchBubbleInput",JM=Re(({__scopeSwitch:t,control:e,checked:n,bubbles:i=!0,...r},s)=>{const o=Le(null),a=At(o,s),l=Gv(n),u=Vv(e);return me(()=>{const c=o.current;if(!c)return;const d=window.HTMLInputElement.prototype,h=Object.getOwnPropertyDescriptor(d,"checked").set;if(l!==n&&h){const p=new Event("click",{bubbles:i});h.call(c,n),c.dispatchEvent(p)}},[l,n,i]),ue("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...r,tabIndex:-1,ref:a,style:{...r.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});JM.displayName=Mpe;function e8(t){return t?"checked":"unchecked"}var Fpe=XM,Bpe=ZM;const Upe=xe(Fpe,{all:"unset",height:"2rem",width:"3.236rem",backgroundColor:"#6663",borderRadius:"9999px",position:"relative",WebkitTapHighlightColor:"transparent",cursor:"pointer","&:focus":{boxShadow:"0 0 0 2px $secondaryAlt"},'&[data-state="checked"]':{backgroundColor:"$accent",boxShadow:"inset 2px 2px 5px #0003"}}),Hpe=xe(Bpe,{display:"block",height:"calc(2rem - 12px)",width:"calc(2rem - 12px)",backgroundColor:"$secondary",borderRadius:"100%",boxShadow:"2px 2px 5px #0001",transition:"$all",transform:"translateX(6px)",willChange:"transform",span:{fontFamily:"monospace",fontSize:"0.8333rem",fontWeight:"700",display:"flex",height:"100%",width:"100%",alignItems:"center",justifyContent:"center",color:"$primary",opacity:"0.382",userSelect:"none",pointerEvents:"none"},'&[data-state="checked"]':{transform:"translateX(calc(1.236rem + 6px))",span:{opacity:"1",color:"$accent"}}});xe("label",{fontSize:"0.8333rem",fontWeight:"400",lineHeight:"1em",userSelect:"none",cursor:"pointer",paddingRight:"0.618rem"});const $pe=xe("form",{display:"flex",flexShrink:"0",flexGrow:"1",alignItems:"center",marginLeft:"1.618rem"}),zpe=()=>{const{isInformationOpen:t}=Nt(),e=jn(),{t:n}=fr();return k($pe,null,k(Upe,{checked:t,onCheckedChange:r=>{e({type:"updateInformationOpen",isInformationOpen:r})},id:"information-toggle","aria-label":n("informationPanelToggle"),name:"toggled?"},k(Hpe,null,k("span",null,"i"))))},Vpe=lt.memo(zpe),Gpe=xe(ya.Trigger,{width:"30px",padding:"5px",marginBottom:"auto"}),jpe=xe(KM,{h3:{color:"$primaryAlt",fontSize:"$2",fontWeight:"700",margin:"$2 0"},button:{},"& ul li":{marginBottom:"$1"}});function Wpe(t){const{vault:e}=Nt();try{const n=t&&e.get(t);if(!n)throw new Error(`Vault entity ${t} not found.`);return(n==null?void 0:n["@id"])||(n==null?void 0:n.id)}catch(n){return console.error(n),t}}function t8(t,e){const n=[];if(!t)return n;for(const i of t)if(i.id){const r=e.get(i.id);r&&n.push(r)}return n}function qpe(){const{activeCanvas:t,activeManifest:e,vault:n}=Nt(),[i,r]=Se({root:[],canvas:[]});return me(()=>{const s=n.get(e),o=n.get(t),a=s==null?void 0:s.rendering,l=o==null?void 0:o.rendering,u=t8(a,n),c=t8(l,n);r({root:u,canvas:c})},[t,e,n]),{...i}}function n8(t,e){return t.map(({format:n,id:i,label:r})=>{const s=Wpe(i);return{format:n,id:s,label:ui(r)||e}})}function Kpe(){const t=qpe(),e=n8((t==null?void 0:t.root)||[],"Root Rendering Label"),n=n8((t==null?void 0:t.canvas)||[],"Canvas Rendering Label");return{allPages:e,individualPages:n}}const Ype=()=>{const{allPages:t,individualPages:e}=Kpe(),n=t.length>0||e.length>0,i=r=>{window.open(r,"_blank")};return n?k(ya,null,k(Gpe,{"data-testid":"download-button"},k(Nn,null,k(Nn.Download,null))),k(jpe,{"data-testid":"download-content"},e.length>0&&k(Be,null,k("h3",null,"Individual Pages"),k("ul",null,e.map(({format:r,id:s,label:o})=>k("li",{key:o},k("button",{onClick:()=>i(s)},o," (",r,")"))))),t.length>0&&k(Be,null,k("h3",null,"All Pages"),k("ul",null,t.map(({format:r,id:s,label:o})=>k("li",{key:o},k("button",{onClick:()=>i(s)},o," (",r,")"))))))):null},Xpe=({manifestId:t,manifestLabel:e})=>{const n=Nt(),{collection:i,configOptions:r}=n,{informationPanel:s,showDownload:o,showIIIFBadge:a,showTitle:l}=r,u=o||a||(s==null?void 0:s.renderToggle),{t:c}=fr();return k(Ape,{className:"clover-viewer-header"},i!=null&&i.items?k(Ipe,null):k(_pe,{className:l?"":"visually-hidden"},l&&k(ps,{label:e,className:"label"})),u&&k(Cpe,null,o&&k(Ype,null),a&&k(ya,null,k(wpe,null,k(kpe,{title:c("commonShare")})),k(KM,null,(i==null?void 0:i.items)&&k("button",{onClick:d=>{d.preventDefault(),window.open(i.id,"_blank")}},c("shareCollectionJson")),k("button",{onClick:d=>{d.preventDefault(),window.open(t,"_blank")}},c("shareManifestJson"))," ",(i==null?void 0:i.items)&&k(YM,{textPrompt:c("shareCollectionCopy"),textToCopy:i.id}),k(YM,{textPrompt:c("shareManifestCopy"),textToCopy:t}))),(s==null?void 0:s.renderToggle)&&k(Vpe,null)))},Qpe=t=>{const e=()=>window.matchMedia?window.matchMedia(t).matches:!1,[n,i]=Se(e);return me(()=>{const r=()=>i(e);return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)}),n},Zpe=({manifest:t,theme:e,iiifContentSearchQuery:n})=>{var O;const i=Nt(),r=jn(),{activeCanvas:s,isInformationOpen:o,vault:a,configOptions:l,visibleCanvases:u}=i,c=["100%","auto"],d=(l==null?void 0:l.canvasHeight)&&c.includes(l==null?void 0:l.canvasHeight),[f,h]=Se(!1),[p,m]=Se([]),[y,g]=Se([]),[v,b]=Se(),T=Qpe(Mw.sm),[S,_]=Se(),A=Ge(x=>{r({type:"updateInformationOpen",isInformationOpen:x})},[r]);me(()=>{var x;(x=l==null?void 0:l.informationPanel)!=null&&x.open&&A(!T)},[T,(O=l==null?void 0:l.informationPanel)==null?void 0:O.open]),me(()=>{},[T]),me(()=>{const x=Xs(a,s);x&&(h(["Sound","Video"].indexOf(x[0].type)>-1),m(x));const L=F5(a,t,s);r({type:"updateVisibleCanvases",visibleCanvases:L})},[s,T,t,a,r]),me(()=>{(async()=>{const x=await Promise.all(u.map(L=>C$(a,L.id)));g(x.flat())})()},[u]);const P=t.service.some(x=>["SearchService1","SearchService2"].includes(x.type||x["@type"]));return me(()=>{if(P){const x=t.service.find(L=>["SearchService1","SearchService2"].includes(L.type||L["@type"]));x&&_(x.id||x["@id"])}},[t,P]),me(()=>{var x;S&&((x=l.informationPanel)==null?void 0:x.renderContentSearch)!==!1&&HC(a,S,n).then(L=>b(L))},[S]),k($m,{FallbackComponent:Wm},k(L$,{className:`${e} clover-viewer`,css:{background:l==null?void 0:l.background},"data-absolute-position":d,"data-information-panel-open":o},k(A$,{open:o,onOpenChange:A},k(Xpe,{manifestLabel:t.label,manifestId:t.id}),k(xpe,{activeCanvas:s,painting:p,annotationResources:y,searchServiceUrl:S,setContentSearchResource:b,contentSearchResource:v,items:t.items,isAudioVideo:f}))))},i8={ignoreCache:!1,headers:{Accept:"application/json, text/javascript, text/plain"},timeout:5e3,withCredentials:!1};function Jpe(t){return{ok:t.status>=200&&t.status<300,status:t.status,statusText:t.statusText,headers:t.getAllResponseHeaders(),data:t.responseText,json:()=>JSON.parse(t.responseText)}}function r8(t,e=null){return{ok:!1,status:t.status,statusText:t.statusText,headers:t.getAllResponseHeaders(),data:e||t.statusText,json:()=>JSON.parse(e||t.statusText)}}function e0e(t,e=i8){const n=e.headers||i8.headers;return new Promise((i,r)=>{const s=new XMLHttpRequest;s.open("get",t),s.withCredentials=e.withCredentials,n&&Object.keys(n).forEach(o=>s.setRequestHeader(o,n[o])),s.onload=()=>{i(Jpe(s))},s.onerror=()=>{r(r8(s,"Failed to make request."))},s.ontimeout=()=>{r(r8(s,"Request took longer than expected."))},s.send()})}const s8={"@context":"http://iiif.io/api/presentation/3/context.json",id:"https://example.org/iiif/content-state/specific-resource",type:"Annotation",motivation:["contentState"],target:{type:"SpecificResource",source:{id:"https://example.org/iiif/manifest/canvas/0",type:"Canvas",partOf:[{id:"https://example.org/iiif/manifest",type:"Manifest"}]}},body:[]},t0e=({canvasIdCallback:t,contentStateCallback:e,customDisplays:n=[],plugins:i=[],customTheme:r,iiifContent:s,id:o,manifestId:a,options:l,iiifContentSearchQuery:u})=>{var f,h,p;let c=s;o&&(c=o),a&&(c=a);const d=Gw((h=(f=l==null?void 0:l.informationPanel)==null?void 0:f.vtt)==null?void 0:h.autoScroll);return k(LU,{initialState:{...Xm,customDisplays:n,plugins:i,isAutoScrollEnabled:d.enabled,isInformationOpen:!!((p=l==null?void 0:l.informationPanel)!=null&&p.open),vault:new _w({customFetcher:m=>e0e(m,{withCredentials:l==null?void 0:l.withCredentials,headers:l==null?void 0:l.requestHeaders}).then(y=>JSON.parse(y.data))})}},k(n0e,{iiifContent:c,canvasIdCallback:t,contentStateCallback:e,customTheme:r,options:l,iiifContentSearchQuery:u}))},n0e=({canvasIdCallback:t,contentStateCallback:e,customTheme:n,iiifContent:i,options:r,iiifContentSearchQuery:s})=>{const o=jn(),a=Nt(),{activeCanvas:l,activeManifest:u,activeSelector:c,isLoaded:d,vault:f,visibleCanvases:h}=a,[p,m]=Se(),[y,g]=Se();let v={};if(n&&(v=mU("custom",n)),me(()=>{o({type:"updateActiveSelector",selector:void 0})},[l,u]),me(()=>{var b;if(t&&t(l),e&&u&&l){const T=((b=h[0])==null?void 0:b.id)||l,S=`${u}/state/${Hw(T+JSON.stringify(c))}`,_={...s8,id:S,target:{type:"SpecificResource",source:{id:T,type:"Canvas",partOf:[{id:u,type:"Manifest"}]},selector:c}};e({json:_,encoded:D5(JSON.stringify(_))})}},[l,u,c,t,e,h]),me(()=>{u&&(async()=>{try{const T=f.get(u);if(T)return T}catch{}return await f.load(u)})().then(T=>{if(!T)return;g(T);const S=Wx(f,T),_=l||OB(T);o({type:"updateActiveCanvas",canvasId:_}),o({type:"updateManifestSequence",sequence:S});const A=T.viewingDirection||"left-to-right",P=T.behavior||[],O=Array.isArray(P)?P.includes("paged"):P==="paged";o({type:"updateViewingDirection",viewingDirection:A}),o({type:"updateIsPaged",isPaged:O})}).catch(T=>{console.error(`Manifest failed to load: ${T}`)}).finally(()=>{o({type:"updateIsLoaded",isLoaded:!0})})},[i,u,o,f]),me(()=>{o({type:"updateConfigOptions",configOptions:r}),(async()=>{var S;if(!i)return;const T=DB(i);try{const _=typeof T=="object"&&(T!=null&&T.id)?await f.loadSync(T==null?void 0:T.id,T):await f.load(T);m(_)}catch(_){if((!T||!T.id)&&console.error(`Failed to load resource: ${_}`),T!=null&&T.id&&(T==null?void 0:T.type)==="Annotation"&&((S=T==null?void 0:T.motivation)!=null&&S.includes("contentState"))){const A=await f.loadSync(T.id,T);A&&m(A)}else T!=null&&T.id&&["Canvas","Manifest"].includes(T==null?void 0:T.type)&&await f.loadSync(T.id,T)&&m({...s8,target:T})}})()},[o,i,r,f]),me(()=>{if(p)switch(p.type){case"Annotation":if(p!=null&&p.motivation&&(Array.isArray(p==null?void 0:p.motivation)?p!=null&&p.motivation.includes("contentState"):(p==null?void 0:p.motivation)==="content-state")){const{active:T}=Aw(p);o({type:"updateActiveManifest",manifestId:T.manifest}),o({type:"updateActiveCanvas",canvasId:T.canvas}),o({type:"updateContentStateAnnotation",contentStateAnnotation:p})}break;case"Collection":const b=NB(p);o({type:"updateCollection",collection:p}),b&&o({type:"updateActiveManifest",manifestId:b});break;case"Manifest":o({type:"updateActiveManifest",manifestId:p.id});break}},[o,i,p]),!d)if(r!=null&&r.customLoadingComponent){const b=r.customLoadingComponent;return k(b,null)}else return k(Be,null,"Loading");return!y||!y.items?(console.log(`The IIIF manifest ${i} failed to load.`),k(Be,null)):y.items.length===0?(console.log(`The IIIF manifest ${i} does not contain canvases.`),k(Be,null)):k(Zpe,{manifest:y,theme:v,key:y.id,iiifContentSearchQuery:s})};function i0e(t){const e=Le(),{id:n}=t,i=t["iiif-content"];return Ii(()=>{t.__registerPublicApi&&t.__registerPublicApi(r=>{e.current=r})},[]),k(t0e,{id:n,iiifContent:i})}typeof window<"u"&&C_(i0e,"clover-viewer",["id","iiif-content"],{shadow:!1,onConstruct(t){t._props={__registerPublicApi:e=>{Object.assign(t,e(t))}}}})});
