"use client";"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const te=require("openseadragon");require("@iiif/parser/presentation-2");require("@iiif/helpers");const u=require("./react-shim.cjs"),Ve=require("@iiif/helpers/vault"),Te=require("react-i18next"),De=require("i18next-browser-languagedetector"),oe=require("i18next");let V=window.OpenSeadragon;if(!V&&(V=te,!V))throw new Error("OpenSeadragon is missing.");const pe="http://www.w3.org/2000/svg";V.Viewer&&(V.Viewer.prototype.svgOverlay=function(){return this._svgOverlayInfo?this._svgOverlayInfo:(this._svgOverlayInfo=new Ie(this),this._svgOverlayInfo)});const Ie=function(e){const t=this;this._viewer=e,this._containerWidth=0,this._containerHeight=0,this._svg=document.createElementNS(pe,"svg"),this._svg.style.position="absolute",this._svg.style.left=0,this._svg.style.top=0,this._svg.style.width="100%",this._svg.style.height="100%",this._viewer.canvas.appendChild(this._svg),this._node=document.createElementNS(pe,"g"),this._svg.appendChild(this._node),this._viewer.addHandler("animation",function(){t.resize()}),this._viewer.addHandler("open",function(){t.resize()}),this._viewer.addHandler("rotate",function(){t.resize()}),this._viewer.addHandler("flip",function(){t.resize()}),this._viewer.addHandler("resize",function(){t.resize()}),this.resize()};Ie.prototype={node:function(){return this._node},resize:function(){this._containerWidth!==this._viewer.container.clientWidth&&(this._containerWidth=this._viewer.container.clientWidth,this._svg.setAttribute("width",this._containerWidth)),this._containerHeight!==this._viewer.container.clientHeight&&(this._containerHeight=this._viewer.container.clientHeight,this._svg.setAttribute("height",this._containerHeight));const e=this._viewer.viewport.pixelFromPoint(new V.Point(0,0),!0),t=this._viewer.viewport.getZoom(!0),o=this._viewer.viewport.getRotation(),n=this._viewer.viewport.getFlip(),i=this._viewer.viewport._containerInnerSize.x;let r=i*t;const c=r;n&&(r=-r,e.x=-e.x+i),this._node.setAttribute("transform","translate("+e.x+","+e.y+") scale("+r+","+c+") rotate("+o+")")},onClick:function(e,t){new V.MouseTracker({element:e,clickHandler:t}).setTracking(!0)}};const He=e=>{var o,n,i,r,c;let t={id:typeof e=="string"?e:e.source};if(typeof e=="string"){if(e.includes("#xywh=")){const a=e.split("#xywh=");if(a&&a[1]){const[l,h,p,s]=a[1].split(",").map(d=>Number(d));t={id:a[0],rect:{x:l,y:h,w:p,h:s}}}}else if(e.includes("#t=")){const a=e.split("#t=");a&&a[1]&&(t={id:a[0],t:a[1]})}}else if(typeof e=="object"){if(((o=e.selector)==null?void 0:o.type)==="PointSelector")t={id:e.source,point:{x:e.selector.x,y:e.selector.y}};else if(((n=e.selector)==null?void 0:n.type)==="SvgSelector")t={id:e.source,svg:e.selector.value};else if(((i=e.selector)==null?void 0:i.type)==="FragmentSelector"&&(r=e.selector)!=null&&r.value.includes("xywh=")&&e.source.type=="Canvas"&&e.source.id){const a=(c=e.selector)==null?void 0:c.value.split("xywh=");if(a&&a[1]){const[l,h,p,s]=a[1].split(",").map(d=>Number(d));t={id:e.source.id,rect:{x:l,y:h,w:p,h:s}}}}}return t},_e=e=>fetch(`${e.replace(/\/$/,"")}/info.json`).then(t=>t.json()).then(t=>t).catch(t=>{console.error(`The IIIF tilesource ${e.replace(/\/$/,"")}/info.json failed to load: ${t}`)}),Ze=e=>{let t,o;if(Array.isArray(e)&&(t=e[0],t)){let n;"@id"in t?n=t["@id"]:n=t.id,o=n}return o};var z=(e=>(e.TiledImage="tiledImage",e.SimpleImage="simpleImage",e))(z||{});const Ue=e=>{const t=Array.isArray(e==null?void 0:e.service)&&(e==null?void 0:e.service.length)>0,o=t?Ze(e==null?void 0:e.service):e==null?void 0:e.id,n=t?z.TiledImage:z.SimpleImage;return{uri:o,imageType:n}},Je=(e,t)=>{const o=t?z.TiledImage:z.SimpleImage;return{uri:e,imageType:o}},Ke=u.createContext(null),ae={didCatch:!1,error:null};class qe extends u.Component{constructor(t){super(t),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=ae}static getDerivedStateFromError(t){return{didCatch:!0,error:t}}resetErrorBoundary(){const{error:t}=this.state;if(t!==null){for(var o,n,i=arguments.length,r=new Array(i),c=0;c<i;c++)r[c]=arguments[c];(o=(n=this.props).onReset)===null||o===void 0||o.call(n,{args:r,reason:"imperative-api"}),this.setState(ae)}}componentDidCatch(t,o){var n,i;(n=(i=this.props).onError)===null||n===void 0||n.call(i,t,o)}componentDidUpdate(t,o){const{didCatch:n}=this.state,{resetKeys:i}=this.props;if(n&&o.error!==null&&Ge(t.resetKeys,i)){var r,c;(r=(c=this.props).onReset)===null||r===void 0||r.call(c,{next:i,prev:t.resetKeys,reason:"keys"}),this.setState(ae)}}render(){const{children:t,fallbackRender:o,FallbackComponent:n,fallback:i}=this.props,{didCatch:r,error:c}=this.state;let a=t;if(r){const l={error:c,resetErrorBoundary:this.resetErrorBoundary};if(typeof o=="function")a=o(l);else if(n)a=u.createElement(n,l);else if(i!==void 0)a=i;else throw c}return u.createElement(Ke.Provider,{value:{didCatch:r,error:c,resetErrorBoundary:this.resetErrorBoundary}},a)}}function Ge(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e.length!==t.length||e.some((o,n)=>!Object.is(o,t[n]))}var k="colors",L="sizes",m="space",Xe={gap:m,gridGap:m,columnGap:m,gridColumnGap:m,rowGap:m,gridRowGap:m,inset:m,insetBlock:m,insetBlockEnd:m,insetBlockStart:m,insetInline:m,insetInlineEnd:m,insetInlineStart:m,margin:m,marginTop:m,marginRight:m,marginBottom:m,marginLeft:m,marginBlock:m,marginBlockEnd:m,marginBlockStart:m,marginInline:m,marginInlineEnd:m,marginInlineStart:m,padding:m,paddingTop:m,paddingRight:m,paddingBottom:m,paddingLeft:m,paddingBlock:m,paddingBlockEnd:m,paddingBlockStart:m,paddingInline:m,paddingInlineEnd:m,paddingInlineStart:m,top:m,right:m,bottom:m,left:m,scrollMargin:m,scrollMarginTop:m,scrollMarginRight:m,scrollMarginBottom:m,scrollMarginLeft:m,scrollMarginX:m,scrollMarginY:m,scrollMarginBlock:m,scrollMarginBlockEnd:m,scrollMarginBlockStart:m,scrollMarginInline:m,scrollMarginInlineEnd:m,scrollMarginInlineStart:m,scrollPadding:m,scrollPaddingTop:m,scrollPaddingRight:m,scrollPaddingBottom:m,scrollPaddingLeft:m,scrollPaddingX:m,scrollPaddingY:m,scrollPaddingBlock:m,scrollPaddingBlockEnd:m,scrollPaddingBlockStart:m,scrollPaddingInline:m,scrollPaddingInlineEnd:m,scrollPaddingInlineStart:m,fontSize:"fontSizes",background:k,backgroundColor:k,backgroundImage:k,borderImage:k,border:k,borderBlock:k,borderBlockEnd:k,borderBlockStart:k,borderBottom:k,borderBottomColor:k,borderColor:k,borderInline:k,borderInlineEnd:k,borderInlineStart:k,borderLeft:k,borderLeftColor:k,borderRight:k,borderRightColor:k,borderTop:k,borderTopColor:k,caretColor:k,color:k,columnRuleColor:k,fill:k,outline:k,outlineColor:k,stroke:k,textDecorationColor:k,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:L,minBlockSize:L,maxBlockSize:L,inlineSize:L,minInlineSize:L,maxInlineSize:L,width:L,minWidth:L,maxWidth:L,height:L,minHeight:L,maxHeight:L,flexBasis:L,gridTemplateColumns:L,gridTemplateRows:L,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},Ye=(e,t)=>typeof t=="function"?{"()":Function.prototype.toString.call(t)}:t,K=()=>{const e=Object.create(null);return(t,o,...n)=>{const i=(r=>JSON.stringify(r,Ye))(t);return i in e?e[i]:e[i]=o(t,...n)}},D=Symbol.for("sxs.internal"),he=(e,t)=>Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)),ge=e=>{for(const t in e)return!0;return!1},{hasOwnProperty:Qe}=Object.prototype,de=e=>e.includes("-")?e:e.replace(/[A-Z]/g,t=>"-"+t.toLowerCase()),et=/\s+(?![^()]*\))/,Z=e=>t=>e(...typeof t=="string"?String(t).split(et):[t]),fe={appearance:e=>({WebkitAppearance:e,appearance:e}),backfaceVisibility:e=>({WebkitBackfaceVisibility:e,backfaceVisibility:e}),backdropFilter:e=>({WebkitBackdropFilter:e,backdropFilter:e}),backgroundClip:e=>({WebkitBackgroundClip:e,backgroundClip:e}),boxDecorationBreak:e=>({WebkitBoxDecorationBreak:e,boxDecorationBreak:e}),clipPath:e=>({WebkitClipPath:e,clipPath:e}),content:e=>({content:e.includes('"')||e.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(e)?e:`"${e}"`}),hyphens:e=>({WebkitHyphens:e,hyphens:e}),maskImage:e=>({WebkitMaskImage:e,maskImage:e}),maskSize:e=>({WebkitMaskSize:e,maskSize:e}),tabSize:e=>({MozTabSize:e,tabSize:e}),textSizeAdjust:e=>({WebkitTextSizeAdjust:e,textSizeAdjust:e}),userSelect:e=>({WebkitUserSelect:e,userSelect:e}),marginBlock:Z((e,t)=>({marginBlockStart:e,marginBlockEnd:t||e})),marginInline:Z((e,t)=>({marginInlineStart:e,marginInlineEnd:t||e})),maxSize:Z((e,t)=>({maxBlockSize:e,maxInlineSize:t||e})),minSize:Z((e,t)=>({minBlockSize:e,minInlineSize:t||e})),paddingBlock:Z((e,t)=>({paddingBlockStart:e,paddingBlockEnd:t||e})),paddingInline:Z((e,t)=>({paddingInlineStart:e,paddingInlineEnd:t||e}))},ce=/([\d.]+)([^]*)/,tt=(e,t)=>e.length?e.reduce((o,n)=>(o.push(...t.map(i=>i.includes("&")?i.replace(/&/g,/[ +>|~]/.test(n)&&/&.*&/.test(i)?`:is(${n})`:n):n+" "+i)),o),[]):t,ot=(e,t)=>e in nt&&typeof t=="string"?t.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,(o,n,i,r)=>n+(i==="stretch"?`-moz-available${r};${de(e)}:${n}-webkit-fill-available`:`-moz-fit-content${r};${de(e)}:${n}fit-content`)+r):String(t),nt={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},N=e=>e?e+"-":"",Ee=(e,t,o)=>e.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,(n,i,r,c,a)=>c=="$"==!!r?n:(i||c=="--"?"calc(":"")+"var(--"+(c==="$"?N(t)+(a.includes("$")?"":N(o))+a.replace(/\$/g,"-"):a)+")"+(i||c=="--"?"*"+(i||"")+(r||"1")+")":"")),rt=/\s*,\s*(?![^()]*\))/,it=Object.prototype.toString,J=(e,t,o,n,i)=>{let r,c,a;const l=(h,p,s)=>{let d,g;const S=x=>{for(d in x){const $=d.charCodeAt(0)===64,_=$&&Array.isArray(x[d])?x[d]:[x[d]];for(g of _){const B=/[A-Z]/.test(b=d)?b:b.replace(/-[^]/g,y=>y[1].toUpperCase()),I=typeof g=="object"&&g&&g.toString===it&&(!n.utils[B]||!p.length);if(B in n.utils&&!I){const y=n.utils[B];if(y!==c){c=y,S(y(g)),c=null;continue}}else if(B in fe){const y=fe[B];if(y!==a){a=y,S(y(g)),a=null;continue}}if($&&(C=d.slice(1)in n.media?"@media "+n.media[d.slice(1)]:d,d=C.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,(y,v,P,f,w,T)=>{const M=ce.test(v),O=.0625*(M?-1:1),[F,q]=M?[f,v]:[v,f];return"("+(P[0]==="="?"":P[0]===">"===M?"max-":"min-")+F+":"+(P[0]!=="="&&P.length===1?q.replace(ce,(re,G,X)=>Number(G)+O*(P===">"?1:-1)+X):q)+(w?") and ("+(w[0]===">"?"min-":"max-")+F+":"+(w.length===1?T.replace(ce,(re,G,X)=>Number(G)+O*(w===">"?-1:1)+X):T):"")+")"})),I){const y=$?s.concat(d):[...s],v=$?[...p]:tt(p,d.split(rt));r!==void 0&&i(be(...r)),r=void 0,l(g,v,y)}else r===void 0&&(r=[[],p,s]),d=$||d.charCodeAt(0)!==36?d:`--${N(n.prefix)}${d.slice(1).replace(/\$/g,"-")}`,g=I?g:typeof g=="number"?g&&B in st?String(g)+"px":String(g):Ee(ot(B,g??""),n.prefix,n.themeMap[B]),r[0].push(`${$?`${d} `:`${de(d)}:`}${g}`)}}var C,b};S(h),r!==void 0&&i(be(...r)),r=void 0};l(e,t,o)},be=(e,t,o)=>`${o.map(n=>`${n}{`).join("")}${t.length?`${t.join(",")}{`:""}${e.join(";")}${t.length?"}":""}${Array(o.length?o.length+1:0).join("}")}`,st={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},Se=e=>String.fromCharCode(e+(e>25?39:97)),H=e=>(t=>{let o,n="";for(o=Math.abs(t);o>52;o=o/52|0)n=Se(o%52)+n;return Se(o%52)+n})(((t,o)=>{let n=o.length;for(;n;)t=33*t^o.charCodeAt(--n);return t})(5381,JSON.stringify(e))>>>0),ne=["themed","global","styled","onevar","resonevar","allvar","inline"],at=e=>{if(e.href&&!e.href.startsWith(location.origin))return!1;try{return!!e.cssRules}catch{return!1}},ct=e=>{let t;const o=()=>{const{cssRules:i}=t.sheet;return[].map.call(i,(r,c)=>{const{cssText:a}=r;let l="";if(a.startsWith("--sxs"))return"";if(i[c-1]&&(l=i[c-1].cssText).startsWith("--sxs")){if(!r.cssRules.length)return"";for(const h in t.rules)if(t.rules[h].group===r)return`--sxs{--sxs:${[...t.rules[h].cache].join(" ")}}${a}`;return r.cssRules.length?`${l}${a}`:""}return a}).join("")},n=()=>{if(t){const{rules:a,sheet:l}=t;if(!l.deleteRule){for(;Object(Object(l.cssRules)[0]).type===3;)l.cssRules.splice(0,1);l.cssRules=[]}for(const h in a)delete a[h]}const i=Object(e).styleSheets||[];for(const a of i)if(at(a)){for(let l=0,h=a.cssRules;h[l];++l){const p=Object(h[l]);if(p.type!==1)continue;const s=Object(h[l+1]);if(s.type!==4)continue;++l;const{cssText:d}=p;if(!d.startsWith("--sxs"))continue;const g=d.slice(14,-3).trim().split(/\s+/),S=ne[g[0]];S&&(t||(t={sheet:a,reset:n,rules:{},toString:o}),t.rules[S]={group:s,index:l,cache:new Set(g)})}if(t)break}if(!t){const a=(l,h)=>({type:h,cssRules:[],insertRule(p,s){this.cssRules.splice(s,0,a(p,{import:3,undefined:1}[(p.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return l==="@media{}"?`@media{${[].map.call(this.cssRules,p=>p.cssText).join("")}}`:l}});t={sheet:e?(e.head||e).appendChild(document.createElement("style")).sheet:a("","text/css"),rules:{},reset:n,toString:o}}const{sheet:r,rules:c}=t;for(let a=ne.length-1;a>=0;--a){const l=ne[a];if(!c[l]){const h=ne[a+1],p=c[h]?c[h].index:r.cssRules.length;r.insertRule("@media{}",p),r.insertRule(`--sxs{--sxs:${a}}`,p),c[l]={group:r.cssRules[p+1],index:p,cache:new Set([a])}}lt(c[l])}};return n(),t},lt=e=>{const t=e.group;let o=t.cssRules.length;e.apply=n=>{try{t.insertRule(n,o),++o}catch{}}},Q=Symbol(),dt=K(),ye=(e,t)=>dt(e,()=>(...o)=>{let n={type:null,composers:new Set};for(const i of o)if(i!=null)if(i[D]){n.type==null&&(n.type=i[D].type);for(const r of i[D].composers)n.composers.add(r)}else i.constructor!==Object||i.$$typeof?n.type==null&&(n.type=i):n.composers.add(mt(i,e));return n.type==null&&(n.type="span"),n.composers.size||n.composers.add(["PJLV",{},[],[],{},[]]),ut(e,n,t)}),mt=({variants:e,compoundVariants:t,defaultVariants:o,...n},i)=>{const r=`${N(i.prefix)}c-${H(n)}`,c=[],a=[],l=Object.create(null),h=[];for(const d in o)l[d]=String(o[d]);if(typeof e=="object"&&e)for(const d in e){p=l,s=d,Qe.call(p,s)||(l[d]="undefined");const g=e[d];for(const S in g){const x={[d]:String(S)};String(S)==="undefined"&&h.push(d);const C=g[S],b=[x,C,!ge(C)];c.push(b)}}var p,s;if(typeof t=="object"&&t)for(const d of t){let{css:g,...S}=d;g=typeof g=="object"&&g||{};for(const C in S)S[C]=String(S[C]);const x=[S,g,!ge(g)];a.push(x)}return[r,n,c,a,l,h]},ut=(e,t,o)=>{const[n,i,r,c]=ht(t.composers),a=typeof t.type=="function"||t.type.$$typeof?(s=>{function d(){for(let g=0;g<d[Q].length;g++){const[S,x]=d[Q][g];s.rules[S].apply(x)}return d[Q]=[],null}return d[Q]=[],d.rules={},ne.forEach(g=>d.rules[g]={apply:S=>d[Q].push([g,S])}),d})(o):null,l=(a||o).rules,h=`.${n}${i.length>1?`:where(.${i.slice(1).join(".")})`:""}`,p=s=>{s=typeof s=="object"&&s||pt;const{css:d,...g}=s,S={};for(const b in r)if(delete g[b],b in s){let $=s[b];typeof $=="object"&&$?S[b]={"@initial":r[b],...$}:($=String($),S[b]=$!=="undefined"||c.has(b)?$:r[b])}else S[b]=r[b];const x=new Set([...i]);for(const[b,$,_,B]of t.composers){o.rules.styled.cache.has(b)||(o.rules.styled.cache.add(b),J($,[`.${b}`],[],e,v=>{l.styled.apply(v)}));const I=ve(_,S,e.media),y=ve(B,S,e.media,!0);for(const v of I)if(v!==void 0)for(const[P,f,w]of v){const T=`${b}-${H(f)}-${P}`;x.add(T);const M=(w?o.rules.resonevar:o.rules.onevar).cache,O=w?l.resonevar:l.onevar;M.has(T)||(M.add(T),J(f,[`.${T}`],[],e,F=>{O.apply(F)}))}for(const v of y)if(v!==void 0)for(const[P,f]of v){const w=`${b}-${H(f)}-${P}`;x.add(w),o.rules.allvar.cache.has(w)||(o.rules.allvar.cache.add(w),J(f,[`.${w}`],[],e,T=>{l.allvar.apply(T)}))}}if(typeof d=="object"&&d){const b=`${n}-i${H(d)}-css`;x.add(b),o.rules.inline.cache.has(b)||(o.rules.inline.cache.add(b),J(d,[`.${b}`],[],e,$=>{l.inline.apply($)}))}for(const b of String(s.className||"").trim().split(/\s+/))b&&x.add(b);const C=g.className=[...x].join(" ");return{type:t.type,className:C,selector:h,props:g,toString:()=>C,deferredInjector:a}};return he(p,{className:n,selector:h,[D]:t,toString:()=>(o.rules.styled.cache.has(n)||p(),n)})},ht=e=>{let t="";const o=[],n={},i=[];for(const[r,,,,c,a]of e){t===""&&(t=r),o.push(r),i.push(...a);for(const l in c){const h=c[l];(n[l]===void 0||h!=="undefined"||a.includes(h))&&(n[l]=h)}}return[t,o,n,new Set(i)]},ve=(e,t,o,n)=>{const i=[];e:for(let[r,c,a]of e){if(a)continue;let l,h=0,p=!1;for(l in r){const s=r[l];let d=t[l];if(d!==s){if(typeof d!="object"||!d)continue e;{let g,S,x=0;for(const C in d){if(s===String(d[C])){if(C!=="@initial"){const b=C.slice(1);(S=S||[]).push(b in o?o[b]:C.replace(/^@media ?/,"")),p=!0}h+=x,g=!0}++x}if(S&&S.length&&(c={["@media "+S.join(", ")]:c}),!g)continue e}}}(i[h]=i[h]||[]).push([n?"cv":`${l}-${r[l]}`,c,p])}return i},pt={},gt=K(),ft=(e,t)=>gt(e,()=>(...o)=>{const n=()=>{for(let i of o){i=typeof i=="object"&&i||{};let r=H(i);if(!t.rules.global.cache.has(r)){if(t.rules.global.cache.add(r),"@import"in i){let c=[].indexOf.call(t.sheet.cssRules,t.rules.themed.group)-1;for(let a of[].concat(i["@import"]))a=a.includes('"')||a.includes("'")?a:`"${a}"`,t.sheet.insertRule(`@import ${a};`,c++);delete i["@import"]}J(i,[],[],e,c=>{t.rules.global.apply(c)})}}return""};return he(n,{toString:n})}),bt=K(),St=(e,t)=>bt(e,()=>o=>{const n=`${N(e.prefix)}k-${H(o)}`,i=()=>{if(!t.rules.global.cache.has(n)){t.rules.global.cache.add(n);const r=[];J(o,[],[],e,a=>r.push(a));const c=`@keyframes ${n}{${r.join("")}}`;t.rules.global.apply(c)}return n};return he(i,{get name(){return i()},toString:i})}),yt=class{constructor(e,t,o,n){this.token=e==null?"":String(e),this.value=t==null?"":String(t),this.scale=o==null?"":String(o),this.prefix=n==null?"":String(n)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+N(this.prefix)+N(this.scale)+this.token}toString(){return this.computedValue}},vt=K(),xt=(e,t)=>vt(e,()=>(o,n)=>{n=typeof o=="object"&&o||Object(n);const i=`.${o=(o=typeof o=="string"?o:"")||`${N(e.prefix)}t-${H(n)}`}`,r={},c=[];for(const l in n){r[l]={};for(const h in n[l]){const p=`--${N(e.prefix)}${l}-${h}`,s=Ee(String(n[l][h]),e.prefix,l);r[l][h]=new yt(h,s,l,e.prefix),c.push(`${p}:${s}`)}}const a=()=>{if(c.length&&!t.rules.themed.cache.has(o)){t.rules.themed.cache.add(o);const l=`${n===e.theme?":root,":""}.${o}{${c.join(";")}}`;t.rules.themed.apply(l)}return o};return{...r,get className(){return a()},selector:i,toString:a}}),$t=K(),wt=K(),Pt=e=>{const t=(o=>{let n=!1;const i=$t(o,r=>{n=!0;const c="prefix"in(r=typeof r=="object"&&r||{})?String(r.prefix):"",a=typeof r.media=="object"&&r.media||{},l=typeof r.root=="object"?r.root||null:globalThis.document||null,h=typeof r.theme=="object"&&r.theme||{},p={prefix:c,media:a,theme:h,themeMap:typeof r.themeMap=="object"&&r.themeMap||{...Xe},utils:typeof r.utils=="object"&&r.utils||{}},s=ct(l),d={css:ye(p,s),globalCss:ft(p,s),keyframes:St(p,s),createTheme:xt(p,s),reset(){s.reset(),d.theme.toString()},theme:{},sheet:s,config:p,prefix:c,getCssText:s.toString,toString:s.toString};return String(d.theme=d.createTheme(h)),d});return n||i.reset(),i})(e);return t.styled=(({config:o,sheet:n})=>wt(o,()=>{const i=ye(o,n);return(...r)=>{const c=i(...r),a=c[D].type,l=u.forwardRef((h,p)=>{const s=h&&h.as||a,{props:d,deferredInjector:g}=c(h);return delete d.as,d.ref=p,g?u.createElement(u.Fragment,null,u.createElement(s,d),u.createElement(g,null)):u.createElement(s,d)});return l.className=c.className,l.displayName=`Styled.${a.displayName||a.name||a}`,l.selector=c.selector,l.toString=()=>c.selector,l[D]=c[D],l}}))(t),t};const le=209,kt={colors:{primary:"#1a1d1e",primaryMuted:"#26292b",primaryAlt:"#151718",accent:`hsl(${le} 100% 38.2%)`,accentMuted:`hsl(${le} 80% 61.8%)`,accentAlt:`hsl(${le} 80% 30%)`,secondary:"#FFFFFF",secondaryMuted:"#e6e8eb",secondaryAlt:"#c1c8cd"},fontSizes:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},lineHeights:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},sizes:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},space:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},radii:{1:"4px",2:"6px",3:"8px",4:"12px",round:"50%",pill:"9999px"},transitions:{all:"all 200ms cubic-bezier(0.16, 1, 0.3, 1)"},zIndices:{1:"100",2:"200",3:"300",4:"400",max:"999"}},Ct={xxs:"(max-width: 349px)",xs:"(max-width: 575px)",sm:"(max-width: 767px)",md:"(max-width: 991px)",lg:"(max-width: 90rem)",xl:"(min-width: calc(90rem + 1px))"},{styled:W,css:li,keyframes:di,createTheme:mi}=Pt({theme:kt,media:Ct}),Rt=W("div",{display:"flex",flexDirection:"column",alignItems:"center"}),Tt=W("p",{fontWeight:"bold",fontSize:"x-large"}),It=W("span",{fontSize:"medium"}),Et=({error:e})=>{const{message:t}=e;return u.createElement(Rt,{role:"alert"},u.createElement(Tt,{"data-testid":"headline"},"Something went wrong"),t&&u.createElement(It,null,`Error message: ${t}`," "))},me=W("div",{position:"absolute !important",zIndex:"1",top:"1rem",left:"1rem",width:"161.8px",height:"100px",backgroundColor:"#000D",boxShadow:"5px 5px 5px #0002",borderRadius:"3px",".displayregion":{border:" 3px solid $accent !important",boxShadow:"0 0 3px #0006"},"@sm":{width:"123px",height:"76px"},"@xs":{width:"100px",height:"61.8px"}}),Bt=W("div",{position:"relative",width:"100%",height:"100%",zIndex:"0",".clover-iiif-image-openseadragon-annotation":{position:"relative",backgroundColor:"transparent",border:"2px solid #0003",boxSizing:"content-box",borderRadius:"3px",boxShadow:"0 0 38vw 38vw transparent",transition:"box-shadow 100ms ease-in-out",zIndex:"0",label:{opacity:0,position:"absolute",lineHeight:"1.47rem",pointerEvents:"none",textAlign:"center",minWidth:"300px",maxWidth:"20vw",padding:"0.5rem",borderRadius:"3px",top:"calc(100% + 0.5rem)",left:"50%",transform:"translate(-50%, 0)",backgroundColor:"$primary",color:"$secondary",transition:"opacity 100ms ease-in-out"},"&[data-active=true]":{border:"2px solid $accent !important",boxShadow:"0 0 38vw 38vw #0003",zIndex:"99999999",label:{opacity:1}}}}),At=W("div",{width:"100%",height:"100%",maxHeight:"100vh",background:"transparent",backgroundSize:"contain",color:"white",position:"relative",zIndex:"0",overflow:"hidden",variants:{hasNavigator:{true:{[`${me}`]:{display:"block"}},false:{[`${me}`]:{display:"none"}}}}});let ie;const Lt=new Uint8Array(16);function Mt(){if(!ie&&(ie=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ie))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ie(Lt)}const E=[];for(let e=0;e<256;++e)E.push((e+256).toString(16).slice(1));function zt(e,t=0){return E[e[t+0]]+E[e[t+1]]+E[e[t+2]]+E[e[t+3]]+"-"+E[e[t+4]]+E[e[t+5]]+"-"+E[e[t+6]]+E[e[t+7]]+"-"+E[e[t+8]]+E[e[t+9]]+"-"+E[e[t+10]]+E[e[t+11]]+E[e[t+12]]+E[e[t+13]]+E[e[t+14]]+E[e[t+15]]}const Ot=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),xe={randomUUID:Ot};function Be(e,t,o){if(xe.randomUUID&&!e)return xe.randomUUID();e=e||{};const n=e.random||(e.rng||Mt)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,zt(n)}const Ae={behavior:"smooth",block:"center"},j={annotationOverlays:{backgroundColor:"#6666ff",borderColor:"#000099",borderType:"solid",borderWidth:"1px",opacity:"0.5",renderOverlays:!0,zoomLevel:2},annotations:{motivations:void 0},background:"transparent",canvasBackgroundColor:"#6662",canvasHeight:"500px",contentSearch:{searchResultsLimit:20,overlays:{backgroundColor:"#ff6666",borderColor:"#990000",borderType:"solid",borderWidth:"1px",opacity:"0.5",renderOverlays:!0,zoomLevel:4}},crossOrigin:"anonymous",ignoreCaptionLabels:[],informationPanel:{vtt:{autoScroll:{enabled:!0,settings:Ae}},open:!0,renderAbout:!0,renderSupplementing:!0,renderToggle:!0,renderAnnotation:!0,renderContentSearch:!0},openSeadragon:{},requestHeaders:{"Content-Type":"application/json"},showDownload:!0,showIIIFBadge:!0,showTitle:!0,withCredentials:!1},jt=(e=j)=>ue(e);function ue(e){return Array.isArray(e)?e.map(t=>ue(t)):e&&typeof e=="object"?Object.entries(e).reduce((t,[o,n])=>(t[o]=ue(n),t),{}):e}function Nt(e){const o=(()=>{var c,a;return((a=(c=j==null?void 0:j.informationPanel)==null?void 0:c.vtt)==null?void 0:a.autoScroll)||{enabled:!0,settings:Ae}})();if(e==null)return{enabled:o.enabled,settings:{...o.settings}};if(typeof e=="boolean")return{enabled:e,settings:{...o.settings}};if("enabled"in e){const r=e;return{enabled:r.enabled,settings:{...r.settings}}}const i={enabled:!0,settings:{...e}};return Wt(i.settings),i}function Wt({behavior:e,block:t}){const o=["auto","instant","smooth"],n=["center","end","nearest","start"];if(!o.includes(e))throw TypeError(`'${e}' not in ${o.join(" | ")}`);if(!n.includes(t))throw TypeError(`'${t}' not in ${n.join(" | ")}`)}var Ce,Re;const Ft=Nt((Re=(Ce=j==null?void 0:j.informationPanel)==null?void 0:Ce.vtt)==null?void 0:Re.autoScroll),Vt=()=>{var e;return{activeCanvas:"",activeManifest:"",activePlayer:null,activeSelector:void 0,OSDImageLoaded:!1,collection:{},configOptions:jt(),customDisplays:[],plugins:[],isAutoScrollEnabled:Ft.enabled,isAutoScrolling:!1,isInformationOpen:((e=j==null?void 0:j.informationPanel)==null?void 0:e.open)??!0,isLoaded:!1,isPaged:!1,isUserScrolling:void 0,sequence:[[],[]],vault:new Ve.Vault,viewingDirection:"left-to-right",openSeadragonViewer:null,viewerId:Be(),visibleCanvases:[],visibleAnnotations:[]}},Le=Vt(),Dt=u.createContext(Le),Ht=u.createContext(Le);function $e(){const e=u.useContext(Dt);if(e===void 0)throw new Error("useViewerState must be used within a ViewerProvider");return e}function Me(){const e=u.useContext(Ht);if(e===void 0)throw new Error("useViewerDispatch must be used within a ViewerProvider");return e}const _t=W("button",{display:"flex",height:"2rem",width:"2rem",borderRadius:"2rem",padding:"0",margin:"0",fontFamily:"inherit",background:"none",backgroundColor:"$primary",border:"none",color:"white",cursor:"pointer",marginLeft:"0.618rem",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"content-box !important","&:first-child":{marginLeft:"0"},"@xs":{marginBottom:"0.618rem",marginLeft:"0","&:last-child":{marginBottom:"0"}},svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"inherit"},"&:hover, &:focus":{backgroundColor:"$accent"},"&[data-button=rotate-right]":{"&:hover, &:focus":{svg:{rotate:"45deg"}}},"&[data-button=rotate-left]":{transform:"scaleX(-1)","&:hover, &:focus":{svg:{rotate:"45deg"}}},"&[data-button=reset]":{"&:hover, &:focus":{svg:{rotate:"-15deg"}}}}),U=({className:e,id:t,label:o,children:n})=>{const r=t.split("-")[0].replace(/([A-Z])/g,"-$1").toLowerCase().replace(/^-/,"");return u.createElement(_t,{id:t,className:e,"data-testid":"openseadragon-button","data-button":r},u.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":`${t}-svg-title`,"data-testid":"openseadragon-button-svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},u.createElement("title",{id:`${t}-svg-title`},o),n))},Zt=W("div",{position:"absolute",zIndex:"1",top:"1rem",right:"1rem",display:"flex","@xs":{flexDirection:"column",zIndex:"2"},variants:{hasPlaceholder:{true:{right:"3.618rem","@xs":{top:"3.618rem",right:"1rem"}},false:{right:"1rem","@xs":{top:"1rem",right:"1rem"}}}}}),Ut="Close",Jt="Next",Kt="Open",qt="Previous",Gt="Search",Xt="Search...",Yt="Share",Qt="View All",eo="Failed",to="Copied",oo="Loading...",no="Search",ro="No Results",io="More Results",so="Full screen",ao="Reset zoom",co="Rotate left",lo="Rotate right",mo="Zoom in",uo="Zoom out",ho="Select",po="Viewer",go="About",fo="Annotations",bo="Search",So="More Information",yo="View Collection",vo="Copy Collection URL",xo="View Manifest",$o="Copy Manifest URL",ze={commonClose:Ut,commonNext:Jt,commonOpen:Kt,commonPrevious:qt,commonSearch:Gt,commonSearchPlaceholder:Xt,commonShare:Yt,commonViewAll:Qt,copyFailure:eo,copySuccess:to,contentSearchLoading:oo,contentSearchPlaceholder:no,contentSearchResultsNone:ro,contentSearchResultsMore:io,imageFullScreen:so,imageResetZoom:ao,imageRotateLeft:co,imageRotateRight:lo,imageZoomIn:mo,imageZoomOut:uo,informationPanelTabs:ho,informationPanelTabsClose:po,informationPanelTabsAbout:go,informationPanelTabsAnnotations:fo,informationPanelTabsSearch:bo,informationPanelToggle:So,shareCollectionJson:yo,shareCollectionCopy:vo,shareManifestJson:xo,shareManifestCopy:$o},wo="Sulje",Po="Seuraava",ko="Edellinen",Co="Hae",Ro="Hae...",To="Jaa",Io="Näytä kaikki",Eo="Kopiointi epäonnistui",Bo="Kopioitu",Ao="Ladataan...",Lo="Haku",Mo="Ei osumia",zo="Lisää osumia",Oo="Valitse",jo="Katselu",No="Tiedot",Wo="Annotaatiot",Fo="Haku",Vo="Lisätiedot",Do="Näytä kokoelma",Ho="Kopioi kokoelman osoite",_o="Näytä manifesti",Zo="Kopioi manifestin osoite",Uo={commonClose:wo,commonNext:Po,commonPrevious:ko,commonSearch:Co,commonSearchPlaceholder:Ro,commonShare:To,commonViewAll:Io,copyFailure:Eo,copySuccess:Bo,contentSearchLoading:Ao,contentSearchPlaceholder:Lo,contentSearchResultsNone:Mo,contentSearchResultsMore:zo,informationPanelTabs:Oo,informationPanelTabsClose:jo,informationPanelTabsAbout:No,informationPanelTabsAnnotations:Wo,informationPanelTabsSearch:Fo,informationPanelToggle:Vo,shareCollectionJson:Do,shareCollectionCopy:Ho,shareManifestJson:_o,shareManifestCopy:Zo},Jo="Fermer",Ko="Suivant",qo="Ouvrir",Go="Précédent",Xo="Rechercher",Yo="Rechercher…",Qo="Partager",en="Tout afficher",tn="Échec",on="Copié",nn="Chargement…",rn="Rechercher",sn="Aucun résultat",an="Plus de résultats",cn="Plein écran",ln="Réinitialiser le zoom",dn="Rotation à gauche",mn="Rotation à droite",un="Zoom avant",hn="Zoom arrière",pn="Sélectionner",gn="Visionneuse",fn="À propos",bn="Annotations",Sn="Recherche",yn="Plus d’informations",vn="Afficher la collection",xn="Copier l’URL de la collection",$n="Afficher le manifeste",wn="Copier l’URL du manifeste",Pn={commonClose:Jo,commonNext:Ko,commonOpen:qo,commonPrevious:Go,commonSearch:Xo,commonSearchPlaceholder:Yo,commonShare:Qo,commonViewAll:en,copyFailure:tn,copySuccess:on,contentSearchLoading:nn,contentSearchPlaceholder:rn,contentSearchResultsNone:sn,contentSearchResultsMore:an,imageFullScreen:cn,imageResetZoom:ln,imageRotateLeft:dn,imageRotateRight:mn,imageZoomIn:un,imageZoomOut:hn,informationPanelTabs:pn,informationPanelTabsClose:gn,informationPanelTabsAbout:fn,informationPanelTabsAnnotations:bn,informationPanelTabsSearch:Sn,informationPanelToggle:yn,shareCollectionJson:vn,shareCollectionCopy:xn,shareManifestJson:$n,shareManifestCopy:wn},kn="Lukk",Cn="Neste",Rn="Forrige",Tn="Søk",In="Søk...",En="Del",Bn="Se alle",An="Feilet",Ln="Kopiert",Mn="Laster inn...",zn="Søk",On="Ingen resultat",jn="Flere resultat",Nn="Velg",Wn="Viewer",Fn="Om",Vn="Annoteringer",Dn="Søk",Hn="Mer informasjon",_n="Se samlingen",Zn="Kopiér samlingens URL",Un="Se manifestet",Jn="Kopiér manifestets URL",Kn={commonClose:kn,commonNext:Cn,commonPrevious:Rn,commonSearch:Tn,commonSearchPlaceholder:In,commonShare:En,commonViewAll:Bn,copyFailure:An,copySuccess:Ln,contentSearchLoading:Mn,contentSearchPlaceholder:zn,contentSearchResultsNone:On,contentSearchResultsMore:jn,informationPanelTabs:Nn,informationPanelTabsClose:Wn,informationPanelTabsAbout:Fn,informationPanelTabsAnnotations:Vn,informationPanelTabsSearch:Dn,informationPanelToggle:Hn,shareCollectionJson:_n,shareCollectionCopy:Zn,shareManifestJson:Un,shareManifestCopy:Jn},qn="Lukk",Gn="Neste",Xn="Førre",Yn="Søk",Qn="Søk...",er="Del",tr="Sjå alle",or="Feila",nr="Kopiert",rr="Laster inn...",ir="Søk",sr="Ingen resultat",ar="Fleire resultat",cr="Vel",lr="Viewer",dr="Om",mr="Annoteringa",ur="Søk",hr="Meir informasjon",pr="Sjå samlinga",gr="Kopiér samlingas URL",fr="Sjå manifestet",br="Kopiér manifestets URL",Sr={commonClose:qn,commonNext:Gn,commonPrevious:Xn,commonSearch:Yn,commonSearchPlaceholder:Qn,commonShare:er,commonViewAll:tr,copyFailure:or,copySuccess:nr,contentSearchLoading:rr,contentSearchPlaceholder:ir,contentSearchResultsNone:sr,contentSearchResultsMore:ar,informationPanelTabs:cr,informationPanelTabsClose:lr,informationPanelTabsAbout:dr,informationPanelTabsAnnotations:mr,informationPanelTabsSearch:ur,informationPanelToggle:hr,shareCollectionJson:pr,shareCollectionCopy:gr,shareManifestJson:fr,shareManifestCopy:br},yr="Lukk",vr="Neste",xr="Forrige",$r="Søk",wr="Søk...",Pr="Del",kr="Se alle",Cr="Feilet",Rr="Kopiert",Tr="Laster inn...",Ir="Søk",Er="Ingen resultat",Br="Flere resultat",Ar="Velg",Lr="Viewer",Mr="Om",zr="Annoteringer",Or="Søk",jr="Mer informasjon",Nr="Se samlingen",Wr="Kopiér samlingens URL",Fr="Se manifestet",Vr="Kopiér manifestets URL",Dr={commonClose:yr,commonNext:vr,commonPrevious:xr,commonSearch:$r,commonSearchPlaceholder:wr,commonShare:Pr,commonViewAll:kr,copyFailure:Cr,copySuccess:Rr,contentSearchLoading:Tr,contentSearchPlaceholder:Ir,contentSearchResultsNone:Er,contentSearchResultsMore:Br,informationPanelTabs:Ar,informationPanelTabsClose:Lr,informationPanelTabsAbout:Mr,informationPanelTabsAnnotations:zr,informationPanelTabsSearch:Or,informationPanelToggle:jr,shareCollectionJson:Nr,shareCollectionCopy:Wr,shareManifestJson:Fr,shareManifestCopy:Vr},Hr={},_r={en:ze,fi:Uo,fr:Pn,nb:Kn,nn:Sr,no:Dr,pt:Hr},se="clover",Zr=Object.fromEntries(Object.entries(_r).map(([e,t])=>[e,{[se]:t}])),ee={defaultNS:se,fallbackLng:"en",ns:[se],resources:{...Zr}},Ur=(e,t)=>({...e||{},...t||{}});let we=!1;function Jr(e){if(e){for(const[t,o]of Object.entries(e))if(o)for(const[n,i]of Object.entries(o))i&&oe.addResourceBundle(t,n,i,!0,!0)}}function Kr(e={}){if(we)Jr(e.resources),e.lng&&oe.changeLanguage(e.lng),e.fallbackLng&&(oe.options.fallbackLng=e.fallbackLng);else{const t=Ur(ee.resources,e.resources);oe.use(De).use(Te.initReactI18next).init({...ee,...e,resources:t,ns:e.ns??ee.ns,defaultNS:e.defaultNS??ee.defaultNS,fallbackLng:e.fallbackLng??ee.fallbackLng}),we=!0}return oe}Kr();const qr=ze;function Gr(e){return qr[e]??e}function Xr(e=se){const t=Te.useTranslation(e),{t:o}=t,n=u.useCallback((i,r)=>{const c=o(i,r);return typeof c!="string"||c===i?Gr(i):c},[o]);return{...t,t:n}}const Yr=()=>u.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M256 112v288M400 256H112"}),Qr=()=>u.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 256H112"}),ei=()=>u.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M432 320v112H320M421.8 421.77L304 304M80 192V80h112M90.2 90.23L208 208M320 80h112v112M421.77 90.2L304 208M192 432H80V320M90.23 421.8L208 304"}),ti=()=>u.createElement("path",{d:"M448 440a16 16 0 01-12.61-6.15c-22.86-29.27-44.07-51.86-73.32-67C335 352.88 301 345.59 256 344.23V424a16 16 0 01-27 11.57l-176-168a16 16 0 010-23.14l176-168A16 16 0 01256 88v80.36c74.14 3.41 129.38 30.91 164.35 81.87C449.32 292.44 464 350.9 464 424a16 16 0 01-16 16z"}),Pe=()=>u.createElement(u.Fragment,null,u.createElement("path",{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 148l-21.12-24.57A191.43 191.43 0 00240 64C134 64 48 150 48 256s86 192 192 192a192.09 192.09 0 00181.07-128"}),u.createElement("path",{d:"M464 97.42V208a16 16 0 01-16 16H337.42c-14.26 0-21.4-17.23-11.32-27.31L436.69 86.1C446.77 76 464 83.16 464 97.42z"})),oi=({_cloverViewerHasPlaceholder:e,config:t})=>{const{t:o}=Xr(),n=$e(),{activeCanvas:i,plugins:r,vault:c,openSeadragonViewer:a}=n,l=c.get({id:i,type:"Canvas"});function h(){return r.filter(p=>{var s;return(s=p.imageViewer)==null?void 0:s.controls}).map((p,s)=>{var g,S,x,C;const d=(S=(g=p.imageViewer)==null?void 0:g.controls)==null?void 0:S.component;return u.createElement(d,{key:s,...(C=(x=p==null?void 0:p.imageViewer)==null?void 0:x.controls)==null?void 0:C.componentProps,canvas:l,useViewerDispatch:Me,useViewerState:$e})})}return u.useEffect(()=>{if(!a)return;const p=a.viewport.getRotation();a.addHandler("home",()=>{a.viewport.setRotation(p)})},[a]),u.createElement(Zt,{"data-testid":"clover-iiif-image-openseadragon-controls",hasPlaceholder:e},t.showZoomControl&&u.createElement(u.Fragment,null,u.createElement(U,{id:t.zoomInButton,label:o("imageZoomIn")},u.createElement(Yr,null)),u.createElement(U,{id:t.zoomOutButton,label:o("imageZoomOut")},u.createElement(Qr,null))),t.showFullPageControl&&u.createElement(U,{id:t.fullPageButton,label:o("imageFullScreen")},u.createElement(ei,null)),t.showRotationControl&&u.createElement(u.Fragment,null,u.createElement(U,{id:t.rotateRightButton,label:o("imageRotateRight")},u.createElement(Pe,null)),u.createElement(U,{id:t.rotateLeftButton,label:o("imageRotateLeft")},u.createElement(Pe,null))),t.showHomeControl&&u.createElement(U,{id:t.homeButton,label:o("imageResetZoom")},u.createElement(ti,null)),h())};async function Oe(e,t=3,o=500){try{return await e()}catch(n){if(t<=0)throw n;return await new Promise(i=>setTimeout(i,o)),Oe(e,t-1,o)}}const ni=e=>new Promise(t=>setTimeout(t,e)),ke=async(e,t,o=3,n=300)=>{for(let i=0;i<o;i++){const r=t?t-1:0,c=e.getItemAt(r);if(c)return c;await ni(n)}throw new Error("No base item found at index 0 after retries")},ri=({annotations:e,ariaLabel:t,config:o,uri:n,_cloverViewerHasPlaceholder:i,imageType:r,openSeadragonCallback:c})=>{const[a,l]=u.useState([]),[h,p]=u.useState([]),[s,d]=u.useState(),[g,S]=u.useState([]),x=Me(),C=u.useRef(!1),b="clover-iiif-image-openseadragon-annotation",$=o.gestureSettingsMouse.scrollToZoom===!1;u.useEffect(()=>(C.current||(C.current=!0,s||d(te(o))),()=>s==null?void 0:s.destroy()),[]),u.useEffect(()=>{_()},[s,c]),u.useEffect(()=>{s&&JSON.stringify(n)!==JSON.stringify(h)&&(s.forceRedraw(),$&&s.addHandler("canvas-scroll",function(B){B.preventDefault=!1}),p(n))},[$,s,h,n]),u.useEffect(()=>{if(!h.length||!s)return;s.close(),(async()=>{switch(r){case"simpleImage":let I=1,y=0;for(let v=0;v<h.length;v++){const P=h[v];if(e){const f=new Image;f.src=P,await f.decode(),S(w=>[...w,{width:f==null?void 0:f.width,height:f==null?void 0:f.height}])}try{if(v!==0){const w=(await ke(s.world,v)).getBounds();y=w.x+w.width,I=w.height}s.addSimpleImage({url:P,x:y,y:0,height:I,success:()=>{l(f=>[...f,P]),typeof x=="function"&&x({type:"updateOSDImageLoaded",OSDImageLoaded:!0})}})}catch(f){console.error(`Failed to load image at ${P}:`,f)}}break;case"tiledImage":{let v=1,P=0;for(let f=0;f<h.length;f++){const w=h[f];try{const T=await Oe(()=>_e(w),3,1e3);if(!T)throw new Error(`No tile source for ${w}`);if(f!==0){const O=(await ke(s.world,f)).getBounds();P=O.x+O.width,v=O.height}s.addTiledImage({tileSource:T,x:P,y:0,height:v,success:()=>{l(M=>[...M,w]),typeof x=="function"&&x({type:"updateOSDImageLoaded",OSDImageLoaded:!0})}})}catch(T){console.error(`Failed to load tile at ${w}:`,T)}}break}default:console.warn(`Unsupported imageType: "${r}"`);break}})().catch(I=>console.error("Error drawing tiles",I))},[h,r,s]),u.useEffect(()=>{if(a){let I=0;const y=()=>{if(I<3){const v=s==null?void 0:s.world.getHomeBounds();v&&(s==null||s.viewport.fitBounds(v,!0)),I++,setTimeout(y,50)}};y(),s==null||s.addHandler("canvas-click",v=>{const P=s==null?void 0:s.getOverlayById(v.originalTarget.id);if(P){const f=P==null?void 0:P.getBounds(s.viewport);return f.x-=.1,f.y-=.1,f.width+=.2,f.height+=.2,s==null||s.viewport.fitBounds(f,!1),v.preventDefaultAction=!0}})}},[a]),u.useEffect(()=>{function B(I,y,v){let P=I*v;if(y===0)return P;for(;y>0;){const f=s==null?void 0:s.world.getItemAt(y-1);if(f){const w=f.getBounds().width;P+=w,y--}else break}return P}e&&(s==null||s.clearOverlays(),e.forEach(I=>{var O,F,q,re;const{annotation:y,targetIndex:v}=I,P=((F=(O=s==null?void 0:s.viewport)==null?void 0:O.getBounds())==null?void 0:F.width)||1,f=s==null?void 0:s.world.getItemAt(v),w=f?(f==null?void 0:f.getBounds().width)/(f==null?void 0:f.getContentSize().x):((q=g[v])==null?void 0:q.width)/P,T=He(y==null?void 0:y.target),M=y!=null&&y.body?(re=y==null?void 0:y.body[0])==null?void 0:re.value:void 0;if(T!=null&&T.rect){const{x:G,y:X,w:je,h:Ne}=T==null?void 0:T.rect,We=B(G,v,w),Y=new te.Rect(We,X*w,je*w,Ne*w),R=document.createElement("button");if(R.classList.add(b),R.id=y.id,R.setAttribute("tabindex","0"),R.setAttribute("role","button"),R.setAttribute("data-active","true"),R.setAttribute("tabindex","0"),R.setAttribute("role","button"),R.setAttribute("data-active","false"),M){R.setAttribute("aria-label",M);const A=document.createElement("label");A.innerHTML=M,R.appendChild(A)}R.addEventListener("mousedown",A=>{A.stopPropagation(),A.preventDefault()}),R.addEventListener("touchstart",A=>{A.stopPropagation(),A.preventDefault()}),R.addEventListener("click",A=>{A.stopPropagation(),A.preventDefault()}),R.addEventListener("keydown",A=>{if(A.key==="Enter"){A.stopPropagation(),A.preventDefault();const Fe=new te.Rect(Y.x-.1,Y.y-.1,Y.width+.2,Y.height+.2);s==null||s.viewport.fitBounds(Fe,!1)}}),R.addEventListener("focus",()=>{R.setAttribute("data-active","true")}),R.addEventListener("mouseover",()=>{R.setAttribute("data-active","true")}),R.addEventListener("mouseout",()=>{R.removeAttribute("data-active")}),R.addEventListener("blur",()=>{R.removeAttribute("data-active")}),s==null||s.addOverlay(R,Y,te.Placement.CENTER)}}),_())},[a,e]);function _(){s&&(c==null||c(s))}return u.createElement(At,{className:"clover-iiif-image-openseadragon","data-testid":"clover-iiif-image-openseadragon","data-openseadragon-instance":o.id,hasNavigator:o.showNavigator},u.createElement(oi,{_cloverViewerHasPlaceholder:i,config:o}),o.showNavigator&&u.createElement(me,{id:o.navigatorId,"data-testid":"clover-iiif-image-openseadragon-navigator"}),u.createElement(Bt,{id:o.id,"data-testid":"clover-iiif-image-openseadragon-viewport",role:"img",...t&&{"aria-label":t}}))};function ii(e){return{id:`openseadragon-${e}`,navigatorId:`openseadragon-navigator-${e}`,loadTilesWithAjax:!0,fullPageButton:`fullPage-${e}`,homeButton:`reset-${e}`,rotateLeftButton:`rotateLeft-${e}`,rotateRightButton:`rotateRight-${e}`,zoomInButton:`zoomIn-${e}`,zoomOutButton:`zoomOut-${e}`,showNavigator:!0,showFullPageControl:!0,showHomeControl:!0,showRotationControl:!0,showZoomControl:!0,navigatorBorderColor:"transparent",gestureSettingsMouse:{clickToZoom:!0,dblClickToZoom:!0,pinchToZoom:!0,scrollToZoom:!1}}}const si=(e,t="none")=>{if(!e)return null;if(typeof e=="string")return[e];if(!e[t]){const o=Object.getOwnPropertyNames(e);if(o.length>0)return e[o[0]]}return!e[t]||!Array.isArray(e[t])?null:e[t]},ai=(e,t="none",o=", ")=>{const n=si(e,t);return Array.isArray(n)?n.join(`${o}`):n},ci=({_cloverViewerHasPlaceholder:e=!1,annotations:t,body:o,instanceId:n,isTiledImage:i=!1,label:r,src:c="",openSeadragonCallback:a,openSeadragonConfig:l={}})=>{const h=n??Be(),p=typeof r=="string"?r:ai(r),s={...ii(h),...l},d=Array.isArray(o)?o:o?[o]:[],g=Array.isArray(c)?c:c?[c]:[];let S=[],x=z.SimpleImage;if(d.length){const b=d.map(Ue);S=b.map($=>$.uri).filter(Boolean),x=b.some($=>$.imageType===z.TiledImage)?z.TiledImage:z.SimpleImage}else if(g.length){const b=g.map($=>Je($,i));S=b.map($=>$.uri).filter(Boolean),x=b.some($=>$.imageType===z.TiledImage)?z.TiledImage:z.SimpleImage}if(!S.length)return null;const C=b=>{a==null||a(b)};return u.createElement(qe,{FallbackComponent:Et},u.createElement(ri,{_cloverViewerHasPlaceholder:e,annotations:t,ariaLabel:p,config:s,imageType:x,key:h,uri:S,openSeadragonCallback:C}))};exports.default=ci;
